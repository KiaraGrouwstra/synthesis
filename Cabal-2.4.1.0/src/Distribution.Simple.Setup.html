<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Module      :  Distribution.Simple.Setup</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Copyright   :  Isaac Jones 2003-2004</span><span>
</span><a name="line-10"></a><span class="hs-comment">--                Duncan Coutts 2007</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- License     :  BSD3</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- Maintainer  :  cabal-devel@haskell.org</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-15"></a><span class="hs-comment">--</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- This is a big module, but not very complicated. The code is very regular</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- and repetitive. It defines the command line interface for all the Cabal</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- commands. For each command (like @configure@, @build@ etc) it defines a type</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- that holds all the flags, the default set of flags and a 'CommandUI' that</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- maps command line flags to and from the corresponding flags type.</span><span>
</span><a name="line-21"></a><span class="hs-comment">--</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- All the flags types are instances of 'Monoid', see</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- &lt;http://www.haskell.org/pipermail/cabal-devel/2007-December/001509.html&gt;</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- for an explanation.</span><span>
</span><a name="line-25"></a><span class="hs-comment">--</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- The types defined here get used in the front end and especially in</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- @cabal-install@ which has to do quite a bit of manipulating sets of command</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- line flags.</span><span>
</span><a name="line-29"></a><span class="hs-comment">--</span><span>
</span><a name="line-30"></a><span class="hs-comment">-- This is actually relatively nice, it works quite well. The main change it</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- needs is to unify it with the code for managing sets of fields that can be</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- read and written from files. This would allow us to save configure flags in</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- config files.</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Distribution.Simple.Setup</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span>  </span><a href="Distribution.Simple.Setup.html#GlobalFlags"><span class="hs-identifier hs-type">GlobalFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>   </span><a href="Distribution.Simple.Setup.html#emptyGlobalFlags"><span class="hs-identifier hs-var">emptyGlobalFlags</span></a><span class="hs-special">,</span><span>   </span><a href="Distribution.Simple.Setup.html#defaultGlobalFlags"><span class="hs-identifier hs-var">defaultGlobalFlags</span></a><span class="hs-special">,</span><span>   </span><a href="Distribution.Simple.Setup.html#globalCommand"><span class="hs-identifier hs-var">globalCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>  </span><a href="Distribution.Simple.Setup.html#ConfigFlags"><span class="hs-identifier hs-type">ConfigFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>   </span><a href="Distribution.Simple.Setup.html#emptyConfigFlags"><span class="hs-identifier hs-var">emptyConfigFlags</span></a><span class="hs-special">,</span><span>   </span><a href="Distribution.Simple.Setup.html#defaultConfigFlags"><span class="hs-identifier hs-var">defaultConfigFlags</span></a><span class="hs-special">,</span><span>   </span><a href="Distribution.Simple.Setup.html#configureCommand"><span class="hs-identifier hs-var">configureCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>  </span><a href="Distribution.Simple.Setup.html#configPrograms"><span class="hs-identifier hs-var">configPrograms</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>  </span><a href="Distribution.Simple.Setup.html#configAbsolutePaths"><span class="hs-identifier hs-var">configAbsolutePaths</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#readPackageDbList"><span class="hs-identifier hs-var">readPackageDbList</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#showPackageDbList"><span class="hs-identifier hs-var">showPackageDbList</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>  </span><a href="Distribution.Simple.Setup.html#CopyFlags"><span class="hs-identifier hs-type">CopyFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>     </span><a href="Distribution.Simple.Setup.html#emptyCopyFlags"><span class="hs-identifier hs-var">emptyCopyFlags</span></a><span class="hs-special">,</span><span>     </span><a href="Distribution.Simple.Setup.html#defaultCopyFlags"><span class="hs-identifier hs-var">defaultCopyFlags</span></a><span class="hs-special">,</span><span>     </span><a href="Distribution.Simple.Setup.html#copyCommand"><span class="hs-identifier hs-var">copyCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>  </span><a href="Distribution.Simple.Setup.html#InstallFlags"><span class="hs-identifier hs-type">InstallFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><a href="Distribution.Simple.Setup.html#emptyInstallFlags"><span class="hs-identifier hs-var">emptyInstallFlags</span></a><span class="hs-special">,</span><span>  </span><a href="Distribution.Simple.Setup.html#defaultInstallFlags"><span class="hs-identifier hs-var">defaultInstallFlags</span></a><span class="hs-special">,</span><span>  </span><a href="Distribution.Simple.Setup.html#installCommand"><span class="hs-identifier hs-var">installCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>  </span><a href="Distribution.Simple.Setup.html#DoctestFlags"><span class="hs-identifier hs-type">DoctestFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><a href="Distribution.Simple.Setup.html#emptyDoctestFlags"><span class="hs-identifier hs-var">emptyDoctestFlags</span></a><span class="hs-special">,</span><span>  </span><a href="Distribution.Simple.Setup.html#defaultDoctestFlags"><span class="hs-identifier hs-var">defaultDoctestFlags</span></a><span class="hs-special">,</span><span>  </span><a href="Distribution.Simple.Setup.html#doctestCommand"><span class="hs-identifier hs-var">doctestCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>  </span><a href="Distribution.Simple.Setup.html#HaddockTarget"><span class="hs-identifier hs-type">HaddockTarget</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>  </span><a href="Distribution.Simple.Setup.html#HaddockFlags"><span class="hs-identifier hs-type">HaddockFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><a href="Distribution.Simple.Setup.html#emptyHaddockFlags"><span class="hs-identifier hs-var">emptyHaddockFlags</span></a><span class="hs-special">,</span><span>  </span><a href="Distribution.Simple.Setup.html#defaultHaddockFlags"><span class="hs-identifier hs-var">defaultHaddockFlags</span></a><span class="hs-special">,</span><span>  </span><a href="Distribution.Simple.Setup.html#haddockCommand"><span class="hs-identifier hs-var">haddockCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>  </span><a href="Distribution.Simple.Setup.html#HscolourFlags"><span class="hs-identifier hs-type">HscolourFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#emptyHscolourFlags"><span class="hs-identifier hs-var">emptyHscolourFlags</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#defaultHscolourFlags"><span class="hs-identifier hs-var">defaultHscolourFlags</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#hscolourCommand"><span class="hs-identifier hs-var">hscolourCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>  </span><a href="Distribution.Simple.Setup.html#BuildFlags"><span class="hs-identifier hs-type">BuildFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>    </span><a href="Distribution.Simple.Setup.html#emptyBuildFlags"><span class="hs-identifier hs-var">emptyBuildFlags</span></a><span class="hs-special">,</span><span>    </span><a href="Distribution.Simple.Setup.html#defaultBuildFlags"><span class="hs-identifier hs-var">defaultBuildFlags</span></a><span class="hs-special">,</span><span>    </span><a href="Distribution.Simple.Setup.html#buildCommand"><span class="hs-identifier hs-var">buildCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>  </span><a href="Distribution.Simple.Setup.html#buildVerbose"><span class="hs-identifier hs-var">buildVerbose</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>  </span><a href="Distribution.Simple.Setup.html#ReplFlags"><span class="hs-identifier hs-type">ReplFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>                         </span><a href="Distribution.Simple.Setup.html#defaultReplFlags"><span class="hs-identifier hs-var">defaultReplFlags</span></a><span class="hs-special">,</span><span>     </span><a href="Distribution.Simple.Setup.html#replCommand"><span class="hs-identifier hs-var">replCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>  </span><a href="Distribution.Simple.Setup.html#CleanFlags"><span class="hs-identifier hs-type">CleanFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>    </span><a href="Distribution.Simple.Setup.html#emptyCleanFlags"><span class="hs-identifier hs-var">emptyCleanFlags</span></a><span class="hs-special">,</span><span>    </span><a href="Distribution.Simple.Setup.html#defaultCleanFlags"><span class="hs-identifier hs-var">defaultCleanFlags</span></a><span class="hs-special">,</span><span>    </span><a href="Distribution.Simple.Setup.html#cleanCommand"><span class="hs-identifier hs-var">cleanCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>  </span><a href="Distribution.Simple.Setup.html#RegisterFlags"><span class="hs-identifier hs-type">RegisterFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#emptyRegisterFlags"><span class="hs-identifier hs-var">emptyRegisterFlags</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#defaultRegisterFlags"><span class="hs-identifier hs-var">defaultRegisterFlags</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#registerCommand"><span class="hs-identifier hs-var">registerCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>                                                               </span><a href="Distribution.Simple.Setup.html#unregisterCommand"><span class="hs-identifier hs-var">unregisterCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>  </span><a href="Distribution.Simple.Setup.html#SDistFlags"><span class="hs-identifier hs-type">SDistFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>    </span><a href="Distribution.Simple.Setup.html#emptySDistFlags"><span class="hs-identifier hs-var">emptySDistFlags</span></a><span class="hs-special">,</span><span>    </span><a href="Distribution.Simple.Setup.html#defaultSDistFlags"><span class="hs-identifier hs-var">defaultSDistFlags</span></a><span class="hs-special">,</span><span>    </span><a href="Distribution.Simple.Setup.html#sdistCommand"><span class="hs-identifier hs-var">sdistCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>  </span><a href="Distribution.Simple.Setup.html#TestFlags"><span class="hs-identifier hs-type">TestFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>     </span><a href="Distribution.Simple.Setup.html#emptyTestFlags"><span class="hs-identifier hs-var">emptyTestFlags</span></a><span class="hs-special">,</span><span>     </span><a href="Distribution.Simple.Setup.html#defaultTestFlags"><span class="hs-identifier hs-var">defaultTestFlags</span></a><span class="hs-special">,</span><span>     </span><a href="Distribution.Simple.Setup.html#testCommand"><span class="hs-identifier hs-var">testCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>  </span><a href="Distribution.Simple.Setup.html#TestShowDetails"><span class="hs-identifier hs-type">TestShowDetails</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>  </span><a href="Distribution.Simple.Setup.html#BenchmarkFlags"><span class="hs-identifier hs-type">BenchmarkFlags</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#emptyBenchmarkFlags"><span class="hs-identifier hs-var">emptyBenchmarkFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>  </span><a href="Distribution.Simple.Setup.html#defaultBenchmarkFlags"><span class="hs-identifier hs-var">defaultBenchmarkFlags</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#benchmarkCommand"><span class="hs-identifier hs-var">benchmarkCommand</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>  </span><a href="Distribution.Simple.InstallDirs.html#CopyDest"><span class="hs-identifier hs-type">CopyDest</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>  </span><a href="Distribution.Simple.Setup.html#configureArgs"><span class="hs-identifier hs-var">configureArgs</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#configureOptions"><span class="hs-identifier hs-var">configureOptions</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#configureCCompiler"><span class="hs-identifier hs-var">configureCCompiler</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#configureLinker"><span class="hs-identifier hs-var">configureLinker</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>  </span><a href="Distribution.Simple.Setup.html#buildOptions"><span class="hs-identifier hs-var">buildOptions</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#haddockOptions"><span class="hs-identifier hs-var">haddockOptions</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#installDirsOptions"><span class="hs-identifier hs-var">installDirsOptions</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>  </span><a href="Distribution.Simple.Setup.html#programDbOptions"><span class="hs-identifier hs-var">programDbOptions</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#programDbPaths%27"><span class="hs-identifier hs-var">programDbPaths'</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>  </span><a href="Distribution.Simple.Setup.html#programConfigurationOptions"><span class="hs-identifier hs-var">programConfigurationOptions</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#programConfigurationPaths%27"><span class="hs-identifier hs-var">programConfigurationPaths'</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>  </span><a href="Distribution.Simple.Setup.html#programFlagsDescription"><span class="hs-identifier hs-var">programFlagsDescription</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>  </span><a href="Distribution.Simple.Setup.html#replOptions"><span class="hs-identifier hs-var">replOptions</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>  </span><a href="Distribution.Simple.Setup.html#splitArgs"><span class="hs-identifier hs-var">splitArgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>  </span><a href="Distribution.Simple.Setup.html#defaultDistPref"><span class="hs-identifier hs-var">defaultDistPref</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#optionDistPref"><span class="hs-identifier hs-var">optionDistPref</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span>  </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>  </span><a href="Distribution.Simple.Flag.html#toFlag"><span class="hs-identifier hs-var">toFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>  </span><a href="Distribution.Simple.Flag.html#fromFlag"><span class="hs-identifier hs-var">fromFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>  </span><a href="Distribution.Simple.Flag.html#fromFlagOrDefault"><span class="hs-identifier hs-var">fromFlagOrDefault</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>  </span><a href="Distribution.Simple.Flag.html#flagToMaybe"><span class="hs-identifier hs-var">flagToMaybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-74"></a><span>  </span><a href="Distribution.Simple.Flag.html#flagToList"><span class="hs-identifier hs-var">flagToList</span></a><span class="hs-special">,</span><span>
</span><a name="line-75"></a><span>  </span><a href="Distribution.Simple.Flag.html#maybeToFlag"><span class="hs-identifier hs-var">maybeToFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>  </span><a href="Distribution.Simple.Flag.html#BooleanFlag"><span class="hs-identifier hs-type">BooleanFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>  </span><a href="Distribution.Simple.Setup.html#boolOpt"><span class="hs-identifier hs-var">boolOpt</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#boolOpt%27"><span class="hs-identifier hs-var">boolOpt'</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#trueArg"><span class="hs-identifier hs-var">trueArg</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#falseArg"><span class="hs-identifier hs-var">falseArg</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>  </span><a href="Distribution.Simple.Setup.html#optionVerbosity"><span class="hs-identifier hs-var">optionVerbosity</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Setup.html#optionNumJobs"><span class="hs-identifier hs-var">optionNumJobs</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.ParseUtils.html#readPToMaybe"><span class="hs-identifier hs-var">readPToMaybe</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Compat.Prelude.html"><span class="hs-identifier">Distribution.Compat.Prelude</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">get</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Compiler.html"><span class="hs-identifier">Distribution.Compiler</span></a><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.ReadE.html"><span class="hs-identifier">Distribution.ReadE</span></a><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Text.html"><span class="hs-identifier">Distribution.Text</span></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Parsec.Class.html"><span class="hs-identifier">Distribution.Parsec.Class</span></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Pretty.html"><span class="hs-identifier">Distribution.Pretty</span></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Compat.ReadP.html"><span class="hs-identifier">Distribution.Compat.ReadP</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Parse</span><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Compat.CharParsing.html"><span class="hs-identifier">Distribution.Compat.CharParsing</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">P</span><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.ParseUtils.html"><span class="hs-identifier">Distribution.ParseUtils</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.ParseUtils.html#readPToMaybe"><span class="hs-identifier hs-var">readPToMaybe</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Text.PrettyPrint</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Disp</span><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.ModuleName.html"><span class="hs-identifier">Distribution.ModuleName</span></a><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.PackageDescription.html"><span class="hs-identifier">Distribution.PackageDescription</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.GenericPackageDescription.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Command.html"><span class="hs-identifier">Distribution.Simple.Command</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Command.html#boolOpt"><span class="hs-identifier hs-var">boolOpt</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Command.html#boolOpt%27"><span class="hs-identifier hs-var">boolOpt'</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.Command.html"><span class="hs-identifier">Distribution.Simple.Command</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Command</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Compiler.html"><span class="hs-identifier">Distribution.Simple.Compiler</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Flag.html"><span class="hs-identifier">Distribution.Simple.Flag</span></a><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Utils.html"><span class="hs-identifier">Distribution.Simple.Utils</span></a><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Program.html"><span class="hs-identifier">Distribution.Simple.Program</span></a><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.InstallDirs.html"><span class="hs-identifier">Distribution.Simple.InstallDirs</span></a><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Verbosity.html"><span class="hs-identifier">Distribution.Verbosity</span></a><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Utils.NubList.html"><span class="hs-identifier">Distribution.Utils.NubList</span></a><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.Dependency.html"><span class="hs-identifier">Distribution.Types.Dependency</span></a><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.ComponentId.html"><span class="hs-identifier">Distribution.Types.ComponentId</span></a><span>
</span><a name="line-105"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.Module.html"><span class="hs-identifier">Distribution.Types.Module</span></a><span>
</span><a name="line-106"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.PackageName.html"><span class="hs-identifier">Distribution.Types.PackageName</span></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Compat.Stack.html"><span class="hs-identifier">Distribution.Compat.Stack</span></a><span>
</span><a name="line-109"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Compat.Semigroup.html"><span class="hs-identifier">Distribution.Compat.Semigroup</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Compat.Semigroup.html#Last%27"><span class="hs-identifier hs-type">Last'</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Function</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">on</span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-comment">-- FIXME Not sure where this should live</span><span>
</span><a name="line-114"></a><span class="hs-identifier">defaultDistPref</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-115"></a><a name="defaultDistPref"><a href="Distribution.Simple.Setup.html#defaultDistPref"><span class="hs-identifier">defaultDistPref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;dist&quot;</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-comment">-- ------------------------------------------------------------</span><span>
</span><a name="line-118"></a><span class="hs-comment">-- * Global flags</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- ------------------------------------------------------------</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">-- In fact since individual flags types are monoids and these are just sets of</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- flags then they are also monoids pointwise. This turns out to be really</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- useful. The mempty is the set of empty flags and mappend allows us to</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- override specific flags. For example we can start with default flags and</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- override with the ones we get from a file or the command line, or both.</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- | Flags that apply at the top level, not to any sub-command.</span><span>
</span><a name="line-128"></a><span class="hs-keyword">data</span><span> </span><a name="GlobalFlags"><a href="Distribution.Simple.Setup.html#GlobalFlags"><span class="hs-identifier">GlobalFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GlobalFlags"><a href="Distribution.Simple.Setup.html#GlobalFlags"><span class="hs-identifier">GlobalFlags</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-129"></a><span>    </span><a name="globalVersion"><a href="Distribution.Simple.Setup.html#globalVersion"><span class="hs-identifier">globalVersion</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>
</span><a name="line-130"></a><span>    </span><a name="globalNumericVersion"><a href="Distribution.Simple.Setup.html#globalNumericVersion"><span class="hs-identifier">globalNumericVersion</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-131"></a><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-identifier">defaultGlobalFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Setup.html#GlobalFlags"><span class="hs-identifier hs-type">GlobalFlags</span></a><span>
</span><a name="line-134"></a><a name="defaultGlobalFlags"><a href="Distribution.Simple.Setup.html#defaultGlobalFlags"><span class="hs-identifier">defaultGlobalFlags</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#GlobalFlags"><span class="hs-identifier hs-var">GlobalFlags</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-identifier">globalVersion</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-identifier">globalNumericVersion</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-137"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-identifier">globalCommand</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Command.html#Command"><span class="hs-identifier hs-type">Command</span></a><span> </span><a href="#local-6989586621679374738"><span class="hs-identifier hs-type">action</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Command.html#CommandUI"><span class="hs-identifier hs-type">CommandUI</span></a><span> </span><a href="Distribution.Simple.Setup.html#GlobalFlags"><span class="hs-identifier hs-type">GlobalFlags</span></a><span>
</span><a name="line-140"></a><a name="globalCommand"><a href="Distribution.Simple.Setup.html#globalCommand"><span class="hs-identifier">globalCommand</span></a></a><span> </span><a name="local-6989586621679374739"><a href="#local-6989586621679374739"><span class="hs-identifier">commands</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Command.html#CommandUI"><span class="hs-identifier hs-var">CommandUI</span></a><span>
</span><a name="line-141"></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">commandName</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">commandSynopsis</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">commandUsage</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679374740"><a href="#local-6989586621679374740"><span class="hs-identifier">pname</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-144"></a><span>         </span><span class="hs-string">&quot;This Setup program uses the Haskell Cabal Infrastructure.\n&quot;</span><span>
</span><a name="line-145"></a><span>      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;See http://www.haskell.org/cabal/ for more information.\n&quot;</span><span>
</span><a name="line-146"></a><span>      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span>
</span><a name="line-147"></a><span>      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;Usage: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679374740"><span class="hs-identifier hs-var">pname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; [GLOBAL FLAGS] [COMMAND [FLAGS]]\n&quot;</span><span>
</span><a name="line-148"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">commandDescription</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679374741"><a href="#local-6989586621679374741"><span class="hs-identifier">pname</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-149"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-150"></a><span>        </span><a name="local-6989586621679374742"><a href="#local-6989586621679374742"><span class="hs-identifier">commands'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679374739"><span class="hs-identifier hs-var">commands</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Command.html#commandAddAction"><span class="hs-identifier hs-var">commandAddAction</span></a><span> </span><a href="Distribution.Simple.Command.html#helpCommandUI"><span class="hs-identifier hs-var">helpCommandUI</span></a><span> </span><span class="hs-identifier hs-var">undefined</span><span class="hs-special">]</span><span>
</span><a name="line-151"></a><span>        </span><a name="local-6989586621679374743"><a href="#local-6989586621679374743"><span class="hs-identifier">cmdDescs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Command.html#getNormalCommandDescriptions"><span class="hs-identifier hs-var">getNormalCommandDescriptions</span></a><span> </span><a href="#local-6989586621679374742"><span class="hs-identifier hs-var">commands'</span></a><span>
</span><a name="line-152"></a><span>        </span><a name="local-6989586621679374744"><a href="#local-6989586621679374744"><span class="hs-identifier">maxlen</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maximum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679374746"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679374746"><a href="#local-6989586621679374746"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679374743"><span class="hs-identifier hs-var">cmdDescs</span></a><span class="hs-special">]</span><span>
</span><a name="line-153"></a><span>        </span><a name="local-6989586621679374745"><a href="#local-6989586621679374745"><span class="hs-identifier">align</span></a></a><span> </span><a name="local-6989586621679374747"><a href="#local-6989586621679374747"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679374747"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679374744"><span class="hs-identifier hs-var">maxlen</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679374747"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span> </span><span class="hs-char">' '</span><span>
</span><a name="line-154"></a><span>      </span><span class="hs-keyword">in</span><span>
</span><a name="line-155"></a><span>         </span><span class="hs-string">&quot;Commands:\n&quot;</span><span>
</span><a name="line-156"></a><span>      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;  &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679374745"><span class="hs-identifier hs-var">align</span></a><span> </span><a href="#local-6989586621679374748"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;    &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679374749"><span class="hs-identifier hs-var">descr</span></a><span>
</span><a name="line-157"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679374748"><a href="#local-6989586621679374748"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679374749"><a href="#local-6989586621679374749"><span class="hs-identifier">descr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679374743"><span class="hs-identifier hs-var">cmdDescs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-158"></a><span>      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span>
</span><a name="line-159"></a><span>      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;For more information about a command use\n&quot;</span><span>
</span><a name="line-160"></a><span>      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;  &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679374741"><span class="hs-identifier hs-var">pname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; COMMAND --help\n\n&quot;</span><span>
</span><a name="line-161"></a><span>      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;Typical steps for installing Cabal packages:\n&quot;</span><span>
</span><a name="line-162"></a><span>      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;  &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679374741"><span class="hs-identifier hs-var">pname</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679374750"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span>
</span><a name="line-163"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679374750"><a href="#local-6989586621679374750"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;configure&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;build&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;install&quot;</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-164"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">commandNotes</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-165"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">commandDefaultFlags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#defaultGlobalFlags"><span class="hs-identifier hs-var">defaultGlobalFlags</span></a><span>
</span><a name="line-166"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">commandOptions</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-167"></a><span>      </span><span class="hs-special">[</span><a href="Distribution.Simple.Command.html#option"><span class="hs-identifier hs-var">option</span></a><span> </span><span class="hs-special">[</span><span class="hs-char">'V'</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;version&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-168"></a><span>         </span><span class="hs-string">&quot;Print version information&quot;</span><span>
</span><a name="line-169"></a><span>         </span><span class="hs-identifier">globalVersion</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679374751"><a href="#local-6989586621679374751"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679374752"><a href="#local-6989586621679374752"><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679374752"><span class="hs-identifier hs-var">flags</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">globalVersion</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679374751"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>         </span><a href="Distribution.Simple.Setup.html#trueArg"><span class="hs-identifier hs-var">trueArg</span></a><span>
</span><a name="line-171"></a><span>      </span><span class="hs-special">,</span><a href="Distribution.Simple.Command.html#option"><span class="hs-identifier hs-var">option</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;numeric-version&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-172"></a><span>         </span><span class="hs-string">&quot;Print just the version number&quot;</span><span>
</span><a name="line-173"></a><span>         </span><span class="hs-identifier">globalNumericVersion</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679374753"><a href="#local-6989586621679374753"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679374754"><a href="#local-6989586621679374754"><span class="hs-identifier">flags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679374754"><span class="hs-identifier hs-var">flags</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">globalNumericVersion</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679374753"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>         </span><a href="Distribution.Simple.Setup.html#trueArg"><span class="hs-identifier hs-var">trueArg</span></a><span>
</span><a name="line-175"></a><span>      </span><span class="hs-special">]</span><span>
</span><a name="line-176"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-identifier">emptyGlobalFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Setup.html#GlobalFlags"><span class="hs-identifier hs-type">GlobalFlags</span></a><span>
</span><a name="line-179"></a><a name="emptyGlobalFlags"><a href="Distribution.Simple.Setup.html#emptyGlobalFlags"><span class="hs-identifier">emptyGlobalFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="Distribution.Simple.Setup.html#GlobalFlags"><span class="hs-identifier hs-type">GlobalFlags</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-182"></a><span>  </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Compat.Semigroup.html#gmempty"><span class="hs-identifier hs-var">gmempty</span></a><span>
</span><a name="line-183"></a><span>  </span><a name="local-3458764513820541484"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><a href="Distribution.Simple.Setup.html#GlobalFlags"><span class="hs-identifier hs-type">GlobalFlags</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-186"></a><span>  </span><span class="hs-special">(</span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Compat.Semigroup.html#gmappend"><span class="hs-identifier hs-var">gmappend</span></a><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-comment">-- ------------------------------------------------------------</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- * Config flags</span><span>
</span><a name="line-190"></a><span class="hs-comment">-- ------------------------------------------------------------</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- | Flags to @configure@ command.</span><span>
</span><a name="line-193"></a><span class="hs-comment">--</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- IMPORTANT: every time a new flag is added, 'D.C.Setup.filterConfigureFlags'</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- should be updated.</span><span>
</span><a name="line-196"></a><span class="hs-comment">-- IMPORTANT: every time a new flag is added, it should be added to the Eq instance</span><span>
</span><a name="line-197"></a><span class="hs-keyword">data</span><span> </span><a name="ConfigFlags"><a href="Distribution.Simple.Setup.html#ConfigFlags"><span class="hs-identifier">ConfigFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ConfigFlags"><a href="Distribution.Simple.Setup.html#ConfigFlags"><span class="hs-identifier">ConfigFlags</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-comment">-- This is the same hack as in 'buildArgs' and 'copyArgs'.</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-comment">-- TODO: Stop using this eventually when 'UserHooks' gets changed</span><span>
</span><a name="line-200"></a><span>    </span><a name="configArgs"><a href="Distribution.Simple.Setup.html#configArgs"><span class="hs-identifier">configArgs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span>    </span><span class="hs-comment">--FIXME: the configPrograms is only here to pass info through to configure</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-comment">-- because the type of configure is constrained by the UserHooks.</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-comment">-- when we change UserHooks next we should pass the initial</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-comment">-- ProgramDb directly and not via ConfigFlags</span><span>
</span><a name="line-206"></a><span>    </span><a name="configPrograms_"><a href="Distribution.Simple.Setup.html#configPrograms_"><span class="hs-identifier">configPrograms_</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Compat.Semigroup.html#Last%27"><span class="hs-identifier hs-type">Last'</span></a><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^All programs that</span><span>
</span><a name="line-207"></a><span>                                            </span><span class="hs-comment">-- @cabal@ may run</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span>    </span><a name="configProgramPaths"><a href="Distribution.Simple.Setup.html#configProgramPaths"><span class="hs-identifier">configProgramPaths</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^user specified programs paths</span><span>
</span><a name="line-210"></a><span>    </span><a name="configProgramArgs"><a href="Distribution.Simple.Setup.html#configProgramArgs"><span class="hs-identifier">configProgramArgs</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^user specified programs args</span><span>
</span><a name="line-211"></a><span>    </span><a name="configProgramPathExtra"><a href="Distribution.Simple.Setup.html#configProgramPathExtra"><span class="hs-identifier">configProgramPathExtra</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Utils.NubList.html#NubList"><span class="hs-identifier hs-type">NubList</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^Extend the $PATH</span><span>
</span><a name="line-212"></a><span>    </span><a name="configHcFlavor"><a href="Distribution.Simple.Setup.html#configHcFlavor"><span class="hs-identifier">configHcFlavor</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="Distribution.Compiler.html#CompilerFlavor"><span class="hs-identifier hs-type">CompilerFlavor</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^The \&quot;flavor\&quot; of the</span><span>
</span><a name="line-213"></a><span>                                                </span><span class="hs-comment">-- compiler, e.g. GHC.</span><span>
</span><a name="line-214"></a><span>    </span><a name="configHcPath"><a href="Distribution.Simple.Setup.html#configHcPath"><span class="hs-identifier">configHcPath</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^given compiler location</span><span>
</span><a name="line-215"></a><span>    </span><a name="configHcPkg"><a href="Distribution.Simple.Setup.html#configHcPkg"><span class="hs-identifier">configHcPkg</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^given hc-pkg location</span><span>
</span><a name="line-216"></a><span>    </span><a name="configVanillaLib"><a href="Distribution.Simple.Setup.html#configVanillaLib"><span class="hs-identifier">configVanillaLib</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^Enable vanilla library</span><span>
</span><a name="line-217"></a><span>    </span><a name="configProfLib"><a href="Distribution.Simple.Setup.html#configProfLib"><span class="hs-identifier">configProfLib</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^Enable profiling in the library</span><span>
</span><a name="line-218"></a><span>    </span><a name="configSharedLib"><a href="Distribution.Simple.Setup.html#configSharedLib"><span class="hs-identifier">configSharedLib</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^Build shared library</span><span>
</span><a name="line-219"></a><span>    </span><a name="configStaticLib"><a href="Distribution.Simple.Setup.html#configStaticLib"><span class="hs-identifier">configStaticLib</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^Build static library</span><span>
</span><a name="line-220"></a><span>    </span><a name="configDynExe"><a href="Distribution.Simple.Setup.html#configDynExe"><span class="hs-identifier">configDynExe</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^Enable dynamic linking of the</span><span>
</span><a name="line-221"></a><span>                                          </span><span class="hs-comment">-- executables.</span><span>
</span><a name="line-222"></a><span>    </span><a name="configProfExe"><a href="Distribution.Simple.Setup.html#configProfExe"><span class="hs-identifier">configProfExe</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^Enable profiling in the</span><span>
</span><a name="line-223"></a><span>                                          </span><span class="hs-comment">-- executables.</span><span>
</span><a name="line-224"></a><span>    </span><a name="configProf"><a href="Distribution.Simple.Setup.html#configProf"><span class="hs-identifier">configProf</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^Enable profiling in the library</span><span>
</span><a name="line-225"></a><span>                                          </span><span class="hs-comment">-- and executables.</span><span>
</span><a name="line-226"></a><span>    </span><a name="configProfDetail"><a href="Distribution.Simple.Setup.html#configProfDetail"><span class="hs-identifier">configProfDetail</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="Distribution.Simple.Compiler.html#ProfDetailLevel"><span class="hs-identifier hs-type">ProfDetailLevel</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Profiling detail level</span><span>
</span><a name="line-227"></a><span>                                          </span><span class="hs-comment">--  in the library and executables.</span><span>
</span><a name="line-228"></a><span>    </span><a name="configProfLibDetail"><a href="Distribution.Simple.Setup.html#configProfLibDetail"><span class="hs-identifier">configProfLibDetail</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="Distribution.Simple.Compiler.html#ProfDetailLevel"><span class="hs-identifier hs-type">ProfDetailLevel</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Profiling  detail level</span><span>
</span><a name="line-229"></a><span>                                                 </span><span class="hs-comment">-- in the library</span><span>
</span><a name="line-230"></a><span>    </span><a name="configConfigureArgs"><a href="Distribution.Simple.Setup.html#configConfigureArgs"><span class="hs-identifier">configConfigureArgs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- ^Extra arguments to @configure@</span><span>
</span><a name="line-231"></a><span>    </span><a name="configOptimization"><a href="Distribution.Simple.Setup.html#configOptimization"><span class="hs-identifier">configOptimization</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="Distribution.Simple.Compiler.html#OptimisationLevel"><span class="hs-identifier hs-type">OptimisationLevel</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^Enable optimization.</span><span>
</span><a name="line-232"></a><span>    </span><a name="configProgPrefix"><a href="Distribution.Simple.Setup.html#configProgPrefix"><span class="hs-identifier">configProgPrefix</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="Distribution.Simple.InstallDirs.html#PathTemplate"><span class="hs-identifier hs-type">PathTemplate</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Installed executable prefix.</span><span>
</span><a name="line-233"></a><span>    </span><a name="configProgSuffix"><a href="Distribution.Simple.Setup.html#configProgSuffix"><span class="hs-identifier">configProgSuffix</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="Distribution.Simple.InstallDirs.html#PathTemplate"><span class="hs-identifier hs-type">PathTemplate</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Installed executable suffix.</span><span>
</span><a name="line-234"></a><span>    </span><a name="configInstallDirs"><a href="Distribution.Simple.Setup.html#configInstallDirs"><span class="hs-identifier">configInstallDirs</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.InstallDirs.html#InstallDirs"><span class="hs-identifier hs-type">InstallDirs</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="Distribution.Simple.InstallDirs.html#PathTemplate"><span class="hs-identifier hs-type">PathTemplate</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Installation</span><span>
</span><a name="line-235"></a><span>                                                            </span><span class="hs-comment">-- paths</span><span>
</span><a name="line-236"></a><span>    </span><a name="configScratchDir"><a href="Distribution.Simple.Setup.html#configScratchDir"><span class="hs-identifier">configScratchDir</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span>
</span><a name="line-237"></a><span>    </span><a name="configExtraLibDirs"><a href="Distribution.Simple.Setup.html#configExtraLibDirs"><span class="hs-identifier">configExtraLibDirs</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ path to search for extra libraries</span><span>
</span><a name="line-238"></a><span>    </span><a name="configExtraFrameworkDirs"><a href="Distribution.Simple.Setup.html#configExtraFrameworkDirs"><span class="hs-identifier">configExtraFrameworkDirs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ path to search for extra</span><span>
</span><a name="line-239"></a><span>                                              </span><span class="hs-comment">-- frameworks (OS X only)</span><span>
</span><a name="line-240"></a><span>    </span><a name="configExtraIncludeDirs"><a href="Distribution.Simple.Setup.html#configExtraIncludeDirs"><span class="hs-identifier">configExtraIncludeDirs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ path to search for header files</span><span>
</span><a name="line-241"></a><span>    </span><a name="configIPID"><a href="Distribution.Simple.Setup.html#configIPID"><span class="hs-identifier">configIPID</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ explicit IPID to be used</span><span>
</span><a name="line-242"></a><span>    </span><a name="configCID"><a href="Distribution.Simple.Setup.html#configCID"><span class="hs-identifier">configCID</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="Distribution.Types.ComponentId.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ explicit CID to be used</span><span>
</span><a name="line-243"></a><span>    </span><a name="configDeterministic"><a href="Distribution.Simple.Setup.html#configDeterministic"><span class="hs-identifier">configDeterministic</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ be as deterministic as possible</span><span>
</span><a name="line-244"></a><span>                                      </span><span class="hs-comment">-- (e.g., invariant over GHC, database,</span><span>
</span><a name="line-245"></a><span>                                      </span><span class="hs-comment">-- etc).  Used by the test suite</span><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span>    </span><a name="configDistPref"><a href="Distribution.Simple.Setup.html#configDistPref"><span class="hs-identifier">configDistPref</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^&quot;dist&quot; prefix</span><span>
</span><a name="line-248"></a><span>    </span><a name="configCabalFilePath"><a href="Distribution.Simple.Setup.html#configCabalFilePath"><span class="hs-identifier">configCabalFilePath</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Cabal file to use</span><span>
</span><a name="line-249"></a><span>    </span><a name="configVerbosity"><a href="Distribution.Simple.Setup.html#configVerbosity"><span class="hs-identifier">configVerbosity</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^verbosity level</span><span>
</span><a name="line-250"></a><span>    </span><a name="configUserInstall"><a href="Distribution.Simple.Setup.html#configUserInstall"><span class="hs-identifier">configUserInstall</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- ^The --user\/--global flag</span><span>
</span><a name="line-251"></a><span>    </span><a name="configPackageDBs"><a href="Distribution.Simple.Setup.html#configPackageDBs"><span class="hs-identifier">configPackageDBs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Distribution.Simple.Compiler.html#PackageDB"><span class="hs-identifier hs-type">PackageDB</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Which package DBs to use</span><span>
</span><a name="line-252"></a><span>    </span><a name="configGHCiLib"><a href="Distribution.Simple.Setup.html#configGHCiLib"><span class="hs-identifier">configGHCiLib</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- ^Enable compiling library for GHCi</span><span>
</span><a name="line-253"></a><span>    </span><a name="configSplitSections"><a href="Distribution.Simple.Setup.html#configSplitSections"><span class="hs-identifier">configSplitSections</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- ^Enable -split-sections with GHC</span><span>
</span><a name="line-254"></a><span>    </span><a name="configSplitObjs"><a href="Distribution.Simple.Setup.html#configSplitObjs"><span class="hs-identifier">configSplitObjs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- ^Enable -split-objs with GHC</span><span>
</span><a name="line-255"></a><span>    </span><a name="configStripExes"><a href="Distribution.Simple.Setup.html#configStripExes"><span class="hs-identifier">configStripExes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- ^Enable executable stripping</span><span>
</span><a name="line-256"></a><span>    </span><a name="configStripLibs"><a href="Distribution.Simple.Setup.html#configStripLibs"><span class="hs-identifier">configStripLibs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- ^Enable library stripping</span><span>
</span><a name="line-257"></a><span>    </span><a name="configConstraints"><a href="Distribution.Simple.Setup.html#configConstraints"><span class="hs-identifier">configConstraints</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Distribution.Types.Dependency.html#Dependency"><span class="hs-identifier hs-type">Dependency</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Additional constraints for</span><span>
</span><a name="line-258"></a><span>                                       </span><span class="hs-comment">-- dependencies.</span><span>
</span><a name="line-259"></a><span>    </span><a name="configDependencies"><a href="Distribution.Simple.Setup.html#configDependencies"><span class="hs-identifier">configDependencies</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Distribution.Types.PackageName.html#PackageName"><span class="hs-identifier hs-type">PackageName</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Types.ComponentId.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-260"></a><span>      </span><span class="hs-comment">-- ^The packages depended on.</span><span>
</span><a name="line-261"></a><span>    </span><a name="configInstantiateWith"><a href="Distribution.Simple.Setup.html#configInstantiateWith"><span class="hs-identifier">configInstantiateWith</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Distribution.ModuleName.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Types.Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-262"></a><span>      </span><span class="hs-comment">-- ^ The requested Backpack instantiation.  If empty, either this</span><span>
</span><a name="line-263"></a><span>      </span><span class="hs-comment">-- package does not use Backpack, or we just want to typecheck</span><span>
</span><a name="line-264"></a><span>      </span><span class="hs-comment">-- the indefinite package.</span><span>
</span><a name="line-265"></a><span>    </span><a name="configConfigurationsFlags"><a href="Distribution.Simple.Setup.html#configConfigurationsFlags"><span class="hs-identifier">configConfigurationsFlags</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.GenericPackageDescription.html#FlagAssignment"><span class="hs-identifier hs-type">FlagAssignment</span></a><span class="hs-special">,</span><span>
</span><a name="line-266"></a><span>    </span><a name="configTests"><a href="Distribution.Simple.Setup.html#configTests"><span class="hs-identifier">configTests</span></a></a><span>               </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Enable test suite compilation</span><span>
</span><a name="line-267"></a><span>    </span><a name="configBenchmarks"><a href="Distribution.Simple.Setup.html#configBenchmarks"><span class="hs-identifier">configBenchmarks</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Enable benchmark compilation</span><span>
</span><a name="line-268"></a><span>    </span><a name="configCoverage"><a href="Distribution.Simple.Setup.html#configCoverage"><span class="hs-identifier">configCoverage</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Enable program coverage</span><span>
</span><a name="line-269"></a><span>    </span><a name="configLibCoverage"><a href="Distribution.Simple.Setup.html#configLibCoverage"><span class="hs-identifier">configLibCoverage</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^Enable program coverage (deprecated)</span><span>
</span><a name="line-270"></a><span>    </span><a name="configExactConfiguration"><a href="Distribution.Simple.Setup.html#configExactConfiguration"><span class="hs-identifier">configExactConfiguration</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>
</span><a name="line-271"></a><span>      </span><span class="hs-comment">-- ^All direct dependencies and flags are provided on the command line by</span><span>
</span><a name="line-272"></a><span>      </span><span class="hs-comment">-- the user via the '--dependency' and '--flags' options.</span><span>
</span><a name="line-273"></a><span>    </span><a name="configFlagError"><a href="Distribution.Simple.Setup.html#configFlagError"><span class="hs-identifier">configFlagError</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span>
</span><a name="line-274"></a><span>      </span><span class="hs-comment">-- ^Halt and show an error message indicating an error in flag assignment</span><span>
</span><a name="line-275"></a><span>    </span><a name="configRelocatable"><a href="Distribution.Simple.Setup.html#configRelocatable"><span class="hs-identifier">configRelocatable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Enable relocatable package built</span><span>
</span><a name="line-276"></a><span>    </span><a name="configDebugInfo"><a href="Distribution.Simple.Setup.html#configDebugInfo"><span class="hs-identifier">configDebugInfo</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="Distribution.Simple.Compiler.html#DebugInfoLevel"><span class="hs-identifier hs-type">DebugInfoLevel</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^ Emit debug info.</span><span>
</span><a name="line-277"></a><span>    </span><a name="configUseResponseFiles"><a href="Distribution.Simple.Setup.html#configUseResponseFiles"><span class="hs-identifier">configUseResponseFiles</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-278"></a><span>      </span><span class="hs-comment">-- ^ Whether to use response files at all. They're used for such tools</span><span>
</span><a name="line-279"></a><span>      </span><span class="hs-comment">-- as haddock, or or ld.</span><span>
</span><a name="line-280"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-281"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Read</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="Distribution.Simple.Setup.html#ConfigFlags"><span class="hs-identifier hs-type">ConfigFlags</span></a><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span class="hs-comment">-- | More convenient version of 'configPrograms'. Results in an</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- 'error' if internal invariant is violated.</span><span>
</span><a name="line-287"></a><span class="hs-identifier">configPrograms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Compat.Stack.html#WithCallStack"><span class="hs-identifier hs-type">WithCallStack</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Setup.html#ConfigFlags"><span class="hs-identifier hs-type">ConfigFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span class="hs-special">)</span><span>
</span><a name="line-288"></a><a name="configPrograms"><a href="Distribution.Simple.Setup.html#configPrograms"><span class="hs-identifier">configPrograms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;FIXME: remove configPrograms&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getLast'</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">configPrograms_</span><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="Distribution.Simple.Setup.html#ConfigFlags"><span class="hs-identifier hs-type">ConfigFlags</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-291"></a><span>  </span><span class="hs-special">(</span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679374723"><a href="#local-6989586621679374723"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679374724"><a href="#local-6989586621679374724"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-292"></a><span>    </span><span class="hs-comment">-- configPrograms skipped: not user specified, has no Eq instance</span><span>
</span><a name="line-293"></a><span>    </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configProgramPaths</span><span>
</span><a name="line-294"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configProgramArgs</span><span>
</span><a name="line-295"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configProgramPathExtra</span><span>
</span><a name="line-296"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configHcFlavor</span><span>
</span><a name="line-297"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configHcPath</span><span>
</span><a name="line-298"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configHcPkg</span><span>
</span><a name="line-299"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configVanillaLib</span><span>
</span><a name="line-300"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configProfLib</span><span>
</span><a name="line-301"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configSharedLib</span><span>
</span><a name="line-302"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configStaticLib</span><span>
</span><a name="line-303"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configDynExe</span><span>
</span><a name="line-304"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configProfExe</span><span>
</span><a name="line-305"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configProf</span><span>
</span><a name="line-306"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configProfDetail</span><span>
</span><a name="line-307"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configProfLibDetail</span><span>
</span><a name="line-308"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configConfigureArgs</span><span>
</span><a name="line-309"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configOptimization</span><span>
</span><a name="line-310"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configProgPrefix</span><span>
</span><a name="line-311"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configProgSuffix</span><span>
</span><a name="line-312"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configInstallDirs</span><span>
</span><a name="line-313"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configScratchDir</span><span>
</span><a name="line-314"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configExtraLibDirs</span><span>
</span><a name="line-315"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configExtraIncludeDirs</span><span>
</span><a name="line-316"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configIPID</span><span>
</span><a name="line-317"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configDeterministic</span><span>
</span><a name="line-318"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configDistPref</span><span>
</span><a name="line-319"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configVerbosity</span><span>
</span><a name="line-320"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configUserInstall</span><span>
</span><a name="line-321"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configPackageDBs</span><span>
</span><a name="line-322"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configGHCiLib</span><span>
</span><a name="line-323"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configSplitSections</span><span>
</span><a name="line-324"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configSplitObjs</span><span>
</span><a name="line-325"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configStripExes</span><span>
</span><a name="line-326"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configStripLibs</span><span>
</span><a name="line-327"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configConstraints</span><span>
</span><a name="line-328"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configDependencies</span><span>
</span><a name="line-329"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configConfigurationsFlags</span><span>
</span><a name="line-330"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configTests</span><span>
</span><a name="line-331"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configBenchmarks</span><span>
</span><a name="line-332"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configCoverage</span><span>
</span><a name="line-333"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configLibCoverage</span><span>
</span><a name="line-334"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configExactConfiguration</span><span>
</span><a name="line-335"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configFlagError</span><span>
</span><a name="line-336"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configRelocatable</span><span>
</span><a name="line-337"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configDebugInfo</span><span>
</span><a name="line-338"></a><span>    </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679374725"><span class="hs-identifier hs-var">equal</span></a><span> </span><span class="hs-identifier">configUseResponseFiles</span><span>
</span><a name="line-339"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-340"></a><span>      </span><a name="local-6989586621679374725"><a href="#local-6989586621679374725"><span class="hs-identifier">equal</span></a></a><span> </span><a name="local-6989586621679374726"><a href="#local-6989586621679374726"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">on</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679374726"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679374723"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679374724"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-identifier">configAbsolutePaths</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Setup.html#ConfigFlags"><span class="hs-identifier hs-type">ConfigFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#NoCallStackIO"><span class="hs-identifier hs-type">NoCallStackIO</span></a><span> </span><a href="Distribution.Simple.Setup.html#ConfigFlags"><span class="hs-identifier hs-type">ConfigFlags</span></a><span>
</span><a name="line-343"></a><a name="configAbsolutePaths"><a href="Distribution.Simple.Setup.html#configAbsolutePaths"><span class="hs-identifier">configAbsolutePaths</span></a></a><span> </span><a name="local-6989586621679374755"><a href="#local-6989586621679374755"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-344"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679374756"><a href="#local-6989586621679374756"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679374755"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">configPackageDBs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679374756"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-345"></a><span>  </span><span class="hs-special">`</span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Distribution.Simple.Compiler.html#absolutePackageDBPath"><span class="hs-identifier hs-var">absolutePackageDBPath</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-346"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">configPackageDBs</span><span> </span><a href="#local-6989586621679374755"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-identifier">defaultConfigFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Setup.html#ConfigFlags"><span class="hs-identifier hs-type">ConfigFlags</span></a><span>
</span><a name="line-349"></a><a name="defaultConfigFlags"><a href="Distribution.Simple.Setup.html#defaultConfigFlags"><span class="hs-identifier">defaultConfigFlags</span></a></a><span> </span><a name="local-6989586621679374757"><a href="#local-6989586621679374757"><span class="hs-identifier">progDb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Setup.html#emptyConfigFlags"><span class="hs-identifier hs-var">emptyConfigFlags</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-350"></a><span>    </span><span class="hs-identifier">configArgs</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-351"></a><span>    </span><span class="hs-identifier">configPrograms_</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679374757"><span class="hs-identifier hs-var">progDb</span></a><span class="hs-special">,</span><span>
</span><a name="line-352"></a><span>    </span><span class="hs-identifier">configHcFlavor</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><a href="Distribution.Compiler.html#defaultCompilerFlavor"><span class="hs-identifier hs-var">defaultCompilerFlavor</span></a><span class="hs-special">,</span><span>
</span><a name="line-353"></a><span>    </span><span class="hs-identifier">configVanillaLib</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span>
</span><a name="line-354"></a><span>    </span><span class="hs-identifier">configProfLib</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-355"></a><span>    </span><span class="hs-identifier">configSharedLib</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-356"></a><span>    </span><span class="hs-identifier">configStaticLib</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-357"></a><span>    </span><span class="hs-identifier">configDynExe</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-358"></a><span>    </span><span class="hs-identifier">configProfExe</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-359"></a><span>    </span><span class="hs-identifier">configProf</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-360"></a><span>    </span><span class="hs-identifier">configProfDetail</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-361"></a><span>    </span><span class="hs-identifier">configProfLibDetail</span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-362"></a><span>    </span><span class="hs-identifier">configOptimization</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><a href="Distribution.Simple.Compiler.html#NormalOptimisation"><span class="hs-identifier hs-var">NormalOptimisation</span></a><span class="hs-special">,</span><span>
</span><a name="line-363"></a><span>    </span><span class="hs-identifier">configProgPrefix</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.InstallDirs.html#toPathTemplate"><span class="hs-identifier hs-var">toPathTemplate</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-364"></a><span>    </span><span class="hs-identifier">configProgSuffix</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.InstallDirs.html#toPathTemplate"><span class="hs-identifier hs-var">toPathTemplate</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-365"></a><span>    </span><span class="hs-identifier">configDistPref</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-366"></a><span>    </span><span class="hs-identifier">configCabalFilePath</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-367"></a><span>    </span><span class="hs-identifier">configVerbosity</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><a href="Distribution.Verbosity.html#normal"><span class="hs-identifier hs-var">normal</span></a><span class="hs-special">,</span><span>
</span><a name="line-368"></a><span>    </span><span class="hs-identifier">configUserInstall</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>           </span><span class="hs-comment">--TODO: reverse this</span><span>
</span><a name="line-369"></a><span class="hs-cpp">#if defined(mingw32_HOST_OS)
</span><span>    </span><span class="hs-comment">-- See #1589.</span><span>
</span><a name="line-371"></a><span>    </span><span class="hs-identifier">configGHCiLib</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Flag</span><span> </span><span class="hs-identifier">True</span><span class="hs-special">,</span><span>
</span><a name="line-372"></a><span class="hs-cpp">#else
</span><span>    </span><span class="hs-identifier">configGHCiLib</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Flag.html#NoFlag"><span class="hs-identifier hs-var">NoFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-374"></a><span class="hs-cpp">#endif
</span><span class="">    configSplitSections = Flag False,
    configSplitObjs    = Flag False, -- takes longer, so turn off by default
    configStripExes    = Flag True,
    configStripLibs    = Flag True,
    configTests        = Flag False,
    configBenchmarks   = Flag False,
    configCoverage     = Flag False,
    configLibCoverage  = NoFlag,
    configExactConfiguration = Flag False,
    configFlagError    = NoFlag,
    configRelocatable  = Flag False,
    configDebugInfo    = Flag NoDebugInfo,
    configUseResponseFiles = NoFlag
  }

configureCommand :: ProgramDb -&gt; CommandUI ConfigFlags
configureCommand progDb = CommandUI
  { commandName         = &quot;configure&quot;
  , commandSynopsis     = &quot;Prepare to build the package.&quot;
  , commandDescription  = Just $ \_ -&gt; wrapText $
         &quot;Configure how the package is built by setting &quot;
      ++ &quot;package (and other) flags.\n&quot;
      ++ &quot;\n&quot;
      ++ &quot;The configuration affects several other commands, &quot;
      ++ &quot;including build, test, bench, run, repl.\n&quot;
  , commandNotes        = Just $ \_pname -&gt; programFlagsDescription progDb
  , commandUsage        = \pname -&gt;
      &quot;Usage: &quot; ++ pname ++ &quot; configure [FLAGS]\n&quot;
  , commandDefaultFlags = defaultConfigFlags progDb
  , commandOptions      = \showOrParseArgs -&gt;
         configureOptions showOrParseArgs
      ++ programDbPaths   progDb showOrParseArgs
           configProgramPaths (\v fs -&gt; fs { configProgramPaths = v })
      ++ programDbOption progDb showOrParseArgs
           configProgramArgs (\v fs -&gt; fs { configProgramArgs = v })
      ++ programDbOptions progDb showOrParseArgs
           configProgramArgs (\v fs -&gt; fs { configProgramArgs = v })
  }

-- | Inverse to 'dispModSubstEntry'.
parsecModSubstEntry :: ParsecParser (ModuleName, Module)
parsecModSubstEntry = do
    k &lt;- parsec
    _ &lt;- P.char '='
    v &lt;- parsec
    return (k, v)

-- | Pretty-print a single entry of a module substitution.
dispModSubstEntry :: (ModuleName, Module) -&gt; Disp.Doc
dispModSubstEntry (k, v) = disp k &lt;&lt;&gt;&gt; Disp.char '=' &lt;&lt;&gt;&gt; disp v

configureOptions :: ShowOrParseArgs -&gt; [OptionField ConfigFlags]
configureOptions showOrParseArgs =
      [optionVerbosity configVerbosity
       (\v flags -&gt; flags { configVerbosity = v })
      ,optionDistPref
         configDistPref (\d flags -&gt; flags { configDistPref = d })
         showOrParseArgs

      ,option [] [&quot;compiler&quot;] &quot;compiler&quot;
         configHcFlavor (\v flags -&gt; flags { configHcFlavor = v })
         (choiceOpt [ (Flag GHC,   (&quot;g&quot;, [&quot;ghc&quot;]),   &quot;compile with GHC&quot;)
                    , (Flag GHCJS, ([] , [&quot;ghcjs&quot;]), &quot;compile with GHCJS&quot;)
                    , (Flag UHC,   ([] , [&quot;uhc&quot;]),   &quot;compile with UHC&quot;)
                    -- &quot;haskell-suite&quot; compiler id string will be replaced
                    -- by a more specific one during the configure stage
                    , (Flag (HaskellSuite &quot;haskell-suite&quot;), ([] , [&quot;haskell-suite&quot;]),
                        &quot;compile with a haskell-suite compiler&quot;)])

      ,option &quot;&quot; [&quot;cabal-file&quot;]
         &quot;use this Cabal file&quot;
         configCabalFilePath (\v flags -&gt; flags { configCabalFilePath = v })
         (reqArgFlag &quot;PATH&quot;)

      ,option &quot;w&quot; [&quot;with-compiler&quot;]
         &quot;give the path to a particular compiler&quot;
         configHcPath (\v flags -&gt; flags { configHcPath = v })
         (reqArgFlag &quot;PATH&quot;)

      ,option &quot;&quot; [&quot;with-hc-pkg&quot;]
         &quot;give the path to the package tool&quot;
         configHcPkg (\v flags -&gt; flags { configHcPkg = v })
         (reqArgFlag &quot;PATH&quot;)
      ]
   ++ map liftInstallDirs installDirsOptions
   ++ [option &quot;&quot; [&quot;program-prefix&quot;]
          &quot;prefix to be applied to installed executables&quot;
          configProgPrefix
          (\v flags -&gt; flags { configProgPrefix = v })
          (reqPathTemplateArgFlag &quot;PREFIX&quot;)

      ,option &quot;&quot; [&quot;program-suffix&quot;]
          &quot;suffix to be applied to installed executables&quot;
          configProgSuffix (\v flags -&gt; flags { configProgSuffix = v } )
          (reqPathTemplateArgFlag &quot;SUFFIX&quot;)

      ,option &quot;&quot; [&quot;library-vanilla&quot;]
         &quot;Vanilla libraries&quot;
         configVanillaLib (\v flags -&gt; flags { configVanillaLib = v })
         (boolOpt [] [])

      ,option &quot;p&quot; [&quot;library-profiling&quot;]
         &quot;Library profiling&quot;
         configProfLib (\v flags -&gt; flags { configProfLib = v })
         (boolOpt &quot;p&quot; [])

      ,option &quot;&quot; [&quot;shared&quot;]
         &quot;Shared library&quot;
         configSharedLib (\v flags -&gt; flags { configSharedLib = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;static&quot;]
         &quot;Static library&quot;
         configStaticLib (\v flags -&gt; flags { configStaticLib = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;executable-dynamic&quot;]
         &quot;Executable dynamic linking&quot;
         configDynExe (\v flags -&gt; flags { configDynExe = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;profiling&quot;]
         &quot;Executable and library profiling&quot;
         configProf (\v flags -&gt; flags { configProf = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;executable-profiling&quot;]
         &quot;Executable profiling (DEPRECATED)&quot;
         configProfExe (\v flags -&gt; flags { configProfExe = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;profiling-detail&quot;]
         (&quot;Profiling detail level for executable and library (default, &quot; ++
          &quot;none, exported-functions, toplevel-functions,  all-functions).&quot;)
         configProfDetail (\v flags -&gt; flags { configProfDetail = v })
         (reqArg' &quot;level&quot; (Flag . flagToProfDetailLevel)
                          showProfDetailLevelFlag)

      ,option &quot;&quot; [&quot;library-profiling-detail&quot;]
         &quot;Profiling detail level for libraries only.&quot;
         configProfLibDetail (\v flags -&gt; flags { configProfLibDetail = v })
         (reqArg' &quot;level&quot; (Flag . flagToProfDetailLevel)
                          showProfDetailLevelFlag)

      ,multiOption &quot;optimization&quot;
         configOptimization (\v flags -&gt; flags { configOptimization = v })
         [optArg' &quot;n&quot; (Flag . flagToOptimisationLevel)
                     (\f -&gt; case f of
                              Flag NoOptimisation      -&gt; []
                              Flag NormalOptimisation  -&gt; [Nothing]
                              Flag MaximumOptimisation -&gt; [Just &quot;2&quot;]
                              _                        -&gt; [])
                 &quot;O&quot; [&quot;enable-optimization&quot;,&quot;enable-optimisation&quot;]
                 &quot;Build with optimization (n is 0--2, default is 1)&quot;,
          noArg (Flag NoOptimisation) []
                [&quot;disable-optimization&quot;,&quot;disable-optimisation&quot;]
                &quot;Build without optimization&quot;
         ]

      ,multiOption &quot;debug-info&quot;
         configDebugInfo (\v flags -&gt; flags { configDebugInfo = v })
         [optArg' &quot;n&quot; (Flag . flagToDebugInfoLevel)
                     (\f -&gt; case f of
                              Flag NoDebugInfo      -&gt; []
                              Flag MinimalDebugInfo -&gt; [Just &quot;1&quot;]
                              Flag NormalDebugInfo  -&gt; [Nothing]
                              Flag MaximalDebugInfo -&gt; [Just &quot;3&quot;]
                              _                     -&gt; [])
                 &quot;&quot; [&quot;enable-debug-info&quot;]
                 &quot;Emit debug info (n is 0--3, default is 0)&quot;,
          noArg (Flag NoDebugInfo) []
                [&quot;disable-debug-info&quot;]
                &quot;Don't emit debug info&quot;
         ]

      ,option &quot;&quot; [&quot;library-for-ghci&quot;]
         &quot;compile library for use with GHCi&quot;
         configGHCiLib (\v flags -&gt; flags { configGHCiLib = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;split-sections&quot;]
         &quot;compile library code such that unneeded definitions can be dropped from the final executable (GHC 7.8+)&quot;
         configSplitSections (\v flags -&gt; flags { configSplitSections = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;split-objs&quot;]
         &quot;split library into smaller objects to reduce binary sizes (GHC 6.6+)&quot;
         configSplitObjs (\v flags -&gt; flags { configSplitObjs = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;executable-stripping&quot;]
         &quot;strip executables upon installation to reduce binary sizes&quot;
         configStripExes (\v flags -&gt; flags { configStripExes = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;library-stripping&quot;]
         &quot;strip libraries upon installation to reduce binary sizes&quot;
         configStripLibs (\v flags -&gt; flags { configStripLibs = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;configure-option&quot;]
         &quot;Extra option for configure&quot;
         configConfigureArgs (\v flags -&gt; flags { configConfigureArgs = v })
         (reqArg' &quot;OPT&quot; (\x -&gt; [x]) id)

      ,option &quot;&quot; [&quot;user-install&quot;]
         &quot;doing a per-user installation&quot;
         configUserInstall (\v flags -&gt; flags { configUserInstall = v })
         (boolOpt' ([],[&quot;user&quot;]) ([], [&quot;global&quot;]))

      ,option &quot;&quot; [&quot;package-db&quot;]
         (   &quot;Append the given package database to the list of package&quot;
          ++ &quot; databases used (to satisfy dependencies and register into).&quot;
          ++ &quot; May be a specific file, 'global' or 'user'. The initial list&quot;
          ++ &quot; is ['global'], ['global', 'user'], or ['global', $sandbox],&quot;
          ++ &quot; depending on context. Use 'clear' to reset the list to empty.&quot;
          ++ &quot; See the user guide for details.&quot;)
         configPackageDBs (\v flags -&gt; flags { configPackageDBs = v })
         (reqArg' &quot;DB&quot; readPackageDbList showPackageDbList)

      ,option &quot;f&quot; [&quot;flags&quot;]
         &quot;Force values for the given flags in Cabal conditionals in the .cabal file.  E.g., --flags=\&quot;debug -usebytestrings\&quot; forces the flag \&quot;debug\&quot; to true and \&quot;usebytestrings\&quot; to false.&quot;
         configConfigurationsFlags (\v flags -&gt; flags { configConfigurationsFlags = v })
         (reqArg &quot;FLAGS&quot;
              (parsecToReadE (\err -&gt; &quot;Invalid flag assignment: &quot; ++ err) parsecFlagAssignment)
              showFlagAssignment)

      ,option &quot;&quot; [&quot;extra-include-dirs&quot;]
         &quot;A list of directories to search for header files&quot;
         configExtraIncludeDirs (\v flags -&gt; flags {configExtraIncludeDirs = v})
         (reqArg' &quot;PATH&quot; (\x -&gt; [x]) id)

      ,option &quot;&quot; [&quot;deterministic&quot;]
         &quot;Try to be as deterministic as possible (used by the test suite)&quot;
         configDeterministic (\v flags -&gt; flags {configDeterministic = v})
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;ipid&quot;]
         &quot;Installed package ID to compile this package as&quot;
         configIPID (\v flags -&gt; flags {configIPID = v})
         (reqArgFlag &quot;IPID&quot;)

      ,option &quot;&quot; [&quot;cid&quot;]
         &quot;Installed component ID to compile this component as&quot;
         (fmap display . configCID) (\v flags -&gt; flags {configCID = fmap mkComponentId v})
         (reqArgFlag &quot;CID&quot;)

      ,option &quot;&quot; [&quot;extra-lib-dirs&quot;]
         &quot;A list of directories to search for external libraries&quot;
         configExtraLibDirs (\v flags -&gt; flags {configExtraLibDirs = v})
         (reqArg' &quot;PATH&quot; (\x -&gt; [x]) id)

      ,option &quot;&quot; [&quot;extra-framework-dirs&quot;]
         &quot;A list of directories to search for external frameworks (OS X only)&quot;
         configExtraFrameworkDirs
         (\v flags -&gt; flags {configExtraFrameworkDirs = v})
         (reqArg' &quot;PATH&quot; (\x -&gt; [x]) id)

      ,option &quot;&quot; [&quot;extra-prog-path&quot;]
         &quot;A list of directories to search for required programs (in addition to the normal search locations)&quot;
         configProgramPathExtra (\v flags -&gt; flags {configProgramPathExtra = v})
         (reqArg' &quot;PATH&quot; (\x -&gt; toNubList [x]) fromNubList)

      ,option &quot;&quot; [&quot;constraint&quot;]
         &quot;A list of additional constraints on the dependencies.&quot;
         configConstraints (\v flags -&gt; flags { configConstraints = v})
         (reqArg &quot;DEPENDENCY&quot;
                 (parsecToReadE (const &quot;dependency expected&quot;) ((\x -&gt; [x]) `fmap` parsec))
                 (map display))

      ,option &quot;&quot; [&quot;dependency&quot;]
         &quot;A list of exact dependencies. E.g., --dependency=\&quot;void=void-0.5.8-177d5cdf20962d0581fe2e4932a6c309\&quot;&quot;
         configDependencies (\v flags -&gt; flags { configDependencies = v})
         (reqArg &quot;NAME=CID&quot;
                 (parsecToReadE (const &quot;dependency expected&quot;) ((\x -&gt; [x]) `fmap` parsecDependency))
                 (map (\x -&gt; display (fst x) ++ &quot;=&quot; ++ display (snd x))))

      ,option &quot;&quot; [&quot;instantiate-with&quot;]
        &quot;A mapping of signature names to concrete module instantiations.&quot;
        configInstantiateWith (\v flags -&gt; flags { configInstantiateWith = v  })
        (reqArg &quot;NAME=MOD&quot;
            (parsecToReadE (&quot;Cannot parse module substitution: &quot; ++) (fmap (:[]) parsecModSubstEntry))
            (map (Disp.renderStyle defaultStyle . dispModSubstEntry)))

      ,option &quot;&quot; [&quot;tests&quot;]
         &quot;dependency checking and compilation for test suites listed in the package description file.&quot;
         configTests (\v flags -&gt; flags { configTests = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;coverage&quot;]
         &quot;build package with Haskell Program Coverage. (GHC only)&quot;
         configCoverage (\v flags -&gt; flags { configCoverage = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;library-coverage&quot;]
         &quot;build package with Haskell Program Coverage. (GHC only) (DEPRECATED)&quot;
         configLibCoverage (\v flags -&gt; flags { configLibCoverage = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;exact-configuration&quot;]
         &quot;All direct dependencies and flags are provided on the command line.&quot;
         configExactConfiguration
         (\v flags -&gt; flags { configExactConfiguration = v })
         trueArg

      ,option &quot;&quot; [&quot;benchmarks&quot;]
         &quot;dependency checking and compilation for benchmarks listed in the package description file.&quot;
         configBenchmarks (\v flags -&gt; flags { configBenchmarks = v })
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;relocatable&quot;]
         &quot;building a package that is relocatable. (GHC only)&quot;
         configRelocatable (\v flags -&gt; flags { configRelocatable = v})
         (boolOpt [] [])

      ,option &quot;&quot; [&quot;response-files&quot;]
         &quot;enable workaround for old versions of programs like \&quot;ar\&quot; that do not support @file arguments&quot;
         configUseResponseFiles
         (\v flags -&gt; flags { configUseResponseFiles = v })
         (boolOpt' ([], [&quot;disable-response-files&quot;]) ([], []))
      ]
  where
    liftInstallDirs =
      liftOption configInstallDirs (\v flags -&gt; flags { configInstallDirs = v })

    reqPathTemplateArgFlag title _sf _lf d get set =
      reqArgFlag title _sf _lf d
        (fmap fromPathTemplate . get) (set . fmap toPathTemplate)

showFlagAssignment :: FlagAssignment -&gt; [String]
showFlagAssignment = map showFlagValue' . unFlagAssignment
  where
    -- We can't use 'showFlagValue' because legacy custom-setups don't
    -- support the '+' prefix in --flags; so we omit the (redundant) + prefix;
    -- NB: we assume that we never have to set/enable '-'-prefixed flags here.
    showFlagValue' :: (FlagName, Bool) -&gt; String
    showFlagValue' (f, True)   =       unFlagName f
    showFlagValue' (f, False)  = '-' : unFlagName f

readPackageDbList :: String -&gt; [Maybe PackageDB]
readPackageDbList &quot;clear&quot;  = [Nothing]
readPackageDbList &quot;global&quot; = [Just GlobalPackageDB]
readPackageDbList &quot;user&quot;   = [Just UserPackageDB]
readPackageDbList other    = [Just (SpecificPackageDB other)]

showPackageDbList :: [Maybe PackageDB] -&gt; [String]
showPackageDbList = map showPackageDb
  where
    showPackageDb Nothing                       = &quot;clear&quot;
    showPackageDb (Just GlobalPackageDB)        = &quot;global&quot;
    showPackageDb (Just UserPackageDB)          = &quot;user&quot;
    showPackageDb (Just (SpecificPackageDB db)) = db

showProfDetailLevelFlag :: Flag ProfDetailLevel -&gt; [String]
showProfDetailLevelFlag NoFlag    = []
showProfDetailLevelFlag (Flag dl) = [showProfDetailLevel dl]

parsecDependency :: ParsecParser (PackageName, ComponentId)
parsecDependency = do
  x &lt;- parsec
  _ &lt;- P.char '='
  y &lt;- parsec
  return (x, y)

installDirsOptions :: [OptionField (InstallDirs (Flag PathTemplate))]
installDirsOptions =
  [ option &quot;&quot; [&quot;prefix&quot;]
      &quot;bake this prefix in preparation of installation&quot;
      prefix (\v flags -&gt; flags { prefix = v })
      installDirArg

  , option &quot;&quot; [&quot;bindir&quot;]
      &quot;installation directory for executables&quot;
      bindir (\v flags -&gt; flags { bindir = v })
      installDirArg

  , option &quot;&quot; [&quot;libdir&quot;]
      &quot;installation directory for libraries&quot;
      libdir (\v flags -&gt; flags { libdir = v })
      installDirArg

  , option &quot;&quot; [&quot;libsubdir&quot;]
      &quot;subdirectory of libdir in which libs are installed&quot;
      libsubdir (\v flags -&gt; flags { libsubdir = v })
      installDirArg

  , option &quot;&quot; [&quot;dynlibdir&quot;]
      &quot;installation directory for dynamic libraries&quot;
      dynlibdir (\v flags -&gt; flags { dynlibdir = v })
      installDirArg

  , option &quot;&quot; [&quot;libexecdir&quot;]
      &quot;installation directory for program executables&quot;
      libexecdir (\v flags -&gt; flags { libexecdir = v })
      installDirArg

  , option &quot;&quot; [&quot;libexecsubdir&quot;]
      &quot;subdirectory of libexecdir in which private executables are installed&quot;
      libexecsubdir (\v flags -&gt; flags { libexecsubdir = v })
      installDirArg

  , option &quot;&quot; [&quot;datadir&quot;]
      &quot;installation directory for read-only data&quot;
      datadir (\v flags -&gt; flags { datadir = v })
      installDirArg

  , option &quot;&quot; [&quot;datasubdir&quot;]
      &quot;subdirectory of datadir in which data files are installed&quot;
      datasubdir (\v flags -&gt; flags { datasubdir = v })
      installDirArg

  , option &quot;&quot; [&quot;docdir&quot;]
      &quot;installation directory for documentation&quot;
      docdir (\v flags -&gt; flags { docdir = v })
      installDirArg

  , option &quot;&quot; [&quot;htmldir&quot;]
      &quot;installation directory for HTML documentation&quot;
      htmldir (\v flags -&gt; flags { htmldir = v })
      installDirArg

  , option &quot;&quot; [&quot;haddockdir&quot;]
      &quot;installation directory for haddock interfaces&quot;
      haddockdir (\v flags -&gt; flags { haddockdir = v })
      installDirArg

  , option &quot;&quot; [&quot;sysconfdir&quot;]
      &quot;installation directory for configuration files&quot;
      sysconfdir (\v flags -&gt; flags { sysconfdir = v })
      installDirArg
  ]
  where
    installDirArg _sf _lf d get set =
      reqArgFlag &quot;DIR&quot; _sf _lf d
        (fmap fromPathTemplate . get) (set . fmap toPathTemplate)

emptyConfigFlags :: ConfigFlags
emptyConfigFlags = mempty

instance Monoid ConfigFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup ConfigFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * Copy flags
-- ------------------------------------------------------------

-- | Flags to @copy@: (destdir, copy-prefix (backwards compat), verbosity)
data CopyFlags = CopyFlags {
    copyDest      :: Flag CopyDest,
    copyDistPref  :: Flag FilePath,
    copyVerbosity :: Flag Verbosity,
    -- This is the same hack as in 'buildArgs'.  But I (ezyang) don't
    -- think it's a hack, it's the right way to make hooks more robust
    -- TODO: Stop using this eventually when 'UserHooks' gets changed
    copyArgs :: [String],
    copyCabalFilePath :: Flag FilePath
  }
  deriving (Show, Generic)

defaultCopyFlags :: CopyFlags
defaultCopyFlags  = CopyFlags {
    copyDest      = Flag NoCopyDest,
    copyDistPref  = NoFlag,
    copyVerbosity = Flag normal,
    copyArgs      = [],
    copyCabalFilePath = mempty
  }

copyCommand :: CommandUI CopyFlags
copyCommand = CommandUI
  { commandName         = &quot;copy&quot;
  , commandSynopsis     = &quot;Copy the files of all/specific components to install locations.&quot;
  , commandDescription  = Just $ \_ -&gt; wrapText $
          &quot;Components encompass executables and libraries. &quot;
       ++ &quot;Does not call register, and allows a prefix at install time. &quot;
       ++ &quot;Without the --destdir flag, configure determines location.\n&quot;
  , commandNotes        = Just $ \pname -&gt;
       &quot;Examples:\n&quot;
        ++ &quot;  &quot; ++ pname ++ &quot; copy           &quot;
        ++ &quot;    All the components in the package\n&quot;
        ++ &quot;  &quot; ++ pname ++ &quot; copy foo       &quot;
        ++ &quot;    A component (i.e. lib, exe, test suite)&quot;
  , commandUsage        = usageAlternatives &quot;copy&quot; $
      [ &quot;[FLAGS]&quot;
      , &quot;COMPONENTS [FLAGS]&quot;
      ]
  , commandDefaultFlags = defaultCopyFlags
  , commandOptions      = \showOrParseArgs -&gt; case showOrParseArgs of
      ShowArgs -&gt; filter ((`notElem` [&quot;target-package-db&quot;])
                          . optionName) $ copyOptions ShowArgs
      ParseArgs -&gt; copyOptions ParseArgs
}

copyOptions ::  ShowOrParseArgs -&gt; [OptionField CopyFlags]
copyOptions showOrParseArgs =
  [optionVerbosity copyVerbosity (\v flags -&gt; flags { copyVerbosity = v })

  ,optionDistPref
    copyDistPref (\d flags -&gt; flags { copyDistPref = d })
    showOrParseArgs

  ,option &quot;&quot; [&quot;destdir&quot;]
    &quot;directory to copy files to, prepended to installation directories&quot;
    copyDest (\v flags -&gt; case copyDest flags of
                 Flag (CopyToDb _) -&gt; error &quot;Use either 'destdir' or 'target-package-db'.&quot;
                 _ -&gt; flags { copyDest = v })
    (reqArg &quot;DIR&quot; (succeedReadE (Flag . CopyTo))
      (\f -&gt; case f of Flag (CopyTo p) -&gt; [p]; _ -&gt; []))

  ,option &quot;&quot; [&quot;target-package-db&quot;]
    &quot;package database to copy files into. Required when using ${pkgroot} prefix.&quot;
    copyDest (\v flags -&gt; case copyDest flags of
                 NoFlag -&gt; flags { copyDest = v }
                 Flag NoCopyDest -&gt; flags { copyDest = v }
                 _ -&gt; error &quot;Use either 'destdir' or 'target-package-db'.&quot;)
    (reqArg &quot;DATABASE&quot; (succeedReadE (Flag . CopyToDb))
      (\f -&gt; case f of Flag (CopyToDb p) -&gt; [p]; _ -&gt; []))
  ]

emptyCopyFlags :: CopyFlags
emptyCopyFlags = mempty

instance Monoid CopyFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup CopyFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * Install flags
-- ------------------------------------------------------------

-- | Flags to @install@: (package db, verbosity)
data InstallFlags = InstallFlags {
    installPackageDB :: Flag PackageDB,
    installDest      :: Flag CopyDest,
    installDistPref  :: Flag FilePath,
    installUseWrapper :: Flag Bool,
    installInPlace    :: Flag Bool,
    installVerbosity :: Flag Verbosity,
    -- this is only here, because we can not
    -- change the hooks API.
    installCabalFilePath :: Flag FilePath
  }
  deriving (Show, Generic)

defaultInstallFlags :: InstallFlags
defaultInstallFlags  = InstallFlags {
    installPackageDB = NoFlag,
    installDest      = Flag NoCopyDest,
    installDistPref  = NoFlag,
    installUseWrapper = Flag False,
    installInPlace    = Flag False,
    installVerbosity = Flag normal,
    installCabalFilePath = mempty
  }

installCommand :: CommandUI InstallFlags
installCommand = CommandUI
  { commandName         = &quot;install&quot;
  , commandSynopsis     =
      &quot;Copy the files into the install locations. Run register.&quot;
  , commandDescription  = Just $ \_ -&gt; wrapText $
         &quot;Unlike the copy command, install calls the register command.&quot;
      ++ &quot;If you want to install into a location that is not what was&quot;
      ++ &quot;specified in the configure step, use the copy command.\n&quot;
  , commandNotes        = Nothing
  , commandUsage        = \pname -&gt;
      &quot;Usage: &quot; ++ pname ++ &quot; install [FLAGS]\n&quot;
  , commandDefaultFlags = defaultInstallFlags
  , commandOptions      = \showOrParseArgs -&gt; case showOrParseArgs of
      ShowArgs -&gt; filter ((`notElem` [&quot;target-package-db&quot;])
                          . optionName) $ installOptions ShowArgs
      ParseArgs -&gt; installOptions ParseArgs
  }

installOptions ::  ShowOrParseArgs -&gt; [OptionField InstallFlags]
installOptions showOrParseArgs =
  [optionVerbosity installVerbosity (\v flags -&gt; flags { installVerbosity = v })
  ,optionDistPref
    installDistPref (\d flags -&gt; flags { installDistPref = d })
    showOrParseArgs

  ,option &quot;&quot; [&quot;inplace&quot;]
    &quot;install the package in the install subdirectory of the dist prefix, so it can be used without being installed&quot;
    installInPlace (\v flags -&gt; flags { installInPlace = v })
    trueArg

  ,option &quot;&quot; [&quot;shell-wrappers&quot;]
    &quot;using shell script wrappers around executables&quot;
    installUseWrapper (\v flags -&gt; flags { installUseWrapper = v })
    (boolOpt [] [])

  ,option &quot;&quot; [&quot;package-db&quot;] &quot;&quot;
    installPackageDB (\v flags -&gt; flags { installPackageDB = v })
    (choiceOpt [ (Flag UserPackageDB, ([],[&quot;user&quot;]),
                   &quot;upon configuration register this package in the user's local package database&quot;)
               , (Flag GlobalPackageDB, ([],[&quot;global&quot;]),
                   &quot;(default) upon configuration register this package in the system-wide package database&quot;)])
  ,option &quot;&quot; [&quot;target-package-db&quot;]
    &quot;package database to install into. Required when using ${pkgroot} prefix.&quot;
    installDest (\v flags -&gt; flags { installDest = v })
    (reqArg &quot;DATABASE&quot; (succeedReadE (Flag . CopyToDb))
      (\f -&gt; case f of Flag (CopyToDb p) -&gt; [p]; _ -&gt; []))
  ]

emptyInstallFlags :: InstallFlags
emptyInstallFlags = mempty

instance Monoid InstallFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup InstallFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * SDist flags
-- ------------------------------------------------------------

-- | Flags to @sdist@: (snapshot, verbosity)
data SDistFlags = SDistFlags {
    sDistSnapshot    :: Flag Bool,
    sDistDirectory   :: Flag FilePath,
    sDistDistPref    :: Flag FilePath,
    sDistListSources :: Flag FilePath,
    sDistVerbosity   :: Flag Verbosity
  }
  deriving (Show, Generic)

defaultSDistFlags :: SDistFlags
defaultSDistFlags = SDistFlags {
    sDistSnapshot    = Flag False,
    sDistDirectory   = mempty,
    sDistDistPref    = NoFlag,
    sDistListSources = mempty,
    sDistVerbosity   = Flag normal
  }

sdistCommand :: CommandUI SDistFlags
sdistCommand = CommandUI
  { commandName         = &quot;sdist&quot;
  , commandSynopsis     =
      &quot;Generate a source distribution file (.tar.gz).&quot;
  , commandDescription  = Nothing
  , commandNotes        = Nothing
  , commandUsage        = \pname -&gt;
      &quot;Usage: &quot; ++ pname ++ &quot; sdist [FLAGS]\n&quot;
  , commandDefaultFlags = defaultSDistFlags
  , commandOptions      = \showOrParseArgs -&gt;
      [optionVerbosity sDistVerbosity (\v flags -&gt; flags { sDistVerbosity = v })
      ,optionDistPref
         sDistDistPref (\d flags -&gt; flags { sDistDistPref = d })
         showOrParseArgs

      ,option &quot;&quot; [&quot;list-sources&quot;]
         &quot;Just write a list of the package's sources to a file&quot;
         sDistListSources (\v flags -&gt; flags { sDistListSources = v })
         (reqArgFlag &quot;FILE&quot;)

      ,option &quot;&quot; [&quot;snapshot&quot;]
         &quot;Produce a snapshot source distribution&quot;
         sDistSnapshot (\v flags -&gt; flags { sDistSnapshot = v })
         trueArg

      ,option &quot;&quot; [&quot;output-directory&quot;]
       (&quot;Generate a source distribution in the given directory, &quot;
        ++ &quot;without creating a tarball&quot;)
         sDistDirectory (\v flags -&gt; flags { sDistDirectory = v })
         (reqArgFlag &quot;DIR&quot;)
      ]
  }

emptySDistFlags :: SDistFlags
emptySDistFlags = mempty

instance Monoid SDistFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup SDistFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * Register flags
-- ------------------------------------------------------------

-- | Flags to @register@ and @unregister@: (user package, gen-script,
-- in-place, verbosity)
data RegisterFlags = RegisterFlags {
    regPackageDB   :: Flag PackageDB,
    regGenScript   :: Flag Bool,
    regGenPkgConf  :: Flag (Maybe FilePath),
    regInPlace     :: Flag Bool,
    regDistPref    :: Flag FilePath,
    regPrintId     :: Flag Bool,
    regVerbosity   :: Flag Verbosity,
    -- Same as in 'buildArgs' and 'copyArgs'
    regArgs        :: [String],
    regCabalFilePath :: Flag FilePath
  }
  deriving (Show, Generic)

defaultRegisterFlags :: RegisterFlags
defaultRegisterFlags = RegisterFlags {
    regPackageDB   = NoFlag,
    regGenScript   = Flag False,
    regGenPkgConf  = NoFlag,
    regInPlace     = Flag False,
    regDistPref    = NoFlag,
    regPrintId     = Flag False,
    regArgs        = [],
    regCabalFilePath = mempty,
    regVerbosity   = Flag normal
  }

registerCommand :: CommandUI RegisterFlags
registerCommand = CommandUI
  { commandName         = &quot;register&quot;
  , commandSynopsis     =
      &quot;Register this package with the compiler.&quot;
  , commandDescription  = Nothing
  , commandNotes        = Nothing
  , commandUsage        = \pname -&gt;
      &quot;Usage: &quot; ++ pname ++ &quot; register [FLAGS]\n&quot;
  , commandDefaultFlags = defaultRegisterFlags
  , commandOptions      = \showOrParseArgs -&gt;
      [optionVerbosity regVerbosity (\v flags -&gt; flags { regVerbosity = v })
      ,optionDistPref
         regDistPref (\d flags -&gt; flags { regDistPref = d })
         showOrParseArgs

      ,option &quot;&quot; [&quot;packageDB&quot;] &quot;&quot;
         regPackageDB (\v flags -&gt; flags { regPackageDB = v })
         (choiceOpt [ (Flag UserPackageDB, ([],[&quot;user&quot;]),
                                &quot;upon registration, register this package in the user's local package database&quot;)
                    , (Flag GlobalPackageDB, ([],[&quot;global&quot;]),
                                &quot;(default)upon registration, register this package in the system-wide package database&quot;)])

      ,option &quot;&quot; [&quot;inplace&quot;]
         &quot;register the package in the build location, so it can be used without being installed&quot;
         regInPlace (\v flags -&gt; flags { regInPlace = v })
         trueArg

      ,option &quot;&quot; [&quot;gen-script&quot;]
         &quot;instead of registering, generate a script to register later&quot;
         regGenScript (\v flags -&gt; flags { regGenScript = v })
         trueArg

      ,option &quot;&quot; [&quot;gen-pkg-config&quot;]
         &quot;instead of registering, generate a package registration file/directory&quot;
         regGenPkgConf (\v flags -&gt; flags { regGenPkgConf  = v })
         (optArg' &quot;PKG&quot; Flag flagToList)

      ,option &quot;&quot; [&quot;print-ipid&quot;]
         &quot;print the installed package ID calculated for this package&quot;
         regPrintId (\v flags -&gt; flags { regPrintId = v })
         trueArg
      ]
  }

unregisterCommand :: CommandUI RegisterFlags
unregisterCommand = CommandUI
  { commandName         = &quot;unregister&quot;
  , commandSynopsis     =
      &quot;Unregister this package with the compiler.&quot;
  , commandDescription  = Nothing
  , commandNotes        = Nothing
  , commandUsage        = \pname -&gt;
      &quot;Usage: &quot; ++ pname ++ &quot; unregister [FLAGS]\n&quot;
  , commandDefaultFlags = defaultRegisterFlags
  , commandOptions      = \showOrParseArgs -&gt;
      [optionVerbosity regVerbosity (\v flags -&gt; flags { regVerbosity = v })
      ,optionDistPref
         regDistPref (\d flags -&gt; flags { regDistPref = d })
          showOrParseArgs

      ,option &quot;&quot; [&quot;user&quot;] &quot;&quot;
         regPackageDB (\v flags -&gt; flags { regPackageDB = v })
         (choiceOpt [ (Flag UserPackageDB, ([],[&quot;user&quot;]),
                              &quot;unregister this package in the user's local package database&quot;)
                    , (Flag GlobalPackageDB, ([],[&quot;global&quot;]),
                              &quot;(default) unregister this package in the  system-wide package database&quot;)])

      ,option &quot;&quot; [&quot;gen-script&quot;]
         &quot;Instead of performing the unregister command, generate a script to unregister later&quot;
         regGenScript (\v flags -&gt; flags { regGenScript = v })
         trueArg
      ]
  }

emptyRegisterFlags :: RegisterFlags
emptyRegisterFlags = mempty

instance Monoid RegisterFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup RegisterFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * HsColour flags
-- ------------------------------------------------------------

data HscolourFlags = HscolourFlags {
    hscolourCSS         :: Flag FilePath,
    hscolourExecutables :: Flag Bool,
    hscolourTestSuites  :: Flag Bool,
    hscolourBenchmarks  :: Flag Bool,
    hscolourForeignLibs :: Flag Bool,
    hscolourDistPref    :: Flag FilePath,
    hscolourVerbosity   :: Flag Verbosity,
    hscolourCabalFilePath :: Flag FilePath
    }
  deriving (Show, Generic)

emptyHscolourFlags :: HscolourFlags
emptyHscolourFlags = mempty

defaultHscolourFlags :: HscolourFlags
defaultHscolourFlags = HscolourFlags {
    hscolourCSS         = NoFlag,
    hscolourExecutables = Flag False,
    hscolourTestSuites  = Flag False,
    hscolourBenchmarks  = Flag False,
    hscolourDistPref    = NoFlag,
    hscolourForeignLibs = Flag False,
    hscolourVerbosity   = Flag normal,
    hscolourCabalFilePath = mempty
  }

instance Monoid HscolourFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup HscolourFlags where
  (&lt;&gt;) = gmappend

hscolourCommand :: CommandUI HscolourFlags
hscolourCommand = CommandUI
  { commandName         = &quot;hscolour&quot;
  , commandSynopsis     =
      &quot;Generate HsColour colourised code, in HTML format.&quot;
  , commandDescription  = Just (\_ -&gt; &quot;Requires the hscolour program.\n&quot;)
  , commandNotes        = Just $ \_ -&gt;
      &quot;Deprecated in favour of 'cabal haddock --hyperlink-source'.&quot;
  , commandUsage        = \pname -&gt;
      &quot;Usage: &quot; ++ pname ++ &quot; hscolour [FLAGS]\n&quot;
  , commandDefaultFlags = defaultHscolourFlags
  , commandOptions      = \showOrParseArgs -&gt;
      [optionVerbosity hscolourVerbosity
       (\v flags -&gt; flags { hscolourVerbosity = v })
      ,optionDistPref
         hscolourDistPref (\d flags -&gt; flags { hscolourDistPref = d })
         showOrParseArgs

      ,option &quot;&quot; [&quot;executables&quot;]
         &quot;Run hscolour for Executables targets&quot;
         hscolourExecutables (\v flags -&gt; flags { hscolourExecutables = v })
         trueArg

      ,option &quot;&quot; [&quot;tests&quot;]
         &quot;Run hscolour for Test Suite targets&quot;
         hscolourTestSuites (\v flags -&gt; flags { hscolourTestSuites = v })
         trueArg

      ,option &quot;&quot; [&quot;benchmarks&quot;]
         &quot;Run hscolour for Benchmark targets&quot;
         hscolourBenchmarks (\v flags -&gt; flags { hscolourBenchmarks = v })
         trueArg

      ,option &quot;&quot; [&quot;foreign-libraries&quot;]
         &quot;Run hscolour for Foreign Library targets&quot;
         hscolourForeignLibs (\v flags -&gt; flags { hscolourForeignLibs = v })
         trueArg

      ,option &quot;&quot; [&quot;all&quot;]
         &quot;Run hscolour for all targets&quot;
         (\f -&gt; allFlags [ hscolourExecutables f
                         , hscolourTestSuites  f
                         , hscolourBenchmarks  f
                         , hscolourForeignLibs f
                         ])
         (\v flags -&gt; flags { hscolourExecutables = v
                            , hscolourTestSuites  = v
                            , hscolourBenchmarks  = v
                            , hscolourForeignLibs = v
                            })
         trueArg

      ,option &quot;&quot; [&quot;css&quot;]
         &quot;Use a cascading style sheet&quot;
         hscolourCSS (\v flags -&gt; flags { hscolourCSS = v })
         (reqArgFlag &quot;PATH&quot;)
      ]
  }

-- ------------------------------------------------------------
-- * Doctest flags
-- ------------------------------------------------------------

data DoctestFlags = DoctestFlags {
    doctestProgramPaths :: [(String, FilePath)],
    doctestProgramArgs  :: [(String, [String])],
    doctestDistPref     :: Flag FilePath,
    doctestVerbosity    :: Flag Verbosity
  }
   deriving (Show, Generic)

defaultDoctestFlags :: DoctestFlags
defaultDoctestFlags = DoctestFlags {
    doctestProgramPaths = mempty,
    doctestProgramArgs  = [],
    doctestDistPref     = NoFlag,
    doctestVerbosity    = Flag normal
  }

doctestCommand :: CommandUI DoctestFlags
doctestCommand = CommandUI
  { commandName         = &quot;doctest&quot;
  , commandSynopsis     = &quot;Run doctest tests.&quot;
  , commandDescription  = Just $ \_ -&gt;
      &quot;Requires the program doctest, version 0.12.\n&quot;
  , commandNotes        = Nothing
  , commandUsage        = \pname -&gt;
      &quot;Usage: &quot; ++ pname ++ &quot; doctest [FLAGS]\n&quot;
  , commandDefaultFlags = defaultDoctestFlags
  , commandOptions      = \showOrParseArgs -&gt;
         doctestOptions showOrParseArgs
      ++ programDbPaths   progDb ParseArgs
             doctestProgramPaths (\v flags -&gt; flags { doctestProgramPaths = v })
      ++ programDbOption  progDb showOrParseArgs
             doctestProgramArgs (\v fs -&gt; fs { doctestProgramArgs = v })
      ++ programDbOptions progDb ParseArgs
             doctestProgramArgs (\v flags -&gt; flags { doctestProgramArgs = v })
  }
  where
    progDb = addKnownProgram doctestProgram
             emptyProgramDb

doctestOptions :: ShowOrParseArgs -&gt; [OptionField DoctestFlags]
doctestOptions showOrParseArgs =
  [optionVerbosity doctestVerbosity
   (\v flags -&gt; flags { doctestVerbosity = v })
  ,optionDistPref
   doctestDistPref (\d flags -&gt; flags { doctestDistPref = d })
   showOrParseArgs
  ]

emptyDoctestFlags :: DoctestFlags
emptyDoctestFlags = mempty

instance Monoid DoctestFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup DoctestFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * Haddock flags
-- ------------------------------------------------------------


-- | When we build haddock documentation, there are two cases:
--
-- 1. We build haddocks only for the current development version,
--    intended for local use and not for distribution. In this case,
--    we store the generated documentation in @&lt;dist&gt;/doc/html/&lt;package name&gt;@.
--
-- 2. We build haddocks for intended for uploading them to hackage.
--    In this case, we need to follow the layout that hackage expects
--    from documentation tarballs, and we might also want to use different
--    flags than for development builds, so in this case we store the generated
--    documentation in @&lt;dist&gt;/doc/html/&lt;package id&gt;-docs@.
data HaddockTarget = ForHackage | ForDevelopment deriving (Eq, Show, Generic)

instance Binary HaddockTarget

instance Text HaddockTarget where
    disp ForHackage     = Disp.text &quot;for-hackage&quot;
    disp ForDevelopment = Disp.text &quot;for-development&quot;

    parse = Parse.choice [ Parse.string &quot;for-hackage&quot;     &gt;&gt; return ForHackage
                         , Parse.string &quot;for-development&quot; &gt;&gt; return ForDevelopment]

data HaddockFlags = HaddockFlags {
    haddockProgramPaths :: [(String, FilePath)],
    haddockProgramArgs  :: [(String, [String])],
    haddockHoogle       :: Flag Bool,
    haddockHtml         :: Flag Bool,
    haddockHtmlLocation :: Flag String,
    haddockForHackage   :: Flag HaddockTarget,
    haddockExecutables  :: Flag Bool,
    haddockTestSuites   :: Flag Bool,
    haddockBenchmarks   :: Flag Bool,
    haddockForeignLibs  :: Flag Bool,
    haddockInternal     :: Flag Bool,
    haddockCss          :: Flag FilePath,
    haddockLinkedSource :: Flag Bool,
    haddockQuickJump    :: Flag Bool,
    haddockHscolourCss  :: Flag FilePath,
    haddockContents     :: Flag PathTemplate,
    haddockDistPref     :: Flag FilePath,
    haddockKeepTempFiles:: Flag Bool,
    haddockVerbosity    :: Flag Verbosity,
    haddockCabalFilePath :: Flag FilePath,
    haddockArgs         :: [String]
  }
  deriving (Show, Generic)

defaultHaddockFlags :: HaddockFlags
defaultHaddockFlags  = HaddockFlags {
    haddockProgramPaths = mempty,
    haddockProgramArgs  = [],
    haddockHoogle       = Flag False,
    haddockHtml         = Flag False,
    haddockHtmlLocation = NoFlag,
    haddockForHackage   = NoFlag,
    haddockExecutables  = Flag False,
    haddockTestSuites   = Flag False,
    haddockBenchmarks   = Flag False,
    haddockForeignLibs  = Flag False,
    haddockInternal     = Flag False,
    haddockCss          = NoFlag,
    haddockLinkedSource = Flag False,
    haddockQuickJump    = Flag False,
    haddockHscolourCss  = NoFlag,
    haddockContents     = NoFlag,
    haddockDistPref     = NoFlag,
    haddockKeepTempFiles= Flag False,
    haddockVerbosity    = Flag normal,
    haddockCabalFilePath = mempty,
    haddockArgs         = mempty
  }

haddockCommand :: CommandUI HaddockFlags
haddockCommand = CommandUI
  { commandName         = &quot;haddock&quot;
  , commandSynopsis     = &quot;Generate Haddock HTML documentation.&quot;
  , commandDescription  = Just $ \_ -&gt;
      &quot;Requires the program haddock, version 2.x.\n&quot;
  , commandNotes        = Nothing
  , commandUsage        = usageAlternatives &quot;haddock&quot; $
      [ &quot;[FLAGS]&quot;
      , &quot;COMPONENTS [FLAGS]&quot;
      ]
  , commandDefaultFlags = defaultHaddockFlags
  , commandOptions      = \showOrParseArgs -&gt;
         haddockOptions showOrParseArgs
      ++ programDbPaths   progDb ParseArgs
             haddockProgramPaths (\v flags -&gt; flags { haddockProgramPaths = v})
      ++ programDbOption  progDb showOrParseArgs
             haddockProgramArgs (\v fs -&gt; fs { haddockProgramArgs = v })
      ++ programDbOptions progDb ParseArgs
             haddockProgramArgs  (\v flags -&gt; flags { haddockProgramArgs = v})
  }
  where
    progDb = addKnownProgram haddockProgram
             $ addKnownProgram ghcProgram
             $ emptyProgramDb

haddockOptions :: ShowOrParseArgs -&gt; [OptionField HaddockFlags]
haddockOptions showOrParseArgs =
  [optionVerbosity haddockVerbosity
   (\v flags -&gt; flags { haddockVerbosity = v })
  ,optionDistPref
   haddockDistPref (\d flags -&gt; flags { haddockDistPref = d })
   showOrParseArgs

  ,option &quot;&quot; [&quot;keep-temp-files&quot;]
   &quot;Keep temporary files&quot;
   haddockKeepTempFiles (\b flags -&gt; flags { haddockKeepTempFiles = b })
   trueArg

  ,option &quot;&quot; [&quot;hoogle&quot;]
   &quot;Generate a hoogle database&quot;
   haddockHoogle (\v flags -&gt; flags { haddockHoogle = v })
   trueArg

  ,option &quot;&quot; [&quot;html&quot;]
   &quot;Generate HTML documentation (the default)&quot;
   haddockHtml (\v flags -&gt; flags { haddockHtml = v })
   trueArg

  ,option &quot;&quot; [&quot;html-location&quot;]
   &quot;Location of HTML documentation for pre-requisite packages&quot;
   haddockHtmlLocation (\v flags -&gt; flags { haddockHtmlLocation = v })
   (reqArgFlag &quot;URL&quot;)

  ,option &quot;&quot; [&quot;for-hackage&quot;]
   &quot;Collection of flags to generate documentation suitable for upload to hackage&quot;
   haddockForHackage (\v flags -&gt; flags { haddockForHackage = v })
   (noArg (Flag ForHackage))

  ,option &quot;&quot; [&quot;executables&quot;]
   &quot;Run haddock for Executables targets&quot;
   haddockExecutables (\v flags -&gt; flags { haddockExecutables = v })
   trueArg

  ,option &quot;&quot; [&quot;tests&quot;]
   &quot;Run haddock for Test Suite targets&quot;
   haddockTestSuites (\v flags -&gt; flags { haddockTestSuites = v })
   trueArg

  ,option &quot;&quot; [&quot;benchmarks&quot;]
   &quot;Run haddock for Benchmark targets&quot;
   haddockBenchmarks (\v flags -&gt; flags { haddockBenchmarks = v })
   trueArg

  ,option &quot;&quot; [&quot;foreign-libraries&quot;]
   &quot;Run haddock for Foreign Library targets&quot;
   haddockForeignLibs (\v flags -&gt; flags { haddockForeignLibs = v })
   trueArg

  ,option &quot;&quot; [&quot;all&quot;]
   &quot;Run haddock for all targets&quot;
   (\f -&gt; allFlags [ haddockExecutables f
                   , haddockTestSuites  f
                   , haddockBenchmarks  f
                   , haddockForeignLibs f
                   ])
         (\v flags -&gt; flags { haddockExecutables = v
                            , haddockTestSuites  = v
                            , haddockBenchmarks  = v
                            , haddockForeignLibs = v
                            })
         trueArg

  ,option &quot;&quot; [&quot;internal&quot;]
   &quot;Run haddock for internal modules and include all symbols&quot;
   haddockInternal (\v flags -&gt; flags { haddockInternal = v })
   trueArg

  ,option &quot;&quot; [&quot;css&quot;]
   &quot;Use PATH as the haddock stylesheet&quot;
   haddockCss (\v flags -&gt; flags { haddockCss = v })
   (reqArgFlag &quot;PATH&quot;)

  ,option &quot;&quot; [&quot;hyperlink-source&quot;,&quot;hyperlink-sources&quot;,&quot;hyperlinked-source&quot;]
   &quot;Hyperlink the documentation to the source code&quot;
   haddockLinkedSource (\v flags -&gt; flags { haddockLinkedSource = v })
   trueArg

  ,option &quot;&quot; [&quot;quickjump&quot;]
   &quot;Generate an index for interactive documentation navigation&quot;
   haddockQuickJump (\v flags -&gt; flags { haddockQuickJump = v })
   trueArg

  ,option &quot;&quot; [&quot;hscolour-css&quot;]
   &quot;Use PATH as the HsColour stylesheet&quot;
   haddockHscolourCss (\v flags -&gt; flags { haddockHscolourCss = v })
   (reqArgFlag &quot;PATH&quot;)

  ,option &quot;&quot; [&quot;contents-location&quot;]
   &quot;Bake URL in as the location for the contents page&quot;
   haddockContents (\v flags -&gt; flags { haddockContents = v })
   (reqArg' &quot;URL&quot;
    (toFlag . toPathTemplate)
    (flagToList . fmap fromPathTemplate))
  ]

emptyHaddockFlags :: HaddockFlags
emptyHaddockFlags = mempty

instance Monoid HaddockFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup HaddockFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * Clean flags
-- ------------------------------------------------------------

data CleanFlags = CleanFlags {
    cleanSaveConf  :: Flag Bool,
    cleanDistPref  :: Flag FilePath,
    cleanVerbosity :: Flag Verbosity,
    cleanCabalFilePath :: Flag FilePath
  }
  deriving (Show, Generic)

defaultCleanFlags :: CleanFlags
defaultCleanFlags  = CleanFlags {
    cleanSaveConf  = Flag False,
    cleanDistPref  = NoFlag,
    cleanVerbosity = Flag normal,
    cleanCabalFilePath = mempty
  }

cleanCommand :: CommandUI CleanFlags
cleanCommand = CommandUI
  { commandName         = &quot;clean&quot;
  , commandSynopsis     = &quot;Clean up after a build.&quot;
  , commandDescription  = Just $ \_ -&gt;
      &quot;Removes .hi, .o, preprocessed sources, etc.\n&quot;
  , commandNotes        = Nothing
  , commandUsage        = \pname -&gt;
      &quot;Usage: &quot; ++ pname ++ &quot; clean [FLAGS]\n&quot;
  , commandDefaultFlags = defaultCleanFlags
  , commandOptions      = \showOrParseArgs -&gt;
      [optionVerbosity cleanVerbosity (\v flags -&gt; flags { cleanVerbosity = v })
      ,optionDistPref
         cleanDistPref (\d flags -&gt; flags { cleanDistPref = d })
         showOrParseArgs

      ,option &quot;s&quot; [&quot;save-configure&quot;]
         &quot;Do not remove the configuration file (dist/setup-config) during cleaning.  Saves need to reconfigure.&quot;
         cleanSaveConf (\v flags -&gt; flags { cleanSaveConf = v })
         trueArg
      ]
  }

emptyCleanFlags :: CleanFlags
emptyCleanFlags = mempty

instance Monoid CleanFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup CleanFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * Build flags
-- ------------------------------------------------------------

data BuildFlags = BuildFlags {
    buildProgramPaths :: [(String, FilePath)],
    buildProgramArgs :: [(String, [String])],
    buildDistPref    :: Flag FilePath,
    buildVerbosity   :: Flag Verbosity,
    buildNumJobs     :: Flag (Maybe Int),
    -- TODO: this one should not be here, it's just that the silly
    -- UserHooks stop us from passing extra info in other ways
    buildArgs :: [String],
    buildCabalFilePath :: Flag FilePath
  }
  deriving (Read, Show, Generic)

{-# DEPRECATED buildVerbose &quot;Use buildVerbosity instead&quot; #-}
buildVerbose :: BuildFlags -&gt; Verbosity
buildVerbose = fromFlagOrDefault normal . buildVerbosity

defaultBuildFlags :: BuildFlags
defaultBuildFlags  = BuildFlags {
    buildProgramPaths = mempty,
    buildProgramArgs = [],
    buildDistPref    = mempty,
    buildVerbosity   = Flag normal,
    buildNumJobs     = mempty,
    buildArgs        = [],
    buildCabalFilePath = mempty
  }

buildCommand :: ProgramDb -&gt; CommandUI BuildFlags
buildCommand progDb = CommandUI
  { commandName         = &quot;build&quot;
  , commandSynopsis     = &quot;Compile all/specific components.&quot;
  , commandDescription  = Just $ \_ -&gt; wrapText $
         &quot;Components encompass executables, tests, and benchmarks.\n&quot;
      ++ &quot;\n&quot;
      ++ &quot;Affected by configuration options, see `configure`.\n&quot;
  , commandNotes        = Just $ \pname -&gt;
       &quot;Examples:\n&quot;
        ++ &quot;  &quot; ++ pname ++ &quot; build           &quot;
        ++ &quot;    All the components in the package\n&quot;
        ++ &quot;  &quot; ++ pname ++ &quot; build foo       &quot;
        ++ &quot;    A component (i.e. lib, exe, test suite)\n\n&quot;
        ++ programFlagsDescription progDb
--TODO: re-enable once we have support for module/file targets
--        ++ &quot;  &quot; ++ pname ++ &quot; build Foo.Bar   &quot;
--        ++ &quot;    A module\n&quot;
--        ++ &quot;  &quot; ++ pname ++ &quot; build Foo/Bar.hs&quot;
--        ++ &quot;    A file\n\n&quot;
--        ++ &quot;If a target is ambiguous it can be qualified with the component &quot;
--        ++ &quot;name, e.g.\n&quot;
--        ++ &quot;  &quot; ++ pname ++ &quot; build foo:Foo.Bar\n&quot;
--        ++ &quot;  &quot; ++ pname ++ &quot; build testsuite1:Foo/Bar.hs\n&quot;
  , commandUsage        = usageAlternatives &quot;build&quot; $
      [ &quot;[FLAGS]&quot;
      , &quot;COMPONENTS [FLAGS]&quot;
      ]
  , commandDefaultFlags = defaultBuildFlags
  , commandOptions      = \showOrParseArgs -&gt;
      [ optionVerbosity
        buildVerbosity (\v flags -&gt; flags { buildVerbosity = v })

      , optionDistPref
        buildDistPref (\d flags -&gt; flags { buildDistPref = d }) showOrParseArgs
      ]
      ++ buildOptions progDb showOrParseArgs
  }

buildOptions :: ProgramDb -&gt; ShowOrParseArgs
                -&gt; [OptionField BuildFlags]
buildOptions progDb showOrParseArgs =
  [ optionNumJobs
      buildNumJobs (\v flags -&gt; flags { buildNumJobs = v })
  ]

  ++ programDbPaths progDb showOrParseArgs
       buildProgramPaths (\v flags -&gt; flags { buildProgramPaths = v})

  ++ programDbOption progDb showOrParseArgs
       buildProgramArgs (\v fs -&gt; fs { buildProgramArgs = v })

  ++ programDbOptions progDb showOrParseArgs
       buildProgramArgs (\v flags -&gt; flags { buildProgramArgs = v})

emptyBuildFlags :: BuildFlags
emptyBuildFlags = mempty

instance Monoid BuildFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup BuildFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * REPL Flags
-- ------------------------------------------------------------

data ReplFlags = ReplFlags {
    replProgramPaths :: [(String, FilePath)],
    replProgramArgs :: [(String, [String])],
    replDistPref    :: Flag FilePath,
    replVerbosity   :: Flag Verbosity,
    replReload      :: Flag Bool,
    replReplOptions :: [String]
  }
  deriving (Show, Generic)

defaultReplFlags :: ReplFlags
defaultReplFlags  = ReplFlags {
    replProgramPaths = mempty,
    replProgramArgs = [],
    replDistPref    = NoFlag,
    replVerbosity   = Flag normal,
    replReload      = Flag False,
    replReplOptions = []
  }

instance Monoid ReplFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup ReplFlags where
  (&lt;&gt;) = gmappend

replCommand :: ProgramDb -&gt; CommandUI ReplFlags
replCommand progDb = CommandUI
  { commandName         = &quot;repl&quot;
  , commandSynopsis     =
      &quot;Open an interpreter session for the given component.&quot;
  , commandDescription  = Just $ \pname -&gt; wrapText $
         &quot;If the current directory contains no package, ignores COMPONENT &quot;
      ++ &quot;parameters and opens an interactive interpreter session; if a &quot;
      ++ &quot;sandbox is present, its package database will be used.\n&quot;
      ++ &quot;\n&quot;
      ++ &quot;Otherwise, (re)configures with the given or default flags, and &quot;
      ++ &quot;loads the interpreter with the relevant modules. For executables, &quot;
      ++ &quot;tests and benchmarks, loads the main module (and its &quot;
      ++ &quot;dependencies); for libraries all exposed/other modules.\n&quot;
      ++ &quot;\n&quot;
      ++ &quot;The default component is the library itself, or the executable &quot;
      ++ &quot;if that is the only component.\n&quot;
      ++ &quot;\n&quot;
      ++ &quot;Support for loading specific modules is planned but not &quot;
      ++ &quot;implemented yet. For certain scenarios, `&quot; ++ pname
      ++ &quot; exec -- ghci :l Foo` may be used instead. Note that `exec` will &quot;
      ++ &quot;not (re)configure and you will have to specify the location of &quot;
      ++ &quot;other modules, if required.\n&quot;

  , commandNotes        = Just $ \pname -&gt;
         &quot;Examples:\n&quot;
      ++ &quot;  &quot; ++ pname ++ &quot; repl           &quot;
      ++ &quot;    The first component in the package\n&quot;
      ++ &quot;  &quot; ++ pname ++ &quot; repl foo       &quot;
      ++ &quot;    A named component (i.e. lib, exe, test suite)\n&quot;
      ++ &quot;  &quot; ++ pname ++ &quot; repl --repl-options=\&quot;-lstdc++\&quot;&quot;
      ++ &quot;  Specifying flags for interpreter\n&quot;
--TODO: re-enable once we have support for module/file targets
--        ++ &quot;  &quot; ++ pname ++ &quot; repl Foo.Bar   &quot;
--        ++ &quot;    A module\n&quot;
--        ++ &quot;  &quot; ++ pname ++ &quot; repl Foo/Bar.hs&quot;
--        ++ &quot;    A file\n\n&quot;
--        ++ &quot;If a target is ambiguous it can be qualified with the component &quot;
--        ++ &quot;name, e.g.\n&quot;
--        ++ &quot;  &quot; ++ pname ++ &quot; repl foo:Foo.Bar\n&quot;
--        ++ &quot;  &quot; ++ pname ++ &quot; repl testsuite1:Foo/Bar.hs\n&quot;
  , commandUsage =  \pname -&gt; &quot;Usage: &quot; ++ pname ++ &quot; repl [COMPONENT] [FLAGS]\n&quot;
  , commandDefaultFlags = defaultReplFlags
  , commandOptions = \showOrParseArgs -&gt;
      optionVerbosity replVerbosity (\v flags -&gt; flags { replVerbosity = v })
      : optionDistPref
          replDistPref (\d flags -&gt; flags { replDistPref = d })
          showOrParseArgs

      : programDbPaths   progDb showOrParseArgs
          replProgramPaths (\v flags -&gt; flags { replProgramPaths = v})

     ++ programDbOption progDb showOrParseArgs
          replProgramArgs (\v flags -&gt; flags { replProgramArgs = v})

     ++ programDbOptions progDb showOrParseArgs
          replProgramArgs (\v flags -&gt; flags { replProgramArgs = v})

     ++ case showOrParseArgs of
          ParseArgs -&gt;
            [ option &quot;&quot; [&quot;reload&quot;]
              &quot;Used from within an interpreter to update files.&quot;
              replReload (\v flags -&gt; flags { replReload = v })
              trueArg
            ]
          _ -&gt; []
     ++ map liftReplOption (replOptions showOrParseArgs)
  }
  where
    liftReplOption = liftOption replReplOptions (\v flags -&gt; flags { replReplOptions = v })

replOptions :: ShowOrParseArgs -&gt; [OptionField [String]]
replOptions _ = [ option [] [&quot;repl-options&quot;] &quot;use this option for the repl&quot; id
              const (reqArg &quot;FLAG&quot; (succeedReadE (:[])) id) ]

-- ------------------------------------------------------------
-- * Test flags
-- ------------------------------------------------------------

data TestShowDetails = Never | Failures | Always | Streaming | Direct
    deriving (Eq, Ord, Enum, Bounded, Show)

knownTestShowDetails :: [TestShowDetails]
knownTestShowDetails = [minBound..maxBound]

instance Pretty TestShowDetails where
    pretty  = Disp.text . lowercase . show

instance Parsec TestShowDetails where
    parsec = maybe (fail &quot;invalid TestShowDetails&quot;) return . classify =&lt;&lt; ident
      where
        ident        = P.munch1 (\c -&gt; isAlpha c || c == '_' || c == '-')
        classify str = lookup (lowercase str) enumMap
        enumMap     :: [(String, TestShowDetails)]
        enumMap      = [ (display x, x)
                       | x &lt;- knownTestShowDetails ]

instance Text TestShowDetails where
    parse = maybe Parse.pfail return . classify =&lt;&lt; ident
      where
        ident        = Parse.munch1 (\c -&gt; isAlpha c || c == '_' || c == '-')
        classify str = lookup (lowercase str) enumMap
        enumMap     :: [(String, TestShowDetails)]
        enumMap      = [ (display x, x)
                       | x &lt;- knownTestShowDetails ]

--TODO: do we need this instance?
instance Monoid TestShowDetails where
    mempty = Never
    mappend = (&lt;&gt;)

instance Semigroup TestShowDetails where
    a &lt;&gt; b = if a &lt; b then b else a

data TestFlags = TestFlags {
    testDistPref    :: Flag FilePath,
    testVerbosity   :: Flag Verbosity,
    testHumanLog    :: Flag PathTemplate,
    testMachineLog  :: Flag PathTemplate,
    testShowDetails :: Flag TestShowDetails,
    testKeepTix     :: Flag Bool,
    -- TODO: think about if/how options are passed to test exes
    testOptions     :: [PathTemplate]
  } deriving (Generic)

defaultTestFlags :: TestFlags
defaultTestFlags  = TestFlags {
    testDistPref    = NoFlag,
    testVerbosity   = Flag normal,
    testHumanLog    = toFlag $ toPathTemplate $ &quot;$pkgid-$test-suite.log&quot;,
    testMachineLog  = toFlag $ toPathTemplate $ &quot;$pkgid.log&quot;,
    testShowDetails = toFlag Failures,
    testKeepTix     = toFlag False,
    testOptions     = []
  }

testCommand :: CommandUI TestFlags
testCommand = CommandUI
  { commandName         = &quot;test&quot;
  , commandSynopsis     =
      &quot;Run all/specific tests in the test suite.&quot;
  , commandDescription  = Just $ \pname -&gt; wrapText $
         &quot;If necessary (re)configures with `--enable-tests` flag and builds&quot;
      ++ &quot; the test suite.\n&quot;
      ++ &quot;\n&quot;
      ++ &quot;Remember that the tests' dependencies must be installed if there&quot;
      ++ &quot; are additional ones; e.g. with `&quot; ++ pname
      ++ &quot; install --only-dependencies --enable-tests`.\n&quot;
      ++ &quot;\n&quot;
      ++ &quot;By defining UserHooks in a custom Setup.hs, the package can&quot;
      ++ &quot; define actions to be executed before and after running tests.\n&quot;
  , commandNotes        = Nothing
  , commandUsage        = usageAlternatives &quot;test&quot;
      [ &quot;[FLAGS]&quot;
      , &quot;TESTCOMPONENTS [FLAGS]&quot;
      ]
  , commandDefaultFlags = defaultTestFlags
  , commandOptions = \showOrParseArgs -&gt;
      [ optionVerbosity testVerbosity (\v flags -&gt; flags { testVerbosity = v })
      , optionDistPref
            testDistPref (\d flags -&gt; flags { testDistPref = d })
            showOrParseArgs
      , option [] [&quot;log&quot;]
            (&quot;Log all test suite results to file (name template can use &quot;
            ++ &quot;$pkgid, $compiler, $os, $arch, $test-suite, $result)&quot;)
            testHumanLog (\v flags -&gt; flags { testHumanLog = v })
            (reqArg' &quot;TEMPLATE&quot;
                (toFlag . toPathTemplate)
                (flagToList . fmap fromPathTemplate))
      , option [] [&quot;machine-log&quot;]
            (&quot;Produce a machine-readable log file (name template can use &quot;
            ++ &quot;$pkgid, $compiler, $os, $arch, $result)&quot;)
            testMachineLog (\v flags -&gt; flags { testMachineLog = v })
            (reqArg' &quot;TEMPLATE&quot;
                (toFlag . toPathTemplate)
                (flagToList . fmap fromPathTemplate))
      , option [] [&quot;show-details&quot;]
            (&quot;'always': always show results of individual test cases. &quot;
             ++ &quot;'never': never show results of individual test cases. &quot;
             ++ &quot;'failures': show results of failing test cases. &quot;
             ++ &quot;'streaming': show results of test cases in real time.&quot;
             ++ &quot;'direct': send results of test cases in real time; no log file.&quot;)
            testShowDetails (\v flags -&gt; flags { testShowDetails = v })
            (reqArg &quot;FILTER&quot;
                (parsecToReadE (\_ -&gt; &quot;--show-details flag expects one of &quot;
                              ++ intercalate &quot;, &quot;
                                   (map display knownTestShowDetails))
                            (fmap toFlag parsec))
                (flagToList . fmap display))
      , option [] [&quot;keep-tix-files&quot;]
            &quot;keep .tix files for HPC between test runs&quot;
            testKeepTix (\v flags -&gt; flags { testKeepTix = v})
            trueArg
      , option [] [&quot;test-options&quot;]
            (&quot;give extra options to test executables &quot;
             ++ &quot;(name templates can use $pkgid, $compiler, &quot;
             ++ &quot;$os, $arch, $test-suite)&quot;)
            testOptions (\v flags -&gt; flags { testOptions = v })
            (reqArg' &quot;TEMPLATES&quot; (map toPathTemplate . splitArgs)
                (const []))
      , option [] [&quot;test-option&quot;]
            (&quot;give extra option to test executables &quot;
             ++ &quot;(no need to quote options containing spaces, &quot;
             ++ &quot;name template can use $pkgid, $compiler, &quot;
             ++ &quot;$os, $arch, $test-suite)&quot;)
            testOptions (\v flags -&gt; flags { testOptions = v })
            (reqArg' &quot;TEMPLATE&quot; (\x -&gt; [toPathTemplate x])
                (map fromPathTemplate))
      ]
  }

emptyTestFlags :: TestFlags
emptyTestFlags  = mempty

instance Monoid TestFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup TestFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * Benchmark flags
-- ------------------------------------------------------------

data BenchmarkFlags = BenchmarkFlags {
    benchmarkDistPref  :: Flag FilePath,
    benchmarkVerbosity :: Flag Verbosity,
    benchmarkOptions   :: [PathTemplate]
  } deriving (Generic)

defaultBenchmarkFlags :: BenchmarkFlags
defaultBenchmarkFlags  = BenchmarkFlags {
    benchmarkDistPref  = NoFlag,
    benchmarkVerbosity = Flag normal,
    benchmarkOptions   = []
  }

benchmarkCommand :: CommandUI BenchmarkFlags
benchmarkCommand = CommandUI
  { commandName         = &quot;bench&quot;
  , commandSynopsis     =
      &quot;Run all/specific benchmarks.&quot;
  , commandDescription  = Just $ \pname -&gt; wrapText $
         &quot;If necessary (re)configures with `--enable-benchmarks` flag and&quot;
      ++ &quot; builds the benchmarks.\n&quot;
      ++ &quot;\n&quot;
      ++ &quot;Remember that the benchmarks' dependencies must be installed if&quot;
      ++ &quot; there are additional ones; e.g. with `&quot; ++ pname
      ++ &quot; install --only-dependencies --enable-benchmarks`.\n&quot;
      ++ &quot;\n&quot;
      ++ &quot;By defining UserHooks in a custom Setup.hs, the package can&quot;
      ++ &quot; define actions to be executed before and after running&quot;
      ++ &quot; benchmarks.\n&quot;
  , commandNotes        = Nothing
  , commandUsage        = usageAlternatives &quot;bench&quot;
      [ &quot;[FLAGS]&quot;
      , &quot;BENCHCOMPONENTS [FLAGS]&quot;
      ]
  , commandDefaultFlags = defaultBenchmarkFlags
  , commandOptions = \showOrParseArgs -&gt;
      [ optionVerbosity benchmarkVerbosity
        (\v flags -&gt; flags { benchmarkVerbosity = v })
      , optionDistPref
            benchmarkDistPref (\d flags -&gt; flags { benchmarkDistPref = d })
            showOrParseArgs
      , option [] [&quot;benchmark-options&quot;]
            (&quot;give extra options to benchmark executables &quot;
             ++ &quot;(name templates can use $pkgid, $compiler, &quot;
             ++ &quot;$os, $arch, $benchmark)&quot;)
            benchmarkOptions (\v flags -&gt; flags { benchmarkOptions = v })
            (reqArg' &quot;TEMPLATES&quot; (map toPathTemplate . splitArgs)
                (const []))
      , option [] [&quot;benchmark-option&quot;]
            (&quot;give extra option to benchmark executables &quot;
             ++ &quot;(no need to quote options containing spaces, &quot;
             ++ &quot;name template can use $pkgid, $compiler, &quot;
             ++ &quot;$os, $arch, $benchmark)&quot;)
            benchmarkOptions (\v flags -&gt; flags { benchmarkOptions = v })
            (reqArg' &quot;TEMPLATE&quot; (\x -&gt; [toPathTemplate x])
                (map fromPathTemplate))
      ]
  }

emptyBenchmarkFlags :: BenchmarkFlags
emptyBenchmarkFlags = mempty

instance Monoid BenchmarkFlags where
  mempty = gmempty
  mappend = (&lt;&gt;)

instance Semigroup BenchmarkFlags where
  (&lt;&gt;) = gmappend

-- ------------------------------------------------------------
-- * Shared options utils
-- ------------------------------------------------------------

programFlagsDescription :: ProgramDb -&gt; String
programFlagsDescription progDb =
     &quot;The flags --with-PROG and --PROG-option(s) can be used with&quot;
  ++ &quot; the following programs:&quot;
  ++ (concatMap (\line -&gt; &quot;\n  &quot; ++ unwords line) . wrapLine 77 . sort)
     [ programName prog | (prog, _) &lt;- knownPrograms progDb ]
  ++ &quot;\n&quot;

-- | For each known program @PROG@ in 'progDb', produce a @with-PROG@
-- 'OptionField'.
programDbPaths
  :: ProgramDb
  -&gt; ShowOrParseArgs
  -&gt; (flags -&gt; [(String, FilePath)])
  -&gt; ([(String, FilePath)] -&gt; (flags -&gt; flags))
  -&gt; [OptionField flags]
programDbPaths progDb showOrParseArgs get set =
  programDbPaths' (&quot;with-&quot; ++) progDb showOrParseArgs get set

{-# DEPRECATED programConfigurationPaths' &quot;Use programDbPaths' instead&quot; #-}

-- | Like 'programDbPaths', but allows to customise the option name.
programDbPaths', programConfigurationPaths'
  :: (String -&gt; String)
  -&gt; ProgramDb
  -&gt; ShowOrParseArgs
  -&gt; (flags -&gt; [(String, FilePath)])
  -&gt; ([(String, FilePath)] -&gt; (flags -&gt; flags))
  -&gt; [OptionField flags]

programConfigurationPaths' = programDbPaths'

programDbPaths' mkName progDb showOrParseArgs get set =
  case showOrParseArgs of
    -- we don't want a verbose help text list so we just show a generic one:
    ShowArgs  -&gt; [withProgramPath &quot;PROG&quot;]
    ParseArgs -&gt; map (withProgramPath . programName . fst)
                 (knownPrograms progDb)
  where
    withProgramPath prog =
      option &quot;&quot; [mkName prog]
        (&quot;give the path to &quot; ++ prog)
        get set
        (reqArg' &quot;PATH&quot; (\path -&gt; [(prog, path)])
          (\progPaths -&gt; [ path | (prog', path) &lt;- progPaths, prog==prog' ]))

-- | For each known program @PROG@ in 'progDb', produce a @PROG-option@
-- 'OptionField'.
programDbOption
  :: ProgramDb
  -&gt; ShowOrParseArgs
  -&gt; (flags -&gt; [(String, [String])])
  -&gt; ([(String, [String])] -&gt; (flags -&gt; flags))
  -&gt; [OptionField flags]
programDbOption progDb showOrParseArgs get set =
  case showOrParseArgs of
    -- we don't want a verbose help text list so we just show a generic one:
    ShowArgs  -&gt; [programOption &quot;PROG&quot;]
    ParseArgs -&gt; map (programOption  . programName . fst)
                 (knownPrograms progDb)
  where
    programOption prog =
      option &quot;&quot; [prog ++ &quot;-option&quot;]
        (&quot;give an extra option to &quot; ++ prog ++
         &quot; (no need to quote options containing spaces)&quot;)
        get set
        (reqArg' &quot;OPT&quot; (\arg -&gt; [(prog, [arg])])
           (\progArgs -&gt; concat [ args
                                | (prog', args) &lt;- progArgs, prog==prog' ]))

{-# DEPRECATED programConfigurationOptions &quot;Use programDbOptions instead&quot; #-}

-- | For each known program @PROG@ in 'progDb', produce a @PROG-options@
-- 'OptionField'.
programDbOptions, programConfigurationOptions
  :: ProgramDb
  -&gt; ShowOrParseArgs
  -&gt; (flags -&gt; [(String, [String])])
  -&gt; ([(String, [String])] -&gt; (flags -&gt; flags))
  -&gt; [OptionField flags]

programConfigurationOptions = programDbOptions

programDbOptions progDb showOrParseArgs get set =
  case showOrParseArgs of
    -- we don't want a verbose help text list so we just show a generic one:
    ShowArgs  -&gt; [programOptions  &quot;PROG&quot;]
    ParseArgs -&gt; map (programOptions . programName . fst)
                 (knownPrograms progDb)
  where
    programOptions prog =
      option &quot;&quot; [prog ++ &quot;-options&quot;]
        (&quot;give extra options to &quot; ++ prog)
        get set
        (reqArg' &quot;OPTS&quot; (\args -&gt; [(prog, splitArgs args)]) (const []))

-- ------------------------------------------------------------
-- * GetOpt Utils
-- ------------------------------------------------------------

boolOpt :: SFlags -&gt; SFlags
           -&gt; MkOptDescr (a -&gt; Flag Bool) (Flag Bool -&gt; a -&gt; a) a
boolOpt  = Command.boolOpt  flagToMaybe Flag

boolOpt' :: OptFlags -&gt; OptFlags
            -&gt; MkOptDescr (a -&gt; Flag Bool) (Flag Bool -&gt; a -&gt; a) a
boolOpt' = Command.boolOpt' flagToMaybe Flag

trueArg, falseArg :: MkOptDescr (a -&gt; Flag Bool) (Flag Bool -&gt; a -&gt; a) a
trueArg  sfT lfT = boolOpt' (sfT, lfT) ([], [])   sfT lfT
falseArg sfF lfF = boolOpt' ([],  [])  (sfF, lfF) sfF lfF

reqArgFlag :: ArgPlaceHolder -&gt; SFlags -&gt; LFlags -&gt; Description -&gt;
              (b -&gt; Flag String) -&gt; (Flag String -&gt; b -&gt; b) -&gt; OptDescr b
reqArgFlag ad = reqArg ad (succeedReadE Flag) flagToList

optionDistPref :: (flags -&gt; Flag FilePath)
               -&gt; (Flag FilePath -&gt; flags -&gt; flags)
               -&gt; ShowOrParseArgs
               -&gt; OptionField flags
optionDistPref get set = \showOrParseArgs -&gt;
  option &quot;&quot; (distPrefFlagName showOrParseArgs)
    (   &quot;The directory where Cabal puts generated build files &quot;
     ++ &quot;(default &quot; ++ defaultDistPref ++ &quot;)&quot;)
    get set
    (reqArgFlag &quot;DIR&quot;)
  where
    distPrefFlagName ShowArgs  = [&quot;builddir&quot;]
    distPrefFlagName ParseArgs = [&quot;builddir&quot;, &quot;distdir&quot;, &quot;distpref&quot;]

optionVerbosity :: (flags -&gt; Flag Verbosity)
                -&gt; (Flag Verbosity -&gt; flags -&gt; flags)
                -&gt; OptionField flags
optionVerbosity get set =
  option &quot;v&quot; [&quot;verbose&quot;]
    &quot;Control verbosity (n is 0--3, default verbosity level is 1)&quot;
    get set
    (optArg &quot;n&quot; (fmap Flag flagToVerbosity)
                (Flag verbose) -- default Value if no n is given
                (fmap (Just . showForCabal) . flagToList))

optionNumJobs :: (flags -&gt; Flag (Maybe Int))
              -&gt; (Flag (Maybe Int) -&gt; flags -&gt; flags)
              -&gt; OptionField flags
optionNumJobs get set =
  option &quot;j&quot; [&quot;jobs&quot;]
    &quot;Run NUM jobs simultaneously (or '$ncpus' if no NUM is given).&quot;
    get set
    (optArg &quot;NUM&quot; (fmap Flag numJobsParser)
                  (Flag Nothing)
                  (map (Just . maybe &quot;$ncpus&quot; show) . flagToList))
  where
    numJobsParser :: ReadE (Maybe Int)
    numJobsParser = ReadE $ \s -&gt;
      case s of
        &quot;$ncpus&quot; -&gt; Right Nothing
        _        -&gt; case reads s of
          [(n, &quot;&quot;)]
            | n &lt; 1     -&gt; Left &quot;The number of jobs should be 1 or more.&quot;
            | otherwise -&gt; Right (Just n)
          _             -&gt; Left &quot;The jobs value should be a number or '$ncpus'&quot;

-- ------------------------------------------------------------
-- * Other Utils
-- ------------------------------------------------------------

-- | Arguments to pass to a @configure@ script, e.g. generated by
-- @autoconf@.
configureArgs :: Bool -&gt; ConfigFlags -&gt; [String]
configureArgs bcHack flags
  = hc_flag
 ++ optFlag  &quot;with-hc-pkg&quot; configHcPkg
 ++ optFlag' &quot;prefix&quot;      prefix
 ++ optFlag' &quot;bindir&quot;      bindir
 ++ optFlag' &quot;libdir&quot;      libdir
 ++ optFlag' &quot;libexecdir&quot;  libexecdir
 ++ optFlag' &quot;datadir&quot;     datadir
 ++ optFlag' &quot;sysconfdir&quot;  sysconfdir
 ++ configConfigureArgs flags
  where
        hc_flag = case (configHcFlavor flags, configHcPath flags) of
                        (_, Flag hc_path) -&gt; [hc_flag_name ++ hc_path]
                        (Flag hc, NoFlag) -&gt; [hc_flag_name ++ display hc]
                        (NoFlag,NoFlag)   -&gt; []
        hc_flag_name
            --TODO kill off thic bc hack when defaultUserHooks is removed.
            | bcHack    = &quot;--with-hc=&quot;
            | otherwise = &quot;--with-compiler=&quot;
        optFlag name config_field = case config_field flags of
                        Flag p -&gt; [&quot;--&quot; ++ name ++ &quot;=&quot; ++ p]
                        NoFlag -&gt; []
        optFlag' name config_field = optFlag name (fmap fromPathTemplate
                                                 . config_field
                                                 . configInstallDirs)

configureCCompiler :: Verbosity -&gt; ProgramDb
                      -&gt; IO (FilePath, [String])
configureCCompiler verbosity progdb = configureProg verbosity progdb gccProgram

configureLinker :: Verbosity -&gt; ProgramDb -&gt; IO (FilePath, [String])
configureLinker verbosity progdb = configureProg verbosity progdb ldProgram

configureProg :: Verbosity -&gt; ProgramDb -&gt; Program
                 -&gt; IO (FilePath, [String])
configureProg verbosity programDb prog = do
    (p, _) &lt;- requireProgram verbosity prog programDb
    let pInv = programInvocation p []
    return (progInvokePath pInv, progInvokeArgs pInv)

-- | Helper function to split a string into a list of arguments.
-- It's supposed to handle quoted things sensibly, eg:
--
-- &gt; splitArgs &quot;--foo=\&quot;C:/Program Files/Bar/&quot; --baz&quot;
-- &gt;   = [&quot;--foo=C:/Program Files/Bar&quot;, &quot;--baz&quot;]
--
-- &gt; splitArgs &quot;\&quot;-DMSGSTR=\\\&quot;foo bar\\\&quot;\&quot; --baz&quot;
-- &gt;   = [&quot;-DMSGSTR=\&quot;foo bar\&quot;&quot;,&quot;--baz&quot;]
--
splitArgs :: String -&gt; [String]
splitArgs  = space []
  where
    space :: String -&gt; String -&gt; [String]
    space w []      = word w []
    space w ( c :s)
        | isSpace c = word w (space [] s)
    space w ('&quot;':s) = string w s
    space w s       = nonstring w s

    string :: String -&gt; String -&gt; [String]
    string w []      = word w []
    string w ('&quot;':s) = space w s
    string w ('\\':'&quot;':s) = string ('&quot;':w) s
    string w ( c :s) = string (c:w) s

    nonstring :: String -&gt; String -&gt; [String]
    nonstring w  []      = word w []
    nonstring w  ('&quot;':s) = string w s
    nonstring w  ( c :s) = space (c:w) s

    word [] s = s
    word w  s = reverse w : s

-- The test cases kinda have to be rewritten from the ground up... :/
--hunitTests :: [Test]
--hunitTests =
--    let m = [(&quot;ghc&quot;, GHC), (&quot;nhc98&quot;, NHC), (&quot;hugs&quot;, Hugs)]
--        (flags, commands', unkFlags, ers)
--               = getOpt Permute options [&quot;configure&quot;, &quot;foobar&quot;, &quot;--prefix=/foo&quot;, &quot;--ghc&quot;, &quot;--nhc98&quot;, &quot;--hugs&quot;, &quot;--with-compiler=/comp&quot;, &quot;--unknown1&quot;, &quot;--unknown2&quot;, &quot;--install-prefix=/foo&quot;, &quot;--user&quot;, &quot;--global&quot;]
--       in  [TestLabel &quot;very basic option parsing&quot; $ TestList [
--                 &quot;getOpt flags&quot; ~: &quot;failed&quot; ~:
--                 [Prefix &quot;/foo&quot;, GhcFlag, NhcFlag, HugsFlag,
--                  WithCompiler &quot;/comp&quot;, InstPrefix &quot;/foo&quot;, UserFlag, GlobalFlag]
--                 ~=? flags,
--                 &quot;getOpt commands&quot; ~: &quot;failed&quot; ~: [&quot;configure&quot;, &quot;foobar&quot;] ~=? commands',
--                 &quot;getOpt unknown opts&quot; ~: &quot;failed&quot; ~:
--                      [&quot;--unknown1&quot;, &quot;--unknown2&quot;] ~=? unkFlags,
--                 &quot;getOpt errors&quot; ~: &quot;failed&quot; ~: [] ~=? ers],
--
--               TestLabel &quot;test location of various compilers&quot; $ TestList
--               [&quot;configure parsing for prefix and compiler flag&quot; ~: &quot;failed&quot; ~:
--                    (Right (ConfigCmd (Just comp, Nothing, Just &quot;/usr/local&quot;), []))
--                   ~=? (parseArgs [&quot;--prefix=/usr/local&quot;, &quot;--&quot;++name, &quot;configure&quot;])
--                   | (name, comp) &lt;- m],
--
--               TestLabel &quot;find the package tool&quot; $ TestList
--               [&quot;configure parsing for prefix comp flag, withcompiler&quot; ~: &quot;failed&quot; ~:
--                    (Right (ConfigCmd (Just comp, Just &quot;/foo/comp&quot;, Just &quot;/usr/local&quot;), []))
--                   ~=? (parseArgs [&quot;--prefix=/usr/local&quot;, &quot;--&quot;++name,
--                                   &quot;--with-compiler=/foo/comp&quot;, &quot;configure&quot;])
--                   | (name, comp) &lt;- m],
--
--               TestLabel &quot;simpler commands&quot; $ TestList
--               [flag ~: &quot;failed&quot; ~: (Right (flagCmd, [])) ~=? (parseArgs [flag])
--                   | (flag, flagCmd) &lt;- [(&quot;build&quot;, BuildCmd),
--                                         (&quot;install&quot;, InstallCmd Nothing False),
--                                         (&quot;sdist&quot;, SDistCmd),
--                                         (&quot;register&quot;, RegisterCmd False)]
--                  ]
--               ]

{- Testing ideas:
   * IO to look for hugs and hugs-pkg (which hugs, etc)
   * quickCheck to test permutations of arguments
   * what other options can we over-ride with a command-line flag?
-}
</span></pre></body></html>