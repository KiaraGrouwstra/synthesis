<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Module      :  Distribution.Simple.LocalBuildInfo</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Copyright   :  Isaac Jones 2003-2004</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- License     :  BSD3</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Maintainer  :  cabal-devel@haskell.org</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-13"></a><span class="hs-comment">--</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- Once a package has been configured we have resolved conditionals and</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- dependencies, configured the compiler and other needed external programs.</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- The 'LocalBuildInfo' is used to hold all this information. It holds the</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- install dirs, the compiler, the exact package dependencies, the configured</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- programs, the package database to use and a bunch of miscellaneous configure</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- flags. It gets saved and reloaded from a file (@dist\/setup-config@). It gets</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- passed in to very many subsequent build actions.</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Distribution.Simple.LocalBuildInfo</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-23"></a><span>        </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="Distribution.Types.LocalBuildInfo.html#externalPackageDeps"><span class="hs-identifier hs-var">externalPackageDeps</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="Distribution.Types.LocalBuildInfo.html#localComponentId"><span class="hs-identifier hs-var">localComponentId</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="Distribution.Types.LocalBuildInfo.html#localUnitId"><span class="hs-identifier hs-var">localUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="Distribution.Types.LocalBuildInfo.html#localCompatPackageKey"><span class="hs-identifier hs-var">localCompatPackageKey</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>        </span><span class="hs-comment">-- * Buildable package components</span><span>
</span><a name="line-30"></a><span>        </span><a href="Distribution.Types.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="Distribution.Types.ComponentName.html#ComponentName"><span class="hs-identifier hs-type">ComponentName</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="Distribution.Types.ComponentName.html#defaultLibName"><span class="hs-identifier hs-var">defaultLibName</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>        </span><a href="Distribution.Types.ComponentName.html#showComponentName"><span class="hs-identifier hs-var">showComponentName</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>        </span><a href="Distribution.Types.ComponentName.html#componentNameString"><span class="hs-identifier hs-var">componentNameString</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#componentBuildDir"><span class="hs-identifier hs-var">componentBuildDir</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="Distribution.Types.Component.html#foldComponent"><span class="hs-identifier hs-var">foldComponent</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="Distribution.Types.Component.html#componentName"><span class="hs-identifier hs-var">componentName</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>        </span><a href="Distribution.Types.Component.html#componentBuildInfo"><span class="hs-identifier hs-var">componentBuildInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="Distribution.Types.Component.html#componentBuildable"><span class="hs-identifier hs-var">componentBuildable</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="Distribution.Types.PackageDescription.html#pkgComponents"><span class="hs-identifier hs-var">pkgComponents</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>        </span><a href="Distribution.Types.PackageDescription.html#pkgBuildableComponents"><span class="hs-identifier hs-var">pkgBuildableComponents</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="Distribution.Types.PackageDescription.html#lookupComponent"><span class="hs-identifier hs-var">lookupComponent</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="Distribution.Types.PackageDescription.html#getComponent"><span class="hs-identifier hs-var">getComponent</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#getComponentLocalBuildInfo"><span class="hs-identifier hs-var">getComponentLocalBuildInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#allComponentsInBuildOrder"><span class="hs-identifier hs-var">allComponentsInBuildOrder</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#componentsInBuildOrder"><span class="hs-identifier hs-var">componentsInBuildOrder</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#depLibraryPaths"><span class="hs-identifier hs-var">depLibraryPaths</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier hs-var">allLibModules</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#withAllComponentsInBuildOrder"><span class="hs-identifier hs-var">withAllComponentsInBuildOrder</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#withComponentsInBuildOrder"><span class="hs-identifier hs-var">withComponentsInBuildOrder</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#withComponentsLBI"><span class="hs-identifier hs-var">withComponentsLBI</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#withLibLBI"><span class="hs-identifier hs-var">withLibLBI</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#withExeLBI"><span class="hs-identifier hs-var">withExeLBI</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#withBenchLBI"><span class="hs-identifier hs-var">withBenchLBI</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#withTestLBI"><span class="hs-identifier hs-var">withTestLBI</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#enabledTestLBIs"><span class="hs-identifier hs-var">enabledTestLBIs</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#enabledBenchLBIs"><span class="hs-identifier hs-var">enabledBenchLBIs</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span>        </span><span class="hs-comment">-- * Installation directories</span><span>
</span><a name="line-62"></a><span>        </span><span class="hs-keyword">module</span><span> </span><a href="Distribution.Simple.InstallDirs.html"><span class="hs-identifier">Distribution.Simple.InstallDirs</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#absoluteInstallDirs"><span class="hs-identifier hs-var">absoluteInstallDirs</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#prefixRelativeInstallDirs"><span class="hs-identifier hs-var">prefixRelativeInstallDirs</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#absoluteComponentInstallDirs"><span class="hs-identifier hs-var">absoluteComponentInstallDirs</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#prefixRelativeComponentInstallDirs"><span class="hs-identifier hs-var">prefixRelativeComponentInstallDirs</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>        </span><a href="Distribution.Simple.LocalBuildInfo.html#substPathTemplate"><span class="hs-identifier hs-var">substPathTemplate</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Compat.Prelude.html"><span class="hs-identifier">Distribution.Compat.Prelude</span></a><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.Component.html"><span class="hs-identifier">Distribution.Types.Component</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.PackageId.html"><span class="hs-identifier">Distribution.Types.PackageId</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.UnitId.html"><span class="hs-identifier">Distribution.Types.UnitId</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.ComponentName.html"><span class="hs-identifier">Distribution.Types.ComponentName</span></a><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.UnqualComponentName.html"><span class="hs-identifier">Distribution.Types.UnqualComponentName</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.PackageDescription.html"><span class="hs-identifier">Distribution.Types.PackageDescription</span></a><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html"><span class="hs-identifier">Distribution.Types.ComponentLocalBuildInfo</span></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html"><span class="hs-identifier">Distribution.Types.LocalBuildInfo</span></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Types.TargetInfo.html"><span class="hs-identifier">Distribution.Types.TargetInfo</span></a><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.InstallDirs.html"><span class="hs-identifier">Distribution.Simple.InstallDirs</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.InstallDirs.html#absoluteInstallDirs"><span class="hs-identifier hs-var">absoluteInstallDirs</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>                                               </span><a href="Distribution.Simple.InstallDirs.html#prefixRelativeInstallDirs"><span class="hs-identifier hs-var">prefixRelativeInstallDirs</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>                                               </span><a href="Distribution.Simple.InstallDirs.html#substPathTemplate"><span class="hs-identifier hs-var">substPathTemplate</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Simple.InstallDirs.html"><span class="hs-identifier">Distribution.Simple.InstallDirs</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">InstallDirs</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.PackageDescription.html"><span class="hs-identifier">Distribution.PackageDescription</span></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.InstalledPackageInfo.html"><span class="hs-identifier">Distribution.InstalledPackageInfo</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Installed</span><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Package.html"><span class="hs-identifier">Distribution.Package</span></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.ModuleName.html"><span class="hs-identifier">Distribution.ModuleName</span></a><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Compiler.html"><span class="hs-identifier">Distribution.Simple.Compiler</span></a><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.PackageIndex.html"><span class="hs-identifier">Distribution.Simple.PackageIndex</span></a><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Utils.html"><span class="hs-identifier">Distribution.Simple.Utils</span></a><span>
</span><a name="line-92"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Text.html"><span class="hs-identifier">Distribution.Text</span></a><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Distribution.Compat.Graph.html"><span class="hs-identifier">Distribution.Compat.Graph</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Graph</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">stripPrefix</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.FilePath</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Directory</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">doesDirectoryExist</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">canonicalizePath</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- Configuration information of buildable components</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-identifier">componentBuildDir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- For now, we assume that libraries/executables/test-suites/benchmarks</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- are only ever built once.  With Backpack, we need a special case for</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- libraries so that we can handle building them multiple times.</span><span>
</span><a name="line-108"></a><a name="componentBuildDir"><a href="Distribution.Simple.LocalBuildInfo.html#componentBuildDir"><span class="hs-identifier">componentBuildDir</span></a></a><span> </span><a name="local-6989586621679438648"><a href="#local-6989586621679438648"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438649"><a href="#local-6989586621679438649"><span class="hs-identifier">clbi</span></a></a><span>
</span><a name="line-109"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">buildDir</span><span> </span><a href="#local-6989586621679438648"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span>
</span><a name="line-110"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">componentLocalName</span><span> </span><a href="#local-6989586621679438649"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-111"></a><span>            </span><a href="Distribution.Types.ComponentName.html#CLibName"><span class="hs-identifier hs-var">CLibName</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-112"></a><span>                </span><span class="hs-keyword">if</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentUnitId</span><span> </span><a href="#local-6989586621679438649"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentComponentId</span><span> </span><a href="#local-6989586621679438649"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-114"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentUnitId</span><span> </span><a href="#local-6989586621679438649"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>            </span><a href="Distribution.Types.ComponentName.html#CSubLibName"><span class="hs-identifier hs-var">CSubLibName</span></a><span> </span><a name="local-6989586621679438650"><a href="#local-6989586621679438650"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-116"></a><span>                </span><span class="hs-keyword">if</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentUnitId</span><span> </span><a href="#local-6989586621679438649"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentComponentId</span><span> </span><a href="#local-6989586621679438649"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><a href="#local-6989586621679438650"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-118"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentUnitId</span><span> </span><a href="#local-6989586621679438649"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>            </span><a href="Distribution.Types.ComponentName.html#CFLibName"><span class="hs-identifier hs-var">CFLibName</span></a><span> </span><a name="local-6989586621679438651"><a href="#local-6989586621679438651"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><a href="#local-6989586621679438651"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-120"></a><span>            </span><a href="Distribution.Types.ComponentName.html#CExeName"><span class="hs-identifier hs-var">CExeName</span></a><span> </span><a name="local-6989586621679438652"><a href="#local-6989586621679438652"><span class="hs-identifier">s</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><a href="#local-6989586621679438652"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-121"></a><span>            </span><a href="Distribution.Types.ComponentName.html#CTestName"><span class="hs-identifier hs-var">CTestName</span></a><span> </span><a name="local-6989586621679438653"><a href="#local-6989586621679438653"><span class="hs-identifier">s</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><a href="#local-6989586621679438653"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-122"></a><span>            </span><a href="Distribution.Types.ComponentName.html#CBenchName"><span class="hs-identifier hs-var">CBenchName</span></a><span> </span><a name="local-6989586621679438654"><a href="#local-6989586621679438654"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.UnqualComponentName.html#unUnqualComponentName"><span class="hs-identifier hs-var">unUnqualComponentName</span></a><span> </span><a href="#local-6989586621679438654"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">getComponentLocalBuildInfo</span><span> </span><span class="hs-pragma">&quot;This function is not well-defined, because a 'ComponentName' does not uniquely identify a 'ComponentLocalBuildInfo'.  If you have a 'TargetInfo', you should use 'targetCLBI' to get the 'ComponentLocalBuildInfo'.  Otherwise, use 'componentNameTargets' to get all possible 'ComponentLocalBuildInfo's.  This will be removed in Cabal 2.2.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-125"></a><span class="hs-identifier">getComponentLocalBuildInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentName.html#ComponentName"><span class="hs-identifier hs-type">ComponentName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span>
</span><a name="line-126"></a><a name="getComponentLocalBuildInfo"><a href="Distribution.Simple.LocalBuildInfo.html#getComponentLocalBuildInfo"><span class="hs-identifier">getComponentLocalBuildInfo</span></a></a><span> </span><a name="local-6989586621679438655"><a href="#local-6989586621679438655"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438656"><a href="#local-6989586621679438656"><span class="hs-identifier">cname</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-127"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#componentNameCLBIs"><span class="hs-identifier hs-var">componentNameCLBIs</span></a><span> </span><a href="#local-6989586621679438655"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679438656"><span class="hs-identifier hs-var">cname</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-128"></a><span>      </span><span class="hs-special">[</span><a name="local-6989586621679438657"><a href="#local-6989586621679438657"><span class="hs-identifier">clbi</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679438657"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-129"></a><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-130"></a><span>          </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;internal error: there is no configuration data &quot;</span><span>
</span><a name="line-131"></a><span>               </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;for component &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679438656"><span class="hs-identifier hs-var">cname</span></a><span>
</span><a name="line-132"></a><span>      </span><a name="local-6989586621679438658"><a href="#local-6989586621679438658"><span class="hs-identifier">clbis</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-133"></a><span>          </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;internal error: the component name &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679438656"><span class="hs-identifier hs-var">cname</span></a><span>
</span><a name="line-134"></a><span>               </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;is ambiguous.  Refers to: &quot;</span><span>
</span><a name="line-135"></a><span>               </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-string">&quot;, &quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">componentUnitId</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679438658"><span class="hs-identifier hs-var">clbis</span></a><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">-- | Perform the action on each enabled 'library' in the package</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- description with the 'ComponentLocalBuildInfo'.</span><span>
</span><a name="line-139"></a><span class="hs-identifier">withLibLBI</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-140"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.Library.html#Library"><span class="hs-identifier hs-type">Library</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-141"></a><a name="withLibLBI"><a href="Distribution.Simple.LocalBuildInfo.html#withLibLBI"><span class="hs-identifier">withLibLBI</span></a></a><span> </span><a name="local-6989586621679438659"><a href="#local-6989586621679438659"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679438660"><a href="#local-6989586621679438660"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438661"><a href="#local-6989586621679438661"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-142"></a><span>    </span><a href="Distribution.Types.LocalBuildInfo.html#withAllTargetsInBuildOrder%27"><span class="hs-identifier hs-var">withAllTargetsInBuildOrder'</span></a><span> </span><a href="#local-6989586621679438659"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679438660"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679438662"><a href="#local-6989586621679438662"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-143"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">targetComponent</span><span> </span><a href="#local-6989586621679438662"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-144"></a><span>            </span><a href="Distribution.Types.Component.html#CLib"><span class="hs-identifier hs-var">CLib</span></a><span> </span><a name="local-6989586621679438663"><a href="#local-6989586621679438663"><span class="hs-identifier">lib</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679438661"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679438663"><span class="hs-identifier hs-var">lib</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">targetCLBI</span><span> </span><a href="#local-6989586621679438662"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-comment">-- | Perform the action on each enabled 'Executable' in the package</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- description.  Extended version of 'withExe' that also gives corresponding</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- build info.</span><span>
</span><a name="line-150"></a><span class="hs-identifier">withExeLBI</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-151"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.Executable.html#Executable"><span class="hs-identifier hs-type">Executable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-152"></a><a name="withExeLBI"><a href="Distribution.Simple.LocalBuildInfo.html#withExeLBI"><span class="hs-identifier">withExeLBI</span></a></a><span> </span><a name="local-6989586621679438664"><a href="#local-6989586621679438664"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679438665"><a href="#local-6989586621679438665"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438666"><a href="#local-6989586621679438666"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-153"></a><span>    </span><a href="Distribution.Types.LocalBuildInfo.html#withAllTargetsInBuildOrder%27"><span class="hs-identifier hs-var">withAllTargetsInBuildOrder'</span></a><span> </span><a href="#local-6989586621679438664"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679438665"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679438667"><a href="#local-6989586621679438667"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-154"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">targetComponent</span><span> </span><a href="#local-6989586621679438667"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-155"></a><span>            </span><a href="Distribution.Types.Component.html#CExe"><span class="hs-identifier hs-var">CExe</span></a><span> </span><a name="local-6989586621679438668"><a href="#local-6989586621679438668"><span class="hs-identifier">exe</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679438666"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679438668"><span class="hs-identifier hs-var">exe</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">targetCLBI</span><span> </span><a href="#local-6989586621679438667"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-comment">-- | Perform the action on each enabled 'Benchmark' in the package</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- description.</span><span>
</span><a name="line-160"></a><span class="hs-identifier">withBenchLBI</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-161"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.Benchmark.html#Benchmark"><span class="hs-identifier hs-type">Benchmark</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-162"></a><a name="withBenchLBI"><a href="Distribution.Simple.LocalBuildInfo.html#withBenchLBI"><span class="hs-identifier">withBenchLBI</span></a></a><span> </span><a name="local-6989586621679438669"><a href="#local-6989586621679438669"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679438670"><a href="#local-6989586621679438670"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438671"><a href="#local-6989586621679438671"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-163"></a><span>    </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679438671"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679438672"><span class="hs-identifier hs-var">test</span></a><span> </span><a href="#local-6989586621679438673"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679438672"><a href="#local-6989586621679438672"><span class="hs-identifier">test</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679438673"><a href="#local-6989586621679438673"><span class="hs-identifier">clbi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#enabledBenchLBIs"><span class="hs-identifier hs-var">enabledBenchLBIs</span></a><span> </span><a href="#local-6989586621679438669"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679438670"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-identifier">withTestLBI</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-166"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.TestSuite.html#TestSuite"><span class="hs-identifier hs-type">TestSuite</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-167"></a><a name="withTestLBI"><a href="Distribution.Simple.LocalBuildInfo.html#withTestLBI"><span class="hs-identifier">withTestLBI</span></a></a><span> </span><a name="local-6989586621679438674"><a href="#local-6989586621679438674"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679438675"><a href="#local-6989586621679438675"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438676"><a href="#local-6989586621679438676"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-identifier hs-var">sequence_</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679438676"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679438677"><span class="hs-identifier hs-var">test</span></a><span> </span><a href="#local-6989586621679438678"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679438677"><a href="#local-6989586621679438677"><span class="hs-identifier">test</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679438678"><a href="#local-6989586621679438678"><span class="hs-identifier">clbi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#enabledTestLBIs"><span class="hs-identifier hs-var">enabledTestLBIs</span></a><span> </span><a href="#local-6989586621679438674"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679438675"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-identifier">enabledTestLBIs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-171"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Distribution.Types.TestSuite.html#TestSuite"><span class="hs-identifier hs-type">TestSuite</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-172"></a><a name="enabledTestLBIs"><a href="Distribution.Simple.LocalBuildInfo.html#enabledTestLBIs"><span class="hs-identifier">enabledTestLBIs</span></a></a><span> </span><a name="local-6989586621679438679"><a href="#local-6989586621679438679"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679438680"><a href="#local-6989586621679438680"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-173"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679438682"><span class="hs-identifier hs-var">test</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">targetCLBI</span><span> </span><a href="#local-6989586621679438681"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679438681"><a href="#local-6989586621679438681"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#allTargetsInBuildOrder%27"><span class="hs-identifier hs-var">allTargetsInBuildOrder'</span></a><span> </span><a href="#local-6989586621679438679"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679438680"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-175"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Distribution.Types.Component.html#CTest"><span class="hs-identifier hs-var">CTest</span></a><span> </span><a name="local-6989586621679438682"><a href="#local-6989586621679438682"><span class="hs-identifier">test</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">targetComponent</span><span> </span><a href="#local-6989586621679438681"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-identifier">enabledBenchLBIs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-178"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Distribution.Types.Benchmark.html#Benchmark"><span class="hs-identifier hs-type">Benchmark</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-179"></a><a name="enabledBenchLBIs"><a href="Distribution.Simple.LocalBuildInfo.html#enabledBenchLBIs"><span class="hs-identifier">enabledBenchLBIs</span></a></a><span> </span><a name="local-6989586621679438683"><a href="#local-6989586621679438683"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679438684"><a href="#local-6989586621679438684"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-180"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679438686"><span class="hs-identifier hs-var">bench</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">targetCLBI</span><span> </span><a href="#local-6989586621679438685"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679438685"><a href="#local-6989586621679438685"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#allTargetsInBuildOrder%27"><span class="hs-identifier hs-var">allTargetsInBuildOrder'</span></a><span> </span><a href="#local-6989586621679438683"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679438684"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-182"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Distribution.Types.Component.html#CBench"><span class="hs-identifier hs-var">CBench</span></a><span> </span><a name="local-6989586621679438686"><a href="#local-6989586621679438686"><span class="hs-identifier">bench</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">targetComponent</span><span> </span><a href="#local-6989586621679438685"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">withComponentsLBI</span><span> </span><span class="hs-pragma">&quot;Use withAllComponentsInBuildOrder&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-185"></a><span class="hs-identifier">withComponentsLBI</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-186"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-188"></a><a name="withComponentsLBI"><a href="Distribution.Simple.LocalBuildInfo.html#withComponentsLBI"><span class="hs-identifier">withComponentsLBI</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#withAllComponentsInBuildOrder"><span class="hs-identifier hs-var">withAllComponentsInBuildOrder</span></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-comment">-- | Perform the action on each buildable 'Library' or 'Executable' (Component)</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- in the PackageDescription, subject to the build order specified by the</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- 'compBuildOrder' field of the given 'LocalBuildInfo'</span><span>
</span><a name="line-193"></a><span class="hs-identifier">withAllComponentsInBuildOrder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-194"></a><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><a name="withAllComponentsInBuildOrder"><a href="Distribution.Simple.LocalBuildInfo.html#withAllComponentsInBuildOrder"><span class="hs-identifier">withAllComponentsInBuildOrder</span></a></a><span> </span><a name="local-6989586621679438687"><a href="#local-6989586621679438687"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679438688"><a href="#local-6989586621679438688"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438689"><a href="#local-6989586621679438689"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-197"></a><span>    </span><a href="Distribution.Types.LocalBuildInfo.html#withAllTargetsInBuildOrder%27"><span class="hs-identifier hs-var">withAllTargetsInBuildOrder'</span></a><span> </span><a href="#local-6989586621679438687"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679438688"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679438690"><a href="#local-6989586621679438690"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-198"></a><span>        </span><a href="#local-6989586621679438689"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">targetComponent</span><span> </span><a href="#local-6989586621679438690"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">targetCLBI</span><span> </span><a href="#local-6989586621679438690"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">withComponentsInBuildOrder</span><span> </span><span class="hs-pragma">&quot;You have got a 'TargetInfo' right? Use 'withNeededTargetsInBuildOrder' on the 'UnitId's you can 'nodeKey' out.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-201"></a><span class="hs-identifier">withComponentsInBuildOrder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-202"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Types.ComponentName.html#ComponentName"><span class="hs-identifier hs-type">ComponentName</span></a><span class="hs-special">]</span><span>
</span><a name="line-203"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><a name="withComponentsInBuildOrder"><a href="Distribution.Simple.LocalBuildInfo.html#withComponentsInBuildOrder"><span class="hs-identifier">withComponentsInBuildOrder</span></a></a><span> </span><a name="local-6989586621679438691"><a href="#local-6989586621679438691"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679438692"><a href="#local-6989586621679438692"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438693"><a href="#local-6989586621679438693"><span class="hs-identifier">cnames</span></a></a><span> </span><a name="local-6989586621679438694"><a href="#local-6989586621679438694"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-206"></a><span>    </span><a href="Distribution.Types.LocalBuildInfo.html#withNeededTargetsInBuildOrder%27"><span class="hs-identifier hs-var">withNeededTargetsInBuildOrder'</span></a><span> </span><a href="#local-6989586621679438691"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679438692"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679438695"><span class="hs-identifier hs-var">uids</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679438696"><a href="#local-6989586621679438696"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-207"></a><span>        </span><a href="#local-6989586621679438694"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">targetComponent</span><span> </span><a href="#local-6989586621679438696"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">targetCLBI</span><span> </span><a href="#local-6989586621679438696"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679438695"><a href="#local-6989586621679438695"><span class="hs-identifier">uids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.LocalBuildInfo.html#componentNameToUnitIds"><span class="hs-identifier hs-var">componentNameToUnitIds</span></a><span> </span><a href="#local-6989586621679438692"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679438693"><span class="hs-identifier hs-var">cnames</span></a><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span class="hs-identifier">allComponentsInBuildOrder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-211"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-212"></a><a name="allComponentsInBuildOrder"><a href="Distribution.Simple.LocalBuildInfo.html#allComponentsInBuildOrder"><span class="hs-identifier">allComponentsInBuildOrder</span></a></a><span> </span><a name="local-6989586621679438697"><a href="#local-6989586621679438697"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-213"></a><span>    </span><a href="Distribution.Compat.Graph.html#topSort"><span class="hs-identifier hs-var">Graph.topSort</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentGraph</span><span> </span><a href="#local-6989586621679438697"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-comment">-- | Private helper function for some of the deprecated implementations.</span><span>
</span><a name="line-216"></a><span class="hs-identifier">componentNameToUnitIds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentName.html#ComponentName"><span class="hs-identifier hs-type">ComponentName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Types.UnitId.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>
</span><a name="line-217"></a><a name="componentNameToUnitIds"><a href="Distribution.Simple.LocalBuildInfo.html#componentNameToUnitIds"><span class="hs-identifier">componentNameToUnitIds</span></a></a><span> </span><a name="local-6989586621679438698"><a href="#local-6989586621679438698"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438699"><a href="#local-6989586621679438699"><span class="hs-identifier">cname</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-218"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679438699"><span class="hs-identifier hs-var">cname</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentNameMap</span><span> </span><a href="#local-6989586621679438698"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-219"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679438700"><a href="#local-6989586621679438700"><span class="hs-identifier">clbis</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">componentUnitId</span><span> </span><a href="#local-6989586621679438700"><span class="hs-identifier hs-var">clbis</span></a><span>
</span><a name="line-220"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;componentNameToUnitIds &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><a href="#local-6989586621679438699"><span class="hs-identifier hs-var">cname</span></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">componentsInBuildOrder</span><span> </span><span class="hs-pragma">&quot;You've got 'TargetInfo' right? Use 'neededTargetsInBuildOrder' on the 'UnitId's you can 'nodeKey' out.&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-223"></a><span class="hs-identifier">componentsInBuildOrder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Types.ComponentName.html#ComponentName"><span class="hs-identifier hs-type">ComponentName</span></a><span class="hs-special">]</span><span>
</span><a name="line-224"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-225"></a><a name="componentsInBuildOrder"><a href="Distribution.Simple.LocalBuildInfo.html#componentsInBuildOrder"><span class="hs-identifier">componentsInBuildOrder</span></a></a><span> </span><a name="local-6989586621679438701"><a href="#local-6989586621679438701"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438702"><a href="#local-6989586621679438702"><span class="hs-identifier">cnames</span></a></a><span>
</span><a name="line-226"></a><span>    </span><span class="hs-comment">-- NB: use of localPkgDescr here is safe because we throw out the</span><span>
</span><a name="line-227"></a><span>    </span><span class="hs-comment">-- result immediately afterwards</span><span>
</span><a name="line-228"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">targetCLBI</span><span> </span><span class="hs-special">(</span><a href="Distribution.Types.LocalBuildInfo.html#neededTargetsInBuildOrder%27"><span class="hs-identifier hs-var">neededTargetsInBuildOrder'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">localPkgDescr</span><span> </span><a href="#local-6989586621679438701"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679438701"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679438703"><span class="hs-identifier hs-var">uids</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679438703"><a href="#local-6989586621679438703"><span class="hs-identifier">uids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.LocalBuildInfo.html#componentNameToUnitIds"><span class="hs-identifier hs-var">componentNameToUnitIds</span></a><span> </span><a href="#local-6989586621679438701"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679438702"><span class="hs-identifier hs-var">cnames</span></a><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- A random function that has no business in this module</span><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">-- | Determine the directories containing the dynamic libraries of the</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- transitive dependencies of the component we are building.</span><span>
</span><a name="line-236"></a><span class="hs-comment">--</span><span>
</span><a name="line-237"></a><span class="hs-comment">-- When wanted, and possible, returns paths relative to the installDirs 'prefix'</span><span>
</span><a name="line-238"></a><span class="hs-identifier">depLibraryPaths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- ^ Building for inplace?</span><span>
</span><a name="line-239"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- ^ Generate prefix-relative library paths</span><span>
</span><a name="line-240"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-241"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-comment">-- ^ Component that is being built</span><span>
</span><a name="line-242"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#NoCallStackIO"><span class="hs-identifier hs-type">NoCallStackIO</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span>
</span><a name="line-243"></a><a name="depLibraryPaths"><a href="Distribution.Simple.LocalBuildInfo.html#depLibraryPaths"><span class="hs-identifier">depLibraryPaths</span></a></a><span> </span><a name="local-6989586621679438704"><a href="#local-6989586621679438704"><span class="hs-identifier">inplace</span></a></a><span> </span><a name="local-6989586621679438705"><a href="#local-6989586621679438705"><span class="hs-identifier">relative</span></a></a><span> </span><a name="local-6989586621679438706"><a href="#local-6989586621679438706"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438707"><a href="#local-6989586621679438707"><span class="hs-identifier">clbi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-244"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679438711"><a href="#local-6989586621679438711"><span class="hs-identifier">pkgDescr</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">localPkgDescr</span><span> </span><a href="#local-6989586621679438706"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-245"></a><span>        </span><a name="local-6989586621679438712"><a href="#local-6989586621679438712"><span class="hs-identifier">installDirs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#absoluteComponentInstallDirs"><span class="hs-identifier hs-var">absoluteComponentInstallDirs</span></a><span> </span><a href="#local-6989586621679438711"><span class="hs-identifier hs-var">pkgDescr</span></a><span> </span><a href="#local-6989586621679438706"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentUnitId</span><span> </span><a href="#local-6989586621679438707"><span class="hs-identifier hs-var">clbi</span></a><span class="hs-special">)</span><span> </span><a href="Distribution.Simple.InstallDirs.html#NoCopyDest"><span class="hs-identifier hs-var">NoCopyDest</span></a><span>
</span><a name="line-246"></a><span>        </span><a name="local-6989586621679438713"><a href="#local-6989586621679438713"><span class="hs-identifier">executable</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679438707"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-247"></a><span>                        </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ExeComponentLocalBuildInfo"><span class="hs-identifier hs-var">ExeComponentLocalBuildInfo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-248"></a><span>                        </span><span class="hs-identifier">_</span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-249"></a><span>        </span><a name="local-6989586621679438714"><a href="#local-6989586621679438714"><span class="hs-identifier">relDir</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679438713"><span class="hs-identifier hs-var">executable</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">bindir</span><span> </span><a href="#local-6989586621679438712"><span class="hs-identifier hs-var">installDirs</span></a><span>
</span><a name="line-250"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">libdir</span><span> </span><a href="#local-6989586621679438712"><span class="hs-identifier hs-var">installDirs</span></a><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- TODO: this is kind of inefficient</span><span>
</span><a name="line-253"></a><span>        </span><a name="local-6989586621679438715"><a href="#local-6989586621679438715"><span class="hs-identifier">internalDeps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679438718"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-254"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679438718"><a href="#local-6989586621679438718"><span class="hs-identifier">uid</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">componentPackageDeps</span><span> </span><a href="#local-6989586621679438707"><span class="hs-identifier hs-var">clbi</span></a><span>
</span><a name="line-255"></a><span>                       </span><span class="hs-comment">-- Test that it's internal</span><span>
</span><a name="line-256"></a><span>                       </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679438719"><a href="#local-6989586621679438719"><span class="hs-identifier">sub_target</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#allTargetsInBuildOrder%27"><span class="hs-identifier hs-var">allTargetsInBuildOrder'</span></a><span> </span><a href="#local-6989586621679438711"><span class="hs-identifier hs-var">pkgDescr</span></a><span> </span><a href="#local-6989586621679438706"><span class="hs-identifier hs-var">lbi</span></a><span>
</span><a name="line-257"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">componentUnitId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">targetCLBI</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679438719"><span class="hs-identifier hs-var">sub_target</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679438718"><span class="hs-identifier hs-var">uid</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-258"></a><span>        </span><a name="local-6989586621679438716"><a href="#local-6989586621679438716"><span class="hs-identifier">internalLibs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679438717"><span class="hs-identifier hs-var">getLibDir</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">targetCLBI</span><span> </span><a href="#local-6989586621679438720"><span class="hs-identifier hs-var">sub_target</span></a><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679438720"><a href="#local-6989586621679438720"><span class="hs-identifier">sub_target</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#neededTargetsInBuildOrder%27"><span class="hs-identifier hs-var">neededTargetsInBuildOrder'</span></a><span>
</span><a name="line-260"></a><span>                                        </span><a href="#local-6989586621679438711"><span class="hs-identifier hs-var">pkgDescr</span></a><span> </span><a href="#local-6989586621679438706"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679438715"><span class="hs-identifier hs-var">internalDeps</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-261"></a><span>    </span><span class="hs-comment">{-
    -- This is better, but it doesn't work, because we may be passed a
    -- CLBI which doesn't actually exist, and was faked up when we
    -- were building a test suite/benchmark.  See #3599 for proposal
    -- to fix this.
    let internalCLBIs = filter ((/= componentUnitId clbi) . componentUnitId)
                      . map targetCLBI
                      $ neededTargetsInBuildOrder lbi [componentUnitId clbi]
        internalLibs = map getLibDir internalCLBIs
    -}</span><span>
</span><a name="line-271"></a><span>        </span><a name="local-6989586621679438717"><a href="#local-6989586621679438717"><span class="hs-identifier">getLibDir</span></a></a><span> </span><a name="local-6989586621679438721"><a href="#local-6989586621679438721"><span class="hs-identifier">sub_clbi</span></a></a><span>
</span><a name="line-272"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679438704"><span class="hs-identifier hs-var">inplace</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.LocalBuildInfo.html#componentBuildDir"><span class="hs-identifier hs-var">componentBuildDir</span></a><span> </span><a href="#local-6989586621679438706"><span class="hs-identifier hs-var">lbi</span></a><span> </span><a href="#local-6989586621679438721"><span class="hs-identifier hs-var">sub_clbi</span></a><span>
</span><a name="line-273"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dynlibdir</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.LocalBuildInfo.html#absoluteComponentInstallDirs"><span class="hs-identifier hs-var">absoluteComponentInstallDirs</span></a><span> </span><a href="#local-6989586621679438711"><span class="hs-identifier hs-var">pkgDescr</span></a><span> </span><a href="#local-6989586621679438706"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">componentUnitId</span><span> </span><a href="#local-6989586621679438721"><span class="hs-identifier hs-var">sub_clbi</span></a><span class="hs-special">)</span><span> </span><a href="Distribution.Simple.InstallDirs.html#NoCopyDest"><span class="hs-identifier hs-var">NoCopyDest</span></a><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span>    </span><span class="hs-comment">-- Why do we go through all the trouble of a hand-crafting</span><span>
</span><a name="line-276"></a><span>    </span><span class="hs-comment">-- internalLibs, when 'installedPkgs' actually contains the</span><span>
</span><a name="line-277"></a><span>    </span><span class="hs-comment">-- internal libraries?  The trouble is that 'installedPkgs'</span><span>
</span><a name="line-278"></a><span>    </span><span class="hs-comment">-- may contain *inplace* entries, which we must NOT use for</span><span>
</span><a name="line-279"></a><span>    </span><span class="hs-comment">-- not inplace 'depLibraryPaths' (e.g., for RPATH calculation).</span><span>
</span><a name="line-280"></a><span>    </span><span class="hs-comment">-- See #4025 for more details. This is all horrible but it</span><span>
</span><a name="line-281"></a><span>    </span><span class="hs-comment">-- is a moot point if you are using a per-component build,</span><span>
</span><a name="line-282"></a><span>    </span><span class="hs-comment">-- because you never have any internal libraries in this case;</span><span>
</span><a name="line-283"></a><span>    </span><span class="hs-comment">-- they're all external.</span><span>
</span><a name="line-284"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679438722"><a href="#local-6989586621679438722"><span class="hs-identifier">external_ipkgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621679438723"><span class="hs-identifier hs-var">is_external</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.PackageIndex.html#allPackages"><span class="hs-identifier hs-var">allPackages</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">installedPkgs</span><span> </span><a href="#local-6989586621679438706"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span>        </span><a name="local-6989586621679438723"><a href="#local-6989586621679438723"><span class="hs-identifier">is_external</span></a></a><span> </span><a name="local-6989586621679438727"><a href="#local-6989586621679438727"><span class="hs-identifier">ipkg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Distribution.Package.html#installedUnitId"><span class="hs-identifier hs-var">installedUnitId</span></a><span> </span><a href="#local-6989586621679438727"><span class="hs-identifier hs-var">ipkg</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679438715"><span class="hs-identifier hs-var">internalDeps</span></a><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span>        </span><span class="hs-comment">-- First look for dynamic libraries in `dynamic-library-dirs`, and use</span><span>
</span><a name="line-287"></a><span>        </span><span class="hs-comment">-- `library-dirs` as a fall back.</span><span>
</span><a name="line-288"></a><span>        </span><a name="local-6989586621679438724"><a href="#local-6989586621679438724"><span class="hs-identifier">getDynDir</span></a></a><span> </span><a name="local-6989586621679438728"><a href="#local-6989586621679438728"><span class="hs-identifier">pkg</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">Installed.libraryDynDirs</span><span> </span><a href="#local-6989586621679438728"><span class="hs-identifier hs-var">pkg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-289"></a><span>                           </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Installed.libraryDirs</span><span> </span><a href="#local-6989586621679438728"><span class="hs-identifier hs-var">pkg</span></a><span>
</span><a name="line-290"></a><span>                           </span><a name="local-6989586621679438729"><a href="#local-6989586621679438729"><span class="hs-identifier">d</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679438729"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-291"></a><span>        </span><a name="local-6989586621679438725"><a href="#local-6989586621679438725"><span class="hs-identifier">allDepLibDirs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="#local-6989586621679438724"><span class="hs-identifier hs-var">getDynDir</span></a><span> </span><a href="#local-6989586621679438722"><span class="hs-identifier hs-var">external_ipkgs</span></a><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span>        </span><a name="local-6989586621679438726"><a href="#local-6989586621679438726"><span class="hs-identifier">allDepLibDirs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679438716"><span class="hs-identifier hs-var">internalLibs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679438725"><span class="hs-identifier hs-var">allDepLibDirs</span></a><span>
</span><a name="line-294"></a><span>    </span><a name="local-6989586621679438730"><a href="#local-6989586621679438730"><span class="hs-identifier">allDepLibDirsC</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="#local-6989586621679438708"><span class="hs-identifier hs-var">canonicalizePathNoFail</span></a><span> </span><a href="#local-6989586621679438726"><span class="hs-identifier hs-var">allDepLibDirs'</span></a><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679438731"><a href="#local-6989586621679438731"><span class="hs-identifier">p</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">prefix</span><span> </span><a href="#local-6989586621679438712"><span class="hs-identifier hs-var">installDirs</span></a><span>
</span><a name="line-297"></a><span>        </span><a name="local-6989586621679438732"><a href="#local-6989586621679438732"><span class="hs-identifier">prefixRelative</span></a></a><span> </span><a name="local-6989586621679438734"><a href="#local-6989586621679438734"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">stripPrefix</span><span> </span><a href="#local-6989586621679438731"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679438734"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-298"></a><span>        </span><a name="local-6989586621679438733"><a href="#local-6989586621679438733"><span class="hs-identifier">libPaths</span></a></a><span>
</span><a name="line-299"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679438705"><span class="hs-identifier hs-var">relative</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-300"></a><span>            </span><a href="#local-6989586621679438732"><span class="hs-identifier hs-var">prefixRelative</span></a><span> </span><a href="#local-6989586621679438714"><span class="hs-identifier hs-var">relDir</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679438735"><a href="#local-6989586621679438735"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-301"></a><span>                                          </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679438732"><span class="hs-identifier hs-var">prefixRelative</span></a><span> </span><a href="#local-6989586621679438735"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-302"></a><span>                                             </span><span class="hs-keyword">then</span><span> </span><a href="Distribution.Simple.Utils.html#shortRelativePath"><span class="hs-identifier hs-var">shortRelativePath</span></a><span> </span><a href="#local-6989586621679438714"><span class="hs-identifier hs-var">relDir</span></a><span> </span><a href="#local-6989586621679438735"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-303"></a><span>                                             </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679438735"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-304"></a><span>                                        </span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679438730"><span class="hs-identifier hs-var">allDepLibDirsC</span></a><span>
</span><a name="line-305"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679438730"><span class="hs-identifier hs-var">allDepLibDirsC</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679438733"><span class="hs-identifier hs-var">libPaths</span></a><span>
</span><a name="line-308"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-309"></a><span>    </span><span class="hs-comment">-- 'canonicalizePath' fails on UNIX when the directory does not exists.</span><span>
</span><a name="line-310"></a><span>    </span><span class="hs-comment">-- So just don't canonicalize when it doesn't exist.</span><span>
</span><a name="line-311"></a><span>    </span><a name="local-6989586621679438708"><a href="#local-6989586621679438708"><span class="hs-identifier">canonicalizePathNoFail</span></a></a><span> </span><a name="local-6989586621679438709"><a href="#local-6989586621679438709"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-312"></a><span>      </span><a name="local-6989586621679438710"><a href="#local-6989586621679438710"><span class="hs-identifier">exists</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">doesDirectoryExist</span><span> </span><a href="#local-6989586621679438709"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-313"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679438710"><span class="hs-identifier hs-var">exists</span></a><span>
</span><a name="line-314"></a><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">canonicalizePath</span><span> </span><a href="#local-6989586621679438709"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-315"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679438709"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span class="hs-comment">-- | Get all module names that needed to be built by GHC; i.e., all</span><span>
</span><a name="line-318"></a><span class="hs-comment">-- of these 'ModuleName's have interface files associated with them</span><span>
</span><a name="line-319"></a><span class="hs-comment">-- that need to be installed.</span><span>
</span><a name="line-320"></a><span class="hs-identifier">allLibModules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.Library.html#Library"><span class="hs-identifier hs-type">Library</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#ComponentLocalBuildInfo"><span class="hs-identifier hs-type">ComponentLocalBuildInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.ModuleName.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">]</span><span>
</span><a name="line-321"></a><a name="allLibModules"><a href="Distribution.Simple.LocalBuildInfo.html#allLibModules"><span class="hs-identifier">allLibModules</span></a></a><span> </span><a name="local-6989586621679438736"><a href="#local-6989586621679438736"><span class="hs-identifier">lib</span></a></a><span> </span><a name="local-6989586621679438737"><a href="#local-6989586621679438737"><span class="hs-identifier">clbi</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-322"></a><span>    </span><a href="Distribution.Utils.Generic.html#ordNub"><span class="hs-identifier hs-var">ordNub</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-323"></a><span>    </span><a href="Distribution.Types.Library.html#explicitLibModules"><span class="hs-identifier hs-var">explicitLibModules</span></a><span> </span><a href="#local-6989586621679438736"><span class="hs-identifier hs-var">lib</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-324"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679438737"><span class="hs-identifier hs-var">clbi</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-325"></a><span>        </span><a href="Distribution.Types.ComponentLocalBuildInfo.html#LibComponentLocalBuildInfo"><span class="hs-identifier hs-var">LibComponentLocalBuildInfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">componentInstantiatedWith</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679438738"><a href="#local-6989586621679438738"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679438738"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-326"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-329"></a><span class="hs-comment">-- Wrappers for a couple functions from InstallDirs</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span class="hs-comment">-- | Backwards compatibility function which computes the InstallDirs</span><span>
</span><a name="line-332"></a><span class="hs-comment">-- assuming that @$libname@ points to the public library (or some fake</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- package identifier if there is no public library.)  IF AT ALL</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- POSSIBLE, please use 'absoluteComponentInstallDirs' instead.</span><span>
</span><a name="line-335"></a><span class="hs-identifier">absoluteInstallDirs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-336"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.InstallDirs.html#CopyDest"><span class="hs-identifier hs-type">CopyDest</span></a><span>
</span><a name="line-337"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.InstallDirs.html#InstallDirs"><span class="hs-identifier hs-type">InstallDirs</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-338"></a><a name="absoluteInstallDirs"><a href="Distribution.Simple.LocalBuildInfo.html#absoluteInstallDirs"><span class="hs-identifier">absoluteInstallDirs</span></a></a><span> </span><a name="local-6989586621679438739"><a href="#local-6989586621679438739"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679438740"><a href="#local-6989586621679438740"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438741"><a href="#local-6989586621679438741"><span class="hs-identifier">copydest</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-339"></a><span>    </span><a href="Distribution.Simple.LocalBuildInfo.html#absoluteComponentInstallDirs"><span class="hs-identifier hs-var">absoluteComponentInstallDirs</span></a><span> </span><a href="#local-6989586621679438739"><span class="hs-identifier hs-var">pkg</span></a><span> </span><a href="#local-6989586621679438740"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Types.LocalBuildInfo.html#localUnitId"><span class="hs-identifier hs-var">localUnitId</span></a><span> </span><a href="#local-6989586621679438740"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679438741"><span class="hs-identifier hs-var">copydest</span></a><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span class="hs-comment">-- | See 'InstallDirs.absoluteInstallDirs'.</span><span>
</span><a name="line-342"></a><span class="hs-identifier">absoluteComponentInstallDirs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageDescription.html#PackageDescription"><span class="hs-identifier hs-type">PackageDescription</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-343"></a><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.UnitId.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-344"></a><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.InstallDirs.html#CopyDest"><span class="hs-identifier hs-type">CopyDest</span></a><span>
</span><a name="line-345"></a><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.InstallDirs.html#InstallDirs"><span class="hs-identifier hs-type">InstallDirs</span></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-346"></a><a name="absoluteComponentInstallDirs"><a href="Distribution.Simple.LocalBuildInfo.html#absoluteComponentInstallDirs"><span class="hs-identifier">absoluteComponentInstallDirs</span></a></a><span> </span><a name="local-6989586621679438742"><a href="#local-6989586621679438742"><span class="hs-identifier">pkg</span></a></a><span> </span><a name="local-6989586621679438743"><a href="#local-6989586621679438743"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438744"><a href="#local-6989586621679438744"><span class="hs-identifier">uid</span></a></a><span> </span><a name="local-6989586621679438745"><a href="#local-6989586621679438745"><span class="hs-identifier">copydest</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-347"></a><span>  </span><a href="Distribution.Simple.InstallDirs.html#absoluteInstallDirs"><span class="hs-identifier hs-var">InstallDirs.absoluteInstallDirs</span></a><span>
</span><a name="line-348"></a><span>    </span><span class="hs-special">(</span><a href="Distribution.Package.html#packageId"><span class="hs-identifier hs-var">packageId</span></a><span> </span><a href="#local-6989586621679438742"><span class="hs-identifier hs-var">pkg</span></a><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>    </span><a href="#local-6989586621679438744"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-350"></a><span>    </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#compilerInfo"><span class="hs-identifier hs-var">compilerInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679438743"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>    </span><a href="#local-6989586621679438745"><span class="hs-identifier hs-var">copydest</span></a><span>
</span><a name="line-352"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679438743"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-353"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">installDirTemplates</span><span> </span><a href="#local-6989586621679438743"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-comment">-- | Backwards compatibility function which computes the InstallDirs</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- assuming that @$libname@ points to the public library (or some fake</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- package identifier if there is no public library.)  IF AT ALL</span><span>
</span><a name="line-358"></a><span class="hs-comment">-- POSSIBLE, please use 'prefixRelativeComponentInstallDirs' instead.</span><span>
</span><a name="line-359"></a><span class="hs-identifier">prefixRelativeInstallDirs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageId.html#PackageId"><span class="hs-identifier hs-type">PackageId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-360"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.InstallDirs.html#InstallDirs"><span class="hs-identifier hs-type">InstallDirs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span>
</span><a name="line-361"></a><a name="prefixRelativeInstallDirs"><a href="Distribution.Simple.LocalBuildInfo.html#prefixRelativeInstallDirs"><span class="hs-identifier">prefixRelativeInstallDirs</span></a></a><span> </span><a name="local-6989586621679438746"><a href="#local-6989586621679438746"><span class="hs-identifier">pkg_descr</span></a></a><span> </span><a name="local-6989586621679438747"><a href="#local-6989586621679438747"><span class="hs-identifier">lbi</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-362"></a><span>    </span><a href="Distribution.Simple.LocalBuildInfo.html#prefixRelativeComponentInstallDirs"><span class="hs-identifier hs-var">prefixRelativeComponentInstallDirs</span></a><span> </span><a href="#local-6989586621679438746"><span class="hs-identifier hs-var">pkg_descr</span></a><span> </span><a href="#local-6989586621679438747"><span class="hs-identifier hs-var">lbi</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Types.LocalBuildInfo.html#localUnitId"><span class="hs-identifier hs-var">localUnitId</span></a><span> </span><a href="#local-6989586621679438747"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-363"></a><span>
</span><a name="line-364"></a><span class="hs-comment">-- |See 'InstallDirs.prefixRelativeInstallDirs'</span><span>
</span><a name="line-365"></a><span class="hs-identifier">prefixRelativeComponentInstallDirs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageId.html#PackageId"><span class="hs-identifier hs-type">PackageId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-366"></a><span>                                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.UnitId.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-367"></a><span>                                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.InstallDirs.html#InstallDirs"><span class="hs-identifier hs-type">InstallDirs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span>
</span><a name="line-368"></a><a name="prefixRelativeComponentInstallDirs"><a href="Distribution.Simple.LocalBuildInfo.html#prefixRelativeComponentInstallDirs"><span class="hs-identifier">prefixRelativeComponentInstallDirs</span></a></a><span> </span><a name="local-6989586621679438748"><a href="#local-6989586621679438748"><span class="hs-identifier">pkg_descr</span></a></a><span> </span><a name="local-6989586621679438749"><a href="#local-6989586621679438749"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438750"><a href="#local-6989586621679438750"><span class="hs-identifier">uid</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-369"></a><span>  </span><a href="Distribution.Simple.InstallDirs.html#prefixRelativeInstallDirs"><span class="hs-identifier hs-var">InstallDirs.prefixRelativeInstallDirs</span></a><span>
</span><a name="line-370"></a><span>    </span><span class="hs-special">(</span><a href="Distribution.Package.html#packageId"><span class="hs-identifier hs-var">packageId</span></a><span> </span><a href="#local-6989586621679438748"><span class="hs-identifier hs-var">pkg_descr</span></a><span class="hs-special">)</span><span>
</span><a name="line-371"></a><span>    </span><a href="#local-6989586621679438750"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-372"></a><span>    </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#compilerInfo"><span class="hs-identifier hs-var">compilerInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679438749"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-373"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679438749"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-374"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">installDirTemplates</span><span> </span><a href="#local-6989586621679438749"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-identifier">substPathTemplate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Types.PackageId.html#PackageId"><span class="hs-identifier hs-type">PackageId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.LocalBuildInfo.html#LocalBuildInfo"><span class="hs-identifier hs-type">LocalBuildInfo</span></a><span>
</span><a name="line-377"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.UnitId.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-378"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.InstallDirs.html#PathTemplate"><span class="hs-identifier hs-type">PathTemplate</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-379"></a><a name="substPathTemplate"><a href="Distribution.Simple.LocalBuildInfo.html#substPathTemplate"><span class="hs-identifier">substPathTemplate</span></a></a><span> </span><a name="local-6989586621679438751"><a href="#local-6989586621679438751"><span class="hs-identifier">pkgid</span></a></a><span> </span><a name="local-6989586621679438752"><a href="#local-6989586621679438752"><span class="hs-identifier">lbi</span></a></a><span> </span><a name="local-6989586621679438753"><a href="#local-6989586621679438753"><span class="hs-identifier">uid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.InstallDirs.html#fromPathTemplate"><span class="hs-identifier hs-var">fromPathTemplate</span></a><span>
</span><a name="line-380"></a><span>                                    </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span> </span><a href="Distribution.Simple.InstallDirs.html#substPathTemplate"><span class="hs-identifier hs-var">InstallDirs.substPathTemplate</span></a><span> </span><a href="#local-6989586621679438754"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-381"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679438754"><a href="#local-6989586621679438754"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.InstallDirs.html#initialPathTemplateEnv"><span class="hs-identifier hs-var">initialPathTemplateEnv</span></a><span>
</span><a name="line-382"></a><span>                   </span><a href="#local-6989586621679438751"><span class="hs-identifier hs-var">pkgid</span></a><span>
</span><a name="line-383"></a><span>                   </span><a href="#local-6989586621679438753"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-384"></a><span>                   </span><span class="hs-special">(</span><a href="Distribution.Simple.Compiler.html#compilerInfo"><span class="hs-identifier hs-var">compilerInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">compiler</span><span> </span><a href="#local-6989586621679438752"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-385"></a><span>                   </span><span class="hs-special">(</span><span class="hs-identifier">hostPlatform</span><span> </span><a href="#local-6989586621679438752"><span class="hs-identifier hs-var">lbi</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a></pre></body></html>