<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Module      :  Distribution.Simple.Program.Db</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Copyright   :  Isaac Jones 2006, Duncan Coutts 2007-2009</span><span>
</span><a name="line-9"></a><span class="hs-comment">--</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Maintainer  :  cabal-devel@haskell.org</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Portability :  portable</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- This provides a 'ProgramDb' type which holds configured and not-yet</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- configured programs. It is the parameter to lots of actions elsewhere in</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- Cabal that need to look up and run programs. If we had a Cabal monad,</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- the 'ProgramDb' would probably be a reader or state component of it.</span><span>
</span><a name="line-17"></a><span class="hs-comment">--</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- One nice thing about using it is that any program that is</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- registered with Cabal will get some \&quot;configure\&quot; and \&quot;.cabal\&quot;</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- helpers like --with-foo-args --foo-path= and extra-foo-args.</span><span>
</span><a name="line-21"></a><span class="hs-comment">--</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- There's also a hook for adding programs in a Setup.lhs script.  See</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- hookedPrograms in 'Distribution.Simple.UserHooks'.  This gives a</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- hook user the ability to get the above flags and such so that they</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- don't have to write all the PATH logic inside Setup.lhs.</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Distribution.Simple.Program.Db</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-28"></a><span>    </span><span class="hs-comment">-- * The collection of configured programs we can run</span><span>
</span><a name="line-29"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#emptyProgramDb"><span class="hs-identifier hs-var">emptyProgramDb</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#defaultProgramDb"><span class="hs-identifier hs-var">defaultProgramDb</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#restoreProgramDb"><span class="hs-identifier hs-var">restoreProgramDb</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>    </span><span class="hs-comment">-- ** Query and manipulate the program db</span><span>
</span><a name="line-35"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#addKnownProgram"><span class="hs-identifier hs-var">addKnownProgram</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#addKnownPrograms"><span class="hs-identifier hs-var">addKnownPrograms</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#lookupKnownProgram"><span class="hs-identifier hs-var">lookupKnownProgram</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#knownPrograms"><span class="hs-identifier hs-var">knownPrograms</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#getProgramSearchPath"><span class="hs-identifier hs-var">getProgramSearchPath</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#setProgramSearchPath"><span class="hs-identifier hs-var">setProgramSearchPath</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#modifyProgramSearchPath"><span class="hs-identifier hs-var">modifyProgramSearchPath</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#userSpecifyPath"><span class="hs-identifier hs-var">userSpecifyPath</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#userSpecifyPaths"><span class="hs-identifier hs-var">userSpecifyPaths</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#userMaybeSpecifyPath"><span class="hs-identifier hs-var">userMaybeSpecifyPath</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#userSpecifyArgs"><span class="hs-identifier hs-var">userSpecifyArgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#userSpecifyArgss"><span class="hs-identifier hs-var">userSpecifyArgss</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#userSpecifiedArgs"><span class="hs-identifier hs-var">userSpecifiedArgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#updateProgram"><span class="hs-identifier hs-var">updateProgram</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#configuredPrograms"><span class="hs-identifier hs-var">configuredPrograms</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span>    </span><span class="hs-comment">-- ** Query and manipulate the program db</span><span>
</span><a name="line-53"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#configureProgram"><span class="hs-identifier hs-var">configureProgram</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#configureAllKnownPrograms"><span class="hs-identifier hs-var">configureAllKnownPrograms</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#unconfigureProgram"><span class="hs-identifier hs-var">unconfigureProgram</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#lookupProgramVersion"><span class="hs-identifier hs-var">lookupProgramVersion</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#reconfigurePrograms"><span class="hs-identifier hs-var">reconfigurePrograms</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#requireProgram"><span class="hs-identifier hs-var">requireProgram</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#requireProgramVersion"><span class="hs-identifier hs-var">requireProgramVersion</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Compat.Prelude.html"><span class="hs-identifier">Distribution.Compat.Prelude</span></a><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Program.Types.html"><span class="hs-identifier">Distribution.Simple.Program.Types</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Program.Find.html"><span class="hs-identifier">Distribution.Simple.Program.Find</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Program.Builtin.html"><span class="hs-identifier">Distribution.Simple.Program.Builtin</span></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Simple.Utils.html"><span class="hs-identifier">Distribution.Simple.Utils</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Version.html"><span class="hs-identifier">Distribution.Version</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Text.html"><span class="hs-identifier">Distribution.Text</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="Distribution.Verbosity.html"><span class="hs-identifier">Distribution.Verbosity</span></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">join</span><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Tuple</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">swap</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-comment">-- ------------------------------------------------------------</span><span>
</span><a name="line-79"></a><span class="hs-comment">-- * Programs database</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- ------------------------------------------------------------</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-comment">-- | The configuration is a collection of information about programs. It</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- contains information both about configured programs and also about programs</span><span>
</span><a name="line-84"></a><span class="hs-comment">-- that we are yet to configure.</span><span>
</span><a name="line-85"></a><span class="hs-comment">--</span><span>
</span><a name="line-86"></a><span class="hs-comment">-- The idea is that we start from a collection of unconfigured programs and one</span><span>
</span><a name="line-87"></a><span class="hs-comment">-- by one we try to configure them at which point we move them into the</span><span>
</span><a name="line-88"></a><span class="hs-comment">-- configured collection. For unconfigured programs we record not just the</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- 'Program' but also any user-provided arguments and location for the program.</span><span>
</span><a name="line-90"></a><span class="hs-keyword">data</span><span> </span><a name="ProgramDb"><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier">ProgramDb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ProgramDb"><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier">ProgramDb</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-91"></a><span>        </span><a name="unconfiguredProgs"><a href="Distribution.Simple.Program.Db.html#unconfiguredProgs"><span class="hs-identifier">unconfiguredProgs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Db.html#UnconfiguredProgs"><span class="hs-identifier hs-type">UnconfiguredProgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>        </span><a name="progSearchPath"><a href="Distribution.Simple.Program.Db.html#progSearchPath"><span class="hs-identifier">progSearchPath</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>        </span><a name="configuredProgs"><a href="Distribution.Simple.Program.Db.html#configuredProgs"><span class="hs-identifier">configuredProgs</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Db.html#ConfiguredProgs"><span class="hs-identifier hs-type">ConfiguredProgs</span></a><span>
</span><a name="line-94"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-95"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-keyword">type</span><span> </span><a name="UnconfiguredProgram"><a href="Distribution.Simple.Program.Db.html#UnconfiguredProgram"><span class="hs-identifier">UnconfiguredProgram</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Program.Types.html#ProgArg"><span class="hs-identifier hs-type">ProgArg</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span class="hs-keyword">type</span><span> </span><a name="UnconfiguredProgs"><a href="Distribution.Simple.Program.Db.html#UnconfiguredProgs"><span class="hs-identifier">UnconfiguredProgs</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="Distribution.Simple.Program.Db.html#UnconfiguredProgram"><span class="hs-identifier hs-type">UnconfiguredProgram</span></a><span>
</span><a name="line-99"></a><span class="hs-keyword">type</span><span> </span><a name="ConfiguredProgs"><a href="Distribution.Simple.Program.Db.html#ConfiguredProgs"><span class="hs-identifier">ConfiguredProgs</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-identifier">emptyProgramDb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-103"></a><a name="emptyProgramDb"><a href="Distribution.Simple.Program.Db.html#emptyProgramDb"><span class="hs-identifier">emptyProgramDb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-var">ProgramDb</span></a><span> </span><span class="hs-identifier hs-var">Map.empty</span><span> </span><a href="Distribution.Simple.Program.Find.html#defaultProgramSearchPath"><span class="hs-identifier hs-var">defaultProgramSearchPath</span></a><span> </span><span class="hs-identifier hs-var">Map.empty</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-identifier">defaultProgramDb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-106"></a><a name="defaultProgramDb"><a href="Distribution.Simple.Program.Db.html#defaultProgramDb"><span class="hs-identifier">defaultProgramDb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#restoreProgramDb"><span class="hs-identifier hs-var">restoreProgramDb</span></a><span> </span><a href="Distribution.Simple.Program.Builtin.html#builtinPrograms"><span class="hs-identifier hs-var">builtinPrograms</span></a><span> </span><a href="Distribution.Simple.Program.Db.html#emptyProgramDb"><span class="hs-identifier hs-var">emptyProgramDb</span></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">-- internal helpers:</span><span>
</span><a name="line-110"></a><span class="hs-identifier">updateUnconfiguredProgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Db.html#UnconfiguredProgs"><span class="hs-identifier hs-type">UnconfiguredProgs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#UnconfiguredProgs"><span class="hs-identifier hs-type">UnconfiguredProgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-112"></a><a name="updateUnconfiguredProgs"><a href="Distribution.Simple.Program.Db.html#updateUnconfiguredProgs"><span class="hs-identifier">updateUnconfiguredProgs</span></a></a><span> </span><a name="local-6989586621679368746"><a href="#local-6989586621679368746"><span class="hs-identifier">update</span></a></a><span> </span><a name="local-6989586621679368747"><a href="#local-6989586621679368747"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-113"></a><span>  </span><a href="#local-6989586621679368747"><span class="hs-identifier hs-var">progdb</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">unconfiguredProgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368746"><span class="hs-identifier hs-var">update</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">unconfiguredProgs</span><span> </span><a href="#local-6989586621679368747"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-identifier">updateConfiguredProgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Db.html#ConfiguredProgs"><span class="hs-identifier hs-type">ConfiguredProgs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ConfiguredProgs"><span class="hs-identifier hs-type">ConfiguredProgs</span></a><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-117"></a><a name="updateConfiguredProgs"><a href="Distribution.Simple.Program.Db.html#updateConfiguredProgs"><span class="hs-identifier">updateConfiguredProgs</span></a></a><span> </span><a name="local-6989586621679368748"><a href="#local-6989586621679368748"><span class="hs-identifier">update</span></a></a><span> </span><a name="local-6989586621679368749"><a href="#local-6989586621679368749"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-118"></a><span>  </span><a href="#local-6989586621679368749"><span class="hs-identifier hs-var">progdb</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">configuredProgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368748"><span class="hs-identifier hs-var">update</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">configuredProgs</span><span> </span><a href="#local-6989586621679368749"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">-- Read &amp; Show instances are based on listToFM</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">-- | Note that this instance does not preserve the known 'Program's.</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- See 'restoreProgramDb' for details.</span><span>
</span><a name="line-125"></a><span class="hs-comment">--</span><span>
</span><a name="line-126"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-127"></a><span>  </span><a name="local-8214565720323790323"><span class="hs-identifier">show</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Map.toAscList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">configuredProgs</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-comment">-- | Note that this instance does not preserve the known 'Program's.</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- See 'restoreProgramDb' for details.</span><span>
</span><a name="line-131"></a><span class="hs-comment">--</span><span>
</span><a name="line-132"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Read</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-133"></a><span>  </span><a name="local-8214565720323790028"><span class="hs-identifier">readsPrec</span></a><span> </span><a name="local-6989586621679368742"><a href="#local-6989586621679368742"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679368743"><a href="#local-6989586621679368743"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Db.html#emptyProgramDb"><span class="hs-identifier hs-var">emptyProgramDb</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">configuredProgs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><a href="#local-6989586621679368744"><span class="hs-identifier hs-var">s'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679368745"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679368744"><a href="#local-6989586621679368744"><span class="hs-identifier">s'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679368745"><a href="#local-6989586621679368745"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readsPrec</span><span> </span><a href="#local-6989586621679368742"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679368743"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">-- | Note that this instance does not preserve the known 'Program's.</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- See 'restoreProgramDb' for details.</span><span>
</span><a name="line-139"></a><span class="hs-comment">--</span><span>
</span><a name="line-140"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Binary</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-141"></a><span>  </span><a name="local-8214565720323790561"><span class="hs-identifier">put</span></a><span> </span><a name="local-6989586621679368739"><a href="#local-6989586621679368739"><span class="hs-identifier">db</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-142"></a><span>    </span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">progSearchPath</span><span> </span><a href="#local-6989586621679368739"><span class="hs-identifier hs-var">db</span></a><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-identifier hs-var">put</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">configuredProgs</span><span> </span><a href="#local-6989586621679368739"><span class="hs-identifier hs-var">db</span></a><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span>  </span><a name="local-8214565720323790560"><span class="hs-identifier">get</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-146"></a><span>    </span><a name="local-6989586621679368740"><a href="#local-6989586621679368740"><span class="hs-identifier">searchpath</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-147"></a><span>    </span><a name="local-6989586621679368741"><a href="#local-6989586621679368741"><span class="hs-identifier">progs</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">get</span><span>
</span><a name="line-148"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="Distribution.Simple.Program.Db.html#emptyProgramDb"><span class="hs-identifier hs-var">emptyProgramDb</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-149"></a><span>      </span><span class="hs-identifier">progSearchPath</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368740"><span class="hs-identifier hs-var">searchpath</span></a><span class="hs-special">,</span><span>
</span><a name="line-150"></a><span>      </span><span class="hs-identifier">configuredProgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368741"><span class="hs-identifier hs-var">progs</span></a><span>
</span><a name="line-151"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- | The 'Read'\/'Show' and 'Binary' instances do not preserve all the</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- unconfigured 'Programs' because 'Program' is not in 'Read'\/'Show' because</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- it contains functions. So to fully restore a deserialised 'ProgramDb' use</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- this function to add back all the known 'Program's.</span><span>
</span><a name="line-158"></a><span class="hs-comment">--</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- * It does not add the default programs, but you probably want them, use</span><span>
</span><a name="line-160"></a><span class="hs-comment">--   'builtinPrograms' in addition to any extra you might need.</span><span>
</span><a name="line-161"></a><span class="hs-comment">--</span><span>
</span><a name="line-162"></a><span class="hs-identifier">restoreProgramDb</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-163"></a><a name="restoreProgramDb"><a href="Distribution.Simple.Program.Db.html#restoreProgramDb"><span class="hs-identifier">restoreProgramDb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#addKnownPrograms"><span class="hs-identifier hs-var">addKnownPrograms</span></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">-- -------------------------------</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- Managing unconfigured programs</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span class="hs-comment">-- | Add a known program that we may configure later</span><span>
</span><a name="line-170"></a><span class="hs-comment">--</span><span>
</span><a name="line-171"></a><span class="hs-identifier">addKnownProgram</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-172"></a><a name="addKnownProgram"><a href="Distribution.Simple.Program.Db.html#addKnownProgram"><span class="hs-identifier">addKnownProgram</span></a></a><span> </span><a name="local-6989586621679368750"><a href="#local-6989586621679368750"><span class="hs-identifier">prog</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#updateUnconfiguredProgs"><span class="hs-identifier hs-var">updateUnconfiguredProgs</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-173"></a><span>  </span><span class="hs-identifier hs-var">Map.insertWith</span><span> </span><a href="#local-6989586621679368751"><span class="hs-identifier hs-var">combine</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679368750"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679368750"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679368751"><a href="#local-6989586621679368751"><span class="hs-identifier">combine</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679368752"><a href="#local-6989586621679368752"><span class="hs-identifier">path</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679368753"><a href="#local-6989586621679368753"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679368750"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679368752"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679368753"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-identifier">addKnownPrograms</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-178"></a><a name="addKnownPrograms"><a href="Distribution.Simple.Program.Db.html#addKnownPrograms"><span class="hs-identifier">addKnownPrograms</span></a></a><span> </span><a name="local-6989586621679368754"><a href="#local-6989586621679368754"><span class="hs-identifier">progs</span></a></a><span> </span><a name="local-6989586621679368755"><a href="#local-6989586621679368755"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><a href="Distribution.Simple.Program.Db.html#addKnownProgram"><span class="hs-identifier hs-var">addKnownProgram</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679368755"><span class="hs-identifier hs-var">progdb</span></a><span> </span><a href="#local-6989586621679368754"><span class="hs-identifier hs-var">progs</span></a><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-identifier">lookupKnownProgram</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span>
</span><a name="line-182"></a><a name="lookupKnownProgram"><a href="Distribution.Simple.Program.Db.html#lookupKnownProgram"><span class="hs-identifier">lookupKnownProgram</span></a></a><span> </span><a name="local-6989586621679368756"><a href="#local-6989586621679368756"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-183"></a><span>  </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679368757"><a href="#local-6989586621679368757"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><a href="#local-6989586621679368757"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679368756"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unconfiguredProgs</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-identifier">knownPrograms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-187"></a><a name="knownPrograms"><a href="Distribution.Simple.Program.Db.html#knownPrograms"><span class="hs-identifier">knownPrograms</span></a></a><span> </span><a name="local-6989586621679368758"><a href="#local-6989586621679368758"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-188"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679368759"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">,</span><a href="#local-6989586621679368760"><span class="hs-identifier hs-var">p'</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679368759"><a href="#local-6989586621679368759"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Map.elems</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unconfiguredProgs</span><span> </span><a href="#local-6989586621679368758"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679368760"><a href="#local-6989586621679368760"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679368759"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">configuredProgs</span><span> </span><a href="#local-6989586621679368758"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-comment">-- | Get the current 'ProgramSearchPath' used by the 'ProgramDb'.</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- This is the default list of locations where programs are looked for when</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- configuring them. This can be overridden for specific programs (with</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- 'userSpecifyPath'), and specific known programs can modify or ignore this</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- search path in their own configuration code.</span><span>
</span><a name="line-196"></a><span class="hs-comment">--</span><span>
</span><a name="line-197"></a><span class="hs-identifier">getProgramSearchPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span>
</span><a name="line-198"></a><a name="getProgramSearchPath"><a href="Distribution.Simple.Program.Db.html#getProgramSearchPath"><span class="hs-identifier">getProgramSearchPath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">progSearchPath</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">-- | Change the current 'ProgramSearchPath' used by the 'ProgramDb'.</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- This will affect programs that are configured from here on, so you</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- should usually set it before configuring any programs.</span><span>
</span><a name="line-203"></a><span class="hs-comment">--</span><span>
</span><a name="line-204"></a><span class="hs-identifier">setProgramSearchPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-205"></a><a name="setProgramSearchPath"><a href="Distribution.Simple.Program.Db.html#setProgramSearchPath"><span class="hs-identifier">setProgramSearchPath</span></a></a><span> </span><a name="local-6989586621679368761"><a href="#local-6989586621679368761"><span class="hs-identifier">searchpath</span></a></a><span> </span><a name="local-6989586621679368762"><a href="#local-6989586621679368762"><span class="hs-identifier">db</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368762"><span class="hs-identifier hs-var">db</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">progSearchPath</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368761"><span class="hs-identifier hs-var">searchpath</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-comment">-- | Modify the current 'ProgramSearchPath' used by the 'ProgramDb'.</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- This will affect programs that are configured from here on, so you</span><span>
</span><a name="line-209"></a><span class="hs-comment">-- should usually modify it before configuring any programs.</span><span>
</span><a name="line-210"></a><span class="hs-comment">--</span><span>
</span><a name="line-211"></a><span class="hs-identifier">modifyProgramSearchPath</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Find.html#ProgramSearchPath"><span class="hs-identifier hs-type">ProgramSearchPath</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-213"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-214"></a><a name="modifyProgramSearchPath"><a href="Distribution.Simple.Program.Db.html#modifyProgramSearchPath"><span class="hs-identifier">modifyProgramSearchPath</span></a></a><span> </span><a name="local-6989586621679368763"><a href="#local-6989586621679368763"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679368764"><a href="#local-6989586621679368764"><span class="hs-identifier">db</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-215"></a><span>  </span><a href="Distribution.Simple.Program.Db.html#setProgramSearchPath"><span class="hs-identifier hs-var">setProgramSearchPath</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679368763"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Distribution.Simple.Program.Db.html#getProgramSearchPath"><span class="hs-identifier hs-var">getProgramSearchPath</span></a><span> </span><a href="#local-6989586621679368764"><span class="hs-identifier hs-var">db</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679368764"><span class="hs-identifier hs-var">db</span></a><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-comment">-- |User-specify this path.  Basically override any path information</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- for this program in the configuration. If it's not a known</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- program ignore it.</span><span>
</span><a name="line-220"></a><span class="hs-comment">--</span><span>
</span><a name="line-221"></a><span class="hs-identifier">userSpecifyPath</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>   </span><span class="hs-comment">-- ^Program name</span><span>
</span><a name="line-222"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-comment">-- ^user-specified path to the program</span><span>
</span><a name="line-223"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-224"></a><a name="userSpecifyPath"><a href="Distribution.Simple.Program.Db.html#userSpecifyPath"><span class="hs-identifier">userSpecifyPath</span></a></a><span> </span><a name="local-6989586621679368765"><a href="#local-6989586621679368765"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679368766"><a href="#local-6989586621679368766"><span class="hs-identifier">path</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#updateUnconfiguredProgs"><span class="hs-identifier hs-var">updateUnconfiguredProgs</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-225"></a><span>  </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">Map.update</span><span> </span><a href="#local-6989586621679368765"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679368767"><a href="#local-6989586621679368767"><span class="hs-identifier">prog</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679368768"><a href="#local-6989586621679368768"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679368767"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679368766"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679368768"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-identifier">userMaybeSpecifyPath</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-229"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-230"></a><a name="userMaybeSpecifyPath"><a href="Distribution.Simple.Program.Db.html#userMaybeSpecifyPath"><span class="hs-identifier">userMaybeSpecifyPath</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679368769"><a href="#local-6989586621679368769"><span class="hs-identifier">progdb</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368769"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-231"></a><span class="hs-identifier">userMaybeSpecifyPath</span><span> </span><a name="local-6989586621679368770"><a href="#local-6989586621679368770"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679368771"><a href="#local-6989586621679368771"><span class="hs-identifier">path</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679368772"><a href="#local-6989586621679368772"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#userSpecifyPath"><span class="hs-identifier hs-var">userSpecifyPath</span></a><span> </span><a href="#local-6989586621679368770"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679368771"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679368772"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">-- |User-specify the arguments for this program.  Basically override</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- any args information for this program in the configuration. If it's</span><span>
</span><a name="line-236"></a><span class="hs-comment">-- not a known program, ignore it..</span><span>
</span><a name="line-237"></a><span class="hs-identifier">userSpecifyArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>    </span><span class="hs-comment">-- ^Program name</span><span>
</span><a name="line-238"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Program.Types.html#ProgArg"><span class="hs-identifier hs-type">ProgArg</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^user-specified args</span><span>
</span><a name="line-239"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-240"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-241"></a><a name="userSpecifyArgs"><a href="Distribution.Simple.Program.Db.html#userSpecifyArgs"><span class="hs-identifier">userSpecifyArgs</span></a></a><span> </span><a name="local-6989586621679368773"><a href="#local-6989586621679368773"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679368774"><a href="#local-6989586621679368774"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-242"></a><span>    </span><a href="Distribution.Simple.Program.Db.html#updateUnconfiguredProgs"><span class="hs-identifier hs-var">updateUnconfiguredProgs</span></a><span>
</span><a name="line-243"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">Map.update</span><span> </span><a href="#local-6989586621679368773"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-244"></a><span>         </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679368775"><a href="#local-6989586621679368775"><span class="hs-identifier">prog</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679368776"><a href="#local-6989586621679368776"><span class="hs-identifier">path</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679368777"><a href="#local-6989586621679368777"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679368775"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679368776"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679368777"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679368774"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-245"></a><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="Distribution.Simple.Program.Db.html#updateConfiguredProgs"><span class="hs-identifier hs-var">updateConfiguredProgs</span></a><span>
</span><a name="line-246"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">Map.update</span><span> </span><a href="#local-6989586621679368773"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-247"></a><span>         </span><span class="hs-glyph">\</span><a name="local-6989586621679368778"><a href="#local-6989586621679368778"><span class="hs-identifier">prog</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679368778"><span class="hs-identifier hs-var">prog</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">programOverrideArgs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">programOverrideArgs</span><span> </span><a href="#local-6989586621679368778"><span class="hs-identifier hs-var">prog</span></a><span>
</span><a name="line-248"></a><span>                                                 </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679368774"><span class="hs-identifier hs-var">args'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">-- | Like 'userSpecifyPath' but for a list of progs and their paths.</span><span>
</span><a name="line-252"></a><span class="hs-comment">--</span><span>
</span><a name="line-253"></a><span class="hs-identifier">userSpecifyPaths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-254"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-255"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-256"></a><a name="userSpecifyPaths"><a href="Distribution.Simple.Program.Db.html#userSpecifyPaths"><span class="hs-identifier">userSpecifyPaths</span></a></a><span> </span><a name="local-6989586621679368779"><a href="#local-6989586621679368779"><span class="hs-identifier">paths</span></a></a><span> </span><a name="local-6989586621679368780"><a href="#local-6989586621679368780"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-257"></a><span>  </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679368781"><a href="#local-6989586621679368781"><span class="hs-identifier">progdb'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679368782"><a href="#local-6989586621679368782"><span class="hs-identifier">prog</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679368783"><a href="#local-6989586621679368783"><span class="hs-identifier">path</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#userSpecifyPath"><span class="hs-identifier hs-var">userSpecifyPath</span></a><span> </span><a href="#local-6989586621679368782"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368783"><span class="hs-identifier hs-var">path</span></a><span> </span><a href="#local-6989586621679368781"><span class="hs-identifier hs-var">progdb'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679368780"><span class="hs-identifier hs-var">progdb</span></a><span> </span><a href="#local-6989586621679368779"><span class="hs-identifier hs-var">paths</span></a><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span class="hs-comment">-- | Like 'userSpecifyPath' but for a list of progs and their args.</span><span>
</span><a name="line-261"></a><span class="hs-comment">--</span><span>
</span><a name="line-262"></a><span class="hs-identifier">userSpecifyArgss</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Program.Types.html#ProgArg"><span class="hs-identifier hs-type">ProgArg</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-263"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-264"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-265"></a><a name="userSpecifyArgss"><a href="Distribution.Simple.Program.Db.html#userSpecifyArgss"><span class="hs-identifier">userSpecifyArgss</span></a></a><span> </span><a name="local-6989586621679368784"><a href="#local-6989586621679368784"><span class="hs-identifier">argss</span></a></a><span> </span><a name="local-6989586621679368785"><a href="#local-6989586621679368785"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-266"></a><span>  </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679368786"><a href="#local-6989586621679368786"><span class="hs-identifier">progdb'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679368787"><a href="#local-6989586621679368787"><span class="hs-identifier">prog</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679368788"><a href="#local-6989586621679368788"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#userSpecifyArgs"><span class="hs-identifier hs-var">userSpecifyArgs</span></a><span> </span><a href="#local-6989586621679368787"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368788"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679368786"><span class="hs-identifier hs-var">progdb'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679368785"><span class="hs-identifier hs-var">progdb</span></a><span> </span><a href="#local-6989586621679368784"><span class="hs-identifier hs-var">argss</span></a><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-comment">-- | Get the path that has been previously specified for a program, if any.</span><span>
</span><a name="line-270"></a><span class="hs-comment">--</span><span>
</span><a name="line-271"></a><span class="hs-identifier">userSpecifiedPath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-272"></a><a name="userSpecifiedPath"><a href="Distribution.Simple.Program.Db.html#userSpecifiedPath"><span class="hs-identifier">userSpecifiedPath</span></a></a><span> </span><a name="local-6989586621679368789"><a href="#local-6989586621679368789"><span class="hs-identifier">prog</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-273"></a><span>  </span><span class="hs-identifier hs-var">join</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679368790"><a href="#local-6989586621679368790"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><a href="#local-6989586621679368790"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679368789"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unconfiguredProgs</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-comment">-- | Get any extra args that have been previously specified for a program.</span><span>
</span><a name="line-277"></a><span class="hs-comment">--</span><span>
</span><a name="line-278"></a><span class="hs-identifier">userSpecifiedArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Program.Types.html#ProgArg"><span class="hs-identifier hs-type">ProgArg</span></a><span class="hs-special">]</span><span>
</span><a name="line-279"></a><a name="userSpecifiedArgs"><a href="Distribution.Simple.Program.Db.html#userSpecifiedArgs"><span class="hs-identifier">userSpecifiedArgs</span></a></a><span> </span><a name="local-6989586621679368791"><a href="#local-6989586621679368791"><span class="hs-identifier">prog</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-280"></a><span>  </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679368791"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unconfiguredProgs</span><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-comment">-- -----------------------------</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- Managing configured programs</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-comment">-- | Try to find a configured program</span><span>
</span><a name="line-287"></a><span class="hs-identifier">lookupProgram</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span>
</span><a name="line-288"></a><a name="lookupProgram"><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier">lookupProgram</span></a></a><span> </span><a name="local-6989586621679368793"><a href="#local-6989586621679368793"><span class="hs-identifier">prog</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679368793"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">configuredProgs</span><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span class="hs-comment">-- | Update a configured program in the database.</span><span>
</span><a name="line-292"></a><span class="hs-identifier">updateProgram</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-293"></a><span>                                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-294"></a><a name="updateProgram"><a href="Distribution.Simple.Program.Db.html#updateProgram"><span class="hs-identifier">updateProgram</span></a></a><span> </span><a name="local-6989586621679368794"><a href="#local-6989586621679368794"><span class="hs-identifier">prog</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#updateConfiguredProgs"><span class="hs-identifier hs-var">updateConfiguredProgs</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-295"></a><span>  </span><span class="hs-identifier hs-var">Map.insert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">programId</span><span> </span><a href="#local-6989586621679368794"><span class="hs-identifier hs-var">prog</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679368794"><span class="hs-identifier hs-var">prog</span></a><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-comment">-- | List all configured programs.</span><span>
</span><a name="line-299"></a><span class="hs-identifier">configuredPrograms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span class="hs-special">]</span><span>
</span><a name="line-300"></a><a name="configuredPrograms"><a href="Distribution.Simple.Program.Db.html#configuredPrograms"><span class="hs-identifier">configuredPrograms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.elems</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">configuredProgs</span><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span class="hs-comment">-- ---------------------------</span><span>
</span><a name="line-303"></a><span class="hs-comment">-- Configuring known programs</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-comment">-- | Try to configure a specific program. If the program is already included in</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- the collection of unconfigured programs then we use any user-supplied</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- location and arguments. If the program gets configured successfully it gets</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- added to the configured collection.</span><span>
</span><a name="line-309"></a><span class="hs-comment">--</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- Note that it is not a failure if the program cannot be configured. It's only</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- a failure if the user supplied a location and the program could not be found</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- at that location.</span><span>
</span><a name="line-313"></a><span class="hs-comment">--</span><span>
</span><a name="line-314"></a><span class="hs-comment">-- The reason for it not being a failure at this stage is that we don't know up</span><span>
</span><a name="line-315"></a><span class="hs-comment">-- front all the programs we will need, so we try to configure them all.</span><span>
</span><a name="line-316"></a><span class="hs-comment">-- To verify that a program was actually successfully configured use</span><span>
</span><a name="line-317"></a><span class="hs-comment">-- 'requireProgram'.</span><span>
</span><a name="line-318"></a><span class="hs-comment">--</span><span>
</span><a name="line-319"></a><span class="hs-identifier">configureProgram</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-320"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span>
</span><a name="line-321"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-322"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-323"></a><a name="configureProgram"><a href="Distribution.Simple.Program.Db.html#configureProgram"><span class="hs-identifier">configureProgram</span></a></a><span> </span><a name="local-6989586621679368795"><a href="#local-6989586621679368795"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679368796"><a href="#local-6989586621679368796"><span class="hs-identifier">prog</span></a></a><span> </span><a name="local-6989586621679368797"><a href="#local-6989586621679368797"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-324"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679368798"><a href="#local-6989586621679368798"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679368796"><span class="hs-identifier hs-var">prog</span></a><span>
</span><a name="line-325"></a><span>  </span><a name="local-6989586621679368802"><a href="#local-6989586621679368802"><span class="hs-identifier">maybeLocation</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Distribution.Simple.Program.Db.html#userSpecifiedPath"><span class="hs-identifier hs-var">userSpecifiedPath</span></a><span> </span><a href="#local-6989586621679368796"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368797"><span class="hs-identifier hs-var">progdb</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-326"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-327"></a><span>      </span><span class="hs-identifier">programFindLocation</span><span> </span><a href="#local-6989586621679368796"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368795"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">progSearchPath</span><span> </span><a href="#local-6989586621679368797"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span>      </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">swap</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Distribution.Simple.Program.Types.html#FoundOnSystem"><span class="hs-identifier hs-var">FoundOnSystem</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">swap</span><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679368799"><a href="#local-6989586621679368799"><span class="hs-identifier">path</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-330"></a><span>      </span><a name="local-6989586621679368801"><a href="#local-6989586621679368801"><span class="hs-identifier">absolute</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Utils.html#doesExecutableExist"><span class="hs-identifier hs-var">doesExecutableExist</span></a><span> </span><a href="#local-6989586621679368799"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-331"></a><span>      </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679368801"><span class="hs-identifier hs-var">absolute</span></a><span>
</span><a name="line-332"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Types.html#UserSpecified"><span class="hs-identifier hs-var">UserSpecified</span></a><span> </span><a href="#local-6989586621679368799"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-333"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="Distribution.Simple.Program.Find.html#findProgramOnSearchPath"><span class="hs-identifier hs-var">findProgramOnSearchPath</span></a><span> </span><a href="#local-6989586621679368795"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">progSearchPath</span><span> </span><a href="#local-6989586621679368797"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679368799"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-334"></a><span>             </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Utils.html#die%27"><span class="hs-identifier hs-var">die'</span></a><span> </span><a href="#local-6989586621679368795"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679368800"><span class="hs-identifier hs-var">notFound</span></a><span class="hs-special">)</span><span>
</span><a name="line-335"></a><span>                       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">swap</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Distribution.Simple.Program.Types.html#UserSpecified"><span class="hs-identifier hs-var">UserSpecified</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">swap</span><span class="hs-special">)</span><span>
</span><a name="line-336"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679368800"><a href="#local-6989586621679368800"><span class="hs-identifier">notFound</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Cannot find the program '&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679368798"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-337"></a><span>                     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;'. User-specified path '&quot;</span><span>
</span><a name="line-338"></a><span>                     </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679368799"><span class="hs-identifier hs-var">path</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;' does not refer to an executable and &quot;</span><span>
</span><a name="line-339"></a><span>                     </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;the program is not on the system path.&quot;</span><span>
</span><a name="line-340"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679368802"><span class="hs-identifier hs-var">maybeLocation</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-341"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679368797"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-342"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679368803"><a href="#local-6989586621679368803"><span class="hs-identifier">location</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679368804"><a href="#local-6989586621679368804"><span class="hs-identifier">triedLocations</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-343"></a><span>      </span><a name="local-6989586621679368805"><a href="#local-6989586621679368805"><span class="hs-identifier">version</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">programFindVersion</span><span> </span><a href="#local-6989586621679368796"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368795"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">locationPath</span><span> </span><a href="#local-6989586621679368803"><span class="hs-identifier hs-var">location</span></a><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>      </span><a name="local-6989586621679368806"><a href="#local-6989586621679368806"><span class="hs-identifier">newPath</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Distribution.Simple.Program.Find.html#programSearchPathAsPATHVar"><span class="hs-identifier hs-var">programSearchPathAsPATHVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">progSearchPath</span><span> </span><a href="#local-6989586621679368797"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">)</span><span>
</span><a name="line-345"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679368807"><a href="#local-6989586621679368807"><span class="hs-identifier">configuredProg</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-var">ConfiguredProgram</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-346"></a><span>            </span><span class="hs-identifier">programId</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368798"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span>
</span><a name="line-347"></a><span>            </span><span class="hs-identifier">programVersion</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368805"><span class="hs-identifier hs-var">version</span></a><span class="hs-special">,</span><span>
</span><a name="line-348"></a><span>            </span><span class="hs-identifier">programDefaultArgs</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-349"></a><span>            </span><span class="hs-identifier">programOverrideArgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Distribution.Simple.Program.Db.html#userSpecifiedArgs"><span class="hs-identifier hs-var">userSpecifiedArgs</span></a><span> </span><a href="#local-6989586621679368796"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368797"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">,</span><span>
</span><a name="line-350"></a><span>            </span><span class="hs-identifier">programOverrideEnv</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-string">&quot;PATH&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679368806"><span class="hs-identifier hs-var">newPath</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-351"></a><span>            </span><span class="hs-identifier">programProperties</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.empty</span><span class="hs-special">,</span><span>
</span><a name="line-352"></a><span>            </span><span class="hs-identifier">programLocation</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368803"><span class="hs-identifier hs-var">location</span></a><span class="hs-special">,</span><span>
</span><a name="line-353"></a><span>            </span><span class="hs-identifier">programMonitorFiles</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679368804"><span class="hs-identifier hs-var">triedLocations</span></a><span>
</span><a name="line-354"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-355"></a><span>      </span><a name="local-6989586621679368808"><a href="#local-6989586621679368808"><span class="hs-identifier">configuredProg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">programPostConf</span><span> </span><a href="#local-6989586621679368796"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368795"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679368807"><span class="hs-identifier hs-var">configuredProg</span></a><span>
</span><a name="line-356"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Db.html#updateConfiguredProgs"><span class="hs-identifier hs-var">updateConfiguredProgs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.insert</span><span> </span><a href="#local-6989586621679368798"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679368808"><span class="hs-identifier hs-var">configuredProg'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679368797"><span class="hs-identifier hs-var">progdb</span></a><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span class="hs-comment">-- | Configure a bunch of programs using 'configureProgram'. Just a 'foldM'.</span><span>
</span><a name="line-360"></a><span class="hs-comment">--</span><span>
</span><a name="line-361"></a><span class="hs-identifier">configurePrograms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-362"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span class="hs-special">]</span><span>
</span><a name="line-363"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-364"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-365"></a><a name="configurePrograms"><a href="Distribution.Simple.Program.Db.html#configurePrograms"><span class="hs-identifier">configurePrograms</span></a></a><span> </span><a name="local-6989586621679368809"><a href="#local-6989586621679368809"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679368810"><a href="#local-6989586621679368810"><span class="hs-identifier">progs</span></a></a><span> </span><a name="local-6989586621679368811"><a href="#local-6989586621679368811"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-366"></a><span>  </span><span class="hs-identifier hs-var">foldM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Db.html#configureProgram"><span class="hs-identifier hs-var">configureProgram</span></a><span> </span><a href="#local-6989586621679368809"><span class="hs-identifier hs-var">verbosity</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679368811"><span class="hs-identifier hs-var">progdb</span></a><span> </span><a href="#local-6989586621679368810"><span class="hs-identifier hs-var">progs</span></a><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-comment">-- | Unconfigure a program.  This is basically a hack and you shouldn't</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- use it, but it can be handy for making sure a 'requireProgram'</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- actually reconfigures.</span><span>
</span><a name="line-372"></a><span class="hs-identifier">unconfigureProgram</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-373"></a><a name="unconfigureProgram"><a href="Distribution.Simple.Program.Db.html#unconfigureProgram"><span class="hs-identifier">unconfigureProgram</span></a></a><span> </span><a name="local-6989586621679368812"><a href="#local-6989586621679368812"><span class="hs-identifier">progname</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-374"></a><span>  </span><a href="Distribution.Simple.Program.Db.html#updateConfiguredProgs"><span class="hs-identifier hs-var">updateConfiguredProgs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map.delete</span><span> </span><a href="#local-6989586621679368812"><span class="hs-identifier hs-var">progname</span></a><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-comment">-- | Try to configure all the known programs that have not yet been configured.</span><span>
</span><a name="line-377"></a><span class="hs-comment">--</span><span>
</span><a name="line-378"></a><span class="hs-identifier">configureAllKnownPrograms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-379"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-380"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-381"></a><a name="configureAllKnownPrograms"><a href="Distribution.Simple.Program.Db.html#configureAllKnownPrograms"><span class="hs-identifier">configureAllKnownPrograms</span></a></a><span> </span><a name="local-6989586621679368813"><a href="#local-6989586621679368813"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679368814"><a href="#local-6989586621679368814"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-382"></a><span>  </span><a href="Distribution.Simple.Program.Db.html#configurePrograms"><span class="hs-identifier hs-var">configurePrograms</span></a><span> </span><a href="#local-6989586621679368813"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-383"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679368816"><span class="hs-identifier hs-var">prog</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679368816"><a href="#local-6989586621679368816"><span class="hs-identifier">prog</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Map.elems</span><span> </span><a href="#local-6989586621679368815"><span class="hs-identifier hs-var">notYetConfigured</span></a><span> </span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679368814"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-384"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-385"></a><span>    </span><a name="local-6989586621679368815"><a href="#local-6989586621679368815"><span class="hs-identifier">notYetConfigured</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unconfiguredProgs</span><span> </span><a href="#local-6989586621679368814"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-386"></a><span>      </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Map.difference</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">configuredProgs</span><span> </span><a href="#local-6989586621679368814"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-comment">-- | reconfigure a bunch of programs given new user-specified args. It takes</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- the same inputs as 'userSpecifyPath' and 'userSpecifyArgs' and for all progs</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- with a new path it calls 'configureProgram'.</span><span>
</span><a name="line-392"></a><span class="hs-comment">--</span><span>
</span><a name="line-393"></a><span class="hs-identifier">reconfigurePrograms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span>
</span><a name="line-394"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-395"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Distribution.Simple.Program.Types.html#ProgArg"><span class="hs-identifier hs-type">ProgArg</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-396"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-397"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-398"></a><a name="reconfigurePrograms"><a href="Distribution.Simple.Program.Db.html#reconfigurePrograms"><span class="hs-identifier">reconfigurePrograms</span></a></a><span> </span><a name="local-6989586621679368817"><a href="#local-6989586621679368817"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679368818"><a href="#local-6989586621679368818"><span class="hs-identifier">paths</span></a></a><span> </span><a name="local-6989586621679368819"><a href="#local-6989586621679368819"><span class="hs-identifier">argss</span></a></a><span> </span><a name="local-6989586621679368820"><a href="#local-6989586621679368820"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-399"></a><span>  </span><a href="Distribution.Simple.Program.Db.html#configurePrograms"><span class="hs-identifier hs-var">configurePrograms</span></a><span> </span><a href="#local-6989586621679368817"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679368821"><span class="hs-identifier hs-var">progs</span></a><span>
</span><a name="line-400"></a><span>   </span><span class="hs-operator hs-var">.</span><span> </span><a href="Distribution.Simple.Program.Db.html#userSpecifyPaths"><span class="hs-identifier hs-var">userSpecifyPaths</span></a><span> </span><a href="#local-6989586621679368818"><span class="hs-identifier hs-var">paths</span></a><span>
</span><a name="line-401"></a><span>   </span><span class="hs-operator hs-var">.</span><span> </span><a href="Distribution.Simple.Program.Db.html#userSpecifyArgss"><span class="hs-identifier hs-var">userSpecifyArgss</span></a><span> </span><a href="#local-6989586621679368819"><span class="hs-identifier hs-var">argss</span></a><span>
</span><a name="line-402"></a><span>   </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679368820"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-405"></a><span>    </span><a name="local-6989586621679368821"><a href="#local-6989586621679368821"><span class="hs-identifier">progs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-special">[</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupKnownProgram"><span class="hs-identifier hs-var">lookupKnownProgram</span></a><span> </span><a href="#local-6989586621679368822"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679368820"><span class="hs-identifier hs-var">progdb</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679368822"><a href="#local-6989586621679368822"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679368818"><span class="hs-identifier hs-var">paths</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span class="hs-comment">-- | Check that a program is configured and available to be run.</span><span>
</span><a name="line-409"></a><span class="hs-comment">--</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- It raises an exception if the program could not be configured, otherwise</span><span>
</span><a name="line-411"></a><span class="hs-comment">-- it returns the configured program.</span><span>
</span><a name="line-412"></a><span class="hs-comment">--</span><span>
</span><a name="line-413"></a><span class="hs-identifier">requireProgram</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-414"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span class="hs-special">)</span><span>
</span><a name="line-415"></a><a name="requireProgram"><a href="Distribution.Simple.Program.Db.html#requireProgram"><span class="hs-identifier">requireProgram</span></a></a><span> </span><a name="local-6989586621679368823"><a href="#local-6989586621679368823"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679368824"><a href="#local-6989586621679368824"><span class="hs-identifier">prog</span></a></a><span> </span><a name="local-6989586621679368825"><a href="#local-6989586621679368825"><span class="hs-identifier">progdb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span>  </span><span class="hs-comment">-- If it's not already been configured, try to configure it now</span><span>
</span><a name="line-418"></a><span>  </span><a name="local-6989586621679368827"><a href="#local-6989586621679368827"><span class="hs-identifier">progdb'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span> </span><a href="#local-6989586621679368824"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368825"><span class="hs-identifier hs-var">progdb</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-419"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#configureProgram"><span class="hs-identifier hs-var">configureProgram</span></a><span> </span><a href="#local-6989586621679368823"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679368824"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368825"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-420"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679368825"><span class="hs-identifier hs-var">progdb</span></a><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span> </span><a href="#local-6989586621679368824"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368827"><span class="hs-identifier hs-var">progdb'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-423"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Utils.html#die%27"><span class="hs-identifier hs-var">die'</span></a><span> </span><a href="#local-6989586621679368823"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679368826"><span class="hs-identifier hs-var">notFound</span></a><span>
</span><a name="line-424"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679368828"><a href="#local-6989586621679368828"><span class="hs-identifier">configuredProg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679368828"><span class="hs-identifier hs-var">configuredProg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679368827"><span class="hs-identifier hs-var">progdb'</span></a><span class="hs-special">)</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679368826"><a href="#local-6989586621679368826"><span class="hs-identifier">notFound</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;The program '&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679368824"><span class="hs-identifier hs-var">prog</span></a><span>
</span><a name="line-427"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;' is required but it could not be found.&quot;</span><span>
</span><a name="line-428"></a><span>
</span><a name="line-429"></a><span>
</span><a name="line-430"></a><span class="hs-comment">-- | Check that a program is configured and available to be run.</span><span>
</span><a name="line-431"></a><span class="hs-comment">--</span><span>
</span><a name="line-432"></a><span class="hs-comment">-- Additionally check that the program version number is suitable and return</span><span>
</span><a name="line-433"></a><span class="hs-comment">-- it. For example you could require 'AnyVersion' or @'orLaterVersion'</span><span>
</span><a name="line-434"></a><span class="hs-comment">-- ('Version' [1,0] [])@</span><span>
</span><a name="line-435"></a><span class="hs-comment">--</span><span>
</span><a name="line-436"></a><span class="hs-comment">-- It returns the configured program, its version number and a possibly updated</span><span>
</span><a name="line-437"></a><span class="hs-comment">-- 'ProgramDb'. If the program could not be configured or the version is</span><span>
</span><a name="line-438"></a><span class="hs-comment">-- unsuitable, it returns an error value.</span><span>
</span><a name="line-439"></a><span class="hs-comment">--</span><span>
</span><a name="line-440"></a><span class="hs-identifier">lookupProgramVersion</span><span>
</span><a name="line-441"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.VersionRange.html#VersionRange"><span class="hs-identifier hs-type">VersionRange</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-442"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Types.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-443"></a><a name="lookupProgramVersion"><a href="Distribution.Simple.Program.Db.html#lookupProgramVersion"><span class="hs-identifier">lookupProgramVersion</span></a></a><span> </span><a name="local-6989586621679368829"><a href="#local-6989586621679368829"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679368830"><a href="#local-6989586621679368830"><span class="hs-identifier">prog</span></a></a><span> </span><a name="local-6989586621679368831"><a href="#local-6989586621679368831"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679368832"><a href="#local-6989586621679368832"><span class="hs-identifier">programDb</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span>  </span><span class="hs-comment">-- If it's not already been configured, try to configure it now</span><span>
</span><a name="line-446"></a><span>  </span><a name="local-6989586621679368840"><a href="#local-6989586621679368840"><span class="hs-identifier">programDb'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span> </span><a href="#local-6989586621679368830"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368832"><span class="hs-identifier hs-var">programDb</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-447"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#configureProgram"><span class="hs-identifier hs-var">configureProgram</span></a><span> </span><a href="#local-6989586621679368829"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679368830"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368832"><span class="hs-identifier hs-var">programDb</span></a><span>
</span><a name="line-448"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679368832"><span class="hs-identifier hs-var">programDb</span></a><span>
</span><a name="line-449"></a><span>
</span><a name="line-450"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Distribution.Simple.Program.Db.html#lookupProgram"><span class="hs-identifier hs-var">lookupProgram</span></a><span> </span><a href="#local-6989586621679368830"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368840"><span class="hs-identifier hs-var">programDb'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-451"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679368833"><span class="hs-identifier hs-var">notFound</span></a><span>
</span><a name="line-452"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679368841"><a href="#local-6989586621679368841"><span class="hs-identifier">configuredProg</span></a></a><span class="hs-glyph">@</span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-var">ConfiguredProgram</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">programLocation</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679368842"><a href="#local-6989586621679368842"><span class="hs-identifier">location</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-453"></a><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">programVersion</span><span> </span><a href="#local-6989586621679368841"><span class="hs-identifier hs-var">configuredProg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-454"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679368843"><a href="#local-6989586621679368843"><span class="hs-identifier">version</span></a></a><span>
</span><a name="line-455"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="Distribution.Types.VersionRange.html#withinRange"><span class="hs-identifier hs-var">withinRange</span></a><span> </span><a href="#local-6989586621679368843"><span class="hs-identifier hs-var">version</span></a><span> </span><a href="#local-6989586621679368831"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-456"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679368841"><span class="hs-identifier hs-var">configuredProg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679368843"><span class="hs-identifier hs-var">version</span></a><span> </span><span class="hs-special">,</span><a href="#local-6989586621679368840"><span class="hs-identifier hs-var">programDb'</span></a><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                 </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-458"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679368834"><span class="hs-identifier hs-var">badVersion</span></a><span> </span><a href="#local-6989586621679368843"><span class="hs-identifier hs-var">version</span></a><span> </span><a href="#local-6989586621679368842"><span class="hs-identifier hs-var">location</span></a><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>                       </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-460"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679368835"><span class="hs-identifier hs-var">unknownVersion</span></a><span> </span><a href="#local-6989586621679368842"><span class="hs-identifier hs-var">location</span></a><span class="hs-special">)</span><span>
</span><a name="line-461"></a><span>
</span><a name="line-462"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679368833"><a href="#local-6989586621679368833"><span class="hs-identifier">notFound</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;The program '&quot;</span><span>
</span><a name="line-463"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679368830"><span class="hs-identifier hs-var">prog</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;'&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679368836"><span class="hs-identifier hs-var">versionRequirement</span></a><span>
</span><a name="line-464"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; is required but it could not be found.&quot;</span><span>
</span><a name="line-465"></a><span>        </span><a name="local-6989586621679368834"><a href="#local-6989586621679368834"><span class="hs-identifier">badVersion</span></a></a><span> </span><a name="local-6989586621679368837"><a href="#local-6989586621679368837"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679368838"><a href="#local-6989586621679368838"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;The program '&quot;</span><span>
</span><a name="line-466"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679368830"><span class="hs-identifier hs-var">prog</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;'&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679368836"><span class="hs-identifier hs-var">versionRequirement</span></a><span>
</span><a name="line-467"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; is required but the version found at &quot;</span><span>
</span><a name="line-468"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">locationPath</span><span> </span><a href="#local-6989586621679368838"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; is version &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><a href="#local-6989586621679368837"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-469"></a><span>        </span><a name="local-6989586621679368835"><a href="#local-6989586621679368835"><span class="hs-identifier">unknownVersion</span></a></a><span> </span><a name="local-6989586621679368839"><a href="#local-6989586621679368839"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;The program '&quot;</span><span>
</span><a name="line-470"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">programName</span><span> </span><a href="#local-6989586621679368830"><span class="hs-identifier hs-var">prog</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;'&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679368836"><span class="hs-identifier hs-var">versionRequirement</span></a><span>
</span><a name="line-471"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; is required but the version of &quot;</span><span>
</span><a name="line-472"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">locationPath</span><span> </span><a href="#local-6989586621679368839"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; could not be determined.&quot;</span><span>
</span><a name="line-473"></a><span>        </span><a name="local-6989586621679368836"><a href="#local-6989586621679368836"><span class="hs-identifier">versionRequirement</span></a></a><span>
</span><a name="line-474"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="Distribution.Version.html#isAnyVersion"><span class="hs-identifier hs-var">isAnyVersion</span></a><span> </span><a href="#local-6989586621679368831"><span class="hs-identifier hs-var">range</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-475"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot; version &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Distribution.Text.html#display"><span class="hs-identifier hs-var">display</span></a><span> </span><a href="#local-6989586621679368831"><span class="hs-identifier hs-var">range</span></a><span>
</span><a name="line-476"></a><span>
</span><a name="line-477"></a><span class="hs-comment">-- | Like 'lookupProgramVersion', but raises an exception in case of error</span><span>
</span><a name="line-478"></a><span class="hs-comment">-- instead of returning 'Left errMsg'.</span><span>
</span><a name="line-479"></a><span class="hs-comment">--</span><span>
</span><a name="line-480"></a><span class="hs-identifier">requireProgramVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Distribution.Verbosity.html#Verbosity"><span class="hs-identifier hs-type">Verbosity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Types.html#Program"><span class="hs-identifier hs-type">Program</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Types.VersionRange.html#VersionRange"><span class="hs-identifier hs-type">VersionRange</span></a><span>
</span><a name="line-481"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span>
</span><a name="line-482"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Distribution.Compat.Prelude.html#IO"><span class="hs-identifier hs-type">IO</span></a><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Program.Types.html#ConfiguredProgram"><span class="hs-identifier hs-type">ConfiguredProgram</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Types.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a><span class="hs-special">,</span><span> </span><a href="Distribution.Simple.Program.Db.html#ProgramDb"><span class="hs-identifier hs-type">ProgramDb</span></a><span class="hs-special">)</span><span>
</span><a name="line-483"></a><a name="requireProgramVersion"><a href="Distribution.Simple.Program.Db.html#requireProgramVersion"><span class="hs-identifier">requireProgramVersion</span></a></a><span> </span><a name="local-6989586621679368844"><a href="#local-6989586621679368844"><span class="hs-identifier">verbosity</span></a></a><span> </span><a name="local-6989586621679368845"><a href="#local-6989586621679368845"><span class="hs-identifier">prog</span></a></a><span> </span><a name="local-6989586621679368846"><a href="#local-6989586621679368846"><span class="hs-identifier">range</span></a></a><span> </span><a name="local-6989586621679368847"><a href="#local-6989586621679368847"><span class="hs-identifier">programDb</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-484"></a><span>  </span><span class="hs-identifier hs-var">join</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-special">(</span><a href="Distribution.Simple.Utils.html#die%27"><span class="hs-identifier hs-var">die'</span></a><span> </span><a href="#local-6989586621679368844"><span class="hs-identifier hs-var">verbosity</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span>
</span><a name="line-485"></a><span>  </span><a href="Distribution.Simple.Program.Db.html#lookupProgramVersion"><span class="hs-identifier hs-var">lookupProgramVersion</span></a><span> </span><a href="#local-6989586621679368844"><span class="hs-identifier hs-var">verbosity</span></a><span> </span><a href="#local-6989586621679368845"><span class="hs-identifier hs-var">prog</span></a><span> </span><a href="#local-6989586621679368846"><span class="hs-identifier hs-var">range</span></a><span> </span><a href="#local-6989586621679368847"><span class="hs-identifier hs-var">programDb</span></a><span>
</span><a name="line-486"></a></pre></body></html>