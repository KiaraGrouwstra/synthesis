<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><a name="line-3"></a><span class="hs-comment">--</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- (c) The University of Glasgow</span><span>
</span><a name="line-5"></a><span class="hs-comment">--</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Avail</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-10"></a><span>    </span><a href="Avail.html#Avails"><span class="hs-identifier hs-type">Avails</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>    </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>    </span><a href="Avail.html#avail"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>    </span><a href="Avail.html#availsToNameSet"><span class="hs-identifier hs-var">availsToNameSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>    </span><a href="Avail.html#availsToNameSetWithSelectors"><span class="hs-identifier hs-var">availsToNameSetWithSelectors</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>    </span><a href="Avail.html#availsToNameEnv"><span class="hs-identifier hs-var">availsToNameEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>    </span><a href="Avail.html#availName"><span class="hs-identifier hs-var">availName</span></a><span class="hs-special">,</span><span> </span><a href="Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a><span class="hs-special">,</span><span> </span><a href="Avail.html#availNonFldNames"><span class="hs-identifier hs-var">availNonFldNames</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>    </span><a href="Avail.html#availNamesWithSelectors"><span class="hs-identifier hs-var">availNamesWithSelectors</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>    </span><a href="Avail.html#availFlds"><span class="hs-identifier hs-var">availFlds</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>    </span><a href="Avail.html#availsNamesWithOccs"><span class="hs-identifier hs-var">availsNamesWithOccs</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>    </span><a href="Avail.html#availNamesWithOccs"><span class="hs-identifier hs-var">availNamesWithOccs</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>    </span><a href="Avail.html#stableAvailCmp"><span class="hs-identifier hs-var">stableAvailCmp</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>    </span><a href="Avail.html#plusAvail"><span class="hs-identifier hs-var">plusAvail</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>    </span><a href="Avail.html#trimAvail"><span class="hs-identifier hs-var">trimAvail</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>    </span><a href="Avail.html#filterAvail"><span class="hs-identifier hs-var">filterAvail</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>    </span><a href="Avail.html#filterAvails"><span class="hs-identifier hs-var">filterAvails</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>    </span><a href="Avail.html#nubAvails"><span class="hs-identifier hs-var">nubAvails</span></a><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="FieldLabel.html"><span class="hs-identifier">FieldLabel</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="Binary.html"><span class="hs-identifier">Binary</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Data</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Data</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">find</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Function</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-48"></a><span class="hs-comment">-- The AvailInfo type</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-comment">-- | Records what things are \&quot;available\&quot;, i.e. in scope</span><span>
</span><a name="line-51"></a><span class="hs-keyword">data</span><span> </span><a name="AvailInfo"><a href="Avail.html#AvailInfo"><span class="hs-identifier">AvailInfo</span></a></a><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span>  </span><span class="hs-comment">-- | An ordinary identifier in scope</span><span>
</span><a name="line-54"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Avail"><a href="Avail.html#Avail"><span class="hs-identifier">Avail</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span>  </span><span class="hs-comment">-- | A type or class in scope</span><span>
</span><a name="line-57"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-58"></a><span>  </span><span class="hs-comment">-- The __AvailTC Invariant__: If the type or class is itself to be in scope,</span><span>
</span><a name="line-59"></a><span>  </span><span class="hs-comment">-- it must be /first/ in this list.  Thus, typically:</span><span>
</span><a name="line-60"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-comment">-- &gt; AvailTC Eq [Eq, ==, \/=] []</span><span>
</span><a name="line-62"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AvailTC"><a href="Avail.html#AvailTC"><span class="hs-identifier">AvailTC</span></a></a><span>
</span><a name="line-63"></a><span>       </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>         </span><span class="hs-comment">-- ^ The name of the type or class</span><span>
</span><a name="line-64"></a><span>       </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- ^ The available pieces of type or class,</span><span>
</span><a name="line-65"></a><span>                    </span><span class="hs-comment">-- excluding field selectors.</span><span>
</span><a name="line-66"></a><span>       </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ The record fields of the type</span><span>
</span><a name="line-67"></a><span>                    </span><span class="hs-comment">-- (see Note [Representing fields in AvailInfo]).</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>    </span><span class="hs-comment">-- ^ Used when deciding if the interface has changed</span><span>
</span><a name="line-70"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Data</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">-- | A collection of 'AvailInfo' - several things that are \&quot;available\&quot;</span><span>
</span><a name="line-73"></a><span class="hs-keyword">type</span><span> </span><a name="Avails"><a href="Avail.html#Avails"><span class="hs-identifier">Avails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-comment">{-
Note [Representing fields in AvailInfo]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When -XDuplicateRecordFields is disabled (the normal case), a
datatype like

  data T = MkT { foo :: Int }

gives rise to the AvailInfo

  AvailTC T [T, MkT] [FieldLabel &quot;foo&quot; False foo]

whereas if -XDuplicateRecordFields is enabled it gives

  AvailTC T [T, MkT] [FieldLabel &quot;foo&quot; True $sel:foo:MkT]

since the label does not match the selector name.

The labels in a field list are not necessarily unique:
data families allow the same parent (the family tycon) to have
multiple distinct fields with the same label. For example,

  data family F a
  data instance F Int  = MkFInt { foo :: Int }
  data instance F Bool = MkFBool { foo :: Bool}

gives rise to

  AvailTC F [ F, MkFInt, MkFBool ]
            [ FieldLabel &quot;foo&quot; True $sel:foo:MkFInt
            , FieldLabel &quot;foo&quot; True $sel:foo:MkFBool ]

Moreover, note that the flIsOverloaded flag need not be the same for
all the elements of the list.  In the example above, this occurs if
the two data instances are defined in different modules, one with
`-XDuplicateRecordFields` enabled and one with it disabled.  Thus it
is possible to have

  AvailTC F [ F, MkFInt, MkFBool ]
            [ FieldLabel &quot;foo&quot; True $sel:foo:MkFInt
            , FieldLabel &quot;foo&quot; False foo ]

If the two data instances are defined in different modules, both
without `-XDuplicateRecordFields`, it will be impossible to export
them from the same module (even with `-XDuplicateRecordfields`
enabled), because they would be represented identically.  The
workaround here is to enable `-XDuplicateRecordFields` on the defining
modules.
-}</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-comment">-- | Compare lexicographically</span><span>
</span><a name="line-126"></a><span class="hs-identifier">stableAvailCmp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-127"></a><a name="stableAvailCmp"><a href="Avail.html#stableAvailCmp"><span class="hs-identifier">stableAvailCmp</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300109"><a href="#local-6989586621681300109"><span class="hs-identifier">n1</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300110"><a href="#local-6989586621681300110"><span class="hs-identifier">n2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681300109"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-special">`</span><a href="Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681300110"><span class="hs-identifier hs-var">n2</span></a><span>
</span><a name="line-128"></a><span class="hs-identifier">stableAvailCmp</span><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-129"></a><span class="hs-identifier">stableAvailCmp</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300111"><a href="#local-6989586621681300111"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681300112"><a href="#local-6989586621681300112"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621681300113"><a href="#local-6989586621681300113"><span class="hs-identifier">nfs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300114"><a href="#local-6989586621681300114"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621681300115"><a href="#local-6989586621681300115"><span class="hs-identifier">ms</span></a></a><span> </span><a name="local-6989586621681300116"><a href="#local-6989586621681300116"><span class="hs-identifier">mfs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-130"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621681300111"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><a href="Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681300114"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span>
</span><a name="line-131"></a><span>    </span><span class="hs-special">(</span><a href="Util.html#cmpList"><span class="hs-identifier hs-var">cmpList</span></a><span> </span><a href="Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a><span> </span><a href="#local-6989586621681300112"><span class="hs-identifier hs-var">ns</span></a><span> </span><a href="#local-6989586621681300115"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span>
</span><a name="line-132"></a><span>    </span><span class="hs-special">(</span><a href="Util.html#cmpList"><span class="hs-identifier hs-var">cmpList</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">flSelector</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681300113"><span class="hs-identifier hs-var">nfs</span></a><span> </span><a href="#local-6989586621681300116"><span class="hs-identifier hs-var">mfs</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span class="hs-identifier">stableAvailCmp</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-identifier">avail</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span>
</span><a name="line-136"></a><a name="avail"><a href="Avail.html#avail"><span class="hs-identifier">avail</span></a></a><span> </span><a name="local-6989586621681300117"><a href="#local-6989586621681300117"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a href="#local-6989586621681300117"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- Operations on AvailInfo</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-identifier">availsToNameSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-142"></a><a name="availsToNameSet"><a href="Avail.html#availsToNameSet"><span class="hs-identifier">availsToNameSet</span></a></a><span> </span><a name="local-6989586621681300118"><a href="#local-6989586621681300118"><span class="hs-identifier">avails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621681300119"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span> </span><a href="#local-6989586621681300118"><span class="hs-identifier hs-var">avails</span></a><span>
</span><a name="line-143"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681300119"><a href="#local-6989586621681300119"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621681300120"><a href="#local-6989586621681300120"><span class="hs-identifier">avail</span></a></a><span> </span><a name="local-6989586621681300121"><a href="#local-6989586621681300121"><span class="hs-identifier">set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#extendNameSetList"><span class="hs-identifier hs-var">extendNameSetList</span></a><span> </span><a href="#local-6989586621681300121"><span class="hs-identifier hs-var">set</span></a><span> </span><span class="hs-special">(</span><a href="Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a><span> </span><a href="#local-6989586621681300120"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-identifier">availsToNameSetWithSelectors</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-146"></a><a name="availsToNameSetWithSelectors"><a href="Avail.html#availsToNameSetWithSelectors"><span class="hs-identifier">availsToNameSetWithSelectors</span></a></a><span> </span><a name="local-6989586621681300122"><a href="#local-6989586621681300122"><span class="hs-identifier">avails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621681300123"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span> </span><a href="#local-6989586621681300122"><span class="hs-identifier hs-var">avails</span></a><span>
</span><a name="line-147"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681300123"><a href="#local-6989586621681300123"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621681300124"><a href="#local-6989586621681300124"><span class="hs-identifier">avail</span></a></a><span> </span><a name="local-6989586621681300125"><a href="#local-6989586621681300125"><span class="hs-identifier">set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#extendNameSetList"><span class="hs-identifier hs-var">extendNameSetList</span></a><span> </span><a href="#local-6989586621681300125"><span class="hs-identifier hs-var">set</span></a><span> </span><span class="hs-special">(</span><a href="Avail.html#availNamesWithSelectors"><span class="hs-identifier hs-var">availNamesWithSelectors</span></a><span> </span><a href="#local-6989586621681300124"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-identifier">availsToNameEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span>
</span><a name="line-150"></a><a name="availsToNameEnv"><a href="Avail.html#availsToNameEnv"><span class="hs-identifier">availsToNameEnv</span></a></a><span> </span><a name="local-6989586621681300126"><a href="#local-6989586621681300126"><span class="hs-identifier">avails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621681300127"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span> </span><a href="#local-6989586621681300126"><span class="hs-identifier hs-var">avails</span></a><span>
</span><a name="line-151"></a><span>     </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681300127"><a href="#local-6989586621681300127"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621681300128"><a href="#local-6989586621681300128"><span class="hs-identifier">avail</span></a></a><span> </span><a name="local-6989586621681300129"><a href="#local-6989586621681300129"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#extendNameEnvList"><span class="hs-identifier hs-var">extendNameEnvList</span></a><span> </span><a href="#local-6989586621681300129"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-152"></a><span>                                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><a href="Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a><span> </span><a href="#local-6989586621681300128"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">repeat</span><span> </span><a href="#local-6989586621681300128"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- | Just the main name made available, i.e. not the available pieces</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- of type or class brought into scope by the 'GenAvailInfo'</span><span>
</span><a name="line-156"></a><span class="hs-identifier">availName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-157"></a><a name="availName"><a href="Avail.html#availName"><span class="hs-identifier">availName</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300130"><a href="#local-6989586621681300130"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681300130"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-158"></a><span class="hs-identifier">availName</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300131"><a href="#local-6989586621681300131"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681300131"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-comment">-- | All names made available by the availability information (excluding overloaded selectors)</span><span>
</span><a name="line-161"></a><span class="hs-identifier">availNames</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-162"></a><a name="availNames"><a href="Avail.html#availNames"><span class="hs-identifier">availNames</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300132"><a href="#local-6989586621681300132"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681300132"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-163"></a><span class="hs-identifier">availNames</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681300133"><a href="#local-6989586621681300133"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621681300134"><a href="#local-6989586621681300134"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681300133"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier">flSelector</span><span> </span><a href="#local-6989586621681300135"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681300135"><a href="#local-6989586621681300135"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681300134"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">flIsOverloaded</span><span> </span><a href="#local-6989586621681300135"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-comment">-- | All names made available by the availability information (including overloaded selectors)</span><span>
</span><a name="line-166"></a><span class="hs-identifier">availNamesWithSelectors</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-167"></a><a name="availNamesWithSelectors"><a href="Avail.html#availNamesWithSelectors"><span class="hs-identifier">availNamesWithSelectors</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300136"><a href="#local-6989586621681300136"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681300136"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-168"></a><span class="hs-identifier">availNamesWithSelectors</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681300137"><a href="#local-6989586621681300137"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621681300138"><a href="#local-6989586621681300138"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681300137"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">flSelector</span><span> </span><a href="#local-6989586621681300138"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">-- | Names for non-fields made available by the availability information</span><span>
</span><a name="line-171"></a><span class="hs-identifier">availNonFldNames</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-172"></a><a name="availNonFldNames"><a href="Avail.html#availNonFldNames"><span class="hs-identifier">availNonFldNames</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300139"><a href="#local-6989586621681300139"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681300139"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-173"></a><span class="hs-identifier">availNonFldNames</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681300140"><a href="#local-6989586621681300140"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681300140"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span class="hs-comment">-- | Fields made available by the availability information</span><span>
</span><a name="line-176"></a><span class="hs-identifier">availFlds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span>
</span><a name="line-177"></a><a name="availFlds"><a href="Avail.html#availFlds"><span class="hs-identifier">availFlds</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681300141"><a href="#local-6989586621681300141"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681300141"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-178"></a><span class="hs-identifier">availFlds</span><span> </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-identifier">availsNamesWithOccs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-181"></a><a name="availsNamesWithOccs"><a href="Avail.html#availsNamesWithOccs"><span class="hs-identifier">availsNamesWithOccs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="Avail.html#availNamesWithOccs"><span class="hs-identifier hs-var">availNamesWithOccs</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-comment">-- | 'Name's made available by the availability information, paired with</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- the 'OccName' used to refer to each one.</span><span>
</span><a name="line-185"></a><span class="hs-comment">--</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- When @DuplicateRecordFields@ is in use, the 'Name' may be the</span><span>
</span><a name="line-187"></a><span class="hs-comment">-- mangled name of a record selector (e.g. @$sel:foo:MkT@) while the</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- 'OccName' will be the label of the field (e.g. @foo@).</span><span>
</span><a name="line-189"></a><span class="hs-comment">--</span><span>
</span><a name="line-190"></a><span class="hs-comment">-- See Note [Representing fields in AvailInfo].</span><span>
</span><a name="line-191"></a><span class="hs-identifier">availNamesWithOccs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-192"></a><a name="availNamesWithOccs"><a href="Avail.html#availNamesWithOccs"><span class="hs-identifier">availNamesWithOccs</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300142"><a href="#local-6989586621681300142"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621681300142"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681300142"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-193"></a><span class="hs-identifier">availNamesWithOccs</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681300143"><a href="#local-6989586621681300143"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621681300144"><a href="#local-6989586621681300144"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300145"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681300145"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681300145"><a href="#local-6989586621681300145"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681300143"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-195"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">flSelector</span><span> </span><a href="#local-6989586621681300146"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">,</span><span> </span><a href="OccName.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">flLabel</span><span> </span><a href="#local-6989586621681300146"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681300146"><a href="#local-6989586621681300146"><span class="hs-identifier">fl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681300144"><span class="hs-identifier hs-var">fs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-198"></a><span class="hs-comment">-- Utility</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-identifier">plusAvail</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span>
</span><a name="line-201"></a><a name="plusAvail"><a href="Avail.html#plusAvail"><span class="hs-identifier">plusAvail</span></a></a><span> </span><a name="local-6989586621681300147"><a href="#local-6989586621681300147"><span class="hs-identifier">a1</span></a></a><span> </span><a name="local-6989586621681300148"><a href="#local-6989586621681300148"><span class="hs-identifier">a2</span></a></a><span>
</span><a name="line-202"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Avail.html#availName"><span class="hs-identifier hs-var">availName</span></a><span> </span><a href="#local-6989586621681300147"><span class="hs-identifier hs-var">a1</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="Avail.html#availName"><span class="hs-identifier hs-var">availName</span></a><span> </span><a href="#local-6989586621681300148"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-203"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;RnEnv.plusAvail names differ&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681300147"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">,</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681300148"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span class="hs-identifier">plusAvail</span><span> </span><a name="local-6989586621681300149"><a href="#local-6989586621681300149"><span class="hs-identifier">a1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681300149"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-205"></a><span class="hs-identifier">plusAvail</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>     </span><a name="local-6989586621681300150"><a href="#local-6989586621681300150"><span class="hs-identifier">a2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681300150"><span class="hs-identifier hs-var">a2</span></a><span>
</span><a name="line-206"></a><span class="hs-identifier">plusAvail</span><span> </span><a name="local-6989586621681300151"><a href="#local-6989586621681300151"><span class="hs-identifier">a1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681300151"><span class="hs-identifier hs-var">a1</span></a><span>
</span><a name="line-207"></a><span class="hs-identifier">plusAvail</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300152"><a href="#local-6989586621681300152"><span class="hs-identifier">n1</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681300153"><a href="#local-6989586621681300153"><span class="hs-identifier">s1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681300154"><a href="#local-6989586621681300154"><span class="hs-identifier">ss1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681300155"><a href="#local-6989586621681300155"><span class="hs-identifier">fs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300156"><a href="#local-6989586621681300156"><span class="hs-identifier">n2</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681300157"><a href="#local-6989586621681300157"><span class="hs-identifier">s2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681300158"><a href="#local-6989586621681300158"><span class="hs-identifier">ss2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681300159"><a href="#local-6989586621681300159"><span class="hs-identifier">fs2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300152"><span class="hs-identifier hs-var">n1</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681300153"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681300156"><span class="hs-identifier hs-var">n2</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681300157"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- Maintain invariant the parent is first</span><span>
</span><a name="line-209"></a><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681300152"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300153"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300154"><span class="hs-identifier hs-var">ss1</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681300158"><span class="hs-identifier hs-var">ss2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>                                   </span><span class="hs-special">(</span><a href="#local-6989586621681300155"><span class="hs-identifier hs-var">fs1</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681300159"><span class="hs-identifier hs-var">fs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681300152"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300153"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300154"><span class="hs-identifier hs-var">ss1</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300157"><span class="hs-identifier hs-var">s2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681300158"><span class="hs-identifier hs-var">ss2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>                                   </span><span class="hs-special">(</span><a href="#local-6989586621681300155"><span class="hs-identifier hs-var">fs1</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681300159"><span class="hs-identifier hs-var">fs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681300152"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300157"><span class="hs-identifier hs-var">s2</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621681300153"><span class="hs-identifier hs-var">s1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681300154"><span class="hs-identifier hs-var">ss1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681300158"><span class="hs-identifier hs-var">ss2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>                                   </span><span class="hs-special">(</span><a href="#local-6989586621681300155"><span class="hs-identifier hs-var">fs1</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681300159"><span class="hs-identifier hs-var">fs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-215"></a><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681300152"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621681300153"><span class="hs-identifier hs-var">s1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681300154"><span class="hs-identifier hs-var">ss1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300157"><span class="hs-identifier hs-var">s2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681300158"><span class="hs-identifier hs-var">ss2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>                                   </span><span class="hs-special">(</span><a href="#local-6989586621681300155"><span class="hs-identifier hs-var">fs1</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681300159"><span class="hs-identifier hs-var">fs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span class="hs-identifier">plusAvail</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300160"><a href="#local-6989586621681300160"><span class="hs-identifier">n1</span></a></a><span> </span><a name="local-6989586621681300161"><a href="#local-6989586621681300161"><span class="hs-identifier">ss1</span></a></a><span> </span><a name="local-6989586621681300162"><a href="#local-6989586621681300162"><span class="hs-identifier">fs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621681300163"><a href="#local-6989586621681300163"><span class="hs-identifier">fs2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681300160"><span class="hs-identifier hs-var">n1</span></a><span> </span><a href="#local-6989586621681300161"><span class="hs-identifier hs-var">ss1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300162"><span class="hs-identifier hs-var">fs1</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681300163"><span class="hs-identifier hs-var">fs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span class="hs-identifier">plusAvail</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300164"><a href="#local-6989586621681300164"><span class="hs-identifier">n1</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621681300165"><a href="#local-6989586621681300165"><span class="hs-identifier">fs1</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681300166"><a href="#local-6989586621681300166"><span class="hs-identifier">ss2</span></a></a><span> </span><a name="local-6989586621681300167"><a href="#local-6989586621681300167"><span class="hs-identifier">fs2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-220"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681300164"><span class="hs-identifier hs-var">n1</span></a><span> </span><a href="#local-6989586621681300166"><span class="hs-identifier hs-var">ss2</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300165"><span class="hs-identifier hs-var">fs1</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681300167"><span class="hs-identifier hs-var">fs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span class="hs-identifier">plusAvail</span><span> </span><a name="local-6989586621681300168"><a href="#local-6989586621681300168"><span class="hs-identifier">a1</span></a></a><span> </span><a name="local-6989586621681300169"><a href="#local-6989586621681300169"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;RnEnv.plusAvail&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681300168"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">,</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681300169"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-comment">-- | trims an 'AvailInfo' to keep only a single name</span><span>
</span><a name="line-224"></a><span class="hs-identifier">trimAvail</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span>
</span><a name="line-225"></a><a name="trimAvail"><a href="Avail.html#trimAvail"><span class="hs-identifier">trimAvail</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300170"><a href="#local-6989586621681300170"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a href="#local-6989586621681300170"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-226"></a><span class="hs-identifier">trimAvail</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300171"><a href="#local-6989586621681300171"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681300172"><a href="#local-6989586621681300172"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621681300173"><a href="#local-6989586621681300173"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681300174"><a href="#local-6989586621681300174"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">find</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621681300174"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">flSelector</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681300173"><span class="hs-identifier hs-var">fs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-227"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681300175"><a href="#local-6989586621681300175"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681300171"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681300175"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-228"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">ns</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">AvailTC</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">m</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-comment">-- | filters 'AvailInfo's by the given predicate</span><span>
</span><a name="line-231"></a><span class="hs-identifier">filterAvails</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-232"></a><a name="filterAvails"><a href="Avail.html#filterAvails"><span class="hs-identifier">filterAvails</span></a></a><span> </span><a name="local-6989586621681300176"><a href="#local-6989586621681300176"><span class="hs-identifier">keep</span></a></a><span> </span><a name="local-6989586621681300177"><a href="#local-6989586621681300177"><span class="hs-identifier">avails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><a href="Avail.html#filterAvail"><span class="hs-identifier hs-var">filterAvail</span></a><span> </span><a href="#local-6989586621681300176"><span class="hs-identifier hs-var">keep</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621681300177"><span class="hs-identifier hs-var">avails</span></a><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-comment">-- | filters an 'AvailInfo' by the given predicate</span><span>
</span><a name="line-235"></a><span class="hs-identifier">filterAvail</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-236"></a><a name="filterAvail"><a href="Avail.html#filterAvail"><span class="hs-identifier">filterAvail</span></a></a><span> </span><a name="local-6989586621681300178"><a href="#local-6989586621681300178"><span class="hs-identifier">keep</span></a></a><span> </span><a name="local-6989586621681300179"><a href="#local-6989586621681300179"><span class="hs-identifier">ie</span></a></a><span> </span><a name="local-6989586621681300180"><a href="#local-6989586621681300180"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-237"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681300179"><span class="hs-identifier hs-var">ie</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-238"></a><span>    </span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300181"><a href="#local-6989586621681300181"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681300178"><span class="hs-identifier hs-var">keep</span></a><span> </span><a href="#local-6989586621681300181"><span class="hs-identifier hs-var">n</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681300179"><span class="hs-identifier hs-var">ie</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681300180"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-239"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681300180"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-240"></a><span>    </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300182"><a href="#local-6989586621681300182"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681300183"><a href="#local-6989586621681300183"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621681300184"><a href="#local-6989586621681300184"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-241"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681300185"><a href="#local-6989586621681300185"><span class="hs-identifier">ns'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621681300178"><span class="hs-identifier hs-var">keep</span></a><span> </span><a href="#local-6989586621681300183"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-242"></a><span>            </span><a name="local-6989586621681300186"><a href="#local-6989586621681300186"><span class="hs-identifier">fs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681300178"><span class="hs-identifier hs-var">keep</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">flSelector</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681300184"><span class="hs-identifier hs-var">fs</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-243"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621681300185"><span class="hs-identifier hs-var">ns'</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621681300186"><span class="hs-identifier hs-var">fs'</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681300180"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681300182"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681300185"><span class="hs-identifier hs-var">ns'</span></a><span> </span><a href="#local-6989586621681300186"><span class="hs-identifier hs-var">fs'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681300180"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span class="hs-comment">-- | Combines 'AvailInfo's from the same family</span><span>
</span><a name="line-247"></a><span class="hs-comment">-- 'avails' may have several items with the same availName</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- E.g  import Ix( Ix(..), index )</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- will give Ix(Ix,index,range) and Ix(index)</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- We want to combine these; addAvail does that</span><span>
</span><a name="line-251"></a><span class="hs-identifier">nubAvails</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-252"></a><a name="nubAvails"><a href="Avail.html#nubAvails"><span class="hs-identifier">nubAvails</span></a></a><span> </span><a name="local-6989586621681300187"><a href="#local-6989586621681300187"><span class="hs-identifier">avails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#nameEnvElts"><span class="hs-identifier hs-var">nameEnvElts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621681300188"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span> </span><a href="#local-6989586621681300187"><span class="hs-identifier hs-var">avails</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-254"></a><span>    </span><a name="local-6989586621681300188"><a href="#local-6989586621681300188"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621681300189"><a href="#local-6989586621681300189"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681300190"><a href="#local-6989586621681300190"><span class="hs-identifier">avail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#extendNameEnv_C"><span class="hs-identifier hs-var">extendNameEnv_C</span></a><span> </span><a href="Avail.html#plusAvail"><span class="hs-identifier hs-var">plusAvail</span></a><span> </span><a href="#local-6989586621681300189"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><a href="Avail.html#availName"><span class="hs-identifier hs-var">availName</span></a><span> </span><a href="#local-6989586621681300190"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681300190"><span class="hs-identifier hs-var">avail</span></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-257"></a><span class="hs-comment">-- Printing</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-260"></a><span>   </span><a name="local-8214565720324908102"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#pprAvail"><span class="hs-identifier hs-var">pprAvail</span></a><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span class="hs-identifier">pprAvail</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-263"></a><a name="pprAvail"><a href="Avail.html#pprAvail"><span class="hs-identifier">pprAvail</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300191"><a href="#local-6989586621681300191"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-264"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681300191"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-265"></a><span class="hs-identifier">pprAvail</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300192"><a href="#local-6989586621681300192"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681300193"><a href="#local-6989586621681300193"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621681300194"><a href="#local-6989586621681300194"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-266"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681300192"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681300193"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#semi"><span class="hs-identifier hs-var">semi</span></a><span>
</span><a name="line-267"></a><span>                         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#fsep"><span class="hs-identifier hs-var">fsep</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">flLabel</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681300194"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-270"></a><span>    </span><a name="local-8214565720325097422"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621681300097"><a href="#local-6989586621681300097"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681300098"><a href="#local-6989586621681300098"><span class="hs-identifier">aa</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-271"></a><span>            </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621681300097"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-272"></a><span>            </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621681300097"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621681300098"><span class="hs-identifier hs-var">aa</span></a><span>
</span><a name="line-273"></a><span>    </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621681300099"><a href="#local-6989586621681300099"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681300100"><a href="#local-6989586621681300100"><span class="hs-identifier">ab</span></a></a><span> </span><a name="local-6989586621681300101"><a href="#local-6989586621681300101"><span class="hs-identifier">ac</span></a></a><span> </span><a name="local-6989586621681300102"><a href="#local-6989586621681300102"><span class="hs-identifier">ad</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-274"></a><span>            </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621681300099"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-275"></a><span>            </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621681300099"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621681300100"><span class="hs-identifier hs-var">ab</span></a><span>
</span><a name="line-276"></a><span>            </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621681300099"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621681300101"><span class="hs-identifier hs-var">ac</span></a><span>
</span><a name="line-277"></a><span>            </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621681300099"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621681300102"><span class="hs-identifier hs-var">ad</span></a><span>
</span><a name="line-278"></a><span>    </span><a name="local-8214565720325097424"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621681300103"><a href="#local-6989586621681300103"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-279"></a><span>            </span><a name="local-6989586621681300104"><a href="#local-6989586621681300104"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a><span> </span><a href="#local-6989586621681300103"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-280"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681300104"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-281"></a><span>              </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681300105"><a href="#local-6989586621681300105"><span class="hs-identifier">aa</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621681300103"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-282"></a><span>                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a href="#local-6989586621681300105"><span class="hs-identifier hs-var">aa</span></a><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681300106"><a href="#local-6989586621681300106"><span class="hs-identifier">ab</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621681300103"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-284"></a><span>                      </span><a name="local-6989586621681300107"><a href="#local-6989586621681300107"><span class="hs-identifier">ac</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621681300103"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-285"></a><span>                      </span><a name="local-6989586621681300108"><a href="#local-6989586621681300108"><span class="hs-identifier">ad</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621681300103"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-286"></a><span>                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681300106"><span class="hs-identifier hs-var">ab</span></a><span> </span><a href="#local-6989586621681300107"><span class="hs-identifier hs-var">ac</span></a><span> </span><a href="#local-6989586621681300108"><span class="hs-identifier hs-var">ad</span></a><span class="hs-special">)</span><span>
</span><a name="line-287"></a></pre></body></html>