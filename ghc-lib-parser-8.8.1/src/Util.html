<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- (c) The University of Glasgow 2006</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-comment">-- | Highly random utility functions</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Util</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-12"></a><span>        </span><span class="hs-comment">-- * Flags dependent on the compiler build</span><span>
</span><a name="line-13"></a><span>        </span><a href="Util.html#ghciSupported"><span class="hs-identifier hs-var">ghciSupported</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#ncgDebugIsOn"><span class="hs-identifier hs-var">ncgDebugIsOn</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="Util.html#ghciTablesNextToCode"><span class="hs-identifier hs-var">ghciTablesNextToCode</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="Util.html#isWindowsHost"><span class="hs-identifier hs-var">isWindowsHost</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#isDarwinHost"><span class="hs-identifier hs-var">isDarwinHost</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>        </span><span class="hs-comment">-- * General list processing</span><span>
</span><a name="line-18"></a><span>        </span><a href="Util.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#zipWithEqual"><span class="hs-identifier hs-var">zipWithEqual</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#zipWith3Equal"><span class="hs-identifier hs-var">zipWith3Equal</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#zipWith4Equal"><span class="hs-identifier hs-var">zipWith4Equal</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="Util.html#zipLazy"><span class="hs-identifier hs-var">zipLazy</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#stretchZipWith"><span class="hs-identifier hs-var">stretchZipWith</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#zipWithAndUnzip"><span class="hs-identifier hs-var">zipWithAndUnzip</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#zipAndUnzip"><span class="hs-identifier hs-var">zipAndUnzip</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>        </span><a href="Util.html#zipWithLazy"><span class="hs-identifier hs-var">zipWithLazy</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#zipWith3Lazy"><span class="hs-identifier hs-var">zipWith3Lazy</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span>        </span><a href="Util.html#filterByList"><span class="hs-identifier hs-var">filterByList</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#filterByLists"><span class="hs-identifier hs-var">filterByLists</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#partitionByList"><span class="hs-identifier hs-var">partitionByList</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>        </span><a href="Util.html#unzipWith"><span class="hs-identifier hs-var">unzipWith</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>        </span><a href="Util.html#mapFst"><span class="hs-identifier hs-var">mapFst</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#chkAppend"><span class="hs-identifier hs-var">chkAppend</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="Util.html#mapAndUnzip"><span class="hs-identifier hs-var">mapAndUnzip</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#mapAndUnzip3"><span class="hs-identifier hs-var">mapAndUnzip3</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#mapAccumL2"><span class="hs-identifier hs-var">mapAccumL2</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="Util.html#nOfThem"><span class="hs-identifier hs-var">nOfThem</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>        </span><a href="Util.html#dropWhileEndLE"><span class="hs-identifier hs-var">dropWhileEndLE</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#spanEnd"><span class="hs-identifier hs-var">spanEnd</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#last2"><span class="hs-identifier hs-var">last2</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>        </span><span class="hs-identifier hs-var">foldl1'</span><span class="hs-special">,</span><span> </span><a href="Util.html#foldl2"><span class="hs-identifier hs-var">foldl2</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#count"><span class="hs-identifier hs-var">count</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#countWhile"><span class="hs-identifier hs-var">countWhile</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#all2"><span class="hs-identifier hs-var">all2</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>        </span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">lengthExceeds</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#lengthIs"><span class="hs-identifier hs-var">lengthIs</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#lengthIsNot"><span class="hs-identifier hs-var">lengthIsNot</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="Util.html#lengthAtLeast"><span class="hs-identifier hs-var">lengthAtLeast</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#lengthAtMost"><span class="hs-identifier hs-var">lengthAtMost</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#lengthLessThan"><span class="hs-identifier hs-var">lengthLessThan</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="Util.html#listLengthCmp"><span class="hs-identifier hs-var">listLengthCmp</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#atLength"><span class="hs-identifier hs-var">atLength</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#compareLength"><span class="hs-identifier hs-var">compareLength</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#leLength"><span class="hs-identifier hs-var">leLength</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#ltLength"><span class="hs-identifier hs-var">ltLength</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>        </span><a href="Util.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#only"><span class="hs-identifier hs-var">only</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#singleton"><span class="hs-identifier hs-var">singleton</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#snocView"><span class="hs-identifier hs-var">snocView</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>        </span><a href="Util.html#isIn"><span class="hs-identifier hs-var">isIn</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#isn%27tIn"><span class="hs-identifier hs-var">isn'tIn</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>        </span><a href="Util.html#chunkList"><span class="hs-identifier hs-var">chunkList</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span>        </span><a href="Util.html#changeLast"><span class="hs-identifier hs-var">changeLast</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span>        </span><span class="hs-comment">-- * Tuples</span><span>
</span><a name="line-50"></a><span>        </span><a href="Util.html#fstOf3"><span class="hs-identifier hs-var">fstOf3</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#sndOf3"><span class="hs-identifier hs-var">sndOf3</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#thdOf3"><span class="hs-identifier hs-var">thdOf3</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>        </span><a href="Util.html#firstM"><span class="hs-identifier hs-var">firstM</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#first3M"><span class="hs-identifier hs-var">first3M</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#secondM"><span class="hs-identifier hs-var">secondM</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="Util.html#fst3"><span class="hs-identifier hs-var">fst3</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#snd3"><span class="hs-identifier hs-var">snd3</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#third3"><span class="hs-identifier hs-var">third3</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="Util.html#uncurry3"><span class="hs-identifier hs-var">uncurry3</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>        </span><a href="Util.html#liftFst"><span class="hs-identifier hs-var">liftFst</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#liftSnd"><span class="hs-identifier hs-var">liftSnd</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span>        </span><span class="hs-comment">-- * List operations controlled by another list</span><span>
</span><a name="line-57"></a><span>        </span><a href="Util.html#takeList"><span class="hs-identifier hs-var">takeList</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#dropList"><span class="hs-identifier hs-var">dropList</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#split"><span class="hs-identifier hs-var">split</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>        </span><a href="Util.html#dropTail"><span class="hs-identifier hs-var">dropTail</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#capitalise"><span class="hs-identifier hs-var">capitalise</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>        </span><span class="hs-comment">-- * For loop</span><span>
</span><a name="line-61"></a><span>        </span><a href="Util.html#nTimes"><span class="hs-identifier hs-var">nTimes</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span>        </span><span class="hs-comment">-- * Sorting</span><span>
</span><a name="line-64"></a><span>        </span><span class="hs-identifier hs-var">sortWith</span><span class="hs-special">,</span><span> </span><a href="Util.html#minWith"><span class="hs-identifier hs-var">minWith</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#nubSort"><span class="hs-identifier hs-var">nubSort</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#ordNub"><span class="hs-identifier hs-var">ordNub</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span>        </span><span class="hs-comment">-- * Comparisons</span><span>
</span><a name="line-67"></a><span>        </span><a href="Util.html#isEqual"><span class="hs-identifier hs-var">isEqual</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#eqListBy"><span class="hs-identifier hs-var">eqListBy</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#eqMaybeBy"><span class="hs-identifier hs-var">eqMaybeBy</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>        </span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#cmpList"><span class="hs-identifier hs-var">cmpList</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>        </span><a href="Util.html#removeSpaces"><span class="hs-identifier hs-var">removeSpaces</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>        </span><span class="hs-special">(</span><a href="Util.html#%3C%26%26%3E"><span class="hs-operator hs-var">&lt;&amp;&amp;&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Util.html#%3C%7C%7C%3E"><span class="hs-operator hs-var">&lt;||&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span>        </span><span class="hs-comment">-- * Edit distance</span><span>
</span><a name="line-73"></a><span>        </span><a href="Util.html#fuzzyMatch"><span class="hs-identifier hs-var">fuzzyMatch</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#fuzzyLookup"><span class="hs-identifier hs-var">fuzzyLookup</span></a><span class="hs-special">,</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span>        </span><span class="hs-comment">-- * Transitive closures</span><span>
</span><a name="line-76"></a><span>        </span><a href="Util.html#transitiveClosure"><span class="hs-identifier hs-var">transitiveClosure</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span>        </span><span class="hs-comment">-- * Strictness</span><span>
</span><a name="line-79"></a><span>        </span><a href="Util.html#seqList"><span class="hs-identifier hs-var">seqList</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span>        </span><span class="hs-comment">-- * Module names</span><span>
</span><a name="line-82"></a><span>        </span><a href="Util.html#looksLikeModuleName"><span class="hs-identifier hs-var">looksLikeModuleName</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>        </span><a href="Util.html#looksLikePackageName"><span class="hs-identifier hs-var">looksLikePackageName</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span>        </span><span class="hs-comment">-- * Argument processing</span><span>
</span><a name="line-86"></a><span>        </span><a href="Util.html#getCmd"><span class="hs-identifier hs-var">getCmd</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#toCmdArgs"><span class="hs-identifier hs-var">toCmdArgs</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#toArgs"><span class="hs-identifier hs-var">toArgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>        </span><span class="hs-comment">-- * Integers</span><span>
</span><a name="line-89"></a><span>        </span><a href="Util.html#exactLog2"><span class="hs-identifier hs-var">exactLog2</span></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>        </span><span class="hs-comment">-- * Floating point</span><span>
</span><a name="line-92"></a><span>        </span><a href="Util.html#readRational"><span class="hs-identifier hs-var">readRational</span></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>        </span><a href="Util.html#readHexRational"><span class="hs-identifier hs-var">readHexRational</span></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span>        </span><span class="hs-comment">-- * read helpers</span><span>
</span><a name="line-96"></a><span>        </span><a href="Util.html#maybeRead"><span class="hs-identifier hs-var">maybeRead</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#maybeReadFuzzy"><span class="hs-identifier hs-var">maybeReadFuzzy</span></a><span class="hs-special">,</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span>        </span><span class="hs-comment">-- * IO-ish utilities</span><span>
</span><a name="line-99"></a><span>        </span><a href="Util.html#doesDirNameExist"><span class="hs-identifier hs-var">doesDirNameExist</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>        </span><a href="Util.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>        </span><a href="Util.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span>        </span><a href="Util.html#global"><span class="hs-identifier hs-var">global</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#consIORef"><span class="hs-identifier hs-var">consIORef</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#globalM"><span class="hs-identifier hs-var">globalM</span></a><span class="hs-special">,</span><span>
</span><a name="line-104"></a><span>        </span><a href="Util.html#sharedGlobal"><span class="hs-identifier hs-var">sharedGlobal</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#sharedGlobalM"><span class="hs-identifier hs-var">sharedGlobalM</span></a><span class="hs-special">,</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span>        </span><span class="hs-comment">-- * Filenames and paths</span><span>
</span><a name="line-107"></a><span>        </span><a href="Util.html#Suffix"><span class="hs-identifier hs-type">Suffix</span></a><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span>        </span><a href="Util.html#splitLongestPrefix"><span class="hs-identifier hs-var">splitLongestPrefix</span></a><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>        </span><a href="Util.html#escapeSpaces"><span class="hs-identifier hs-var">escapeSpaces</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>        </span><a href="Util.html#Direction"><span class="hs-identifier hs-type">Direction</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Util.html#reslash"><span class="hs-identifier hs-var">reslash</span></a><span class="hs-special">,</span><span>
</span><a name="line-111"></a><span>        </span><a href="Util.html#makeRelativeTo"><span class="hs-identifier hs-var">makeRelativeTo</span></a><span class="hs-special">,</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span>        </span><span class="hs-comment">-- * Utils for defining Data instances</span><span>
</span><a name="line-114"></a><span>        </span><a href="Util.html#abstractConstr"><span class="hs-identifier hs-var">abstractConstr</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#abstractDataType"><span class="hs-identifier hs-var">abstractDataType</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkNoRepType</span><span class="hs-special">,</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span>        </span><span class="hs-comment">-- * Utils for printing C code</span><span>
</span><a name="line-117"></a><span>        </span><a href="Util.html#charToC"><span class="hs-identifier hs-var">charToC</span></a><span class="hs-special">,</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span>        </span><span class="hs-comment">-- * Hashing</span><span>
</span><a name="line-120"></a><span>        </span><a href="Util.html#hashString"><span class="hs-identifier hs-var">hashString</span></a><span class="hs-special">,</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>        </span><span class="hs-comment">-- * Call stacks</span><span>
</span><a name="line-123"></a><span>        </span><span class="hs-identifier hs-type">HasCallStack</span><span class="hs-special">,</span><span>
</span><a name="line-124"></a><span>        </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span class="hs-special">,</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span>        </span><span class="hs-comment">-- * Utils for flags</span><span>
</span><a name="line-127"></a><span>        </span><a href="Util.html#OverridingBool"><span class="hs-identifier hs-type">OverridingBool</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-128"></a><span>        </span><a href="Util.html#overrideWith"><span class="hs-identifier hs-var">overrideWith</span></a><span class="hs-special">,</span><span>
</span><a name="line-129"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-133"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-keyword">import</span><span> </span><a href="Exception.html"><span class="hs-identifier">Exception</span></a><span>
</span><a name="line-136"></a><span class="hs-keyword">import</span><span> </span><a href="PlainPanic.html"><span class="hs-identifier">PlainPanic</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Data</span><span>
</span><a name="line-139"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.IORef</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">IORef</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">atomicModifyIORef'</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO.Unsafe</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">unsafePerformIO</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-141"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>        </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">group</span><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Exts</span><span>
</span><a name="line-144"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Stack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HasCallStack</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Conc.Sync</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">sharedCAF</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-149"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO.Error</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">isDoesNotExistError</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Directory</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">doesDirectoryExist</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">getModificationTime</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.FilePath</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">isUpper</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isAlphaNum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">chr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isDigit</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toUpper</span><span>
</span><a name="line-154"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isHexDigit</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">digitToInt</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-155"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Int</span><span>
</span><a name="line-156"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Ratio</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">%</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Ord</span><span>         </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">comparing</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-159"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-160"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.IntMap</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IM</span><span>
</span><a name="line-161"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Time</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-cpp">#if defined(DEBUG)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-identifier">Outputable</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">warnPprTrace</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-169"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">9</span><span> </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Is DEBUG on, are we on Windows, etc?}
*                                                                      *
************************************************************************

These booleans are global constants, set by CPP flags.  They allow us to
recompile a single module (this one) to change whether or not debug output
appears. They sometimes let us avoid even running CPP elsewhere.

It's important that the flags are literal constants (True/False). Then,
with -0, tests of the flags in other modules will simplify to the correct
branch of the conditional, thereby dropping debug code altogether when
the flags are off.
-}</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-identifier">ghciSupported</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-189"></a><span class="hs-cpp">#if defined(GHCI)
</span><a name="ghciSupported"><a href="Util.html#ghciSupported"><span class="hs-identifier">ghciSupported</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-191"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">ghciSupported</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-193"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-195"></a><span class="hs-identifier">debugIsOn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-196"></a><span class="hs-cpp">#if defined(DEBUG)
</span><span class="hs-identifier">debugIsOn</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-198"></a><span class="hs-cpp">#else
</span><a name="debugIsOn"><a href="Util.html#debugIsOn"><span class="hs-identifier">debugIsOn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-200"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-202"></a><span class="hs-identifier">ncgDebugIsOn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-203"></a><span class="hs-cpp">#if defined(NCG_DEBUG)
</span><span class="hs-identifier">ncgDebugIsOn</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-205"></a><span class="hs-cpp">#else
</span><a name="ncgDebugIsOn"><a href="Util.html#ncgDebugIsOn"><span class="hs-identifier">ncgDebugIsOn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-207"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-209"></a><span class="hs-identifier">ghciTablesNextToCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-210"></a><span class="hs-cpp">#if defined(GHCI_TABLES_NEXT_TO_CODE)
</span><span class="hs-identifier">ghciTablesNextToCode</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-212"></a><span class="hs-cpp">#else
</span><a name="ghciTablesNextToCode"><a href="Util.html#ghciTablesNextToCode"><span class="hs-identifier">ghciTablesNextToCode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-214"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-216"></a><span class="hs-identifier">isWindowsHost</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-217"></a><span class="hs-cpp">#if defined(mingw32_HOST_OS)
</span><span class="hs-identifier">isWindowsHost</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-219"></a><span class="hs-cpp">#else
</span><a name="isWindowsHost"><a href="Util.html#isWindowsHost"><span class="hs-identifier">isWindowsHost</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-221"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-223"></a><span class="hs-identifier">isDarwinHost</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-224"></a><span class="hs-cpp">#if defined(darwin_HOST_OS)
</span><a name="isDarwinHost"><a href="Util.html#isDarwinHost"><span class="hs-identifier">isDarwinHost</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-226"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">isDarwinHost</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-228"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-230"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{A for loop}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span class="hs-comment">-- | Compose a function with itself n times.  (nth rather than twice)</span><span>
</span><a name="line-239"></a><span class="hs-identifier">nTimes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018205"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018205"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018205"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018205"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-240"></a><a name="nTimes"><a href="Util.html#nTimes"><span class="hs-identifier">nTimes</span></a></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-241"></a><span class="hs-identifier">nTimes</span><span> </span><span class="hs-number">1</span><span> </span><a name="local-6989586621680018206"><a href="#local-6989586621680018206"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018206"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-242"></a><span class="hs-identifier">nTimes</span><span> </span><a name="local-6989586621680018207"><a href="#local-6989586621680018207"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680018208"><a href="#local-6989586621680018208"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018208"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Util.html#nTimes"><span class="hs-identifier hs-var">nTimes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018207"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018208"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span class="hs-identifier">fstOf3</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018202"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621680018203"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><a href="#local-6989586621680018204"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018202"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-245"></a><span class="hs-identifier">sndOf3</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018199"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621680018200"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><a href="#local-6989586621680018201"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018200"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-246"></a><span class="hs-identifier">thdOf3</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018196"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621680018197"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><a href="#local-6989586621680018198"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018198"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-247"></a><a name="fstOf3"><a href="Util.html#fstOf3"><span class="hs-identifier">fstOf3</span></a></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621680018209"><a href="#local-6989586621680018209"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621680018209"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-248"></a><a name="sndOf3"><a href="Util.html#sndOf3"><span class="hs-identifier">sndOf3</span></a></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621680018210"><a href="#local-6989586621680018210"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621680018210"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-249"></a><a name="thdOf3"><a href="Util.html#thdOf3"><span class="hs-identifier">thdOf3</span></a></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621680018211"><a href="#local-6989586621680018211"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621680018211"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-identifier">fst3</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018192"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018193"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018192"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018194"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018195"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018193"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018194"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018195"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-252"></a><a name="fst3"><a href="Util.html#fst3"><span class="hs-identifier">fst3</span></a></a><span> </span><a name="local-6989586621680018212"><a href="#local-6989586621680018212"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018213"><a href="#local-6989586621680018213"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018214"><a href="#local-6989586621680018214"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018215"><a href="#local-6989586621680018215"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018212"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018213"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018214"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018215"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-identifier">snd3</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018188"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018189"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018190"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018188"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018191"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018190"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018189"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018191"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><a name="snd3"><a href="Util.html#snd3"><span class="hs-identifier">snd3</span></a></a><span> </span><a name="local-6989586621680018216"><a href="#local-6989586621680018216"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018217"><a href="#local-6989586621680018217"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018218"><a href="#local-6989586621680018218"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018219"><a href="#local-6989586621680018219"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018217"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018216"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018218"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018219"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span class="hs-identifier">third3</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018184"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018185"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018186"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018187"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018184"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018186"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018187"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018185"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><a name="third3"><a href="Util.html#third3"><span class="hs-identifier">third3</span></a></a><span> </span><a name="local-6989586621680018220"><a href="#local-6989586621680018220"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018221"><a href="#local-6989586621680018221"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018222"><a href="#local-6989586621680018222"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018223"><a href="#local-6989586621680018223"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018221"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018222"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018220"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018223"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span class="hs-identifier">uncurry3</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018180"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018181"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018182"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018183"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018180"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018181"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018182"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018183"><span class="hs-identifier hs-type">d</span></a><span>
</span><a name="line-261"></a><a name="uncurry3"><a href="Util.html#uncurry3"><span class="hs-identifier">uncurry3</span></a></a><span> </span><a name="local-6989586621680018224"><a href="#local-6989586621680018224"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018225"><a href="#local-6989586621680018225"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018226"><a href="#local-6989586621680018226"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018227"><a href="#local-6989586621680018227"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018224"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018225"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621680018226"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621680018227"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-identifier">liftFst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018177"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018178"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018177"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018179"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018178"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018179"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-264"></a><a name="liftFst"><a href="Util.html#liftFst"><span class="hs-identifier">liftFst</span></a></a><span> </span><a name="local-6989586621680018228"><a href="#local-6989586621680018228"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018229"><a href="#local-6989586621680018229"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018230"><a href="#local-6989586621680018230"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018228"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018229"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018230"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-identifier">liftSnd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018174"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018175"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018176"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018174"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018176"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018175"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-267"></a><a name="liftSnd"><a href="Util.html#liftSnd"><span class="hs-identifier">liftSnd</span></a></a><span> </span><a name="local-6989586621680018231"><a href="#local-6989586621680018231"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018232"><a href="#local-6989586621680018232"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018233"><a href="#local-6989586621680018233"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018232"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018231"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018233"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-identifier">firstM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680018170"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018171"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018170"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680018172"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018171"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018173"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018170"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018172"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018173"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-270"></a><a name="firstM"><a href="Util.html#firstM"><span class="hs-identifier">firstM</span></a></a><span> </span><a name="local-6989586621680018234"><a href="#local-6989586621680018234"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018235"><a href="#local-6989586621680018235"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018236"><a href="#local-6989586621680018236"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680018237"><a href="#local-6989586621680018237"><span class="hs-identifier">x'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018237"><span class="hs-identifier hs-var">x'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018236"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018234"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018235"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-identifier">first3M</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680018165"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018166"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018165"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680018167"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018166"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018168"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018169"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018165"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018167"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018168"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018169"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-273"></a><a name="first3M"><a href="Util.html#first3M"><span class="hs-identifier">first3M</span></a></a><span> </span><a name="local-6989586621680018238"><a href="#local-6989586621680018238"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018239"><a href="#local-6989586621680018239"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018240"><a href="#local-6989586621680018240"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018241"><a href="#local-6989586621680018241"><span class="hs-identifier">z</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680018242"><a href="#local-6989586621680018242"><span class="hs-identifier">x'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018242"><span class="hs-identifier hs-var">x'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018240"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018241"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018238"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018239"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-identifier">secondM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680018161"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018162"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018161"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680018163"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018164"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018162"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018161"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018164"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018163"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><a name="secondM"><a href="Util.html#secondM"><span class="hs-identifier">secondM</span></a></a><span> </span><a name="local-6989586621680018243"><a href="#local-6989586621680018243"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018244"><a href="#local-6989586621680018244"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018245"><a href="#local-6989586621680018245"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018244"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621680018243"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018245"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Utils-lists]{General list processing}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-identifier">filterOut</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018160"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018160"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018160"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- ^ Like filter, only it reverses the sense of the test</span><span>
</span><a name="line-288"></a><a name="filterOut"><a href="Util.html#filterOut"><span class="hs-identifier">filterOut</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-289"></a><span class="hs-identifier">filterOut</span><span> </span><a name="local-6989586621680018246"><a href="#local-6989586621680018246"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018247"><a href="#local-6989586621680018247"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018248"><a href="#local-6989586621680018248"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018246"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018247"><span class="hs-identifier hs-var">x</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a><span> </span><a href="#local-6989586621680018246"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018248"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-290"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018247"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a><span> </span><a href="#local-6989586621680018246"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018248"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-identifier">partitionWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018157"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621680018158"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621680018159"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018157"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621680018158"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018159"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-293"></a><span class="hs-comment">-- ^ Uses a function to determine which of two output lists an input element should join</span><span>
</span><a name="line-294"></a><a name="partitionWith"><a href="Util.html#partitionWith"><span class="hs-identifier">partitionWith</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-295"></a><span class="hs-identifier">partitionWith</span><span> </span><a name="local-6989586621680018249"><a href="#local-6989586621680018249"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018250"><a href="#local-6989586621680018250"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018251"><a href="#local-6989586621680018251"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018249"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018250"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-296"></a><span>                         </span><span class="hs-identifier hs-var">Left</span><span>  </span><a name="local-6989586621680018254"><a href="#local-6989586621680018254"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018254"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018252"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018253"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>                         </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621680018255"><a href="#local-6989586621680018255"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018252"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018255"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018253"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span>
</span><a name="line-298"></a><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018252"><a href="#local-6989586621680018252"><span class="hs-identifier">bs</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018253"><a href="#local-6989586621680018253"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a><span> </span><a href="#local-6989586621680018249"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018251"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span class="hs-identifier">chkAppend</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018156"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018156"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018156"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-301"></a><span class="hs-comment">-- Checks for the second argument being empty</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- Used in situations where that situation is common</span><span>
</span><a name="line-303"></a><a name="chkAppend"><a href="Util.html#chkAppend"><span class="hs-identifier">chkAppend</span></a></a><span> </span><a name="local-6989586621680018256"><a href="#local-6989586621680018256"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621680018257"><a href="#local-6989586621680018257"><span class="hs-identifier">ys</span></a></a><span>
</span><a name="line-304"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680018257"><span class="hs-identifier hs-var">ys</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018256"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-305"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018256"><span class="hs-identifier hs-var">xs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680018257"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-comment">{-
A paranoid @zip@ (and some @zipWith@ friends) that checks the lists
are of equal length.  Alastair Reid thinks this should only happen if
DEBUGging on; hey, why not?
-}</span><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span class="hs-identifier">zipEqual</span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018154"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018155"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680018154"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621680018155"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-314"></a><span class="hs-identifier">zipWithEqual</span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018151"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018152"><span class="hs-identifier hs-type">b</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018153"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018151"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="#local-6989586621680018152"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="#local-6989586621680018153"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-315"></a><span class="hs-identifier">zipWith3Equal</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018147"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018148"><span class="hs-identifier hs-type">b</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018149"><span class="hs-identifier hs-type">c</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018150"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018147"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="#local-6989586621680018148"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="#local-6989586621680018149"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="#local-6989586621680018150"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">]</span><span>
</span><a name="line-316"></a><span class="hs-identifier">zipWith4Equal</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018142"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018143"><span class="hs-identifier hs-type">b</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018144"><span class="hs-identifier hs-type">c</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018145"><span class="hs-identifier hs-type">d</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018146"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018142"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="#local-6989586621680018143"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="#local-6989586621680018144"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="#local-6989586621680018145"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="#local-6989586621680018146"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">]</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-cpp">#if !defined(DEBUG)
</span><a name="zipEqual"><a href="Util.html#zipEqual"><span class="hs-identifier">zipEqual</span></a></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span>
</span><a name="line-320"></a><a name="zipWithEqual"><a href="Util.html#zipWithEqual"><span class="hs-identifier">zipWithEqual</span></a></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span>
</span><a name="line-321"></a><a name="zipWith3Equal"><a href="Util.html#zipWith3Equal"><span class="hs-identifier">zipWith3Equal</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith3</span><span>
</span><a name="line-322"></a><a name="zipWith4Equal"><a href="Util.html#zipWith4Equal"><span class="hs-identifier">zipWith4Equal</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith4</span><span>
</span><a name="line-323"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">zipEqual</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-325"></a><span class="hs-identifier">zipEqual</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">b</span><span class="hs-glyph">:</span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">zipEqual</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">bs</span><span>
</span><a name="line-326"></a><span class="hs-identifier">zipEqual</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">panic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;zipEqual: unequal lists:&quot;</span><span class="hs-operator">++</span><span class="hs-identifier">msg</span><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-identifier">zipWithEqual</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">z</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">b</span><span class="hs-glyph">:</span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">z</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">zipWithEqual</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">z</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">bs</span><span>
</span><a name="line-329"></a><span class="hs-identifier">zipWithEqual</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-330"></a><span class="hs-identifier">zipWithEqual</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">panic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;zipWithEqual: unequal lists:&quot;</span><span class="hs-operator">++</span><span class="hs-identifier">msg</span><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-identifier">zipWith3Equal</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">z</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">b</span><span class="hs-glyph">:</span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">c</span><span class="hs-glyph">:</span><span class="hs-identifier">cs</span><span class="hs-special">)</span><span>
</span><a name="line-333"></a><span>                                </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">z</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">zipWith3Equal</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">z</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-identifier">cs</span><span>
</span><a name="line-334"></a><span class="hs-identifier">zipWith3Equal</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-335"></a><span class="hs-identifier">zipWith3Equal</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">panic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;zipWith3Equal: unequal lists:&quot;</span><span class="hs-operator">++</span><span class="hs-identifier">msg</span><span class="hs-special">)</span><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span class="hs-identifier">zipWith4Equal</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">z</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">b</span><span class="hs-glyph">:</span><span class="hs-identifier">bs</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">c</span><span class="hs-glyph">:</span><span class="hs-identifier">cs</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">d</span><span class="hs-glyph">:</span><span class="hs-identifier">ds</span><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>                                </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">z</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">zipWith4Equal</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">z</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-identifier">cs</span><span> </span><span class="hs-identifier">ds</span><span>
</span><a name="line-339"></a><span class="hs-identifier">zipWith4Equal</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-340"></a><span class="hs-identifier">zipWith4Equal</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">panic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;zipWith4Equal: unequal lists:&quot;</span><span class="hs-operator">++</span><span class="hs-identifier">msg</span><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- | 'zipLazy' is a kind of 'zip' that is lazy in the second list (observe the ~)</span><span>
</span><a name="line-344"></a><span class="hs-identifier">zipLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018140"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018141"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680018140"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621680018141"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-345"></a><a name="zipLazy"><a href="Util.html#zipLazy"><span class="hs-identifier">zipLazy</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-346"></a><span class="hs-identifier">zipLazy</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018258"><a href="#local-6989586621680018258"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018259"><a href="#local-6989586621680018259"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621680018260"><a href="#local-6989586621680018260"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018261"><a href="#local-6989586621680018261"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018258"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621680018260"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#zipLazy"><span class="hs-identifier hs-var">zipLazy</span></a><span> </span><a href="#local-6989586621680018259"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018261"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-- | 'zipWithLazy' is like 'zipWith' but is lazy in the second list.</span><span>
</span><a name="line-349"></a><span class="hs-comment">-- The length of the output is always the same as the length of the first</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- list.</span><span>
</span><a name="line-351"></a><span class="hs-identifier">zipWithLazy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018137"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018138"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018139"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018137"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018138"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018139"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-352"></a><a name="zipWithLazy"><a href="Util.html#zipWithLazy"><span class="hs-identifier">zipWithLazy</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-353"></a><span class="hs-identifier">zipWithLazy</span><span> </span><a name="local-6989586621680018262"><a href="#local-6989586621680018262"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018263"><a href="#local-6989586621680018263"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621680018265"><a href="#local-6989586621680018265"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018266"><a href="#local-6989586621680018266"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018262"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018263"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621680018265"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#zipWithLazy"><span class="hs-identifier hs-var">zipWithLazy</span></a><span> </span><a href="#local-6989586621680018262"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621680018266"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-comment">-- | 'zipWith3Lazy' is like 'zipWith3' but is lazy in the second and third lists.</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- The length of the output is always the same as the length of the first</span><span>
</span><a name="line-357"></a><span class="hs-comment">-- list.</span><span>
</span><a name="line-358"></a><span class="hs-identifier">zipWith3Lazy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018133"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018134"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018135"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018136"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018133"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018134"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018135"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018136"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">]</span><span>
</span><a name="line-359"></a><a name="zipWith3Lazy"><a href="Util.html#zipWith3Lazy"><span class="hs-identifier">zipWith3Lazy</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-identifier">_</span><span>       </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-360"></a><span class="hs-identifier">zipWith3Lazy</span><span> </span><a name="local-6989586621680018267"><a href="#local-6989586621680018267"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018268"><a href="#local-6989586621680018268"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621680018270"><a href="#local-6989586621680018270"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018271"><a href="#local-6989586621680018271"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621680018272"><a href="#local-6989586621680018272"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018273"><a href="#local-6989586621680018273"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018267"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018268"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621680018270"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621680018272"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#zipWith3Lazy"><span class="hs-identifier hs-var">zipWith3Lazy</span></a><span> </span><a href="#local-6989586621680018267"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621680018271"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621680018273"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-comment">-- | 'filterByList' takes a list of Bools and a list of some elements and</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- filters out these elements for which the corresponding value in the list of</span><span>
</span><a name="line-364"></a><span class="hs-comment">-- Bools is False. This function does not check whether the lists have equal</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- length.</span><span>
</span><a name="line-366"></a><span class="hs-identifier">filterByList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018132"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018132"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-367"></a><a name="filterByList"><a href="Util.html#filterByList"><span class="hs-identifier">filterByList</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-glyph">:</span><a name="local-6989586621680018274"><a href="#local-6989586621680018274"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><a name="local-6989586621680018275"><a href="#local-6989586621680018275"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018276"><a href="#local-6989586621680018276"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018275"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#filterByList"><span class="hs-identifier hs-var">filterByList</span></a><span> </span><a href="#local-6989586621680018274"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621680018276"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-368"></a><span class="hs-identifier">filterByList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-glyph">:</span><a name="local-6989586621680018277"><a href="#local-6989586621680018277"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018278"><a href="#local-6989586621680018278"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>     </span><a href="Util.html#filterByList"><span class="hs-identifier hs-var">filterByList</span></a><span> </span><a href="#local-6989586621680018277"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621680018278"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-369"></a><span class="hs-identifier">filterByList</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">-- | 'filterByLists' takes a list of Bools and two lists as input, and</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- outputs a new list consisting of elements from the last two input lists. For</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- each Bool in the list, if it is 'True', then it takes an element from the</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- former list. If it is 'False', it takes an element from the latter list.</span><span>
</span><a name="line-375"></a><span class="hs-comment">-- The elements taken correspond to the index of the Bool in its list.</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- For example:</span><span>
</span><a name="line-377"></a><span class="hs-comment">--</span><span>
</span><a name="line-378"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- filterByLists [True, False, True, False] \&quot;abcd\&quot; \&quot;wxyz\&quot; = \&quot;axcz\&quot;</span><span>
</span><a name="line-380"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-381"></a><span class="hs-comment">--</span><span>
</span><a name="line-382"></a><span class="hs-comment">-- This function does not check whether the lists have equal length.</span><span>
</span><a name="line-383"></a><span class="hs-identifier">filterByLists</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018131"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018131"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018131"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-384"></a><a name="filterByLists"><a href="Util.html#filterByLists"><span class="hs-identifier">filterByLists</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-glyph">:</span><a name="local-6989586621680018279"><a href="#local-6989586621680018279"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><a name="local-6989586621680018280"><a href="#local-6989586621680018280"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018281"><a href="#local-6989586621680018281"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018282"><a href="#local-6989586621680018282"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018280"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#filterByLists"><span class="hs-identifier hs-var">filterByLists</span></a><span> </span><a href="#local-6989586621680018279"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621680018281"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018282"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-385"></a><span class="hs-identifier">filterByLists</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-glyph">:</span><a name="local-6989586621680018283"><a href="#local-6989586621680018283"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018284"><a href="#local-6989586621680018284"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018285"><a href="#local-6989586621680018285"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018286"><a href="#local-6989586621680018286"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018285"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#filterByLists"><span class="hs-identifier hs-var">filterByLists</span></a><span> </span><a href="#local-6989586621680018283"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621680018284"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018286"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-386"></a><span class="hs-identifier">filterByLists</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span class="hs-comment">-- | 'partitionByList' takes a list of Bools and a list of some elements and</span><span>
</span><a name="line-389"></a><span class="hs-comment">-- partitions the list according to the list of Bools. Elements corresponding</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- to 'True' go to the left; elements corresponding to 'False' go to the right.</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- For example, @partitionByList [True, False, True] [1,2,3] == ([1,3], [2])@</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- This function does not check whether the lists have equal</span><span>
</span><a name="line-393"></a><span class="hs-comment">-- length.</span><span>
</span><a name="line-394"></a><span class="hs-identifier">partitionByList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018130"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621680018130"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018130"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-395"></a><a name="partitionByList"><a href="Util.html#partitionByList"><span class="hs-identifier">partitionByList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018287"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-396"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-397"></a><span>    </span><a name="local-6989586621680018287"><a href="#local-6989586621680018287"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621680018288"><a href="#local-6989586621680018288"><span class="hs-identifier">trues</span></a></a><span> </span><a name="local-6989586621680018289"><a href="#local-6989586621680018289"><span class="hs-identifier">falses</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018290"><a href="#local-6989586621680018290"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018291"><a href="#local-6989586621680018291"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018292"><a href="#local-6989586621680018292"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018287"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018291"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018288"><span class="hs-identifier hs-var">trues</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018289"><span class="hs-identifier hs-var">falses</span></a><span> </span><a href="#local-6989586621680018290"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621680018292"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-398"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680018293"><a href="#local-6989586621680018293"><span class="hs-identifier">trues</span></a></a><span> </span><a name="local-6989586621680018294"><a href="#local-6989586621680018294"><span class="hs-identifier">falses</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018295"><a href="#local-6989586621680018295"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018296"><a href="#local-6989586621680018296"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018297"><a href="#local-6989586621680018297"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018287"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018293"><span class="hs-identifier hs-var">trues</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018296"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018294"><span class="hs-identifier hs-var">falses</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018295"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621680018297"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-399"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680018298"><a href="#local-6989586621680018298"><span class="hs-identifier">trues</span></a></a><span> </span><a name="local-6989586621680018299"><a href="#local-6989586621680018299"><span class="hs-identifier">falses</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621680018298"><span class="hs-identifier hs-var">trues</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621680018299"><span class="hs-identifier hs-var">falses</span></a><span class="hs-special">)</span><span>
</span><a name="line-400"></a><span>
</span><a name="line-401"></a><span class="hs-identifier">stretchZipWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018127"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018128"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018127"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018128"><span class="hs-identifier hs-type">b</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018129"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018127"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018128"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018129"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-402"></a><span class="hs-comment">-- ^ @stretchZipWith p z f xs ys@ stretches @ys@ by inserting @z@ in</span><span>
</span><a name="line-403"></a><span class="hs-comment">-- the places where @p@ returns @True@</span><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><a name="stretchZipWith"><a href="Util.html#stretchZipWith"><span class="hs-identifier">stretchZipWith</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-406"></a><span class="hs-identifier">stretchZipWith</span><span> </span><a name="local-6989586621680018300"><a href="#local-6989586621680018300"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680018301"><a href="#local-6989586621680018301"><span class="hs-identifier">z</span></a></a><span> </span><a name="local-6989586621680018302"><a href="#local-6989586621680018302"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018303"><a href="#local-6989586621680018303"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018304"><a href="#local-6989586621680018304"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680018305"><a href="#local-6989586621680018305"><span class="hs-identifier">ys</span></a></a><span>
</span><a name="line-407"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018300"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018303"><span class="hs-identifier hs-var">x</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018302"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018303"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680018301"><span class="hs-identifier hs-var">z</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#stretchZipWith"><span class="hs-identifier hs-var">stretchZipWith</span></a><span> </span><a href="#local-6989586621680018300"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018301"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-6989586621680018302"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018304"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018305"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-408"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018305"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-409"></a><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-410"></a><span>                </span><span class="hs-special">(</span><a name="local-6989586621680018306"><a href="#local-6989586621680018306"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018307"><a href="#local-6989586621680018307"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018302"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018303"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680018306"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#stretchZipWith"><span class="hs-identifier hs-var">stretchZipWith</span></a><span> </span><a href="#local-6989586621680018300"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018301"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-6989586621680018302"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018304"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018307"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span class="hs-identifier">mapFst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018124"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018125"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680018124"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621680018126"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680018125"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><a href="#local-6989586621680018126"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-413"></a><span class="hs-identifier">mapSnd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018121"><span class="hs-identifier hs-type">b</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018122"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680018123"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621680018121"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680018123"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621680018122"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><a name="mapFst"><a href="Util.html#mapFst"><span class="hs-identifier">mapFst</span></a></a><span> </span><a name="local-6989586621680018308"><a href="#local-6989586621680018308"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621680018309"><a href="#local-6989586621680018309"><span class="hs-identifier">xys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680018308"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018310"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018311"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018310"><a href="#local-6989586621680018310"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018311"><a href="#local-6989586621680018311"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018309"><span class="hs-identifier hs-var">xys</span></a><span class="hs-special">]</span><span>
</span><a name="line-416"></a><a name="mapSnd"><a href="Util.html#mapSnd"><span class="hs-identifier">mapSnd</span></a></a><span> </span><a name="local-6989586621680018312"><a href="#local-6989586621680018312"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621680018313"><a href="#local-6989586621680018313"><span class="hs-identifier">xys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680018314"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018312"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018315"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018314"><a href="#local-6989586621680018314"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018315"><a href="#local-6989586621680018315"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018313"><span class="hs-identifier hs-var">xys</span></a><span class="hs-special">]</span><span>
</span><a name="line-417"></a><span>
</span><a name="line-418"></a><span class="hs-identifier">mapAndUnzip</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018118"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018119"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018120"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018118"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621680018119"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018120"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><a name="mapAndUnzip"><a href="Util.html#mapAndUnzip"><span class="hs-identifier">mapAndUnzip</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span class="hs-identifier">mapAndUnzip</span><span> </span><a name="local-6989586621680018316"><a href="#local-6989586621680018316"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018317"><a href="#local-6989586621680018317"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018318"><a href="#local-6989586621680018318"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018319"><a href="#local-6989586621680018319"><span class="hs-identifier">r1</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621680018320"><a href="#local-6989586621680018320"><span class="hs-identifier">r2</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018316"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018317"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-423"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680018321"><a href="#local-6989586621680018321"><span class="hs-identifier">rs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018322"><a href="#local-6989586621680018322"><span class="hs-identifier">rs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#mapAndUnzip"><span class="hs-identifier hs-var">mapAndUnzip</span></a><span> </span><a href="#local-6989586621680018316"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018318"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-424"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-425"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621680018319"><span class="hs-identifier hs-var">r1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018321"><span class="hs-identifier hs-var">rs1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018320"><span class="hs-identifier hs-var">r2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018322"><span class="hs-identifier hs-var">rs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-identifier">mapAndUnzip3</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018114"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018115"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018116"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018117"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018114"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621680018115"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018116"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018117"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-428"></a><span>
</span><a name="line-429"></a><a name="mapAndUnzip3"><a href="Util.html#mapAndUnzip3"><span class="hs-identifier">mapAndUnzip3</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-430"></a><span class="hs-identifier">mapAndUnzip3</span><span> </span><a name="local-6989586621680018323"><a href="#local-6989586621680018323"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018324"><a href="#local-6989586621680018324"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018325"><a href="#local-6989586621680018325"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018326"><a href="#local-6989586621680018326"><span class="hs-identifier">r1</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621680018327"><a href="#local-6989586621680018327"><span class="hs-identifier">r2</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621680018328"><a href="#local-6989586621680018328"><span class="hs-identifier">r3</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018323"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018324"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-432"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680018329"><a href="#local-6989586621680018329"><span class="hs-identifier">rs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018330"><a href="#local-6989586621680018330"><span class="hs-identifier">rs2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018331"><a href="#local-6989586621680018331"><span class="hs-identifier">rs3</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#mapAndUnzip3"><span class="hs-identifier hs-var">mapAndUnzip3</span></a><span> </span><a href="#local-6989586621680018323"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018325"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-433"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-434"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621680018326"><span class="hs-identifier hs-var">r1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018329"><span class="hs-identifier hs-var">rs1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018327"><span class="hs-identifier hs-var">r2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018330"><span class="hs-identifier hs-var">rs2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018328"><span class="hs-identifier hs-var">r3</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018331"><span class="hs-identifier hs-var">rs3</span></a><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span class="hs-identifier">zipWithAndUnzip</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018110"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018111"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018112"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">,</span><a href="#local-6989586621680018113"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018110"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018111"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621680018112"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="#local-6989586621680018113"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-437"></a><a name="zipWithAndUnzip"><a href="Util.html#zipWithAndUnzip"><span class="hs-identifier">zipWithAndUnzip</span></a></a><span> </span><a name="local-6989586621680018332"><a href="#local-6989586621680018332"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018333"><a href="#local-6989586621680018333"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018335"><a href="#local-6989586621680018335"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018336"><a href="#local-6989586621680018336"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-438"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018337"><a href="#local-6989586621680018337"><span class="hs-identifier">r1</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621680018338"><a href="#local-6989586621680018338"><span class="hs-identifier">r2</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018332"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018333"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621680018335"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-439"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680018339"><a href="#local-6989586621680018339"><span class="hs-identifier">rs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018340"><a href="#local-6989586621680018340"><span class="hs-identifier">rs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#zipWithAndUnzip"><span class="hs-identifier hs-var">zipWithAndUnzip</span></a><span> </span><a href="#local-6989586621680018332"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621680018336"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-440"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-441"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621680018337"><span class="hs-identifier hs-var">r1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018339"><span class="hs-identifier hs-var">rs1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018338"><span class="hs-identifier hs-var">r2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018340"><span class="hs-identifier hs-var">rs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span class="hs-identifier">zipWithAndUnzip</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-comment">-- | This has the effect of making the two lists have equal length by dropping</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- the tail of the longer one.</span><span>
</span><a name="line-446"></a><span class="hs-identifier">zipAndUnzip</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018108"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018109"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621680018108"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="#local-6989586621680018109"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-447"></a><a name="zipAndUnzip"><a href="Util.html#zipAndUnzip"><span class="hs-identifier">zipAndUnzip</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018341"><a href="#local-6989586621680018341"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018343"><a href="#local-6989586621680018343"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018344"><a href="#local-6989586621680018344"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018345"><a href="#local-6989586621680018345"><span class="hs-identifier">rs1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018346"><a href="#local-6989586621680018346"><span class="hs-identifier">rs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#zipAndUnzip"><span class="hs-identifier hs-var">zipAndUnzip</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621680018344"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-449"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-450"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621680018341"><span class="hs-identifier hs-var">a</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018345"><span class="hs-identifier hs-var">rs1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018343"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018346"><span class="hs-identifier hs-var">rs2</span></a><span class="hs-special">)</span><span>
</span><a name="line-451"></a><span class="hs-identifier">zipAndUnzip</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span class="hs-identifier">mapAccumL2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018104"><span class="hs-identifier hs-type">s1</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018105"><span class="hs-identifier hs-type">s2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018106"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018104"><span class="hs-identifier hs-type">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018105"><span class="hs-identifier hs-type">s2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018107"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018104"><span class="hs-identifier hs-type">s1</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018105"><span class="hs-identifier hs-type">s2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018106"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018104"><span class="hs-identifier hs-type">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018105"><span class="hs-identifier hs-type">s2</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018107"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-454"></a><a name="mapAccumL2"><a href="Util.html#mapAccumL2"><span class="hs-identifier">mapAccumL2</span></a></a><span> </span><a name="local-6989586621680018347"><a href="#local-6989586621680018347"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621680018348"><a href="#local-6989586621680018348"><span class="hs-identifier">s1</span></a></a><span> </span><a name="local-6989586621680018349"><a href="#local-6989586621680018349"><span class="hs-identifier">s2</span></a></a><span> </span><a name="local-6989586621680018350"><a href="#local-6989586621680018350"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018351"><span class="hs-identifier hs-var">s1'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018352"><span class="hs-identifier hs-var">s2'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018353"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-455"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621680018351"><a href="#local-6989586621680018351"><span class="hs-identifier">s1'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018352"><a href="#local-6989586621680018352"><span class="hs-identifier">s2'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680018353"><a href="#local-6989586621680018353"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapAccumL</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621680018354"><a href="#local-6989586621680018354"><span class="hs-identifier">s1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018355"><a href="#local-6989586621680018355"><span class="hs-identifier">s2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680018356"><a href="#local-6989586621680018356"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018347"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018354"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621680018355"><span class="hs-identifier hs-var">s2</span></a><span> </span><a href="#local-6989586621680018356"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-456"></a><span>                                                       </span><span class="hs-special">(</span><a name="local-6989586621680018357"><a href="#local-6989586621680018357"><span class="hs-identifier">s1'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018358"><a href="#local-6989586621680018358"><span class="hs-identifier">s2'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018359"><a href="#local-6989586621680018359"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621680018357"><span class="hs-identifier hs-var">s1'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018358"><span class="hs-identifier hs-var">s2'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018359"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>                                     </span><span class="hs-special">(</span><a href="#local-6989586621680018348"><span class="hs-identifier hs-var">s1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018349"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018350"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span class="hs-identifier">nOfThem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018103"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018103"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-460"></a><a name="nOfThem"><a href="Util.html#nOfThem"><span class="hs-identifier">nOfThem</span></a></a><span> </span><a name="local-6989586621680018360"><a href="#local-6989586621680018360"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680018361"><a href="#local-6989586621680018361"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621680018360"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018361"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-461"></a><span>
</span><a name="line-462"></a><span class="hs-comment">-- | @atLength atLen atEnd ls n@ unravels list @ls@ to position @n@. Precisely:</span><span>
</span><a name="line-463"></a><span class="hs-comment">--</span><span>
</span><a name="line-464"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-465"></a><span class="hs-comment">--  atLength atLenPred atEndPred ls n</span><span>
</span><a name="line-466"></a><span class="hs-comment">--   | n &lt; 0         = atLenPred ls</span><span>
</span><a name="line-467"></a><span class="hs-comment">--   | length ls &lt; n = atEndPred (n - length ls)</span><span>
</span><a name="line-468"></a><span class="hs-comment">--   | otherwise     = atLenPred (drop n ls)</span><span>
</span><a name="line-469"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-470"></a><span class="hs-identifier">atLength</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621680018101"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018102"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Called when length ls &gt;= n, passed (drop n ls)</span><span>
</span><a name="line-471"></a><span>                         </span><span class="hs-comment">--    NB: arg passed to this function may be []</span><span>
</span><a name="line-472"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018102"><span class="hs-identifier hs-type">b</span></a><span>            </span><span class="hs-comment">-- Called when length ls &lt;  n</span><span>
</span><a name="line-473"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018101"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-474"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-475"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018102"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-476"></a><a name="atLength"><a href="Util.html#atLength"><span class="hs-identifier">atLength</span></a></a><span> </span><a name="local-6989586621680018362"><a href="#local-6989586621680018362"><span class="hs-identifier">atLenPred</span></a></a><span> </span><a name="local-6989586621680018363"><a href="#local-6989586621680018363"><span class="hs-identifier">atEnd</span></a></a><span> </span><a name="local-6989586621680018364"><a href="#local-6989586621680018364"><span class="hs-identifier">ls0</span></a></a><span> </span><a name="local-6989586621680018365"><a href="#local-6989586621680018365"><span class="hs-identifier">n0</span></a></a><span>
</span><a name="line-477"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018365"><span class="hs-identifier hs-var">n0</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018362"><span class="hs-identifier hs-var">atLenPred</span></a><span> </span><a href="#local-6989586621680018364"><span class="hs-identifier hs-var">ls0</span></a><span>
</span><a name="line-478"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018366"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018365"><span class="hs-identifier hs-var">n0</span></a><span> </span><a href="#local-6989586621680018364"><span class="hs-identifier hs-var">ls0</span></a><span>
</span><a name="line-479"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-480"></a><span>    </span><span class="hs-comment">-- go's first arg n &gt;= 0</span><span>
</span><a name="line-481"></a><span>    </span><a name="local-6989586621680018366"><a href="#local-6989586621680018366"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-number">0</span><span> </span><a name="local-6989586621680018367"><a href="#local-6989586621680018367"><span class="hs-identifier">ls</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018362"><span class="hs-identifier hs-var">atLenPred</span></a><span> </span><a href="#local-6989586621680018367"><span class="hs-identifier hs-var">ls</span></a><span>
</span><a name="line-482"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018363"><span class="hs-identifier hs-var">atEnd</span></a><span>           </span><span class="hs-comment">-- n &gt; 0 here</span><span>
</span><a name="line-483"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680018368"><a href="#local-6989586621680018368"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018369"><a href="#local-6989586621680018369"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018366"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018368"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018369"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-comment">-- Some special cases of atLength:</span><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span class="hs-comment">-- | @(lengthExceeds xs n) = (length xs &gt; n)@</span><span>
</span><a name="line-488"></a><span class="hs-identifier">lengthExceeds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018100"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-489"></a><a name="lengthExceeds"><a href="Util.html#lengthExceeds"><span class="hs-identifier">lengthExceeds</span></a></a><span> </span><a name="local-6989586621680018370"><a href="#local-6989586621680018370"><span class="hs-identifier">lst</span></a></a><span> </span><a name="local-6989586621680018371"><a href="#local-6989586621680018371"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-490"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018371"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-491"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-492"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-493"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#atLength"><span class="hs-identifier hs-var">atLength</span></a><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621680018370"><span class="hs-identifier hs-var">lst</span></a><span> </span><a href="#local-6989586621680018371"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-494"></a><span>
</span><a name="line-495"></a><span class="hs-comment">-- | @(lengthAtLeast xs n) = (length xs &gt;= n)@</span><span>
</span><a name="line-496"></a><span class="hs-identifier">lengthAtLeast</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018099"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-497"></a><a name="lengthAtLeast"><a href="Util.html#lengthAtLeast"><span class="hs-identifier">lengthAtLeast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#atLength"><span class="hs-identifier hs-var">atLength</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-498"></a><span>
</span><a name="line-499"></a><span class="hs-comment">-- | @(lengthIs xs n) = (length xs == n)@</span><span>
</span><a name="line-500"></a><span class="hs-identifier">lengthIs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018098"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-501"></a><a name="lengthIs"><a href="Util.html#lengthIs"><span class="hs-identifier">lengthIs</span></a></a><span> </span><a name="local-6989586621680018372"><a href="#local-6989586621680018372"><span class="hs-identifier">lst</span></a></a><span> </span><a name="local-6989586621680018373"><a href="#local-6989586621680018373"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-502"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018373"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-503"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-504"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-505"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#atLength"><span class="hs-identifier hs-var">atLength</span></a><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621680018372"><span class="hs-identifier hs-var">lst</span></a><span> </span><a href="#local-6989586621680018373"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span class="hs-comment">-- | @(lengthIsNot xs n) = (length xs /= n)@</span><span>
</span><a name="line-508"></a><span class="hs-identifier">lengthIsNot</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018097"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-509"></a><a name="lengthIsNot"><a href="Util.html#lengthIsNot"><span class="hs-identifier">lengthIsNot</span></a></a><span> </span><a name="local-6989586621680018374"><a href="#local-6989586621680018374"><span class="hs-identifier">lst</span></a></a><span> </span><a name="local-6989586621680018375"><a href="#local-6989586621680018375"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-510"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018375"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-511"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#atLength"><span class="hs-identifier hs-var">atLength</span></a><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621680018374"><span class="hs-identifier hs-var">lst</span></a><span> </span><a href="#local-6989586621680018375"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-512"></a><span>
</span><a name="line-513"></a><span class="hs-comment">-- | @(lengthAtMost xs n) = (length xs &lt;= n)@</span><span>
</span><a name="line-514"></a><span class="hs-identifier">lengthAtMost</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018096"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-515"></a><a name="lengthAtMost"><a href="Util.html#lengthAtMost"><span class="hs-identifier">lengthAtMost</span></a></a><span> </span><a name="local-6989586621680018376"><a href="#local-6989586621680018376"><span class="hs-identifier">lst</span></a></a><span> </span><a name="local-6989586621680018377"><a href="#local-6989586621680018377"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-516"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018377"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-517"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-518"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-519"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#atLength"><span class="hs-identifier hs-var">atLength</span></a><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621680018376"><span class="hs-identifier hs-var">lst</span></a><span> </span><a href="#local-6989586621680018377"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-comment">-- | @(lengthLessThan xs n) == (length xs &lt; n)@</span><span>
</span><a name="line-522"></a><span class="hs-identifier">lengthLessThan</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018095"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-523"></a><a name="lengthLessThan"><a href="Util.html#lengthLessThan"><span class="hs-identifier">lengthLessThan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#atLength"><span class="hs-identifier hs-var">atLength</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-524"></a><span>
</span><a name="line-525"></a><span class="hs-identifier">listLengthCmp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018094"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-526"></a><a name="listLengthCmp"><a href="Util.html#listLengthCmp"><span class="hs-identifier">listLengthCmp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#atLength"><span class="hs-identifier hs-var">atLength</span></a><span> </span><a href="#local-6989586621680018379"><span class="hs-identifier hs-var">atLen</span></a><span> </span><a href="#local-6989586621680018378"><span class="hs-identifier hs-var">atEnd</span></a><span>
</span><a name="line-527"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-528"></a><span>  </span><a name="local-6989586621680018378"><a href="#local-6989586621680018378"><span class="hs-identifier">atEnd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>    </span><span class="hs-comment">-- Not yet seen 'n' elts, so list length is &lt; n.</span><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span>  </span><a name="local-6989586621680018379"><a href="#local-6989586621680018379"><span class="hs-identifier">atLen</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-531"></a><span>  </span><span class="hs-identifier">atLen</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span class="hs-identifier">equalLength</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018092"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018093"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-534"></a><span class="hs-comment">-- ^ True if length xs == length ys</span><span>
</span><a name="line-535"></a><a name="equalLength"><a href="Util.html#equalLength"><span class="hs-identifier">equalLength</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-536"></a><span class="hs-identifier">equalLength</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018380"><a href="#local-6989586621680018380"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018381"><a href="#local-6989586621680018381"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">equalLength</span></a><span> </span><a href="#local-6989586621680018380"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018381"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-537"></a><span class="hs-identifier">equalLength</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-538"></a><span>
</span><a name="line-539"></a><span class="hs-identifier">compareLength</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018090"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018091"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-540"></a><a name="compareLength"><a href="Util.html#compareLength"><span class="hs-identifier">compareLength</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-541"></a><span class="hs-identifier">compareLength</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018382"><a href="#local-6989586621680018382"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018383"><a href="#local-6989586621680018383"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#compareLength"><span class="hs-identifier hs-var">compareLength</span></a><span> </span><a href="#local-6989586621680018382"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018383"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-542"></a><span class="hs-identifier">compareLength</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-543"></a><span class="hs-identifier">compareLength</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-544"></a><span>
</span><a name="line-545"></a><span class="hs-identifier">leLength</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018088"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018089"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-546"></a><span class="hs-comment">-- ^ True if length xs &lt;= length ys</span><span>
</span><a name="line-547"></a><a name="leLength"><a href="Util.html#leLength"><span class="hs-identifier">leLength</span></a></a><span> </span><a name="local-6989586621680018384"><a href="#local-6989586621680018384"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621680018385"><a href="#local-6989586621680018385"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Util.html#compareLength"><span class="hs-identifier hs-var">compareLength</span></a><span> </span><a href="#local-6989586621680018384"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018385"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-548"></a><span>                   </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-549"></a><span>                   </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-550"></a><span>                   </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-551"></a><span>
</span><a name="line-552"></a><span class="hs-identifier">ltLength</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018086"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018087"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-553"></a><span class="hs-comment">-- ^ True if length xs &lt; length ys</span><span>
</span><a name="line-554"></a><a name="ltLength"><a href="Util.html#ltLength"><span class="hs-identifier">ltLength</span></a></a><span> </span><a name="local-6989586621680018386"><a href="#local-6989586621680018386"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621680018387"><a href="#local-6989586621680018387"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Util.html#compareLength"><span class="hs-identifier hs-var">compareLength</span></a><span> </span><a href="#local-6989586621680018386"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018387"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-555"></a><span>                   </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-556"></a><span>                   </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-557"></a><span>                   </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span class="hs-comment">----------------------------</span><span>
</span><a name="line-560"></a><span class="hs-identifier">singleton</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680018085"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018085"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-561"></a><a name="singleton"><a href="Util.html#singleton"><span class="hs-identifier">singleton</span></a></a><span> </span><a name="local-6989586621680018388"><a href="#local-6989586621680018388"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018388"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span class="hs-identifier">isSingleton</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018084"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-564"></a><a name="isSingleton"><a href="Util.html#isSingleton"><span class="hs-identifier">isSingleton</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-565"></a><span class="hs-identifier">isSingleton</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-566"></a><span>
</span><a name="line-567"></a><span class="hs-identifier">notNull</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018083"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-568"></a><a name="notNull"><a href="Util.html#notNull"><span class="hs-identifier">notNull</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-569"></a><span class="hs-identifier">notNull</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span class="hs-identifier">only</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018082"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018082"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-572"></a><span class="hs-cpp">#if defined(DEBUG)
</span><span class="hs-identifier">only</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">a</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-574"></a><span class="hs-cpp">#else
</span><a name="only"><a href="Util.html#only"><span class="hs-identifier">only</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018389"><a href="#local-6989586621680018389"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018389"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-576"></a><span class="hs-cpp">#endif
</span><span class="hs-identifier">only</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PlainPanic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;Util: only&quot;</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span class="hs-comment">-- Debugging/specialising versions of \tr{elem} and \tr{notElem}</span><span>
</span><a name="line-580"></a><span>
</span><a name="line-581"></a><span class="hs-identifier">isIn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isn'tIn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621680018081"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018081"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018081"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-582"></a><span>
</span><a name="line-583"></a><span class="hs-cpp"># ifndef DEBUG
</span><a name="isIn"><a href="Util.html#isIn"><span class="hs-identifier">isIn</span></a></a><span>    </span><a name="local-6989586621680018390"><a href="#local-6989586621680018390"><span class="hs-identifier">_msg</span></a></a><span> </span><a name="local-6989586621680018391"><a href="#local-6989586621680018391"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621680018392"><a href="#local-6989586621680018392"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018391"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680018392"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-585"></a><a name="isn%27tIn"><a href="Util.html#isn%27tIn"><span class="hs-identifier">isn'tIn</span></a></a><span> </span><a name="local-6989586621680018393"><a href="#local-6989586621680018393"><span class="hs-identifier">_msg</span></a></a><span> </span><a name="local-6989586621680018394"><a href="#local-6989586621680018394"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621680018395"><a href="#local-6989586621680018395"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018394"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680018395"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-586"></a><span>
</span><a name="line-587"></a><span class="hs-cpp"># else /* DEBUG */
</span><span class="hs-identifier">isIn</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-589"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">elem100</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-590"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-591"></a><span>    </span><span class="hs-identifier">elem100</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Eq</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">a</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-592"></a><span>    </span><span class="hs-identifier">elem100</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-593"></a><span>    </span><span class="hs-identifier">elem100</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">y</span><span class="hs-glyph">:</span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-594"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-operator">&gt;</span><span> </span><span class="hs-number">100</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span class="hs-identifier">True</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Over-long elem in &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">msg</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">elem</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">y</span><span class="hs-glyph">:</span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-595"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">y</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">elem100</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-596"></a><span>
</span><a name="line-597"></a><span class="hs-identifier">isn'tIn</span><span> </span><span class="hs-identifier">msg</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-598"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">notElem100</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-599"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-600"></a><span>    </span><span class="hs-identifier">notElem100</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Eq</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">a</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-601"></a><span>    </span><span class="hs-identifier">notElem100</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-identifier">True</span><span>
</span><a name="line-602"></a><span>    </span><span class="hs-identifier">notElem100</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">y</span><span class="hs-glyph">:</span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span>
</span><a name="line-603"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-operator">&gt;</span><span> </span><span class="hs-number">100</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span class="hs-identifier">True</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Over-long notElem in &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">msg</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">x</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">y</span><span class="hs-glyph">:</span><span class="hs-identifier">ys</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-604"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">/=</span><span> </span><span class="hs-identifier">y</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">notElem100</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">i</span><span> </span><span class="hs-operator">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">ys</span><span>
</span><a name="line-605"></a><span class="hs-cpp"># endif /* DEBUG */
</span><span>
</span><a name="line-607"></a><span>
</span><a name="line-608"></a><span class="hs-comment">-- | Split a list into chunks of /n/ elements</span><span>
</span><a name="line-609"></a><span class="hs-identifier">chunkList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018080"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621680018080"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-610"></a><a name="chunkList"><a href="Util.html#chunkList"><span class="hs-identifier">chunkList</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-611"></a><span class="hs-identifier">chunkList</span><span> </span><a name="local-6989586621680018396"><a href="#local-6989586621680018396"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680018397"><a href="#local-6989586621680018397"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#chunkList"><span class="hs-identifier hs-var">chunkList</span></a><span> </span><a href="#local-6989586621680018396"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018399"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">as</span><span class="hs-special">,</span><a name="local-6989586621680018399"><a href="#local-6989586621680018399"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621680018396"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018397"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-612"></a><span>
</span><a name="line-613"></a><span class="hs-comment">-- | Replace the last element of a list with another element.</span><span>
</span><a name="line-614"></a><span class="hs-identifier">changeLast</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018079"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018079"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018079"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-615"></a><a name="changeLast"><a href="Util.html#changeLast"><span class="hs-identifier">changeLast</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PlainPanic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;changeLast&quot;</span><span>
</span><a name="line-616"></a><span class="hs-identifier">changeLast</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span>    </span><a name="local-6989586621680018400"><a href="#local-6989586621680018400"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018400"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span>
</span><a name="line-617"></a><span class="hs-identifier">changeLast</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018401"><a href="#local-6989586621680018401"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018402"><a href="#local-6989586621680018402"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680018403"><a href="#local-6989586621680018403"><span class="hs-identifier">x'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018401"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#changeLast"><span class="hs-identifier hs-var">changeLast</span></a><span> </span><a href="#local-6989586621680018402"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018403"><span class="hs-identifier hs-var">x'</span></a><span>
</span><a name="line-618"></a><span>
</span><a name="line-619"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{Sort utils}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-626"></a><span>
</span><a name="line-627"></a><span class="hs-identifier">minWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621680018077"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018078"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018077"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018078"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018078"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-628"></a><a name="minWith"><a href="Util.html#minWith"><span class="hs-identifier">minWith</span></a></a><span> </span><a name="local-6989586621680018404"><a href="#local-6989586621680018404"><span class="hs-identifier">get_key</span></a></a><span> </span><a name="local-6989586621680018405"><a href="#local-6989586621680018405"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">xs</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-629"></a><span>                     </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sortWith</span><span> </span><a href="#local-6989586621680018404"><span class="hs-identifier hs-var">get_key</span></a><span> </span><a href="#local-6989586621680018405"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-630"></a><span>
</span><a name="line-631"></a><span class="hs-identifier">nubSort</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621680018076"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018076"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018076"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-632"></a><a name="nubSort"><a href="Util.html#nubSort"><span class="hs-identifier">nubSort</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.toAscList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Set.fromList</span><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span class="hs-comment">-- | Remove duplicates but keep elements in order.</span><span>
</span><a name="line-635"></a><span class="hs-comment">--   O(n * log n)</span><span>
</span><a name="line-636"></a><span class="hs-identifier">ordNub</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621680018075"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018075"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018075"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-637"></a><a name="ordNub"><a href="Util.html#ordNub"><span class="hs-identifier">ordNub</span></a></a><span> </span><a name="local-6989586621680018406"><a href="#local-6989586621680018406"><span class="hs-identifier">xs</span></a></a><span>
</span><a name="line-638"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018407"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">Set.empty</span><span> </span><a href="#local-6989586621680018406"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-639"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-640"></a><span>    </span><a name="local-6989586621680018407"><a href="#local-6989586621680018407"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-641"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680018408"><a href="#local-6989586621680018408"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018409"><a href="#local-6989586621680018409"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018410"><a href="#local-6989586621680018410"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-642"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Set.member</span><span> </span><a href="#local-6989586621680018409"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680018408"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018407"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018408"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621680018410"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-643"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018409"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680018407"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Set.insert</span><span> </span><a href="#local-6989586621680018409"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680018408"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018410"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-644"></a><span>
</span><a name="line-645"></a><span>
</span><a name="line-646"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Utils-transitive-closure]{Transitive closure}
*                                                                      *
************************************************************************

This algorithm for transitive closure is straightforward, albeit quadratic.
-}</span><span>
</span><a name="line-655"></a><span>
</span><a name="line-656"></a><span class="hs-identifier">transitiveClosure</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018074"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018074"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Successor function</span><span>
</span><a name="line-657"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018074"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018074"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Equality predicate</span><span>
</span><a name="line-658"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018074"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-659"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018074"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>                </span><span class="hs-comment">-- The transitive closure</span><span>
</span><a name="line-660"></a><span>
</span><a name="line-661"></a><a name="transitiveClosure"><a href="Util.html#transitiveClosure"><span class="hs-identifier">transitiveClosure</span></a></a><span> </span><a name="local-6989586621680018411"><a href="#local-6989586621680018411"><span class="hs-identifier">succ</span></a></a><span> </span><a name="local-6989586621680018412"><a href="#local-6989586621680018412"><span class="hs-identifier">eq</span></a></a><span> </span><a name="local-6989586621680018413"><a href="#local-6989586621680018413"><span class="hs-identifier">xs</span></a></a><span>
</span><a name="line-662"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018414"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621680018413"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-663"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-664"></a><span>   </span><a name="local-6989586621680018414"><a href="#local-6989586621680018414"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621680018416"><a href="#local-6989586621680018416"><span class="hs-identifier">done</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018416"><span class="hs-identifier hs-var">done</span></a><span>
</span><a name="line-665"></a><span>   </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680018417"><a href="#local-6989586621680018417"><span class="hs-identifier">done</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018418"><a href="#local-6989586621680018418"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018419"><a href="#local-6989586621680018419"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018418"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621680018415"><span class="hs-identifier hs-var">is_in</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680018417"><span class="hs-identifier hs-var">done</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018414"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018417"><span class="hs-identifier hs-var">done</span></a><span> </span><a href="#local-6989586621680018419"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-666"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018414"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018418"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018417"><span class="hs-identifier hs-var">done</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018411"><span class="hs-identifier hs-var">succ</span></a><span> </span><a href="#local-6989586621680018418"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680018419"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-667"></a><span>
</span><a name="line-668"></a><span>   </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">`</span><a name="local-6989586621680018415"><a href="#local-6989586621680018415"><span class="hs-identifier">is_in</span></a></a><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-669"></a><span>   </span><a name="local-6989586621680018420"><a href="#local-6989586621680018420"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">is_in</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018421"><a href="#local-6989586621680018421"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018422"><a href="#local-6989586621680018422"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018412"><span class="hs-identifier hs-var">eq</span></a><span> </span><a href="#local-6989586621680018420"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680018421"><span class="hs-identifier hs-var">y</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-670"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018420"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621680018415"><span class="hs-identifier hs-var">is_in</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680018422"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Utils-accum]{Accumulating}
*                                                                      *
************************************************************************

A combination of foldl with zip.  It works with equal length lists.
-}</span><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span class="hs-identifier">foldl2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018071"><span class="hs-identifier hs-type">acc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018072"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018073"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018071"><span class="hs-identifier hs-type">acc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018071"><span class="hs-identifier hs-type">acc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018072"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018073"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018071"><span class="hs-identifier hs-type">acc</span></a><span>
</span><a name="line-683"></a><a name="foldl2"><a href="Util.html#foldl2"><span class="hs-identifier">foldl2</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680018423"><a href="#local-6989586621680018423"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018423"><span class="hs-identifier hs-var">z</span></a><span>
</span><a name="line-684"></a><span class="hs-identifier">foldl2</span><span> </span><a name="local-6989586621680018424"><a href="#local-6989586621680018424"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621680018425"><a href="#local-6989586621680018425"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018426"><a href="#local-6989586621680018426"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018428"><a href="#local-6989586621680018428"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018429"><a href="#local-6989586621680018429"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#foldl2"><span class="hs-identifier hs-var">foldl2</span></a><span> </span><a href="#local-6989586621680018424"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018424"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621680018425"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-6989586621680018426"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621680018428"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621680018429"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-685"></a><span class="hs-identifier">foldl2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="PlainPanic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;Util: foldl2&quot;</span><span>
</span><a name="line-686"></a><span>
</span><a name="line-687"></a><span class="hs-identifier">all2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018069"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018070"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018069"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018070"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-688"></a><span class="hs-comment">-- True if the lists are the same length, and</span><span>
</span><a name="line-689"></a><span class="hs-comment">-- all corresponding elements satisfy the predicate</span><span>
</span><a name="line-690"></a><a name="all2"><a href="Util.html#all2"><span class="hs-identifier">all2</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-691"></a><span class="hs-identifier">all2</span><span> </span><a name="local-6989586621680018430"><a href="#local-6989586621680018430"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018431"><a href="#local-6989586621680018431"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018432"><a href="#local-6989586621680018432"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018433"><a href="#local-6989586621680018433"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018434"><a href="#local-6989586621680018434"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018430"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018431"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680018433"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Util.html#all2"><span class="hs-identifier hs-var">all2</span></a><span> </span><a href="#local-6989586621680018430"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018432"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018434"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-692"></a><span class="hs-identifier">all2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span class="hs-comment">-- Count the number of times a predicate is true</span><span>
</span><a name="line-695"></a><span>
</span><a name="line-696"></a><span class="hs-identifier">count</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018068"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018068"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-697"></a><a name="count"><a href="Util.html#count"><span class="hs-identifier">count</span></a></a><span> </span><a name="local-6989586621680018435"><a href="#local-6989586621680018435"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018436"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-698"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680018436"><a href="#local-6989586621680018436"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621680018437"><a href="#local-6989586621680018437"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018437"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-699"></a><span>        </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621680018438"><a href="#local-6989586621680018438"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018439"><a href="#local-6989586621680018439"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018440"><a href="#local-6989586621680018440"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018435"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018439"><span class="hs-identifier hs-var">x</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018436"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018438"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018440"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-700"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018436"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018438"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018440"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-701"></a><span>
</span><a name="line-702"></a><span class="hs-identifier">countWhile</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018067"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018067"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-703"></a><span class="hs-comment">-- Length of an /initial prefix/ of the list satsifying p</span><span>
</span><a name="line-704"></a><a name="countWhile"><a href="Util.html#countWhile"><span class="hs-identifier">countWhile</span></a></a><span> </span><a name="local-6989586621680018441"><a href="#local-6989586621680018441"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018442"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-705"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680018442"><a href="#local-6989586621680018442"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621680018443"><a href="#local-6989586621680018443"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018444"><a href="#local-6989586621680018444"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018445"><a href="#local-6989586621680018445"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018441"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018444"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018442"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018443"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018445"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-706"></a><span>        </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621680018446"><a href="#local-6989586621680018446"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018446"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-707"></a><span>
</span><a name="line-708"></a><span class="hs-comment">{-
@splitAt@, @take@, and @drop@ but with length of another
list giving the break-off point:
-}</span><span>
</span><a name="line-712"></a><span>
</span><a name="line-713"></a><span class="hs-identifier">takeList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018065"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018066"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018066"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-714"></a><span class="hs-comment">-- (takeList as bs) trims bs to the be same length</span><span>
</span><a name="line-715"></a><span class="hs-comment">-- as as, unless as is longer in which case it's a no-op</span><span>
</span><a name="line-716"></a><a name="takeList"><a href="Util.html#takeList"><span class="hs-identifier">takeList</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-717"></a><span class="hs-identifier">takeList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018447"><a href="#local-6989586621680018447"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680018448"><a href="#local-6989586621680018448"><span class="hs-identifier">ls</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-718"></a><span>   </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018448"><span class="hs-identifier hs-var">ls</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-719"></a><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-720"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621680018449"><a href="#local-6989586621680018449"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018450"><a href="#local-6989586621680018450"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018449"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#takeList"><span class="hs-identifier hs-var">takeList</span></a><span> </span><a href="#local-6989586621680018447"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018450"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-721"></a><span>
</span><a name="line-722"></a><span class="hs-identifier">dropList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018063"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018064"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018064"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-723"></a><a name="dropList"><a href="Util.html#dropList"><span class="hs-identifier">dropList</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680018451"><a href="#local-6989586621680018451"><span class="hs-identifier">xs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018451"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-724"></a><span class="hs-identifier">dropList</span><span> </span><span class="hs-identifier">_</span><span>  </span><a name="local-6989586621680018452"><a href="#local-6989586621680018452"><span class="hs-identifier">xs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018452"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-725"></a><span class="hs-identifier">dropList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018453"><a href="#local-6989586621680018453"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018454"><a href="#local-6989586621680018454"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#dropList"><span class="hs-identifier hs-var">dropList</span></a><span> </span><a href="#local-6989586621680018453"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018454"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-726"></a><span>
</span><a name="line-727"></a><span>
</span><a name="line-728"></a><span class="hs-identifier">splitAtList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018061"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018062"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621680018062"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018062"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-729"></a><a name="splitAtList"><a href="Util.html#splitAtList"><span class="hs-identifier">splitAtList</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680018455"><a href="#local-6989586621680018455"><span class="hs-identifier">xs</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018455"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-730"></a><span class="hs-identifier">splitAtList</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680018456"><a href="#local-6989586621680018456"><span class="hs-identifier">xs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018456"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018456"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-731"></a><span class="hs-identifier">splitAtList</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018457"><a href="#local-6989586621680018457"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018458"><a href="#local-6989586621680018458"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018459"><a href="#local-6989586621680018459"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018458"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018460"><span class="hs-identifier hs-var">ys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018461"><span class="hs-identifier hs-var">ys''</span></a><span class="hs-special">)</span><span>
</span><a name="line-732"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-733"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621680018460"><a href="#local-6989586621680018460"><span class="hs-identifier">ys'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018461"><a href="#local-6989586621680018461"><span class="hs-identifier">ys''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a><span> </span><a href="#local-6989586621680018457"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018459"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-734"></a><span>
</span><a name="line-735"></a><span class="hs-comment">-- drop from the end of a list</span><span>
</span><a name="line-736"></a><span class="hs-identifier">dropTail</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018060"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018060"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-737"></a><span class="hs-comment">-- Specification: dropTail n = reverse . drop n . reverse</span><span>
</span><a name="line-738"></a><span class="hs-comment">-- Better implemention due to Joachim Breitner</span><span>
</span><a name="line-739"></a><span class="hs-comment">-- http://www.joachim-breitner.de/blog/archives/600-On-taking-the-last-n-elements-of-a-list.html</span><span>
</span><a name="line-740"></a><a name="dropTail"><a href="Util.html#dropTail"><span class="hs-identifier">dropTail</span></a></a><span> </span><a name="local-6989586621680018462"><a href="#local-6989586621680018462"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680018463"><a href="#local-6989586621680018463"><span class="hs-identifier">xs</span></a></a><span>
</span><a name="line-741"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018464"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-6989586621680018462"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018463"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018463"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-742"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-743"></a><span>    </span><a name="local-6989586621680018464"><a href="#local-6989586621680018464"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018465"><a href="#local-6989586621680018465"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018466"><a href="#local-6989586621680018466"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018467"><a href="#local-6989586621680018467"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018466"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680018464"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018465"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="#local-6989586621680018467"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-744"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Stop when ys runs out</span><span>
</span><a name="line-745"></a><span>                           </span><span class="hs-comment">-- It'll always run out before xs does</span><span>
</span><a name="line-746"></a><span>
</span><a name="line-747"></a><span class="hs-comment">-- dropWhile from the end of a list. This is similar to Data.List.dropWhileEnd,</span><span>
</span><a name="line-748"></a><span class="hs-comment">-- but is lazy in the elements and strict in the spine. For reasonably short lists,</span><span>
</span><a name="line-749"></a><span class="hs-comment">-- such as path names and typical lines of text, dropWhileEndLE is generally</span><span>
</span><a name="line-750"></a><span class="hs-comment">-- faster than dropWhileEnd. Its advantage is magnified when the predicate is</span><span>
</span><a name="line-751"></a><span class="hs-comment">-- expensive--using dropWhileEndLE isSpace to strip the space off a line of text</span><span>
</span><a name="line-752"></a><span class="hs-comment">-- is generally much faster than using dropWhileEnd isSpace for that purpose.</span><span>
</span><a name="line-753"></a><span class="hs-comment">-- Specification: dropWhileEndLE p = reverse . dropWhile p . reverse</span><span>
</span><a name="line-754"></a><span class="hs-comment">-- Pay attention to the short-circuit (&amp;&amp;)! The order of its arguments is the only</span><span>
</span><a name="line-755"></a><span class="hs-comment">-- difference between dropWhileEnd and dropWhileEndLE.</span><span>
</span><a name="line-756"></a><span class="hs-identifier">dropWhileEndLE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018059"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018059"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018059"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-757"></a><a name="dropWhileEndLE"><a href="Util.html#dropWhileEndLE"><span class="hs-identifier">dropWhileEndLE</span></a></a><span> </span><a name="local-6989586621680018468"><a href="#local-6989586621680018468"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680018469"><a href="#local-6989586621680018469"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621680018470"><a href="#local-6989586621680018470"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680018470"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680018468"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018469"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621680018469"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018470"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-758"></a><span>
</span><a name="line-759"></a><span class="hs-comment">-- | @spanEnd p l == reverse (span p (reverse l))@. The first list</span><span>
</span><a name="line-760"></a><span class="hs-comment">-- returns actually comes after the second list (when you look at the</span><span>
</span><a name="line-761"></a><span class="hs-comment">-- input list).</span><span>
</span><a name="line-762"></a><span class="hs-identifier">spanEnd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018058"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018058"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621680018058"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018058"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-763"></a><a name="spanEnd"><a href="Util.html#spanEnd"><span class="hs-identifier">spanEnd</span></a></a><span> </span><a name="local-6989586621680018471"><a href="#local-6989586621680018471"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680018472"><a href="#local-6989586621680018472"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018473"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018472"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621680018472"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-764"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680018473"><a href="#local-6989586621680018473"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621680018474"><a href="#local-6989586621680018474"><span class="hs-identifier">yes</span></a></a><span> </span><a name="local-6989586621680018475"><a href="#local-6989586621680018475"><span class="hs-identifier">_rev_yes</span></a></a><span> </span><a name="local-6989586621680018476"><a href="#local-6989586621680018476"><span class="hs-identifier">rev_no</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018474"><span class="hs-identifier hs-var">yes</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621680018476"><span class="hs-identifier hs-var">rev_no</span></a><span class="hs-special">)</span><span>
</span><a name="line-765"></a><span>        </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680018477"><a href="#local-6989586621680018477"><span class="hs-identifier">yes</span></a></a><span> </span><a name="local-6989586621680018478"><a href="#local-6989586621680018478"><span class="hs-identifier">rev_yes</span></a></a><span>  </span><a name="local-6989586621680018479"><a href="#local-6989586621680018479"><span class="hs-identifier">rev_no</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018480"><a href="#local-6989586621680018480"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018481"><a href="#local-6989586621680018481"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-766"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018471"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018480"><span class="hs-identifier hs-var">x</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018473"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018477"><span class="hs-identifier hs-var">yes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018480"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680018478"><span class="hs-identifier hs-var">rev_yes</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018479"><span class="hs-identifier hs-var">rev_no</span></a><span>                  </span><a href="#local-6989586621680018481"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-767"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018473"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018481"><span class="hs-identifier hs-var">xs</span></a><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>            </span><span class="hs-special">(</span><a href="#local-6989586621680018480"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680018478"><span class="hs-identifier hs-var">rev_yes</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680018479"><span class="hs-identifier hs-var">rev_no</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018481"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-768"></a><span>
</span><a name="line-769"></a><span class="hs-comment">-- | Get the last two elements in a list. Partial!</span><span>
</span><a name="line-770"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">last2</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-771"></a><span class="hs-identifier">last2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018057"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018057"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621680018057"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-772"></a><a name="last2"><a href="Util.html#last2"><span class="hs-identifier">last2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621680018483"><a href="#local-6989586621680018483"><span class="hs-identifier">x2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680018484"><a href="#local-6989586621680018484"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018483"><span class="hs-identifier hs-var">x2</span></a><span class="hs-special">,</span><a href="#local-6989586621680018484"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018482"><span class="hs-identifier hs-var">partialError</span></a><span class="hs-special">,</span><a href="#local-6989586621680018482"><span class="hs-identifier hs-var">partialError</span></a><span class="hs-special">)</span><span>
</span><a name="line-773"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-774"></a><span>    </span><a name="local-6989586621680018482"><a href="#local-6989586621680018482"><span class="hs-identifier">partialError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PlainPanic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;last2 - list length less than two&quot;</span><span>
</span><a name="line-775"></a><span>
</span><a name="line-776"></a><span class="hs-identifier">snocView</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018056"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621680018056"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><a href="#local-6989586621680018056"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>        </span><span class="hs-comment">-- Split off the last element</span><span>
</span><a name="line-778"></a><a name="snocView"><a href="Util.html#snocView"><span class="hs-identifier">snocView</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-779"></a><span class="hs-identifier">snocView</span><span> </span><a name="local-6989586621680018485"><a href="#local-6989586621680018485"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018486"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621680018485"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-780"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-781"></a><span>                </span><span class="hs-comment">-- Invariant: second arg is non-empty</span><span>
</span><a name="line-782"></a><span>              </span><a name="local-6989586621680018486"><a href="#local-6989586621680018486"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621680018487"><a href="#local-6989586621680018487"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621680018488"><a href="#local-6989586621680018488"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621680018487"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018488"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-783"></a><span>              </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680018489"><a href="#local-6989586621680018489"><span class="hs-identifier">acc</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018490"><a href="#local-6989586621680018490"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018491"><a href="#local-6989586621680018491"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018486"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018490"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018489"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018491"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-784"></a><span>              </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="PlainPanic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;Util: snocView&quot;</span><span>
</span><a name="line-785"></a><span>
</span><a name="line-786"></a><span class="hs-identifier">split</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-787"></a><a name="split"><a href="Util.html#split"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621680018492"><a href="#local-6989586621680018492"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621680018493"><a href="#local-6989586621680018493"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018495"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-788"></a><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018494"><span class="hs-identifier hs-var">chunk</span></a><span class="hs-special">]</span><span>
</span><a name="line-789"></a><span>                </span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621680018496"><a href="#local-6989586621680018496"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018494"><span class="hs-identifier hs-var">chunk</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="Util.html#split"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621680018492"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621680018496"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-790"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018494"><a href="#local-6989586621680018494"><span class="hs-identifier">chunk</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018495"><a href="#local-6989586621680018495"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">break</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><a href="#local-6989586621680018492"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018493"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-791"></a><span>
</span><a name="line-792"></a><span class="hs-comment">-- | Convert a word to title case by capitalising the first letter</span><span>
</span><a name="line-793"></a><span class="hs-identifier">capitalise</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-794"></a><a name="capitalise"><a href="Util.html#capitalise"><span class="hs-identifier">capitalise</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-795"></a><span class="hs-identifier">capitalise</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018497"><a href="#local-6989586621680018497"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018498"><a href="#local-6989586621680018498"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toUpper</span><span> </span><a href="#local-6989586621680018497"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680018498"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-796"></a><span>
</span><a name="line-797"></a><span>
</span><a name="line-798"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Utils-comparison]{Comparisons}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-805"></a><span>
</span><a name="line-806"></a><span class="hs-identifier">isEqual</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-807"></a><span class="hs-comment">-- Often used in (isEqual (a `compare` b))</span><span>
</span><a name="line-808"></a><a name="isEqual"><a href="Util.html#isEqual"><span class="hs-identifier">isEqual</span></a></a><span> </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-809"></a><span class="hs-identifier">isEqual</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-810"></a><span class="hs-identifier">isEqual</span><span> </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-811"></a><span>
</span><a name="line-812"></a><span class="hs-identifier">thenCmp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-813"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">thenCmp</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-814"></a><a name="thenCmp"><a href="Util.html#thenCmp"><span class="hs-identifier">thenCmp</span></a></a><span> </span><span class="hs-identifier hs-var">EQ</span><span>       </span><a name="local-6989586621680018499"><a href="#local-6989586621680018499"><span class="hs-identifier">ordering</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018499"><span class="hs-identifier hs-var">ordering</span></a><span>
</span><a name="line-815"></a><span class="hs-identifier">thenCmp</span><span> </span><a name="local-6989586621680018500"><a href="#local-6989586621680018500"><span class="hs-identifier">ordering</span></a></a><span> </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018500"><span class="hs-identifier hs-var">ordering</span></a><span>
</span><a name="line-816"></a><span>
</span><a name="line-817"></a><span class="hs-identifier">eqListBy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018055"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018055"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018055"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018055"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-818"></a><a name="eqListBy"><a href="Util.html#eqListBy"><span class="hs-identifier">eqListBy</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-819"></a><span class="hs-identifier">eqListBy</span><span> </span><a name="local-6989586621680018501"><a href="#local-6989586621680018501"><span class="hs-identifier">eq</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018502"><a href="#local-6989586621680018502"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018503"><a href="#local-6989586621680018503"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018504"><a href="#local-6989586621680018504"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018505"><a href="#local-6989586621680018505"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018501"><span class="hs-identifier hs-var">eq</span></a><span> </span><a href="#local-6989586621680018502"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680018504"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Util.html#eqListBy"><span class="hs-identifier hs-var">eqListBy</span></a><span> </span><a href="#local-6989586621680018501"><span class="hs-identifier hs-var">eq</span></a><span> </span><a href="#local-6989586621680018503"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018505"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-820"></a><span class="hs-identifier">eqListBy</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-821"></a><span>
</span><a name="line-822"></a><span class="hs-identifier">eqMaybeBy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018054"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><a href="#local-6989586621680018054"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621680018054"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621680018054"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-823"></a><a name="eqMaybeBy"><a href="Util.html#eqMaybeBy"><span class="hs-identifier">eqMaybeBy</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-824"></a><span class="hs-identifier">eqMaybeBy</span><span> </span><a name="local-6989586621680018506"><a href="#local-6989586621680018506"><span class="hs-identifier">eq</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680018507"><a href="#local-6989586621680018507"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680018508"><a href="#local-6989586621680018508"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018506"><span class="hs-identifier hs-var">eq</span></a><span> </span><a href="#local-6989586621680018507"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680018508"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-825"></a><span class="hs-identifier">eqMaybeBy</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>        </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span class="hs-identifier">cmpList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018053"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018053"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018053"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018053"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-828"></a><span>    </span><span class="hs-comment">-- `cmpList' uses a user-specified comparer</span><span>
</span><a name="line-829"></a><span>
</span><a name="line-830"></a><a name="cmpList"><a href="Util.html#cmpList"><span class="hs-identifier">cmpList</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-831"></a><span class="hs-identifier">cmpList</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-832"></a><span class="hs-identifier">cmpList</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-833"></a><span class="hs-identifier">cmpList</span><span> </span><a name="local-6989586621680018509"><a href="#local-6989586621680018509"><span class="hs-identifier">cmp</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018510"><a href="#local-6989586621680018510"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018512"><a href="#local-6989586621680018512"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018513"><a href="#local-6989586621680018513"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-834"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018509"><span class="hs-identifier hs-var">cmp</span></a><span> </span><a href="#local-6989586621680018510"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621680018512"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Util.html#cmpList"><span class="hs-identifier hs-var">cmpList</span></a><span> </span><a href="#local-6989586621680018509"><span class="hs-identifier hs-var">cmp</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621680018513"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">;</span><span> </span><a name="local-6989586621680018514"><a href="#local-6989586621680018514"><span class="hs-identifier">xxx</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018514"><span class="hs-identifier hs-var">xxx</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-835"></a><span>
</span><a name="line-836"></a><span class="hs-identifier">removeSpaces</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-837"></a><a name="removeSpaces"><a href="Util.html#removeSpaces"><span class="hs-identifier">removeSpaces</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#dropWhileEndLE"><span class="hs-identifier hs-var">dropWhileEndLE</span></a><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span>
</span><a name="line-838"></a><span>
</span><a name="line-839"></a><span class="hs-comment">-- Boolean operators lifted to Applicative</span><span>
</span><a name="line-840"></a><span class="hs-special">(</span><span class="hs-operator">&lt;&amp;&amp;&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-6989586621680018052"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680018052"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018052"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018052"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-841"></a><span class="hs-special">(</span><a name="%3C%26%26%3E"><a href="Util.html#%3C%26%26%3E"><span class="hs-operator">&lt;&amp;&amp;&gt;</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;&amp;</span><span class="hs-special">)</span><span>
</span><a name="line-842"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">3</span><span> </span><a href="Util.html#%3C%26%26%3E"><span class="hs-operator hs-var">&lt;&amp;&amp;&gt;</span></a><span> </span><span class="hs-comment">-- same as (&amp;&amp;)</span><span>
</span><a name="line-843"></a><span>
</span><a name="line-844"></a><span class="hs-special">(</span><span class="hs-operator">&lt;||&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="#local-6989586621680018051"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680018051"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018051"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018051"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-845"></a><span class="hs-special">(</span><a name="%3C%7C%7C%3E"><a href="Util.html#%3C%7C%7C%3E"><span class="hs-operator">&lt;||&gt;</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftA2</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">||</span><span class="hs-special">)</span><span>
</span><a name="line-846"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">2</span><span> </span><a href="Util.html#%3C%7C%7C%3E"><span class="hs-operator hs-var">&lt;||&gt;</span></a><span> </span><span class="hs-comment">-- same as (||)</span><span>
</span><a name="line-847"></a><span>
</span><a name="line-848"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Edit distance}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-855"></a><span>
</span><a name="line-856"></a><span class="hs-comment">-- | Find the &quot;restricted&quot; Damerau-Levenshtein edit distance between two strings.</span><span>
</span><a name="line-857"></a><span class="hs-comment">-- See: &lt;http://en.wikipedia.org/wiki/Damerau-Levenshtein_distance&gt;.</span><span>
</span><a name="line-858"></a><span class="hs-comment">-- Based on the algorithm presented in &quot;A Bit-Vector Algorithm for Computing</span><span>
</span><a name="line-859"></a><span class="hs-comment">-- Levenshtein and Damerau Edit Distances&quot; in PSC'02 (Heikki Hyyro).</span><span>
</span><a name="line-860"></a><span class="hs-comment">-- See http://www.cs.uta.fi/~helmu/pubs/psc02.pdf and</span><span>
</span><a name="line-861"></a><span class="hs-comment">--     http://www.cs.uta.fi/~helmu/pubs/PSCerr.html for an explanation</span><span>
</span><a name="line-862"></a><span class="hs-identifier">restrictedDamerauLevenshteinDistance</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-863"></a><a name="restrictedDamerauLevenshteinDistance"><a href="Util.html#restrictedDamerauLevenshteinDistance"><span class="hs-identifier">restrictedDamerauLevenshteinDistance</span></a></a><span> </span><a name="local-6989586621680018515"><a href="#local-6989586621680018515"><span class="hs-identifier">str1</span></a></a><span> </span><a name="local-6989586621680018516"><a href="#local-6989586621680018516"><span class="hs-identifier">str2</span></a></a><span>
</span><a name="line-864"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#restrictedDamerauLevenshteinDistanceWithLengths"><span class="hs-identifier hs-var">restrictedDamerauLevenshteinDistanceWithLengths</span></a><span> </span><a href="#local-6989586621680018517"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621680018518"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018515"><span class="hs-identifier hs-var">str1</span></a><span> </span><a href="#local-6989586621680018516"><span class="hs-identifier hs-var">str2</span></a><span>
</span><a name="line-865"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-866"></a><span>    </span><a name="local-6989586621680018517"><a href="#local-6989586621680018517"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680018515"><span class="hs-identifier hs-var">str1</span></a><span>
</span><a name="line-867"></a><span>    </span><a name="local-6989586621680018518"><a href="#local-6989586621680018518"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680018516"><span class="hs-identifier hs-var">str2</span></a><span>
</span><a name="line-868"></a><span>
</span><a name="line-869"></a><span class="hs-identifier">restrictedDamerauLevenshteinDistanceWithLengths</span><span>
</span><a name="line-870"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-871"></a><a name="restrictedDamerauLevenshteinDistanceWithLengths"><a href="Util.html#restrictedDamerauLevenshteinDistanceWithLengths"><span class="hs-identifier">restrictedDamerauLevenshteinDistanceWithLengths</span></a></a><span> </span><a name="local-6989586621680018519"><a href="#local-6989586621680018519"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680018520"><a href="#local-6989586621680018520"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680018521"><a href="#local-6989586621680018521"><span class="hs-identifier">str1</span></a></a><span> </span><a name="local-6989586621680018522"><a href="#local-6989586621680018522"><span class="hs-identifier">str2</span></a></a><span>
</span><a name="line-872"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018519"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621680018520"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-873"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680018520"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">32</span><span> </span><span class="hs-comment">-- n must be larger so this check is sufficient</span><span>
</span><a name="line-874"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="Util.html#restrictedDamerauLevenshteinDistance%27"><span class="hs-identifier hs-var">restrictedDamerauLevenshteinDistance'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018519"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621680018520"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018521"><span class="hs-identifier hs-var">str1</span></a><span> </span><a href="#local-6989586621680018522"><span class="hs-identifier hs-var">str2</span></a><span>
</span><a name="line-875"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="Util.html#restrictedDamerauLevenshteinDistance%27"><span class="hs-identifier hs-var">restrictedDamerauLevenshteinDistance'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018519"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621680018520"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018521"><span class="hs-identifier hs-var">str1</span></a><span> </span><a href="#local-6989586621680018522"><span class="hs-identifier hs-var">str2</span></a><span>
</span><a name="line-876"></a><span>
</span><a name="line-877"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-878"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680018519"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">32</span><span> </span><span class="hs-comment">-- m must be larger so this check is sufficient</span><span>
</span><a name="line-879"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="Util.html#restrictedDamerauLevenshteinDistance%27"><span class="hs-identifier hs-var">restrictedDamerauLevenshteinDistance'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018520"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018519"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621680018522"><span class="hs-identifier hs-var">str2</span></a><span> </span><a href="#local-6989586621680018521"><span class="hs-identifier hs-var">str1</span></a><span>
</span><a name="line-880"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="Util.html#restrictedDamerauLevenshteinDistance%27"><span class="hs-identifier hs-var">restrictedDamerauLevenshteinDistance'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018520"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018519"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621680018522"><span class="hs-identifier hs-var">str2</span></a><span> </span><a href="#local-6989586621680018521"><span class="hs-identifier hs-var">str1</span></a><span>
</span><a name="line-881"></a><span>
</span><a name="line-882"></a><span class="hs-identifier">restrictedDamerauLevenshteinDistance'</span><span>
</span><a name="line-883"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bits</span><span> </span><a href="#local-6989586621680018050"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621680018050"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680018050"><span class="hs-identifier hs-type">bv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-884"></a><a name="restrictedDamerauLevenshteinDistance%27"><a href="Util.html#restrictedDamerauLevenshteinDistance%27"><span class="hs-identifier">restrictedDamerauLevenshteinDistance'</span></a></a><span> </span><a name="local-6989586621680018523"><a href="#local-6989586621680018523"><span class="hs-identifier">_bv_dummy</span></a></a><span> </span><a name="local-6989586621680018524"><a href="#local-6989586621680018524"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680018525"><a href="#local-6989586621680018525"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680018526"><a href="#local-6989586621680018526"><span class="hs-identifier">str1</span></a></a><span> </span><a name="local-6989586621680018527"><a href="#local-6989586621680018527"><span class="hs-identifier">str2</span></a></a><span>
</span><a name="line-885"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018526"><span class="hs-identifier hs-var">str1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018525"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-886"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018531"><span class="hs-identifier hs-var">extractAnswer</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-887"></a><span>                 </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="Util.html#restrictedDamerauLevenshteinDistanceWorker"><span class="hs-identifier hs-var">restrictedDamerauLevenshteinDistanceWorker</span></a><span>
</span><a name="line-888"></a><span>                             </span><span class="hs-special">(</span><a href="Util.html#matchVectors"><span class="hs-identifier hs-var">matchVectors</span></a><span> </span><a href="#local-6989586621680018526"><span class="hs-identifier hs-var">str1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018530"><span class="hs-identifier hs-var">top_bit_mask</span></a><span> </span><a href="#local-6989586621680018529"><span class="hs-identifier hs-var">vector_mask</span></a><span class="hs-special">)</span><span>
</span><a name="line-889"></a><span>                        </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018528"><span class="hs-identifier hs-var">m_ones</span></a><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018524"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018527"><span class="hs-identifier hs-var">str2</span></a><span>
</span><a name="line-890"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-891"></a><span>    </span><a name="local-6989586621680018528"><a href="#local-6989586621680018528"><span class="hs-identifier">m_ones</span></a></a><span class="hs-glyph">@</span><a name="local-6989586621680018529"><a href="#local-6989586621680018529"><span class="hs-identifier">vector_mask</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">^</span><span> </span><a href="#local-6989586621680018524"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-892"></a><span>    </span><a name="local-6989586621680018530"><a href="#local-6989586621680018530"><span class="hs-identifier">top_bit_mask</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018524"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">asTypeOf</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680018523"><span class="hs-identifier hs-var">_bv_dummy</span></a><span>
</span><a name="line-893"></a><span>    </span><a name="local-6989586621680018531"><a href="#local-6989586621680018531"><span class="hs-identifier">extractAnswer</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680018532"><a href="#local-6989586621680018532"><span class="hs-identifier">distance</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018532"><span class="hs-identifier hs-var">distance</span></a><span>
</span><a name="line-894"></a><span>
</span><a name="line-895"></a><span class="hs-identifier">restrictedDamerauLevenshteinDistanceWorker</span><span>
</span><a name="line-896"></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bits</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">IM.IntMap</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span>
</span><a name="line-897"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018049"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-898"></a><a name="restrictedDamerauLevenshteinDistanceWorker"><a href="Util.html#restrictedDamerauLevenshteinDistanceWorker"><span class="hs-identifier">restrictedDamerauLevenshteinDistanceWorker</span></a></a><span> </span><a name="local-6989586621680018533"><a href="#local-6989586621680018533"><span class="hs-identifier">str1_mvs</span></a></a><span> </span><a name="local-6989586621680018534"><a href="#local-6989586621680018534"><span class="hs-identifier">top_bit_mask</span></a></a><span> </span><a name="local-6989586621680018535"><a href="#local-6989586621680018535"><span class="hs-identifier">vector_mask</span></a></a><span>
</span><a name="line-899"></a><span>                                           </span><span class="hs-special">(</span><a name="local-6989586621680018536"><a href="#local-6989586621680018536"><span class="hs-identifier">pm</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018537"><a href="#local-6989586621680018537"><span class="hs-identifier">d0</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018538"><a href="#local-6989586621680018538"><span class="hs-identifier">vp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018539"><a href="#local-6989586621680018539"><span class="hs-identifier">vn</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018540"><a href="#local-6989586621680018540"><span class="hs-identifier">distance</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680018541"><a href="#local-6989586621680018541"><span class="hs-identifier">char2</span></a></a><span>
</span><a name="line-900"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018533"><span class="hs-identifier hs-var">str1_mvs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018534"><span class="hs-identifier hs-var">top_bit_mask</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018535"><span class="hs-identifier hs-var">vector_mask</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-901"></a><span>    </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018542"><span class="hs-identifier hs-var">pm'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018543"><span class="hs-identifier hs-var">d0'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018548"><span class="hs-identifier hs-var">vp'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018549"><span class="hs-identifier hs-var">vn'</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-902"></a><span>    </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018551"><span class="hs-identifier hs-var">distance''</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018541"><span class="hs-identifier hs-var">char2</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-903"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621680018542"><span class="hs-identifier hs-var">pm'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018543"><span class="hs-identifier hs-var">d0'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018548"><span class="hs-identifier hs-var">vp'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018549"><span class="hs-identifier hs-var">vn'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018551"><span class="hs-identifier hs-var">distance''</span></a><span class="hs-special">)</span><span>
</span><a name="line-904"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-905"></a><span>    </span><a name="local-6989586621680018542"><a href="#local-6989586621680018542"><span class="hs-identifier">pm'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IM.findWithDefault</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621680018541"><span class="hs-identifier hs-var">char2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018533"><span class="hs-identifier hs-var">str1_mvs</span></a><span>
</span><a name="line-906"></a><span>
</span><a name="line-907"></a><span>    </span><a name="local-6989586621680018543"><a href="#local-6989586621680018543"><span class="hs-identifier">d0'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Util.html#sizedComplement"><span class="hs-identifier hs-var">sizedComplement</span></a><span> </span><a href="#local-6989586621680018535"><span class="hs-identifier hs-var">vector_mask</span></a><span> </span><a href="#local-6989586621680018537"><span class="hs-identifier hs-var">d0</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621680018542"><span class="hs-identifier hs-var">pm'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621680018536"><span class="hs-identifier hs-var">pm</span></a><span class="hs-special">)</span><span>
</span><a name="line-908"></a><span>      </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621680018542"><span class="hs-identifier hs-var">pm'</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621680018538"><span class="hs-identifier hs-var">vp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680018538"><span class="hs-identifier hs-var">vp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621680018535"><span class="hs-identifier hs-var">vector_mask</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680018538"><span class="hs-identifier hs-var">vp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621680018542"><span class="hs-identifier hs-var">pm'</span></a><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621680018539"><span class="hs-identifier hs-var">vn</span></a><span>
</span><a name="line-909"></a><span>          </span><span class="hs-comment">-- No need to mask the shiftL because of the restricted range of pm</span><span>
</span><a name="line-910"></a><span>
</span><a name="line-911"></a><span>    </span><a name="local-6989586621680018544"><a href="#local-6989586621680018544"><span class="hs-identifier">hp'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018539"><span class="hs-identifier hs-var">vn</span></a><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="Util.html#sizedComplement"><span class="hs-identifier hs-var">sizedComplement</span></a><span> </span><a href="#local-6989586621680018535"><span class="hs-identifier hs-var">vector_mask</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018543"><span class="hs-identifier hs-var">d0'</span></a><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621680018538"><span class="hs-identifier hs-var">vp</span></a><span class="hs-special">)</span><span>
</span><a name="line-912"></a><span>    </span><a name="local-6989586621680018545"><a href="#local-6989586621680018545"><span class="hs-identifier">hn'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018543"><span class="hs-identifier hs-var">d0'</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621680018538"><span class="hs-identifier hs-var">vp</span></a><span>
</span><a name="line-913"></a><span>
</span><a name="line-914"></a><span>    </span><a name="local-6989586621680018546"><a href="#local-6989586621680018546"><span class="hs-identifier">hp'_shift</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621680018544"><span class="hs-identifier hs-var">hp'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621680018535"><span class="hs-identifier hs-var">vector_mask</span></a><span>
</span><a name="line-915"></a><span>    </span><a name="local-6989586621680018547"><a href="#local-6989586621680018547"><span class="hs-identifier">hn'_shift</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018545"><span class="hs-identifier hs-var">hn'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621680018535"><span class="hs-identifier hs-var">vector_mask</span></a><span>
</span><a name="line-916"></a><span>    </span><a name="local-6989586621680018548"><a href="#local-6989586621680018548"><span class="hs-identifier">vp'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018547"><span class="hs-identifier hs-var">hn'_shift</span></a><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="Util.html#sizedComplement"><span class="hs-identifier hs-var">sizedComplement</span></a><span> </span><a href="#local-6989586621680018535"><span class="hs-identifier hs-var">vector_mask</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018543"><span class="hs-identifier hs-var">d0'</span></a><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621680018546"><span class="hs-identifier hs-var">hp'_shift</span></a><span class="hs-special">)</span><span>
</span><a name="line-917"></a><span>    </span><a name="local-6989586621680018549"><a href="#local-6989586621680018549"><span class="hs-identifier">vn'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018543"><span class="hs-identifier hs-var">d0'</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621680018546"><span class="hs-identifier hs-var">hp'_shift</span></a><span>
</span><a name="line-918"></a><span>
</span><a name="line-919"></a><span>    </span><a name="local-6989586621680018550"><a href="#local-6989586621680018550"><span class="hs-identifier">distance'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680018544"><span class="hs-identifier hs-var">hp'</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621680018534"><span class="hs-identifier hs-var">top_bit_mask</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621680018540"><span class="hs-identifier hs-var">distance</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621680018540"><span class="hs-identifier hs-var">distance</span></a><span>
</span><a name="line-920"></a><span>    </span><a name="local-6989586621680018551"><a href="#local-6989586621680018551"><span class="hs-identifier">distance''</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680018545"><span class="hs-identifier hs-var">hn'</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621680018534"><span class="hs-identifier hs-var">top_bit_mask</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621680018550"><span class="hs-identifier hs-var">distance'</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621680018550"><span class="hs-identifier hs-var">distance'</span></a><span>
</span><a name="line-921"></a><span>
</span><a name="line-922"></a><span class="hs-identifier">sizedComplement</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bits</span><span> </span><a href="#local-6989586621680018048"><span class="hs-identifier hs-type">bv</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680018048"><span class="hs-identifier hs-type">bv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018048"><span class="hs-identifier hs-type">bv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018048"><span class="hs-identifier hs-type">bv</span></a><span>
</span><a name="line-923"></a><a name="sizedComplement"><a href="Util.html#sizedComplement"><span class="hs-identifier">sizedComplement</span></a></a><span> </span><a name="local-6989586621680018552"><a href="#local-6989586621680018552"><span class="hs-identifier">vector_mask</span></a></a><span> </span><a name="local-6989586621680018553"><a href="#local-6989586621680018553"><span class="hs-identifier">vect</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018552"><span class="hs-identifier hs-var">vector_mask</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680018553"><span class="hs-identifier hs-var">vect</span></a><span>
</span><a name="line-924"></a><span>
</span><a name="line-925"></a><span class="hs-identifier">matchVectors</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bits</span><span> </span><a href="#local-6989586621680018047"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621680018047"><span class="hs-identifier hs-type">bv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IM.IntMap</span><span> </span><a href="#local-6989586621680018047"><span class="hs-identifier hs-type">bv</span></a><span>
</span><a name="line-926"></a><a name="matchVectors"><a href="Util.html#matchVectors"><span class="hs-identifier">matchVectors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621680018554"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">IM.empty</span><span class="hs-special">)</span><span>
</span><a name="line-927"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-928"></a><span>    </span><a name="local-6989586621680018554"><a href="#local-6989586621680018554"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018555"><a href="#local-6989586621680018555"><span class="hs-identifier">ix</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018556"><a href="#local-6989586621680018556"><span class="hs-identifier">im</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680018557"><a href="#local-6989586621680018557"><span class="hs-identifier">char</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680018558"><a href="#local-6989586621680018558"><span class="hs-identifier">ix'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018555"><span class="hs-identifier hs-var">ix</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-929"></a><span>                           </span><a name="local-6989586621680018559"><a href="#local-6989586621680018559"><span class="hs-identifier">im'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IM.insertWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621680018557"><span class="hs-identifier hs-var">char</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">^</span><span> </span><a href="#local-6989586621680018555"><span class="hs-identifier hs-var">ix</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018556"><span class="hs-identifier hs-var">im</span></a><span>
</span><a name="line-930"></a><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018558"><span class="hs-identifier hs-var">ix'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621680018559"><span class="hs-identifier hs-var">im'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018558"><span class="hs-identifier hs-var">ix'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018559"><span class="hs-identifier hs-var">im'</span></a><span class="hs-special">)</span><span>
</span><a name="line-931"></a><span>
</span><a name="line-932"></a><span class="hs-pragma">{-# SPECIALIZE INLINE</span><span> </span><span class="hs-pragma">restrictedDamerauLevenshteinDistance'</span><span>
</span><a name="line-933"></a><span>                      </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">Word32</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Int</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Int</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">String</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">String</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Int</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-934"></a><span class="hs-pragma">{-# SPECIALIZE INLINE</span><span> </span><span class="hs-pragma">restrictedDamerauLevenshteinDistance'</span><span>
</span><a name="line-935"></a><span>                      </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">Integer</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Int</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Int</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">String</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">String</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Int</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-936"></a><span>
</span><a name="line-937"></a><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">restrictedDamerauLevenshteinDistanceWorker</span><span>
</span><a name="line-938"></a><span>               </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">IM.IntMap</span><span> </span><span class="hs-pragma">Word32</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Word32</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Word32</span><span>
</span><a name="line-939"></a><span>               </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">Word32</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Word32</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Word32</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Word32</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Int</span><span class="hs-pragma">)</span><span>
</span><a name="line-940"></a><span>               </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Char</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">Word32</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Word32</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Word32</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Word32</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Int</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-941"></a><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">restrictedDamerauLevenshteinDistanceWorker</span><span>
</span><a name="line-942"></a><span>               </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">IM.IntMap</span><span> </span><span class="hs-pragma">Integer</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Integer</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Integer</span><span>
</span><a name="line-943"></a><span>               </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">Integer</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Integer</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Integer</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Integer</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Int</span><span class="hs-pragma">)</span><span>
</span><a name="line-944"></a><span>               </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Char</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">Integer</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Integer</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Integer</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Integer</span><span class="hs-pragma">,</span><span> </span><span class="hs-pragma">Int</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-945"></a><span>
</span><a name="line-946"></a><span class="hs-pragma">{-# SPECIALIZE INLINE</span><span> </span><span class="hs-pragma">sizedComplement</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">Word32</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Word32</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Word32</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-947"></a><span class="hs-pragma">{-# SPECIALIZE INLINE</span><span> </span><span class="hs-pragma">sizedComplement</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">Integer</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Integer</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">Integer</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-948"></a><span>
</span><a name="line-949"></a><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">matchVectors</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">String</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">IM.IntMap</span><span> </span><span class="hs-pragma">Word32</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-950"></a><span class="hs-pragma">{-# SPECIALIZE</span><span> </span><span class="hs-pragma">matchVectors</span><span> </span><span class="hs-pragma">::</span><span> </span><span class="hs-pragma">String</span><span> </span><span class="hs-pragma">-&gt;</span><span> </span><span class="hs-pragma">IM.IntMap</span><span> </span><span class="hs-pragma">Integer</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-951"></a><span>
</span><a name="line-952"></a><span class="hs-identifier">fuzzyMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-953"></a><a name="fuzzyMatch"><a href="Util.html#fuzzyMatch"><span class="hs-identifier">fuzzyMatch</span></a></a><span> </span><a name="local-6989586621680018560"><a href="#local-6989586621680018560"><span class="hs-identifier">key</span></a></a><span> </span><a name="local-6989586621680018561"><a href="#local-6989586621680018561"><span class="hs-identifier">vals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#fuzzyLookup"><span class="hs-identifier hs-var">fuzzyLookup</span></a><span> </span><a href="#local-6989586621680018560"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680018562"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><a href="#local-6989586621680018562"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680018562"><a href="#local-6989586621680018562"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018561"><span class="hs-identifier hs-var">vals</span></a><span class="hs-special">]</span><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><span class="hs-comment">-- | Search for possible matches to the users input in the given list,</span><span>
</span><a name="line-956"></a><span class="hs-comment">-- returning a small number of ranked results</span><span>
</span><a name="line-957"></a><span class="hs-identifier">fuzzyLookup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><a href="#local-6989586621680018046"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018046"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-958"></a><a name="fuzzyLookup"><a href="Util.html#fuzzyLookup"><span class="hs-identifier">fuzzyLookup</span></a></a><span> </span><a name="local-6989586621680018563"><a href="#local-6989586621680018563"><span class="hs-identifier">user_entered</span></a></a><span> </span><a name="local-6989586621680018564"><a href="#local-6989586621680018564"><span class="hs-identifier">possibilites</span></a></a><span>
</span><a name="line-959"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621680018566"><span class="hs-identifier hs-var">mAX_RESULTS</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comparing</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span>
</span><a name="line-960"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018568"><span class="hs-identifier hs-var">poss_val</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018569"><span class="hs-identifier hs-var">distance</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018567"><a href="#local-6989586621680018567"><span class="hs-identifier">poss_str</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018568"><a href="#local-6989586621680018568"><span class="hs-identifier">poss_val</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018564"><span class="hs-identifier hs-var">possibilites</span></a><span>
</span><a name="line-961"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680018569"><a href="#local-6989586621680018569"><span class="hs-identifier">distance</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#restrictedDamerauLevenshteinDistance"><span class="hs-identifier hs-var">restrictedDamerauLevenshteinDistance</span></a><span>
</span><a name="line-962"></a><span>                                            </span><a href="#local-6989586621680018567"><span class="hs-identifier hs-var">poss_str</span></a><span> </span><a href="#local-6989586621680018563"><span class="hs-identifier hs-var">user_entered</span></a><span>
</span><a name="line-963"></a><span>                       </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018569"><span class="hs-identifier hs-var">distance</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621680018565"><span class="hs-identifier hs-var">fuzzy_threshold</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-964"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-965"></a><span>    </span><span class="hs-comment">-- Work out an approriate match threshold:</span><span>
</span><a name="line-966"></a><span>    </span><span class="hs-comment">-- We report a candidate if its edit distance is &lt;= the threshold,</span><span>
</span><a name="line-967"></a><span>    </span><span class="hs-comment">-- The threshold is set to about a quarter of the # of characters the user entered</span><span>
</span><a name="line-968"></a><span>    </span><span class="hs-comment">--   Length    Threshold</span><span>
</span><a name="line-969"></a><span>    </span><span class="hs-comment">--     1         0          -- Don't suggest *any* candidates</span><span>
</span><a name="line-970"></a><span>    </span><span class="hs-comment">--     2         1          -- for single-char identifiers</span><span>
</span><a name="line-971"></a><span>    </span><span class="hs-comment">--     3         1</span><span>
</span><a name="line-972"></a><span>    </span><span class="hs-comment">--     4         1</span><span>
</span><a name="line-973"></a><span>    </span><span class="hs-comment">--     5         1</span><span>
</span><a name="line-974"></a><span>    </span><span class="hs-comment">--     6         2</span><span>
</span><a name="line-975"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-976"></a><span>    </span><a name="local-6989586621680018565"><a href="#local-6989586621680018565"><span class="hs-identifier">fuzzy_threshold</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">truncate</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680018563"><span class="hs-identifier hs-var">user_entered</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-special">(</span><span class="hs-number">4</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Rational</span><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span>    </span><a name="local-6989586621680018566"><a href="#local-6989586621680018566"><span class="hs-identifier">mAX_RESULTS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-978"></a><span>
</span><a name="line-979"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Utils-pairs]{Pairs}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-986"></a><span>
</span><a name="line-987"></a><span class="hs-identifier">unzipWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018043"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018044"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018045"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680018043"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018044"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018045"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-988"></a><a name="unzipWith"><a href="Util.html#unzipWith"><span class="hs-identifier">unzipWith</span></a></a><span> </span><a name="local-6989586621680018570"><a href="#local-6989586621680018570"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621680018571"><a href="#local-6989586621680018571"><span class="hs-identifier">pairs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018572"><a href="#local-6989586621680018572"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018573"><a href="#local-6989586621680018573"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018570"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018572"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621680018573"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018571"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-989"></a><span>
</span><a name="line-990"></a><span class="hs-identifier">seqList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018041"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018042"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018042"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-991"></a><a name="seqList"><a href="Util.html#seqList"><span class="hs-identifier">seqList</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680018574"><a href="#local-6989586621680018574"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018574"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-992"></a><span class="hs-identifier">seqList</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018575"><a href="#local-6989586621680018575"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018576"><a href="#local-6989586621680018576"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680018577"><a href="#local-6989586621680018577"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018575"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Util.html#seqList"><span class="hs-identifier hs-var">seqList</span></a><span> </span><a href="#local-6989586621680018576"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018577"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-993"></a><span>
</span><a name="line-994"></a><span>
</span><a name="line-995"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        Globals and the RTS
*                                                                      *
************************************************************************

When a plugin is loaded, it currently gets linked against a *newly
loaded* copy of the GHC package. This would not be a problem, except
that the new copy has its own mutable state that is not shared with
that state that has already been initialized by the original GHC
package.

(Note that if the GHC executable was dynamically linked this
wouldn't be a problem, because we could share the GHC library it
links to; this is only a problem if DYNAMIC_GHC_PROGRAMS=NO.)

The solution is to make use of @sharedCAF@ through @sharedGlobal@
for globals that are shared between multiple copies of ghc packages.
-}</span><span>
</span><a name="line-1015"></a><span>
</span><a name="line-1016"></a><span class="hs-comment">-- Global variables:</span><span>
</span><a name="line-1017"></a><span>
</span><a name="line-1018"></a><span class="hs-identifier">global</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680018040"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621680018040"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1019"></a><a name="global"><a href="Util.html#global"><span class="hs-identifier">global</span></a></a><span> </span><a name="local-6989586621680018578"><a href="#local-6989586621680018578"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafePerformIO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">newIORef</span><span> </span><a href="#local-6989586621680018578"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-1020"></a><span>
</span><a name="line-1021"></a><span class="hs-identifier">consIORef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018039"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018039"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1022"></a><a name="consIORef"><a href="Util.html#consIORef"><span class="hs-identifier">consIORef</span></a></a><span> </span><a name="local-6989586621680018579"><a href="#local-6989586621680018579"><span class="hs-identifier">var</span></a></a><span> </span><a name="local-6989586621680018580"><a href="#local-6989586621680018580"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1023"></a><span>  </span><span class="hs-identifier hs-var">atomicModifyIORef'</span><span> </span><a href="#local-6989586621680018579"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680018581"><a href="#local-6989586621680018581"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018580"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018581"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1024"></a><span>
</span><a name="line-1025"></a><span class="hs-identifier">globalM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621680018038"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621680018038"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1026"></a><a name="globalM"><a href="Util.html#globalM"><span class="hs-identifier">globalM</span></a></a><span> </span><a name="local-6989586621680018582"><a href="#local-6989586621680018582"><span class="hs-identifier">ma</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafePerformIO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018582"><span class="hs-identifier hs-var">ma</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span class="hs-special">)</span><span>
</span><a name="line-1027"></a><span>
</span><a name="line-1028"></a><span class="hs-comment">-- Shared global variables:</span><span>
</span><a name="line-1029"></a><span>
</span><a name="line-1030"></a><span class="hs-identifier">sharedGlobal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680018037"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621680018037"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621680018037"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621680018037"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1031"></a><a name="sharedGlobal"><a href="Util.html#sharedGlobal"><span class="hs-identifier">sharedGlobal</span></a></a><span> </span><a name="local-6989586621680018583"><a href="#local-6989586621680018583"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621680018584"><a href="#local-6989586621680018584"><span class="hs-identifier">get_or_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafePerformIO</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1032"></a><span>  </span><span class="hs-identifier hs-var">newIORef</span><span> </span><a href="#local-6989586621680018583"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">sharedCAF</span><span> </span><a href="#local-6989586621680018584"><span class="hs-identifier hs-var">get_or_set</span></a><span>
</span><a name="line-1033"></a><span>
</span><a name="line-1034"></a><span class="hs-identifier">sharedGlobalM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621680018036"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621680018036"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621680018036"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621680018036"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1035"></a><a name="sharedGlobalM"><a href="Util.html#sharedGlobalM"><span class="hs-identifier">sharedGlobalM</span></a></a><span> </span><a name="local-6989586621680018585"><a href="#local-6989586621680018585"><span class="hs-identifier">ma</span></a></a><span> </span><a name="local-6989586621680018586"><a href="#local-6989586621680018586"><span class="hs-identifier">get_or_set</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unsafePerformIO</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1036"></a><span>  </span><a href="#local-6989586621680018585"><span class="hs-identifier hs-var">ma</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">sharedCAF</span><span> </span><a href="#local-6989586621680018586"><span class="hs-identifier hs-var">get_or_set</span></a><span>
</span><a name="line-1037"></a><span>
</span><a name="line-1038"></a><span class="hs-comment">-- Module names:</span><span>
</span><a name="line-1039"></a><span>
</span><a name="line-1040"></a><span class="hs-identifier">looksLikeModuleName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1041"></a><a name="looksLikeModuleName"><a href="Util.html#looksLikeModuleName"><span class="hs-identifier">looksLikeModuleName</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1042"></a><span class="hs-identifier">looksLikeModuleName</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018587"><a href="#local-6989586621680018587"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018588"><a href="#local-6989586621680018588"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isUpper</span><span> </span><a href="#local-6989586621680018587"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680018589"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018588"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-1043"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680018589"><a href="#local-6989586621680018589"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1044"></a><span>        </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-char">'.'</span><span class="hs-glyph">:</span><a name="local-6989586621680018590"><a href="#local-6989586621680018590"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#looksLikeModuleName"><span class="hs-identifier hs-var">looksLikeModuleName</span></a><span> </span><a href="#local-6989586621680018590"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-1045"></a><span>        </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018591"><a href="#local-6989586621680018591"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018592"><a href="#local-6989586621680018592"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isAlphaNum</span><span> </span><a href="#local-6989586621680018591"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621680018591"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'_'</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621680018591"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'\''</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680018589"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680018592"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-1046"></a><span>
</span><a name="line-1047"></a><span class="hs-comment">-- Similar to 'parse' for Distribution.Package.PackageName,</span><span>
</span><a name="line-1048"></a><span class="hs-comment">-- but we don't want to depend on Cabal.</span><span>
</span><a name="line-1049"></a><span class="hs-identifier">looksLikePackageName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1050"></a><a name="looksLikePackageName"><a href="Util.html#looksLikePackageName"><span class="hs-identifier">looksLikePackageName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier hs-var">isAlphaNum</span><span> </span><a href="Util.html#%3C%26%26%3E"><span class="hs-operator hs-var">&lt;&amp;&amp;&gt;</span></a><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier hs-var">isDigit</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Util.html#split"><span class="hs-identifier hs-var">split</span></a><span> </span><span class="hs-char">'-'</span><span>
</span><a name="line-1051"></a><span>
</span><a name="line-1052"></a><span class="hs-comment">{-
Akin to @Prelude.words@, but acts like the Bourne shell, treating
quoted strings as Haskell Strings, and also parses Haskell [String]
syntax.
-}</span><span>
</span><a name="line-1057"></a><span>
</span><a name="line-1058"></a><span class="hs-identifier">getCmd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span>             </span><span class="hs-comment">-- Error</span><span>
</span><a name="line-1059"></a><span>                           </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (Cmd, Rest)</span><span>
</span><a name="line-1060"></a><a name="getCmd"><a href="Util.html#getCmd"><span class="hs-identifier">getCmd</span></a></a><span> </span><a name="local-6989586621680018593"><a href="#local-6989586621680018593"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">break</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621680018593"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1061"></a><span>           </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Couldn't find command in &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680018593"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1062"></a><span>           </span><a name="local-6989586621680018594"><a href="#local-6989586621680018594"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621680018594"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1063"></a><span>
</span><a name="line-1064"></a><span class="hs-identifier">toCmdArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span>             </span><span class="hs-comment">-- Error</span><span>
</span><a name="line-1065"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (Cmd, Args)</span><span>
</span><a name="line-1066"></a><a name="toCmdArgs"><a href="Util.html#toCmdArgs"><span class="hs-identifier">toCmdArgs</span></a></a><span> </span><a name="local-6989586621680018595"><a href="#local-6989586621680018595"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Util.html#getCmd"><span class="hs-identifier hs-var">getCmd</span></a><span> </span><a href="#local-6989586621680018595"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1067"></a><span>              </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621680018596"><a href="#local-6989586621680018596"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621680018596"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-1068"></a><span>              </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018597"><a href="#local-6989586621680018597"><span class="hs-identifier">cmd</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018598"><a href="#local-6989586621680018598"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Util.html#toArgs"><span class="hs-identifier hs-var">toArgs</span></a><span> </span><a href="#local-6989586621680018598"><span class="hs-identifier hs-var">s'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1069"></a><span>                                 </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621680018599"><a href="#local-6989586621680018599"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621680018599"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-1070"></a><span>                                 </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621680018600"><a href="#local-6989586621680018600"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018597"><span class="hs-identifier hs-var">cmd</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018600"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1071"></a><span>
</span><a name="line-1072"></a><span class="hs-identifier">toArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span>   </span><span class="hs-comment">-- Error</span><span>
</span><a name="line-1073"></a><span>                           </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Args</span><span>
</span><a name="line-1074"></a><a name="toArgs"><a href="Util.html#toArgs"><span class="hs-identifier">toArgs</span></a></a><span> </span><a name="local-6989586621680018601"><a href="#local-6989586621680018601"><span class="hs-identifier">str</span></a></a><span>
</span><a name="line-1075"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621680018601"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1076"></a><span>      </span><a name="local-6989586621680018617"><a href="#local-6989586621680018617"><span class="hs-identifier">s</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-char">'['</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">reads</span><span> </span><a href="#local-6989586621680018617"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1077"></a><span>                   </span><span class="hs-special">[</span><span class="hs-special">(</span><a name="local-6989586621680018618"><a href="#local-6989586621680018618"><span class="hs-identifier">args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018619"><a href="#local-6989586621680018619"><span class="hs-identifier">spaces</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1078"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621680018619"><span class="hs-identifier hs-var">spaces</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1079"></a><span>                       </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621680018618"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1080"></a><span>                   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1081"></a><span>                       </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Couldn't read &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680018601"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; as [String]&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1082"></a><span>      </span><a name="local-6989586621680018620"><a href="#local-6989586621680018620"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018602"><span class="hs-identifier hs-var">toArgs'</span></a><span> </span><a href="#local-6989586621680018620"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1083"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1084"></a><span>  </span><span class="hs-identifier">toArgs'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-1085"></a><span>  </span><span class="hs-comment">-- Remove outer quotes:</span><span>
</span><a name="line-1086"></a><span>  </span><span class="hs-comment">-- &gt; toArgs' &quot;\&quot;foo\&quot; \&quot;bar baz\&quot;&quot;</span><span>
</span><a name="line-1087"></a><span>  </span><span class="hs-comment">-- Right [&quot;foo&quot;, &quot;bar baz&quot;]</span><span>
</span><a name="line-1088"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1089"></a><span>  </span><span class="hs-comment">-- Keep inner quotes:</span><span>
</span><a name="line-1090"></a><span>  </span><span class="hs-comment">-- &gt; toArgs' &quot;-DFOO=\&quot;bar baz\&quot;&quot;</span><span>
</span><a name="line-1091"></a><span>  </span><span class="hs-comment">-- Right [&quot;-DFOO=\&quot;bar baz\&quot;&quot;]</span><span>
</span><a name="line-1092"></a><span>  </span><a name="local-6989586621680018602"><a href="#local-6989586621680018602"><span class="hs-identifier">toArgs'</span></a></a><span> </span><a name="local-6989586621680018604"><a href="#local-6989586621680018604"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621680018604"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1093"></a><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1094"></a><span>              </span><span class="hs-special">(</span><span class="hs-char">'&quot;'</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1095"></a><span>                    </span><span class="hs-comment">-- readAsString removes outer quotes</span><span>
</span><a name="line-1096"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621680018605"><a href="#local-6989586621680018605"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018606"><a href="#local-6989586621680018606"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018603"><span class="hs-identifier hs-var">readAsString</span></a><span> </span><a href="#local-6989586621680018604"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1097"></a><span>                    </span><span class="hs-special">(</span><a href="#local-6989586621680018605"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680018602"><span class="hs-identifier hs-var">toArgs'</span></a><span> </span><a href="#local-6989586621680018606"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-1098"></a><span>              </span><a name="local-6989586621680018607"><a href="#local-6989586621680018607"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">break</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="Util.html#%3C%7C%7C%3E"><span class="hs-operator hs-var">&lt;||&gt;</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'&quot;'</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018607"><span class="hs-identifier hs-var">s'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1099"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621680018608"><a href="#local-6989586621680018608"><span class="hs-identifier">argPart1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018609"><a href="#local-6989586621680018609"><span class="hs-identifier">s''</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-char">'&quot;'</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1100"></a><span>                        </span><span class="hs-special">(</span><a name="local-6989586621680018610"><a href="#local-6989586621680018610"><span class="hs-identifier">argPart2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018611"><a href="#local-6989586621680018611"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018603"><span class="hs-identifier hs-var">readAsString</span></a><span> </span><a href="#local-6989586621680018609"><span class="hs-identifier hs-var">s''</span></a><span>
</span><a name="line-1101"></a><span>                        </span><span class="hs-comment">-- show argPart2 to keep inner quotes</span><span>
</span><a name="line-1102"></a><span>                        </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621680018608"><span class="hs-identifier hs-var">argPart1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680018610"><span class="hs-identifier hs-var">argPart2</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680018602"><span class="hs-identifier hs-var">toArgs'</span></a><span> </span><a href="#local-6989586621680018611"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-1103"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621680018612"><a href="#local-6989586621680018612"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018613"><a href="#local-6989586621680018613"><span class="hs-identifier">s''</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018612"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680018602"><span class="hs-identifier hs-var">toArgs'</span></a><span> </span><a href="#local-6989586621680018613"><span class="hs-identifier hs-var">s''</span></a><span>
</span><a name="line-1104"></a><span>
</span><a name="line-1105"></a><span>  </span><span class="hs-identifier">readAsString</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-1106"></a><span>  </span><a name="local-6989586621680018603"><a href="#local-6989586621680018603"><span class="hs-identifier">readAsString</span></a></a><span> </span><a name="local-6989586621680018614"><a href="#local-6989586621680018614"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">reads</span><span> </span><a href="#local-6989586621680018614"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1107"></a><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><a name="local-6989586621680018615"><a href="#local-6989586621680018615"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018616"><a href="#local-6989586621680018616"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1108"></a><span>                    </span><span class="hs-comment">-- rest must either be [] or start with a space</span><span>
</span><a name="line-1109"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621680018616"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1110"></a><span>                    </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018615"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018616"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">)</span><span>
</span><a name="line-1111"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1112"></a><span>                    </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Couldn't read &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680018614"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; as String&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1113"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-1114"></a><span class="hs-comment">-- Integers</span><span>
</span><a name="line-1115"></a><span>
</span><a name="line-1116"></a><span class="hs-comment">-- This algorithm for determining the $\log_2$ of exact powers of 2 comes</span><span>
</span><a name="line-1117"></a><span class="hs-comment">-- from GCC.  It requires bit manipulation primitives, and we use GHC</span><span>
</span><a name="line-1118"></a><span class="hs-comment">-- extensions.  Tough.</span><span>
</span><a name="line-1119"></a><span>
</span><a name="line-1120"></a><span class="hs-identifier">exactLog2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-1121"></a><a name="exactLog2"><a href="Util.html#exactLog2"><span class="hs-identifier">exactLog2</span></a></a><span> </span><a name="local-6989586621680018621"><a href="#local-6989586621680018621"><span class="hs-identifier">x</span></a></a><span>
</span><a name="line-1122"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018621"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621680018621"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">2147483648</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-1123"></a><span>       </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1124"></a><span>    </span><span class="hs-keyword">else</span><span>
</span><a name="line-1125"></a><span>       </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018621"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621680018621"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621680018621"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-1126"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1127"></a><span>       </span><span class="hs-keyword">else</span><span>
</span><a name="line-1128"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018622"><span class="hs-identifier hs-var">pow2</span></a><span> </span><a href="#local-6989586621680018621"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1129"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1130"></a><span>    </span><a name="local-6989586621680018622"><a href="#local-6989586621680018622"><span class="hs-identifier">pow2</span></a></a><span> </span><a name="local-6989586621680018623"><a href="#local-6989586621680018623"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018623"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1131"></a><span>           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680018622"><span class="hs-identifier hs-var">pow2</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018623"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1132"></a><span>
</span><a name="line-1133"></a><span>
</span><a name="line-1134"></a><span class="hs-comment">{-
-- -----------------------------------------------------------------------------
-- Floats
-}</span><span>
</span><a name="line-1138"></a><span>
</span><a name="line-1139"></a><span class="hs-identifier">readRational__</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ReadS</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-comment">-- NB: doesn't handle leading &quot;-&quot;</span><span>
</span><a name="line-1140"></a><a name="readRational__"><a href="Util.html#readRational__"><span class="hs-identifier">readRational__</span></a></a><span> </span><a name="local-6989586621680018624"><a href="#local-6989586621680018624"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1141"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621680018665"><a href="#local-6989586621680018665"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018666"><a href="#local-6989586621680018666"><span class="hs-identifier">d</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018667"><a href="#local-6989586621680018667"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018625"><span class="hs-identifier hs-var">readFix</span></a><span> </span><a href="#local-6989586621680018624"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1142"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621680018668"><a href="#local-6989586621680018668"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018669"><a href="#local-6989586621680018669"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018626"><span class="hs-identifier hs-var">readExp</span></a><span> </span><a href="#local-6989586621680018667"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1143"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621680018665"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">%</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-operator hs-var">*</span><span class="hs-number">10</span><span class="hs-operator hs-var">^^</span><span class="hs-special">(</span><a href="#local-6989586621680018668"><span class="hs-identifier hs-var">k</span></a><span class="hs-glyph">-</span><a href="#local-6989586621680018666"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018669"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1144"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1145"></a><span>     </span><a name="local-6989586621680018625"><a href="#local-6989586621680018625"><span class="hs-identifier">readFix</span></a></a><span> </span><a name="local-6989586621680018633"><a href="#local-6989586621680018633"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1146"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680018634"><a href="#local-6989586621680018634"><span class="hs-identifier">ds</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018635"><a href="#local-6989586621680018635"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018629"><span class="hs-identifier hs-var">lexDecDigits</span></a><span> </span><a href="#local-6989586621680018633"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1147"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680018636"><a href="#local-6989586621680018636"><span class="hs-identifier">ds'</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018637"><a href="#local-6989586621680018637"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018630"><span class="hs-identifier hs-var">lexDotDigits</span></a><span> </span><a href="#local-6989586621680018635"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1148"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">read</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018634"><span class="hs-identifier hs-var">ds</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621680018636"><span class="hs-identifier hs-var">ds'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680018636"><span class="hs-identifier hs-var">ds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018637"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1149"></a><span>
</span><a name="line-1150"></a><span>     </span><a name="local-6989586621680018626"><a href="#local-6989586621680018626"><span class="hs-identifier">readExp</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018638"><a href="#local-6989586621680018638"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018639"><a href="#local-6989586621680018639"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018638"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;eE&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018627"><span class="hs-identifier hs-var">readExp'</span></a><span> </span><a href="#local-6989586621680018639"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1151"></a><span>     </span><span class="hs-identifier">readExp</span><span> </span><a name="local-6989586621680018640"><a href="#local-6989586621680018640"><span class="hs-identifier">s</span></a></a><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><a href="#local-6989586621680018640"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1152"></a><span>
</span><a name="line-1153"></a><span>     </span><a name="local-6989586621680018627"><a href="#local-6989586621680018627"><span class="hs-identifier">readExp'</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-char">'+'</span><span class="hs-glyph">:</span><a name="local-6989586621680018641"><a href="#local-6989586621680018641"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018628"><span class="hs-identifier hs-var">readDec</span></a><span> </span><a href="#local-6989586621680018641"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1154"></a><span>     </span><span class="hs-identifier">readExp'</span><span> </span><span class="hs-special">(</span><span class="hs-char">'-'</span><span class="hs-glyph">:</span><a name="local-6989586621680018642"><a href="#local-6989586621680018642"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018643"><a href="#local-6989586621680018643"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018644"><a href="#local-6989586621680018644"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018628"><span class="hs-identifier hs-var">readDec</span></a><span> </span><a href="#local-6989586621680018642"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1155"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621680018643"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><a href="#local-6989586621680018644"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1156"></a><span>     </span><span class="hs-identifier">readExp'</span><span> </span><a name="local-6989586621680018645"><a href="#local-6989586621680018645"><span class="hs-identifier">s</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018628"><span class="hs-identifier hs-var">readDec</span></a><span> </span><a href="#local-6989586621680018645"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1157"></a><span>
</span><a name="line-1158"></a><span>     </span><a name="local-6989586621680018628"><a href="#local-6989586621680018628"><span class="hs-identifier">readDec</span></a></a><span> </span><a name="local-6989586621680018646"><a href="#local-6989586621680018646"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1159"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680018647"><a href="#local-6989586621680018647"><span class="hs-identifier">ds</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018648"><a href="#local-6989586621680018648"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018631"><span class="hs-identifier hs-var">nonnull</span></a><span> </span><span class="hs-identifier hs-var">isDigit</span><span> </span><a href="#local-6989586621680018646"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1160"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldl1</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680018649"><a href="#local-6989586621680018649"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680018650"><a href="#local-6989586621680018650"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018649"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">10</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680018650"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621680018651"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-char">'0'</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680018651"><a href="#local-6989586621680018651"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680018647"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1161"></a><span>                </span><a href="#local-6989586621680018648"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1162"></a><span>
</span><a name="line-1163"></a><span>     </span><a name="local-6989586621680018629"><a href="#local-6989586621680018629"><span class="hs-identifier">lexDecDigits</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018631"><span class="hs-identifier hs-var">nonnull</span></a><span> </span><span class="hs-identifier hs-var">isDigit</span><span>
</span><a name="line-1164"></a><span>
</span><a name="line-1165"></a><span>     </span><a name="local-6989586621680018630"><a href="#local-6989586621680018630"><span class="hs-identifier">lexDotDigits</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-char">'.'</span><span class="hs-glyph">:</span><a name="local-6989586621680018652"><a href="#local-6989586621680018652"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018632"><span class="hs-identifier hs-var">span'</span></a><span> </span><span class="hs-identifier hs-var">isDigit</span><span> </span><a href="#local-6989586621680018652"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1166"></a><span>     </span><span class="hs-identifier">lexDotDigits</span><span> </span><a name="local-6989586621680018653"><a href="#local-6989586621680018653"><span class="hs-identifier">s</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">,</span><a href="#local-6989586621680018653"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1167"></a><span>
</span><a name="line-1168"></a><span>     </span><a name="local-6989586621680018631"><a href="#local-6989586621680018631"><span class="hs-identifier">nonnull</span></a></a><span> </span><a name="local-6989586621680018654"><a href="#local-6989586621680018654"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680018655"><a href="#local-6989586621680018655"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018656"><a href="#local-6989586621680018656"><span class="hs-identifier">cs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><a name="local-6989586621680018657"><a href="#local-6989586621680018657"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018632"><span class="hs-identifier hs-var">span'</span></a><span> </span><a href="#local-6989586621680018654"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018655"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1169"></a><span>                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018656"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">,</span><a href="#local-6989586621680018657"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-1170"></a><span>
</span><a name="line-1171"></a><span>     </span><a name="local-6989586621680018632"><a href="#local-6989586621680018632"><span class="hs-identifier">span'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680018658"><a href="#local-6989586621680018658"><span class="hs-identifier">xs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><a href="#local-6989586621680018658"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018658"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1172"></a><span>     </span><span class="hs-identifier">span'</span><span> </span><a name="local-6989586621680018659"><a href="#local-6989586621680018659"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680018660"><a href="#local-6989586621680018660"><span class="hs-identifier">xs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621680018661"><a href="#local-6989586621680018661"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018662"><a href="#local-6989586621680018662"><span class="hs-identifier">xs'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1173"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018661"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'_'</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018632"><span class="hs-identifier hs-var">span'</span></a><span> </span><a href="#local-6989586621680018659"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018662"><span class="hs-identifier hs-var">xs'</span></a><span>   </span><span class="hs-comment">-- skip &quot;_&quot; (#14473)</span><span>
</span><a name="line-1174"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018659"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018661"><span class="hs-identifier hs-var">x</span></a><span>       </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018663"><a href="#local-6989586621680018663"><span class="hs-identifier">ys</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018664"><a href="#local-6989586621680018664"><span class="hs-identifier">zs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018632"><span class="hs-identifier hs-var">span'</span></a><span> </span><a href="#local-6989586621680018659"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018662"><span class="hs-identifier hs-var">xs'</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018661"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018663"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">,</span><a href="#local-6989586621680018664"><span class="hs-identifier hs-var">zs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1175"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><a href="#local-6989586621680018660"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1176"></a><span>
</span><a name="line-1177"></a><span class="hs-identifier">readRational</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-comment">-- NB: *does* handle a leading &quot;-&quot;</span><span>
</span><a name="line-1178"></a><a name="readRational"><a href="Util.html#readRational"><span class="hs-identifier">readRational</span></a></a><span> </span><a name="local-6989586621680018670"><a href="#local-6989586621680018670"><span class="hs-identifier">top_s</span></a></a><span>
</span><a name="line-1179"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018670"><span class="hs-identifier hs-var">top_s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1180"></a><span>      </span><span class="hs-char">'-'</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018675"><a href="#local-6989586621680018675"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018671"><span class="hs-identifier hs-var">read_me</span></a><span> </span><a href="#local-6989586621680018675"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1181"></a><span>      </span><a name="local-6989586621680018676"><a href="#local-6989586621680018676"><span class="hs-identifier">xs</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018671"><span class="hs-identifier hs-var">read_me</span></a><span> </span><a href="#local-6989586621680018676"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-1182"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1183"></a><span>    </span><a name="local-6989586621680018671"><a href="#local-6989586621680018671"><span class="hs-identifier">read_me</span></a></a><span> </span><a name="local-6989586621680018672"><a href="#local-6989586621680018672"><span class="hs-identifier">s</span></a></a><span>
</span><a name="line-1184"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018673"><a href="#local-6989586621680018673"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Util.html#readRational__"><span class="hs-identifier hs-var">readRational__</span></a><span> </span><a href="#local-6989586621680018672"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621680018673"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1185"></a><span>          </span><span class="hs-special">[</span><a name="local-6989586621680018674"><a href="#local-6989586621680018674"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018674"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1186"></a><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;readRational: no parse:&quot;</span><span>        </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680018670"><span class="hs-identifier hs-var">top_s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1187"></a><span>          </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;readRational: ambiguous parse:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680018670"><span class="hs-identifier hs-var">top_s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1188"></a><span>
</span><a name="line-1189"></a><span>
</span><a name="line-1190"></a><span class="hs-identifier">readHexRational</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span>
</span><a name="line-1191"></a><a name="readHexRational"><a href="Util.html#readHexRational"><span class="hs-identifier">readHexRational</span></a></a><span> </span><a name="local-6989586621680018677"><a href="#local-6989586621680018677"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1192"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018677"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1193"></a><span>    </span><span class="hs-char">'-'</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018681"><a href="#local-6989586621680018681"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018678"><span class="hs-identifier hs-var">readMe</span></a><span> </span><a href="#local-6989586621680018681"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1194"></a><span>    </span><a name="local-6989586621680018682"><a href="#local-6989586621680018682"><span class="hs-identifier">xs</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018678"><span class="hs-identifier hs-var">readMe</span></a><span> </span><a href="#local-6989586621680018682"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-1195"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1196"></a><span>  </span><a name="local-6989586621680018678"><a href="#local-6989586621680018678"><span class="hs-identifier">readMe</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1197"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Util.html#readHexRational__"><span class="hs-identifier hs-var">readHexRational__</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1198"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680018680"><a href="#local-6989586621680018680"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680018680"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1199"></a><span>      </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;readHexRational: no parse:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680018677"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>
</span><a name="line-1200"></a><span>
</span><a name="line-1201"></a><span>
</span><a name="line-1202"></a><span class="hs-identifier">readHexRational__</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Rational</span><span>
</span><a name="line-1203"></a><a name="readHexRational__"><a href="Util.html#readHexRational__"><span class="hs-identifier">readHexRational__</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-char">'0'</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018683"><a href="#local-6989586621680018683"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018684"><a href="#local-6989586621680018684"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1204"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018683"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'X'</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621680018683"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'x'</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1205"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018713"><a href="#local-6989586621680018713"><span class="hs-identifier">front</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018714"><a href="#local-6989586621680018714"><span class="hs-identifier">rest2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018691"><span class="hs-identifier hs-var">span'</span></a><span> </span><span class="hs-identifier hs-var">isHexDigit</span><span> </span><a href="#local-6989586621680018684"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-1206"></a><span>     </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680018713"><span class="hs-identifier hs-var">front</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1207"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680018715"><a href="#local-6989586621680018715"><span class="hs-identifier">frontNum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018689"><span class="hs-identifier hs-var">steps</span></a><span> </span><span class="hs-number">16</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621680018713"><span class="hs-identifier hs-var">front</span></a><span>
</span><a name="line-1208"></a><span>     </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018714"><span class="hs-identifier hs-var">rest2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1209"></a><span>       </span><span class="hs-char">'.'</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018716"><a href="#local-6989586621680018716"><span class="hs-identifier">rest3</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1210"></a><span>          </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018717"><a href="#local-6989586621680018717"><span class="hs-identifier">back</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018718"><a href="#local-6989586621680018718"><span class="hs-identifier">rest4</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018691"><span class="hs-identifier hs-var">span'</span></a><span> </span><span class="hs-identifier hs-var">isHexDigit</span><span> </span><a href="#local-6989586621680018716"><span class="hs-identifier hs-var">rest3</span></a><span>
</span><a name="line-1211"></a><span>             </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680018717"><span class="hs-identifier hs-var">back</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1212"></a><span>             </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680018719"><a href="#local-6989586621680018719"><span class="hs-identifier">backNum</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018689"><span class="hs-identifier hs-var">steps</span></a><span> </span><span class="hs-number">16</span><span> </span><a href="#local-6989586621680018715"><span class="hs-identifier hs-var">frontNum</span></a><span> </span><a href="#local-6989586621680018717"><span class="hs-identifier hs-var">back</span></a><span>
</span><a name="line-1213"></a><span>                 </span><a name="local-6989586621680018720"><a href="#local-6989586621680018720"><span class="hs-identifier">exp1</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">4</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680018717"><span class="hs-identifier hs-var">back</span></a><span>
</span><a name="line-1214"></a><span>             </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018718"><span class="hs-identifier hs-var">rest4</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1215"></a><span>               </span><a name="local-6989586621680018721"><a href="#local-6989586621680018721"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018722"><a href="#local-6989586621680018722"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018685"><span class="hs-identifier hs-var">isExp</span></a><span> </span><a href="#local-6989586621680018721"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018687"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621680018719"><span class="hs-identifier hs-var">backNum</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680018720"><span class="hs-identifier hs-var">exp1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018686"><span class="hs-identifier hs-var">getExp</span></a><span> </span><a href="#local-6989586621680018722"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1216"></a><span>               </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018687"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621680018719"><span class="hs-identifier hs-var">backNum</span></a><span> </span><a href="#local-6989586621680018720"><span class="hs-identifier hs-var">exp1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span>       </span><a name="local-6989586621680018723"><a href="#local-6989586621680018723"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018724"><a href="#local-6989586621680018724"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018685"><span class="hs-identifier hs-var">isExp</span></a><span> </span><a href="#local-6989586621680018723"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018687"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621680018715"><span class="hs-identifier hs-var">frontNum</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018686"><span class="hs-identifier hs-var">getExp</span></a><span> </span><a href="#local-6989586621680018724"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">)</span><span>
</span><a name="line-1218"></a><span>       </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1219"></a><span>
</span><a name="line-1220"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1221"></a><span>  </span><a name="local-6989586621680018685"><a href="#local-6989586621680018685"><span class="hs-identifier">isExp</span></a></a><span> </span><a name="local-6989586621680018692"><a href="#local-6989586621680018692"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018692"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'p'</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621680018692"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'P'</span><span>
</span><a name="line-1222"></a><span>
</span><a name="line-1223"></a><span>  </span><a name="local-6989586621680018686"><a href="#local-6989586621680018686"><span class="hs-identifier">getExp</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-char">'+'</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018693"><a href="#local-6989586621680018693"><span class="hs-identifier">ds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018688"><span class="hs-identifier hs-var">dec</span></a><span> </span><a href="#local-6989586621680018693"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1224"></a><span>  </span><span class="hs-identifier">getExp</span><span> </span><span class="hs-special">(</span><span class="hs-char">'-'</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018694"><a href="#local-6989586621680018694"><span class="hs-identifier">ds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018688"><span class="hs-identifier hs-var">dec</span></a><span> </span><a href="#local-6989586621680018694"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1225"></a><span>  </span><span class="hs-identifier">getExp</span><span> </span><a name="local-6989586621680018695"><a href="#local-6989586621680018695"><span class="hs-identifier">ds</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018688"><span class="hs-identifier hs-var">dec</span></a><span> </span><a href="#local-6989586621680018695"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1226"></a><span>
</span><a name="line-1227"></a><span>  </span><span class="hs-identifier">mk</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span>
</span><a name="line-1228"></a><span>  </span><a name="local-6989586621680018687"><a href="#local-6989586621680018687"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621680018696"><a href="#local-6989586621680018696"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680018697"><a href="#local-6989586621680018697"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621680018696"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">2</span><span class="hs-operator hs-var">^^</span><a href="#local-6989586621680018697"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1229"></a><span>
</span><a name="line-1230"></a><span>  </span><a name="local-6989586621680018688"><a href="#local-6989586621680018688"><span class="hs-identifier">dec</span></a></a><span> </span><a name="local-6989586621680018698"><a href="#local-6989586621680018698"><span class="hs-identifier">cs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018691"><span class="hs-identifier hs-var">span'</span></a><span> </span><span class="hs-identifier hs-var">isDigit</span><span> </span><a href="#local-6989586621680018698"><span class="hs-identifier hs-var">cs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1231"></a><span>             </span><span class="hs-special">(</span><a name="local-6989586621680018699"><a href="#local-6989586621680018699"><span class="hs-identifier">ds</span></a></a><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680018699"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018689"><span class="hs-identifier hs-var">steps</span></a><span> </span><span class="hs-number">10</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621680018699"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1232"></a><span>             </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1233"></a><span>
</span><a name="line-1234"></a><span>  </span><a name="local-6989586621680018689"><a href="#local-6989586621680018689"><span class="hs-identifier">steps</span></a></a><span> </span><a name="local-6989586621680018700"><a href="#local-6989586621680018700"><span class="hs-identifier">base</span></a></a><span> </span><a name="local-6989586621680018701"><a href="#local-6989586621680018701"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680018702"><a href="#local-6989586621680018702"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018690"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621680018700"><span class="hs-identifier hs-var">base</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680018701"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680018702"><span class="hs-identifier hs-var">ds</span></a><span>
</span><a name="line-1235"></a><span>  </span><a name="local-6989586621680018690"><a href="#local-6989586621680018690"><span class="hs-identifier">step</span></a></a><span>  </span><a name="local-6989586621680018703"><a href="#local-6989586621680018703"><span class="hs-identifier">base</span></a></a><span> </span><a name="local-6989586621680018704"><a href="#local-6989586621680018704"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680018705"><a href="#local-6989586621680018705"><span class="hs-identifier">d</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018703"><span class="hs-identifier hs-var">base</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621680018704"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">digitToInt</span><span> </span><a href="#local-6989586621680018705"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-1236"></a><span>
</span><a name="line-1237"></a><span>  </span><a name="local-6989586621680018691"><a href="#local-6989586621680018691"><span class="hs-identifier">span'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680018706"><a href="#local-6989586621680018706"><span class="hs-identifier">xs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><a href="#local-6989586621680018706"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680018706"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1238"></a><span>  </span><span class="hs-identifier">span'</span><span> </span><a name="local-6989586621680018707"><a href="#local-6989586621680018707"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680018708"><a href="#local-6989586621680018708"><span class="hs-identifier">xs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621680018709"><a href="#local-6989586621680018709"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680018710"><a href="#local-6989586621680018710"><span class="hs-identifier">xs'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1239"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018709"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'_'</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018691"><span class="hs-identifier hs-var">span'</span></a><span> </span><a href="#local-6989586621680018707"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018710"><span class="hs-identifier hs-var">xs'</span></a><span>   </span><span class="hs-comment">-- skip &quot;_&quot;  (#14473)</span><span>
</span><a name="line-1240"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018707"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018709"><span class="hs-identifier hs-var">x</span></a><span>       </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018711"><a href="#local-6989586621680018711"><span class="hs-identifier">ys</span></a></a><span class="hs-special">,</span><a name="local-6989586621680018712"><a href="#local-6989586621680018712"><span class="hs-identifier">zs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018691"><span class="hs-identifier hs-var">span'</span></a><span> </span><a href="#local-6989586621680018707"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680018710"><span class="hs-identifier hs-var">xs'</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018709"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018711"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">,</span><a href="#local-6989586621680018712"><span class="hs-identifier hs-var">zs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1241"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><a href="#local-6989586621680018708"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1242"></a><span>
</span><a name="line-1243"></a><span class="hs-identifier">readHexRational__</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1244"></a><span>
</span><a name="line-1245"></a><span>
</span><a name="line-1246"></a><span>
</span><a name="line-1247"></a><span>
</span><a name="line-1248"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-1249"></a><span class="hs-comment">-- read helpers</span><span>
</span><a name="line-1250"></a><span>
</span><a name="line-1251"></a><span class="hs-identifier">maybeRead</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Read</span><span> </span><a href="#local-6989586621680018035"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621680018035"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1252"></a><a name="maybeRead"><a href="Util.html#maybeRead"><span class="hs-identifier">maybeRead</span></a></a><span> </span><a name="local-6989586621680018725"><a href="#local-6989586621680018725"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">reads</span><span> </span><a href="#local-6989586621680018725"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1253"></a><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><a name="local-6989586621680018726"><a href="#local-6989586621680018726"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621680018726"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1254"></a><span>                </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1255"></a><span>
</span><a name="line-1256"></a><span class="hs-identifier">maybeReadFuzzy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Read</span><span> </span><a href="#local-6989586621680018034"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621680018034"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1257"></a><a name="maybeReadFuzzy"><a href="Util.html#maybeReadFuzzy"><span class="hs-identifier">maybeReadFuzzy</span></a></a><span> </span><a name="local-6989586621680018727"><a href="#local-6989586621680018727"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">reads</span><span> </span><a href="#local-6989586621680018727"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1258"></a><span>                     </span><span class="hs-special">[</span><span class="hs-special">(</span><a name="local-6989586621680018728"><a href="#local-6989586621680018728"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018729"><a href="#local-6989586621680018729"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1259"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621680018729"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1260"></a><span>                         </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621680018728"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1261"></a><span>                     </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1262"></a><span>                         </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1263"></a><span>
</span><a name="line-1264"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-1265"></a><span class="hs-comment">-- Verify that the 'dirname' portion of a FilePath exists.</span><span>
</span><a name="line-1266"></a><span class="hs-comment">--</span><span>
</span><a name="line-1267"></a><span class="hs-identifier">doesDirNameExist</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1268"></a><a name="doesDirNameExist"><a href="Util.html#doesDirNameExist"><span class="hs-identifier">doesDirNameExist</span></a></a><span> </span><a name="local-6989586621680018730"><a href="#local-6989586621680018730"><span class="hs-identifier">fpath</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">doesDirectoryExist</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">takeDirectory</span><span> </span><a href="#local-6989586621680018730"><span class="hs-identifier hs-var">fpath</span></a><span class="hs-special">)</span><span>
</span><a name="line-1269"></a><span>
</span><a name="line-1270"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-1271"></a><span class="hs-comment">-- Backwards compatibility definition of getModificationTime</span><span>
</span><a name="line-1272"></a><span>
</span><a name="line-1273"></a><span class="hs-identifier">getModificationUTCTime</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">UTCTime</span><span>
</span><a name="line-1274"></a><a name="getModificationUTCTime"><a href="Util.html#getModificationUTCTime"><span class="hs-identifier">getModificationUTCTime</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">getModificationTime</span><span>
</span><a name="line-1275"></a><span>
</span><a name="line-1276"></a><span class="hs-comment">-- --------------------------------------------------------------</span><span>
</span><a name="line-1277"></a><span class="hs-comment">-- check existence &amp; modification time at the same time</span><span>
</span><a name="line-1278"></a><span>
</span><a name="line-1279"></a><span class="hs-identifier">modificationTimeIfExists</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">UTCTime</span><span class="hs-special">)</span><span>
</span><a name="line-1280"></a><a name="modificationTimeIfExists"><a href="Util.html#modificationTimeIfExists"><span class="hs-identifier">modificationTimeIfExists</span></a></a><span> </span><a name="local-6989586621680018731"><a href="#local-6989586621680018731"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1281"></a><span>  </span><span class="hs-special">(</span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680018732"><a href="#local-6989586621680018732"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Util.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a><span> </span><a href="#local-6989586621680018731"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621680018732"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1282"></a><span>        </span><span class="hs-special">`</span><a href="Exception.html#catchIO"><span class="hs-identifier hs-var">catchIO</span></a><span class="hs-special">`</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680018733"><a href="#local-6989586621680018733"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isDoesNotExistError</span><span> </span><a href="#local-6989586621680018733"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1283"></a><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1284"></a><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">ioError</span><span> </span><a href="#local-6989586621680018733"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1285"></a><span>
</span><a name="line-1286"></a><span class="hs-comment">-- --------------------------------------------------------------</span><span>
</span><a name="line-1287"></a><span class="hs-comment">-- split a string at the last character where 'pred' is True,</span><span>
</span><a name="line-1288"></a><span class="hs-comment">-- returning a pair of strings. The first component holds the string</span><span>
</span><a name="line-1289"></a><span class="hs-comment">-- up (but not including) the last character for which 'pred' returned</span><span>
</span><a name="line-1290"></a><span class="hs-comment">-- True, the second whatever comes after (but also not including the</span><span>
</span><a name="line-1291"></a><span class="hs-comment">-- last character).</span><span>
</span><a name="line-1292"></a><span class="hs-comment">--</span><span>
</span><a name="line-1293"></a><span class="hs-comment">-- If 'pred' returns False for all characters in the string, the original</span><span>
</span><a name="line-1294"></a><span class="hs-comment">-- string is returned in the first component (and the second one is just</span><span>
</span><a name="line-1295"></a><span class="hs-comment">-- empty).</span><span>
</span><a name="line-1296"></a><span class="hs-identifier">splitLongestPrefix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-1297"></a><a name="splitLongestPrefix"><a href="Util.html#splitLongestPrefix"><span class="hs-identifier">splitLongestPrefix</span></a></a><span> </span><a name="local-6989586621680018734"><a href="#local-6989586621680018734"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621680018735"><a href="#local-6989586621680018735"><span class="hs-identifier">pred</span></a></a><span>
</span><a name="line-1298"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680018737"><span class="hs-identifier hs-var">r_pre</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018734"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span>           </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1299"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tail</span><span> </span><a href="#local-6989586621680018737"><span class="hs-identifier hs-var">r_pre</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621680018736"><span class="hs-identifier hs-var">r_suf</span></a><span class="hs-special">)</span><span>
</span><a name="line-1300"></a><span>                           </span><span class="hs-comment">-- 'tail' drops the char satisfying 'pred'</span><span>
</span><a name="line-1301"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018736"><a href="#local-6989586621680018736"><span class="hs-identifier">r_suf</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018737"><a href="#local-6989586621680018737"><span class="hs-identifier">r_pre</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">break</span><span> </span><a href="#local-6989586621680018735"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621680018734"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>
</span><a name="line-1302"></a><span>
</span><a name="line-1303"></a><span class="hs-identifier">escapeSpaces</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-1304"></a><a name="escapeSpaces"><a href="Util.html#escapeSpaces"><span class="hs-identifier">escapeSpaces</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680018738"><a href="#local-6989586621680018738"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621680018739"><a href="#local-6989586621680018739"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621680018738"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">'\\'</span><span class="hs-glyph">:</span><a href="#local-6989586621680018738"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018739"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621680018738"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621680018739"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-1305"></a><span>
</span><a name="line-1306"></a><span class="hs-keyword">type</span><span> </span><a name="Suffix"><a href="Util.html#Suffix"><span class="hs-identifier">Suffix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-1307"></a><span>
</span><a name="line-1308"></a><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><a name="line-1309"></a><span class="hs-comment">-- * Search path</span><span>
</span><a name="line-1310"></a><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><a name="line-1311"></a><span>
</span><a name="line-1312"></a><span class="hs-keyword">data</span><span> </span><a name="Direction"><a href="Util.html#Direction"><span class="hs-identifier">Direction</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Forwards"><a href="Util.html#Forwards"><span class="hs-identifier">Forwards</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Backwards"><a href="Util.html#Backwards"><span class="hs-identifier">Backwards</span></a></a><span>
</span><a name="line-1313"></a><span>
</span><a name="line-1314"></a><span class="hs-identifier">reslash</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#Direction"><span class="hs-identifier hs-type">Direction</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1315"></a><a name="reslash"><a href="Util.html#reslash"><span class="hs-identifier">reslash</span></a></a><span> </span><a name="local-6989586621680018740"><a href="#local-6989586621680018740"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018741"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-1316"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680018741"><a href="#local-6989586621680018741"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-char">'/'</span><span>  </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018743"><a href="#local-6989586621680018743"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018742"><span class="hs-identifier hs-var">slash</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680018741"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018743"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-1317"></a><span>          </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><span class="hs-char">'\\'</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018744"><a href="#local-6989586621680018744"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018742"><span class="hs-identifier hs-var">slash</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680018741"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018744"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-1318"></a><span>          </span><span class="hs-identifier">f</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018745"><a href="#local-6989586621680018745"><span class="hs-identifier">x</span></a></a><span>    </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018746"><a href="#local-6989586621680018746"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018745"><span class="hs-identifier hs-var">x</span></a><span>     </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680018741"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018746"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-1319"></a><span>          </span><span class="hs-identifier">f</span><span> </span><span class="hs-string">&quot;&quot;</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-1320"></a><span>          </span><a name="local-6989586621680018742"><a href="#local-6989586621680018742"><span class="hs-identifier">slash</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680018740"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1321"></a><span>                  </span><a href="Util.html#Forwards"><span class="hs-identifier hs-var">Forwards</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-char">'/'</span><span>
</span><a name="line-1322"></a><span>                  </span><a href="Util.html#Backwards"><span class="hs-identifier hs-var">Backwards</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-char">'\\'</span><span>
</span><a name="line-1323"></a><span>
</span><a name="line-1324"></a><span class="hs-identifier">makeRelativeTo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1325"></a><a name="local-6989586621680018747"><a href="#local-6989586621680018747"><span class="hs-identifier">this</span></a></a><span> </span><span class="hs-special">`</span><a name="makeRelativeTo"><a href="Util.html#makeRelativeTo"><span class="hs-identifier">makeRelativeTo</span></a></a><span class="hs-special">`</span><span> </span><a name="local-6989586621680018748"><a href="#local-6989586621680018748"><span class="hs-identifier">that</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018752"><span class="hs-identifier hs-var">directory</span></a><span> </span><span class="hs-operator hs-var">&lt;/&gt;</span><span> </span><a href="#local-6989586621680018750"><span class="hs-identifier hs-var">thisFilename</span></a><span>
</span><a name="line-1326"></a><span>    </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018749"><a href="#local-6989586621680018749"><span class="hs-identifier">thisDirectory</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680018750"><a href="#local-6989586621680018750"><span class="hs-identifier">thisFilename</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">splitFileName</span><span> </span><a href="#local-6989586621680018747"><span class="hs-identifier hs-var">this</span></a><span>
</span><a name="line-1327"></a><span>          </span><a name="local-6989586621680018751"><a href="#local-6989586621680018751"><span class="hs-identifier">thatDirectory</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dropFileName</span><span> </span><a href="#local-6989586621680018748"><span class="hs-identifier hs-var">that</span></a><span>
</span><a name="line-1328"></a><span>          </span><a name="local-6989586621680018752"><a href="#local-6989586621680018752"><span class="hs-identifier">directory</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">joinPath</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680018753"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitPath</span><span> </span><a href="#local-6989586621680018749"><span class="hs-identifier hs-var">thisDirectory</span></a><span class="hs-special">)</span><span>
</span><a name="line-1329"></a><span>                                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitPath</span><span> </span><a href="#local-6989586621680018751"><span class="hs-identifier hs-var">thatDirectory</span></a><span class="hs-special">)</span><span>
</span><a name="line-1330"></a><span>
</span><a name="line-1331"></a><span>          </span><a name="local-6989586621680018753"><a href="#local-6989586621680018753"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680018754"><a href="#local-6989586621680018754"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018755"><a href="#local-6989586621680018755"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680018756"><a href="#local-6989586621680018756"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680018757"><a href="#local-6989586621680018757"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1332"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018754"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680018756"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018753"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680018755"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621680018757"><span class="hs-identifier hs-var">ys</span></a><span>
</span><a name="line-1333"></a><span>          </span><span class="hs-identifier">f</span><span> </span><a name="local-6989586621680018758"><a href="#local-6989586621680018758"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621680018759"><a href="#local-6989586621680018759"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680018759"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><span class="hs-string">&quot;..&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680018758"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-1334"></a><span>
</span><a name="line-1335"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Utils-Data]{Utils for defining Data instances}
*                                                                      *
************************************************************************

These functions helps us to define Data instances for abstract types.
-}</span><span>
</span><a name="line-1344"></a><span>
</span><a name="line-1345"></a><span class="hs-identifier">abstractConstr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Constr</span><span>
</span><a name="line-1346"></a><a name="abstractConstr"><a href="Util.html#abstractConstr"><span class="hs-identifier">abstractConstr</span></a></a><span> </span><a name="local-6989586621680018760"><a href="#local-6989586621680018760"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkConstr</span><span> </span><span class="hs-special">(</span><a href="Util.html#abstractDataType"><span class="hs-identifier hs-var">abstractDataType</span></a><span> </span><a href="#local-6989586621680018760"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;{abstract:&quot;</span><span class="hs-operator hs-var">++</span><a href="#local-6989586621680018760"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;}&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">Prefix</span><span>
</span><a name="line-1347"></a><span>
</span><a name="line-1348"></a><span class="hs-identifier">abstractDataType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DataType</span><span>
</span><a name="line-1349"></a><a name="abstractDataType"><a href="Util.html#abstractDataType"><span class="hs-identifier">abstractDataType</span></a></a><span> </span><a name="local-6989586621680018761"><a href="#local-6989586621680018761"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkDataType</span><span> </span><a href="#local-6989586621680018761"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">[</span><a href="Util.html#abstractConstr"><span class="hs-identifier hs-var">abstractConstr</span></a><span> </span><a href="#local-6989586621680018761"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-1350"></a><span>
</span><a name="line-1351"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Utils-C]{Utils for printing C code}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1358"></a><span>
</span><a name="line-1359"></a><span class="hs-identifier">charToC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-1360"></a><a name="charToC"><a href="Util.html#charToC"><span class="hs-identifier">charToC</span></a></a><span> </span><a name="local-6989586621680018762"><a href="#local-6989586621680018762"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1361"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">chr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621680018762"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1362"></a><span>        </span><span class="hs-char">'\&quot;'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\\\&quot;&quot;</span><span>
</span><a name="line-1363"></a><span>        </span><span class="hs-char">'\''</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\\\'&quot;</span><span>
</span><a name="line-1364"></a><span>        </span><span class="hs-char">'\\'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;\\\\&quot;</span><span>
</span><a name="line-1365"></a><span>        </span><a name="local-6989586621680018763"><a href="#local-6989586621680018763"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680018763"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-char">' '</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680018763"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-char">'~'</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680018763"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-1366"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-char">'\\'</span><span class="hs-special">,</span><span>
</span><a name="line-1367"></a><span>                         </span><span class="hs-identifier hs-var">chr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-char">'0'</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621680018763"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">64</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1368"></a><span>                         </span><span class="hs-identifier hs-var">chr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-char">'0'</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621680018763"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1369"></a><span>                         </span><span class="hs-identifier hs-var">chr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-char">'0'</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621680018763"><span class="hs-identifier hs-var">c</span></a><span>         </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1370"></a><span>
</span><a name="line-1371"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Utils-Hashing]{Utils for hashing}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1378"></a><span>
</span><a name="line-1379"></a><span class="hs-comment">-- | A sample hash function for Strings.  We keep multiplying by the</span><span>
</span><a name="line-1380"></a><span class="hs-comment">-- golden ratio and adding.  The implementation is:</span><span>
</span><a name="line-1381"></a><span class="hs-comment">--</span><span>
</span><a name="line-1382"></a><span class="hs-comment">-- &gt; hashString = foldl' f golden</span><span>
</span><a name="line-1383"></a><span class="hs-comment">-- &gt;   where f m c = fromIntegral (ord c) * magic + hashInt32 m</span><span>
</span><a name="line-1384"></a><span class="hs-comment">-- &gt;         magic = 0xdeadbeef</span><span>
</span><a name="line-1385"></a><span class="hs-comment">--</span><span>
</span><a name="line-1386"></a><span class="hs-comment">-- Where hashInt32 works just as hashInt shown above.</span><span>
</span><a name="line-1387"></a><span class="hs-comment">--</span><span>
</span><a name="line-1388"></a><span class="hs-comment">-- Knuth argues that repeated multiplication by the golden ratio</span><span>
</span><a name="line-1389"></a><span class="hs-comment">-- will minimize gaps in the hash space, and thus it's a good choice</span><span>
</span><a name="line-1390"></a><span class="hs-comment">-- for combining together multiple keys to form one.</span><span>
</span><a name="line-1391"></a><span class="hs-comment">--</span><span>
</span><a name="line-1392"></a><span class="hs-comment">-- Here we know that individual characters c are often small, and this</span><span>
</span><a name="line-1393"></a><span class="hs-comment">-- produces frequent collisions if we use ord c alone.  A</span><span>
</span><a name="line-1394"></a><span class="hs-comment">-- particular problem are the shorter low ASCII and ISO-8859-1</span><span>
</span><a name="line-1395"></a><span class="hs-comment">-- character strings.  We pre-multiply by a magic twiddle factor to</span><span>
</span><a name="line-1396"></a><span class="hs-comment">-- obtain a good distribution.  In fact, given the following test:</span><span>
</span><a name="line-1397"></a><span class="hs-comment">--</span><span>
</span><a name="line-1398"></a><span class="hs-comment">-- &gt; testp :: Int32 -&gt; Int</span><span>
</span><a name="line-1399"></a><span class="hs-comment">-- &gt; testp k = (n - ) . length . group . sort . map hs . take n $ ls</span><span>
</span><a name="line-1400"></a><span class="hs-comment">-- &gt;   where ls = [] : [c : l | l &lt;- ls, c &lt;- ['\0'..'\xff']]</span><span>
</span><a name="line-1401"></a><span class="hs-comment">-- &gt;         hs = foldl' f golden</span><span>
</span><a name="line-1402"></a><span class="hs-comment">-- &gt;         f m c = fromIntegral (ord c) * k + hashInt32 m</span><span>
</span><a name="line-1403"></a><span class="hs-comment">-- &gt;         n = 100000</span><span>
</span><a name="line-1404"></a><span class="hs-comment">--</span><span>
</span><a name="line-1405"></a><span class="hs-comment">-- We discover that testp magic = 0.</span><span>
</span><a name="line-1406"></a><span class="hs-identifier">hashString</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int32</span><span>
</span><a name="line-1407"></a><a name="hashString"><a href="Util.html#hashString"><span class="hs-identifier">hashString</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621680018764"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="Util.html#golden"><span class="hs-identifier hs-var">golden</span></a><span>
</span><a name="line-1408"></a><span>   </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680018764"><a href="#local-6989586621680018764"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621680018766"><a href="#local-6989586621680018766"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680018767"><a href="#local-6989586621680018767"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621680018767"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621680018765"><span class="hs-identifier hs-var">magic</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="Util.html#hashInt32"><span class="hs-identifier hs-var">hashInt32</span></a><span> </span><a href="#local-6989586621680018766"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-1409"></a><span>         </span><a name="local-6989586621680018765"><a href="#local-6989586621680018765"><span class="hs-identifier">magic</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-number">0xdeadbeef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-1410"></a><span>
</span><a name="line-1411"></a><span class="hs-identifier">golden</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int32</span><span>
</span><a name="line-1412"></a><a name="golden"><a href="Util.html#golden"><span class="hs-identifier">golden</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1013904242</span><span> </span><span class="hs-comment">-- = round ((sqrt 5 - 1) * 2^32) :: Int32</span><span>
</span><a name="line-1413"></a><span class="hs-comment">-- was -1640531527 = round ((sqrt 5 - 1) * 2^31) :: Int32</span><span>
</span><a name="line-1414"></a><span class="hs-comment">-- but that has bad mulHi properties (even adding 2^32 to get its inverse)</span><span>
</span><a name="line-1415"></a><span class="hs-comment">-- Whereas the above works well and contains no hash duplications for</span><span>
</span><a name="line-1416"></a><span class="hs-comment">-- [-32767..65536]</span><span>
</span><a name="line-1417"></a><span>
</span><a name="line-1418"></a><span class="hs-comment">-- | A sample (and useful) hash function for Int32,</span><span>
</span><a name="line-1419"></a><span class="hs-comment">-- implemented by extracting the uppermost 32 bits of the 64-bit</span><span>
</span><a name="line-1420"></a><span class="hs-comment">-- result of multiplying by a 33-bit constant.  The constant is from</span><span>
</span><a name="line-1421"></a><span class="hs-comment">-- Knuth, derived from the golden ratio:</span><span>
</span><a name="line-1422"></a><span class="hs-comment">--</span><span>
</span><a name="line-1423"></a><span class="hs-comment">-- &gt; golden = round ((sqrt 5 - 1) * 2^32)</span><span>
</span><a name="line-1424"></a><span class="hs-comment">--</span><span>
</span><a name="line-1425"></a><span class="hs-comment">-- We get good key uniqueness on small inputs</span><span>
</span><a name="line-1426"></a><span class="hs-comment">-- (a problem with previous versions):</span><span>
</span><a name="line-1427"></a><span class="hs-comment">--  (length $ group $ sort $ map hashInt32 [-32767..65536]) == 65536 + 32768</span><span>
</span><a name="line-1428"></a><span class="hs-comment">--</span><span>
</span><a name="line-1429"></a><span class="hs-identifier">hashInt32</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int32</span><span>
</span><a name="line-1430"></a><a name="hashInt32"><a href="Util.html#hashInt32"><span class="hs-identifier">hashInt32</span></a></a><span> </span><a name="local-6989586621680018768"><a href="#local-6989586621680018768"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#mulHi"><span class="hs-identifier hs-var">mulHi</span></a><span> </span><a href="#local-6989586621680018768"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="Util.html#golden"><span class="hs-identifier hs-var">golden</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680018768"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1431"></a><span>
</span><a name="line-1432"></a><span class="hs-comment">-- hi 32 bits of a x-bit * 32 bit -&gt; 64-bit multiply</span><span>
</span><a name="line-1433"></a><span class="hs-identifier">mulHi</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int32</span><span>
</span><a name="line-1434"></a><a name="mulHi"><a href="Util.html#mulHi"><span class="hs-identifier">mulHi</span></a></a><span> </span><a name="local-6989586621680018769"><a href="#local-6989586621680018769"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621680018770"><a href="#local-6989586621680018770"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680018771"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-number">32</span><span class="hs-special">)</span><span>
</span><a name="line-1435"></a><span>   </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">r</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int64</span><span>
</span><a name="line-1436"></a><span>         </span><a name="local-6989586621680018771"><a href="#local-6989586621680018771"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621680018769"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621680018770"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1437"></a><span>
</span><a name="line-1438"></a><span class="hs-comment">-- | A call stack constraint, but only when 'isDebugOn'.</span><span>
</span><a name="line-1439"></a><span class="hs-cpp">#if defined(DEBUG)
</span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">HasDebugCallStack</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">HasCallStack</span><span>
</span><a name="line-1441"></a><span class="hs-cpp">#else
</span><span class="hs-keyword">type</span><span> </span><a name="HasDebugCallStack"><a href="Util.html#HasDebugCallStack"><span class="hs-identifier">HasDebugCallStack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Constraint</span><span class="hs-special">)</span><span>
</span><a name="line-1443"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-1445"></a><span class="hs-keyword">data</span><span> </span><a name="OverridingBool"><a href="Util.html#OverridingBool"><span class="hs-identifier">OverridingBool</span></a></a><span>
</span><a name="line-1446"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Auto"><a href="Util.html#Auto"><span class="hs-identifier">Auto</span></a></a><span>
</span><a name="line-1447"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Always"><a href="Util.html#Always"><span class="hs-identifier">Always</span></a></a><span>
</span><a name="line-1448"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Never"><a href="Util.html#Never"><span class="hs-identifier">Never</span></a></a><span>
</span><a name="line-1449"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-1450"></a><span>
</span><a name="line-1451"></a><span class="hs-identifier">overrideWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Util.html#OverridingBool"><span class="hs-identifier hs-type">OverridingBool</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1452"></a><a name="overrideWith"><a href="Util.html#overrideWith"><span class="hs-identifier">overrideWith</span></a></a><span> </span><a name="local-6989586621680018772"><a href="#local-6989586621680018772"><span class="hs-identifier">b</span></a></a><span> </span><a href="Util.html#Auto"><span class="hs-identifier hs-var">Auto</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680018772"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1453"></a><span class="hs-identifier">overrideWith</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Util.html#Always"><span class="hs-identifier hs-var">Always</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1454"></a><span class="hs-identifier">overrideWith</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="Util.html#Never"><span class="hs-identifier hs-var">Never</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1455"></a></pre></body></html>