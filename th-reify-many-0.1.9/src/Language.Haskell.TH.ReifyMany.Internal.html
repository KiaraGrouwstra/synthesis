<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.Haskell.TH.ReifyMany.Internal</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-cpp">#if !(MIN_VERSION_template_haskell(2,7,0))
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">foldl'</span><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span class="hs-cpp">#endif
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.TH</span><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Language.Haskell.TH.ExpandSyns</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">expandSyns</span><span class="hs-special">)</span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Safe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">headMay</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">tailMay</span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-comment">-- | Returns 'True' if the 'Dec' is a 'DataD' or 'NewtypeD'</span><span>
</span><a name="line-13"></a><span class="hs-identifier">isDataDec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-14"></a><a name="isDataDec"><a href="Language.Haskell.TH.ReifyMany.Internal.html#isDataDec"><span class="hs-identifier">isDataDec</span></a></a><span> </span><span class="hs-identifier hs-var">DataD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-15"></a><span class="hs-identifier">isDataDec</span><span> </span><span class="hs-identifier hs-var">NewtypeD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-16"></a><span class="hs-identifier">isDataDec</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-comment">-- | Returns 'True' if the 'Dec' is a 'DataD', 'NewtypeD', or</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- 'TySynD'.</span><span>
</span><a name="line-20"></a><span class="hs-identifier">isNormalTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-21"></a><a name="isNormalTyCon"><a href="Language.Haskell.TH.ReifyMany.Internal.html#isNormalTyCon"><span class="hs-identifier">isNormalTyCon</span></a></a><span> </span><span class="hs-identifier hs-var">DataD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-22"></a><span class="hs-identifier">isNormalTyCon</span><span> </span><span class="hs-identifier hs-var">NewtypeD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-23"></a><span class="hs-identifier">isNormalTyCon</span><span> </span><span class="hs-identifier hs-var">TySynD</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-24"></a><span class="hs-identifier">isNormalTyCon</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-comment">-- | For data, newtype, and type declarations, yields a list of the</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- types of the fields.  In the case of a type synonyms, it just</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- returns the body of the type synonym as a singleton list.</span><span>
</span><a name="line-29"></a><span class="hs-identifier">decToFieldTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-30"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)
</span><a name="decToFieldTypes"><a href="Language.Haskell.TH.ReifyMany.Internal.html#decToFieldTypes"><span class="hs-identifier">decToFieldTypes</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">DataD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679034103"><a href="#local-6989586621679034103"><span class="hs-identifier">cons</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#conToFieldTypes"><span class="hs-identifier hs-var">conToFieldTypes</span></a><span> </span><a href="#local-6989586621679034103"><span class="hs-identifier hs-var">cons</span></a><span>
</span><a name="line-32"></a><span class="hs-identifier">decToFieldTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NewtypeD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679034104"><a href="#local-6989586621679034104"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.ReifyMany.Internal.html#conToFieldTypes"><span class="hs-identifier hs-var">conToFieldTypes</span></a><span> </span><a href="#local-6989586621679034104"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">]</span><span>
</span><a name="line-33"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">decToFieldTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">DataD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">cons</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">conToFieldTypes</span><span> </span><span class="hs-identifier">cons</span><span>
</span><a name="line-35"></a><span class="hs-identifier">decToFieldTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NewtypeD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">con</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">conToFieldTypes</span><span> </span><span class="hs-identifier">con</span><span class="hs-special">]</span><span>
</span><a name="line-36"></a><span class="hs-cpp">#endif
</span><span class="hs-identifier">decToFieldTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TySynD</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679034105"><a href="#local-6989586621679034105"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="#local-6989586621679034105"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-38"></a><span class="hs-identifier">decToFieldTypes</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-comment">-- | Returns the types of the fields of the constructor.</span><span>
</span><a name="line-41"></a><span class="hs-identifier">conToFieldTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Con</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>
</span><a name="line-42"></a><a name="conToFieldTypes"><a href="Language.Haskell.TH.ReifyMany.Internal.html#conToFieldTypes"><span class="hs-identifier">conToFieldTypes</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NormalC</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679034106"><a href="#local-6989586621679034106"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679034106"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-43"></a><span class="hs-identifier">conToFieldTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecC</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679034122"><a href="#local-6989586621679034122"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679034123"><a href="#local-6989586621679034123"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679034123"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679034122"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-44"></a><span class="hs-identifier">conToFieldTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679034124"><a href="#local-6989586621679034124"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679034125"><a href="#local-6989586621679034125"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679034124"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679034125"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-45"></a><span class="hs-identifier">conToFieldTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679034126"><a href="#local-6989586621679034126"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#conToFieldTypes"><span class="hs-identifier hs-var">conToFieldTypes</span></a><span> </span><a href="#local-6989586621679034126"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-46"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,11,0)
</span><span class="hs-identifier">conToFieldTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GadtC</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679034127"><a href="#local-6989586621679034127"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679034127"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-48"></a><span class="hs-identifier">conToFieldTypes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecGadtC</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679034128"><a href="#local-6989586621679034128"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679034129"><a href="#local-6989586621679034129"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679034129"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679034128"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-49"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- | Returns the names of all type constructors which aren't involved</span><span>
</span><a name="line-52"></a><span class="hs-comment">-- in constraints.</span><span>
</span><a name="line-53"></a><span class="hs-identifier">typeConcreteNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-54"></a><a name="typeConcreteNames"><a href="Language.Haskell.TH.ReifyMany.Internal.html#typeConcreteNames"><span class="hs-identifier">typeConcreteNames</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForallT</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679034130"><a href="#local-6989586621679034130"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#typeConcreteNames"><span class="hs-identifier hs-var">typeConcreteNames</span></a><span> </span><a href="#local-6989586621679034130"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-55"></a><span class="hs-identifier">typeConcreteNames</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679034131"><a href="#local-6989586621679034131"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679034132"><a href="#local-6989586621679034132"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#typeConcreteNames"><span class="hs-identifier hs-var">typeConcreteNames</span></a><span> </span><a href="#local-6989586621679034131"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#typeConcreteNames"><span class="hs-identifier hs-var">typeConcreteNames</span></a><span> </span><a href="#local-6989586621679034132"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-56"></a><span class="hs-identifier">typeConcreteNames</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679034133"><a href="#local-6989586621679034133"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#typeConcreteNames"><span class="hs-identifier hs-var">typeConcreteNames</span></a><span> </span><a href="#local-6989586621679034133"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-57"></a><span class="hs-identifier">typeConcreteNames</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><a name="local-6989586621679034134"><a href="#local-6989586621679034134"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679034134"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span>
</span><a name="line-58"></a><span class="hs-identifier">typeConcreteNames</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-comment">-- | Returns the names of all type constructors used when defining</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- type constructors.</span><span>
</span><a name="line-62"></a><span class="hs-identifier">decConcreteNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Dec</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-63"></a><a name="decConcreteNames"><a href="Language.Haskell.TH.ReifyMany.Internal.html#decConcreteNames"><span class="hs-identifier">decConcreteNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#typeConcreteNames"><span class="hs-identifier hs-var">typeConcreteNames</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#decToFieldTypes"><span class="hs-identifier hs-var">decToFieldTypes</span></a><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">-- | Datatype to capture the fields of 'InstanceD'.</span><span>
</span><a name="line-66"></a><span class="hs-keyword">data</span><span> </span><a name="TypeclassInstance"><a href="Language.Haskell.TH.ReifyMany.Internal.html#TypeclassInstance"><span class="hs-identifier">TypeclassInstance</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TypeclassInstance"><a href="Language.Haskell.TH.ReifyMany.Internal.html#TypeclassInstance"><span class="hs-identifier">TypeclassInstance</span></a></a><span> </span><span class="hs-identifier hs-type">Cxt</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Dec</span><span class="hs-special">]</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">-- | Given the 'Name' of a class, yield all of the</span><span>
</span><a name="line-70"></a><span class="hs-comment">-- 'TypeclassInstance's, with synonyms expanded in the 'Type' field.</span><span>
</span><a name="line-71"></a><span class="hs-identifier">getInstances</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.ReifyMany.Internal.html#TypeclassInstance"><span class="hs-identifier hs-type">TypeclassInstance</span></a><span class="hs-special">]</span><span>
</span><a name="line-72"></a><a name="getInstances"><a href="Language.Haskell.TH.ReifyMany.Internal.html#getInstances"><span class="hs-identifier">getInstances</span></a></a><span> </span><a name="local-6989586621679035279"><a href="#local-6989586621679035279"><span class="hs-identifier">clz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-73"></a><span>    </span><a name="local-6989586621679035285"><a href="#local-6989586621679035285"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">reify</span><span> </span><a href="#local-6989586621679035279"><span class="hs-identifier hs-var">clz</span></a><span>
</span><a name="line-74"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679035285"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-75"></a><span>        </span><span class="hs-identifier hs-var">ClassI</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679035286"><a href="#local-6989586621679035286"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679035280"><span class="hs-identifier hs-var">convertDec</span></a><span> </span><a href="#local-6989586621679035286"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-76"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Error in getInstances: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679035279"><span class="hs-identifier hs-var">clz</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; isn't a class&quot;</span><span>
</span><a name="line-77"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-78"></a><span class="hs-cpp">#if MIN_VERSION_template_haskell(2,7,0)
#if MIN_VERSION_template_haskell(2,11,0)
</span><span>    </span><a name="local-6989586621679035280"><a href="#local-6989586621679035280"><span class="hs-identifier">convertDec</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InstanceD</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679035281"><a href="#local-6989586621679035281"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621679035282"><a href="#local-6989586621679035282"><span class="hs-identifier">typ</span></a></a><span> </span><a name="local-6989586621679035283"><a href="#local-6989586621679035283"><span class="hs-identifier">decs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-81"></a><span class="hs-cpp">#else
</span><span>    </span><span class="hs-identifier">convertDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">InstanceD</span><span> </span><span class="hs-identifier">ctxt</span><span> </span><span class="hs-identifier">typ</span><span> </span><span class="hs-identifier">decs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-83"></a><span class="hs-cpp">#endif
</span><span>        </span><a name="local-6989586621679035284"><a href="#local-6989586621679035284"><span class="hs-identifier">typ'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">expandSyns</span><span> </span><a href="#local-6989586621679035282"><span class="hs-identifier hs-var">typ</span></a><span>
</span><a name="line-85"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.ReifyMany.Internal.html#TypeclassInstance"><span class="hs-identifier hs-var">TypeclassInstance</span></a><span> </span><a href="#local-6989586621679035281"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621679035284"><span class="hs-identifier hs-var">typ'</span></a><span> </span><a href="#local-6989586621679035283"><span class="hs-identifier hs-var">decs</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-identifier">convertDec</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-87"></a><span class="hs-cpp">#else
</span><span>    </span><span class="hs-identifier">convertDec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ClassInstance</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">ctxt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">typs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-89"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">typ</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foldl'</span><span> </span><span class="hs-identifier">AppT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ConT</span><span> </span><span class="hs-identifier">clz</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">typs</span><span>
</span><a name="line-90"></a><span>        </span><span class="hs-identifier">typ'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">expandSyns</span><span> </span><span class="hs-identifier">typ</span><span>
</span><a name="line-91"></a><span>        </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TypeclassInstance</span><span> </span><span class="hs-identifier">ctxt</span><span> </span><span class="hs-identifier">typ'</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-94"></a><span class="hs-comment">-- | Returns the first 'TypeclassInstance' where 'instanceMatches'</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- returns true.</span><span>
</span><a name="line-96"></a><span class="hs-identifier">lookupInstance</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Language.Haskell.TH.ReifyMany.Internal.html#TypeclassInstance"><span class="hs-identifier hs-type">TypeclassInstance</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#TypeclassInstance"><span class="hs-identifier hs-type">TypeclassInstance</span></a><span>
</span><a name="line-97"></a><a name="lookupInstance"><a href="Language.Haskell.TH.ReifyMany.Internal.html#lookupInstance"><span class="hs-identifier">lookupInstance</span></a></a><span> </span><a name="local-6989586621679035712"><a href="#local-6989586621679035712"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679035713"><a href="#local-6989586621679035713"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">headMay</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="Language.Haskell.TH.ReifyMany.Internal.html#instanceMatches"><span class="hs-identifier hs-var">instanceMatches</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679035713"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679035712"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-comment">-- | Checks if the given name is the head of one of the paramaters of</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- the given 'TypeclassInstance'.</span><span>
</span><a name="line-101"></a><span class="hs-identifier">instanceMatches</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#TypeclassInstance"><span class="hs-identifier hs-type">TypeclassInstance</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-102"></a><a name="instanceMatches"><a href="Language.Haskell.TH.ReifyMany.Internal.html#instanceMatches"><span class="hs-identifier">instanceMatches</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.ReifyMany.Internal.html#TypeclassInstance"><span class="hs-identifier hs-var">TypeclassInstance</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679035900"><a href="#local-6989586621679035900"><span class="hs-identifier">typ</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679035901"><a href="#local-6989586621679035901"><span class="hs-identifier">n'</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">tailMay</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#unSigT"><span class="hs-identifier hs-var">unSigT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">headMay</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#unAppsT"><span class="hs-identifier hs-var">unAppsT</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#unAppsT"><span class="hs-identifier hs-var">unAppsT</span></a><span> </span><a href="#local-6989586621679035900"><span class="hs-identifier hs-var">typ</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-104"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-105"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679035902"><a href="#local-6989586621679035902"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConT</span><span> </span><a name="local-6989586621679039770"><a href="#local-6989586621679039770"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679035902"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679039770"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679035901"><span class="hs-identifier hs-var">n'</span></a><span class="hs-special">]</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-comment">-- | Breaks a type application like @A b c@ into [A, b, c].</span><span>
</span><a name="line-108"></a><span class="hs-identifier">unAppsT</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>
</span><a name="line-109"></a><a name="unAppsT"><a href="Language.Haskell.TH.ReifyMany.Internal.html#unAppsT"><span class="hs-identifier">unAppsT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679039771"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-110"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>    </span><a name="local-6989586621679039771"><a href="#local-6989586621679039771"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679039772"><a href="#local-6989586621679039772"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AppT</span><span> </span><a name="local-6989586621679039773"><a href="#local-6989586621679039773"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679039774"><a href="#local-6989586621679039774"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679039771"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679039774"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679039772"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679039773"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-112"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621679039775"><a href="#local-6989586621679039775"><span class="hs-identifier">xs</span></a></a><span> </span><a name="local-6989586621679039776"><a href="#local-6989586621679039776"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679039776"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679039775"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-comment">-- | Remove any explicit kind signatures (i.e., 'SigT's) from a 'Type'.</span><span>
</span><a name="line-115"></a><span class="hs-identifier">unSigT</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-116"></a><a name="unSigT"><a href="Language.Haskell.TH.ReifyMany.Internal.html#unSigT"><span class="hs-identifier">unSigT</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigT</span><span> </span><a name="local-6989586621679039777"><a href="#local-6989586621679039777"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.Haskell.TH.ReifyMany.Internal.html#unSigT"><span class="hs-identifier hs-var">unSigT</span></a><span> </span><a href="#local-6989586621679039777"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-117"></a><span class="hs-identifier">unSigT</span><span> </span><a name="local-6989586621679039778"><a href="#local-6989586621679039778"><span class="hs-identifier">t</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679039778"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-118"></a></pre></body></html>