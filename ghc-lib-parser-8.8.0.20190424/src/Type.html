<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- (c) The University of Glasgow 2006</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- (c) The GRASP/AQUA Project, Glasgow University, 1998</span><span>
</span><a name="line-3"></a><span class="hs-comment">--</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Type - public interface</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE CPP, FlexibleContexts #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-comment">-- | Main functions for manipulating types and type-related things</span><span>
</span><a name="line-10"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Type</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-11"></a><span>        </span><span class="hs-comment">-- Note some of this is just re-exports from TyCon..</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span>        </span><span class="hs-comment">-- * Main data types representing Types</span><span>
</span><a name="line-14"></a><span>        </span><span class="hs-comment">-- $type_classification</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span>        </span><span class="hs-comment">-- $representation_types</span><span>
</span><a name="line-17"></a><span>        </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#KindOrType"><span class="hs-identifier hs-type">KindOrType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>        </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyCoVarBinder"><span class="hs-identifier hs-type">TyCoVarBinder</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="TyCoRep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>        </span><span class="hs-comment">-- ** Constructing and deconstructing types</span><span>
</span><a name="line-22"></a><span>        </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#getTyVar"><span class="hs-identifier hs-var">getTyVar</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#repGetTyVar_maybe"><span class="hs-identifier hs-var">repGetTyVar_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="Type.html#getCastedTyVar_maybe"><span class="hs-identifier hs-var">getCastedTyVar_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#varType"><span class="hs-identifier hs-var">varType</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>        </span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitAppTy"><span class="hs-identifier hs-var">splitAppTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitAppTys"><span class="hs-identifier hs-var">splitAppTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#repSplitAppTys"><span class="hs-identifier hs-var">repSplitAppTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#repSplitAppTy_maybe"><span class="hs-identifier hs-var">repSplitAppTy_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tcRepSplitAppTy_maybe"><span class="hs-identifier hs-var">tcRepSplitAppTy_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>        </span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkFunTys"><span class="hs-identifier hs-var">mkFunTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitFunTy"><span class="hs-identifier hs-var">splitFunTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="Type.html#splitFunTys"><span class="hs-identifier hs-var">splitFunTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#funResultTy"><span class="hs-identifier hs-var">funResultTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#funArgTy"><span class="hs-identifier hs-var">funArgTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>        </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tyConAppTyConPicky_maybe"><span class="hs-identifier hs-var">tyConAppTyConPicky_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>        </span><a href="Type.html#tyConAppArgs_maybe"><span class="hs-identifier hs-var">tyConAppArgs_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tyConAppTyCon"><span class="hs-identifier hs-var">tyConAppTyCon</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tyConAppArgs"><span class="hs-identifier hs-var">tyConAppArgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>        </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitTyConApp"><span class="hs-identifier hs-var">splitTyConApp</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tyConAppArgN"><span class="hs-identifier hs-var">tyConAppArgN</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#nextRole"><span class="hs-identifier hs-var">nextRole</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="Type.html#tcRepSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcRepSplitTyConApp_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tcRepSplitTyConApp"><span class="hs-identifier hs-var">tcRepSplitTyConApp</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="Type.html#splitListTyConApp_maybe"><span class="hs-identifier hs-var">splitListTyConApp_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="Type.html#repSplitTyConApp_maybe"><span class="hs-identifier hs-var">repSplitTyConApp_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span>        </span><a href="TyCoRep.html#mkForAllTy"><span class="hs-identifier hs-var">mkForAllTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkTyCoInvForAllTys"><span class="hs-identifier hs-var">mkTyCoInvForAllTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="Type.html#mkVisForAllTys"><span class="hs-identifier hs-var">mkVisForAllTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkTyCoInvForAllTy"><span class="hs-identifier hs-var">mkTyCoInvForAllTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="Type.html#mkInvForAllTy"><span class="hs-identifier hs-var">mkInvForAllTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkInvForAllTys"><span class="hs-identifier hs-var">mkInvForAllTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>        </span><a href="Type.html#splitForAllTys"><span class="hs-identifier hs-var">splitForAllTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitForAllVarBndrs"><span class="hs-identifier hs-var">splitForAllVarBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="Type.html#splitForAllTy_maybe"><span class="hs-identifier hs-var">splitForAllTy_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitForAllTy"><span class="hs-identifier hs-var">splitForAllTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="Type.html#splitForAllTy_ty_maybe"><span class="hs-identifier hs-var">splitForAllTy_ty_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitForAllTy_co_maybe"><span class="hs-identifier hs-var">splitForAllTy_co_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>        </span><a href="Type.html#splitPiTy_maybe"><span class="hs-identifier hs-var">splitPiTy_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitPiTy"><span class="hs-identifier hs-var">splitPiTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>        </span><a href="TyCoRep.html#mkTyCoPiTy"><span class="hs-identifier hs-var">mkTyCoPiTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTyCoPiTys"><span class="hs-identifier hs-var">mkTyCoPiTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkTyConBindersPreferAnon"><span class="hs-identifier hs-var">mkTyConBindersPreferAnon</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>        </span><a href="TyCoRep.html#mkPiTys"><span class="hs-identifier hs-var">mkPiTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="Type.html#mkLamType"><span class="hs-identifier hs-var">mkLamType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkLamTypes"><span class="hs-identifier hs-var">mkLamTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="Type.html#piResultTy"><span class="hs-identifier hs-var">piResultTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>        </span><a href="Type.html#applyTysX"><span class="hs-identifier hs-var">applyTysX</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#dropForAlls"><span class="hs-identifier hs-var">dropForAlls</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span>        </span><a href="Type.html#mkNumLitTy"><span class="hs-identifier hs-var">mkNumLitTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isNumLitTy"><span class="hs-identifier hs-var">isNumLitTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isStrLitTy"><span class="hs-identifier hs-var">isStrLitTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>        </span><a href="Type.html#isLitTy"><span class="hs-identifier hs-var">isLitTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span>        </span><a href="Type.html#getRuntimeRep_maybe"><span class="hs-identifier hs-var">getRuntimeRep_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#kindRep_maybe"><span class="hs-identifier hs-var">kindRep_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#kindRep"><span class="hs-identifier hs-var">kindRep</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span>        </span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitCastTy_maybe"><span class="hs-identifier hs-var">splitCastTy_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>        </span><a href="Type.html#userTypeError_maybe"><span class="hs-identifier hs-var">userTypeError_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#pprUserTypeErrorTy"><span class="hs-identifier hs-var">pprUserTypeErrorTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span>        </span><a href="Type.html#coAxNthLHS"><span class="hs-identifier hs-var">coAxNthLHS</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>        </span><a href="Type.html#stripCoercionTy"><span class="hs-identifier hs-var">stripCoercionTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitCoercionType_maybe"><span class="hs-identifier hs-var">splitCoercionType_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span>        </span><a href="Type.html#splitPiTysInvisible"><span class="hs-identifier hs-var">splitPiTysInvisible</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitPiTysInvisibleN"><span class="hs-identifier hs-var">splitPiTysInvisibleN</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>        </span><a href="Type.html#invisibleTyBndrCount"><span class="hs-identifier hs-var">invisibleTyBndrCount</span></a><span class="hs-special">,</span><span>
</span><a name="line-67"></a><span>        </span><a href="Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#filterOutInferredTypes"><span class="hs-identifier hs-var">filterOutInferredTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>        </span><a href="Type.html#partitionInvisibleTypes"><span class="hs-identifier hs-var">partitionInvisibleTypes</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#partitionInvisibles"><span class="hs-identifier hs-var">partitionInvisibles</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>        </span><a href="Type.html#tyConArgFlags"><span class="hs-identifier hs-var">tyConArgFlags</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#appTyArgFlags"><span class="hs-identifier hs-var">appTyArgFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>        </span><a href="Type.html#synTyConResKind"><span class="hs-identifier hs-var">synTyConResKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span>        </span><a href="Type.html#modifyJoinResTy"><span class="hs-identifier hs-var">modifyJoinResTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#setJoinResTy"><span class="hs-identifier hs-var">setJoinResTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>        </span><span class="hs-comment">-- Analyzing types</span><span>
</span><a name="line-75"></a><span>        </span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-type">TyCoMapper</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mapCoercion"><span class="hs-identifier hs-var">mapCoercion</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span>        </span><span class="hs-comment">-- (Newtypes)</span><span>
</span><a name="line-78"></a><span>        </span><a href="Type.html#newTyConInstRhs"><span class="hs-identifier hs-var">newTyConInstRhs</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span>        </span><span class="hs-comment">-- Pred types</span><span>
</span><a name="line-81"></a><span>        </span><a href="Type.html#mkFamilyTyConApp"><span class="hs-identifier hs-var">mkFamilyTyConApp</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>        </span><a href="Type.html#isDictLikeTy"><span class="hs-identifier hs-var">isDictLikeTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>        </span><a href="Type.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkReprPrimEqPred"><span class="hs-identifier hs-var">mkReprPrimEqPred</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkPrimEqPredRole"><span class="hs-identifier hs-var">mkPrimEqPredRole</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>        </span><a href="Type.html#equalityTyCon"><span class="hs-identifier hs-var">equalityTyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>        </span><a href="Type.html#mkHeteroPrimEqPred"><span class="hs-identifier hs-var">mkHeteroPrimEqPred</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkHeteroReprPrimEqPred"><span class="hs-identifier hs-var">mkHeteroReprPrimEqPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>        </span><a href="Type.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>        </span><a href="Type.html#isClassPred"><span class="hs-identifier hs-var">isClassPred</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isEqPred"><span class="hs-identifier hs-var">isEqPred</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isNomEqPred"><span class="hs-identifier hs-var">isNomEqPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-88"></a><span>        </span><a href="Type.html#isIPPred"><span class="hs-identifier hs-var">isIPPred</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isIPPred_maybe"><span class="hs-identifier hs-var">isIPPred_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isIPTyCon"><span class="hs-identifier hs-var">isIPTyCon</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isIPClass"><span class="hs-identifier hs-var">isIPClass</span></a><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>        </span><a href="Type.html#isCTupleClass"><span class="hs-identifier hs-var">isCTupleClass</span></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>        </span><span class="hs-comment">-- Deconstructing predicate types</span><span>
</span><a name="line-92"></a><span>        </span><a href="Type.html#PredTree"><span class="hs-identifier hs-type">PredTree</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Type.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#classifyPredType"><span class="hs-identifier hs-var">classifyPredType</span></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>        </span><a href="Type.html#getClassPredTys"><span class="hs-identifier hs-var">getClassPredTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#getClassPredTys_maybe"><span class="hs-identifier hs-var">getClassPredTys_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>        </span><a href="Type.html#getEqPredTys"><span class="hs-identifier hs-var">getEqPredTys</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#getEqPredTys_maybe"><span class="hs-identifier hs-var">getEqPredTys_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#getEqPredRole"><span class="hs-identifier hs-var">getEqPredRole</span></a><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>        </span><a href="Type.html#predTypeEqRel"><span class="hs-identifier hs-var">predTypeEqRel</span></a><span class="hs-special">,</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>        </span><span class="hs-comment">-- ** Binders</span><span>
</span><a name="line-98"></a><span>        </span><a href="Var.html#sameVis"><span class="hs-identifier hs-var">sameVis</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>        </span><a href="Var.html#mkTyCoVarBinder"><span class="hs-identifier hs-var">mkTyCoVarBinder</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#mkTyCoVarBinders"><span class="hs-identifier hs-var">mkTyCoVarBinders</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>        </span><a href="Var.html#mkTyVarBinders"><span class="hs-identifier hs-var">mkTyVarBinders</span></a><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>        </span><a href="Type.html#mkAnonBinder"><span class="hs-identifier hs-var">mkAnonBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>        </span><a href="Type.html#isAnonTyCoBinder"><span class="hs-identifier hs-var">isAnonTyCoBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-103"></a><span>        </span><a href="Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#binderArgFlag"><span class="hs-identifier hs-var">binderArgFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-104"></a><span>        </span><a href="Type.html#tyCoBinderType"><span class="hs-identifier hs-var">tyCoBinderType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tyCoBinderVar_maybe"><span class="hs-identifier hs-var">tyCoBinderVar_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-105"></a><span>        </span><a href="Type.html#tyBinderType"><span class="hs-identifier hs-var">tyBinderType</span></a><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>        </span><a href="Type.html#binderRelevantType_maybe"><span class="hs-identifier hs-var">binderRelevantType_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#caseBinder"><span class="hs-identifier hs-var">caseBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-107"></a><span>        </span><a href="Var.html#isVisibleArgFlag"><span class="hs-identifier hs-var">isVisibleArgFlag</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isInvisibleArgFlag"><span class="hs-identifier hs-var">isInvisibleArgFlag</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isVisibleBinder"><span class="hs-identifier hs-var">isVisibleBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span>        </span><a href="TyCoRep.html#isInvisibleBinder"><span class="hs-identifier hs-var">isInvisibleBinder</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isNamedBinder"><span class="hs-identifier hs-var">isNamedBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>        </span><a href="Type.html#tyConBindersTyCoBinders"><span class="hs-identifier hs-var">tyConBindersTyCoBinders</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>        </span><span class="hs-comment">-- ** Common type constructors</span><span>
</span><a name="line-112"></a><span>        </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span>        </span><span class="hs-comment">-- ** Predicates on types</span><span>
</span><a name="line-115"></a><span>        </span><a href="Type.html#isTyVarTy"><span class="hs-identifier hs-var">isTyVarTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isFunTy"><span class="hs-identifier hs-var">isFunTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isDictTy"><span class="hs-identifier hs-var">isDictTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isCoercionTy"><span class="hs-identifier hs-var">isCoercionTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-116"></a><span>        </span><a href="Type.html#isCoercionTy_maybe"><span class="hs-identifier hs-var">isCoercionTy_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-117"></a><span>        </span><a href="Type.html#isForAllTy_ty"><span class="hs-identifier hs-var">isForAllTy_ty</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isForAllTy_co"><span class="hs-identifier hs-var">isForAllTy_co</span></a><span class="hs-special">,</span><span>
</span><a name="line-118"></a><span>        </span><a href="Type.html#isPiTy"><span class="hs-identifier hs-var">isPiTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isFamFreeTy"><span class="hs-identifier hs-var">isFamFreeTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-119"></a><span>        </span><a href="Type.html#isCoVarType"><span class="hs-identifier hs-var">isCoVarType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isEvVarType"><span class="hs-identifier hs-var">isEvVarType</span></a><span class="hs-special">,</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span>        </span><a href="Type.html#isValidJoinPointType"><span class="hs-identifier hs-var">isValidJoinPointType</span></a><span class="hs-special">,</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span>        </span><span class="hs-comment">-- (Lifting and boxity)</span><span>
</span><a name="line-124"></a><span>        </span><a href="Type.html#isLiftedType_maybe"><span class="hs-identifier hs-var">isLiftedType_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isUnboxedTupleType"><span class="hs-identifier hs-var">isUnboxedTupleType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isUnboxedSumType"><span class="hs-identifier hs-var">isUnboxedSumType</span></a><span class="hs-special">,</span><span>
</span><a name="line-125"></a><span>        </span><a href="Type.html#isAlgType"><span class="hs-identifier hs-var">isAlgType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isDataFamilyAppType"><span class="hs-identifier hs-var">isDataFamilyAppType</span></a><span class="hs-special">,</span><span>
</span><a name="line-126"></a><span>        </span><a href="Type.html#isPrimitiveType"><span class="hs-identifier hs-var">isPrimitiveType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isStrictType"><span class="hs-identifier hs-var">isStrictType</span></a><span class="hs-special">,</span><span>
</span><a name="line-127"></a><span>        </span><a href="TyCoRep.html#isRuntimeRepTy"><span class="hs-identifier hs-var">isRuntimeRepTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#isRuntimeRepVar"><span class="hs-identifier hs-var">isRuntimeRepVar</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isRuntimeRepKindedTy"><span class="hs-identifier hs-var">isRuntimeRepKindedTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-128"></a><span>        </span><a href="Type.html#dropRuntimeRepArgs"><span class="hs-identifier hs-var">dropRuntimeRepArgs</span></a><span class="hs-special">,</span><span>
</span><a name="line-129"></a><span>        </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span class="hs-special">,</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span>        </span><span class="hs-comment">-- * Main data types representing Kinds</span><span>
</span><a name="line-132"></a><span>        </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span class="hs-special">,</span><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span>        </span><span class="hs-comment">-- ** Finding the kind of a type</span><span>
</span><a name="line-135"></a><span>        </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#isTypeLevPoly"><span class="hs-identifier hs-var">isTypeLevPoly</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#resultIsLevPoly"><span class="hs-identifier hs-var">resultIsLevPoly</span></a><span class="hs-special">,</span><span>
</span><a name="line-136"></a><span>        </span><a href="Type.html#tcIsLiftedTypeKind"><span class="hs-identifier hs-var">tcIsLiftedTypeKind</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tcIsConstraintKind"><span class="hs-identifier hs-var">tcIsConstraintKind</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tcReturnsConstraintKind"><span class="hs-identifier hs-var">tcReturnsConstraintKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span>        </span><span class="hs-comment">-- ** Common Kind</span><span>
</span><a name="line-139"></a><span>        </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span>        </span><span class="hs-comment">-- * Type free variables</span><span>
</span><a name="line-142"></a><span>        </span><a href="TyCoRep.html#tyCoFVsOfType"><span class="hs-identifier hs-var">tyCoFVsOfType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoFVsBndr"><span class="hs-identifier hs-var">tyCoFVsBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoFVsVarBndr"><span class="hs-identifier hs-var">tyCoFVsVarBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoFVsVarBndrs"><span class="hs-identifier hs-var">tyCoFVsVarBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-143"></a><span>        </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-144"></a><span>        </span><a href="TyCoRep.html#tyCoVarsOfTypeDSet"><span class="hs-identifier hs-var">tyCoVarsOfTypeDSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-145"></a><span>        </span><a href="TyCoRep.html#coVarsOfType"><span class="hs-identifier hs-var">coVarsOfType</span></a><span class="hs-special">,</span><span>
</span><a name="line-146"></a><span>        </span><a href="TyCoRep.html#coVarsOfTypes"><span class="hs-identifier hs-var">coVarsOfTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-147"></a><span>        </span><a href="Type.html#closeOverKindsDSet"><span class="hs-identifier hs-var">closeOverKindsDSet</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#closeOverKindsFV"><span class="hs-identifier hs-var">closeOverKindsFV</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#closeOverKindsList"><span class="hs-identifier hs-var">closeOverKindsList</span></a><span class="hs-special">,</span><span>
</span><a name="line-148"></a><span>        </span><a href="Type.html#closeOverKinds"><span class="hs-identifier hs-var">closeOverKinds</span></a><span class="hs-special">,</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span>        </span><a href="TyCoRep.html#noFreeVarsOfType"><span class="hs-identifier hs-var">noFreeVarsOfType</span></a><span class="hs-special">,</span><span>
</span><a name="line-151"></a><span>        </span><a href="Type.html#splitVisVarsOfType"><span class="hs-identifier hs-var">splitVisVarsOfType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#splitVisVarsOfTypes"><span class="hs-identifier hs-var">splitVisVarsOfTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-152"></a><span>        </span><a href="Type.html#expandTypeSynonyms"><span class="hs-identifier hs-var">expandTypeSynonyms</span></a><span class="hs-special">,</span><span>
</span><a name="line-153"></a><span>        </span><a href="TyCoRep.html#typeSize"><span class="hs-identifier hs-var">typeSize</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#occCheckExpand"><span class="hs-identifier hs-var">occCheckExpand</span></a><span class="hs-special">,</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span>        </span><span class="hs-comment">-- * Well-scoped lists of variables</span><span>
</span><a name="line-156"></a><span>        </span><a href="Type.html#dVarSetElemsWellScoped"><span class="hs-identifier hs-var">dVarSetElemsWellScoped</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#scopedSort"><span class="hs-identifier hs-var">scopedSort</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tyCoVarsOfTypeWellScoped"><span class="hs-identifier hs-var">tyCoVarsOfTypeWellScoped</span></a><span class="hs-special">,</span><span>
</span><a name="line-157"></a><span>        </span><a href="Type.html#tyCoVarsOfTypesWellScoped"><span class="hs-identifier hs-var">tyCoVarsOfTypesWellScoped</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tyCoVarsOfBindersWellScoped"><span class="hs-identifier hs-var">tyCoVarsOfBindersWellScoped</span></a><span class="hs-special">,</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span>        </span><span class="hs-comment">-- * Type comparison</span><span>
</span><a name="line-160"></a><span>        </span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#eqTypes"><span class="hs-identifier hs-var">eqTypes</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#nonDetCmpType"><span class="hs-identifier hs-var">nonDetCmpType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#nonDetCmpTypes"><span class="hs-identifier hs-var">nonDetCmpTypes</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#nonDetCmpTypeX"><span class="hs-identifier hs-var">nonDetCmpTypeX</span></a><span class="hs-special">,</span><span>
</span><a name="line-161"></a><span>        </span><a href="Type.html#nonDetCmpTypesX"><span class="hs-identifier hs-var">nonDetCmpTypesX</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#nonDetCmpTc"><span class="hs-identifier hs-var">nonDetCmpTc</span></a><span class="hs-special">,</span><span>
</span><a name="line-162"></a><span>        </span><a href="Type.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span>        </span><span class="hs-comment">-- * Forcing evaluation of types</span><span>
</span><a name="line-165"></a><span>        </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#seqTypes"><span class="hs-identifier hs-var">seqTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span>        </span><span class="hs-comment">-- * Other views onto Types</span><span>
</span><a name="line-168"></a><span>        </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span class="hs-special">,</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span>        </span><a href="Type.html#tyConsOfType"><span class="hs-identifier hs-var">tyConsOfType</span></a><span class="hs-special">,</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>        </span><span class="hs-comment">-- * Main type substitution data types</span><span>
</span><a name="line-173"></a><span>        </span><a href="TyCoRep.html#TvSubstEnv"><span class="hs-identifier hs-type">TvSubstEnv</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Representation widely visible</span><span>
</span><a name="line-174"></a><span>        </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Representation visible to a few friends</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span>        </span><span class="hs-comment">-- ** Manipulating type substitutions</span><span>
</span><a name="line-177"></a><span>        </span><a href="TyCoRep.html#emptyTvSubstEnv"><span class="hs-identifier hs-var">emptyTvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span>        </span><a href="TyCoRep.html#mkTCvSubst"><span class="hs-identifier hs-var">mkTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#mkTvSubstPrs"><span class="hs-identifier hs-var">mkTvSubstPrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-180"></a><span>        </span><a href="TyCoRep.html#zipTCvSubst"><span class="hs-identifier hs-var">zipTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-181"></a><span>        </span><a href="TyCoRep.html#notElemTCvSubst"><span class="hs-identifier hs-var">notElemTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-182"></a><span>        </span><a href="TyCoRep.html#getTvSubstEnv"><span class="hs-identifier hs-var">getTvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#setTvSubstEnv"><span class="hs-identifier hs-var">setTvSubstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-183"></a><span>        </span><a href="TyCoRep.html#zapTCvSubst"><span class="hs-identifier hs-var">zapTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#getTCvSubstRangeFVs"><span class="hs-identifier hs-var">getTCvSubstRangeFVs</span></a><span class="hs-special">,</span><span>
</span><a name="line-184"></a><span>        </span><a href="TyCoRep.html#extendTCvInScope"><span class="hs-identifier hs-var">extendTCvInScope</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTCvInScopeList"><span class="hs-identifier hs-var">extendTCvInScopeList</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTCvInScopeSet"><span class="hs-identifier hs-var">extendTCvInScopeSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-185"></a><span>        </span><a href="TyCoRep.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendCvSubst"><span class="hs-identifier hs-var">extendCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-186"></a><span>        </span><a href="TyCoRep.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTvSubstBinderAndInScope"><span class="hs-identifier hs-var">extendTvSubstBinderAndInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-187"></a><span>        </span><a href="TyCoRep.html#extendTvSubstList"><span class="hs-identifier hs-var">extendTvSubstList</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#extendTvSubstAndInScope"><span class="hs-identifier hs-var">extendTvSubstAndInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-188"></a><span>        </span><a href="TyCoRep.html#extendTCvSubstList"><span class="hs-identifier hs-var">extendTCvSubstList</span></a><span class="hs-special">,</span><span>
</span><a name="line-189"></a><span>        </span><a href="TyCoRep.html#extendTvSubstWithClone"><span class="hs-identifier hs-var">extendTvSubstWithClone</span></a><span class="hs-special">,</span><span>
</span><a name="line-190"></a><span>        </span><a href="TyCoRep.html#extendTCvSubstWithClone"><span class="hs-identifier hs-var">extendTCvSubstWithClone</span></a><span class="hs-special">,</span><span>
</span><a name="line-191"></a><span>        </span><a href="TyCoRep.html#isInScope"><span class="hs-identifier hs-var">isInScope</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#composeTCvSubstEnv"><span class="hs-identifier hs-var">composeTCvSubstEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#composeTCvSubst"><span class="hs-identifier hs-var">composeTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#zipTyEnv"><span class="hs-identifier hs-var">zipTyEnv</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#zipCoEnv"><span class="hs-identifier hs-var">zipCoEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-192"></a><span>        </span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#unionTCvSubst"><span class="hs-identifier hs-var">unionTCvSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span>        </span><span class="hs-comment">-- ** Performing substitution on types and kinds</span><span>
</span><a name="line-195"></a><span>        </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTys"><span class="hs-identifier hs-var">substTys</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTysWith"><span class="hs-identifier hs-var">substTysWith</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a><span class="hs-special">,</span><span>
</span><a name="line-196"></a><span>        </span><a href="TyCoRep.html#substTyAddInScope"><span class="hs-identifier hs-var">substTyAddInScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-197"></a><span>        </span><a href="TyCoRep.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTysUnchecked"><span class="hs-identifier hs-var">substTysUnchecked</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substThetaUnchecked"><span class="hs-identifier hs-var">substThetaUnchecked</span></a><span class="hs-special">,</span><span>
</span><a name="line-198"></a><span>        </span><a href="TyCoRep.html#substTyWithUnchecked"><span class="hs-identifier hs-var">substTyWithUnchecked</span></a><span class="hs-special">,</span><span>
</span><a name="line-199"></a><span>        </span><a href="TyCoRep.html#substCoUnchecked"><span class="hs-identifier hs-var">substCoUnchecked</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substCoWithUnchecked"><span class="hs-identifier hs-var">substCoWithUnchecked</span></a><span class="hs-special">,</span><span>
</span><a name="line-200"></a><span>        </span><a href="TyCoRep.html#substTyVarBndr"><span class="hs-identifier hs-var">substTyVarBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyVarBndrs"><span class="hs-identifier hs-var">substTyVarBndrs</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyVar"><span class="hs-identifier hs-var">substTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substTyVars"><span class="hs-identifier hs-var">substTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-201"></a><span>        </span><a href="TyCoRep.html#substVarBndr"><span class="hs-identifier hs-var">substVarBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#substVarBndrs"><span class="hs-identifier hs-var">substVarBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-202"></a><span>        </span><a href="TyCoRep.html#cloneTyVarBndr"><span class="hs-identifier hs-var">cloneTyVarBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#cloneTyVarBndrs"><span class="hs-identifier hs-var">cloneTyVarBndrs</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#lookupTyVar"><span class="hs-identifier hs-var">lookupTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span>        </span><span class="hs-comment">-- * Pretty-printing</span><span>
</span><a name="line-205"></a><span>        </span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprParendType"><span class="hs-identifier hs-var">pprParendType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprPrecType"><span class="hs-identifier hs-var">pprPrecType</span></a><span class="hs-special">,</span><span>
</span><a name="line-206"></a><span>        </span><a href="TyCoRep.html#pprTypeApp"><span class="hs-identifier hs-var">pprTypeApp</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTyThingCategory"><span class="hs-identifier hs-var">pprTyThingCategory</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprShortTyThing"><span class="hs-identifier hs-var">pprShortTyThing</span></a><span class="hs-special">,</span><span>
</span><a name="line-207"></a><span>        </span><a href="TyCoRep.html#pprTCvBndr"><span class="hs-identifier hs-var">pprTCvBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTCvBndrs"><span class="hs-identifier hs-var">pprTCvBndrs</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprForAll"><span class="hs-identifier hs-var">pprForAll</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprUserForAll"><span class="hs-identifier hs-var">pprUserForAll</span></a><span class="hs-special">,</span><span>
</span><a name="line-208"></a><span>        </span><a href="TyCoRep.html#pprSigmaType"><span class="hs-identifier hs-var">pprSigmaType</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprWithExplicitKindsWhen"><span class="hs-identifier hs-var">pprWithExplicitKindsWhen</span></a><span class="hs-special">,</span><span>
</span><a name="line-209"></a><span>        </span><a href="TyCoRep.html#pprTheta"><span class="hs-identifier hs-var">pprTheta</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprThetaArrowTy"><span class="hs-identifier hs-var">pprThetaArrowTy</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprClassPred"><span class="hs-identifier hs-var">pprClassPred</span></a><span class="hs-special">,</span><span>
</span><a name="line-210"></a><span>        </span><a href="TyCoRep.html#pprKind"><span class="hs-identifier hs-var">pprKind</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprParendKind"><span class="hs-identifier hs-var">pprParendKind</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#pprSourceTyCon"><span class="hs-identifier hs-var">pprSourceTyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-211"></a><span>        </span><a href="BasicTypes.html#PprPrec"><span class="hs-identifier hs-type">PprPrec</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#topPrec"><span class="hs-identifier hs-var">topPrec</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#sigPrec"><span class="hs-identifier hs-var">sigPrec</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#opPrec"><span class="hs-identifier hs-var">opPrec</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#funPrec"><span class="hs-identifier hs-var">funPrec</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#appPrec"><span class="hs-identifier hs-var">appPrec</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#maybeParen"><span class="hs-identifier hs-var">maybeParen</span></a><span class="hs-special">,</span><span>
</span><a name="line-212"></a><span>        </span><a href="TyCoRep.html#pprTyVar"><span class="hs-identifier hs-var">pprTyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-213"></a><span>        </span><a href="Type.html#pprWithTYPE"><span class="hs-identifier hs-var">pprWithTYPE</span></a><span class="hs-special">,</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span>        </span><span class="hs-comment">-- * Tidying type related things up for printing</span><span>
</span><a name="line-216"></a><span>        </span><a href="TyCoRep.html#tidyType"><span class="hs-identifier hs-var">tidyType</span></a><span class="hs-special">,</span><span>      </span><a href="TyCoRep.html#tidyTypes"><span class="hs-identifier hs-var">tidyTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-217"></a><span>        </span><a href="TyCoRep.html#tidyOpenType"><span class="hs-identifier hs-var">tidyOpenType</span></a><span class="hs-special">,</span><span>  </span><a href="TyCoRep.html#tidyOpenTypes"><span class="hs-identifier hs-var">tidyOpenTypes</span></a><span class="hs-special">,</span><span>
</span><a name="line-218"></a><span>        </span><a href="TyCoRep.html#tidyOpenKind"><span class="hs-identifier hs-var">tidyOpenKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-219"></a><span>        </span><a href="TyCoRep.html#tidyVarBndr"><span class="hs-identifier hs-var">tidyVarBndr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyVarBndrs"><span class="hs-identifier hs-var">tidyVarBndrs</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyFreeTyCoVars"><span class="hs-identifier hs-var">tidyFreeTyCoVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-220"></a><span>        </span><a href="TyCoRep.html#tidyOpenTyCoVar"><span class="hs-identifier hs-var">tidyOpenTyCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyOpenTyCoVars"><span class="hs-identifier hs-var">tidyOpenTyCoVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-221"></a><span>        </span><a href="TyCoRep.html#tidyTyCoVarOcc"><span class="hs-identifier hs-var">tidyTyCoVarOcc</span></a><span class="hs-special">,</span><span>
</span><a name="line-222"></a><span>        </span><a href="TyCoRep.html#tidyTopType"><span class="hs-identifier hs-var">tidyTopType</span></a><span class="hs-special">,</span><span>
</span><a name="line-223"></a><span>        </span><a href="TyCoRep.html#tidyKind"><span class="hs-identifier hs-var">tidyKind</span></a><span class="hs-special">,</span><span>
</span><a name="line-224"></a><span>        </span><a href="TyCoRep.html#tidyTyCoVarBinder"><span class="hs-identifier hs-var">tidyTyCoVarBinder</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#tidyTyCoVarBinders"><span class="hs-identifier hs-var">tidyTyCoVarBinders</span></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-229"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-comment">-- We import the representation and primitive functions from TyCoRep.</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- Many things are reexported, but not the representation!</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-keyword">import</span><span> </span><a href="Kind.html"><span class="hs-identifier">Kind</span></a><span>
</span><a name="line-237"></a><span class="hs-keyword">import</span><span> </span><a href="TyCoRep.html"><span class="hs-identifier">TyCoRep</span></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-comment">-- friends:</span><span>
</span><a name="line-240"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-241"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-242"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-243"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSet.html"><span class="hs-identifier">UniqSet</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-246"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-247"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span>
</span><a name="line-248"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TysWiredIn.html#listTyCon"><span class="hs-identifier hs-var">listTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#typeNatKind"><span class="hs-identifier hs-var">typeNatKind</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a><span>
</span><a name="line-249"></a><span>                                 </span><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#typeSymbolKind"><span class="hs-identifier hs-var">typeSymbolKind</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-250"></a><span>                                 </span><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-251"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-252"></a><span class="hs-keyword">import</span><span> </span><a href="CoAxiom.html"><span class="hs-identifier">CoAxiom</span></a><span>
</span><a name="line-253"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span class="hs-special">(</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkGReflCo"><span class="hs-identifier hs-var">mkGReflCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span>
</span><a name="line-254"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkAxiomRuleCo"><span class="hs-identifier hs-var">mkAxiomRuleCo</span></a><span>
</span><a name="line-255"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a><span>
</span><a name="line-256"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkLRCo"><span class="hs-identifier hs-var">mkLRCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a><span>
</span><a name="line-257"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a><span>
</span><a name="line-258"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="Coercion.html#decomposePiCos"><span class="hs-identifier hs-var">decomposePiCos</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a><span>
</span><a name="line-259"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var">isReflexiveCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">-- others</span><span>
</span><a name="line-262"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-263"></a><span class="hs-keyword">import</span><span> </span><a href="FV.html"><span class="hs-identifier">FV</span></a><span>
</span><a name="line-264"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-265"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-266"></a><span class="hs-keyword">import</span><span> </span><a href="Pair.html"><span class="hs-identifier">Pair</span></a><span>
</span><a name="line-267"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>  </span><span class="hs-special">(</span><span> </span><a href="DynFlags.html#gopt_set"><span class="hs-identifier hs-var">gopt_set</span></a><span class="hs-special">,</span><span> </span><a href="DynFlags.html#GeneralFlag"><span class="hs-identifier hs-type">GeneralFlag</span></a><span class="hs-special">(</span><a href="DynFlags.html#Opt_PrintExplicitRuntimeReps"><span class="hs-identifier hs-var">Opt_PrintExplicitRuntimeReps</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-268"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span>
</span><a name="line-269"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Unique.html#nonDetCmpUnique"><span class="hs-identifier hs-var">nonDetCmpUnique</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>           </span><span class="hs-special">(</span><span> </span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-273"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-comment">-- $type_classification</span><span>
</span><a name="line-276"></a><span class="hs-comment">-- #type_classification#</span><span>
</span><a name="line-277"></a><span class="hs-comment">--</span><span>
</span><a name="line-278"></a><span class="hs-comment">-- Types are one of:</span><span>
</span><a name="line-279"></a><span class="hs-comment">--</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- [Unboxed]            Iff its representation is other than a pointer</span><span>
</span><a name="line-281"></a><span class="hs-comment">--                      Unboxed types are also unlifted.</span><span>
</span><a name="line-282"></a><span class="hs-comment">--</span><span>
</span><a name="line-283"></a><span class="hs-comment">-- [Lifted]             Iff it has bottom as an element.</span><span>
</span><a name="line-284"></a><span class="hs-comment">--                      Closures always have lifted types: i.e. any</span><span>
</span><a name="line-285"></a><span class="hs-comment">--                      let-bound identifier in Core must have a lifted</span><span>
</span><a name="line-286"></a><span class="hs-comment">--                      type. Operationally, a lifted object is one that</span><span>
</span><a name="line-287"></a><span class="hs-comment">--                      can be entered.</span><span>
</span><a name="line-288"></a><span class="hs-comment">--                      Only lifted types may be unified with a type variable.</span><span>
</span><a name="line-289"></a><span class="hs-comment">--</span><span>
</span><a name="line-290"></a><span class="hs-comment">-- [Algebraic]          Iff it is a type with one or more constructors, whether</span><span>
</span><a name="line-291"></a><span class="hs-comment">--                      declared with @data@ or @newtype@.</span><span>
</span><a name="line-292"></a><span class="hs-comment">--                      An algebraic type is one that can be deconstructed</span><span>
</span><a name="line-293"></a><span class="hs-comment">--                      with a case expression. This is /not/ the same as</span><span>
</span><a name="line-294"></a><span class="hs-comment">--                      lifted types, because we also include unboxed</span><span>
</span><a name="line-295"></a><span class="hs-comment">--                      tuples in this classification.</span><span>
</span><a name="line-296"></a><span class="hs-comment">--</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- [Data]               Iff it is a type declared with @data@, or a boxed tuple.</span><span>
</span><a name="line-298"></a><span class="hs-comment">--</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- [Primitive]          Iff it is a built-in type that can't be expressed in Haskell.</span><span>
</span><a name="line-300"></a><span class="hs-comment">--</span><span>
</span><a name="line-301"></a><span class="hs-comment">-- Currently, all primitive types are unlifted, but that's not necessarily</span><span>
</span><a name="line-302"></a><span class="hs-comment">-- the case: for example, @Int@ could be primitive.</span><span>
</span><a name="line-303"></a><span class="hs-comment">--</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- Some primitive types are unboxed, such as @Int#@, whereas some are boxed</span><span>
</span><a name="line-305"></a><span class="hs-comment">-- but unlifted (such as @ByteArray#@).  The only primitive types that we</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- classify as algebraic are the unboxed tuples.</span><span>
</span><a name="line-307"></a><span class="hs-comment">--</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- Some examples of type classifications that may make this a bit clearer are:</span><span>
</span><a name="line-309"></a><span class="hs-comment">--</span><span>
</span><a name="line-310"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-311"></a><span class="hs-comment">-- Type          primitive       boxed           lifted          algebraic</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-313"></a><span class="hs-comment">-- Int#          Yes             No              No              No</span><span>
</span><a name="line-314"></a><span class="hs-comment">-- ByteArray#    Yes             Yes             No              No</span><span>
</span><a name="line-315"></a><span class="hs-comment">-- (\# a, b \#)  Yes             No              No              Yes</span><span>
</span><a name="line-316"></a><span class="hs-comment">-- (\# a | b \#) Yes             No              No              Yes</span><span>
</span><a name="line-317"></a><span class="hs-comment">-- (  a, b  )    No              Yes             Yes             Yes</span><span>
</span><a name="line-318"></a><span class="hs-comment">-- [a]           No              Yes             Yes             Yes</span><span>
</span><a name="line-319"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span class="hs-comment">-- $representation_types</span><span>
</span><a name="line-322"></a><span class="hs-comment">-- A /source type/ is a type that is a separate type as far as the type checker is</span><span>
</span><a name="line-323"></a><span class="hs-comment">-- concerned, but which has a more low-level representation as far as Core-to-Core</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- passes and the rest of the back end is concerned.</span><span>
</span><a name="line-325"></a><span class="hs-comment">--</span><span>
</span><a name="line-326"></a><span class="hs-comment">-- You don't normally have to worry about this, as the utility functions in</span><span>
</span><a name="line-327"></a><span class="hs-comment">-- this module will automatically convert a source into a representation type</span><span>
</span><a name="line-328"></a><span class="hs-comment">-- if they are spotted, to the best of its abilities. If you don't want this</span><span>
</span><a name="line-329"></a><span class="hs-comment">-- to happen, use the equivalent functions from the &quot;TcType&quot; module.</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Type representation
*                                                                      *
************************************************************************

Note [coreView vs tcView]
~~~~~~~~~~~~~~~~~~~~~~~~~
So far as the typechecker is concerned, 'Constraint' and 'TYPE
LiftedRep' are distinct kinds.

But in Core these two are treated as identical.

We implement this by making 'coreView' convert 'Constraint' to 'TYPE
LiftedRep' on the fly.  The function tcView (used in the type checker)
does not do this.

See also Trac #11715, which tracks removing this inconsistency.

-}</span><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-comment">-- | Gives the typechecker view of a type. This unwraps synonyms but</span><span>
</span><a name="line-354"></a><span class="hs-comment">-- leaves 'Constraint' alone. c.f. coreView, which turns Constraint into</span><span>
</span><a name="line-355"></a><span class="hs-comment">-- TYPE LiftedRep. Returns Nothing if no unwrapping happens.</span><span>
</span><a name="line-356"></a><span class="hs-comment">-- See also Note [coreView vs tcView]</span><span>
</span><a name="line-357"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">tcView</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-358"></a><span class="hs-identifier">tcView</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-359"></a><a name="tcView"><a href="Type.html#tcView"><span class="hs-identifier">tcView</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681924775"><a href="#local-6989586621681924775"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681924776"><a href="#local-6989586621681924776"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681924777"><a href="#local-6989586621681924777"><span class="hs-identifier">tenv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924778"><a href="#local-6989586621681924778"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924779"><a href="#local-6989586621681924779"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#expandSynTyCon_maybe"><span class="hs-identifier hs-var">expandSynTyCon_maybe</span></a><span> </span><a href="#local-6989586621681924775"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681924776"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-360"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTvSubstPrs"><span class="hs-identifier hs-var">mkTvSubstPrs</span></a><span> </span><a href="#local-6989586621681924777"><span class="hs-identifier hs-var">tenv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924778"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924779"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">)</span><span>
</span><a name="line-361"></a><span>               </span><span class="hs-comment">-- The free vars of 'rhs' should all be bound by 'tenv', so it's</span><span>
</span><a name="line-362"></a><span>               </span><span class="hs-comment">-- ok to use 'substTy' here.</span><span>
</span><a name="line-363"></a><span>               </span><span class="hs-comment">-- See also Note [The substitution invariant] in TyCoRep.</span><span>
</span><a name="line-364"></a><span>               </span><span class="hs-comment">-- Its important to use mkAppTys, rather than (foldl AppTy),</span><span>
</span><a name="line-365"></a><span>               </span><span class="hs-comment">-- because the function part might well return a</span><span>
</span><a name="line-366"></a><span>               </span><span class="hs-comment">-- partially-applied type constructor; indeed, usually will!</span><span>
</span><a name="line-367"></a><span class="hs-identifier">tcView</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">coreView</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-370"></a><span class="hs-identifier">coreView</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-371"></a><span class="hs-comment">-- ^ This function Strips off the /top layer only/ of a type synonym</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- application (if any) its underlying representation type.</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- Returns Nothing if there is nothing to look through.</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- This function considers 'Constraint' to be a synonym of @TYPE LiftedRep@.</span><span>
</span><a name="line-375"></a><span class="hs-comment">--</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- By being non-recursive and inlined, this case analysis gets efficiently</span><span>
</span><a name="line-377"></a><span class="hs-comment">-- joined onto the case analysis that the caller is already doing</span><span>
</span><a name="line-378"></a><a name="coreView"><a href="Type.html#coreView"><span class="hs-identifier">coreView</span></a></a><span> </span><a name="local-6989586621681924780"><a href="#local-6989586621681924780"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681924781"><a href="#local-6989586621681924781"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681924782"><a href="#local-6989586621681924782"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-379"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681924783"><a href="#local-6989586621681924783"><span class="hs-identifier">tenv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924784"><a href="#local-6989586621681924784"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924785"><a href="#local-6989586621681924785"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#expandSynTyCon_maybe"><span class="hs-identifier hs-var">expandSynTyCon_maybe</span></a><span> </span><a href="#local-6989586621681924781"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681924782"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-380"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTvSubstPrs"><span class="hs-identifier hs-var">mkTvSubstPrs</span></a><span> </span><a href="#local-6989586621681924783"><span class="hs-identifier hs-var">tenv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924784"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924785"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">)</span><span>
</span><a name="line-381"></a><span>    </span><span class="hs-comment">-- This equation is exactly like tcView</span><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span>  </span><span class="hs-comment">-- At the Core level, Constraint = Type</span><span>
</span><a name="line-384"></a><span>  </span><span class="hs-comment">-- See Note [coreView vs tcView]</span><span>
</span><a name="line-385"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Kind.html#isConstraintKindCon"><span class="hs-identifier hs-var">isConstraintKindCon</span></a><span> </span><a href="#local-6989586621681924781"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-386"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier hs-var">ty</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-identifier">coreView</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-comment">-----------------------------------------------</span><span>
</span><a name="line-392"></a><span class="hs-identifier">expandTypeSynonyms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-393"></a><span class="hs-comment">-- ^ Expand out all type synonyms.  Actually, it'd suffice to expand out</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- just the ones that discard type variables (e.g.  type Funny a = Int)</span><span>
</span><a name="line-395"></a><span class="hs-comment">-- But we don't know which those are currently, so we just expand all.</span><span>
</span><a name="line-396"></a><span class="hs-comment">--</span><span>
</span><a name="line-397"></a><span class="hs-comment">-- 'expandTypeSynonyms' only expands out type synonyms mentioned in the type,</span><span>
</span><a name="line-398"></a><span class="hs-comment">-- not in the kinds of any TyCon or TyVar mentioned in the type.</span><span>
</span><a name="line-399"></a><span class="hs-comment">--</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- Keep this synchronized with 'synonymTyConsOfType'</span><span>
</span><a name="line-401"></a><a name="expandTypeSynonyms"><a href="Type.html#expandTypeSynonyms"><span class="hs-identifier">expandTypeSynonyms</span></a></a><span> </span><a name="local-6989586621681924786"><a href="#local-6989586621681924786"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-402"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><a href="#local-6989586621681924787"><span class="hs-identifier hs-var">in_scope</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924786"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-403"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-404"></a><span>    </span><a name="local-6989586621681924787"><a href="#local-6989586621681924787"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621681924786"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span>    </span><a name="local-6989586621681924788"><a href="#local-6989586621681924788"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681924793"><a href="#local-6989586621681924793"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681924794"><a href="#local-6989586621681924794"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681924795"><a href="#local-6989586621681924795"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681924797"><a href="#local-6989586621681924797"><span class="hs-identifier">tenv</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924798"><a href="#local-6989586621681924798"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924799"><a href="#local-6989586621681924799"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#expandSynTyCon_maybe"><span class="hs-identifier hs-var">expandSynTyCon_maybe</span></a><span> </span><a href="#local-6989586621681924794"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681924796"><span class="hs-identifier hs-var">expanded_tys</span></a><span>
</span><a name="line-408"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681924800"><a href="#local-6989586621681924800"><span class="hs-identifier">subst'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTvSubst"><span class="hs-identifier hs-var">mkTvSubst</span></a><span> </span><a href="#local-6989586621681924787"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a><span> </span><a href="#local-6989586621681924797"><span class="hs-identifier hs-var">tenv</span></a><span class="hs-special">)</span><span>
</span><a name="line-409"></a><span>            </span><span class="hs-comment">-- Make a fresh substitution; rhs has nothing to</span><span>
</span><a name="line-410"></a><span>            </span><span class="hs-comment">-- do with anything that has happened so far</span><span>
</span><a name="line-411"></a><span>            </span><span class="hs-comment">-- NB: if you make changes here, be sure to build an</span><span>
</span><a name="line-412"></a><span>            </span><span class="hs-comment">--     /idempotent/ substitution, even in the nested case</span><span>
</span><a name="line-413"></a><span>            </span><span class="hs-comment">--        type T a b = a -&gt; b</span><span>
</span><a name="line-414"></a><span>            </span><span class="hs-comment">--        type S x y = T y x</span><span>
</span><a name="line-415"></a><span>            </span><span class="hs-comment">-- (Trac #11665)</span><span>
</span><a name="line-416"></a><span>        </span><span class="hs-keyword">in</span><span>  </span><a href="Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924800"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-6989586621681924798"><span class="hs-identifier hs-var">rhs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924799"><span class="hs-identifier hs-var">tys'</span></a><span>
</span><a name="line-417"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-418"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="#local-6989586621681924794"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681924796"><span class="hs-identifier hs-var">expanded_tys</span></a><span>
</span><a name="line-419"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-420"></a><span>        </span><a name="local-6989586621681924796"><a href="#local-6989586621681924796"><span class="hs-identifier">expanded_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924793"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924795"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-6989586621681924801"><a href="#local-6989586621681924801"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a href="#local-6989586621681924801"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-423"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681924802"><a href="#local-6989586621681924802"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681924803"><a href="#local-6989586621681924803"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTyVar"><span class="hs-identifier hs-var">substTyVar</span></a><span> </span><a href="#local-6989586621681924802"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924803"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-424"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681924804"><a href="#local-6989586621681924804"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681924805"><a href="#local-6989586621681924805"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681924806"><a href="#local-6989586621681924806"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924804"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924805"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924804"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924806"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-425"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681924807"><a href="#local-6989586621681924807"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681924808"><a href="#local-6989586621681924808"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681924809"><a href="#local-6989586621681924809"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924807"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924808"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924807"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924809"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-427"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681924810"><a href="#local-6989586621681924810"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681924811"><a href="#local-6989586621681924811"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681924812"><a href="#local-6989586621681924812"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681924813"><a href="#local-6989586621681924813"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-428"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681924814"><a href="#local-6989586621681924814"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924815"><a href="#local-6989586621681924815"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substVarBndrUsing"><span class="hs-identifier hs-var">substVarBndrUsing</span></a><span> </span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924810"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924811"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-429"></a><span>        </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681924815"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681924812"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924814"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-6989586621681924813"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-430"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681924816"><a href="#local-6989586621681924816"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681924817"><a href="#local-6989586621681924817"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681924818"><a href="#local-6989586621681924818"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924816"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924817"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924816"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924818"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681924819"><a href="#local-6989586621681924819"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621681924820"><a href="#local-6989586621681924820"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924819"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924820"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span>    </span><a name="local-6989586621681924789"><a href="#local-6989586621681924789"><span class="hs-identifier">go_mco</span></a></a><span> </span><span class="hs-identifier">_</span><span>     </span><a href="TyCoRep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a><span>
</span><a name="line-434"></a><span>    </span><span class="hs-identifier">go_mco</span><span> </span><a name="local-6989586621681924821"><a href="#local-6989586621681924821"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a><span> </span><a name="local-6989586621681924822"><a href="#local-6989586621681924822"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924821"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924822"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span>    </span><a name="local-6989586621681924790"><a href="#local-6989586621681924790"><span class="hs-identifier">go_co</span></a></a><span> </span><a name="local-6989586621681924823"><a href="#local-6989586621681924823"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621681924824"><a href="#local-6989586621681924824"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-437"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924823"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924824"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-438"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924825"><a href="#local-6989586621681924825"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a><span> </span><a name="local-6989586621681924826"><a href="#local-6989586621681924826"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924827"><a href="#local-6989586621681924827"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681924828"><a href="#local-6989586621681924828"><span class="hs-identifier">mco</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-439"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkGReflCo"><span class="hs-identifier hs-var">mkGReflCo</span></a><span> </span><a href="#local-6989586621681924826"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924825"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924827"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924789"><span class="hs-identifier hs-var">go_mco</span></a><span> </span><a href="#local-6989586621681924825"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924828"><span class="hs-identifier hs-var">mco</span></a><span class="hs-special">)</span><span>
</span><a name="line-440"></a><span>       </span><span class="hs-comment">-- NB: coercions are always expanded upon creation</span><span>
</span><a name="line-441"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924829"><a href="#local-6989586621681924829"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a name="local-6989586621681924830"><a href="#local-6989586621681924830"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924831"><a href="#local-6989586621681924831"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681924832"><a href="#local-6989586621681924832"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-442"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="#local-6989586621681924830"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681924831"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924829"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924832"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-443"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924833"><a href="#local-6989586621681924833"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621681924834"><a href="#local-6989586621681924834"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621681924835"><a href="#local-6989586621681924835"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-444"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924833"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924834"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924833"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924835"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-445"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924836"><a href="#local-6989586621681924836"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-6989586621681924837"><a href="#local-6989586621681924837"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681924838"><a href="#local-6989586621681924838"><span class="hs-identifier">kind_co</span></a></a><span> </span><a name="local-6989586621681924839"><a href="#local-6989586621681924839"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-446"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681924840"><a href="#local-6989586621681924840"><span class="hs-identifier">subst'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924841"><a href="#local-6989586621681924841"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924842"><a href="#local-6989586621681924842"><span class="hs-identifier">kind_co'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924792"><span class="hs-identifier hs-var">go_cobndr</span></a><span> </span><a href="#local-6989586621681924836"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924837"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681924838"><span class="hs-identifier hs-var">kind_co</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-447"></a><span>        </span><a href="Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a><span> </span><a href="#local-6989586621681924841"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681924842"><span class="hs-identifier hs-var">kind_co'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924840"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-6989586621681924839"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924843"><a href="#local-6989586621681924843"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><a name="local-6989586621681924844"><a href="#local-6989586621681924844"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924845"><a href="#local-6989586621681924845"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621681924846"><a href="#local-6989586621681924846"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-449"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a><span> </span><a href="#local-6989586621681924844"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924843"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924845"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924843"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924846"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924847"><a href="#local-6989586621681924847"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-6989586621681924848"><a href="#local-6989586621681924848"><span class="hs-identifier">cv</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-451"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substCoVar"><span class="hs-identifier hs-var">substCoVar</span></a><span> </span><a href="#local-6989586621681924847"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924848"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-452"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924849"><a href="#local-6989586621681924849"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a name="local-6989586621681924850"><a href="#local-6989586621681924850"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621681924851"><a href="#local-6989586621681924851"><span class="hs-identifier">ind</span></a></a><span> </span><a name="local-6989586621681924852"><a href="#local-6989586621681924852"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-453"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a><span> </span><a href="#local-6989586621681924850"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-6989586621681924851"><span class="hs-identifier hs-var">ind</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924849"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924852"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924853"><a href="#local-6989586621681924853"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a name="local-6989586621681924854"><a href="#local-6989586621681924854"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621681924855"><a href="#local-6989586621681924855"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924856"><a href="#local-6989586621681924856"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681924857"><a href="#local-6989586621681924857"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-455"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924791"><span class="hs-identifier hs-var">go_prov</span></a><span> </span><a href="#local-6989586621681924853"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924854"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924855"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924853"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924856"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924788"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924853"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924857"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-456"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924858"><a href="#local-6989586621681924858"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621681924859"><a href="#local-6989586621681924859"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924858"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924859"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-458"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924860"><a href="#local-6989586621681924860"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-6989586621681924861"><a href="#local-6989586621681924861"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621681924862"><a href="#local-6989586621681924862"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924860"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924861"><span class="hs-identifier hs-var">co1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924860"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924862"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span>
</span><a name="line-460"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924863"><a href="#local-6989586621681924863"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a name="local-6989586621681924864"><a href="#local-6989586621681924864"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924865"><a href="#local-6989586621681924865"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681924866"><a href="#local-6989586621681924866"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-461"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><a href="#local-6989586621681924864"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681924865"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924863"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924866"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-462"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924867"><a href="#local-6989586621681924867"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><a name="local-6989586621681924868"><a href="#local-6989586621681924868"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621681924869"><a href="#local-6989586621681924869"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-463"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkLRCo"><span class="hs-identifier hs-var">mkLRCo</span></a><span> </span><a href="#local-6989586621681924868"><span class="hs-identifier hs-var">lr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924867"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924869"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-464"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924870"><a href="#local-6989586621681924870"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621681924871"><a href="#local-6989586621681924871"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621681924872"><a href="#local-6989586621681924872"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-465"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924870"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924871"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924870"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924872"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-466"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924873"><a href="#local-6989586621681924873"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a name="local-6989586621681924874"><a href="#local-6989586621681924874"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-467"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924873"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924874"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-468"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924875"><a href="#local-6989586621681924875"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-6989586621681924876"><a href="#local-6989586621681924876"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-469"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924875"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924876"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-470"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681924877"><a href="#local-6989586621681924877"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a name="local-6989586621681924878"><a href="#local-6989586621681924878"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621681924879"><a href="#local-6989586621681924879"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-471"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a href="#local-6989586621681924878"><span class="hs-identifier hs-var">ax</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924877"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924879"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span>
</span><a name="line-472"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><a name="local-6989586621681924880"><a href="#local-6989586621681924880"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-473"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;expandTypeSynonyms hit a hole&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681924880"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-474"></a><span>
</span><a name="line-475"></a><span>    </span><a name="local-6989586621681924791"><a href="#local-6989586621681924791"><span class="hs-identifier">go_prov</span></a></a><span> </span><span class="hs-identifier">_</span><span>     </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>
</span><a name="line-476"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><a name="local-6989586621681924881"><a href="#local-6989586621681924881"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a name="local-6989586621681924882"><a href="#local-6989586621681924882"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924881"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924882"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-477"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><a name="local-6989586621681924883"><a href="#local-6989586621681924883"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a name="local-6989586621681924884"><a href="#local-6989586621681924884"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924883"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681924884"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-478"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-identifier">_</span><span>     </span><a name="local-6989586621681924885"><a href="#local-6989586621681924885"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924885"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span>      </span><span class="hs-comment">-- the &quot;False&quot; and &quot;const&quot; are to accommodate the type of</span><span>
</span><a name="line-481"></a><span>      </span><span class="hs-comment">-- substForAllCoBndrUsing, which is general enough to</span><span>
</span><a name="line-482"></a><span>      </span><span class="hs-comment">-- handle coercion optimization (which sometimes swaps the</span><span>
</span><a name="line-483"></a><span>      </span><span class="hs-comment">-- order of a coercion)</span><span>
</span><a name="line-484"></a><span>    </span><a name="local-6989586621681924792"><a href="#local-6989586621681924792"><span class="hs-identifier">go_cobndr</span></a></a><span> </span><a name="local-6989586621681924886"><a href="#local-6989586621681924886"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substForAllCoBndrUsing"><span class="hs-identifier hs-var">substForAllCoBndrUsing</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924790"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681924886"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924886"><span class="hs-identifier hs-var">subst</span></a><span>
</span><a name="line-485"></a><span>
</span><a name="line-486"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
   Analyzing types
*                                                                      *
************************************************************************

These functions do a map-like operation over types, performing some operation
on all variables and binding sites. Primarily used for zonking.

Note [Efficiency for mapCoercion ForAllCo case]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As noted in Note [Forall coercions] in TyCoRep, a ForAllCo is a bit redundant.
It stores a TyCoVar and a Coercion, where the kind of the TyCoVar always matches
the left-hand kind of the coercion. This is convenient lots of the time, but
not when mapping a function over a coercion.

The problem is that tcm_tybinder will affect the TyCoVar's kind and
mapCoercion will affect the Coercion, and we hope that the results will be
the same. Even if they are the same (which should generally happen with
correct algorithms), then there is an efficiency issue. In particular,
this problem seems to make what should be a linear algorithm into a potentially
exponential one. But it's only going to be bad in the case where there's
lots of foralls in the kinds of other foralls. Like this:

  forall a : (forall b : (forall c : ...). ...). ...

This construction seems unlikely. So we'll do the inefficient, easy way
for now.

Note [Specialising mappers]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
These INLINABLE pragmas are indispensable. mapType/mapCoercion are used
to implement zonking, and it's vital that they get specialised to the TcM
monad. This specialisation happens automatically (that is, without a
SPECIALISE pragma) as long as the definitions are INLINABLE. For example,
this one change made a 20% allocation difference in perf/compiler/T5030.

-}</span><span>
</span><a name="line-525"></a><span>
</span><a name="line-526"></a><span class="hs-comment">-- | This describes how a &quot;map&quot; operation over a type/coercion should behave</span><span>
</span><a name="line-527"></a><span class="hs-keyword">data</span><span> </span><a name="TyCoMapper"><a href="Type.html#TyCoMapper"><span class="hs-identifier">TyCoMapper</span></a></a><span> </span><a name="local-6989586621681924766"><a href="#local-6989586621681924766"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681924767"><a href="#local-6989586621681924767"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-528"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TyCoMapper"><a href="Type.html#TyCoMapper"><span class="hs-identifier">TyCoMapper</span></a></a><span>
</span><a name="line-529"></a><span>      </span><span class="hs-special">{</span><span> </span><a name="tcm_smart"><a href="Type.html#tcm_smart"><span class="hs-identifier">tcm_smart</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- ^ Should the new type be created with smart</span><span>
</span><a name="line-530"></a><span>                          </span><span class="hs-comment">-- constructors?</span><span>
</span><a name="line-531"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="tcm_tyvar"><a href="Type.html#tcm_tyvar"><span class="hs-identifier">tcm_tyvar</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621681924766"><span class="hs-identifier hs-type">env</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924767"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-532"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="tcm_covar"><a href="Type.html#tcm_covar"><span class="hs-identifier">tcm_covar</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621681924766"><span class="hs-identifier hs-type">env</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924767"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-533"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="tcm_hole"><a href="Type.html#tcm_hole"><span class="hs-identifier">tcm_hole</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621681924766"><span class="hs-identifier hs-type">env</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924767"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-534"></a><span>          </span><span class="hs-comment">-- ^ What to do with coercion holes.</span><span>
</span><a name="line-535"></a><span>          </span><span class="hs-comment">-- See Note [Coercion holes] in TyCoRep.</span><span>
</span><a name="line-536"></a><span>
</span><a name="line-537"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="tcm_tycobinder"><a href="Type.html#tcm_tycobinder"><span class="hs-identifier">tcm_tycobinder</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621681924766"><span class="hs-identifier hs-type">env</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924767"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924766"><span class="hs-identifier hs-type">env</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">)</span><span>
</span><a name="line-538"></a><span>          </span><span class="hs-comment">-- ^ The returned env is used in the extended scope</span><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="tcm_tycon"><a href="Type.html#tcm_tycon"><span class="hs-identifier">tcm_tycon</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924767"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-541"></a><span>          </span><span class="hs-comment">-- ^ This is used only to turn 'TcTyCon's into 'TyCon's.</span><span>
</span><a name="line-542"></a><span>          </span><span class="hs-comment">-- See Note [Type checking recursive type and class declarations]</span><span>
</span><a name="line-543"></a><span>          </span><span class="hs-comment">-- in TcTyClsDecls</span><span>
</span><a name="line-544"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-545"></a><span>
</span><a name="line-546"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">mapType</span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- See Note [Specialising mappers]</span><span>
</span><a name="line-547"></a><span class="hs-identifier">mapType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621681924773"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-type">TyCoMapper</span></a><span> </span><a href="#local-6989586621681924774"><span class="hs-identifier hs-type">env</span></a><span> </span><a href="#local-6989586621681924773"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924774"><span class="hs-identifier hs-type">env</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924773"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-548"></a><a name="mapType"><a href="Type.html#mapType"><span class="hs-identifier">mapType</span></a></a><span> </span><a name="local-6989586621681924887"><a href="#local-6989586621681924887"><span class="hs-identifier">mapper</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-var">TyCoMapper</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcm_smart</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681924888"><a href="#local-6989586621681924888"><span class="hs-identifier">smart</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681924889"><a href="#local-6989586621681924889"><span class="hs-identifier">tyvar</span></a></a><span>
</span><a name="line-549"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tycobinder</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681924890"><a href="#local-6989586621681924890"><span class="hs-identifier">tycobinder</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681924891"><a href="#local-6989586621681924891"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-550"></a><span>        </span><a name="local-6989586621681924892"><a href="#local-6989586621681924892"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681924893"><a href="#local-6989586621681924893"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-551"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924894"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924893"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-552"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-553"></a><span>    </span><a name="local-6989586621681924894"><a href="#local-6989586621681924894"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681924898"><a href="#local-6989586621681924898"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924889"><span class="hs-identifier hs-var">tyvar</span></a><span> </span><a href="#local-6989586621681924892"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924898"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-554"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681924899"><a href="#local-6989586621681924899"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681924900"><a href="#local-6989586621681924900"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924896"><span class="hs-identifier hs-var">mkappty</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924894"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924899"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681924894"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924900"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-555"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681924901"><a href="#local-6989586621681924901"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681924902"><a href="#local-6989586621681924902"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#isTcTyCon"><span class="hs-identifier hs-var">isTcTyCon</span></a><span> </span><a href="#local-6989586621681924902"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-556"></a><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681924901"><span class="hs-identifier hs-var">t</span></a><span>  </span><span class="hs-comment">-- avoid allocation in this exceedingly</span><span>
</span><a name="line-557"></a><span>                                      </span><span class="hs-comment">-- common case (mostly, for *)</span><span>
</span><a name="line-558"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681924903"><a href="#local-6989586621681924903"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681924904"><a href="#local-6989586621681924904"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-559"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681924905"><a href="#local-6989586621681924905"><span class="hs-identifier">tc'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681924891"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621681924903"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-560"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621681924895"><span class="hs-identifier hs-var">mktyconapp</span></a><span> </span><a href="#local-6989586621681924905"><span class="hs-identifier hs-var">tc'</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681924894"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924904"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-561"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681924906"><a href="#local-6989586621681924906"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681924907"><a href="#local-6989586621681924907"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924894"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924906"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681924894"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924907"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-562"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681924908"><a href="#local-6989586621681924908"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681924909"><a href="#local-6989586621681924909"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681924910"><a href="#local-6989586621681924910"><span class="hs-identifier">inner</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681924911"><a href="#local-6989586621681924911"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924912"><a href="#local-6989586621681924912"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681924890"><span class="hs-identifier hs-var">tycobinder</span></a><span> </span><a href="#local-6989586621681924892"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924908"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681924909"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-564"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681924913"><a href="#local-6989586621681924913"><span class="hs-identifier">inner'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><a href="#local-6989586621681924887"><span class="hs-identifier hs-var">mapper</span></a><span> </span><a href="#local-6989586621681924911"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-6989586621681924910"><span class="hs-identifier hs-var">inner</span></a><span>
</span><a name="line-565"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681924912"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681924909"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681924913"><span class="hs-identifier hs-var">inner'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-566"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681924914"><a href="#local-6989586621681924914"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681924914"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-567"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681924915"><a href="#local-6989586621681924915"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681924916"><a href="#local-6989586621681924916"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924897"><span class="hs-identifier hs-var">mkcastty</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924894"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924915"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Type.html#mapCoercion"><span class="hs-identifier hs-var">mapCoercion</span></a><span> </span><a href="#local-6989586621681924887"><span class="hs-identifier hs-var">mapper</span></a><span> </span><a href="#local-6989586621681924892"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924916"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-568"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621681924917"><a href="#local-6989586621681924917"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Type.html#mapCoercion"><span class="hs-identifier hs-var">mapCoercion</span></a><span> </span><a href="#local-6989586621681924887"><span class="hs-identifier hs-var">mapper</span></a><span> </span><a href="#local-6989586621681924892"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924917"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-569"></a><span>
</span><a name="line-570"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621681924895"><a href="#local-6989586621681924895"><span class="hs-identifier">mktyconapp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924896"><a href="#local-6989586621681924896"><span class="hs-identifier">mkappty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924897"><a href="#local-6989586621681924897"><span class="hs-identifier">mkcastty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-571"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681924888"><span class="hs-identifier hs-var">smart</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-572"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span class="hs-special">,</span><span>   </span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span class="hs-special">,</span><span>   </span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-573"></a><span>
</span><a name="line-574"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">mapCoercion</span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- See Note [Specialising mappers]</span><span>
</span><a name="line-575"></a><span class="hs-identifier">mapCoercion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621681924771"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-576"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-type">TyCoMapper</span></a><span> </span><a href="#local-6989586621681924772"><span class="hs-identifier hs-type">env</span></a><span> </span><a href="#local-6989586621681924771"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924772"><span class="hs-identifier hs-type">env</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924771"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-577"></a><a name="mapCoercion"><a href="Type.html#mapCoercion"><span class="hs-identifier">mapCoercion</span></a></a><span> </span><a name="local-6989586621681924918"><a href="#local-6989586621681924918"><span class="hs-identifier">mapper</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Type.html#TyCoMapper"><span class="hs-identifier hs-var">TyCoMapper</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcm_smart</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681924919"><a href="#local-6989586621681924919"><span class="hs-identifier">smart</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_covar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681924920"><a href="#local-6989586621681924920"><span class="hs-identifier">covar</span></a></a><span>
</span><a name="line-578"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_hole</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681924921"><a href="#local-6989586621681924921"><span class="hs-identifier">cohole</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tycobinder</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681924922"><a href="#local-6989586621681924922"><span class="hs-identifier">tycobinder</span></a></a><span>
</span><a name="line-579"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681924923"><a href="#local-6989586621681924923"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-580"></a><span>            </span><a name="local-6989586621681924924"><a href="#local-6989586621681924924"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681924925"><a href="#local-6989586621681924925"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-581"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924925"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-582"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-583"></a><span>    </span><a name="local-6989586621681924926"><a href="#local-6989586621681924926"><span class="hs-identifier">go_mco</span></a></a><span> </span><a href="TyCoRep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="TyCoRep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a><span>
</span><a name="line-584"></a><span>    </span><span class="hs-identifier">go_mco</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a><span> </span><a name="local-6989586621681924942"><a href="#local-6989586621681924942"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924942"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span>    </span><a name="local-6989586621681924927"><a href="#local-6989586621681924927"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621681924943"><a href="#local-6989586621681924943"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><a href="#local-6989586621681924918"><span class="hs-identifier hs-var">mapper</span></a><span> </span><a href="#local-6989586621681924924"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924943"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-587"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a><span> </span><a name="local-6989586621681924944"><a href="#local-6989586621681924944"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924945"><a href="#local-6989586621681924945"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681924946"><a href="#local-6989586621681924946"><span class="hs-identifier">mco</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924941"><span class="hs-identifier hs-var">mkgreflco</span></a><span> </span><a href="#local-6989586621681924944"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><a href="#local-6989586621681924918"><span class="hs-identifier hs-var">mapper</span></a><span> </span><a href="#local-6989586621681924924"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924945"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924926"><span class="hs-identifier hs-var">go_mco</span></a><span> </span><a href="#local-6989586621681924946"><span class="hs-identifier hs-var">mco</span></a><span class="hs-special">)</span><span>
</span><a name="line-588"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a name="local-6989586621681924947"><a href="#local-6989586621681924947"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924948"><a href="#local-6989586621681924948"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681924949"><a href="#local-6989586621681924949"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-589"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681924950"><a href="#local-6989586621681924950"><span class="hs-identifier">tc'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681924923"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621681924948"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-590"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621681924929"><span class="hs-identifier hs-var">mktyconappco</span></a><span> </span><a href="#local-6989586621681924947"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681924950"><span class="hs-identifier hs-var">tc'</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924949"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-591"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621681924951"><a href="#local-6989586621681924951"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681924952"><a href="#local-6989586621681924952"><span class="hs-identifier">c2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924930"><span class="hs-identifier hs-var">mkappco</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924951"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924952"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-592"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-6989586621681924953"><a href="#local-6989586621681924953"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681924954"><a href="#local-6989586621681924954"><span class="hs-identifier">kind_co</span></a></a><span> </span><a name="local-6989586621681924955"><a href="#local-6989586621681924955"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681924956"><a href="#local-6989586621681924956"><span class="hs-identifier">kind_co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924954"><span class="hs-identifier hs-var">kind_co</span></a><span>
</span><a name="line-594"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681924957"><a href="#local-6989586621681924957"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924958"><a href="#local-6989586621681924958"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681924922"><span class="hs-identifier hs-var">tycobinder</span></a><span> </span><a href="#local-6989586621681924924"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924953"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a><span>
</span><a name="line-595"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681924959"><a href="#local-6989586621681924959"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#mapCoercion"><span class="hs-identifier hs-var">mapCoercion</span></a><span> </span><a href="#local-6989586621681924918"><span class="hs-identifier hs-var">mapper</span></a><span> </span><a href="#local-6989586621681924957"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-6989586621681924955"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-596"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621681924940"><span class="hs-identifier hs-var">mkforallco</span></a><span> </span><a href="#local-6989586621681924958"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681924956"><span class="hs-identifier hs-var">kind_co'</span></a><span> </span><a href="#local-6989586621681924959"><span class="hs-identifier hs-var">co'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-597"></a><span>        </span><span class="hs-comment">-- See Note [Efficiency for mapCoercion ForAllCo case]</span><span>
</span><a name="line-598"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><a name="local-6989586621681924960"><a href="#local-6989586621681924960"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924961"><a href="#local-6989586621681924961"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681924962"><a href="#local-6989586621681924962"><span class="hs-identifier">c2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a><span> </span><a href="#local-6989586621681924960"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924961"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924962"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-599"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-6989586621681924963"><a href="#local-6989586621681924963"><span class="hs-identifier">cv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924920"><span class="hs-identifier hs-var">covar</span></a><span> </span><a href="#local-6989586621681924924"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924963"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-600"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a name="local-6989586621681924964"><a href="#local-6989586621681924964"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621681924965"><a href="#local-6989586621681924965"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621681924966"><a href="#local-6989586621681924966"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924931"><span class="hs-identifier hs-var">mkaxiominstco</span></a><span> </span><a href="#local-6989586621681924964"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-6989586621681924965"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924966"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-602"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><a name="local-6989586621681924967"><a href="#local-6989586621681924967"><span class="hs-identifier">hole</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924921"><span class="hs-identifier hs-var">cohole</span></a><span> </span><a href="#local-6989586621681924924"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924967"><span class="hs-identifier hs-var">hole</span></a><span>
</span><a name="line-603"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a name="local-6989586621681924968"><a href="#local-6989586621681924968"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621681924969"><a href="#local-6989586621681924969"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924970"><a href="#local-6989586621681924970"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681924971"><a href="#local-6989586621681924971"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-604"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924932"><span class="hs-identifier hs-var">mkunivco</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924928"><span class="hs-identifier hs-var">go_prov</span></a><span> </span><a href="#local-6989586621681924968"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621681924969"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-605"></a><span>                 </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><a href="#local-6989586621681924918"><span class="hs-identifier hs-var">mapper</span></a><span> </span><a href="#local-6989586621681924924"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924970"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Type.html#mapType"><span class="hs-identifier hs-var">mapType</span></a><span> </span><a href="#local-6989586621681924918"><span class="hs-identifier hs-var">mapper</span></a><span> </span><a href="#local-6989586621681924924"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681924971"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-606"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621681924972"><a href="#local-6989586621681924972"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924933"><span class="hs-identifier hs-var">mksymco</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924972"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-607"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-6989586621681924973"><a href="#local-6989586621681924973"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681924974"><a href="#local-6989586621681924974"><span class="hs-identifier">c2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924934"><span class="hs-identifier hs-var">mktransco</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924973"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924974"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-608"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a name="local-6989586621681924975"><a href="#local-6989586621681924975"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924976"><a href="#local-6989586621681924976"><span class="hs-identifier">cos</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a href="#local-6989586621681924975"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924976"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-609"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a name="local-6989586621681924977"><a href="#local-6989586621681924977"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681924978"><a href="#local-6989586621681924978"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621681924979"><a href="#local-6989586621681924979"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924935"><span class="hs-identifier hs-var">mknthco</span></a><span> </span><a href="#local-6989586621681924977"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681924978"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924979"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-610"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><a name="local-6989586621681924980"><a href="#local-6989586621681924980"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621681924981"><a href="#local-6989586621681924981"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924936"><span class="hs-identifier hs-var">mklrco</span></a><span> </span><a href="#local-6989586621681924980"><span class="hs-identifier hs-var">lr</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924981"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-611"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621681924982"><a href="#local-6989586621681924982"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621681924983"><a href="#local-6989586621681924983"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924937"><span class="hs-identifier hs-var">mkinstco</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924982"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924983"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-612"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a name="local-6989586621681924984"><a href="#local-6989586621681924984"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924938"><span class="hs-identifier hs-var">mkkindco</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924984"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-613"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-6989586621681924985"><a href="#local-6989586621681924985"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681924939"><span class="hs-identifier hs-var">mksubco</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924985"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-614"></a><span>
</span><a name="line-615"></a><span>    </span><a name="local-6989586621681924928"><a href="#local-6989586621681924928"><span class="hs-identifier">go_prov</span></a></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>
</span><a name="line-616"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a name="local-6989586621681924986"><a href="#local-6989586621681924986"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924986"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-617"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a name="local-6989586621681924987"><a href="#local-6989586621681924987"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681924927"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681924987"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-618"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><a name="local-6989586621681924988"><a href="#local-6989586621681924988"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681924988"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-619"></a><span>
</span><a name="line-620"></a><span>    </span><span class="hs-special">(</span><span> </span><a name="local-6989586621681924929"><a href="#local-6989586621681924929"><span class="hs-identifier">mktyconappco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924930"><a href="#local-6989586621681924930"><span class="hs-identifier">mkappco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924931"><a href="#local-6989586621681924931"><span class="hs-identifier">mkaxiominstco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924932"><a href="#local-6989586621681924932"><span class="hs-identifier">mkunivco</span></a></a><span>
</span><a name="line-621"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="local-6989586621681924933"><a href="#local-6989586621681924933"><span class="hs-identifier">mksymco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924934"><a href="#local-6989586621681924934"><span class="hs-identifier">mktransco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924935"><a href="#local-6989586621681924935"><span class="hs-identifier">mknthco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924936"><a href="#local-6989586621681924936"><span class="hs-identifier">mklrco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924937"><a href="#local-6989586621681924937"><span class="hs-identifier">mkinstco</span></a></a><span>
</span><a name="line-622"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="local-6989586621681924938"><a href="#local-6989586621681924938"><span class="hs-identifier">mkkindco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924939"><a href="#local-6989586621681924939"><span class="hs-identifier">mksubco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924940"><a href="#local-6989586621681924940"><span class="hs-identifier">mkforallco</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681924941"><a href="#local-6989586621681924941"><span class="hs-identifier">mkgreflco</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-623"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681924919"><span class="hs-identifier hs-var">smart</span></a><span>
</span><a name="line-624"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a><span>
</span><a name="line-625"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkLRCo"><span class="hs-identifier hs-var">mkLRCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a><span>
</span><a name="line-626"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkForAllCo"><span class="hs-identifier hs-var">mkForAllCo</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkGReflCo"><span class="hs-identifier hs-var">mkGReflCo</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-627"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-628"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span>
</span><a name="line-629"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span>
</span><a name="line-630"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Constructor-specific functions}
*                                                                      *
************************************************************************


---------------------------------------------------------------------
                                TyVarTy
                                ~~~~~~~
-}</span><span>
</span><a name="line-644"></a><span>
</span><a name="line-645"></a><span class="hs-comment">-- | Attempts to obtain the type variable underlying a 'Type', and panics with the</span><span>
</span><a name="line-646"></a><span class="hs-comment">-- given message if this is not a type variable type. See also 'getTyVar_maybe'</span><span>
</span><a name="line-647"></a><span class="hs-identifier">getTyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-648"></a><a name="getTyVar"><a href="Type.html#getTyVar"><span class="hs-identifier">getTyVar</span></a></a><span> </span><a name="local-6989586621681924989"><a href="#local-6989586621681924989"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621681924990"><a href="#local-6989586621681924990"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a><span> </span><a href="#local-6989586621681924990"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-649"></a><span>                    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681924991"><a href="#local-6989586621681924991"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924991"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-650"></a><span>                    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;getTyVar: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621681924989"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>
</span><a name="line-652"></a><span class="hs-identifier">isTyVarTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-653"></a><a name="isTyVarTy"><a href="Type.html#isTyVarTy"><span class="hs-identifier">isTyVarTy</span></a></a><span> </span><a name="local-6989586621681924992"><a href="#local-6989586621681924992"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-special">(</span><a href="Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a><span> </span><a href="#local-6989586621681924992"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-654"></a><span>
</span><a name="line-655"></a><span class="hs-comment">-- | Attempts to obtain the type variable underlying a 'Type'</span><span>
</span><a name="line-656"></a><span class="hs-identifier">getTyVar_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-657"></a><a name="getTyVar_maybe"><a href="Type.html#getTyVar_maybe"><span class="hs-identifier">getTyVar_maybe</span></a></a><span> </span><a name="local-6989586621681924993"><a href="#local-6989586621681924993"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681924994"><a href="#local-6989586621681924994"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681924993"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a><span> </span><a href="#local-6989586621681924994"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-658"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#repGetTyVar_maybe"><span class="hs-identifier hs-var">repGetTyVar_maybe</span></a><span> </span><a href="#local-6989586621681924993"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span class="hs-comment">-- | If the type is a tyvar, possibly under a cast, returns it, along</span><span>
</span><a name="line-661"></a><span class="hs-comment">-- with the coercion. Thus, the co is :: kind tv ~N kind ty</span><span>
</span><a name="line-662"></a><span class="hs-identifier">getCastedTyVar_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#CoercionN"><span class="hs-identifier hs-type">CoercionN</span></a><span class="hs-special">)</span><span>
</span><a name="line-663"></a><a name="getCastedTyVar_maybe"><a href="Type.html#getCastedTyVar_maybe"><span class="hs-identifier">getCastedTyVar_maybe</span></a></a><span> </span><a name="local-6989586621681924995"><a href="#local-6989586621681924995"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681924996"><a href="#local-6989586621681924996"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681924995"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getCastedTyVar_maybe"><span class="hs-identifier hs-var">getCastedTyVar_maybe</span></a><span> </span><a href="#local-6989586621681924996"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-664"></a><span class="hs-identifier">getCastedTyVar_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681924997"><a href="#local-6989586621681924997"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681924998"><a href="#local-6989586621681924998"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924997"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681924998"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-665"></a><span class="hs-identifier">getCastedTyVar_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681924999"><a href="#local-6989586621681924999"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-666"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681924999"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkReflCo"><span class="hs-identifier hs-var">mkReflCo</span></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621681924999"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-667"></a><span class="hs-identifier">getCastedTyVar_maybe</span><span> </span><span class="hs-identifier">_</span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-668"></a><span>
</span><a name="line-669"></a><span class="hs-comment">-- | Attempts to obtain the type variable underlying a 'Type', without</span><span>
</span><a name="line-670"></a><span class="hs-comment">-- any expansion</span><span>
</span><a name="line-671"></a><span class="hs-identifier">repGetTyVar_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>
</span><a name="line-672"></a><a name="repGetTyVar_maybe"><a href="Type.html#repGetTyVar_maybe"><span class="hs-identifier">repGetTyVar_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681925000"><a href="#local-6989586621681925000"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925000"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-673"></a><span class="hs-identifier">repGetTyVar_maybe</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-674"></a><span>
</span><a name="line-675"></a><span class="hs-comment">{-
---------------------------------------------------------------------
                                AppTy
                                ~~~~~
We need to be pretty careful with AppTy to make sure we obey the
invariant that a TyConApp is always visibly so.  mkAppTy maintains the
invariant: use it.

Note [Decomposing fat arrow c=&gt;t]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Can we unify (a b) with (Eq a =&gt; ty)?   If we do so, we end up with
a partial application like ((=&gt;) Eq a) which doesn't make sense in
source Haskell.  In contrast, we *can* unify (a b) with (t1 -&gt; t2).
Here's an example (Trac #9858) of how you might do it:
   i :: (Typeable a, Typeable b) =&gt; Proxy (a b) -&gt; TypeRep
   i p = typeRep p

   j = i (Proxy :: Proxy (Eq Int =&gt; Int))
The type (Proxy (Eq Int =&gt; Int)) is only accepted with -XImpredicativeTypes,
but suppose we want that.  But then in the call to 'i', we end
up decomposing (Eq Int =&gt; Int), and we definitely don't want that.

This really only applies to the type checker; in Core, '=&gt;' and '-&gt;'
are the same, as are 'Constraint' and '*'.  But for now I've put
the test in repSplitAppTy_maybe, which applies throughout, because
the other calls to splitAppTy are in Unify, which is also used by
the type checker (e.g. when matching type-function equations).

-}</span><span>
</span><a name="line-704"></a><span>
</span><a name="line-705"></a><span class="hs-comment">-- | Applies a type to another, as in e.g. @k a@</span><span>
</span><a name="line-706"></a><span class="hs-identifier">mkAppTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-707"></a><span>  </span><span class="hs-comment">-- See Note [Respecting definitional equality], invariant (EQ1).</span><span>
</span><a name="line-708"></a><a name="mkAppTy"><a href="Type.html#mkAppTy"><span class="hs-identifier">mkAppTy</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925001"><a href="#local-6989586621681925001"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621681925002"><a href="#local-6989586621681925002"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925003"><a href="#local-6989586621681925003"><span class="hs-identifier">arg_ty</span></a></a><span>
</span><a name="line-709"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a name="local-6989586621681925004"><a href="#local-6989586621681925004"><span class="hs-identifier">arg_co</span></a></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681925005"><a href="#local-6989586621681925005"><span class="hs-identifier">res_co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Coercion.html#decomposePiCos"><span class="hs-identifier hs-var">decomposePiCos</span></a><span> </span><a href="#local-6989586621681925002"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621681925002"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925003"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-710"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925001"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925003"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925004"><span class="hs-identifier hs-var">arg_co</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925005"><span class="hs-identifier hs-var">res_co</span></a><span>
</span><a name="line-711"></a><span>
</span><a name="line-712"></a><span class="hs-identifier">mkAppTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925006"><a href="#local-6989586621681925006"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925007"><a href="#local-6989586621681925007"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925008"><a href="#local-6989586621681925008"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621681925006"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925007"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925008"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span class="hs-identifier">mkAppTy</span><span> </span><a name="local-6989586621681925009"><a href="#local-6989586621681925009"><span class="hs-identifier">ty1</span></a></a><span>               </span><a name="local-6989586621681925010"><a href="#local-6989586621681925010"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a href="#local-6989586621681925009"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621681925010"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-714"></a><span>        </span><span class="hs-comment">-- Note that the TyConApp could be an</span><span>
</span><a name="line-715"></a><span>        </span><span class="hs-comment">-- under-saturated type synonym.  GHC allows that; e.g.</span><span>
</span><a name="line-716"></a><span>        </span><span class="hs-comment">--      type Foo k = k a -&gt; k a</span><span>
</span><a name="line-717"></a><span>        </span><span class="hs-comment">--      type Id x = x</span><span>
</span><a name="line-718"></a><span>        </span><span class="hs-comment">--      foo :: Foo Id -&gt; Foo Id</span><span>
</span><a name="line-719"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-720"></a><span>        </span><span class="hs-comment">-- Here Id is partially applied in the type sig for Foo,</span><span>
</span><a name="line-721"></a><span>        </span><span class="hs-comment">-- but once the type synonyms are expanded all is well</span><span>
</span><a name="line-722"></a><span>
</span><a name="line-723"></a><span class="hs-identifier">mkAppTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-724"></a><a name="mkAppTys"><a href="Type.html#mkAppTys"><span class="hs-identifier">mkAppTys</span></a></a><span> </span><a name="local-6989586621681925011"><a href="#local-6989586621681925011"><span class="hs-identifier">ty1</span></a></a><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925011"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-725"></a><span class="hs-identifier">mkAppTys</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925012"><a href="#local-6989586621681925012"><span class="hs-identifier">fun_ty</span></a></a><span> </span><a name="local-6989586621681925013"><a href="#local-6989586621681925013"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925014"><a href="#local-6989586621681925014"><span class="hs-identifier">arg_tys</span></a></a><span>  </span><span class="hs-comment">-- much more efficient then nested mkAppTy</span><span>
</span><a name="line-726"></a><span>                                     </span><span class="hs-comment">-- Why do this? See (EQ1) of</span><span>
</span><a name="line-727"></a><span>                                     </span><span class="hs-comment">-- Note [Respecting definitional equality]</span><span>
</span><a name="line-728"></a><span>                                     </span><span class="hs-comment">-- in TyCoRep</span><span>
</span><a name="line-729"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a><span> </span><a href="#local-6989586621681925012"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621681925019"><span class="hs-identifier hs-var">casted_arg_tys</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925016"><span class="hs-identifier hs-var">res_co</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925018"><span class="hs-identifier hs-var">leftovers</span></a><span>
</span><a name="line-730"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-731"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621681925015"><a href="#local-6989586621681925015"><span class="hs-identifier">arg_cos</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925016"><a href="#local-6989586621681925016"><span class="hs-identifier">res_co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#decomposePiCos"><span class="hs-identifier hs-var">decomposePiCos</span></a><span> </span><a href="#local-6989586621681925013"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621681925013"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925014"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-732"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621681925017"><a href="#local-6989586621681925017"><span class="hs-identifier">args_to_cast</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925018"><a href="#local-6989586621681925018"><span class="hs-identifier">leftovers</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#splitAtList"><span class="hs-identifier hs-var">splitAtList</span></a><span> </span><a href="#local-6989586621681925015"><span class="hs-identifier hs-var">arg_cos</span></a><span> </span><a href="#local-6989586621681925014"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-733"></a><span>    </span><a name="local-6989586621681925019"><a href="#local-6989586621681925019"><span class="hs-identifier">casted_arg_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span> </span><a href="#local-6989586621681925017"><span class="hs-identifier hs-var">args_to_cast</span></a><span> </span><a href="#local-6989586621681925015"><span class="hs-identifier hs-var">arg_cos</span></a><span>
</span><a name="line-734"></a><span class="hs-identifier">mkAppTys</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925020"><a href="#local-6989586621681925020"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925021"><a href="#local-6989586621681925021"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925022"><a href="#local-6989586621681925022"><span class="hs-identifier">tys2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621681925020"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925021"><span class="hs-identifier hs-var">tys1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621681925022"><span class="hs-identifier hs-var">tys2</span></a><span class="hs-special">)</span><span>
</span><a name="line-735"></a><span class="hs-identifier">mkAppTys</span><span> </span><a name="local-6989586621681925023"><a href="#local-6989586621681925023"><span class="hs-identifier">ty1</span></a></a><span>                </span><a name="local-6989586621681925024"><a href="#local-6989586621681925024"><span class="hs-identifier">tys2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a href="#local-6989586621681925023"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621681925024"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-736"></a><span>
</span><a name="line-737"></a><span class="hs-comment">-------------</span><span>
</span><a name="line-738"></a><span class="hs-identifier">splitAppTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-739"></a><span class="hs-comment">-- ^ Attempt to take a type application apart, whether it is a</span><span>
</span><a name="line-740"></a><span class="hs-comment">-- function, type constructor, or plain type application. Note</span><span>
</span><a name="line-741"></a><span class="hs-comment">-- that type family applications are NEVER unsaturated by this!</span><span>
</span><a name="line-742"></a><a name="splitAppTy_maybe"><a href="Type.html#splitAppTy_maybe"><span class="hs-identifier">splitAppTy_maybe</span></a></a><span> </span><a name="local-6989586621681925025"><a href="#local-6989586621681925025"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925026"><a href="#local-6989586621681925026"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925025"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-743"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a><span> </span><a href="#local-6989586621681925026"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-744"></a><span class="hs-identifier">splitAppTy_maybe</span><span> </span><a name="local-6989586621681925027"><a href="#local-6989586621681925027"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#repSplitAppTy_maybe"><span class="hs-identifier hs-var">repSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621681925027"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-745"></a><span>
</span><a name="line-746"></a><span class="hs-comment">-------------</span><span>
</span><a name="line-747"></a><span class="hs-identifier">repSplitAppTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-748"></a><span class="hs-comment">-- ^ Does the AppTy split as in 'splitAppTy_maybe', but assumes that</span><span>
</span><a name="line-749"></a><span class="hs-comment">-- any Core view stuff is already done</span><span>
</span><a name="line-750"></a><a name="repSplitAppTy_maybe"><a href="Type.html#repSplitAppTy_maybe"><span class="hs-identifier">repSplitAppTy_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925028"><a href="#local-6989586621681925028"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925029"><a href="#local-6989586621681925029"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-751"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925030"><span class="hs-identifier hs-var">rep1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925031"><span class="hs-identifier hs-var">rep2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925028"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925029"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-752"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-753"></a><span>    </span><a name="local-6989586621681925030"><a href="#local-6989586621681925030"><span class="hs-identifier">rep1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925028"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-754"></a><span>    </span><a name="local-6989586621681925031"><a href="#local-6989586621681925031"><span class="hs-identifier">rep2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925029"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-755"></a><span>
</span><a name="line-756"></a><span class="hs-identifier">repSplitAppTy_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925032"><a href="#local-6989586621681925032"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925033"><a href="#local-6989586621681925033"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-757"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925032"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925033"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-758"></a><span>
</span><a name="line-759"></a><span class="hs-identifier">repSplitAppTy_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925034"><a href="#local-6989586621681925034"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925035"><a href="#local-6989586621681925035"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-760"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#mightBeUnsaturatedTyCon"><span class="hs-identifier hs-var">mightBeUnsaturatedTyCon</span></a><span> </span><a href="#local-6989586621681925034"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621681925035"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">lengthExceeds</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-6989586621681925034"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-761"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925036"><a href="#local-6989586621681925036"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925037"><a href="#local-6989586621681925037"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Util.html#snocView"><span class="hs-identifier hs-var">snocView</span></a><span> </span><a href="#local-6989586621681925035"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-762"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="#local-6989586621681925034"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681925036"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925037"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Never create unsaturated type family apps!</span><span>
</span><a name="line-763"></a><span>
</span><a name="line-764"></a><span class="hs-identifier">repSplitAppTy_maybe</span><span> </span><a name="local-6989586621681925038"><a href="#local-6989586621681925038"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-765"></a><span>
</span><a name="line-766"></a><span class="hs-comment">-- This one doesn't break apart (c =&gt; t).</span><span>
</span><a name="line-767"></a><span class="hs-comment">-- See Note [Decomposing fat arrow c=&gt;t]</span><span>
</span><a name="line-768"></a><span class="hs-comment">-- Defined here to avoid module loops between Unify and TcType.</span><span>
</span><a name="line-769"></a><span class="hs-identifier">tcRepSplitAppTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-770"></a><span class="hs-comment">-- ^ Does the AppTy split as in 'tcSplitAppTy_maybe', but assumes that</span><span>
</span><a name="line-771"></a><span class="hs-comment">-- any coreView stuff is already done. Refuses to look through (c =&gt; t)</span><span>
</span><a name="line-772"></a><a name="tcRepSplitAppTy_maybe"><a href="Type.html#tcRepSplitAppTy_maybe"><span class="hs-identifier">tcRepSplitAppTy_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925039"><a href="#local-6989586621681925039"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925040"><a href="#local-6989586621681925040"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-773"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621681925039"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-774"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-comment">-- See Note [Decomposing fat arrow c=&gt;t]</span><span>
</span><a name="line-775"></a><span>
</span><a name="line-776"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-777"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925041"><span class="hs-identifier hs-var">rep1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925042"><span class="hs-identifier hs-var">rep2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925039"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925040"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-778"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-779"></a><span>    </span><a name="local-6989586621681925041"><a href="#local-6989586621681925041"><span class="hs-identifier">rep1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925039"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-780"></a><span>    </span><a name="local-6989586621681925042"><a href="#local-6989586621681925042"><span class="hs-identifier">rep2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925040"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-781"></a><span>
</span><a name="line-782"></a><span class="hs-identifier">tcRepSplitAppTy_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925043"><a href="#local-6989586621681925043"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925044"><a href="#local-6989586621681925044"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925043"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925044"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-783"></a><span class="hs-identifier">tcRepSplitAppTy_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925045"><a href="#local-6989586621681925045"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925046"><a href="#local-6989586621681925046"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-784"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#mightBeUnsaturatedTyCon"><span class="hs-identifier hs-var">mightBeUnsaturatedTyCon</span></a><span> </span><a href="#local-6989586621681925045"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621681925046"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">lengthExceeds</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-6989586621681925045"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-785"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925047"><a href="#local-6989586621681925047"><span class="hs-identifier">tys'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925048"><a href="#local-6989586621681925048"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Util.html#snocView"><span class="hs-identifier hs-var">snocView</span></a><span> </span><a href="#local-6989586621681925046"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-786"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="#local-6989586621681925045"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681925047"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925048"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Never create unsaturated type family apps!</span><span>
</span><a name="line-787"></a><span class="hs-identifier">tcRepSplitAppTy_maybe</span><span> </span><a name="local-6989586621681925049"><a href="#local-6989586621681925049"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-788"></a><span>
</span><a name="line-789"></a><span class="hs-comment">-- | Like 'tcSplitTyConApp_maybe' but doesn't look through type synonyms.</span><span>
</span><a name="line-790"></a><span class="hs-identifier">tcRepSplitTyConApp_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-791"></a><span class="hs-comment">-- Defined here to avoid module loops between Unify and TcType.</span><span>
</span><a name="line-792"></a><a name="tcRepSplitTyConApp_maybe"><a href="Type.html#tcRepSplitTyConApp_maybe"><span class="hs-identifier">tcRepSplitTyConApp_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925050"><a href="#local-6989586621681925050"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925051"><a href="#local-6989586621681925051"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-793"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925050"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925051"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-794"></a><span>
</span><a name="line-795"></a><span class="hs-identifier">tcRepSplitTyConApp_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925052"><a href="#local-6989586621681925052"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925053"><a href="#local-6989586621681925053"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-796"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925054"><span class="hs-identifier hs-var">arg_rep</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925055"><span class="hs-identifier hs-var">res_rep</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925052"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925053"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-797"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-798"></a><span>    </span><a name="local-6989586621681925054"><a href="#local-6989586621681925054"><span class="hs-identifier">arg_rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925052"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-799"></a><span>    </span><a name="local-6989586621681925055"><a href="#local-6989586621681925055"><span class="hs-identifier">res_rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925053"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-800"></a><span>
</span><a name="line-801"></a><span class="hs-identifier">tcRepSplitTyConApp_maybe</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-802"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-803"></a><span>
</span><a name="line-804"></a><span class="hs-comment">-- | Like 'tcSplitTyConApp' but doesn't look through type synonyms.</span><span>
</span><a name="line-805"></a><span class="hs-identifier">tcRepSplitTyConApp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-806"></a><span class="hs-comment">-- Defined here to avoid module loops between Unify and TcType.</span><span>
</span><a name="line-807"></a><a name="tcRepSplitTyConApp"><a href="Type.html#tcRepSplitTyConApp"><span class="hs-identifier">tcRepSplitTyConApp</span></a></a><span> </span><a name="local-6989586621681925056"><a href="#local-6989586621681925056"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-808"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tcRepSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcRepSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925056"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-809"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925057"><a href="#local-6989586621681925057"><span class="hs-identifier">stuff</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925057"><span class="hs-identifier hs-var">stuff</span></a><span>
</span><a name="line-810"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcRepSplitTyConApp&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925056"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-811"></a><span>
</span><a name="line-812"></a><span class="hs-comment">-------------</span><span>
</span><a name="line-813"></a><span class="hs-identifier">splitAppTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-814"></a><span class="hs-comment">-- ^ Attempts to take a type application apart, as in 'splitAppTy_maybe',</span><span>
</span><a name="line-815"></a><span class="hs-comment">-- and panics if this is not possible</span><span>
</span><a name="line-816"></a><a name="splitAppTy"><a href="Type.html#splitAppTy"><span class="hs-identifier">splitAppTy</span></a></a><span> </span><a name="local-6989586621681925058"><a href="#local-6989586621681925058"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitAppTy_maybe"><span class="hs-identifier hs-var">splitAppTy_maybe</span></a><span> </span><a href="#local-6989586621681925058"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-817"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925059"><a href="#local-6989586621681925059"><span class="hs-identifier">pr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925059"><span class="hs-identifier hs-var">pr</span></a><span>
</span><a name="line-818"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;splitAppTy&quot;</span><span>
</span><a name="line-819"></a><span>
</span><a name="line-820"></a><span class="hs-comment">-------------</span><span>
</span><a name="line-821"></a><span class="hs-identifier">splitAppTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-822"></a><span class="hs-comment">-- ^ Recursively splits a type as far as is possible, leaving a residual</span><span>
</span><a name="line-823"></a><span class="hs-comment">-- type being applied to and the type arguments applied to it. Never fails,</span><span>
</span><a name="line-824"></a><span class="hs-comment">-- even if that means returning an empty list of type applications.</span><span>
</span><a name="line-825"></a><a name="splitAppTys"><a href="Type.html#splitAppTys"><span class="hs-identifier">splitAppTys</span></a></a><span> </span><a name="local-6989586621681925060"><a href="#local-6989586621681925060"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925061"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925060"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925060"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-826"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-827"></a><span>    </span><a name="local-6989586621681925061"><a href="#local-6989586621681925061"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621681925062"><a href="#local-6989586621681925062"><span class="hs-identifier">orig_ty</span></a></a><span> </span><a name="local-6989586621681925063"><a href="#local-6989586621681925063"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925064"><a href="#local-6989586621681925064"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925065"><a href="#local-6989586621681925065"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925063"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925061"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925062"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-6989586621681925065"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925064"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-828"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925066"><a href="#local-6989586621681925066"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925067"><a href="#local-6989586621681925067"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>        </span><a name="local-6989586621681925068"><a href="#local-6989586621681925068"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925061"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925066"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925066"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925067"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925068"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-829"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925069"><a href="#local-6989586621681925069"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925070"><a href="#local-6989586621681925070"><span class="hs-identifier">tc_args</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925071"><a href="#local-6989586621681925071"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-830"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- keep type families saturated</span><span>
</span><a name="line-831"></a><span>            </span><a name="local-6989586621681925072"><a href="#local-6989586621681925072"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#mightBeUnsaturatedTyCon"><span class="hs-identifier hs-var">mightBeUnsaturatedTyCon</span></a><span> </span><a href="#local-6989586621681925069"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-832"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-6989586621681925069"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-833"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621681925073"><a href="#local-6989586621681925073"><span class="hs-identifier">tc_args1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925074"><a href="#local-6989586621681925074"><span class="hs-identifier">tc_args2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621681925072"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621681925070"><span class="hs-identifier hs-var">tc_args</span></a><span>
</span><a name="line-834"></a><span>        </span><span class="hs-keyword">in</span><span>
</span><a name="line-835"></a><span>        </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="#local-6989586621681925069"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681925073"><span class="hs-identifier hs-var">tc_args1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925074"><span class="hs-identifier hs-var">tc_args2</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621681925071"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-836"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925075"><a href="#local-6989586621681925075"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925076"><a href="#local-6989586621681925076"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925077"><a href="#local-6989586621681925077"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-837"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-838"></a><span>        </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925078"><span class="hs-identifier hs-var">rep1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925079"><span class="hs-identifier hs-var">rep2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925075"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925076"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-839"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-840"></a><span>        </span><a name="local-6989586621681925078"><a href="#local-6989586621681925078"><span class="hs-identifier">rep1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925075"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-841"></a><span>        </span><a name="local-6989586621681925079"><a href="#local-6989586621681925079"><span class="hs-identifier">rep2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925076"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-842"></a><span>
</span><a name="line-843"></a><span>    </span><span class="hs-identifier">split</span><span> </span><a name="local-6989586621681925080"><a href="#local-6989586621681925080"><span class="hs-identifier">orig_ty</span></a></a><span> </span><span class="hs-identifier">_</span><span>                     </span><a name="local-6989586621681925081"><a href="#local-6989586621681925081"><span class="hs-identifier">args</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925080"><span class="hs-identifier hs-var">orig_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925081"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-844"></a><span>
</span><a name="line-845"></a><span class="hs-comment">-- | Like 'splitAppTys', but doesn't look through type synonyms</span><span>
</span><a name="line-846"></a><span class="hs-identifier">repSplitAppTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-847"></a><a name="repSplitAppTys"><a href="Type.html#repSplitAppTys"><span class="hs-identifier">repSplitAppTys</span></a></a><span> </span><a name="local-6989586621681925082"><a href="#local-6989586621681925082"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925083"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925082"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-848"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-849"></a><span>    </span><a name="local-6989586621681925083"><a href="#local-6989586621681925083"><span class="hs-identifier">split</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925084"><a href="#local-6989586621681925084"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925085"><a href="#local-6989586621681925085"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925086"><a href="#local-6989586621681925086"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925083"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925084"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925085"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925086"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-850"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925087"><a href="#local-6989586621681925087"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925088"><a href="#local-6989586621681925088"><span class="hs-identifier">tc_args</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925089"><a href="#local-6989586621681925089"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-851"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681925090"><a href="#local-6989586621681925090"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#mightBeUnsaturatedTyCon"><span class="hs-identifier hs-var">mightBeUnsaturatedTyCon</span></a><span> </span><a href="#local-6989586621681925087"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-852"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-6989586621681925087"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-853"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621681925091"><a href="#local-6989586621681925091"><span class="hs-identifier">tc_args1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925092"><a href="#local-6989586621681925092"><span class="hs-identifier">tc_args2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">splitAt</span><span> </span><a href="#local-6989586621681925090"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621681925088"><span class="hs-identifier hs-var">tc_args</span></a><span>
</span><a name="line-854"></a><span>        </span><span class="hs-keyword">in</span><span>
</span><a name="line-855"></a><span>        </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="#local-6989586621681925087"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681925091"><span class="hs-identifier hs-var">tc_args1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925092"><span class="hs-identifier hs-var">tc_args2</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621681925089"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-856"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925093"><a href="#local-6989586621681925093"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925094"><a href="#local-6989586621681925094"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925095"><a href="#local-6989586621681925095"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-857"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-858"></a><span>        </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925096"><span class="hs-identifier hs-var">rep1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925097"><span class="hs-identifier hs-var">rep2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925093"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925094"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-859"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-860"></a><span>        </span><a name="local-6989586621681925096"><a href="#local-6989586621681925096"><span class="hs-identifier">rep1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925093"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-861"></a><span>        </span><a name="local-6989586621681925097"><a href="#local-6989586621681925097"><span class="hs-identifier">rep2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925094"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-862"></a><span>
</span><a name="line-863"></a><span>    </span><span class="hs-identifier">split</span><span> </span><a name="local-6989586621681925098"><a href="#local-6989586621681925098"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925099"><a href="#local-6989586621681925099"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925098"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925099"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-864"></a><span>
</span><a name="line-865"></a><span class="hs-comment">{-
                      LitTy
                      ~~~~~
-}</span><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span class="hs-identifier">mkNumLitTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-871"></a><a name="mkNumLitTy"><a href="Type.html#mkNumLitTy"><span class="hs-identifier">mkNumLitTy</span></a></a><span> </span><a name="local-6989586621681925100"><a href="#local-6989586621681925100"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NumTyLit"><span class="hs-identifier hs-var">NumTyLit</span></a><span> </span><a href="#local-6989586621681925100"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-872"></a><span>
</span><a name="line-873"></a><span class="hs-comment">-- | Is this a numeric literal. We also look through type synonyms.</span><span>
</span><a name="line-874"></a><span class="hs-identifier">isNumLitTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-875"></a><a name="isNumLitTy"><a href="Type.html#isNumLitTy"><span class="hs-identifier">isNumLitTy</span></a></a><span> </span><a name="local-6989586621681925101"><a href="#local-6989586621681925101"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925102"><a href="#local-6989586621681925102"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925101"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isNumLitTy"><span class="hs-identifier hs-var">isNumLitTy</span></a><span> </span><a href="#local-6989586621681925102"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-876"></a><span class="hs-identifier">isNumLitTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NumTyLit"><span class="hs-identifier hs-var">NumTyLit</span></a><span> </span><a name="local-6989586621681925103"><a href="#local-6989586621681925103"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925103"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-877"></a><span class="hs-identifier">isNumLitTy</span><span> </span><span class="hs-identifier">_</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-878"></a><span>
</span><a name="line-879"></a><span class="hs-identifier">mkStrLitTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-880"></a><a name="mkStrLitTy"><a href="Type.html#mkStrLitTy"><span class="hs-identifier">mkStrLitTy</span></a></a><span> </span><a name="local-6989586621681925104"><a href="#local-6989586621681925104"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#StrTyLit"><span class="hs-identifier hs-var">StrTyLit</span></a><span> </span><a href="#local-6989586621681925104"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-881"></a><span>
</span><a name="line-882"></a><span class="hs-comment">-- | Is this a symbol literal. We also look through type synonyms.</span><span>
</span><a name="line-883"></a><span class="hs-identifier">isStrLitTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-884"></a><a name="isStrLitTy"><a href="Type.html#isStrLitTy"><span class="hs-identifier">isStrLitTy</span></a></a><span> </span><a name="local-6989586621681925105"><a href="#local-6989586621681925105"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925106"><a href="#local-6989586621681925106"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925105"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isStrLitTy"><span class="hs-identifier hs-var">isStrLitTy</span></a><span> </span><a href="#local-6989586621681925106"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-885"></a><span class="hs-identifier">isStrLitTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#StrTyLit"><span class="hs-identifier hs-var">StrTyLit</span></a><span> </span><a name="local-6989586621681925107"><a href="#local-6989586621681925107"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925107"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-886"></a><span class="hs-identifier">isStrLitTy</span><span> </span><span class="hs-identifier">_</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-887"></a><span>
</span><a name="line-888"></a><span class="hs-comment">-- | Is this a type literal (symbol or numeric).</span><span>
</span><a name="line-889"></a><span class="hs-identifier">isLitTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#TyLit"><span class="hs-identifier hs-type">TyLit</span></a><span>
</span><a name="line-890"></a><a name="isLitTy"><a href="Type.html#isLitTy"><span class="hs-identifier">isLitTy</span></a></a><span> </span><a name="local-6989586621681925108"><a href="#local-6989586621681925108"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925109"><a href="#local-6989586621681925109"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925108"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isLitTy"><span class="hs-identifier hs-var">isLitTy</span></a><span> </span><a href="#local-6989586621681925109"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-891"></a><span class="hs-identifier">isLitTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-6989586621681925110"><a href="#local-6989586621681925110"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925110"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-892"></a><span class="hs-identifier">isLitTy</span><span> </span><span class="hs-identifier">_</span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-893"></a><span>
</span><a name="line-894"></a><span class="hs-comment">-- | Is this type a custom user error?</span><span>
</span><a name="line-895"></a><span class="hs-comment">-- If so, give us the kind and the error message.</span><span>
</span><a name="line-896"></a><span class="hs-identifier">userTypeError_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-897"></a><a name="userTypeError_maybe"><a href="Type.html#userTypeError_maybe"><span class="hs-identifier">userTypeError_maybe</span></a></a><span> </span><a name="local-6989586621681925111"><a href="#local-6989586621681925111"><span class="hs-identifier">t</span></a></a><span>
</span><a name="line-898"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925112"><a href="#local-6989586621681925112"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925113"><a href="#local-6989586621681925113"><span class="hs-identifier">_kind</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621681925114"><a href="#local-6989586621681925114"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925111"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-899"></a><span>          </span><span class="hs-comment">-- There may be more than 2 arguments, if the type error is</span><span>
</span><a name="line-900"></a><span>          </span><span class="hs-comment">-- used as a type constructor (e.g. at kind `Type -&gt; Type`).</span><span>
</span><a name="line-901"></a><span>
</span><a name="line-902"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621681925112"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#errorMessageTypeErrorFamName"><span class="hs-identifier hs-var">errorMessageTypeErrorFamName</span></a><span class="hs-special">)</span><span>
</span><a name="line-903"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681925114"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-904"></a><span>
</span><a name="line-905"></a><span class="hs-comment">-- | Render a type corresponding to a user type error into a SDoc.</span><span>
</span><a name="line-906"></a><span class="hs-identifier">pprUserTypeErrorTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-907"></a><a name="pprUserTypeErrorTy"><a href="Type.html#pprUserTypeErrorTy"><span class="hs-identifier">pprUserTypeErrorTy</span></a></a><span> </span><a name="local-6989586621681925115"><a href="#local-6989586621681925115"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-908"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925115"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-909"></a><span>
</span><a name="line-910"></a><span>    </span><span class="hs-comment">-- Text &quot;Something&quot;</span><span>
</span><a name="line-911"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925116"><a href="#local-6989586621681925116"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span class="hs-special">[</span><a name="local-6989586621681925117"><a href="#local-6989586621681925117"><span class="hs-identifier">txt</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-912"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621681925116"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#typeErrorTextDataConName"><span class="hs-identifier hs-var">typeErrorTextDataConName</span></a><span>
</span><a name="line-913"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925118"><a href="#local-6989586621681925118"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#isStrLitTy"><span class="hs-identifier hs-var">isStrLitTy</span></a><span> </span><a href="#local-6989586621681925117"><span class="hs-identifier hs-var">txt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a><span> </span><a href="#local-6989586621681925118"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-914"></a><span>
</span><a name="line-915"></a><span>    </span><span class="hs-comment">-- ShowType t</span><span>
</span><a name="line-916"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925119"><a href="#local-6989586621681925119"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span class="hs-special">[</span><a name="local-6989586621681925120"><a href="#local-6989586621681925120"><span class="hs-identifier">_k</span></a></a><span class="hs-special">,</span><a name="local-6989586621681925121"><a href="#local-6989586621681925121"><span class="hs-identifier">t</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-917"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621681925119"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#typeErrorShowTypeDataConName"><span class="hs-identifier hs-var">typeErrorShowTypeDataConName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925121"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-918"></a><span>
</span><a name="line-919"></a><span>    </span><span class="hs-comment">-- t1 :&lt;&gt;: t2</span><span>
</span><a name="line-920"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925122"><a href="#local-6989586621681925122"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span class="hs-special">[</span><a name="local-6989586621681925123"><a href="#local-6989586621681925123"><span class="hs-identifier">t1</span></a></a><span class="hs-special">,</span><a name="local-6989586621681925124"><a href="#local-6989586621681925124"><span class="hs-identifier">t2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-921"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621681925122"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#typeErrorAppendDataConName"><span class="hs-identifier hs-var">typeErrorAppendDataConName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-922"></a><span>        </span><a href="Type.html#pprUserTypeErrorTy"><span class="hs-identifier hs-var">pprUserTypeErrorTy</span></a><span> </span><a href="#local-6989586621681925123"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Type.html#pprUserTypeErrorTy"><span class="hs-identifier hs-var">pprUserTypeErrorTy</span></a><span> </span><a href="#local-6989586621681925124"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-923"></a><span>
</span><a name="line-924"></a><span>    </span><span class="hs-comment">-- t1 :$$: t2</span><span>
</span><a name="line-925"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925125"><a href="#local-6989586621681925125"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span class="hs-special">[</span><a name="local-6989586621681925126"><a href="#local-6989586621681925126"><span class="hs-identifier">t1</span></a></a><span class="hs-special">,</span><a name="local-6989586621681925127"><a href="#local-6989586621681925127"><span class="hs-identifier">t2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-926"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621681925125"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#typeErrorVAppendDataConName"><span class="hs-identifier hs-var">typeErrorVAppendDataConName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-927"></a><span>        </span><a href="Type.html#pprUserTypeErrorTy"><span class="hs-identifier hs-var">pprUserTypeErrorTy</span></a><span> </span><a href="#local-6989586621681925126"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Type.html#pprUserTypeErrorTy"><span class="hs-identifier hs-var">pprUserTypeErrorTy</span></a><span> </span><a href="#local-6989586621681925127"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-928"></a><span>
</span><a name="line-929"></a><span>    </span><span class="hs-comment">-- An unevaluated type function</span><span>
</span><a name="line-930"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925115"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-931"></a><span>
</span><a name="line-932"></a><span>
</span><a name="line-933"></a><span>
</span><a name="line-934"></a><span>
</span><a name="line-935"></a><span class="hs-comment">{-
---------------------------------------------------------------------
                                FunTy
                                ~~~~~

Note [Representation of function types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Functions (e.g. Int -&gt; Char) can be thought of as being applications
of funTyCon (known in Haskell surface syntax as (-&gt;)),

    (-&gt;) :: forall (r1 :: RuntimeRep) (r2 :: RuntimeRep)
                   (a :: TYPE r1) (b :: TYPE r2).
            a -&gt; b -&gt; Type

However, for efficiency's sake we represent saturated applications of (-&gt;)
with FunTy. For instance, the type,

    (-&gt;) r1 r2 a b

is equivalent to,

    FunTy (Anon a) b

Note how the RuntimeReps are implied in the FunTy representation. For this
reason we must be careful when recontructing the TyConApp representation (see,
for instance, splitTyConApp_maybe).

In the compiler we maintain the invariant that all saturated applications of
(-&gt;) are represented with FunTy.

See #11714.
-}</span><span>
</span><a name="line-968"></a><span>
</span><a name="line-969"></a><span class="hs-identifier">isFunTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-970"></a><a name="isFunTy"><a href="Type.html#isFunTy"><span class="hs-identifier">isFunTy</span></a></a><span> </span><a name="local-6989586621681925128"><a href="#local-6989586621681925128"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-special">(</span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><a href="#local-6989586621681925128"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-971"></a><span>
</span><a name="line-972"></a><span class="hs-identifier">splitFunTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-973"></a><span class="hs-comment">-- ^ Attempts to extract the argument and result types from a type, and</span><span>
</span><a name="line-974"></a><span class="hs-comment">-- panics if that is not possible. See also 'splitFunTy_maybe'</span><span>
</span><a name="line-975"></a><a name="splitFunTy"><a href="Type.html#splitFunTy"><span class="hs-identifier">splitFunTy</span></a></a><span> </span><a name="local-6989586621681925129"><a href="#local-6989586621681925129"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925130"><a href="#local-6989586621681925130"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925129"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitFunTy"><span class="hs-identifier hs-var">splitFunTy</span></a><span> </span><a href="#local-6989586621681925130"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-976"></a><span class="hs-identifier">splitFunTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925131"><a href="#local-6989586621681925131"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925132"><a href="#local-6989586621681925132"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925131"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925132"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span class="hs-identifier">splitFunTy</span><span> </span><a name="local-6989586621681925133"><a href="#local-6989586621681925133"><span class="hs-identifier">other</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;splitFunTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925133"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-978"></a><span>
</span><a name="line-979"></a><span class="hs-identifier">splitFunTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-980"></a><span class="hs-comment">-- ^ Attempts to extract the argument and result types from a type</span><span>
</span><a name="line-981"></a><a name="splitFunTy_maybe"><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier">splitFunTy_maybe</span></a></a><span> </span><a name="local-6989586621681925134"><a href="#local-6989586621681925134"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925135"><a href="#local-6989586621681925135"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925134"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><a href="#local-6989586621681925135"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-982"></a><span class="hs-identifier">splitFunTy_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925136"><a href="#local-6989586621681925136"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925137"><a href="#local-6989586621681925137"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925136"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925137"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-983"></a><span class="hs-identifier">splitFunTy_maybe</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-984"></a><span>
</span><a name="line-985"></a><span class="hs-identifier">splitFunTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-986"></a><a name="splitFunTys"><a href="Type.html#splitFunTys"><span class="hs-identifier">splitFunTys</span></a></a><span> </span><a name="local-6989586621681925138"><a href="#local-6989586621681925138"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925139"><span class="hs-identifier hs-var">split</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621681925138"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925138"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-987"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-988"></a><span>    </span><a name="local-6989586621681925139"><a href="#local-6989586621681925139"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621681925140"><a href="#local-6989586621681925140"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621681925141"><a href="#local-6989586621681925141"><span class="hs-identifier">orig_ty</span></a></a><span> </span><a name="local-6989586621681925142"><a href="#local-6989586621681925142"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925143"><a href="#local-6989586621681925143"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925142"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925139"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925140"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621681925141"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-6989586621681925143"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-989"></a><span>    </span><span class="hs-identifier">split</span><span> </span><a name="local-6989586621681925144"><a href="#local-6989586621681925144"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925145"><a href="#local-6989586621681925145"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925146"><a href="#local-6989586621681925146"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925139"><span class="hs-identifier hs-var">split</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925145"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925144"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925146"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925146"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-990"></a><span>    </span><span class="hs-identifier">split</span><span> </span><a name="local-6989586621681925147"><a href="#local-6989586621681925147"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621681925148"><a href="#local-6989586621681925148"><span class="hs-identifier">orig_ty</span></a></a><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681925147"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925148"><span class="hs-identifier hs-var">orig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-991"></a><span>
</span><a name="line-992"></a><span class="hs-identifier">funResultTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-993"></a><span class="hs-comment">-- ^ Extract the function result type and panic if that is not possible</span><span>
</span><a name="line-994"></a><a name="funResultTy"><a href="Type.html#funResultTy"><span class="hs-identifier">funResultTy</span></a></a><span> </span><a name="local-6989586621681925149"><a href="#local-6989586621681925149"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925150"><a href="#local-6989586621681925150"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925149"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#funResultTy"><span class="hs-identifier hs-var">funResultTy</span></a><span> </span><a href="#local-6989586621681925150"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-995"></a><span class="hs-identifier">funResultTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925151"><a href="#local-6989586621681925151"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925151"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-996"></a><span class="hs-identifier">funResultTy</span><span> </span><a name="local-6989586621681925152"><a href="#local-6989586621681925152"><span class="hs-identifier">ty</span></a></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;funResultTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925152"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-997"></a><span>
</span><a name="line-998"></a><span class="hs-identifier">funArgTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-999"></a><span class="hs-comment">-- ^ Extract the function argument type and panic if that is not possible</span><span>
</span><a name="line-1000"></a><a name="funArgTy"><a href="Type.html#funArgTy"><span class="hs-identifier">funArgTy</span></a></a><span> </span><a name="local-6989586621681925153"><a href="#local-6989586621681925153"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925154"><a href="#local-6989586621681925154"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925153"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#funArgTy"><span class="hs-identifier hs-var">funArgTy</span></a><span> </span><a href="#local-6989586621681925154"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1001"></a><span class="hs-identifier">funArgTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925155"><a href="#local-6989586621681925155"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925156"><a href="#local-6989586621681925156"><span class="hs-identifier">_res</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925155"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1002"></a><span class="hs-identifier">funArgTy</span><span> </span><a name="local-6989586621681925157"><a href="#local-6989586621681925157"><span class="hs-identifier">ty</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;funArgTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925157"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1003"></a><span>
</span><a name="line-1004"></a><span class="hs-comment">-- ^ Just like 'piResultTys' but for a single argument</span><span>
</span><a name="line-1005"></a><span class="hs-comment">-- Try not to iterate 'piResultTy', because it's inefficient to substitute</span><span>
</span><a name="line-1006"></a><span class="hs-comment">-- one variable at a time; instead use 'piResultTys&quot;</span><span>
</span><a name="line-1007"></a><span class="hs-identifier">piResultTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1008"></a><a name="piResultTy"><a href="Type.html#piResultTy"><span class="hs-identifier">piResultTy</span></a></a><span> </span><a name="local-6989586621681925158"><a href="#local-6989586621681925158"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925159"><a href="#local-6989586621681925159"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#piResultTy_maybe"><span class="hs-identifier hs-var">piResultTy_maybe</span></a><span> </span><a href="#local-6989586621681925158"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925159"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1009"></a><span>                      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925160"><a href="#local-6989586621681925160"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925160"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1010"></a><span>                      </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;piResultTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925158"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925159"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1011"></a><span>
</span><a name="line-1012"></a><span class="hs-identifier">piResultTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1013"></a><a name="piResultTy_maybe"><a href="Type.html#piResultTy_maybe"><span class="hs-identifier">piResultTy_maybe</span></a></a><span> </span><a name="local-6989586621681925161"><a href="#local-6989586621681925161"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925162"><a href="#local-6989586621681925162"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-1014"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925163"><a href="#local-6989586621681925163"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925161"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTy_maybe"><span class="hs-identifier hs-var">piResultTy_maybe</span></a><span> </span><a href="#local-6989586621681925163"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925162"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1015"></a><span>
</span><a name="line-1016"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925164"><a href="#local-6989586621681925164"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925161"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1017"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925164"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1018"></a><span>
</span><a name="line-1019"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925165"><a href="#local-6989586621681925165"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925166"><a href="#local-6989586621681925166"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925161"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1020"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681925167"><a href="#local-6989586621681925167"><span class="hs-identifier">empty_subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1021"></a><span>                      </span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925162"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><a href="#local-6989586621681925166"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">]</span><span>
</span><a name="line-1022"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a><span> </span><a href="#local-6989586621681925167"><span class="hs-identifier hs-var">empty_subst</span></a><span> </span><a href="#local-6989586621681925165"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681925162"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925166"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-1023"></a><span>
</span><a name="line-1024"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1025"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1026"></a><span>
</span><a name="line-1027"></a><span class="hs-comment">-- | (piResultTys f_ty [ty1, .., tyn]) gives the type of (f ty1 .. tyn)</span><span>
</span><a name="line-1028"></a><span class="hs-comment">--   where f :: f_ty</span><span>
</span><a name="line-1029"></a><span class="hs-comment">-- 'piResultTys' is interesting because:</span><span>
</span><a name="line-1030"></a><span class="hs-comment">--      1. 'f_ty' may have more for-alls than there are args</span><span>
</span><a name="line-1031"></a><span class="hs-comment">--      2. Less obviously, it may have fewer for-alls</span><span>
</span><a name="line-1032"></a><span class="hs-comment">-- For case 2. think of:</span><span>
</span><a name="line-1033"></a><span class="hs-comment">--   piResultTys (forall a.a) [forall b.b, Int]</span><span>
</span><a name="line-1034"></a><span class="hs-comment">-- This really can happen, but only (I think) in situations involving</span><span>
</span><a name="line-1035"></a><span class="hs-comment">-- undefined.  For example:</span><span>
</span><a name="line-1036"></a><span class="hs-comment">--       undefined :: forall a. a</span><span>
</span><a name="line-1037"></a><span class="hs-comment">-- Term: undefined @(forall b. b-&gt;b) @Int</span><span>
</span><a name="line-1038"></a><span class="hs-comment">-- This term should have type (Int -&gt; Int), but notice that</span><span>
</span><a name="line-1039"></a><span class="hs-comment">-- there are more type args than foralls in 'undefined's type.</span><span>
</span><a name="line-1040"></a><span>
</span><a name="line-1041"></a><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><a name="line-1042"></a><span class="hs-comment">-- See Note [GHC Formalism] in coreSyn/CoreLint.hs</span><span>
</span><a name="line-1043"></a><span>
</span><a name="line-1044"></a><span class="hs-comment">-- This is a heavily used function (e.g. from typeKind),</span><span>
</span><a name="line-1045"></a><span class="hs-comment">-- so we pay attention to efficiency, especially in the special case</span><span>
</span><a name="line-1046"></a><span class="hs-comment">-- where there are no for-alls so we are just dropping arrows from</span><span>
</span><a name="line-1047"></a><span class="hs-comment">-- a function type/kind.</span><span>
</span><a name="line-1048"></a><span class="hs-identifier">piResultTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1049"></a><a name="piResultTys"><a href="Type.html#piResultTys"><span class="hs-identifier">piResultTys</span></a></a><span> </span><a name="local-6989586621681925168"><a href="#local-6989586621681925168"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925168"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1050"></a><span class="hs-identifier">piResultTys</span><span> </span><a name="local-6989586621681925169"><a href="#local-6989586621681925169"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925170"><a href="#local-6989586621681925170"><span class="hs-identifier">orig_args</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621681925171"><a href="#local-6989586621681925171"><span class="hs-identifier">arg</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925172"><a href="#local-6989586621681925172"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1051"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925186"><a href="#local-6989586621681925186"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925169"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1052"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><a href="#local-6989586621681925186"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925170"><span class="hs-identifier hs-var">orig_args</span></a><span>
</span><a name="line-1053"></a><span>
</span><a name="line-1054"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925187"><a href="#local-6989586621681925187"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925169"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1055"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><a href="#local-6989586621681925187"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925172"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1056"></a><span>
</span><a name="line-1057"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925188"><a href="#local-6989586621681925188"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925189"><a href="#local-6989586621681925189"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925169"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1058"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925174"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a><span> </span><a href="#local-6989586621681925173"><span class="hs-identifier hs-var">init_subst</span></a><span> </span><a href="#local-6989586621681925188"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681925171"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925189"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925172"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1059"></a><span>
</span><a name="line-1060"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1061"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;piResultTys1&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925169"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925170"><span class="hs-identifier hs-var">orig_args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1062"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1063"></a><span>    </span><a name="local-6989586621681925173"><a href="#local-6989586621681925173"><span class="hs-identifier">init_subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925169"><span class="hs-identifier hs-var">ty</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925170"><span class="hs-identifier hs-var">orig_args</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1064"></a><span>
</span><a name="line-1065"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1066"></a><span>    </span><a name="local-6989586621681925174"><a href="#local-6989586621681925174"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925175"><a href="#local-6989586621681925175"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621681925176"><a href="#local-6989586621681925176"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621681925175"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681925176"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1067"></a><span>
</span><a name="line-1068"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925177"><a href="#local-6989586621681925177"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621681925178"><a href="#local-6989586621681925178"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925179"><a href="#local-6989586621681925179"><span class="hs-identifier">all_args</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621681925180"><a href="#local-6989586621681925180"><span class="hs-identifier">arg</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925181"><a href="#local-6989586621681925181"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1069"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925182"><a href="#local-6989586621681925182"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925178"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1070"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925174"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925177"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681925182"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925179"><span class="hs-identifier hs-var">all_args</span></a><span>
</span><a name="line-1071"></a><span>
</span><a name="line-1072"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925183"><a href="#local-6989586621681925183"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925178"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1073"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925174"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925177"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681925183"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925181"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1074"></a><span>
</span><a name="line-1075"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925184"><a href="#local-6989586621681925184"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925185"><a href="#local-6989586621681925185"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925178"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1076"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925174"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#extendTCvSubst"><span class="hs-identifier hs-var">extendTCvSubst</span></a><span> </span><a href="#local-6989586621681925177"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681925184"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681925180"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925185"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925181"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1077"></a><span>
</span><a name="line-1078"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span> </span><a href="#local-6989586621681925177"><span class="hs-identifier hs-var">subst</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- See Note [Care with kind instantiation]</span><span>
</span><a name="line-1079"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925174"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925173"><span class="hs-identifier hs-var">init_subst</span></a><span>
</span><a name="line-1080"></a><span>          </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621681925177"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681925178"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1081"></a><span>          </span><a href="#local-6989586621681925179"><span class="hs-identifier hs-var">all_args</span></a><span>
</span><a name="line-1082"></a><span>
</span><a name="line-1083"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1084"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- We have not run out of arguments, but the function doesn't</span><span>
</span><a name="line-1085"></a><span>        </span><span class="hs-comment">-- have the right kind to apply to them; so panic.</span><span>
</span><a name="line-1086"></a><span>        </span><span class="hs-comment">-- Without the explicit isEmptyVarEnv test, an ill-kinded type</span><span>
</span><a name="line-1087"></a><span>        </span><span class="hs-comment">-- would give an infniite loop, which is very unhelpful</span><span>
</span><a name="line-1088"></a><span>        </span><span class="hs-comment">-- c.f. Trac #15473</span><span>
</span><a name="line-1089"></a><span>        </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;piResultTys2&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925178"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925170"><span class="hs-identifier hs-var">orig_args</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925179"><span class="hs-identifier hs-var">all_args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1090"></a><span>
</span><a name="line-1091"></a><span class="hs-identifier">applyTysX</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1092"></a><span class="hs-comment">-- applyTyxX beta-reduces (/\tvs. body_ty) arg_tys</span><span>
</span><a name="line-1093"></a><span class="hs-comment">-- Assumes that (/\tvs. body_ty) is closed</span><span>
</span><a name="line-1094"></a><a name="applyTysX"><a href="Type.html#applyTysX"><span class="hs-identifier">applyTysX</span></a></a><span> </span><a name="local-6989586621681925190"><a href="#local-6989586621681925190"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-6989586621681925191"><a href="#local-6989586621681925191"><span class="hs-identifier">body_ty</span></a></a><span> </span><a name="local-6989586621681925192"><a href="#local-6989586621681925192"><span class="hs-identifier">arg_tys</span></a></a><span>
</span><a name="line-1095"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">arg_tys</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthAtLeast</span><span class="hs-special">`</span><span> </span><a href="Util.html#lengthAtLeast"><span class="hs-identifier hs-var">n_tvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pp_stuff</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1096"></a><span>    </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">tyCoVarsOfType</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">body_ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">subVarSet</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">mkVarSet</span><span> </span><a href="VarSet.html#subVarSet"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pp_stuff</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1097"></a><span>    </span><a href="Type.html#mkAppTys"><span class="hs-identifier hs-var">mkAppTys</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTyWith"><span class="hs-identifier hs-var">substTyWith</span></a><span> </span><a href="#local-6989586621681925190"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">take</span><span> </span><a href="#local-6989586621681925194"><span class="hs-identifier hs-var">n_tvs</span></a><span> </span><a href="#local-6989586621681925192"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925191"><span class="hs-identifier hs-var">body_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1098"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-6989586621681925194"><span class="hs-identifier hs-var">n_tvs</span></a><span> </span><a href="#local-6989586621681925192"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1099"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1100"></a><span>    </span><a name="local-6989586621681925193"><a href="#local-6989586621681925193"><span class="hs-identifier">pp_stuff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925190"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925191"><span class="hs-identifier hs-var">body_ty</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925192"><span class="hs-identifier hs-var">arg_tys</span></a><span class="hs-special">]</span><span>
</span><a name="line-1101"></a><span>    </span><a name="local-6989586621681925194"><a href="#local-6989586621681925194"><span class="hs-identifier">n_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621681925190"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1102"></a><span>
</span><a name="line-1103"></a><span>
</span><a name="line-1104"></a><span>
</span><a name="line-1105"></a><span class="hs-comment">{- Note [Care with kind instantiation]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
  T :: forall k. k
and we are finding the kind of
  T (forall b. b -&gt; b) * Int
Then
  T (forall b. b-&gt;b) :: k[ k :-&gt; forall b. b-&gt;b]
                     :: forall b. b -&gt; b
So
  T (forall b. b-&gt;b) * :: (b -&gt; b)[ b :-&gt; *]
                       :: * -&gt; *

In other words we must intantiate the forall!

Similarly (Trac #15428)
   S :: forall k f. k -&gt; f k
and we are finding the kind of
   S * (* -&gt;) Int Bool
We have
   S * (* -&gt;) :: (k -&gt; f k)[ k :-&gt; *, f :-&gt; (* -&gt;)]
              :: * -&gt; * -&gt; *
So again we must instantiate.

The same thing happens in ToIface.toIfaceAppArgsX.


---------------------------------------------------------------------
                                TyConApp
                                ~~~~~~~~
-}</span><span>
</span><a name="line-1136"></a><span>
</span><a name="line-1137"></a><span class="hs-comment">-- | A key function: builds a 'TyConApp' or 'FunTy' as appropriate to</span><span>
</span><a name="line-1138"></a><span class="hs-comment">-- its arguments.  Applies its arguments to the constructor from left to right.</span><span>
</span><a name="line-1139"></a><span class="hs-identifier">mkTyConApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1140"></a><a name="mkTyConApp"><a href="Type.html#mkTyConApp"><span class="hs-identifier">mkTyConApp</span></a></a><span> </span><a name="local-6989586621681925195"><a href="#local-6989586621681925195"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-6989586621681925196"><a href="#local-6989586621681925196"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1141"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isFunTyCon"><span class="hs-identifier hs-var">isFunTyCon</span></a><span> </span><a href="#local-6989586621681925195"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1142"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621681925197"><a href="#local-6989586621681925197"><span class="hs-identifier">_rep1</span></a></a><span class="hs-special">,</span><a name="local-6989586621681925198"><a href="#local-6989586621681925198"><span class="hs-identifier">_rep2</span></a></a><span class="hs-special">,</span><a name="local-6989586621681925199"><a href="#local-6989586621681925199"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><a name="local-6989586621681925200"><a href="#local-6989586621681925200"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925196"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1143"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a href="#local-6989586621681925199"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621681925200"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1144"></a><span>
</span><a name="line-1145"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1146"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="#local-6989586621681925195"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621681925196"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1147"></a><span>
</span><a name="line-1148"></a><span class="hs-comment">-- splitTyConApp &quot;looks through&quot; synonyms, because they don't</span><span>
</span><a name="line-1149"></a><span class="hs-comment">-- mean a distinct type, but all other type-constructor applications</span><span>
</span><a name="line-1150"></a><span class="hs-comment">-- including functions are returned as Just ..</span><span>
</span><a name="line-1151"></a><span>
</span><a name="line-1152"></a><span class="hs-comment">-- | Retrieve the tycon heading this type, if there is one. Does /not/</span><span>
</span><a name="line-1153"></a><span class="hs-comment">-- look through synonyms.</span><span>
</span><a name="line-1154"></a><span class="hs-identifier">tyConAppTyConPicky_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-1155"></a><a name="tyConAppTyConPicky_maybe"><a href="Type.html#tyConAppTyConPicky_maybe"><span class="hs-identifier">tyConAppTyConPicky_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925201"><a href="#local-6989586621681925201"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925201"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1156"></a><span class="hs-identifier">tyConAppTyConPicky_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span>
</span><a name="line-1157"></a><span class="hs-identifier">tyConAppTyConPicky_maybe</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1158"></a><span>
</span><a name="line-1159"></a><span>
</span><a name="line-1160"></a><span class="hs-comment">-- | The same as @fst . splitTyConApp@</span><span>
</span><a name="line-1161"></a><span class="hs-identifier">tyConAppTyCon_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-1162"></a><a name="tyConAppTyCon_maybe"><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier">tyConAppTyCon_maybe</span></a></a><span> </span><a name="local-6989586621681925202"><a href="#local-6989586621681925202"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925203"><a href="#local-6989586621681925203"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925202"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621681925203"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1163"></a><span class="hs-identifier">tyConAppTyCon_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925204"><a href="#local-6989586621681925204"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925204"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1164"></a><span class="hs-identifier">tyConAppTyCon_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span>
</span><a name="line-1165"></a><span class="hs-identifier">tyConAppTyCon_maybe</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1166"></a><span>
</span><a name="line-1167"></a><span class="hs-identifier">tyConAppTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-1168"></a><a name="tyConAppTyCon"><a href="Type.html#tyConAppTyCon"><span class="hs-identifier">tyConAppTyCon</span></a></a><span> </span><a name="local-6989586621681925205"><a href="#local-6989586621681925205"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621681925205"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tyConAppTyCon&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925205"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1169"></a><span>
</span><a name="line-1170"></a><span class="hs-comment">-- | The same as @snd . splitTyConApp@</span><span>
</span><a name="line-1171"></a><span class="hs-identifier">tyConAppArgs_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1172"></a><a name="tyConAppArgs_maybe"><a href="Type.html#tyConAppArgs_maybe"><span class="hs-identifier">tyConAppArgs_maybe</span></a></a><span> </span><a name="local-6989586621681925206"><a href="#local-6989586621681925206"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925207"><a href="#local-6989586621681925207"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925206"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tyConAppArgs_maybe"><span class="hs-identifier hs-var">tyConAppArgs_maybe</span></a><span> </span><a href="#local-6989586621681925207"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1173"></a><span class="hs-identifier">tyConAppArgs_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925208"><a href="#local-6989586621681925208"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925208"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1174"></a><span class="hs-identifier">tyConAppArgs_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925209"><a href="#local-6989586621681925209"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925210"><a href="#local-6989586621681925210"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1175"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925211"><a href="#local-6989586621681925211"><span class="hs-identifier">rep1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getRuntimeRep_maybe"><span class="hs-identifier hs-var">getRuntimeRep_maybe</span></a><span> </span><a href="#local-6989586621681925209"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1176"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925212"><a href="#local-6989586621681925212"><span class="hs-identifier">rep2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getRuntimeRep_maybe"><span class="hs-identifier hs-var">getRuntimeRep_maybe</span></a><span> </span><a href="#local-6989586621681925210"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1177"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925211"><span class="hs-identifier hs-var">rep1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925212"><span class="hs-identifier hs-var">rep2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925209"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925210"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">]</span><span>
</span><a name="line-1178"></a><span class="hs-identifier">tyConAppArgs_maybe</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1179"></a><span>
</span><a name="line-1180"></a><span class="hs-identifier">tyConAppArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1181"></a><a name="tyConAppArgs"><a href="Type.html#tyConAppArgs"><span class="hs-identifier">tyConAppArgs</span></a></a><span> </span><a name="local-6989586621681925213"><a href="#local-6989586621681925213"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tyConAppArgs_maybe"><span class="hs-identifier hs-var">tyConAppArgs_maybe</span></a><span> </span><a href="#local-6989586621681925213"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tyConAppArgs&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925213"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1182"></a><span>
</span><a name="line-1183"></a><span class="hs-identifier">tyConAppArgN</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1184"></a><span class="hs-comment">-- Executing Nth</span><span>
</span><a name="line-1185"></a><a name="tyConAppArgN"><a href="Type.html#tyConAppArgN"><span class="hs-identifier">tyConAppArgN</span></a></a><span> </span><a name="local-6989586621681925214"><a href="#local-6989586621681925214"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681925215"><a href="#local-6989586621681925215"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1186"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tyConAppArgs_maybe"><span class="hs-identifier hs-var">tyConAppArgs_maybe</span></a><span> </span><a href="#local-6989586621681925215"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1187"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925216"><a href="#local-6989586621681925216"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthExceeds</span><span class="hs-special">`</span><span> </span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="Util.html#lengthExceeds"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Util.html#lengthExceeds"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-special">)</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">getNth</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">n</span><span>
</span><a name="line-1188"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tyConAppArgN&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925214"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925215"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1189"></a><span>
</span><a name="line-1190"></a><span class="hs-comment">-- | Attempts to tease a type apart into a type constructor and the application</span><span>
</span><a name="line-1191"></a><span class="hs-comment">-- of a number of arguments to that constructor. Panics if that is not possible.</span><span>
</span><a name="line-1192"></a><span class="hs-comment">-- See also 'splitTyConApp_maybe'</span><span>
</span><a name="line-1193"></a><span class="hs-identifier">splitTyConApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1194"></a><a name="splitTyConApp"><a href="Type.html#splitTyConApp"><span class="hs-identifier">splitTyConApp</span></a></a><span> </span><a name="local-6989586621681925217"><a href="#local-6989586621681925217"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925217"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1195"></a><span>                   </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925218"><a href="#local-6989586621681925218"><span class="hs-identifier">stuff</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925218"><span class="hs-identifier hs-var">stuff</span></a><span>
</span><a name="line-1196"></a><span>                   </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;splitTyConApp&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925217"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1197"></a><span>
</span><a name="line-1198"></a><span class="hs-comment">-- | Attempts to tease a type apart into a type constructor and the application</span><span>
</span><a name="line-1199"></a><span class="hs-comment">-- of a number of arguments to that constructor</span><span>
</span><a name="line-1200"></a><span class="hs-identifier">splitTyConApp_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1201"></a><a name="splitTyConApp_maybe"><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier">splitTyConApp_maybe</span></a></a><span> </span><a name="local-6989586621681925219"><a href="#local-6989586621681925219"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925220"><a href="#local-6989586621681925220"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925219"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925220"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1202"></a><span class="hs-identifier">splitTyConApp_maybe</span><span> </span><a name="local-6989586621681925221"><a href="#local-6989586621681925221"><span class="hs-identifier">ty</span></a></a><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#repSplitTyConApp_maybe"><span class="hs-identifier hs-var">repSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925221"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1203"></a><span>
</span><a name="line-1204"></a><span class="hs-comment">-- | Like 'splitTyConApp_maybe', but doesn't look through synonyms. This</span><span>
</span><a name="line-1205"></a><span class="hs-comment">-- assumes the synonyms have already been dealt with.</span><span>
</span><a name="line-1206"></a><span class="hs-identifier">repSplitTyConApp_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1207"></a><a name="repSplitTyConApp_maybe"><a href="Type.html#repSplitTyConApp_maybe"><span class="hs-identifier">repSplitTyConApp_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925222"><a href="#local-6989586621681925222"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925223"><a href="#local-6989586621681925223"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925222"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925223"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1208"></a><span class="hs-identifier">repSplitTyConApp_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925224"><a href="#local-6989586621681925224"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925225"><a href="#local-6989586621681925225"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1209"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925226"><a href="#local-6989586621681925226"><span class="hs-identifier">arg_rep</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getRuntimeRep_maybe"><span class="hs-identifier hs-var">getRuntimeRep_maybe</span></a><span> </span><a href="#local-6989586621681925224"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1210"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925227"><a href="#local-6989586621681925227"><span class="hs-identifier">res_rep</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#getRuntimeRep_maybe"><span class="hs-identifier hs-var">getRuntimeRep_maybe</span></a><span> </span><a href="#local-6989586621681925225"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1211"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925226"><span class="hs-identifier hs-var">arg_rep</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925227"><span class="hs-identifier hs-var">res_rep</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925224"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925225"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1212"></a><span class="hs-identifier">repSplitTyConApp_maybe</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1213"></a><span>
</span><a name="line-1214"></a><span class="hs-comment">-- | Attempts to tease a list type apart and gives the type of the elements if</span><span>
</span><a name="line-1215"></a><span class="hs-comment">-- successful (looks through type synonyms)</span><span>
</span><a name="line-1216"></a><span class="hs-identifier">splitListTyConApp_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1217"></a><a name="splitListTyConApp_maybe"><a href="Type.html#splitListTyConApp_maybe"><span class="hs-identifier">splitListTyConApp_maybe</span></a></a><span> </span><a name="local-6989586621681925228"><a href="#local-6989586621681925228"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925228"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1218"></a><span>  </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925229"><a href="#local-6989586621681925229"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span class="hs-special">[</span><a name="local-6989586621681925230"><a href="#local-6989586621681925230"><span class="hs-identifier">e</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925229"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="TysWiredIn.html#listTyCon"><span class="hs-identifier hs-var">listTyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925230"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1219"></a><span>  </span><a name="local-6989586621681925231"><a href="#local-6989586621681925231"><span class="hs-identifier">_other</span></a></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1220"></a><span>
</span><a name="line-1221"></a><span class="hs-identifier">nextRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>
</span><a name="line-1222"></a><a name="nextRole"><a href="Type.html#nextRole"><span class="hs-identifier">nextRole</span></a></a><span> </span><a name="local-6989586621681925232"><a href="#local-6989586621681925232"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1223"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925233"><a href="#local-6989586621681925233"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925234"><a href="#local-6989586621681925234"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925232"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1224"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681925235"><a href="#local-6989586621681925235"><span class="hs-identifier">num_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621681925234"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1225"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925235"><span class="hs-identifier hs-var">num_tys</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="#local-6989586621681925233"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1226"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a><span> </span><a href="#local-6989586621681925233"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#getNth"><span class="hs-identifier hs-var">getNth</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925235"><span class="hs-identifier hs-var">num_tys</span></a><span>
</span><a name="line-1227"></a><span>
</span><a name="line-1228"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1229"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>
</span><a name="line-1230"></a><span>
</span><a name="line-1231"></a><span class="hs-identifier">newTyConInstRhs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1232"></a><span class="hs-comment">-- ^ Unwrap one 'layer' of newtype on a type constructor and its</span><span>
</span><a name="line-1233"></a><span class="hs-comment">-- arguments, using an eta-reduced version of the @newtype@ if possible.</span><span>
</span><a name="line-1234"></a><span class="hs-comment">-- This requires tys to have at least @newTyConInstArity tycon@ elements.</span><span>
</span><a name="line-1235"></a><a name="newTyConInstRhs"><a href="Type.html#newTyConInstRhs"><span class="hs-identifier">newTyConInstRhs</span></a></a><span> </span><a name="local-6989586621681925236"><a href="#local-6989586621681925236"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-6989586621681925237"><a href="#local-6989586621681925237"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1236"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">leLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">,</span><span> </span><a href="Util.html#leLength"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">tycon</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tys</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1237"></a><span>      </span><a href="Type.html#applyTysX"><span class="hs-identifier hs-var">applyTysX</span></a><span> </span><a href="#local-6989586621681925238"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621681925239"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="#local-6989586621681925237"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1238"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1239"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621681925238"><a href="#local-6989586621681925238"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925239"><a href="#local-6989586621681925239"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#newTyConEtadRhs"><span class="hs-identifier hs-var">newTyConEtadRhs</span></a><span> </span><a href="#local-6989586621681925236"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-1240"></a><span>
</span><a name="line-1241"></a><span class="hs-comment">{-
---------------------------------------------------------------------
                           CastTy
                           ~~~~~~
A casted type has its *kind* casted into something new.
-}</span><span>
</span><a name="line-1247"></a><span>
</span><a name="line-1248"></a><span class="hs-identifier">splitCastTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">)</span><span>
</span><a name="line-1249"></a><a name="splitCastTy_maybe"><a href="Type.html#splitCastTy_maybe"><span class="hs-identifier">splitCastTy_maybe</span></a></a><span> </span><a name="local-6989586621681925240"><a href="#local-6989586621681925240"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925241"><a href="#local-6989586621681925241"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925240"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitCastTy_maybe"><span class="hs-identifier hs-var">splitCastTy_maybe</span></a><span> </span><a href="#local-6989586621681925241"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1250"></a><span class="hs-identifier">splitCastTy_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925242"><a href="#local-6989586621681925242"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925243"><a href="#local-6989586621681925243"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925242"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925243"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1251"></a><span class="hs-identifier">splitCastTy_maybe</span><span> </span><span class="hs-identifier">_</span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1252"></a><span>
</span><a name="line-1253"></a><span class="hs-comment">-- | Make a 'CastTy'. The Coercion must be nominal. Checks the</span><span>
</span><a name="line-1254"></a><span class="hs-comment">-- Coercion for reflexivity, dropping it if it's reflexive.</span><span>
</span><a name="line-1255"></a><span class="hs-comment">-- See Note [Respecting definitional equality] in TyCoRep</span><span>
</span><a name="line-1256"></a><span class="hs-identifier">mkCastTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1257"></a><a name="mkCastTy"><a href="Type.html#mkCastTy"><span class="hs-identifier">mkCastTy</span></a></a><span> </span><a name="local-6989586621681925244"><a href="#local-6989586621681925244"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925245"><a href="#local-6989586621681925245"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Coercion.html#isReflexiveCo"><span class="hs-identifier hs-var">isReflexiveCo</span></a><span> </span><a href="#local-6989586621681925245"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925244"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-comment">-- (EQ2) from the Note</span><span>
</span><a name="line-1258"></a><span class="hs-comment">-- NB: Do the slow check here. This is important to keep the splitXXX</span><span>
</span><a name="line-1259"></a><span class="hs-comment">-- functions working properly. Otherwise, we may end up with something</span><span>
</span><a name="line-1260"></a><span class="hs-comment">-- like (((-&gt;) |&gt; something_reflexive_but_not_obviously_so) biz baz)</span><span>
</span><a name="line-1261"></a><span class="hs-comment">-- fails under splitFunTy_maybe. This happened with the cheaper check</span><span>
</span><a name="line-1262"></a><span class="hs-comment">-- in test dependent/should_compile/dynamic-paper.</span><span>
</span><a name="line-1263"></a><span>
</span><a name="line-1264"></a><span class="hs-identifier">mkCastTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925246"><a href="#local-6989586621681925246"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925247"><a href="#local-6989586621681925247"><span class="hs-identifier">co1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925248"><a href="#local-6989586621681925248"><span class="hs-identifier">co2</span></a></a><span>
</span><a name="line-1265"></a><span>  </span><span class="hs-comment">-- (EQ3) from the Note</span><span>
</span><a name="line-1266"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span> </span><a href="#local-6989586621681925246"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925247"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">`</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925248"><span class="hs-identifier hs-var">co2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1267"></a><span>      </span><span class="hs-comment">-- call mkCastTy again for the reflexivity check</span><span>
</span><a name="line-1268"></a><span>
</span><a name="line-1269"></a><span class="hs-identifier">mkCastTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925249"><a href="#local-6989586621681925249"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681925250"><a href="#local-6989586621681925250"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925251"><a href="#local-6989586621681925251"><span class="hs-identifier">inner_ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925252"><a href="#local-6989586621681925252"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-1270"></a><span>  </span><span class="hs-comment">-- (EQ4) from the Note</span><span>
</span><a name="line-1271"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621681925249"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1272"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681925253"><a href="#local-6989586621681925253"><span class="hs-identifier">fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span> </span><a href="#local-6989586621681925252"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1273"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- have to make sure that pushing the co in doesn't capture the bound var!</span><span>
</span><a name="line-1274"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681925249"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925253"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-1275"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681925254"><a href="#local-6989586621681925254"><span class="hs-identifier">empty_subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><a href="#local-6989586621681925253"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1276"></a><span>             </span><span class="hs-special">(</span><a name="local-6989586621681925255"><a href="#local-6989586621681925255"><span class="hs-identifier">subst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925256"><a href="#local-6989586621681925256"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#substVarBndr"><span class="hs-identifier hs-var">substVarBndr</span></a><span> </span><a href="#local-6989586621681925254"><span class="hs-identifier hs-var">empty_subst</span></a><span> </span><a href="#local-6989586621681925249"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1277"></a><span>         </span><span class="hs-keyword">in</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925256"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681925250"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTy"><span class="hs-identifier hs-var">substTy</span></a><span> </span><a href="#local-6989586621681925255"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681925251"><span class="hs-identifier hs-var">inner_ty</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925252"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1278"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925249"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681925250"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925251"><span class="hs-identifier hs-var">inner_ty</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925252"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-1279"></a><span>
</span><a name="line-1280"></a><span class="hs-identifier">mkCastTy</span><span> </span><a name="local-6989586621681925257"><a href="#local-6989586621681925257"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925258"><a href="#local-6989586621681925258"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a href="#local-6989586621681925257"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925258"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1281"></a><span>
</span><a name="line-1282"></a><span class="hs-identifier">tyConBindersTyCoBinders</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span class="hs-special">]</span><span>
</span><a name="line-1283"></a><span class="hs-comment">-- Return the tyConBinders in TyCoBinder form</span><span>
</span><a name="line-1284"></a><a name="tyConBindersTyCoBinders"><a href="Type.html#tyConBindersTyCoBinders"><span class="hs-identifier">tyConBindersTyCoBinders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621681925259"><span class="hs-identifier hs-var">to_tyb</span></a><span>
</span><a name="line-1285"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1286"></a><span>    </span><a name="local-6989586621681925259"><a href="#local-6989586621681925259"><span class="hs-identifier">to_tyb</span></a></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925260"><a href="#local-6989586621681925260"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#NamedTCB"><span class="hs-identifier hs-var">NamedTCB</span></a><span> </span><a name="local-6989586621681925261"><a href="#local-6989586621681925261"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925260"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681925261"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span>
</span><a name="line-1287"></a><span>    </span><span class="hs-identifier">to_tyb</span><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925262"><a href="#local-6989586621681925262"><span class="hs-identifier">tv</span></a></a><span> </span><a href="TyCon.html#AnonTCB"><span class="hs-identifier hs-var">AnonTCB</span></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925262"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1288"></a><span>
</span><a name="line-1289"></a><span class="hs-comment">{-
--------------------------------------------------------------------
                            CoercionTy
                            ~~~~~~~~~~
CoercionTy allows us to inject coercions into types. A CoercionTy
should appear only in the right-hand side of an application.
-}</span><span>
</span><a name="line-1296"></a><span>
</span><a name="line-1297"></a><span class="hs-identifier">mkCoercionTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1298"></a><a name="mkCoercionTy"><a href="Type.html#mkCoercionTy"><span class="hs-identifier">mkCoercionTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span>
</span><a name="line-1299"></a><span>
</span><a name="line-1300"></a><span class="hs-identifier">isCoercionTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1301"></a><a name="isCoercionTy"><a href="Type.html#isCoercionTy"><span class="hs-identifier">isCoercionTy</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1302"></a><span class="hs-identifier">isCoercionTy</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1303"></a><span>
</span><a name="line-1304"></a><span class="hs-identifier">isCoercionTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1305"></a><a name="isCoercionTy_maybe"><a href="Type.html#isCoercionTy_maybe"><span class="hs-identifier">isCoercionTy_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621681925263"><a href="#local-6989586621681925263"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925263"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1306"></a><span class="hs-identifier">isCoercionTy_maybe</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1307"></a><span>
</span><a name="line-1308"></a><span class="hs-identifier">stripCoercionTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-1309"></a><a name="stripCoercionTy"><a href="Type.html#stripCoercionTy"><span class="hs-identifier">stripCoercionTy</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621681925264"><a href="#local-6989586621681925264"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925264"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1310"></a><span class="hs-identifier">stripCoercionTy</span><span> </span><a name="local-6989586621681925265"><a href="#local-6989586621681925265"><span class="hs-identifier">ty</span></a></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;stripCoercionTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925265"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1311"></a><span>
</span><a name="line-1312"></a><span class="hs-comment">{-
---------------------------------------------------------------------
                                SynTy
                                ~~~~~

Notes on type synonyms
~~~~~~~~~~~~~~~~~~~~~~
The various &quot;split&quot; functions (splitFunTy, splitRhoTy, splitForAllTy) try
to return type synonyms wherever possible. Thus

        type Foo a = a -&gt; a

we want
        splitFunTys (a -&gt; Foo a) = ([a], Foo a)
not                                ([a], a -&gt; a)

The reason is that we then get better (shorter) type signatures in
interfaces.  Notably this plays a role in tcTySigs in TcBinds.hs.


---------------------------------------------------------------------
                                ForAllTy
                                ~~~~~~~~
-}</span><span>
</span><a name="line-1336"></a><span>
</span><a name="line-1337"></a><span class="hs-comment">-- | Make a dependent forall over an Inferred variablem</span><span>
</span><a name="line-1338"></a><span class="hs-identifier">mkTyCoInvForAllTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1339"></a><a name="mkTyCoInvForAllTy"><a href="Type.html#mkTyCoInvForAllTy"><span class="hs-identifier">mkTyCoInvForAllTy</span></a></a><span> </span><a name="local-6989586621681925266"><a href="#local-6989586621681925266"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681925267"><a href="#local-6989586621681925267"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1340"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a><span> </span><a href="#local-6989586621681925266"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1341"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925266"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621681925267"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1342"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925266"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925267"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1343"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1344"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925266"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925267"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1345"></a><span>
</span><a name="line-1346"></a><span class="hs-comment">-- | Like mkTyCoInvForAllTy, but tv should be a tyvar</span><span>
</span><a name="line-1347"></a><span class="hs-identifier">mkInvForAllTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1348"></a><a name="mkInvForAllTy"><a href="Type.html#mkInvForAllTy"><span class="hs-identifier">mkInvForAllTy</span></a></a><span> </span><a name="local-6989586621681925268"><a href="#local-6989586621681925268"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681925269"><a href="#local-6989586621681925269"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier hs-var">tv</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1349"></a><span>                      </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925268"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925269"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1350"></a><span>
</span><a name="line-1351"></a><span class="hs-comment">-- | Like mkForAllTys, but assumes all variables are dependent and Inferred,</span><span>
</span><a name="line-1352"></a><span class="hs-comment">-- a common case</span><span>
</span><a name="line-1353"></a><span class="hs-identifier">mkTyCoInvForAllTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1354"></a><a name="mkTyCoInvForAllTys"><a href="Type.html#mkTyCoInvForAllTys"><span class="hs-identifier">mkTyCoInvForAllTys</span></a></a><span> </span><a name="local-6989586621681925270"><a href="#local-6989586621681925270"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-6989586621681925271"><a href="#local-6989586621681925271"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="Type.html#mkTyCoInvForAllTy"><span class="hs-identifier hs-var">mkTyCoInvForAllTy</span></a><span> </span><a href="#local-6989586621681925271"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925270"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1355"></a><span>
</span><a name="line-1356"></a><span class="hs-comment">-- | Like 'mkTyCoInvForAllTys', but tvs should be a list of tyvar</span><span>
</span><a name="line-1357"></a><span class="hs-identifier">mkInvForAllTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1358"></a><a name="mkInvForAllTys"><a href="Type.html#mkInvForAllTys"><span class="hs-identifier">mkInvForAllTys</span></a></a><span> </span><a name="local-6989586621681925272"><a href="#local-6989586621681925272"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-6989586621681925273"><a href="#local-6989586621681925273"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="Type.html#mkInvForAllTy"><span class="hs-identifier hs-var">mkInvForAllTy</span></a><span> </span><a href="#local-6989586621681925273"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925272"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1359"></a><span>
</span><a name="line-1360"></a><span class="hs-comment">-- | Like mkForAllTys, but assumes all variables are dependent and Specified,</span><span>
</span><a name="line-1361"></a><span class="hs-comment">-- a common case</span><span>
</span><a name="line-1362"></a><span class="hs-identifier">mkSpecForAllTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1363"></a><a name="mkSpecForAllTys"><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier">mkSpecForAllTys</span></a></a><span> </span><a name="local-6989586621681925274"><a href="#local-6989586621681925274"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">all</span></a><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1364"></a><span>                      </span><span class="hs-comment">-- covar is always Inferred, so all inputs should be tyvar</span><span>
</span><a name="line-1365"></a><span>                      </span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925275"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Var.html#Specified"><span class="hs-identifier hs-var">Specified</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681925275"><a href="#local-6989586621681925275"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925274"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1366"></a><span>
</span><a name="line-1367"></a><span class="hs-comment">-- | Like mkForAllTys, but assumes all variables are dependent and visible</span><span>
</span><a name="line-1368"></a><span class="hs-identifier">mkVisForAllTys</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1369"></a><a name="mkVisForAllTys"><a href="Type.html#mkVisForAllTys"><span class="hs-identifier">mkVisForAllTys</span></a></a><span> </span><a name="local-6989586621681925276"><a href="#local-6989586621681925276"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">all</span></a><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">tvs</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1370"></a><span>                     </span><span class="hs-comment">-- covar is always Inferred, so all inputs should be tyvar</span><span>
</span><a name="line-1371"></a><span>                     </span><a href="TyCoRep.html#mkForAllTys"><span class="hs-identifier hs-var">mkForAllTys</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925277"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="Var.html#Required"><span class="hs-identifier hs-var">Required</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681925277"><a href="#local-6989586621681925277"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925276"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1372"></a><span>
</span><a name="line-1373"></a><span class="hs-identifier">mkLamType</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1374"></a><span class="hs-comment">-- ^ Makes a @(-&gt;)@ type or an implicit forall type, depending</span><span>
</span><a name="line-1375"></a><span class="hs-comment">-- on whether it is given a type variable or a term variable.</span><span>
</span><a name="line-1376"></a><span class="hs-comment">-- This is used, for example, when producing the type of a lambda.</span><span>
</span><a name="line-1377"></a><span class="hs-comment">-- Always uses Inferred binders.</span><span>
</span><a name="line-1378"></a><span class="hs-identifier">mkLamTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1379"></a><span class="hs-comment">-- ^ 'mkLamType' for multiple type or value arguments</span><span>
</span><a name="line-1380"></a><span>
</span><a name="line-1381"></a><a name="mkLamType"><a href="Type.html#mkLamType"><span class="hs-identifier">mkLamType</span></a></a><span> </span><a name="local-6989586621681925278"><a href="#local-6989586621681925278"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621681925279"><a href="#local-6989586621681925279"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1382"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a><span> </span><a href="#local-6989586621681925278"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1383"></a><span>   </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925278"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621681925279"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1384"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925278"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925279"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1385"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621681925278"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1386"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925278"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925279"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1387"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1388"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925278"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925279"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1389"></a><span>
</span><a name="line-1390"></a><a name="mkLamTypes"><a href="Type.html#mkLamTypes"><span class="hs-identifier">mkLamTypes</span></a></a><span> </span><a name="local-6989586621681925280"><a href="#local-6989586621681925280"><span class="hs-identifier">vs</span></a></a><span> </span><a name="local-6989586621681925281"><a href="#local-6989586621681925281"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="Type.html#mkLamType"><span class="hs-identifier hs-var">mkLamType</span></a><span> </span><a href="#local-6989586621681925281"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925280"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-1391"></a><span>
</span><a name="line-1392"></a><span class="hs-comment">-- | Given a list of type-level vars and the free vars of a result kind,</span><span>
</span><a name="line-1393"></a><span class="hs-comment">-- makes TyCoBinders, preferring anonymous binders</span><span>
</span><a name="line-1394"></a><span class="hs-comment">-- if the variable is, in fact, not dependent.</span><span>
</span><a name="line-1395"></a><span class="hs-comment">-- e.g.    mkTyConBindersPreferAnon [(k:*),(b:k),(c:k)] (k-&gt;k)</span><span>
</span><a name="line-1396"></a><span class="hs-comment">-- We want (k:*) Named, (b:k) Anon, (c:k) Anon</span><span>
</span><a name="line-1397"></a><span class="hs-comment">--</span><span>
</span><a name="line-1398"></a><span class="hs-comment">-- All non-coercion binders are /visible/.</span><span>
</span><a name="line-1399"></a><span class="hs-identifier">mkTyConBindersPreferAnon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- ^ binders</span><span>
</span><a name="line-1400"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span>   </span><span class="hs-comment">-- ^ free variables of result</span><span>
</span><a name="line-1401"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span class="hs-special">]</span><span>
</span><a name="line-1402"></a><a name="mkTyConBindersPreferAnon"><a href="Type.html#mkTyConBindersPreferAnon"><span class="hs-identifier">mkTyConBindersPreferAnon</span></a></a><span> </span><a name="local-6989586621681925282"><a href="#local-6989586621681925282"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621681925283"><a href="#local-6989586621681925283"><span class="hs-identifier">inner_tkvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">all</span></a><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">vars</span><span class="hs-special">)</span><span>
</span><a name="line-1403"></a><span>                                           </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925284"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925282"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span>
</span><a name="line-1404"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1405"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- also returns the free vars</span><span>
</span><a name="line-1406"></a><span>    </span><a name="local-6989586621681925284"><a href="#local-6989586621681925284"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925283"><span class="hs-identifier hs-var">inner_tkvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1407"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925285"><a href="#local-6989586621681925285"><span class="hs-identifier">v</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925286"><a href="#local-6989586621681925286"><span class="hs-identifier">vs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925285"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925288"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-1408"></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925285"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#NamedTCB"><span class="hs-identifier hs-var">NamedTCB</span></a><span> </span><a href="Var.html#Required"><span class="hs-identifier hs-var">Required</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925287"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-1409"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925288"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#delVarSet"><span class="hs-identifier hs-var">delVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925285"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925289"><span class="hs-identifier hs-var">kind_vars</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1410"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1411"></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925285"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="TyCon.html#AnonTCB"><span class="hs-identifier hs-var">AnonTCB</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925287"><span class="hs-identifier hs-var">binders</span></a><span>
</span><a name="line-1412"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925288"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925289"><span class="hs-identifier hs-var">kind_vars</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1413"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1414"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621681925287"><a href="#local-6989586621681925287"><span class="hs-identifier">binders</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925288"><a href="#local-6989586621681925288"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925284"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925286"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-1415"></a><span>        </span><a name="local-6989586621681925289"><a href="#local-6989586621681925289"><span class="hs-identifier">kind_vars</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621681925285"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1416"></a><span>
</span><a name="line-1417"></a><span class="hs-comment">-- | Take a ForAllTy apart, returning the list of tycovars and the result type.</span><span>
</span><a name="line-1418"></a><span class="hs-comment">-- This always succeeds, even if it returns only an empty list. Note that the</span><span>
</span><a name="line-1419"></a><span class="hs-comment">-- result type returned may have free variables that were bound by a forall.</span><span>
</span><a name="line-1420"></a><span class="hs-identifier">splitForAllTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1421"></a><a name="splitForAllTys"><a href="Type.html#splitForAllTys"><span class="hs-identifier">splitForAllTys</span></a></a><span> </span><a name="local-6989586621681925290"><a href="#local-6989586621681925290"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925291"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925290"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925290"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1422"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1423"></a><span>    </span><a name="local-6989586621681925291"><a href="#local-6989586621681925291"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621681925292"><a href="#local-6989586621681925292"><span class="hs-identifier">orig_ty</span></a></a><span> </span><a name="local-6989586621681925293"><a href="#local-6989586621681925293"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925294"><a href="#local-6989586621681925294"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925295"><a href="#local-6989586621681925295"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925293"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925291"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925292"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-6989586621681925295"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925294"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1424"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925296"><a href="#local-6989586621681925296"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925297"><a href="#local-6989586621681925297"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>    </span><a name="local-6989586621681925298"><a href="#local-6989586621681925298"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925291"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925297"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925297"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925296"><span class="hs-identifier hs-var">tv</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925298"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1425"></a><span>    </span><span class="hs-identifier">split</span><span> </span><a name="local-6989586621681925299"><a href="#local-6989586621681925299"><span class="hs-identifier">orig_ty</span></a></a><span> </span><span class="hs-identifier">_</span><span>                            </span><a name="local-6989586621681925300"><a href="#local-6989586621681925300"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681925300"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925299"><span class="hs-identifier hs-var">orig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1426"></a><span>
</span><a name="line-1427"></a><span class="hs-comment">-- | Like splitForAllTys, but split only for tyvars.</span><span>
</span><a name="line-1428"></a><span class="hs-comment">-- This always succeeds, even if it returns only an empty list. Note that the</span><span>
</span><a name="line-1429"></a><span class="hs-comment">-- result type returned may have free variables that were bound by a forall.</span><span>
</span><a name="line-1430"></a><span class="hs-identifier">splitTyVarForAllTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1431"></a><a name="splitTyVarForAllTys"><a href="Type.html#splitTyVarForAllTys"><span class="hs-identifier">splitTyVarForAllTys</span></a></a><span> </span><a name="local-6989586621681925301"><a href="#local-6989586621681925301"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925302"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925301"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925301"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1432"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1433"></a><span>    </span><a name="local-6989586621681925302"><a href="#local-6989586621681925302"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621681925303"><a href="#local-6989586621681925303"><span class="hs-identifier">orig_ty</span></a></a><span> </span><a name="local-6989586621681925304"><a href="#local-6989586621681925304"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925305"><a href="#local-6989586621681925305"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925306"><a href="#local-6989586621681925306"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925304"><span class="hs-identifier hs-var">ty</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925302"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925303"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-6989586621681925306"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925305"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1434"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925307"><a href="#local-6989586621681925307"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925308"><a href="#local-6989586621681925308"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925309"><a href="#local-6989586621681925309"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621681925307"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925302"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925308"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925308"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925307"><span class="hs-identifier hs-var">tv</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925309"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1435"></a><span>    </span><span class="hs-identifier">split</span><span> </span><a name="local-6989586621681925310"><a href="#local-6989586621681925310"><span class="hs-identifier">orig_ty</span></a></a><span> </span><span class="hs-identifier">_</span><span>                   </span><a name="local-6989586621681925311"><a href="#local-6989586621681925311"><span class="hs-identifier">tvs</span></a></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681925311"><span class="hs-identifier hs-var">tvs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925310"><span class="hs-identifier hs-var">orig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1436"></a><span>
</span><a name="line-1437"></a><span class="hs-comment">-- | Checks whether this is a proper forall (with a named binder)</span><span>
</span><a name="line-1438"></a><span class="hs-identifier">isForAllTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1439"></a><a name="isForAllTy"><a href="Type.html#isForAllTy"><span class="hs-identifier">isForAllTy</span></a></a><span> </span><a name="local-6989586621681925312"><a href="#local-6989586621681925312"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925313"><a href="#local-6989586621681925313"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925312"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a><span> </span><a href="#local-6989586621681925313"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1440"></a><span class="hs-identifier">isForAllTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1441"></a><span class="hs-identifier">isForAllTy</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1442"></a><span>
</span><a name="line-1443"></a><span class="hs-comment">-- | Like `isForAllTy`, but returns True only if it is a tyvar binder</span><span>
</span><a name="line-1444"></a><span class="hs-identifier">isForAllTy_ty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1445"></a><a name="isForAllTy_ty"><a href="Type.html#isForAllTy_ty"><span class="hs-identifier">isForAllTy_ty</span></a></a><span> </span><a name="local-6989586621681925314"><a href="#local-6989586621681925314"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925315"><a href="#local-6989586621681925315"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925314"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isForAllTy_ty"><span class="hs-identifier hs-var">isForAllTy_ty</span></a><span> </span><a href="#local-6989586621681925315"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1446"></a><span class="hs-identifier">isForAllTy_ty</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925316"><a href="#local-6989586621681925316"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621681925316"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1447"></a><span class="hs-identifier">isForAllTy_ty</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1448"></a><span>
</span><a name="line-1449"></a><span class="hs-comment">-- | Like `isForAllTy`, but returns True only if it is a covar binder</span><span>
</span><a name="line-1450"></a><span class="hs-identifier">isForAllTy_co</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1451"></a><a name="isForAllTy_co"><a href="Type.html#isForAllTy_co"><span class="hs-identifier">isForAllTy_co</span></a></a><span> </span><a name="local-6989586621681925317"><a href="#local-6989586621681925317"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925318"><a href="#local-6989586621681925318"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925317"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isForAllTy_co"><span class="hs-identifier hs-var">isForAllTy_co</span></a><span> </span><a href="#local-6989586621681925318"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1452"></a><span class="hs-identifier">isForAllTy_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925319"><a href="#local-6989586621681925319"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a><span> </span><a href="#local-6989586621681925319"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1453"></a><span class="hs-identifier">isForAllTy_co</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1454"></a><span>
</span><a name="line-1455"></a><span class="hs-comment">-- | Is this a function or forall?</span><span>
</span><a name="line-1456"></a><span class="hs-identifier">isPiTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1457"></a><a name="isPiTy"><a href="Type.html#isPiTy"><span class="hs-identifier">isPiTy</span></a></a><span> </span><a name="local-6989586621681925320"><a href="#local-6989586621681925320"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925321"><a href="#local-6989586621681925321"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925320"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isForAllTy"><span class="hs-identifier hs-var">isForAllTy</span></a><span> </span><a href="#local-6989586621681925321"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1458"></a><span class="hs-identifier">isPiTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1459"></a><span class="hs-identifier">isPiTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1460"></a><span class="hs-identifier">isPiTy</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1461"></a><span>
</span><a name="line-1462"></a><span class="hs-comment">-- | Take a forall type apart, or panics if that is not possible.</span><span>
</span><a name="line-1463"></a><span class="hs-identifier">splitForAllTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1464"></a><a name="splitForAllTy"><a href="Type.html#splitForAllTy"><span class="hs-identifier">splitForAllTy</span></a></a><span> </span><a name="local-6989586621681925322"><a href="#local-6989586621681925322"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1465"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925323"><a href="#local-6989586621681925323"><span class="hs-identifier">answer</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitForAllTy_maybe"><span class="hs-identifier hs-var">splitForAllTy_maybe</span></a><span> </span><a href="#local-6989586621681925322"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925323"><span class="hs-identifier hs-var">answer</span></a><span>
</span><a name="line-1466"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;splitForAllTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925322"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1467"></a><span>
</span><a name="line-1468"></a><span class="hs-comment">-- | Drops all ForAllTys</span><span>
</span><a name="line-1469"></a><span class="hs-identifier">dropForAlls</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1470"></a><a name="dropForAlls"><a href="Type.html#dropForAlls"><span class="hs-identifier">dropForAlls</span></a></a><span> </span><a name="local-6989586621681925324"><a href="#local-6989586621681925324"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925325"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925324"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1471"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1472"></a><span>    </span><a name="local-6989586621681925325"><a href="#local-6989586621681925325"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925326"><a href="#local-6989586621681925326"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925327"><a href="#local-6989586621681925327"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925326"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925325"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925327"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1473"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925328"><a href="#local-6989586621681925328"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925325"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925328"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1474"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925329"><a href="#local-6989586621681925329"><span class="hs-identifier">res</span></a></a><span>                         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925329"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1475"></a><span>
</span><a name="line-1476"></a><span class="hs-comment">-- | Attempts to take a forall type apart, but only if it's a proper forall,</span><span>
</span><a name="line-1477"></a><span class="hs-comment">-- with a named binder</span><span>
</span><a name="line-1478"></a><span class="hs-identifier">splitForAllTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1479"></a><a name="splitForAllTy_maybe"><a href="Type.html#splitForAllTy_maybe"><span class="hs-identifier">splitForAllTy_maybe</span></a></a><span> </span><a name="local-6989586621681925330"><a href="#local-6989586621681925330"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925331"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925330"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1480"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1481"></a><span>    </span><a name="local-6989586621681925331"><a href="#local-6989586621681925331"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925332"><a href="#local-6989586621681925332"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925333"><a href="#local-6989586621681925333"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925332"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925331"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925333"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1482"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925334"><a href="#local-6989586621681925334"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925335"><a href="#local-6989586621681925335"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925334"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925335"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1483"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1484"></a><span>
</span><a name="line-1485"></a><span class="hs-comment">-- | Like splitForAllTy_maybe, but only returns Just if it is a tyvar binder.</span><span>
</span><a name="line-1486"></a><span class="hs-identifier">splitForAllTy_ty_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1487"></a><a name="splitForAllTy_ty_maybe"><a href="Type.html#splitForAllTy_ty_maybe"><span class="hs-identifier">splitForAllTy_ty_maybe</span></a></a><span> </span><a name="local-6989586621681925336"><a href="#local-6989586621681925336"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925337"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925336"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1488"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1489"></a><span>    </span><a name="local-6989586621681925337"><a href="#local-6989586621681925337"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925338"><a href="#local-6989586621681925338"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925339"><a href="#local-6989586621681925339"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925338"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925337"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925339"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1490"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925340"><a href="#local-6989586621681925340"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925341"><a href="#local-6989586621681925341"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621681925340"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925340"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925341"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1491"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1492"></a><span>
</span><a name="line-1493"></a><span class="hs-comment">-- | Like splitForAllTy_maybe, but only returns Just if it is a covar binder.</span><span>
</span><a name="line-1494"></a><span class="hs-identifier">splitForAllTy_co_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1495"></a><a name="splitForAllTy_co_maybe"><a href="Type.html#splitForAllTy_co_maybe"><span class="hs-identifier">splitForAllTy_co_maybe</span></a></a><span> </span><a name="local-6989586621681925342"><a href="#local-6989586621681925342"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925343"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925342"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1496"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1497"></a><span>    </span><a name="local-6989586621681925343"><a href="#local-6989586621681925343"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925344"><a href="#local-6989586621681925344"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925345"><a href="#local-6989586621681925345"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925344"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925343"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925345"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1498"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925346"><a href="#local-6989586621681925346"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925347"><a href="#local-6989586621681925347"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a><span> </span><a href="#local-6989586621681925346"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925346"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925347"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1499"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1500"></a><span>
</span><a name="line-1501"></a><span class="hs-comment">-- | Attempts to take a forall type apart; works with proper foralls and</span><span>
</span><a name="line-1502"></a><span class="hs-comment">-- functions</span><span>
</span><a name="line-1503"></a><span class="hs-identifier">splitPiTy_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1504"></a><a name="splitPiTy_maybe"><a href="Type.html#splitPiTy_maybe"><span class="hs-identifier">splitPiTy_maybe</span></a></a><span> </span><a name="local-6989586621681925348"><a href="#local-6989586621681925348"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925349"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925348"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1505"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1506"></a><span>    </span><a name="local-6989586621681925349"><a href="#local-6989586621681925349"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925350"><a href="#local-6989586621681925350"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925351"><a href="#local-6989586621681925351"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925350"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925349"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925351"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1507"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-6989586621681925352"><a href="#local-6989586621681925352"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621681925353"><a href="#local-6989586621681925353"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a href="#local-6989586621681925352"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925353"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1508"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925354"><a href="#local-6989586621681925354"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925355"><a href="#local-6989586621681925355"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a href="#local-6989586621681925354"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925355"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">)</span><span>
</span><a name="line-1509"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1510"></a><span>
</span><a name="line-1511"></a><span class="hs-comment">-- | Takes a forall type apart, or panics</span><span>
</span><a name="line-1512"></a><span class="hs-identifier">splitPiTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1513"></a><a name="splitPiTy"><a href="Type.html#splitPiTy"><span class="hs-identifier">splitPiTy</span></a></a><span> </span><a name="local-6989586621681925356"><a href="#local-6989586621681925356"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1514"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925357"><a href="#local-6989586621681925357"><span class="hs-identifier">answer</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitPiTy_maybe"><span class="hs-identifier hs-var">splitPiTy_maybe</span></a><span> </span><a href="#local-6989586621681925356"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925357"><span class="hs-identifier hs-var">answer</span></a><span>
</span><a name="line-1515"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;splitPiTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925356"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1516"></a><span>
</span><a name="line-1517"></a><span class="hs-comment">-- | Split off all TyCoBinders to a type, splitting both proper foralls</span><span>
</span><a name="line-1518"></a><span class="hs-comment">-- and functions</span><span>
</span><a name="line-1519"></a><span class="hs-identifier">splitPiTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1520"></a><a name="splitPiTys"><a href="Type.html#splitPiTys"><span class="hs-identifier">splitPiTys</span></a></a><span> </span><a name="local-6989586621681925358"><a href="#local-6989586621681925358"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925359"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925358"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925358"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1521"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1522"></a><span>    </span><a name="local-6989586621681925359"><a href="#local-6989586621681925359"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621681925360"><a href="#local-6989586621681925360"><span class="hs-identifier">orig_ty</span></a></a><span> </span><a name="local-6989586621681925361"><a href="#local-6989586621681925361"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925362"><a href="#local-6989586621681925362"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925363"><a href="#local-6989586621681925363"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925361"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925359"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925360"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-6989586621681925363"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925362"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-1523"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-6989586621681925364"><a href="#local-6989586621681925364"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621681925365"><a href="#local-6989586621681925365"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925366"><a href="#local-6989586621681925366"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925359"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925365"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925365"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a href="#local-6989586621681925364"><span class="hs-identifier hs-var">b</span></a><span>  </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925366"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1524"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925367"><a href="#local-6989586621681925367"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925368"><a href="#local-6989586621681925368"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>  </span><a name="local-6989586621681925369"><a href="#local-6989586621681925369"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925359"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925368"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925368"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a href="#local-6989586621681925367"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925369"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1525"></a><span>    </span><span class="hs-identifier">split</span><span> </span><a name="local-6989586621681925370"><a href="#local-6989586621681925370"><span class="hs-identifier">orig_ty</span></a></a><span> </span><span class="hs-identifier">_</span><span>                </span><a name="local-6989586621681925371"><a href="#local-6989586621681925371"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681925371"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925370"><span class="hs-identifier hs-var">orig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1526"></a><span>
</span><a name="line-1527"></a><span class="hs-comment">-- | Like 'splitPiTys' but split off only /named/ binders</span><span>
</span><a name="line-1528"></a><span class="hs-comment">--   and returns TyCoVarBinders rather than TyCoBinders</span><span>
</span><a name="line-1529"></a><span class="hs-identifier">splitForAllVarBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyCoVarBinder"><span class="hs-identifier hs-type">TyCoVarBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1530"></a><a name="splitForAllVarBndrs"><a href="Type.html#splitForAllVarBndrs"><span class="hs-identifier">splitForAllVarBndrs</span></a></a><span> </span><a name="local-6989586621681925372"><a href="#local-6989586621681925372"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925373"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925372"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925372"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1531"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1532"></a><span>    </span><a name="local-6989586621681925373"><a href="#local-6989586621681925373"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621681925374"><a href="#local-6989586621681925374"><span class="hs-identifier">orig_ty</span></a></a><span> </span><a name="local-6989586621681925375"><a href="#local-6989586621681925375"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925376"><a href="#local-6989586621681925376"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925377"><a href="#local-6989586621681925377"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925375"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925373"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925374"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-6989586621681925377"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925376"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-1533"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-6989586621681925378"><a href="#local-6989586621681925378"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621681925379"><a href="#local-6989586621681925379"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925380"><a href="#local-6989586621681925380"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925373"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925379"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925379"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925378"><span class="hs-identifier hs-var">b</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925380"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1534"></a><span>    </span><span class="hs-identifier">split</span><span> </span><a name="local-6989586621681925381"><a href="#local-6989586621681925381"><span class="hs-identifier">orig_ty</span></a></a><span> </span><span class="hs-identifier">_</span><span>                </span><a name="local-6989586621681925382"><a href="#local-6989586621681925382"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681925382"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925381"><span class="hs-identifier hs-var">orig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1535"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">splitForAllVarBndrs</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1536"></a><span>
</span><a name="line-1537"></a><span class="hs-identifier">invisibleTyBndrCount</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1538"></a><span class="hs-comment">-- Returns the number of leading invisible forall'd binders in the type</span><span>
</span><a name="line-1539"></a><span class="hs-comment">-- Includes invisible predicate arguments; e.g. for</span><span>
</span><a name="line-1540"></a><span class="hs-comment">--    e.g.  forall {k}. (k ~ *) =&gt; k -&gt; k</span><span>
</span><a name="line-1541"></a><span class="hs-comment">-- returns 2 not 1</span><span>
</span><a name="line-1542"></a><a name="invisibleTyBndrCount"><a href="Type.html#invisibleTyBndrCount"><span class="hs-identifier">invisibleTyBndrCount</span></a></a><span> </span><a name="local-6989586621681925383"><a href="#local-6989586621681925383"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><a href="Type.html#splitPiTysInvisible"><span class="hs-identifier hs-var">splitPiTysInvisible</span></a><span> </span><a href="#local-6989586621681925383"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1543"></a><span>
</span><a name="line-1544"></a><span class="hs-comment">-- Like splitPiTys, but returns only *invisible* binders, including constraints</span><span>
</span><a name="line-1545"></a><span class="hs-comment">-- Stops at the first visible binder</span><span>
</span><a name="line-1546"></a><span class="hs-identifier">splitPiTysInvisible</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1547"></a><a name="splitPiTysInvisible"><a href="Type.html#splitPiTysInvisible"><span class="hs-identifier">splitPiTysInvisible</span></a></a><span> </span><a name="local-6989586621681925384"><a href="#local-6989586621681925384"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925385"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925384"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925384"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1548"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-1549"></a><span>    </span><a name="local-6989586621681925385"><a href="#local-6989586621681925385"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621681925386"><a href="#local-6989586621681925386"><span class="hs-identifier">orig_ty</span></a></a><span> </span><a name="local-6989586621681925387"><a href="#local-6989586621681925387"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925388"><a href="#local-6989586621681925388"><span class="hs-identifier">bs</span></a></a><span>
</span><a name="line-1550"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925389"><a href="#local-6989586621681925389"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925387"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925385"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925386"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-6989586621681925389"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925388"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-1551"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-6989586621681925390"><a href="#local-6989586621681925390"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621681925391"><a href="#local-6989586621681925391"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925392"><a href="#local-6989586621681925392"><span class="hs-identifier">bs</span></a></a><span>
</span><a name="line-1552"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925393"><a href="#local-6989586621681925393"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925390"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1553"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Var.html#isInvisibleArgFlag"><span class="hs-identifier hs-var">isInvisibleArgFlag</span></a><span> </span><a href="#local-6989586621681925393"><span class="hs-identifier hs-var">vis</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925385"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925391"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925391"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a href="#local-6989586621681925390"><span class="hs-identifier hs-var">b</span></a><span>  </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925392"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1554"></a><span>    </span><span class="hs-identifier">split</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925394"><a href="#local-6989586621681925394"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925395"><a href="#local-6989586621681925395"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>  </span><a name="local-6989586621681925396"><a href="#local-6989586621681925396"><span class="hs-identifier">bs</span></a></a><span>
</span><a name="line-1555"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621681925394"><span class="hs-identifier hs-var">arg</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925385"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925395"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925395"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a href="#local-6989586621681925394"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925396"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1556"></a><span>    </span><span class="hs-identifier">split</span><span> </span><a name="local-6989586621681925397"><a href="#local-6989586621681925397"><span class="hs-identifier">orig_ty</span></a></a><span> </span><span class="hs-identifier">_</span><span>          </span><a name="local-6989586621681925398"><a href="#local-6989586621681925398"><span class="hs-identifier">bs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681925398"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925397"><span class="hs-identifier hs-var">orig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1557"></a><span>
</span><a name="line-1558"></a><span class="hs-identifier">splitPiTysInvisibleN</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1559"></a><span class="hs-comment">-- Same as splitPiTysInvisible, but stop when</span><span>
</span><a name="line-1560"></a><span class="hs-comment">--   - you have found 'n' TyCoBinders,</span><span>
</span><a name="line-1561"></a><span class="hs-comment">--   - or you run out of invisible binders</span><span>
</span><a name="line-1562"></a><a name="splitPiTysInvisibleN"><a href="Type.html#splitPiTysInvisibleN"><span class="hs-identifier">splitPiTysInvisibleN</span></a></a><span> </span><a name="local-6989586621681925399"><a href="#local-6989586621681925399"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681925400"><a href="#local-6989586621681925400"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925401"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925399"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621681925400"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681925400"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1563"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-1564"></a><span>    </span><a name="local-6989586621681925401"><a href="#local-6989586621681925401"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621681925402"><a href="#local-6989586621681925402"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681925403"><a href="#local-6989586621681925403"><span class="hs-identifier">orig_ty</span></a></a><span> </span><a name="local-6989586621681925404"><a href="#local-6989586621681925404"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925405"><a href="#local-6989586621681925405"><span class="hs-identifier">bs</span></a></a><span>
</span><a name="line-1565"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925402"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681925405"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925403"><span class="hs-identifier hs-var">orig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1566"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925406"><a href="#local-6989586621681925406"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925404"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925401"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621681925402"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621681925403"><span class="hs-identifier hs-var">orig_ty</span></a><span> </span><a href="#local-6989586621681925406"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925405"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-1567"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><a name="local-6989586621681925407"><a href="#local-6989586621681925407"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621681925408"><a href="#local-6989586621681925408"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925404"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1568"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925409"><a href="#local-6989586621681925409"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925407"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1569"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Var.html#isInvisibleArgFlag"><span class="hs-identifier hs-var">isInvisibleArgFlag</span></a><span> </span><a href="#local-6989586621681925409"><span class="hs-identifier hs-var">vis</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925401"><span class="hs-identifier hs-var">split</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925402"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925408"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925408"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a href="#local-6989586621681925407"><span class="hs-identifier hs-var">b</span></a><span>  </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925405"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1570"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925410"><a href="#local-6989586621681925410"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925411"><a href="#local-6989586621681925411"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925404"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1571"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621681925410"><span class="hs-identifier hs-var">arg</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925401"><span class="hs-identifier hs-var">split</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925402"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925411"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621681925411"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a href="#local-6989586621681925410"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925405"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1572"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681925405"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925403"><span class="hs-identifier hs-var">orig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1573"></a><span>
</span><a name="line-1574"></a><span class="hs-comment">-- | Given a 'TyCon' and a list of argument types, filter out any invisible</span><span>
</span><a name="line-1575"></a><span class="hs-comment">-- (i.e., 'Inferred' or 'Specified') arguments.</span><span>
</span><a name="line-1576"></a><span class="hs-identifier">filterOutInvisibleTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1577"></a><a name="filterOutInvisibleTypes"><a href="Type.html#filterOutInvisibleTypes"><span class="hs-identifier">filterOutInvisibleTypes</span></a></a><span> </span><a name="local-6989586621681925412"><a href="#local-6989586621681925412"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925413"><a href="#local-6989586621681925413"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Type.html#partitionInvisibleTypes"><span class="hs-identifier hs-var">partitionInvisibleTypes</span></a><span> </span><a href="#local-6989586621681925412"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681925413"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1578"></a><span>
</span><a name="line-1579"></a><span class="hs-comment">-- | Given a 'TyCon' and a list of argument types, filter out any 'Inferred'</span><span>
</span><a name="line-1580"></a><span class="hs-comment">-- arguments.</span><span>
</span><a name="line-1581"></a><span class="hs-identifier">filterOutInferredTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1582"></a><a name="filterOutInferredTypes"><a href="Type.html#filterOutInferredTypes"><span class="hs-identifier">filterOutInferredTypes</span></a></a><span> </span><a name="local-6989586621681925414"><a href="#local-6989586621681925414"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925415"><a href="#local-6989586621681925415"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1583"></a><span>  </span><a href="Util.html#filterByList"><span class="hs-identifier hs-var">filterByList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span> </span><a href="Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Type.html#tyConArgFlags"><span class="hs-identifier hs-var">tyConArgFlags</span></a><span> </span><a href="#local-6989586621681925414"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681925415"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925415"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1584"></a><span>
</span><a name="line-1585"></a><span class="hs-comment">-- | Given a 'TyCon' and a list of argument types, partition the arguments</span><span>
</span><a name="line-1586"></a><span class="hs-comment">-- into:</span><span>
</span><a name="line-1587"></a><span class="hs-comment">--</span><span>
</span><a name="line-1588"></a><span class="hs-comment">-- 1. 'Inferred' or 'Specified' (i.e., invisible) arguments and</span><span>
</span><a name="line-1589"></a><span class="hs-comment">--</span><span>
</span><a name="line-1590"></a><span class="hs-comment">-- 2. 'Required' (i.e., visible) arguments</span><span>
</span><a name="line-1591"></a><span class="hs-identifier">partitionInvisibleTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1592"></a><a name="partitionInvisibleTypes"><a href="Type.html#partitionInvisibleTypes"><span class="hs-identifier">partitionInvisibleTypes</span></a></a><span> </span><a name="local-6989586621681925416"><a href="#local-6989586621681925416"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925417"><a href="#local-6989586621681925417"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1593"></a><span>  </span><a href="Util.html#partitionByList"><span class="hs-identifier hs-var">partitionByList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Var.html#isInvisibleArgFlag"><span class="hs-identifier hs-var">isInvisibleArgFlag</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Type.html#tyConArgFlags"><span class="hs-identifier hs-var">tyConArgFlags</span></a><span> </span><a href="#local-6989586621681925416"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681925417"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925417"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1594"></a><span>
</span><a name="line-1595"></a><span class="hs-comment">-- | Given a list of things paired with their visibilities, partition the</span><span>
</span><a name="line-1596"></a><span class="hs-comment">-- things into (invisible things, visible things).</span><span>
</span><a name="line-1597"></a><span class="hs-identifier">partitionInvisibles</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621681924770"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621681924770"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681924770"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1598"></a><a name="partitionInvisibles"><a href="Type.html#partitionInvisibles"><span class="hs-identifier">partitionInvisibles</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a><span> </span><a href="#local-6989586621681925418"><span class="hs-identifier hs-var">pick_invis</span></a><span>
</span><a name="line-1599"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1600"></a><span>    </span><span class="hs-identifier">pick_invis</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925419"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621681925419"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621681925419"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1601"></a><span>    </span><a name="local-6989586621681925418"><a href="#local-6989586621681925418"><span class="hs-identifier">pick_invis</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681925420"><a href="#local-6989586621681925420"><span class="hs-identifier">thing</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925421"><a href="#local-6989586621681925421"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isInvisibleArgFlag"><span class="hs-identifier hs-var">isInvisibleArgFlag</span></a><span> </span><a href="#local-6989586621681925421"><span class="hs-identifier hs-var">vis</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621681925420"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1602"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621681925420"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1603"></a><span>
</span><a name="line-1604"></a><span class="hs-comment">-- | Given a 'TyCon' and a list of argument types to which the 'TyCon' is</span><span>
</span><a name="line-1605"></a><span class="hs-comment">-- applied, determine each argument's visibility</span><span>
</span><a name="line-1606"></a><span class="hs-comment">-- ('Inferred', 'Specified', or 'Required').</span><span>
</span><a name="line-1607"></a><span class="hs-comment">--</span><span>
</span><a name="line-1608"></a><span class="hs-comment">-- Wrinkle: consider the following scenario:</span><span>
</span><a name="line-1609"></a><span class="hs-comment">--</span><span>
</span><a name="line-1610"></a><span class="hs-comment">-- &gt; T :: forall k. k -&gt; k</span><span>
</span><a name="line-1611"></a><span class="hs-comment">-- &gt; tyConArgFlags T [forall m. m -&gt; m -&gt; m, S, R, Q]</span><span>
</span><a name="line-1612"></a><span class="hs-comment">--</span><span>
</span><a name="line-1613"></a><span class="hs-comment">-- After substituting, we get</span><span>
</span><a name="line-1614"></a><span class="hs-comment">--</span><span>
</span><a name="line-1615"></a><span class="hs-comment">-- &gt; T (forall m. m -&gt; m -&gt; m) :: (forall m. m -&gt; m -&gt; m) -&gt; forall n. n -&gt; n -&gt; n</span><span>
</span><a name="line-1616"></a><span class="hs-comment">--</span><span>
</span><a name="line-1617"></a><span class="hs-comment">-- Thus, the first argument is invisible, @S@ is visible, @R@ is invisible again,</span><span>
</span><a name="line-1618"></a><span class="hs-comment">-- and @Q@ is visible.</span><span>
</span><a name="line-1619"></a><span class="hs-identifier">tyConArgFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a><span class="hs-special">]</span><span>
</span><a name="line-1620"></a><a name="tyConArgFlags"><a href="Type.html#tyConArgFlags"><span class="hs-identifier">tyConArgFlags</span></a></a><span> </span><a name="local-6989586621681925422"><a href="#local-6989586621681925422"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#fun_kind_arg_flags"><span class="hs-identifier hs-var">fun_kind_arg_flags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621681925422"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1621"></a><span>
</span><a name="line-1622"></a><span class="hs-comment">-- | Given a 'Type' and a list of argument types to which the 'Type' is</span><span>
</span><a name="line-1623"></a><span class="hs-comment">-- applied, determine each argument's visibility</span><span>
</span><a name="line-1624"></a><span class="hs-comment">-- ('Inferred', 'Specified', or 'Required').</span><span>
</span><a name="line-1625"></a><span class="hs-comment">--</span><span>
</span><a name="line-1626"></a><span class="hs-comment">-- Most of the time, the arguments will be 'Required', but not always. Consider</span><span>
</span><a name="line-1627"></a><span class="hs-comment">-- @f :: forall a. a -&gt; Type@. In @f Type Bool@, the first argument (@Type@) is</span><span>
</span><a name="line-1628"></a><span class="hs-comment">-- 'Specified' and the second argument (@Bool@) is 'Required'. It is precisely</span><span>
</span><a name="line-1629"></a><span class="hs-comment">-- this sort of higher-rank situation in which 'appTyArgFlags' comes in handy,</span><span>
</span><a name="line-1630"></a><span class="hs-comment">-- since @f Type Bool@ would be represented in Core using 'AppTy's.</span><span>
</span><a name="line-1631"></a><span class="hs-comment">-- (See also Trac #15792).</span><span>
</span><a name="line-1632"></a><span class="hs-identifier">appTyArgFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a><span class="hs-special">]</span><span>
</span><a name="line-1633"></a><a name="appTyArgFlags"><a href="Type.html#appTyArgFlags"><span class="hs-identifier">appTyArgFlags</span></a></a><span> </span><a name="local-6989586621681925423"><a href="#local-6989586621681925423"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#fun_kind_arg_flags"><span class="hs-identifier hs-var">fun_kind_arg_flags</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925423"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-1634"></a><span>
</span><a name="line-1635"></a><span class="hs-comment">-- | Given a function kind and a list of argument types (where each argument's</span><span>
</span><a name="line-1636"></a><span class="hs-comment">-- kind aligns with the corresponding position in the argument kind), determine</span><span>
</span><a name="line-1637"></a><span class="hs-comment">-- each argument's visibility ('Inferred', 'Specified', or 'Required').</span><span>
</span><a name="line-1638"></a><span class="hs-identifier">fun_kind_arg_flags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#ArgFlag"><span class="hs-identifier hs-type">ArgFlag</span></a><span class="hs-special">]</span><span>
</span><a name="line-1639"></a><a name="fun_kind_arg_flags"><a href="Type.html#fun_kind_arg_flags"><span class="hs-identifier">fun_kind_arg_flags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925424"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="TyCoRep.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a><span>
</span><a name="line-1640"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1641"></a><span>    </span><a name="local-6989586621681925424"><a href="#local-6989586621681925424"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925425"><a href="#local-6989586621681925425"><span class="hs-identifier">subst</span></a></a><span> </span><a name="local-6989586621681925426"><a href="#local-6989586621681925426"><span class="hs-identifier">ki</span></a></a><span> </span><a name="local-6989586621681925427"><a href="#local-6989586621681925427"><span class="hs-identifier">arg_tys</span></a></a><span>
</span><a name="line-1642"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925428"><a href="#local-6989586621681925428"><span class="hs-identifier">ki'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925426"><span class="hs-identifier hs-var">ki</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925424"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925425"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681925428"><span class="hs-identifier hs-var">ki'</span></a><span> </span><a href="#local-6989586621681925427"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1643"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1644"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925429"><a href="#local-6989586621681925429"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925430"><a href="#local-6989586621681925430"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681925431"><a href="#local-6989586621681925431"><span class="hs-identifier">argf</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925432"><a href="#local-6989586621681925432"><span class="hs-identifier">res_ki</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925433"><a href="#local-6989586621681925433"><span class="hs-identifier">arg_ty</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925434"><a href="#local-6989586621681925434"><span class="hs-identifier">arg_tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1645"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925431"><span class="hs-identifier hs-var">argf</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925424"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925435"><span class="hs-identifier hs-var">subst'</span></a><span> </span><a href="#local-6989586621681925432"><span class="hs-identifier hs-var">res_ki</span></a><span> </span><a href="#local-6989586621681925434"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1646"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1647"></a><span>        </span><a name="local-6989586621681925435"><a href="#local-6989586621681925435"><span class="hs-identifier">subst'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a><span> </span><a href="#local-6989586621681925429"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681925430"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681925433"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-1648"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925436"><a href="#local-6989586621681925436"><span class="hs-identifier">subst</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681925437"><a href="#local-6989586621681925437"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925438"><a href="#local-6989586621681925438"><span class="hs-identifier">arg_tys</span></a></a><span>
</span><a name="line-1649"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925439"><a href="#local-6989586621681925439"><span class="hs-identifier">ki</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCoRep.html#lookupTyVar"><span class="hs-identifier hs-var">lookupTyVar</span></a><span> </span><a href="#local-6989586621681925436"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681925437"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925424"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925436"><span class="hs-identifier hs-var">subst</span></a><span> </span><a href="#local-6989586621681925439"><span class="hs-identifier hs-var">ki</span></a><span> </span><a href="#local-6989586621681925438"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1650"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925440"><a href="#local-6989586621681925440"><span class="hs-identifier">arg_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="Var.html#Required"><span class="hs-identifier hs-var">Required</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925440"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-1651"></a><span>                        </span><span class="hs-comment">-- something is ill-kinded. But this can happen</span><span>
</span><a name="line-1652"></a><span>                        </span><span class="hs-comment">-- when printing errors. Assume everything is Required.</span><span>
</span><a name="line-1653"></a><span>
</span><a name="line-1654"></a><span class="hs-comment">-- @isTauTy@ tests if a type has no foralls</span><span>
</span><a name="line-1655"></a><span class="hs-identifier">isTauTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1656"></a><a name="isTauTy"><a href="Type.html#isTauTy"><span class="hs-identifier">isTauTy</span></a></a><span> </span><a name="local-6989586621681925441"><a href="#local-6989586621681925441"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925442"><a href="#local-6989586621681925442"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925441"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span> </span><a href="#local-6989586621681925442"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1657"></a><span class="hs-identifier">isTauTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1658"></a><span class="hs-identifier">isTauTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1659"></a><span class="hs-identifier">isTauTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925443"><a href="#local-6989586621681925443"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925444"><a href="#local-6989586621681925444"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span> </span><a href="#local-6989586621681925444"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TyCon.html#isTauTyCon"><span class="hs-identifier hs-var">isTauTyCon</span></a><span> </span><a href="#local-6989586621681925443"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1660"></a><span class="hs-identifier">isTauTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925445"><a href="#local-6989586621681925445"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621681925446"><a href="#local-6989586621681925446"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span> </span><a href="#local-6989586621681925445"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span> </span><a href="#local-6989586621681925446"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1661"></a><span class="hs-identifier">isTauTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925447"><a href="#local-6989586621681925447"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621681925448"><a href="#local-6989586621681925448"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span> </span><a href="#local-6989586621681925447"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span> </span><a href="#local-6989586621681925448"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1662"></a><span class="hs-identifier">isTauTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1663"></a><span class="hs-identifier">isTauTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925449"><a href="#local-6989586621681925449"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a><span> </span><a href="#local-6989586621681925449"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1664"></a><span class="hs-identifier">isTauTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- Not sure about this</span><span>
</span><a name="line-1665"></a><span>
</span><a name="line-1666"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
   TyCoBinders
%*                                                                      *
%************************************************************************
-}</span><span>
</span><a name="line-1673"></a><span>
</span><a name="line-1674"></a><span class="hs-comment">-- | Make an anonymous binder</span><span>
</span><a name="line-1675"></a><span class="hs-identifier">mkAnonBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span>
</span><a name="line-1676"></a><a name="mkAnonBinder"><a href="Type.html#mkAnonBinder"><span class="hs-identifier">mkAnonBinder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span>
</span><a name="line-1677"></a><span>
</span><a name="line-1678"></a><span class="hs-comment">-- | Does this binder bind a variable that is /not/ erased? Returns</span><span>
</span><a name="line-1679"></a><span class="hs-comment">-- 'True' for anonymous binders.</span><span>
</span><a name="line-1680"></a><span class="hs-identifier">isAnonTyCoBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1681"></a><a name="isAnonTyCoBinder"><a href="Type.html#isAnonTyCoBinder"><span class="hs-identifier">isAnonTyCoBinder</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1682"></a><span class="hs-identifier">isAnonTyCoBinder</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1683"></a><span>
</span><a name="line-1684"></a><span class="hs-identifier">tyCoBinderVar_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span>
</span><a name="line-1685"></a><a name="tyCoBinderVar_maybe"><a href="Type.html#tyCoBinderVar_maybe"><span class="hs-identifier">tyCoBinderVar_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-6989586621681925450"><a href="#local-6989586621681925450"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a><span> </span><a href="#local-6989586621681925450"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1686"></a><span class="hs-identifier">tyCoBinderVar_maybe</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1687"></a><span>
</span><a name="line-1688"></a><span class="hs-identifier">tyCoBinderType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1689"></a><span class="hs-comment">-- Barely used</span><span>
</span><a name="line-1690"></a><a name="tyCoBinderType"><a href="Type.html#tyCoBinderType"><span class="hs-identifier">tyCoBinderType</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-6989586621681925451"><a href="#local-6989586621681925451"><span class="hs-identifier">tvb</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#binderType"><span class="hs-identifier hs-var">binderType</span></a><span> </span><a href="#local-6989586621681925451"><span class="hs-identifier hs-var">tvb</span></a><span>
</span><a name="line-1691"></a><span class="hs-identifier">tyCoBinderType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-6989586621681925452"><a href="#local-6989586621681925452"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925452"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1692"></a><span>
</span><a name="line-1693"></a><span class="hs-identifier">tyBinderType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyBinder"><span class="hs-identifier hs-type">TyBinder</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1694"></a><a name="tyBinderType"><a href="Type.html#tyBinderType"><span class="hs-identifier">tyBinderType</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925453"><a href="#local-6989586621681925453"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1695"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier hs-var">tv</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1696"></a><span>    </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621681925453"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1697"></a><span class="hs-identifier">tyBinderType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-6989586621681925454"><a href="#local-6989586621681925454"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925454"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1698"></a><span>
</span><a name="line-1699"></a><span class="hs-comment">-- | Extract a relevant type, if there is one.</span><span>
</span><a name="line-1700"></a><span class="hs-identifier">binderRelevantType_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1701"></a><a name="binderRelevantType_maybe"><a href="Type.html#binderRelevantType_maybe"><span class="hs-identifier">binderRelevantType_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1702"></a><span class="hs-identifier">binderRelevantType_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-6989586621681925455"><a href="#local-6989586621681925455"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925455"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1703"></a><span>
</span><a name="line-1704"></a><span class="hs-comment">-- | Like 'maybe', but for binders.</span><span>
</span><a name="line-1705"></a><span class="hs-identifier">caseBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a><span>           </span><span class="hs-comment">-- ^ binder to scrutinize</span><span>
</span><a name="line-1706"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Var.html#TyCoVarBinder"><span class="hs-identifier hs-type">TyCoVarBinder</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924769"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ named case</span><span>
</span><a name="line-1707"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924769"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- ^ anonymous case</span><span>
</span><a name="line-1708"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681924769"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1709"></a><a name="caseBinder"><a href="Type.html#caseBinder"><span class="hs-identifier">caseBinder</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Named"><span class="hs-identifier hs-var">Named</span></a><span> </span><a name="local-6989586621681925456"><a href="#local-6989586621681925456"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925457"><a href="#local-6989586621681925457"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925457"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621681925456"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1710"></a><span class="hs-identifier">caseBinder</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Anon"><span class="hs-identifier hs-var">Anon</span></a><span> </span><a name="local-6989586621681925458"><a href="#local-6989586621681925458"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925459"><a href="#local-6989586621681925459"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925459"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="#local-6989586621681925458"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-1711"></a><span>
</span><a name="line-1712"></a><span>
</span><a name="line-1713"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
                         Pred
*                                                                      *
************************************************************************

Predicates on PredType

Note [Types for coercions, predicates, and evidence]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We treat differently:

  (a) Predicate types
        Test: isPredTy
        Binders: DictIds
        Kind: Constraint
        Examples: (Eq a), and (a ~ b)

  (b) Coercion types are primitive, unboxed equalities
        Test: isCoVarTy
        Binders: CoVars (can appear in coercions)
        Kind: TYPE (TupleRep [])
        Examples: (t1 ~# t2) or (t1 ~R# t2)

  (c) Evidence types is the type of evidence manipulated by
      the type constraint solver.
        Test: isEvVarType
        Binders: EvVars
        Kind: Constraint or TYPE (TupleRep [])
        Examples: all coercion types and predicate types

Coercion types and predicate types are mutually exclusive,
but evidence types are a superset of both.

When treated as a user type, predicates are invisible and are
implicitly instantiated; but coercion types, and non-pred evidence
types, are just regular old types.

Note [Evidence for quantified constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The superclass mechanism in TcCanonical.makeSuperClasses risks
taking a quantified constraint like
   (forall a. C a =&gt; a ~ b)
and generate superclass evidence
   (forall a. C a =&gt; a ~# b)

This is a funny thing: neither isPredTy nor isCoVarType are true
of it.  So we are careful not to generate it in the first place:
see Note [Equality superclasses in quantified constraints]
in TcCanonical.
-}</span><span>
</span><a name="line-1765"></a><span>
</span><a name="line-1766"></a><span class="hs-comment">-- | Split a type constructor application into its type constructor and</span><span>
</span><a name="line-1767"></a><span class="hs-comment">-- applied types. Note that this may fail in the case of a 'FunTy' with an</span><span>
</span><a name="line-1768"></a><span class="hs-comment">-- argument of unknown kind 'FunTy' (e.g. @FunTy (a :: k) Int@. since the kind</span><span>
</span><a name="line-1769"></a><span class="hs-comment">-- of @a@ isn't of the form @TYPE rep@). Consequently, you may need to zonk your</span><span>
</span><a name="line-1770"></a><span class="hs-comment">-- type before using this function.</span><span>
</span><a name="line-1771"></a><span class="hs-comment">--</span><span>
</span><a name="line-1772"></a><span class="hs-comment">-- If you only need the 'TyCon', consider using 'tcTyConAppTyCon_maybe'.</span><span>
</span><a name="line-1773"></a><span class="hs-identifier">tcSplitTyConApp_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1774"></a><span class="hs-comment">-- Defined here to avoid module loops between Unify and TcType.</span><span>
</span><a name="line-1775"></a><a name="tcSplitTyConApp_maybe"><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier">tcSplitTyConApp_maybe</span></a></a><span> </span><a name="local-6989586621681925460"><a href="#local-6989586621681925460"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925461"><a href="#local-6989586621681925461"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621681925460"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925461"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1776"></a><span class="hs-identifier">tcSplitTyConApp_maybe</span><span> </span><a name="local-6989586621681925462"><a href="#local-6989586621681925462"><span class="hs-identifier">ty</span></a></a><span>                         </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tcRepSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcRepSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925462"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1777"></a><span>
</span><a name="line-1778"></a><span class="hs-comment">-- tcIsConstraintKind stuf only makes sense in the typechecker</span><span>
</span><a name="line-1779"></a><span class="hs-comment">-- After that Constraint = Type</span><span>
</span><a name="line-1780"></a><span class="hs-comment">-- See Note [coreView vs tcView]</span><span>
</span><a name="line-1781"></a><span class="hs-comment">-- Defined here because it is used in isPredTy and tcRepSplitAppTy_maybe (sigh)</span><span>
</span><a name="line-1782"></a><span class="hs-identifier">tcIsConstraintKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1783"></a><a name="tcIsConstraintKind"><a href="Type.html#tcIsConstraintKind"><span class="hs-identifier">tcIsConstraintKind</span></a></a><span> </span><a name="local-6989586621681925463"><a href="#local-6989586621681925463"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1784"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925464"><a href="#local-6989586621681925464"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925465"><a href="#local-6989586621681925465"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925463"><span class="hs-identifier hs-var">ty</span></a><span>    </span><span class="hs-comment">-- Note: tcSplit here</span><span>
</span><a name="line-1785"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Kind.html#isConstraintKindCon"><span class="hs-identifier hs-var">isConstraintKindCon</span></a><span> </span><a href="#local-6989586621681925464"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1786"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">args</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier hs-var">ty</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-1787"></a><span>
</span><a name="line-1788"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1789"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1790"></a><span>
</span><a name="line-1791"></a><span class="hs-comment">-- | Is this kind equivalent to @*@?</span><span>
</span><a name="line-1792"></a><span class="hs-comment">--</span><span>
</span><a name="line-1793"></a><span class="hs-comment">-- This considers 'Constraint' to be distinct from @*@. For a version that</span><span>
</span><a name="line-1794"></a><span class="hs-comment">-- treats them as the same type, see 'isLiftedTypeKind'.</span><span>
</span><a name="line-1795"></a><span class="hs-identifier">tcIsLiftedTypeKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1796"></a><a name="tcIsLiftedTypeKind"><a href="Type.html#tcIsLiftedTypeKind"><span class="hs-identifier">tcIsLiftedTypeKind</span></a></a><span> </span><a name="local-6989586621681925466"><a href="#local-6989586621681925466"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1797"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925467"><a href="#local-6989586621681925467"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621681925468"><a href="#local-6989586621681925468"><span class="hs-identifier">arg</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925466"><span class="hs-identifier hs-var">ty</span></a><span>    </span><span class="hs-comment">-- Note: tcSplit here</span><span>
</span><a name="line-1798"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925467"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#tYPETyConKey"><span class="hs-identifier hs-var">tYPETyConKey</span></a><span>
</span><a name="line-1799"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#isLiftedRuntimeRep"><span class="hs-identifier hs-var">isLiftedRuntimeRep</span></a><span> </span><a href="#local-6989586621681925468"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1800"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1801"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1802"></a><span>
</span><a name="line-1803"></a><span class="hs-identifier">tcReturnsConstraintKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1804"></a><span class="hs-comment">-- True &lt;=&gt; the Kind ultimately returns a Constraint</span><span>
</span><a name="line-1805"></a><span class="hs-comment">--   E.g.  * -&gt; Constraint</span><span>
</span><a name="line-1806"></a><span class="hs-comment">--         forall k. k -&gt; Constraint</span><span>
</span><a name="line-1807"></a><a name="tcReturnsConstraintKind"><a href="Type.html#tcReturnsConstraintKind"><span class="hs-identifier">tcReturnsConstraintKind</span></a></a><span> </span><a name="local-6989586621681925469"><a href="#local-6989586621681925469"><span class="hs-identifier">kind</span></a></a><span>
</span><a name="line-1808"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925470"><a href="#local-6989586621681925470"><span class="hs-identifier">kind'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621681925469"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tcReturnsConstraintKind"><span class="hs-identifier hs-var">tcReturnsConstraintKind</span></a><span> </span><a href="#local-6989586621681925470"><span class="hs-identifier hs-var">kind'</span></a><span>
</span><a name="line-1809"></a><span class="hs-identifier">tcReturnsConstraintKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925471"><a href="#local-6989586621681925471"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tcReturnsConstraintKind"><span class="hs-identifier hs-var">tcReturnsConstraintKind</span></a><span> </span><a href="#local-6989586621681925471"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1810"></a><span class="hs-identifier">tcReturnsConstraintKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span>    </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925472"><a href="#local-6989586621681925472"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tcReturnsConstraintKind"><span class="hs-identifier hs-var">tcReturnsConstraintKind</span></a><span> </span><a href="#local-6989586621681925472"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1811"></a><span class="hs-identifier">tcReturnsConstraintKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925473"><a href="#local-6989586621681925473"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Kind.html#isConstraintKindCon"><span class="hs-identifier hs-var">isConstraintKindCon</span></a><span> </span><a href="#local-6989586621681925473"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1812"></a><span class="hs-identifier">tcReturnsConstraintKind</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1813"></a><span>
</span><a name="line-1814"></a><span class="hs-identifier">isEvVarType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1815"></a><span class="hs-comment">-- True of (a) predicates, of kind Constraint, such as (Eq a), and (a ~ b)</span><span>
</span><a name="line-1816"></a><span class="hs-comment">--         (b) coercion types, such as (t1 ~# t2) or (t1 ~R# t2)</span><span>
</span><a name="line-1817"></a><span class="hs-comment">-- See Note [Types for coercions, predicates, and evidence]</span><span>
</span><a name="line-1818"></a><span class="hs-comment">-- See Note [Evidence for quantified constraints]</span><span>
</span><a name="line-1819"></a><a name="isEvVarType"><a href="Type.html#isEvVarType"><span class="hs-identifier">isEvVarType</span></a></a><span> </span><a name="local-6989586621681925474"><a href="#local-6989586621681925474"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isCoVarType"><span class="hs-identifier hs-var">isCoVarType</span></a><span> </span><a href="#local-6989586621681925474"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621681925474"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1820"></a><span>
</span><a name="line-1821"></a><span class="hs-comment">-- | Does this type classify a core (unlifted) Coercion?</span><span>
</span><a name="line-1822"></a><span class="hs-comment">-- At either role nominal or representational</span><span>
</span><a name="line-1823"></a><span class="hs-comment">--    (t1 ~# t2) or (t1 ~R# t2)</span><span>
</span><a name="line-1824"></a><span class="hs-comment">-- See Note [Types for coercions, predicates, and evidence]</span><span>
</span><a name="line-1825"></a><span class="hs-identifier">isCoVarType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1826"></a><a name="isCoVarType"><a href="Type.html#isCoVarType"><span class="hs-identifier">isCoVarType</span></a></a><span> </span><a name="local-6989586621681925475"><a href="#local-6989586621681925475"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1827"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925476"><a href="#local-6989586621681925476"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><a name="local-6989586621681925477"><a href="#local-6989586621681925477"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925475"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1828"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925476"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925476"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a><span class="hs-special">)</span><span>
</span><a name="line-1829"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925477"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#lengthIs"><span class="hs-identifier hs-var">lengthIs</span></a><span class="hs-special">`</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-1830"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1831"></a><span class="hs-identifier">isCoVarType</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1832"></a><span>
</span><a name="line-1833"></a><span class="hs-identifier">isClassPred</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isEqPred</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isNomEqPred</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isIPPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1834"></a><a name="isClassPred"><a href="Type.html#isClassPred"><span class="hs-identifier">isClassPred</span></a></a><span> </span><a name="local-6989586621681925478"><a href="#local-6989586621681925478"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621681925478"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1835"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925479"><a href="#local-6989586621681925479"><span class="hs-identifier">tyCon</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isClassTyCon"><span class="hs-identifier hs-var">isClassTyCon</span></a><span> </span><a href="#local-6989586621681925479"><span class="hs-identifier hs-var">tyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1836"></a><span>    </span><span class="hs-identifier">_</span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1837"></a><a name="isEqPred"><a href="Type.html#isEqPred"><span class="hs-identifier">isEqPred</span></a></a><span> </span><a name="local-6989586621681925480"><a href="#local-6989586621681925480"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621681925480"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1838"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925481"><a href="#local-6989586621681925481"><span class="hs-identifier">tyCon</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925481"><span class="hs-identifier hs-var">tyCon</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a><span>
</span><a name="line-1839"></a><span>               </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621681925481"><span class="hs-identifier hs-var">tyCon</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a><span>
</span><a name="line-1840"></a><span>    </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1841"></a><span>
</span><a name="line-1842"></a><a name="isNomEqPred"><a href="Type.html#isNomEqPred"><span class="hs-identifier">isNomEqPred</span></a></a><span> </span><a name="local-6989586621681925482"><a href="#local-6989586621681925482"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621681925482"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1843"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925483"><a href="#local-6989586621681925483"><span class="hs-identifier">tyCon</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925483"><span class="hs-identifier hs-var">tyCon</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a><span>
</span><a name="line-1844"></a><span>    </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1845"></a><span>
</span><a name="line-1846"></a><a name="isIPPred"><a href="Type.html#isIPPred"><span class="hs-identifier">isIPPred</span></a></a><span> </span><a name="local-6989586621681925484"><a href="#local-6989586621681925484"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621681925484"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1847"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925485"><a href="#local-6989586621681925485"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#isIPTyCon"><span class="hs-identifier hs-var">isIPTyCon</span></a><span> </span><a href="#local-6989586621681925485"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1848"></a><span>    </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1849"></a><span>
</span><a name="line-1850"></a><span class="hs-identifier">isIPTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1851"></a><a name="isIPTyCon"><a href="Type.html#isIPTyCon"><span class="hs-identifier">isIPTyCon</span></a></a><span> </span><a name="local-6989586621681925486"><a href="#local-6989586621681925486"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925486"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#ipClassKey"><span class="hs-identifier hs-var">ipClassKey</span></a><span>
</span><a name="line-1852"></a><span>  </span><span class="hs-comment">-- Class and its corresponding TyCon have the same Unique</span><span>
</span><a name="line-1853"></a><span>
</span><a name="line-1854"></a><span class="hs-identifier">isIPClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1855"></a><a name="isIPClass"><a href="Type.html#isIPClass"><span class="hs-identifier">isIPClass</span></a></a><span> </span><a name="local-6989586621681925487"><a href="#local-6989586621681925487"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925487"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#ipClassKey"><span class="hs-identifier hs-var">ipClassKey</span></a><span>
</span><a name="line-1856"></a><span>
</span><a name="line-1857"></a><span class="hs-identifier">isCTupleClass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1858"></a><a name="isCTupleClass"><a href="Type.html#isCTupleClass"><span class="hs-identifier">isCTupleClass</span></a></a><span> </span><a name="local-6989586621681925488"><a href="#local-6989586621681925488"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#isTupleTyCon"><span class="hs-identifier hs-var">isTupleTyCon</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-6989586621681925488"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span>
</span><a name="line-1859"></a><span>
</span><a name="line-1860"></a><span class="hs-identifier">isIPPred_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1861"></a><a name="isIPPred_maybe"><a href="Type.html#isIPPred_maybe"><span class="hs-identifier">isIPPred_maybe</span></a></a><span> </span><a name="local-6989586621681925489"><a href="#local-6989586621681925489"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1862"></a><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925490"><a href="#local-6989586621681925490"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span class="hs-special">[</span><a name="local-6989586621681925491"><a href="#local-6989586621681925491"><span class="hs-identifier">t1</span></a></a><span class="hs-special">,</span><a name="local-6989586621681925492"><a href="#local-6989586621681925492"><span class="hs-identifier">t2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925489"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1863"></a><span>     </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="Type.html#isIPTyCon"><span class="hs-identifier hs-var">isIPTyCon</span></a><span> </span><a href="#local-6989586621681925490"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1864"></a><span>     </span><a name="local-6989586621681925493"><a href="#local-6989586621681925493"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#isStrLitTy"><span class="hs-identifier hs-var">isStrLitTy</span></a><span> </span><a href="#local-6989586621681925491"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1865"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925493"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621681925492"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1866"></a><span>
</span><a name="line-1867"></a><span class="hs-comment">{-
Make PredTypes

--------------------- Equality types ---------------------------------
-}</span><span>
</span><a name="line-1872"></a><span>
</span><a name="line-1873"></a><span class="hs-comment">-- | Makes a lifted equality predicate at the given role</span><span>
</span><a name="line-1874"></a><span class="hs-identifier">mkPrimEqPredRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-1875"></a><a name="mkPrimEqPredRole"><a href="Type.html#mkPrimEqPredRole"><span class="hs-identifier">mkPrimEqPredRole</span></a></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a><span>
</span><a name="line-1876"></a><span class="hs-identifier">mkPrimEqPredRole</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkReprPrimEqPred"><span class="hs-identifier hs-var">mkReprPrimEqPred</span></a><span>
</span><a name="line-1877"></a><span class="hs-identifier">mkPrimEqPredRole</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;mkPrimEqPredRole phantom&quot;</span><span>
</span><a name="line-1878"></a><span>
</span><a name="line-1879"></a><span class="hs-comment">-- | Creates a primitive type equality predicate.</span><span>
</span><a name="line-1880"></a><span class="hs-comment">-- Invariant: the types are not Coercions</span><span>
</span><a name="line-1881"></a><span class="hs-identifier">mkPrimEqPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1882"></a><a name="mkPrimEqPred"><a href="Type.html#mkPrimEqPred"><span class="hs-identifier">mkPrimEqPred</span></a></a><span> </span><a name="local-6989586621681925494"><a href="#local-6989586621681925494"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925495"><a href="#local-6989586621681925495"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-1883"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="TysPrim.html#eqPrimTyCon"><span class="hs-identifier hs-var">eqPrimTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925496"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925497"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925494"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925495"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1884"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1885"></a><span>    </span><a name="local-6989586621681925496"><a href="#local-6989586621681925496"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925494"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1886"></a><span>    </span><a name="local-6989586621681925497"><a href="#local-6989586621681925497"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925495"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1887"></a><span>
</span><a name="line-1888"></a><span class="hs-comment">-- | Creates a primite type equality predicate with explicit kinds</span><span>
</span><a name="line-1889"></a><span class="hs-identifier">mkHeteroPrimEqPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1890"></a><a name="mkHeteroPrimEqPred"><a href="Type.html#mkHeteroPrimEqPred"><span class="hs-identifier">mkHeteroPrimEqPred</span></a></a><span> </span><a name="local-6989586621681925498"><a href="#local-6989586621681925498"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621681925499"><a href="#local-6989586621681925499"><span class="hs-identifier">k2</span></a></a><span> </span><a name="local-6989586621681925500"><a href="#local-6989586621681925500"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925501"><a href="#local-6989586621681925501"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="TysPrim.html#eqPrimTyCon"><span class="hs-identifier hs-var">eqPrimTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925498"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925499"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925500"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925501"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1891"></a><span>
</span><a name="line-1892"></a><span class="hs-comment">-- | Creates a primitive representational type equality predicate</span><span>
</span><a name="line-1893"></a><span class="hs-comment">-- with explicit kinds</span><span>
</span><a name="line-1894"></a><span class="hs-identifier">mkHeteroReprPrimEqPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1895"></a><a name="mkHeteroReprPrimEqPred"><a href="Type.html#mkHeteroReprPrimEqPred"><span class="hs-identifier">mkHeteroReprPrimEqPred</span></a></a><span> </span><a name="local-6989586621681925502"><a href="#local-6989586621681925502"><span class="hs-identifier">k1</span></a></a><span> </span><a name="local-6989586621681925503"><a href="#local-6989586621681925503"><span class="hs-identifier">k2</span></a></a><span> </span><a name="local-6989586621681925504"><a href="#local-6989586621681925504"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925505"><a href="#local-6989586621681925505"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-1896"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="TysPrim.html#eqReprPrimTyCon"><span class="hs-identifier hs-var">eqReprPrimTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925502"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925503"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925504"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925505"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1897"></a><span>
</span><a name="line-1898"></a><span class="hs-comment">-- | Try to split up a coercion type into the types that it coerces</span><span>
</span><a name="line-1899"></a><span class="hs-identifier">splitCoercionType_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-1900"></a><a name="splitCoercionType_maybe"><a href="Type.html#splitCoercionType_maybe"><span class="hs-identifier">splitCoercionType_maybe</span></a></a><span> </span><a name="local-6989586621681925506"><a href="#local-6989586621681925506"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1901"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925507"><a href="#local-6989586621681925507"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681925508"><a href="#local-6989586621681925508"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925509"><a href="#local-6989586621681925509"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925506"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1902"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621681925507"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621681925507"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a><span>
</span><a name="line-1903"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925508"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925509"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1904"></a><span>
</span><a name="line-1905"></a><span class="hs-identifier">mkReprPrimEqPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1906"></a><a name="mkReprPrimEqPred"><a href="Type.html#mkReprPrimEqPred"><span class="hs-identifier">mkReprPrimEqPred</span></a></a><span> </span><a name="local-6989586621681925510"><a href="#local-6989586621681925510"><span class="hs-identifier">ty1</span></a></a><span>  </span><a name="local-6989586621681925511"><a href="#local-6989586621681925511"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-1907"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a href="TysPrim.html#eqReprPrimTyCon"><span class="hs-identifier hs-var">eqReprPrimTyCon</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925512"><span class="hs-identifier hs-var">k1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925513"><span class="hs-identifier hs-var">k2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925510"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925511"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span>
</span><a name="line-1908"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1909"></a><span>    </span><a name="local-6989586621681925512"><a href="#local-6989586621681925512"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925510"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1910"></a><span>    </span><a name="local-6989586621681925513"><a href="#local-6989586621681925513"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925511"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1911"></a><span>
</span><a name="line-1912"></a><span class="hs-identifier">equalityTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-1913"></a><a name="equalityTyCon"><a href="Type.html#equalityTyCon"><span class="hs-identifier">equalityTyCon</span></a></a><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TysPrim.html#eqPrimTyCon"><span class="hs-identifier hs-var">eqPrimTyCon</span></a><span>
</span><a name="line-1914"></a><span class="hs-identifier">equalityTyCon</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TysPrim.html#eqReprPrimTyCon"><span class="hs-identifier hs-var">eqReprPrimTyCon</span></a><span>
</span><a name="line-1915"></a><span class="hs-identifier">equalityTyCon</span><span> </span><a href="CoAxiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TysPrim.html#eqPhantPrimTyCon"><span class="hs-identifier hs-var">eqPhantPrimTyCon</span></a><span>
</span><a name="line-1916"></a><span>
</span><a name="line-1917"></a><span class="hs-comment">-- --------------------- Dictionary types ---------------------------------</span><span>
</span><a name="line-1918"></a><span>
</span><a name="line-1919"></a><span class="hs-identifier">mkClassPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-1920"></a><a name="mkClassPred"><a href="Type.html#mkClassPred"><span class="hs-identifier">mkClassPred</span></a></a><span> </span><a name="local-6989586621681925514"><a href="#local-6989586621681925514"><span class="hs-identifier">clas</span></a></a><span> </span><a name="local-6989586621681925515"><a href="#local-6989586621681925515"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-6989586621681925514"><span class="hs-identifier hs-var">clas</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925515"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1921"></a><span>
</span><a name="line-1922"></a><span class="hs-identifier">isDictTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1923"></a><a name="isDictTy"><a href="Type.html#isDictTy"><span class="hs-identifier">isDictTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isClassPred"><span class="hs-identifier hs-var">isClassPred</span></a><span>
</span><a name="line-1924"></a><span>
</span><a name="line-1925"></a><span class="hs-identifier">isDictLikeTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1926"></a><span class="hs-comment">-- Note [Dictionary-like types]</span><span>
</span><a name="line-1927"></a><a name="isDictLikeTy"><a href="Type.html#isDictLikeTy"><span class="hs-identifier">isDictLikeTy</span></a></a><span> </span><a name="local-6989586621681925516"><a href="#local-6989586621681925516"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925517"><a href="#local-6989586621681925517"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925516"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isDictLikeTy"><span class="hs-identifier hs-var">isDictLikeTy</span></a><span> </span><a href="#local-6989586621681925517"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1928"></a><span class="hs-identifier">isDictLikeTy</span><span> </span><a name="local-6989586621681925518"><a href="#local-6989586621681925518"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925518"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1929"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925519"><a href="#local-6989586621681925519"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925520"><a href="#local-6989586621681925520"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isClassTyCon"><span class="hs-identifier hs-var">isClassTyCon</span></a><span> </span><a href="#local-6989586621681925519"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1930"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isTupleTyCon"><span class="hs-identifier hs-var">isTupleTyCon</span></a><span> </span><a href="#local-6989586621681925519"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="Type.html#isDictLikeTy"><span class="hs-identifier hs-var">isDictLikeTy</span></a><span> </span><a href="#local-6989586621681925520"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1931"></a><span>        </span><a name="local-6989586621681925521"><a href="#local-6989586621681925521"><span class="hs-identifier">_other</span></a></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1932"></a><span>
</span><a name="line-1933"></a><span class="hs-comment">{-
Note [Dictionary-like types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Being &quot;dictionary-like&quot; means either a dictionary type or a tuple thereof.
In GHC 6.10 we build implication constraints which construct such tuples,
and if we land up with a binding
    t :: (C [a], Eq [a])
    t = blah
then we want to treat t as cheap under &quot;-fdicts-cheap&quot; for example.
(Implication constraints are normally inlined, but sadly not if the
occurrence is itself inside an INLINE function!  Until we revise the
handling of implication constraints, that is.)  This turned out to
be important in getting good arities in DPH code.  Example:

    class C a
    class D a where { foo :: a -&gt; a }
    instance C a =&gt; D (Maybe a) where { foo x = x }

    bar :: (C a, C b) =&gt; a -&gt; b -&gt; (Maybe a, Maybe b)
    {-# INLINE bar #-}
    bar x y = (foo (Just x), foo (Just y))

Then 'bar' should jolly well have arity 4 (two dicts, two args), but
we ended up with something like
   bar = __inline_me__ (\d1,d2. let t :: (D (Maybe a), D (Maybe b)) = ...
                                in \x,y. &lt;blah&gt;)

This is all a bit ad-hoc; eg it relies on knowing that implication
constraints build tuples.


Decomposing PredType
-}</span><span>
</span><a name="line-1966"></a><span>
</span><a name="line-1967"></a><span class="hs-comment">-- | A choice of equality relation. This is separate from the type 'Role'</span><span>
</span><a name="line-1968"></a><span class="hs-comment">-- because 'Phantom' does not define a (non-trivial) equality relation.</span><span>
</span><a name="line-1969"></a><span class="hs-keyword">data</span><span> </span><a name="EqRel"><a href="Type.html#EqRel"><span class="hs-identifier">EqRel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="NomEq"><a href="Type.html#NomEq"><span class="hs-identifier">NomEq</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="ReprEq"><a href="Type.html#ReprEq"><span class="hs-identifier">ReprEq</span></a></a><span>
</span><a name="line-1970"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-1971"></a><span>
</span><a name="line-1972"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1973"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;nominal equality&quot;</span><span>
</span><a name="line-1974"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;representational equality&quot;</span><span>
</span><a name="line-1975"></a><span>
</span><a name="line-1976"></a><span class="hs-identifier">eqRelRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>
</span><a name="line-1977"></a><a name="eqRelRole"><a href="Type.html#eqRelRole"><span class="hs-identifier">eqRelRole</span></a></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span>
</span><a name="line-1978"></a><span class="hs-identifier">eqRelRole</span><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span>
</span><a name="line-1979"></a><span>
</span><a name="line-1980"></a><span class="hs-keyword">data</span><span> </span><a name="PredTree"><a href="Type.html#PredTree"><span class="hs-identifier">PredTree</span></a></a><span>
</span><a name="line-1981"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ClassPred"><a href="Type.html#ClassPred"><span class="hs-identifier">ClassPred</span></a></a><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1982"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="EqPred"><a href="Type.html#EqPred"><span class="hs-identifier">EqPred</span></a></a><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-1983"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IrredPred"><a href="Type.html#IrredPred"><span class="hs-identifier">IrredPred</span></a></a><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-1984"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ForAllPred"><a href="Type.html#ForAllPred"><span class="hs-identifier">ForAllPred</span></a></a><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVarBinder"><span class="hs-identifier hs-type">TyCoVarBinder</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-1985"></a><span>     </span><span class="hs-comment">-- ForAllPred: see Note [Quantified constraints] in TcCanonical</span><span>
</span><a name="line-1986"></a><span>  </span><span class="hs-comment">-- NB: There is no TuplePred case</span><span>
</span><a name="line-1987"></a><span>  </span><span class="hs-comment">--     Tuple predicates like (Eq a, Ord b) are just treated</span><span>
</span><a name="line-1988"></a><span>  </span><span class="hs-comment">--     as ClassPred, as if we had a tuple class with two superclasses</span><span>
</span><a name="line-1989"></a><span>  </span><span class="hs-comment">--        class (c1, c2) =&gt; (%,%) c1 c2</span><span>
</span><a name="line-1990"></a><span>
</span><a name="line-1991"></a><span class="hs-identifier">classifyPredType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#PredTree"><span class="hs-identifier hs-type">PredTree</span></a><span>
</span><a name="line-1992"></a><a name="classifyPredType"><a href="Type.html#classifyPredType"><span class="hs-identifier">classifyPredType</span></a></a><span> </span><a name="local-6989586621681925522"><a href="#local-6989586621681925522"><span class="hs-identifier">ev_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925522"><span class="hs-identifier hs-var">ev_ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1993"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925523"><a href="#local-6989586621681925523"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681925524"><a href="#local-6989586621681925524"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925525"><a href="#local-6989586621681925525"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1994"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925523"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><a href="#local-6989586621681925524"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621681925525"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1995"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925523"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#EqPred"><span class="hs-identifier hs-var">EqPred</span></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span> </span><a href="#local-6989586621681925524"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621681925525"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1996"></a><span>
</span><a name="line-1997"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925526"><a href="#local-6989586621681925526"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925527"><a href="#local-6989586621681925527"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1998"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925528"><a href="#local-6989586621681925528"><span class="hs-identifier">clas</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-6989586621681925526"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1999"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#ClassPred"><span class="hs-identifier hs-var">ClassPred</span></a><span> </span><a href="#local-6989586621681925528"><span class="hs-identifier hs-var">clas</span></a><span> </span><a href="#local-6989586621681925527"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2000"></a><span>
</span><a name="line-2001"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925529"><a href="#local-6989586621681925529"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925530"><a href="#local-6989586621681925530"><span class="hs-identifier">rho</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitForAllVarBndrs"><span class="hs-identifier hs-var">splitForAllVarBndrs</span></a><span> </span><a href="#local-6989586621681925522"><span class="hs-identifier hs-var">ev_ty</span></a><span>
</span><a name="line-2002"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925531"><a href="#local-6989586621681925531"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925532"><a href="#local-6989586621681925532"><span class="hs-identifier">pred</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitFunTys"><span class="hs-identifier hs-var">splitFunTys</span></a><span> </span><a href="#local-6989586621681925530"><span class="hs-identifier hs-var">rho</span></a><span>
</span><a name="line-2003"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621681925529"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621681925531"><span class="hs-identifier hs-var">theta</span></a><span class="hs-special">)</span><span>
</span><a name="line-2004"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#ForAllPred"><span class="hs-identifier hs-var">ForAllPred</span></a><span> </span><a href="#local-6989586621681925529"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621681925531"><span class="hs-identifier hs-var">theta</span></a><span> </span><a href="#local-6989586621681925532"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-2005"></a><span>
</span><a name="line-2006"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2007"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#IrredPred"><span class="hs-identifier hs-var">IrredPred</span></a><span> </span><a href="#local-6989586621681925522"><span class="hs-identifier hs-var">ev_ty</span></a><span>
</span><a name="line-2008"></a><span>
</span><a name="line-2009"></a><span class="hs-identifier">getClassPredTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2010"></a><a name="getClassPredTys"><a href="Type.html#getClassPredTys"><span class="hs-identifier">getClassPredTys</span></a></a><span> </span><a name="local-6989586621681925533"><a href="#local-6989586621681925533"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#getClassPredTys_maybe"><span class="hs-identifier hs-var">getClassPredTys_maybe</span></a><span> </span><a href="#local-6989586621681925533"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2011"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925534"><a href="#local-6989586621681925534"><span class="hs-identifier">clas</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925535"><a href="#local-6989586621681925535"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925534"><span class="hs-identifier hs-var">clas</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925535"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2012"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;getClassPredTys&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925533"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2013"></a><span>
</span><a name="line-2014"></a><span class="hs-identifier">getClassPredTys_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2015"></a><a name="getClassPredTys_maybe"><a href="Type.html#getClassPredTys_maybe"><span class="hs-identifier">getClassPredTys_maybe</span></a></a><span> </span><a name="local-6989586621681925536"><a href="#local-6989586621681925536"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925536"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2016"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925537"><a href="#local-6989586621681925537"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925538"><a href="#local-6989586621681925538"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925539"><a href="#local-6989586621681925539"><span class="hs-identifier">clas</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-6989586621681925537"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925539"><span class="hs-identifier hs-var">clas</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925538"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2017"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2018"></a><span>
</span><a name="line-2019"></a><span class="hs-identifier">getEqPredTys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-2020"></a><a name="getEqPredTys"><a href="Type.html#getEqPredTys"><span class="hs-identifier">getEqPredTys</span></a></a><span> </span><a name="local-6989586621681925540"><a href="#local-6989586621681925540"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2021"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925540"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2022"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925541"><a href="#local-6989586621681925541"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681925542"><a href="#local-6989586621681925542"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925543"><a href="#local-6989586621681925543"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2023"></a><span>        </span><span class="hs-glyph">|</span><span>  </span><a href="#local-6989586621681925541"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a><span>
</span><a name="line-2024"></a><span>        </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621681925541"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a><span>
</span><a name="line-2025"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925542"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925543"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2026"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;getEqPredTys&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925540"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2027"></a><span>
</span><a name="line-2028"></a><span class="hs-identifier">getEqPredTys_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-2029"></a><a name="getEqPredTys_maybe"><a href="Type.html#getEqPredTys_maybe"><span class="hs-identifier">getEqPredTys_maybe</span></a></a><span> </span><a name="local-6989586621681925544"><a href="#local-6989586621681925544"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2030"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925544"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2031"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925545"><a href="#local-6989586621681925545"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681925546"><a href="#local-6989586621681925546"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925547"><a href="#local-6989586621681925547"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2032"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925545"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925546"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925547"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2033"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925545"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925546"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925547"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2034"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2035"></a><span>
</span><a name="line-2036"></a><span class="hs-identifier">getEqPredRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>
</span><a name="line-2037"></a><a name="getEqPredRole"><a href="Type.html#getEqPredRole"><span class="hs-identifier">getEqPredRole</span></a></a><span> </span><a name="local-6989586621681925548"><a href="#local-6989586621681925548"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#predTypeEqRel"><span class="hs-identifier hs-var">predTypeEqRel</span></a><span> </span><a href="#local-6989586621681925548"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2038"></a><span>
</span><a name="line-2039"></a><span class="hs-comment">-- | Get the equality relation relevant for a pred type.</span><span>
</span><a name="line-2040"></a><span class="hs-identifier">predTypeEqRel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span>
</span><a name="line-2041"></a><a name="predTypeEqRel"><a href="Type.html#predTypeEqRel"><span class="hs-identifier">predTypeEqRel</span></a></a><span> </span><a name="local-6989586621681925549"><a href="#local-6989586621681925549"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2042"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925550"><a href="#local-6989586621681925550"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925549"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2043"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925550"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a><span>
</span><a name="line-2044"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span>
</span><a name="line-2045"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2046"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>
</span><a name="line-2047"></a><span>
</span><a name="line-2048"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
         Well-scoped tyvars
*                                                                      *
************************************************************************

Note [ScopedSort]
~~~~~~~~~~~~~~~~~
Consider

  foo :: Proxy a -&gt; Proxy (b :: k) -&gt; Proxy (a :: k2) -&gt; ()

This function type is implicitly generalised over [a, b, k, k2]. These
variables will be Specified; that is, they will be available for visible
type application. This is because they are written in the type signature
by the user.

However, we must ask: what order will they appear in? In cases without
dependency, this is easy: we just use the lexical left-to-right ordering
of first occurrence. With dependency, we cannot get off the hook so
easily.

We thus state:

 * These variables appear in the order as given by ScopedSort, where
   the input to ScopedSort is the left-to-right order of first occurrence.

Note that this applies only to *implicit* quantification, without a
`forall`. If the user writes a `forall`, then we just use the order given.

ScopedSort is defined thusly (as proposed in #15743):
  * Work left-to-right through the input list, with a cursor.
  * If variable v at the cursor is depended on by any earlier variable w,
    move v immediately before the leftmost such w.

INVARIANT: The prefix of variables before the cursor form a valid telescope.

Note that ScopedSort makes sense only after type inference is done and all
types/kinds are fully settled and zonked.

-}</span><span>
</span><a name="line-2090"></a><span>
</span><a name="line-2091"></a><span class="hs-comment">-- | Do a topological sort on a list of tyvars,</span><span>
</span><a name="line-2092"></a><span class="hs-comment">--   so that binders occur before occurrences</span><span>
</span><a name="line-2093"></a><span class="hs-comment">-- E.g. given  [ a::k, k::*, b::k ]</span><span>
</span><a name="line-2094"></a><span class="hs-comment">-- it'll return a well-scoped list [ k::*, a::k, b::k ]</span><span>
</span><a name="line-2095"></a><span class="hs-comment">--</span><span>
</span><a name="line-2096"></a><span class="hs-comment">-- This is a deterministic sorting operation</span><span>
</span><a name="line-2097"></a><span class="hs-comment">-- (that is, doesn't depend on Uniques).</span><span>
</span><a name="line-2098"></a><span class="hs-comment">--</span><span>
</span><a name="line-2099"></a><span class="hs-comment">-- It is also meant to be stable: that is, variables should not</span><span>
</span><a name="line-2100"></a><span class="hs-comment">-- be reordered unnecessarily. This is specified in Note [ScopedSort]</span><span>
</span><a name="line-2101"></a><span class="hs-comment">-- See also Note [Ordering of implicit variables] in RnTypes</span><span>
</span><a name="line-2102"></a><span>
</span><a name="line-2103"></a><span class="hs-identifier">scopedSort</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-2104"></a><a name="scopedSort"><a href="Type.html#scopedSort"><span class="hs-identifier">scopedSort</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925551"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2105"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2106"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- already sorted, in reverse order</span><span>
</span><a name="line-2107"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- each set contains all the variables which must be placed</span><span>
</span><a name="line-2108"></a><span>                       </span><span class="hs-comment">-- before the tv corresponding to the set; they are accumulations</span><span>
</span><a name="line-2109"></a><span>                       </span><span class="hs-comment">-- of the fvs in the sorted tvs' kinds</span><span>
</span><a name="line-2110"></a><span>
</span><a name="line-2111"></a><span>                       </span><span class="hs-comment">-- This list is in 1-to-1 correspondence with the sorted tyvars</span><span>
</span><a name="line-2112"></a><span>                       </span><span class="hs-comment">-- INVARIANT:</span><span>
</span><a name="line-2113"></a><span>                       </span><span class="hs-comment">--   all (\tl -&gt; all (`subVarSet` head tl) (tail tl)) (tails fv_list)</span><span>
</span><a name="line-2114"></a><span>                       </span><span class="hs-comment">-- That is, each set in the list is a superset of all later sets.</span><span>
</span><a name="line-2115"></a><span>
</span><a name="line-2116"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- yet to be sorted</span><span>
</span><a name="line-2117"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-2118"></a><span>    </span><a name="local-6989586621681925551"><a href="#local-6989586621681925551"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925553"><a href="#local-6989586621681925553"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621681925554"><a href="#local-6989586621681925554"><span class="hs-identifier">_fv_list</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681925553"><span class="hs-identifier hs-var">acc</span></a><span>
</span><a name="line-2119"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925555"><a href="#local-6989586621681925555"><span class="hs-identifier">acc</span></a></a><span>  </span><a name="local-6989586621681925556"><a href="#local-6989586621681925556"><span class="hs-identifier">fv_list</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681925557"><a href="#local-6989586621681925557"><span class="hs-identifier">tv</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925558"><a href="#local-6989586621681925558"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2120"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925551"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925559"><span class="hs-identifier hs-var">acc'</span></a><span> </span><a href="#local-6989586621681925560"><span class="hs-identifier hs-var">fv_list'</span></a><span> </span><a href="#local-6989586621681925558"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-2121"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-2122"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621681925559"><a href="#local-6989586621681925559"><span class="hs-identifier">acc'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925560"><a href="#local-6989586621681925560"><span class="hs-identifier">fv_list'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925552"><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-6989586621681925557"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681925555"><span class="hs-identifier hs-var">acc</span></a><span> </span><a href="#local-6989586621681925556"><span class="hs-identifier hs-var">fv_list</span></a><span>
</span><a name="line-2123"></a><span>
</span><a name="line-2124"></a><span>    </span><span class="hs-identifier">insert</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span>       </span><span class="hs-comment">-- var to insert</span><span>
</span><a name="line-2125"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- sorted list, in reverse order</span><span>
</span><a name="line-2126"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- list of fvs, as above</span><span>
</span><a name="line-2127"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- augmented lists</span><span>
</span><a name="line-2128"></a><span>    </span><a name="local-6989586621681925552"><a href="#local-6989586621681925552"><span class="hs-identifier">insert</span></a></a><span> </span><a name="local-6989586621681925561"><a href="#local-6989586621681925561"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621681925561"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621681925561"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2129"></a><span>    </span><span class="hs-identifier">insert</span><span> </span><a name="local-6989586621681925562"><a href="#local-6989586621681925562"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681925563"><a href="#local-6989586621681925563"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925565"><a href="#local-6989586621681925565"><span class="hs-identifier">fvs</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925566"><a href="#local-6989586621681925566"><span class="hs-identifier">fvss</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2130"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925562"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925565"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-2131"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925568"><a href="#local-6989586621681925568"><span class="hs-identifier">as'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925569"><a href="#local-6989586621681925569"><span class="hs-identifier">fvss'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925552"><span class="hs-identifier hs-var">insert</span></a><span> </span><a href="#local-6989586621681925562"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">as</span><span> </span><a href="#local-6989586621681925566"><span class="hs-identifier hs-var">fvss</span></a><span>
</span><a name="line-2132"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925563"><span class="hs-identifier hs-var">a</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925568"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925565"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925567"><span class="hs-identifier hs-var">fv_tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925569"><span class="hs-identifier hs-var">fvss'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2133"></a><span>
</span><a name="line-2134"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2135"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925562"><span class="hs-identifier hs-var">tv</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925563"><span class="hs-identifier hs-var">a</span></a><span class="hs-glyph">:</span><span class="hs-keyword">as</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925565"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#unionVarSet"><span class="hs-identifier hs-var">unionVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925567"><span class="hs-identifier hs-var">fv_tv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925565"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681925566"><span class="hs-identifier hs-var">fvss</span></a><span class="hs-special">)</span><span>
</span><a name="line-2136"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-2137"></a><span>        </span><a name="local-6989586621681925567"><a href="#local-6989586621681925567"><span class="hs-identifier">fv_tv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621681925562"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2138"></a><span>
</span><a name="line-2139"></a><span>       </span><span class="hs-comment">-- lists not in correspondence</span><span>
</span><a name="line-2140"></a><span>    </span><span class="hs-identifier">insert</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;scopedSort&quot;</span><span>
</span><a name="line-2141"></a><span>
</span><a name="line-2142"></a><span class="hs-comment">-- | Extract a well-scoped list of variables from a deterministic set of</span><span>
</span><a name="line-2143"></a><span class="hs-comment">-- variables. The result is deterministic.</span><span>
</span><a name="line-2144"></a><span class="hs-comment">-- NB: There used to exist varSetElemsWellScoped :: VarSet -&gt; [Var] which</span><span>
</span><a name="line-2145"></a><span class="hs-comment">-- took a non-deterministic set and produced a non-deterministic</span><span>
</span><a name="line-2146"></a><span class="hs-comment">-- well-scoped list. If you care about the list being well-scoped you also</span><span>
</span><a name="line-2147"></a><span class="hs-comment">-- most likely care about it being in deterministic order.</span><span>
</span><a name="line-2148"></a><span class="hs-identifier">dVarSetElemsWellScoped</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#DVarSet"><span class="hs-identifier hs-type">DVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span>
</span><a name="line-2149"></a><a name="dVarSetElemsWellScoped"><a href="Type.html#dVarSetElemsWellScoped"><span class="hs-identifier">dVarSetElemsWellScoped</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#scopedSort"><span class="hs-identifier hs-var">scopedSort</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="VarSet.html#dVarSetElems"><span class="hs-identifier hs-var">dVarSetElems</span></a><span>
</span><a name="line-2150"></a><span>
</span><a name="line-2151"></a><span class="hs-comment">-- | Get the free vars of a type in scoped order</span><span>
</span><a name="line-2152"></a><span class="hs-identifier">tyCoVarsOfTypeWellScoped</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-2153"></a><a name="tyCoVarsOfTypeWellScoped"><a href="Type.html#tyCoVarsOfTypeWellScoped"><span class="hs-identifier">tyCoVarsOfTypeWellScoped</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#scopedSort"><span class="hs-identifier hs-var">scopedSort</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypeList"><span class="hs-identifier hs-var">tyCoVarsOfTypeList</span></a><span>
</span><a name="line-2154"></a><span>
</span><a name="line-2155"></a><span class="hs-comment">-- | Get the free vars of types in scoped order</span><span>
</span><a name="line-2156"></a><span class="hs-identifier">tyCoVarsOfTypesWellScoped</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-2157"></a><a name="tyCoVarsOfTypesWellScoped"><a href="Type.html#tyCoVarsOfTypesWellScoped"><span class="hs-identifier">tyCoVarsOfTypesWellScoped</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#scopedSort"><span class="hs-identifier hs-var">scopedSort</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TyCoRep.html#tyCoVarsOfTypesList"><span class="hs-identifier hs-var">tyCoVarsOfTypesList</span></a><span>
</span><a name="line-2158"></a><span>
</span><a name="line-2159"></a><span class="hs-comment">-- | Given the suffix of a telescope, returns the prefix.</span><span>
</span><a name="line-2160"></a><span class="hs-comment">-- Ex: given [(k :: j), (a :: Proxy k)], returns [(j :: *)].</span><span>
</span><a name="line-2161"></a><span class="hs-identifier">tyCoVarsOfBindersWellScoped</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-2162"></a><a name="tyCoVarsOfBindersWellScoped"><a href="Type.html#tyCoVarsOfBindersWellScoped"><span class="hs-identifier">tyCoVarsOfBindersWellScoped</span></a></a><span> </span><a name="local-6989586621681925570"><a href="#local-6989586621681925570"><span class="hs-identifier">tvs</span></a></a><span>
</span><a name="line-2163"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tyCoVarsOfTypeWellScoped"><span class="hs-identifier hs-var">tyCoVarsOfTypeWellScoped</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#mkInvForAllTys"><span class="hs-identifier hs-var">mkInvForAllTys</span></a><span> </span><a href="#local-6989586621681925570"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="TysWiredIn.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-2164"></a><span>
</span><a name="line-2165"></a><span class="hs-comment">------------- Closing over kinds -----------------</span><span>
</span><a name="line-2166"></a><span>
</span><a name="line-2167"></a><span class="hs-comment">-- | Add the kind variables free in the kinds of the tyvars in the given set.</span><span>
</span><a name="line-2168"></a><span class="hs-comment">-- Returns a non-deterministic set.</span><span>
</span><a name="line-2169"></a><span class="hs-identifier">closeOverKinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a><span>
</span><a name="line-2170"></a><a name="closeOverKinds"><a href="Type.html#closeOverKinds"><span class="hs-identifier">closeOverKinds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvVarSet"><span class="hs-identifier hs-var">fvVarSet</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Type.html#closeOverKindsFV"><span class="hs-identifier hs-var">closeOverKindsFV</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="UniqSet.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a><span>
</span><a name="line-2171"></a><span>  </span><span class="hs-comment">-- It's OK to use nonDetEltsUniqSet here because we immediately forget</span><span>
</span><a name="line-2172"></a><span>  </span><span class="hs-comment">-- about the ordering by returning a set.</span><span>
</span><a name="line-2173"></a><span>
</span><a name="line-2174"></a><span class="hs-comment">-- | Given a list of tyvars returns a deterministic FV computation that</span><span>
</span><a name="line-2175"></a><span class="hs-comment">-- returns the given tyvars with the kind variables free in the kinds of the</span><span>
</span><a name="line-2176"></a><span class="hs-comment">-- given tyvars.</span><span>
</span><a name="line-2177"></a><span class="hs-identifier">closeOverKindsFV</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FV.html#FV"><span class="hs-identifier hs-type">FV</span></a><span>
</span><a name="line-2178"></a><a name="closeOverKindsFV"><a href="Type.html#closeOverKindsFV"><span class="hs-identifier">closeOverKindsFV</span></a></a><span> </span><a name="local-6989586621681925571"><a href="#local-6989586621681925571"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2179"></a><span>  </span><a href="FV.html#mapUnionFV"><span class="hs-identifier hs-var">mapUnionFV</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoFVsOfType"><span class="hs-identifier hs-var">tyCoFVsOfType</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925571"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><a href="FV.html#mkFVs"><span class="hs-identifier hs-var">mkFVs</span></a><span> </span><a href="#local-6989586621681925571"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-2180"></a><span>
</span><a name="line-2181"></a><span class="hs-comment">-- | Add the kind variables free in the kinds of the tyvars in the given set.</span><span>
</span><a name="line-2182"></a><span class="hs-comment">-- Returns a deterministically ordered list.</span><span>
</span><a name="line-2183"></a><span class="hs-identifier">closeOverKindsList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-2184"></a><a name="closeOverKindsList"><a href="Type.html#closeOverKindsList"><span class="hs-identifier">closeOverKindsList</span></a></a><span> </span><a name="local-6989586621681925572"><a href="#local-6989586621681925572"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvVarList"><span class="hs-identifier hs-var">fvVarList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Type.html#closeOverKindsFV"><span class="hs-identifier hs-var">closeOverKindsFV</span></a><span> </span><a href="#local-6989586621681925572"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-2185"></a><span>
</span><a name="line-2186"></a><span class="hs-comment">-- | Add the kind variables free in the kinds of the tyvars in the given set.</span><span>
</span><a name="line-2187"></a><span class="hs-comment">-- Returns a deterministic set.</span><span>
</span><a name="line-2188"></a><span class="hs-identifier">closeOverKindsDSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#DTyVarSet"><span class="hs-identifier hs-type">DTyVarSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#DTyVarSet"><span class="hs-identifier hs-type">DTyVarSet</span></a><span>
</span><a name="line-2189"></a><a name="closeOverKindsDSet"><a href="Type.html#closeOverKindsDSet"><span class="hs-identifier">closeOverKindsDSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvDVarSet"><span class="hs-identifier hs-var">fvDVarSet</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Type.html#closeOverKindsFV"><span class="hs-identifier hs-var">closeOverKindsFV</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="VarSet.html#dVarSetElems"><span class="hs-identifier hs-var">dVarSetElems</span></a><span>
</span><a name="line-2190"></a><span>
</span><a name="line-2191"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Type families}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2198"></a><span>
</span><a name="line-2199"></a><span class="hs-identifier">mkFamilyTyConApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2200"></a><span class="hs-comment">-- ^ Given a family instance TyCon and its arg types, return the</span><span>
</span><a name="line-2201"></a><span class="hs-comment">-- corresponding family type.  E.g:</span><span>
</span><a name="line-2202"></a><span class="hs-comment">--</span><span>
</span><a name="line-2203"></a><span class="hs-comment">-- &gt; data family T a</span><span>
</span><a name="line-2204"></a><span class="hs-comment">-- &gt; data instance T (Maybe b) = MkT b</span><span>
</span><a name="line-2205"></a><span class="hs-comment">--</span><span>
</span><a name="line-2206"></a><span class="hs-comment">-- Where the instance tycon is :RTL, so:</span><span>
</span><a name="line-2207"></a><span class="hs-comment">--</span><span>
</span><a name="line-2208"></a><span class="hs-comment">-- &gt; mkFamilyTyConApp :RTL Int  =  T (Maybe Int)</span><span>
</span><a name="line-2209"></a><a name="mkFamilyTyConApp"><a href="Type.html#mkFamilyTyConApp"><span class="hs-identifier">mkFamilyTyConApp</span></a></a><span> </span><a name="local-6989586621681925573"><a href="#local-6989586621681925573"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925574"><a href="#local-6989586621681925574"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-2210"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925575"><a href="#local-6989586621681925575"><span class="hs-identifier">fam_tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925576"><a href="#local-6989586621681925576"><span class="hs-identifier">fam_tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConFamInst_maybe"><span class="hs-identifier hs-var">tyConFamInst_maybe</span></a><span> </span><a href="#local-6989586621681925573"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2211"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681925577"><a href="#local-6989586621681925577"><span class="hs-identifier">tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-6989586621681925573"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2212"></a><span>        </span><a name="local-6989586621681925578"><a href="#local-6989586621681925578"><span class="hs-identifier">fam_subst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2213"></a><span>                    </span><a href="TyCoRep.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a><span> </span><a href="#local-6989586621681925577"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621681925574"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2214"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621681925575"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#substTys"><span class="hs-identifier hs-var">substTys</span></a><span> </span><a href="#local-6989586621681925578"><span class="hs-identifier hs-var">fam_subst</span></a><span> </span><a href="#local-6989586621681925576"><span class="hs-identifier hs-var">fam_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-2215"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2216"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621681925573"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681925574"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2217"></a><span>
</span><a name="line-2218"></a><span class="hs-comment">-- | Get the type on the LHS of a coercion induced by a type/data</span><span>
</span><a name="line-2219"></a><span class="hs-comment">-- family instance.</span><span>
</span><a name="line-2220"></a><span class="hs-identifier">coAxNthLHS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="#local-6989586621681924768"><span class="hs-identifier hs-type">br</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2221"></a><a name="coAxNthLHS"><a href="Type.html#coAxNthLHS"><span class="hs-identifier">coAxNthLHS</span></a></a><span> </span><a name="local-6989586621681925579"><a href="#local-6989586621681925579"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621681925580"><a href="#local-6989586621681925580"><span class="hs-identifier">ind</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2222"></a><span>  </span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a><span> </span><a href="#local-6989586621681925579"><span class="hs-identifier hs-var">ax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#coAxBranchLHS"><span class="hs-identifier hs-var">coAxBranchLHS</span></a><span> </span><span class="hs-special">(</span><a href="CoAxiom.html#coAxiomNthBranch"><span class="hs-identifier hs-var">coAxiomNthBranch</span></a><span> </span><a href="#local-6989586621681925579"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-6989586621681925580"><span class="hs-identifier hs-var">ind</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2223"></a><span>
</span><a name="line-2224"></a><span class="hs-comment">-- | Pretty prints a 'TyCon', using the family instance in case of a</span><span>
</span><a name="line-2225"></a><span class="hs-comment">-- representation tycon.  For example:</span><span>
</span><a name="line-2226"></a><span class="hs-comment">--</span><span>
</span><a name="line-2227"></a><span class="hs-comment">-- &gt; data T [a] = ...</span><span>
</span><a name="line-2228"></a><span class="hs-comment">--</span><span>
</span><a name="line-2229"></a><span class="hs-comment">-- In that case we want to print @T [a]@, where @T@ is the family 'TyCon'</span><span>
</span><a name="line-2230"></a><span class="hs-identifier">pprSourceTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2231"></a><a name="pprSourceTyCon"><a href="Type.html#pprSourceTyCon"><span class="hs-identifier">pprSourceTyCon</span></a></a><span> </span><a name="local-6989586621681925581"><a href="#local-6989586621681925581"><span class="hs-identifier">tycon</span></a></a><span>
</span><a name="line-2232"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925582"><a href="#local-6989586621681925582"><span class="hs-identifier">fam_tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925583"><a href="#local-6989586621681925583"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConFamInst_maybe"><span class="hs-identifier hs-var">tyConFamInst_maybe</span></a><span> </span><a href="#local-6989586621681925581"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-2233"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621681925582"><span class="hs-identifier hs-var">fam_tc</span></a><span> </span><span class="hs-special">`</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925583"><span class="hs-identifier hs-var">tys</span></a><span>        </span><span class="hs-comment">-- can't be FunTyCon</span><span>
</span><a name="line-2234"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2235"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925581"><span class="hs-identifier hs-var">tycon</span></a><span>
</span><a name="line-2236"></a><span>
</span><a name="line-2237"></a><span class="hs-identifier">isFamFreeTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2238"></a><a name="isFamFreeTy"><a href="Type.html#isFamFreeTy"><span class="hs-identifier">isFamFreeTy</span></a></a><span> </span><a name="local-6989586621681925584"><a href="#local-6989586621681925584"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925585"><a href="#local-6989586621681925585"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925584"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isFamFreeTy"><span class="hs-identifier hs-var">isFamFreeTy</span></a><span> </span><a href="#local-6989586621681925585"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-2239"></a><span class="hs-identifier">isFamFreeTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2240"></a><span class="hs-identifier">isFamFreeTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2241"></a><span class="hs-identifier">isFamFreeTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925586"><a href="#local-6989586621681925586"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925587"><a href="#local-6989586621681925587"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="Type.html#isFamFreeTy"><span class="hs-identifier hs-var">isFamFreeTy</span></a><span> </span><a href="#local-6989586621681925587"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TyCon.html#isFamFreeTyCon"><span class="hs-identifier hs-var">isFamFreeTyCon</span></a><span> </span><a href="#local-6989586621681925586"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2242"></a><span class="hs-identifier">isFamFreeTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925588"><a href="#local-6989586621681925588"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621681925589"><a href="#local-6989586621681925589"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isFamFreeTy"><span class="hs-identifier hs-var">isFamFreeTy</span></a><span> </span><a href="#local-6989586621681925588"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Type.html#isFamFreeTy"><span class="hs-identifier hs-var">isFamFreeTy</span></a><span> </span><a href="#local-6989586621681925589"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-2243"></a><span class="hs-identifier">isFamFreeTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925590"><a href="#local-6989586621681925590"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621681925591"><a href="#local-6989586621681925591"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isFamFreeTy"><span class="hs-identifier hs-var">isFamFreeTy</span></a><span> </span><a href="#local-6989586621681925590"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Type.html#isFamFreeTy"><span class="hs-identifier hs-var">isFamFreeTy</span></a><span> </span><a href="#local-6989586621681925591"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-2244"></a><span class="hs-identifier">isFamFreeTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925592"><a href="#local-6989586621681925592"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isFamFreeTy"><span class="hs-identifier hs-var">isFamFreeTy</span></a><span> </span><a href="#local-6989586621681925592"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2245"></a><span class="hs-identifier">isFamFreeTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925593"><a href="#local-6989586621681925593"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isFamFreeTy"><span class="hs-identifier hs-var">isFamFreeTy</span></a><span> </span><a href="#local-6989586621681925593"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2246"></a><span class="hs-identifier">isFamFreeTy</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- Not sure about this</span><span>
</span><a name="line-2247"></a><span>
</span><a name="line-2248"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Liftedness}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2255"></a><span>
</span><a name="line-2256"></a><span class="hs-comment">-- | Returns Just True if this type is surely lifted, Just False</span><span>
</span><a name="line-2257"></a><span class="hs-comment">-- if it is surely unlifted, Nothing if we can't be sure (i.e., it is</span><span>
</span><a name="line-2258"></a><span class="hs-comment">-- levity polymorphic), and panics if the kind does not have the shape</span><span>
</span><a name="line-2259"></a><span class="hs-comment">-- TYPE r.</span><span>
</span><a name="line-2260"></a><span class="hs-identifier">isLiftedType_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2261"></a><a name="isLiftedType_maybe"><a href="Type.html#isLiftedType_maybe"><span class="hs-identifier">isLiftedType_maybe</span></a></a><span> </span><a name="local-6989586621681925594"><a href="#local-6989586621681925594"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925595"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925594"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2262"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2263"></a><span>    </span><a name="local-6989586621681925595"><a href="#local-6989586621681925595"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925596"><a href="#local-6989586621681925596"><span class="hs-identifier">rr</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925597"><a href="#local-6989586621681925597"><span class="hs-identifier">rr'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925596"><span class="hs-identifier hs-var">rr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925595"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925597"><span class="hs-identifier hs-var">rr'</span></a><span>
</span><a name="line-2264"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isLiftedRuntimeRep"><span class="hs-identifier hs-var">isLiftedRuntimeRep</span></a><span> </span><a href="#local-6989586621681925596"><span class="hs-identifier hs-var">rr</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2265"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925596"><span class="hs-identifier hs-var">rr</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">False</span><span>  </span><span class="hs-comment">-- Everything else is unlifted</span><span>
</span><a name="line-2266"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>     </span><span class="hs-comment">-- levity polymorphic</span><span>
</span><a name="line-2267"></a><span>
</span><a name="line-2268"></a><span class="hs-comment">-- | See &quot;Type#type_classification&quot; for what an unlifted type is.</span><span>
</span><a name="line-2269"></a><span class="hs-comment">-- Panics on levity polymorphic types.</span><span>
</span><a name="line-2270"></a><span class="hs-identifier">isUnliftedType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2271"></a><span>        </span><span class="hs-comment">-- isUnliftedType returns True for forall'd unlifted types:</span><span>
</span><a name="line-2272"></a><span>        </span><span class="hs-comment">--      x :: forall a. Int#</span><span>
</span><a name="line-2273"></a><span>        </span><span class="hs-comment">-- I found bindings like these were getting floated to the top level.</span><span>
</span><a name="line-2274"></a><span>        </span><span class="hs-comment">-- They are pretty bogus types, mind you.  It would be better never to</span><span>
</span><a name="line-2275"></a><span>        </span><span class="hs-comment">-- construct them</span><span>
</span><a name="line-2276"></a><a name="isUnliftedType"><a href="Type.html#isUnliftedType"><span class="hs-identifier">isUnliftedType</span></a></a><span> </span><a name="local-6989586621681925598"><a href="#local-6989586621681925598"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2277"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Type.html#isLiftedType_maybe"><span class="hs-identifier hs-var">isLiftedType_maybe</span></a><span> </span><a href="#local-6989586621681925598"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span>
</span><a name="line-2278"></a><span>         </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;isUnliftedType&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925598"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925598"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2279"></a><span>
</span><a name="line-2280"></a><span class="hs-comment">-- | Is this a type of kind RuntimeRep? (e.g. LiftedRep)</span><span>
</span><a name="line-2281"></a><span class="hs-identifier">isRuntimeRepKindedTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2282"></a><a name="isRuntimeRepKindedTy"><a href="Type.html#isRuntimeRepKindedTy"><span class="hs-identifier">isRuntimeRepKindedTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#isRuntimeRepTy"><span class="hs-identifier hs-var">isRuntimeRepTy</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span>
</span><a name="line-2283"></a><span>
</span><a name="line-2284"></a><span class="hs-comment">-- | Drops prefix of RuntimeRep constructors in 'TyConApp's. Useful for e.g.</span><span>
</span><a name="line-2285"></a><span class="hs-comment">-- dropping 'LiftedRep arguments of unboxed tuple TyCon applications:</span><span>
</span><a name="line-2286"></a><span class="hs-comment">--</span><span>
</span><a name="line-2287"></a><span class="hs-comment">--   dropRuntimeRepArgs [ 'LiftedRep, 'IntRep</span><span>
</span><a name="line-2288"></a><span class="hs-comment">--                      , String, Int# ] == [String, Int#]</span><span>
</span><a name="line-2289"></a><span class="hs-comment">--</span><span>
</span><a name="line-2290"></a><span class="hs-identifier">dropRuntimeRepArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-2291"></a><a name="dropRuntimeRepArgs"><a href="Type.html#dropRuntimeRepArgs"><span class="hs-identifier">dropRuntimeRepArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><a href="Type.html#isRuntimeRepKindedTy"><span class="hs-identifier hs-var">isRuntimeRepKindedTy</span></a><span>
</span><a name="line-2292"></a><span>
</span><a name="line-2293"></a><span class="hs-comment">-- | Extract the RuntimeRep classifier of a type. For instance,</span><span>
</span><a name="line-2294"></a><span class="hs-comment">-- @getRuntimeRep_maybe Int = LiftedRep@. Returns 'Nothing' if this is not</span><span>
</span><a name="line-2295"></a><span class="hs-comment">-- possible.</span><span>
</span><a name="line-2296"></a><span class="hs-identifier">getRuntimeRep_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span>
</span><a name="line-2297"></a><span>                    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2298"></a><a name="getRuntimeRep_maybe"><a href="Type.html#getRuntimeRep_maybe"><span class="hs-identifier">getRuntimeRep_maybe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#kindRep_maybe"><span class="hs-identifier hs-var">kindRep_maybe</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span>
</span><a name="line-2299"></a><span>
</span><a name="line-2300"></a><span class="hs-comment">-- | Extract the RuntimeRep classifier of a type. For instance,</span><span>
</span><a name="line-2301"></a><span class="hs-comment">-- @getRuntimeRep_maybe Int = LiftedRep@. Panics if this is not possible.</span><span>
</span><a name="line-2302"></a><span class="hs-identifier">getRuntimeRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2303"></a><a name="getRuntimeRep"><a href="Type.html#getRuntimeRep"><span class="hs-identifier">getRuntimeRep</span></a></a><span> </span><a name="local-6989586621681925599"><a href="#local-6989586621681925599"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2304"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#getRuntimeRep_maybe"><span class="hs-identifier hs-var">getRuntimeRep_maybe</span></a><span> </span><a href="#local-6989586621681925599"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2305"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925600"><a href="#local-6989586621681925600"><span class="hs-identifier">r</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925600"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-2306"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;getRuntimeRep&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925599"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925599"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2307"></a><span>
</span><a name="line-2308"></a><span class="hs-identifier">isUnboxedTupleType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2309"></a><a name="isUnboxedTupleType"><a href="Type.html#isUnboxedTupleType"><span class="hs-identifier">isUnboxedTupleType</span></a></a><span> </span><a name="local-6989586621681925601"><a href="#local-6989586621681925601"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2310"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tyConAppTyCon"><span class="hs-identifier hs-var">tyConAppTyCon</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925601"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#tupleRepDataConKey"><span class="hs-identifier hs-var">tupleRepDataConKey</span></a><span>
</span><a name="line-2311"></a><span>  </span><span class="hs-comment">-- NB: Do not use typePrimRep, as that can't tell the difference between</span><span>
</span><a name="line-2312"></a><span>  </span><span class="hs-comment">-- unboxed tuples and unboxed sums</span><span>
</span><a name="line-2313"></a><span>
</span><a name="line-2314"></a><span>
</span><a name="line-2315"></a><span class="hs-identifier">isUnboxedSumType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2316"></a><a name="isUnboxedSumType"><a href="Type.html#isUnboxedSumType"><span class="hs-identifier">isUnboxedSumType</span></a></a><span> </span><a name="local-6989586621681925602"><a href="#local-6989586621681925602"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2317"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tyConAppTyCon"><span class="hs-identifier hs-var">tyConAppTyCon</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621681925602"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#sumRepDataConKey"><span class="hs-identifier hs-var">sumRepDataConKey</span></a><span>
</span><a name="line-2318"></a><span>
</span><a name="line-2319"></a><span class="hs-comment">-- | See &quot;Type#type_classification&quot; for what an algebraic type is.</span><span>
</span><a name="line-2320"></a><span class="hs-comment">-- Should only be applied to /types/, as opposed to e.g. partially</span><span>
</span><a name="line-2321"></a><span class="hs-comment">-- saturated type constructors</span><span>
</span><a name="line-2322"></a><span class="hs-identifier">isAlgType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2323"></a><a name="isAlgType"><a href="Type.html#isAlgType"><span class="hs-identifier">isAlgType</span></a></a><span> </span><a name="local-6989586621681925603"><a href="#local-6989586621681925603"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2324"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925603"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2325"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925604"><a href="#local-6989586621681925604"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925605"><a href="#local-6989586621681925605"><span class="hs-identifier">ty_args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">ty_args</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthIs</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="Util.html#lengthIs"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2326"></a><span>                            </span><a href="TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a><span> </span><a href="#local-6989586621681925604"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2327"></a><span>      </span><a name="local-6989586621681925606"><a href="#local-6989586621681925606"><span class="hs-identifier">_other</span></a></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2328"></a><span>
</span><a name="line-2329"></a><span class="hs-comment">-- | Check whether a type is a data family type</span><span>
</span><a name="line-2330"></a><span class="hs-identifier">isDataFamilyAppType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2331"></a><a name="isDataFamilyAppType"><a href="Type.html#isDataFamilyAppType"><span class="hs-identifier">isDataFamilyAppType</span></a></a><span> </span><a name="local-6989586621681925607"><a href="#local-6989586621681925607"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621681925607"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2332"></a><span>                           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925608"><a href="#local-6989586621681925608"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#isDataFamilyTyCon"><span class="hs-identifier hs-var">isDataFamilyTyCon</span></a><span> </span><a href="#local-6989586621681925608"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2333"></a><span>                           </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2334"></a><span>
</span><a name="line-2335"></a><span class="hs-comment">-- | Computes whether an argument (or let right hand side) should</span><span>
</span><a name="line-2336"></a><span class="hs-comment">-- be computed strictly or lazily, based only on its type.</span><span>
</span><a name="line-2337"></a><span class="hs-comment">-- Currently, it's just 'isUnliftedType'. Panics on levity-polymorphic types.</span><span>
</span><a name="line-2338"></a><span class="hs-identifier">isStrictType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2339"></a><a name="isStrictType"><a href="Type.html#isStrictType"><span class="hs-identifier">isStrictType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isUnliftedType"><span class="hs-identifier hs-var">isUnliftedType</span></a><span>
</span><a name="line-2340"></a><span>
</span><a name="line-2341"></a><span class="hs-identifier">isPrimitiveType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2342"></a><span class="hs-comment">-- ^ Returns true of types that are opaque to Haskell.</span><span>
</span><a name="line-2343"></a><a name="isPrimitiveType"><a href="Type.html#isPrimitiveType"><span class="hs-identifier">isPrimitiveType</span></a></a><span> </span><a name="local-6989586621681925609"><a href="#local-6989586621681925609"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621681925609"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2344"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925610"><a href="#local-6989586621681925610"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925611"><a href="#local-6989586621681925611"><span class="hs-identifier">ty_args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">ty_args</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthIs</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tyConArity</span><span> </span><a href="Util.html#lengthIs"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2345"></a><span>                                              </span><a href="TyCon.html#isPrimTyCon"><span class="hs-identifier hs-var">isPrimTyCon</span></a><span> </span><a href="#local-6989586621681925610"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2346"></a><span>                        </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2347"></a><span>
</span><a name="line-2348"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Join points}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2355"></a><span>
</span><a name="line-2356"></a><span class="hs-comment">-- | Determine whether a type could be the type of a join point of given total</span><span>
</span><a name="line-2357"></a><span class="hs-comment">-- arity, according to the polymorphism rule. A join point cannot be polymorphic</span><span>
</span><a name="line-2358"></a><span class="hs-comment">-- in its return type, since given</span><span>
</span><a name="line-2359"></a><span class="hs-comment">--   join j @a @b x y z = e1 in e2,</span><span>
</span><a name="line-2360"></a><span class="hs-comment">-- the types of e1 and e2 must be the same, and a and b are not in scope for e2.</span><span>
</span><a name="line-2361"></a><span class="hs-comment">-- (See Note [The polymorphism rule of join points] in CoreSyn.) Returns False</span><span>
</span><a name="line-2362"></a><span class="hs-comment">-- also if the type simply doesn't have enough arguments.</span><span>
</span><a name="line-2363"></a><span class="hs-comment">--</span><span>
</span><a name="line-2364"></a><span class="hs-comment">-- Note that we need to know how many arguments (type *and* value) the putative</span><span>
</span><a name="line-2365"></a><span class="hs-comment">-- join point takes; for instance, if</span><span>
</span><a name="line-2366"></a><span class="hs-comment">--   j :: forall a. a -&gt; Int</span><span>
</span><a name="line-2367"></a><span class="hs-comment">-- then j could be a binary join point returning an Int, but it could *not* be a</span><span>
</span><a name="line-2368"></a><span class="hs-comment">-- unary join point returning a -&gt; Int.</span><span>
</span><a name="line-2369"></a><span class="hs-comment">--</span><span>
</span><a name="line-2370"></a><span class="hs-comment">-- TODO: See Note [Excess polymorphism and join points]</span><span>
</span><a name="line-2371"></a><span class="hs-identifier">isValidJoinPointType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#JoinArity"><span class="hs-identifier hs-type">JoinArity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2372"></a><a name="isValidJoinPointType"><a href="Type.html#isValidJoinPointType"><span class="hs-identifier">isValidJoinPointType</span></a></a><span> </span><a name="local-6989586621681925612"><a href="#local-6989586621681925612"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621681925613"><a href="#local-6989586621681925613"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2373"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925614"><span class="hs-identifier hs-var">valid_under</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span> </span><a href="#local-6989586621681925612"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="#local-6989586621681925613"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2374"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2375"></a><span>    </span><a name="local-6989586621681925614"><a href="#local-6989586621681925614"><span class="hs-identifier">valid_under</span></a></a><span> </span><a name="local-6989586621681925615"><a href="#local-6989586621681925615"><span class="hs-identifier">tvs</span></a></a><span> </span><a name="local-6989586621681925616"><a href="#local-6989586621681925616"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621681925617"><a href="#local-6989586621681925617"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2376"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925616"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2377"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925615"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#intersectVarSet"><span class="hs-identifier hs-var">intersectVarSet</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><a href="#local-6989586621681925617"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2378"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925618"><a href="#local-6989586621681925618"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925619"><a href="#local-6989586621681925619"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitForAllTy_maybe"><span class="hs-identifier hs-var">splitForAllTy_maybe</span></a><span> </span><a href="#local-6989586621681925617"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2379"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925614"><span class="hs-identifier hs-var">valid_under</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925615"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#extendVarSet"><span class="hs-identifier hs-var">extendVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925618"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925616"><span class="hs-identifier hs-var">arity</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925619"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-2380"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681925620"><a href="#local-6989586621681925620"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><a href="#local-6989586621681925617"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2381"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925614"><span class="hs-identifier hs-var">valid_under</span></a><span> </span><a href="#local-6989586621681925615"><span class="hs-identifier hs-var">tvs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925616"><span class="hs-identifier hs-var">arity</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925620"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-2382"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2383"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2384"></a><span>
</span><a name="line-2385"></a><span class="hs-comment">{- Note [Excess polymorphism and join points]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In principle, if a function would be a join point except that it fails
the polymorphism rule (see Note [The polymorphism rule of join points] in
CoreSyn), it can still be made a join point with some effort. This is because
all tail calls must return the same type (they return to the same context!), and
thus if the return type depends on an argument, that argument must always be the
same.

For instance, consider:

  let f :: forall a. a -&gt; Char -&gt; [a]
      f @a x c = ... f @a y 'a' ...
  in ... f @Int 1 'b' ... f @Int 2 'c' ...

(where the calls are tail calls). `f` fails the polymorphism rule because its
return type is [a], where [a] is bound. But since the type argument is always
'Int', we can rewrite it as:

  let f' :: Int -&gt; Char -&gt; [Int]
      f' x c = ... f' y 'a' ...
  in ... f' 1 'b' ... f 2 'c' ...

and now we can make f' a join point:

  join f' :: Int -&gt; Char -&gt; [Int]
       f' x c = ... jump f' y 'a' ...
  in ... jump f' 1 'b' ... jump f' 2 'c' ...

It's not clear that this comes up often, however. TODO: Measure how often and
add this analysis if necessary.  See Trac #14620.


************************************************************************
*                                                                      *
\subsection{Sequencing on types}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2424"></a><span>
</span><a name="line-2425"></a><span class="hs-identifier">seqType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2426"></a><a name="seqType"><a href="Type.html#seqType"><span class="hs-identifier">seqType</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-6989586621681925621"><a href="#local-6989586621681925621"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925621"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2427"></a><span class="hs-identifier">seqType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681925622"><a href="#local-6989586621681925622"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925622"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2428"></a><span class="hs-identifier">seqType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925623"><a href="#local-6989586621681925623"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681925624"><a href="#local-6989586621681925624"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621681925623"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621681925624"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2429"></a><span class="hs-identifier">seqType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925625"><a href="#local-6989586621681925625"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681925626"><a href="#local-6989586621681925626"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621681925625"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621681925626"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2430"></a><span class="hs-identifier">seqType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925627"><a href="#local-6989586621681925627"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925628"><a href="#local-6989586621681925628"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925627"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Type.html#seqTypes"><span class="hs-identifier hs-var">seqTypes</span></a><span> </span><a href="#local-6989586621681925628"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2431"></a><span class="hs-identifier">seqType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925629"><a href="#local-6989586621681925629"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925630"><a href="#local-6989586621681925630"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925629"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621681925630"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2432"></a><span class="hs-identifier">seqType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925631"><a href="#local-6989586621681925631"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925632"><a href="#local-6989586621681925632"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621681925631"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621681925632"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2433"></a><span class="hs-identifier">seqType</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621681925633"><a href="#local-6989586621681925633"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#seqCo"><span class="hs-identifier hs-var">seqCo</span></a><span> </span><a href="#local-6989586621681925633"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2434"></a><span>
</span><a name="line-2435"></a><span class="hs-identifier">seqTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2436"></a><a name="seqTypes"><a href="Type.html#seqTypes"><span class="hs-identifier">seqTypes</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2437"></a><span class="hs-identifier">seqTypes</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925634"><a href="#local-6989586621681925634"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925635"><a href="#local-6989586621681925635"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621681925634"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Type.html#seqTypes"><span class="hs-identifier hs-var">seqTypes</span></a><span> </span><a href="#local-6989586621681925635"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2438"></a><span>
</span><a name="line-2439"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Comparison for types
        (We don't use instances so that we know where it happens)
*                                                                      *
************************************************************************

Note [Equality on AppTys]
~~~~~~~~~~~~~~~~~~~~~~~~~
In our cast-ignoring equality, we want to say that the following two
are equal:

  (Maybe |&gt; co) (Int |&gt; co')   ~?       Maybe Int

But the left is an AppTy while the right is a TyConApp. The solution is
to use repSplitAppTy_maybe to break up the TyConApp into its pieces and
then continue. Easy to do, but also easy to forget to do.

-}</span><span>
</span><a name="line-2459"></a><span>
</span><a name="line-2460"></a><span class="hs-identifier">eqType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2461"></a><span class="hs-comment">-- ^ Type equality on source types. Does not look through @newtypes@ or</span><span>
</span><a name="line-2462"></a><span class="hs-comment">-- 'PredType's, but it does look through type synonyms.</span><span>
</span><a name="line-2463"></a><span class="hs-comment">-- This first checks that the kinds of the types are equal and then</span><span>
</span><a name="line-2464"></a><span class="hs-comment">-- checks whether the types are equal, ignoring casts and coercions.</span><span>
</span><a name="line-2465"></a><span class="hs-comment">-- (The kind check is a recursive call, but since all kinds have type</span><span>
</span><a name="line-2466"></a><span class="hs-comment">-- @Type@, there is no need to check the types of kinds.)</span><span>
</span><a name="line-2467"></a><span class="hs-comment">-- See also Note [Non-trivial definitional equality] in TyCoRep.</span><span>
</span><a name="line-2468"></a><a name="eqType"><a href="Type.html#eqType"><span class="hs-identifier">eqType</span></a></a><span> </span><a name="local-6989586621681925636"><a href="#local-6989586621681925636"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681925637"><a href="#local-6989586621681925637"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#isEqual"><span class="hs-identifier hs-var">isEqual</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Type.html#nonDetCmpType"><span class="hs-identifier hs-var">nonDetCmpType</span></a><span> </span><a href="#local-6989586621681925636"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925637"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2469"></a><span>  </span><span class="hs-comment">-- It's OK to use nonDetCmpType here and eqType is deterministic,</span><span>
</span><a name="line-2470"></a><span>  </span><span class="hs-comment">-- nonDetCmpType does equality deterministically</span><span>
</span><a name="line-2471"></a><span>
</span><a name="line-2472"></a><span class="hs-comment">-- | Compare types with respect to a (presumably) non-empty 'RnEnv2'.</span><span>
</span><a name="line-2473"></a><span class="hs-identifier">eqTypeX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2474"></a><a name="eqTypeX"><a href="Type.html#eqTypeX"><span class="hs-identifier">eqTypeX</span></a></a><span> </span><a name="local-6989586621681925638"><a href="#local-6989586621681925638"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681925639"><a href="#local-6989586621681925639"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681925640"><a href="#local-6989586621681925640"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#isEqual"><span class="hs-identifier hs-var">isEqual</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Type.html#nonDetCmpTypeX"><span class="hs-identifier hs-var">nonDetCmpTypeX</span></a><span> </span><a href="#local-6989586621681925638"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925639"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925640"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2475"></a><span>  </span><span class="hs-comment">-- It's OK to use nonDetCmpType here and eqTypeX is deterministic,</span><span>
</span><a name="line-2476"></a><span>  </span><span class="hs-comment">-- nonDetCmpTypeX does equality deterministically</span><span>
</span><a name="line-2477"></a><span>
</span><a name="line-2478"></a><span class="hs-comment">-- | Type equality on lists of types, looking through type synonyms</span><span>
</span><a name="line-2479"></a><span class="hs-comment">-- but not newtypes.</span><span>
</span><a name="line-2480"></a><span class="hs-identifier">eqTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2481"></a><a name="eqTypes"><a href="Type.html#eqTypes"><span class="hs-identifier">eqTypes</span></a></a><span> </span><a name="local-6989586621681925641"><a href="#local-6989586621681925641"><span class="hs-identifier">tys1</span></a></a><span> </span><a name="local-6989586621681925642"><a href="#local-6989586621681925642"><span class="hs-identifier">tys2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#isEqual"><span class="hs-identifier hs-var">isEqual</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Type.html#nonDetCmpTypes"><span class="hs-identifier hs-var">nonDetCmpTypes</span></a><span> </span><a href="#local-6989586621681925641"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-6989586621681925642"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-2482"></a><span>  </span><span class="hs-comment">-- It's OK to use nonDetCmpType here and eqTypes is deterministic,</span><span>
</span><a name="line-2483"></a><span>  </span><span class="hs-comment">-- nonDetCmpTypes does equality deterministically</span><span>
</span><a name="line-2484"></a><span>
</span><a name="line-2485"></a><span class="hs-identifier">eqVarBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span>
</span><a name="line-2486"></a><span class="hs-comment">-- Check that the var lists are the same length</span><span>
</span><a name="line-2487"></a><span class="hs-comment">-- and have matching kinds; if so, extend the RnEnv2</span><span>
</span><a name="line-2488"></a><span class="hs-comment">-- Returns Nothing if they don't match</span><span>
</span><a name="line-2489"></a><a name="eqVarBndrs"><a href="Type.html#eqVarBndrs"><span class="hs-identifier">eqVarBndrs</span></a></a><span> </span><a name="local-6989586621681925643"><a href="#local-6989586621681925643"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2490"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681925643"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-2491"></a><span class="hs-identifier">eqVarBndrs</span><span> </span><a name="local-6989586621681925644"><a href="#local-6989586621681925644"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681925645"><a href="#local-6989586621681925645"><span class="hs-identifier">tv1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925646"><a href="#local-6989586621681925646"><span class="hs-identifier">tvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925647"><a href="#local-6989586621681925647"><span class="hs-identifier">tv2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925648"><a href="#local-6989586621681925648"><span class="hs-identifier">tvs2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2492"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#eqTypeX"><span class="hs-identifier hs-var">eqTypeX</span></a><span> </span><a href="#local-6989586621681925644"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925645"><span class="hs-identifier hs-var">tv1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925647"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2493"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#eqVarBndrs"><span class="hs-identifier hs-var">eqVarBndrs</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#rnBndr2"><span class="hs-identifier hs-var">rnBndr2</span></a><span> </span><a href="#local-6989586621681925644"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925645"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621681925647"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925646"><span class="hs-identifier hs-var">tvs1</span></a><span> </span><a href="#local-6989586621681925648"><span class="hs-identifier hs-var">tvs2</span></a><span>
</span><a name="line-2494"></a><span class="hs-identifier">eqVarBndrs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2495"></a><span>
</span><a name="line-2496"></a><span class="hs-comment">-- Now here comes the real worker</span><span>
</span><a name="line-2497"></a><span>
</span><a name="line-2498"></a><span class="hs-comment">{-
Note [nonDetCmpType nondeterminism]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
nonDetCmpType is implemented in terms of nonDetCmpTypeX. nonDetCmpTypeX
uses nonDetCmpTc which compares TyCons by their Unique value. Using Uniques for
ordering leads to nondeterminism. We hit the same problem in the TyVarTy case,
comparing type variables is nondeterministic, note the call to nonDetCmpVar in
nonDetCmpTypeX.
See Note [Unique Determinism] for more details.
-}</span><span>
</span><a name="line-2508"></a><span>
</span><a name="line-2509"></a><span class="hs-identifier">nonDetCmpType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-2510"></a><a name="nonDetCmpType"><a href="Type.html#nonDetCmpType"><span class="hs-identifier">nonDetCmpType</span></a></a><span> </span><a name="local-6989586621681925649"><a href="#local-6989586621681925649"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681925650"><a href="#local-6989586621681925650"><span class="hs-identifier">t2</span></a></a><span>
</span><a name="line-2511"></a><span>  </span><span class="hs-comment">-- we know k1 and k2 have the same kind, because they both have kind *.</span><span>
</span><a name="line-2512"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#nonDetCmpTypeX"><span class="hs-identifier hs-var">nonDetCmpTypeX</span></a><span> </span><a href="#local-6989586621681925651"><span class="hs-identifier hs-var">rn_env</span></a><span> </span><a href="#local-6989586621681925649"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925650"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2513"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2514"></a><span>    </span><a name="local-6989586621681925651"><a href="#local-6989586621681925651"><span class="hs-identifier">rn_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkRnEnv2"><span class="hs-identifier hs-var">mkRnEnv2</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925649"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925650"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2515"></a><span>
</span><a name="line-2516"></a><span class="hs-identifier">nonDetCmpTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-2517"></a><a name="nonDetCmpTypes"><a href="Type.html#nonDetCmpTypes"><span class="hs-identifier">nonDetCmpTypes</span></a></a><span> </span><a name="local-6989586621681925652"><a href="#local-6989586621681925652"><span class="hs-identifier">ts1</span></a></a><span> </span><a name="local-6989586621681925653"><a href="#local-6989586621681925653"><span class="hs-identifier">ts2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#nonDetCmpTypesX"><span class="hs-identifier hs-var">nonDetCmpTypesX</span></a><span> </span><a href="#local-6989586621681925654"><span class="hs-identifier hs-var">rn_env</span></a><span> </span><a href="#local-6989586621681925652"><span class="hs-identifier hs-var">ts1</span></a><span> </span><a href="#local-6989586621681925653"><span class="hs-identifier hs-var">ts2</span></a><span>
</span><a name="line-2518"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2519"></a><span>    </span><a name="local-6989586621681925654"><a href="#local-6989586621681925654"><span class="hs-identifier">rn_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#mkRnEnv2"><span class="hs-identifier hs-var">mkRnEnv2</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925652"><span class="hs-identifier hs-var">ts1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621681925653"><span class="hs-identifier hs-var">ts2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2520"></a><span>
</span><a name="line-2521"></a><span class="hs-comment">-- | An ordering relation between two 'Type's (known below as @t1 :: k1@</span><span>
</span><a name="line-2522"></a><span class="hs-comment">-- and @t2 :: k2@)</span><span>
</span><a name="line-2523"></a><span class="hs-keyword">data</span><span> </span><a name="TypeOrdering"><a href="Type.html#TypeOrdering"><span class="hs-identifier">TypeOrdering</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TLT"><a href="Type.html#TLT"><span class="hs-identifier">TLT</span></a></a><span>  </span><span class="hs-comment">-- ^ @t1 &lt; t2@</span><span>
</span><a name="line-2524"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a name="TEQ"><a href="Type.html#TEQ"><span class="hs-identifier">TEQ</span></a></a><span>  </span><span class="hs-comment">-- ^ @t1 ~ t2@ and there are no casts in either,</span><span>
</span><a name="line-2525"></a><span>                         </span><span class="hs-comment">-- therefore we can conclude @k1 ~ k2@</span><span>
</span><a name="line-2526"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a name="TEQX"><a href="Type.html#TEQX"><span class="hs-identifier">TEQX</span></a></a><span> </span><span class="hs-comment">-- ^ @t1 ~ t2@ yet one of the types contains a cast so</span><span>
</span><a name="line-2527"></a><span>                         </span><span class="hs-comment">-- they may differ in kind.</span><span>
</span><a name="line-2528"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><a name="TGT"><a href="Type.html#TGT"><span class="hs-identifier">TGT</span></a></a><span>  </span><span class="hs-comment">-- ^ @t1 &gt; t2@</span><span>
</span><a name="line-2529"></a><span>                  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span class="hs-special">)</span><span>
</span><a name="line-2530"></a><span>
</span><a name="line-2531"></a><span class="hs-identifier">nonDetCmpTypeX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>  </span><span class="hs-comment">-- Main workhorse</span><span>
</span><a name="line-2532"></a><span>    </span><span class="hs-comment">-- See Note [Non-trivial definitional equality] in TyCoRep</span><span>
</span><a name="line-2533"></a><a name="nonDetCmpTypeX"><a href="Type.html#nonDetCmpTypeX"><span class="hs-identifier">nonDetCmpTypeX</span></a></a><span> </span><a name="local-6989586621681925655"><a href="#local-6989586621681925655"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681925656"><a href="#local-6989586621681925656"><span class="hs-identifier">orig_t1</span></a></a><span> </span><a name="local-6989586621681925657"><a href="#local-6989586621681925657"><span class="hs-identifier">orig_t2</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2534"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925655"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925656"><span class="hs-identifier hs-var">orig_t1</span></a><span> </span><a href="#local-6989586621681925657"><span class="hs-identifier hs-var">orig_t2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2535"></a><span>      </span><span class="hs-comment">-- If there are casts then we also need to do a comparison of the kinds of</span><span>
</span><a name="line-2536"></a><span>      </span><span class="hs-comment">-- the types being compared</span><span>
</span><a name="line-2537"></a><span>      </span><a href="Type.html#TEQX"><span class="hs-identifier hs-var">TEQX</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925660"><span class="hs-identifier hs-var">toOrdering</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925655"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925658"><span class="hs-identifier hs-var">k1</span></a><span> </span><a href="#local-6989586621681925659"><span class="hs-identifier hs-var">k2</span></a><span>
</span><a name="line-2538"></a><span>      </span><a name="local-6989586621681925721"><a href="#local-6989586621681925721"><span class="hs-identifier">ty_ordering</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925660"><span class="hs-identifier hs-var">toOrdering</span></a><span> </span><a href="#local-6989586621681925721"><span class="hs-identifier hs-var">ty_ordering</span></a><span>
</span><a name="line-2539"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2540"></a><span>    </span><a name="local-6989586621681925658"><a href="#local-6989586621681925658"><span class="hs-identifier">k1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925656"><span class="hs-identifier hs-var">orig_t1</span></a><span>
</span><a name="line-2541"></a><span>    </span><a name="local-6989586621681925659"><a href="#local-6989586621681925659"><span class="hs-identifier">k2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925657"><span class="hs-identifier hs-var">orig_t2</span></a><span>
</span><a name="line-2542"></a><span>
</span><a name="line-2543"></a><span>    </span><span class="hs-identifier">toOrdering</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#TypeOrdering"><span class="hs-identifier hs-type">TypeOrdering</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-2544"></a><span>    </span><a name="local-6989586621681925660"><a href="#local-6989586621681925660"><span class="hs-identifier">toOrdering</span></a></a><span> </span><a href="Type.html#TLT"><span class="hs-identifier hs-var">TLT</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-2545"></a><span>    </span><span class="hs-identifier">toOrdering</span><span> </span><a href="Type.html#TEQ"><span class="hs-identifier hs-var">TEQ</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-2546"></a><span>    </span><span class="hs-identifier">toOrdering</span><span> </span><a href="Type.html#TEQX"><span class="hs-identifier hs-var">TEQX</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-2547"></a><span>    </span><span class="hs-identifier">toOrdering</span><span> </span><a href="Type.html#TGT"><span class="hs-identifier hs-var">TGT</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-2548"></a><span>
</span><a name="line-2549"></a><span>    </span><span class="hs-identifier">liftOrdering</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#TypeOrdering"><span class="hs-identifier hs-type">TypeOrdering</span></a><span>
</span><a name="line-2550"></a><span>    </span><a name="local-6989586621681925661"><a href="#local-6989586621681925661"><span class="hs-identifier">liftOrdering</span></a></a><span> </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TLT"><span class="hs-identifier hs-var">TLT</span></a><span>
</span><a name="line-2551"></a><span>    </span><span class="hs-identifier">liftOrdering</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TEQ"><span class="hs-identifier hs-var">TEQ</span></a><span>
</span><a name="line-2552"></a><span>    </span><span class="hs-identifier">liftOrdering</span><span> </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TGT"><span class="hs-identifier hs-var">TGT</span></a><span>
</span><a name="line-2553"></a><span>
</span><a name="line-2554"></a><span>    </span><span class="hs-identifier">thenCmpTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#TypeOrdering"><span class="hs-identifier hs-type">TypeOrdering</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#TypeOrdering"><span class="hs-identifier hs-type">TypeOrdering</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#TypeOrdering"><span class="hs-identifier hs-type">TypeOrdering</span></a><span>
</span><a name="line-2555"></a><span>    </span><a name="local-6989586621681925662"><a href="#local-6989586621681925662"><span class="hs-identifier">thenCmpTy</span></a></a><span> </span><a href="Type.html#TEQ"><span class="hs-identifier hs-var">TEQ</span></a><span>  </span><a name="local-6989586621681925666"><a href="#local-6989586621681925666"><span class="hs-identifier">rel</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925666"><span class="hs-identifier hs-var">rel</span></a><span>
</span><a name="line-2556"></a><span>    </span><span class="hs-identifier">thenCmpTy</span><span> </span><a href="Type.html#TEQX"><span class="hs-identifier hs-var">TEQX</span></a><span> </span><a name="local-6989586621681925667"><a href="#local-6989586621681925667"><span class="hs-identifier">rel</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925663"><span class="hs-identifier hs-var">hasCast</span></a><span> </span><a href="#local-6989586621681925667"><span class="hs-identifier hs-var">rel</span></a><span>
</span><a name="line-2557"></a><span>    </span><span class="hs-identifier">thenCmpTy</span><span> </span><a name="local-6989586621681925668"><a href="#local-6989586621681925668"><span class="hs-identifier">rel</span></a></a><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925668"><span class="hs-identifier hs-var">rel</span></a><span>
</span><a name="line-2558"></a><span>
</span><a name="line-2559"></a><span>    </span><span class="hs-identifier">hasCast</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#TypeOrdering"><span class="hs-identifier hs-type">TypeOrdering</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#TypeOrdering"><span class="hs-identifier hs-type">TypeOrdering</span></a><span>
</span><a name="line-2560"></a><span>    </span><a name="local-6989586621681925663"><a href="#local-6989586621681925663"><span class="hs-identifier">hasCast</span></a></a><span> </span><a href="Type.html#TEQ"><span class="hs-identifier hs-var">TEQ</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TEQX"><span class="hs-identifier hs-var">TEQX</span></a><span>
</span><a name="line-2561"></a><span>    </span><span class="hs-identifier">hasCast</span><span> </span><a name="local-6989586621681925669"><a href="#local-6989586621681925669"><span class="hs-identifier">rel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925669"><span class="hs-identifier hs-var">rel</span></a><span>
</span><a name="line-2562"></a><span>
</span><a name="line-2563"></a><span>    </span><span class="hs-comment">-- Returns both the resulting ordering relation between the two types</span><span>
</span><a name="line-2564"></a><span>    </span><span class="hs-comment">-- and whether either contains a cast.</span><span>
</span><a name="line-2565"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#TypeOrdering"><span class="hs-identifier hs-type">TypeOrdering</span></a><span>
</span><a name="line-2566"></a><span>    </span><a name="local-6989586621681925664"><a href="#local-6989586621681925664"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925670"><a href="#local-6989586621681925670"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681925671"><a href="#local-6989586621681925671"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681925672"><a href="#local-6989586621681925672"><span class="hs-identifier">t2</span></a></a><span>
</span><a name="line-2567"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925673"><a href="#local-6989586621681925673"><span class="hs-identifier">t1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925671"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925670"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925673"><span class="hs-identifier hs-var">t1'</span></a><span> </span><a href="#local-6989586621681925672"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2568"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925674"><a href="#local-6989586621681925674"><span class="hs-identifier">t2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925672"><span class="hs-identifier hs-var">t2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925670"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925671"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925674"><span class="hs-identifier hs-var">t2'</span></a><span>
</span><a name="line-2569"></a><span>
</span><a name="line-2570"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925675"><a href="#local-6989586621681925675"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681925676"><a href="#local-6989586621681925676"><span class="hs-identifier">tv1</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681925677"><a href="#local-6989586621681925677"><span class="hs-identifier">tv2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2571"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925661"><span class="hs-identifier hs-var">liftOrdering</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="VarEnv.html#rnOccL"><span class="hs-identifier hs-var">rnOccL</span></a><span> </span><a href="#local-6989586621681925675"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925676"><span class="hs-identifier hs-var">tv1</span></a><span> </span><span class="hs-special">`</span><a href="Var.html#nonDetCmpVar"><span class="hs-identifier hs-var">nonDetCmpVar</span></a><span class="hs-special">`</span><span> </span><a href="VarEnv.html#rnOccR"><span class="hs-identifier hs-var">rnOccR</span></a><span> </span><a href="#local-6989586621681925675"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925677"><span class="hs-identifier hs-var">tv2</span></a><span>
</span><a name="line-2572"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925678"><a href="#local-6989586621681925678"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925679"><a href="#local-6989586621681925679"><span class="hs-identifier">tv1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925680"><a href="#local-6989586621681925680"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925681"><a href="#local-6989586621681925681"><span class="hs-identifier">tv2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925682"><a href="#local-6989586621681925682"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2573"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925678"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925679"><span class="hs-identifier hs-var">tv1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925681"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2574"></a><span>        </span><span class="hs-special">`</span><a href="#local-6989586621681925662"><span class="hs-identifier hs-var">thenCmpTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#rnBndr2"><span class="hs-identifier hs-var">rnBndr2</span></a><span> </span><a href="#local-6989586621681925678"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925679"><span class="hs-identifier hs-var">tv1</span></a><span> </span><a href="#local-6989586621681925681"><span class="hs-identifier hs-var">tv2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925680"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925682"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2575"></a><span>        </span><span class="hs-comment">-- See Note [Equality on AppTys]</span><span>
</span><a name="line-2576"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925683"><a href="#local-6989586621681925683"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925684"><a href="#local-6989586621681925684"><span class="hs-identifier">s1</span></a></a><span> </span><a name="local-6989586621681925685"><a href="#local-6989586621681925685"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925686"><a href="#local-6989586621681925686"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-2577"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925687"><a href="#local-6989586621681925687"><span class="hs-identifier">s2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925688"><a href="#local-6989586621681925688"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#repSplitAppTy_maybe"><span class="hs-identifier hs-var">repSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621681925686"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2578"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925683"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925684"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621681925687"><span class="hs-identifier hs-var">s2</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621681925662"><span class="hs-identifier hs-var">thenCmpTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925683"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925685"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925688"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2579"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925689"><a href="#local-6989586621681925689"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681925690"><a href="#local-6989586621681925690"><span class="hs-identifier">ty1</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925691"><a href="#local-6989586621681925691"><span class="hs-identifier">s2</span></a></a><span> </span><a name="local-6989586621681925692"><a href="#local-6989586621681925692"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2580"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925693"><a href="#local-6989586621681925693"><span class="hs-identifier">s1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925694"><a href="#local-6989586621681925694"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#repSplitAppTy_maybe"><span class="hs-identifier hs-var">repSplitAppTy_maybe</span></a><span> </span><a href="#local-6989586621681925690"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-2581"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925689"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925693"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621681925691"><span class="hs-identifier hs-var">s2</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621681925662"><span class="hs-identifier hs-var">thenCmpTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925689"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925694"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925692"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2582"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925695"><a href="#local-6989586621681925695"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925696"><a href="#local-6989586621681925696"><span class="hs-identifier">s1</span></a></a><span> </span><a name="local-6989586621681925697"><a href="#local-6989586621681925697"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925698"><a href="#local-6989586621681925698"><span class="hs-identifier">s2</span></a></a><span> </span><a name="local-6989586621681925699"><a href="#local-6989586621681925699"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2583"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925695"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925696"><span class="hs-identifier hs-var">s1</span></a><span> </span><a href="#local-6989586621681925698"><span class="hs-identifier hs-var">s2</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621681925662"><span class="hs-identifier hs-var">thenCmpTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925695"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925697"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925699"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2584"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925700"><a href="#local-6989586621681925700"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925701"><a href="#local-6989586621681925701"><span class="hs-identifier">tc1</span></a></a><span> </span><a name="local-6989586621681925702"><a href="#local-6989586621681925702"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925703"><a href="#local-6989586621681925703"><span class="hs-identifier">tc2</span></a></a><span> </span><a name="local-6989586621681925704"><a href="#local-6989586621681925704"><span class="hs-identifier">tys2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2585"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925661"><span class="hs-identifier hs-var">liftOrdering</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925701"><span class="hs-identifier hs-var">tc1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#nonDetCmpTc"><span class="hs-identifier hs-var">nonDetCmpTc</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925703"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621681925662"><span class="hs-identifier hs-var">thenCmpTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925665"><span class="hs-identifier hs-var">gos</span></a><span> </span><a href="#local-6989586621681925700"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925702"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-6989586621681925704"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-2586"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-6989586621681925705"><a href="#local-6989586621681925705"><span class="hs-identifier">l1</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-6989586621681925706"><a href="#local-6989586621681925706"><span class="hs-identifier">l2</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925661"><span class="hs-identifier hs-var">liftOrdering</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">compare</span><span> </span><a href="#local-6989586621681925705"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621681925706"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2587"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925707"><a href="#local-6989586621681925707"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925708"><a href="#local-6989586621681925708"><span class="hs-identifier">t1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><a name="local-6989586621681925709"><a href="#local-6989586621681925709"><span class="hs-identifier">t2</span></a></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925663"><span class="hs-identifier hs-var">hasCast</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925707"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925708"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925709"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2588"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925710"><a href="#local-6989586621681925710"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681925711"><a href="#local-6989586621681925711"><span class="hs-identifier">t1</span></a></a><span>                  </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925712"><a href="#local-6989586621681925712"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925663"><span class="hs-identifier hs-var">hasCast</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925710"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925711"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925712"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2589"></a><span>
</span><a name="line-2590"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TEQ"><span class="hs-identifier hs-var">TEQ</span></a><span>
</span><a name="line-2591"></a><span>
</span><a name="line-2592"></a><span>        </span><span class="hs-comment">-- Deal with the rest: TyVarTy &lt; CoercionTy &lt; AppTy &lt; LitTy &lt; TyConApp &lt; ForAllTy</span><span>
</span><a name="line-2593"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925713"><a href="#local-6989586621681925713"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925714"><a href="#local-6989586621681925714"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-2594"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925661"><span class="hs-identifier hs-var">liftOrdering</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925715"><span class="hs-identifier hs-var">get_rank</span></a><span> </span><a href="#local-6989586621681925713"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925715"><span class="hs-identifier hs-var">get_rank</span></a><span> </span><a href="#local-6989586621681925714"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2595"></a><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-identifier">get_rank</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-2596"></a><span>            </span><a name="local-6989586621681925715"><a href="#local-6989586621681925715"><span class="hs-identifier">get_rank</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2597"></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;nonDetCmpTypeX.get_rank&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925713"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">,</span><a href="#local-6989586621681925714"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2598"></a><span>            </span><span class="hs-identifier">get_rank</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2599"></a><span>            </span><span class="hs-identifier">get_rank</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2600"></a><span>            </span><span class="hs-identifier">get_rank</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-2601"></a><span>            </span><span class="hs-identifier">get_rank</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-2602"></a><span>            </span><span class="hs-identifier">get_rank</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-2603"></a><span>            </span><span class="hs-identifier">get_rank</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-2604"></a><span>            </span><span class="hs-identifier">get_rank</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-2605"></a><span>
</span><a name="line-2606"></a><span>    </span><span class="hs-identifier">gos</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#TypeOrdering"><span class="hs-identifier hs-type">TypeOrdering</span></a><span>
</span><a name="line-2607"></a><span>    </span><a name="local-6989586621681925665"><a href="#local-6989586621681925665"><span class="hs-identifier">gos</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TEQ"><span class="hs-identifier hs-var">TEQ</span></a><span>
</span><a name="line-2608"></a><span>    </span><span class="hs-identifier">gos</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TLT"><span class="hs-identifier hs-var">TLT</span></a><span>
</span><a name="line-2609"></a><span>    </span><span class="hs-identifier">gos</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#TGT"><span class="hs-identifier hs-var">TGT</span></a><span>
</span><a name="line-2610"></a><span>    </span><span class="hs-identifier">gos</span><span> </span><a name="local-6989586621681925716"><a href="#local-6989586621681925716"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681925717"><a href="#local-6989586621681925717"><span class="hs-identifier">ty1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925718"><a href="#local-6989586621681925718"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925719"><a href="#local-6989586621681925719"><span class="hs-identifier">ty2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925720"><a href="#local-6989586621681925720"><span class="hs-identifier">tys2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925664"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925716"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925717"><span class="hs-identifier hs-var">ty1</span></a><span> </span><a href="#local-6989586621681925719"><span class="hs-identifier hs-var">ty2</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621681925662"><span class="hs-identifier hs-var">thenCmpTy</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925665"><span class="hs-identifier hs-var">gos</span></a><span> </span><a href="#local-6989586621681925716"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925718"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-6989586621681925720"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-2611"></a><span>
</span><a name="line-2612"></a><span class="hs-comment">-------------</span><span>
</span><a name="line-2613"></a><span class="hs-identifier">nonDetCmpTypesX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarEnv.html#RnEnv2"><span class="hs-identifier hs-type">RnEnv2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-2614"></a><a name="nonDetCmpTypesX"><a href="Type.html#nonDetCmpTypesX"><span class="hs-identifier">nonDetCmpTypesX</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-2615"></a><span class="hs-identifier">nonDetCmpTypesX</span><span> </span><a name="local-6989586621681925722"><a href="#local-6989586621681925722"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681925723"><a href="#local-6989586621681925723"><span class="hs-identifier">t1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925724"><a href="#local-6989586621681925724"><span class="hs-identifier">tys1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681925725"><a href="#local-6989586621681925725"><span class="hs-identifier">t2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681925726"><a href="#local-6989586621681925726"><span class="hs-identifier">tys2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#nonDetCmpTypeX"><span class="hs-identifier hs-var">nonDetCmpTypeX</span></a><span> </span><a href="#local-6989586621681925722"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925723"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621681925725"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2616"></a><span>                                          </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span>
</span><a name="line-2617"></a><span>                                          </span><a href="Type.html#nonDetCmpTypesX"><span class="hs-identifier hs-var">nonDetCmpTypesX</span></a><span> </span><a href="#local-6989586621681925722"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925724"><span class="hs-identifier hs-var">tys1</span></a><span> </span><a href="#local-6989586621681925726"><span class="hs-identifier hs-var">tys2</span></a><span>
</span><a name="line-2618"></a><span class="hs-identifier">nonDetCmpTypesX</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-2619"></a><span class="hs-identifier">nonDetCmpTypesX</span><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier">_</span><span>         </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-2620"></a><span>
</span><a name="line-2621"></a><span class="hs-comment">-------------</span><span>
</span><a name="line-2622"></a><span class="hs-comment">-- | Compare two 'TyCon's. NB: This should /never/ see 'Constraint' (as</span><span>
</span><a name="line-2623"></a><span class="hs-comment">-- recognized by Kind.isConstraintKindCon) which is considered a synonym for</span><span>
</span><a name="line-2624"></a><span class="hs-comment">-- 'Type' in Core.</span><span>
</span><a name="line-2625"></a><span class="hs-comment">-- See Note [Kind Constraint and kind Type] in Kind.</span><span>
</span><a name="line-2626"></a><span class="hs-comment">-- See Note [nonDetCmpType nondeterminism]</span><span>
</span><a name="line-2627"></a><span class="hs-identifier">nonDetCmpTc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-2628"></a><a name="nonDetCmpTc"><a href="Type.html#nonDetCmpTc"><span class="hs-identifier">nonDetCmpTc</span></a></a><span> </span><a name="local-6989586621681925727"><a href="#local-6989586621681925727"><span class="hs-identifier">tc1</span></a></a><span> </span><a name="local-6989586621681925728"><a href="#local-6989586621681925728"><span class="hs-identifier">tc2</span></a></a><span>
</span><a name="line-2629"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">isConstraintKindCon</span><span> </span><a href="Kind.html#isConstraintKindCon"><span class="hs-identifier hs-var">tc1</span></a><span class="hs-special">)</span><span> </span><a href="Kind.html#isConstraintKindCon"><span class="hs-operator hs-var">&amp;&amp;</span></a><span> </span><a href="Kind.html#isConstraintKindCon"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">isConstraintKindCon</span><span> </span><a href="Kind.html#isConstraintKindCon"><span class="hs-identifier hs-var">tc2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2630"></a><span>    </span><a href="#local-6989586621681925729"><span class="hs-identifier hs-var">u1</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#nonDetCmpUnique"><span class="hs-identifier hs-var">nonDetCmpUnique</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925730"><span class="hs-identifier hs-var">u2</span></a><span>
</span><a name="line-2631"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2632"></a><span>    </span><a name="local-6989586621681925729"><a href="#local-6989586621681925729"><span class="hs-identifier">u1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConUnique</span><span> </span><a href="#local-6989586621681925727"><span class="hs-identifier hs-var">tc1</span></a><span>
</span><a name="line-2633"></a><span>    </span><a name="local-6989586621681925730"><a href="#local-6989586621681925730"><span class="hs-identifier">u2</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tyConUnique</span><span> </span><a href="#local-6989586621681925728"><span class="hs-identifier hs-var">tc2</span></a><span>
</span><a name="line-2634"></a><span>
</span><a name="line-2635"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        The kind of a type
*                                                                      *
************************************************************************

Note [typeKind vs tcTypeKind]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We have two functions to get the kind of a type

  * typeKind   ignores  the distinction between Constraint and *
  * tcTypeKind respects the distinction between Constraint and *

tcTypeKind is used by the type inference engine, for which Constraint
and * are different; after that we use typeKind.

See also Note [coreView vs tcView]

Note [Kinding rules for types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In typeKind we consider Constraint and (TYPE LiftedRep) to be identical.
We then have

         t1 : TYPE rep1
         t2 : TYPE rep2
   (FUN) ----------------
         t1 -&gt; t2 : Type

         ty : TYPE rep
         `a` is not free in rep
(FORALL) -----------------------
         forall a. ty : TYPE rep

In tcTypeKind we consider Constraint and (TYPE LiftedRep) to be distinct:

          t1 : TYPE rep1
          t2 : TYPE rep2
    (FUN) ----------------
          t1 -&gt; t2 : Type

          t1 : Constraint
          t2 : TYPE rep
  (PRED1) ----------------
          t1 =&gt; t2 : Type

          t1 : Constraint
          t2 : Constraint
  (PRED2) ---------------------
          t1 =&gt; t2 : Constraint

          ty : TYPE rep
          `a` is not free in rep
(FORALL1) -----------------------
          forall a. ty : TYPE rep

          ty : Constraint
(FORALL2) -------------------------
          forall a. ty : Constraint

Note that:
* The only way we distinguish '-&gt;' from '=&gt;' is by the fact
  that the argument is a PredTy.  Both are FunTys
-}</span><span>
</span><a name="line-2699"></a><span>
</span><a name="line-2700"></a><span class="hs-comment">-----------------------------</span><span>
</span><a name="line-2701"></a><span class="hs-identifier">typeKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-2702"></a><a name="typeKind"><a href="Type.html#typeKind"><span class="hs-identifier">typeKind</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925731"><a href="#local-6989586621681925731"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925732"><a href="#local-6989586621681925732"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621681925731"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925732"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2703"></a><span class="hs-identifier">typeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-6989586621681925733"><a href="#local-6989586621681925733"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeLiteralKind"><span class="hs-identifier hs-var">typeLiteralKind</span></a><span> </span><a href="#local-6989586621681925733"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-2704"></a><span class="hs-identifier">typeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-2705"></a><span class="hs-identifier">typeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681925734"><a href="#local-6989586621681925734"><span class="hs-identifier">tyvar</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621681925734"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-2706"></a><span class="hs-identifier">typeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925735"><a href="#local-6989586621681925735"><span class="hs-identifier">_ty</span></a></a><span> </span><a name="local-6989586621681925736"><a href="#local-6989586621681925736"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pSnd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621681925736"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2707"></a><span class="hs-identifier">typeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621681925737"><a href="#local-6989586621681925737"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a><span> </span><a href="#local-6989586621681925737"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2708"></a><span>
</span><a name="line-2709"></a><span class="hs-identifier">typeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925738"><a href="#local-6989586621681925738"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621681925739"><a href="#local-6989586621681925739"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2710"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925740"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925738"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925739"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span>
</span><a name="line-2711"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2712"></a><span>    </span><span class="hs-comment">-- Accumulate the type arugments, so we can call piResultTys,</span><span>
</span><a name="line-2713"></a><span>    </span><span class="hs-comment">-- rather than a succession of calls to piResultTy (which is</span><span>
</span><a name="line-2714"></a><span>    </span><span class="hs-comment">-- asymptotically costly as the number of arguments increases)</span><span>
</span><a name="line-2715"></a><span>    </span><a name="local-6989586621681925740"><a href="#local-6989586621681925740"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925741"><a href="#local-6989586621681925741"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621681925742"><a href="#local-6989586621681925742"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925743"><a href="#local-6989586621681925743"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925740"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925741"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925742"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925743"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-2716"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925744"><a href="#local-6989586621681925744"><span class="hs-identifier">fun</span></a></a><span>             </span><a name="local-6989586621681925745"><a href="#local-6989586621681925745"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925744"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925745"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2717"></a><span>
</span><a name="line-2718"></a><span class="hs-identifier">typeKind</span><span> </span><a name="local-6989586621681925746"><a href="#local-6989586621681925746"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2719"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#occCheckExpand"><span class="hs-identifier hs-var">occCheckExpand</span></a><span> </span><a href="#local-6989586621681925747"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621681925749"><span class="hs-identifier hs-var">body_kind</span></a><span> </span><span class="hs-keyword">of</span><span>   </span><span class="hs-comment">-- We must make sure tv does not occur in kind</span><span>
</span><a name="line-2720"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925750"><a href="#local-6989586621681925750"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925750"><span class="hs-identifier hs-var">k'</span></a><span>                        </span><span class="hs-comment">-- As it is already out of scope!</span><span>
</span><a name="line-2721"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;typeKind&quot;</span><span>
</span><a name="line-2722"></a><span>                  </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925746"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925747"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925748"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925749"><span class="hs-identifier hs-var">body_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2723"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2724"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621681925747"><a href="#local-6989586621681925747"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925748"><a href="#local-6989586621681925748"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitTyVarForAllTys"><span class="hs-identifier hs-var">splitTyVarForAllTys</span></a><span> </span><a href="#local-6989586621681925746"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2725"></a><span>    </span><a name="local-6989586621681925749"><a href="#local-6989586621681925749"><span class="hs-identifier">body_kind</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span> </span><a href="#local-6989586621681925748"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-2726"></a><span>
</span><a name="line-2727"></a><span class="hs-comment">-----------------------------</span><span>
</span><a name="line-2728"></a><span class="hs-identifier">tcTypeKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-2729"></a><a name="tcTypeKind"><a href="Type.html#tcTypeKind"><span class="hs-identifier">tcTypeKind</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925751"><a href="#local-6989586621681925751"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925752"><a href="#local-6989586621681925752"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621681925751"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925752"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2730"></a><span class="hs-identifier">tcTypeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><a name="local-6989586621681925753"><a href="#local-6989586621681925753"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#typeLiteralKind"><span class="hs-identifier hs-var">typeLiteralKind</span></a><span> </span><a href="#local-6989586621681925753"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-2731"></a><span class="hs-identifier">tcTypeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681925754"><a href="#local-6989586621681925754"><span class="hs-identifier">tyvar</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621681925754"><span class="hs-identifier hs-var">tyvar</span></a><span>
</span><a name="line-2732"></a><span class="hs-identifier">tcTypeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925755"><a href="#local-6989586621681925755"><span class="hs-identifier">_ty</span></a></a><span> </span><a name="local-6989586621681925756"><a href="#local-6989586621681925756"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pSnd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621681925756"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2733"></a><span class="hs-identifier">tcTypeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621681925757"><a href="#local-6989586621681925757"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Coercion.html#coercionType"><span class="hs-identifier hs-var">coercionType</span></a><span> </span><a href="#local-6989586621681925757"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2734"></a><span>
</span><a name="line-2735"></a><span class="hs-identifier">tcTypeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925758"><a href="#local-6989586621681925758"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621681925759"><a href="#local-6989586621681925759"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2736"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621681925758"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Type.html#isPredTy"><span class="hs-identifier hs-var">isPredTy</span></a><span> </span><a href="#local-6989586621681925759"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-2737"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a><span>
</span><a name="line-2738"></a><span>
</span><a name="line-2739"></a><span class="hs-identifier">tcTypeKind</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925760"><a href="#local-6989586621681925760"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621681925761"><a href="#local-6989586621681925761"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2740"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925762"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925760"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681925761"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span>
</span><a name="line-2741"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2742"></a><span>    </span><span class="hs-comment">-- Accumulate the type arugments, so we can call piResultTys,</span><span>
</span><a name="line-2743"></a><span>    </span><span class="hs-comment">-- rather than a succession of calls to piResultTy (which is</span><span>
</span><a name="line-2744"></a><span>    </span><span class="hs-comment">-- asymptotically costly as the number of arguments increases)</span><span>
</span><a name="line-2745"></a><span>    </span><a name="local-6989586621681925762"><a href="#local-6989586621681925762"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925763"><a href="#local-6989586621681925763"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621681925764"><a href="#local-6989586621681925764"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925765"><a href="#local-6989586621681925765"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925762"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925763"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925764"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681925765"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-2746"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925766"><a href="#local-6989586621681925766"><span class="hs-identifier">fun</span></a></a><span>             </span><a name="local-6989586621681925767"><a href="#local-6989586621681925767"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a><span> </span><a href="#local-6989586621681925766"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925767"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2747"></a><span>
</span><a name="line-2748"></a><span class="hs-identifier">tcTypeKind</span><span> </span><a name="local-6989586621681925768"><a href="#local-6989586621681925768"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2749"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#tcIsConstraintKind"><span class="hs-identifier hs-var">tcIsConstraintKind</span></a><span> </span><a href="#local-6989586621681925771"><span class="hs-identifier hs-var">body_kind</span></a><span>
</span><a name="line-2750"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a><span>
</span><a name="line-2751"></a><span>
</span><a name="line-2752"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2753"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#occCheckExpand"><span class="hs-identifier hs-var">occCheckExpand</span></a><span> </span><a href="#local-6989586621681925769"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="#local-6989586621681925771"><span class="hs-identifier hs-var">body_kind</span></a><span> </span><span class="hs-keyword">of</span><span>   </span><span class="hs-comment">-- We must make sure tv does not occur in kind</span><span>
</span><a name="line-2754"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925772"><a href="#local-6989586621681925772"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925772"><span class="hs-identifier hs-var">k'</span></a><span>                        </span><span class="hs-comment">-- As it is already out of scope!</span><span>
</span><a name="line-2755"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tcTypeKind&quot;</span><span>
</span><a name="line-2756"></a><span>                  </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925768"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925769"><span class="hs-identifier hs-var">tvs</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925770"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925771"><span class="hs-identifier hs-var">body_kind</span></a><span class="hs-special">)</span><span>
</span><a name="line-2757"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2758"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621681925769"><a href="#local-6989586621681925769"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681925770"><a href="#local-6989586621681925770"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitTyVarForAllTys"><span class="hs-identifier hs-var">splitTyVarForAllTys</span></a><span> </span><a href="#local-6989586621681925768"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2759"></a><span>    </span><a name="local-6989586621681925771"><a href="#local-6989586621681925771"><span class="hs-identifier">body_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a><span> </span><a href="#local-6989586621681925770"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-2760"></a><span>
</span><a name="line-2761"></a><span>
</span><a name="line-2762"></a><span class="hs-identifier">isPredTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2763"></a><span class="hs-comment">-- See Note [Types for coercions, predicates, and evidence]</span><span>
</span><a name="line-2764"></a><a name="isPredTy"><a href="Type.html#isPredTy"><span class="hs-identifier">isPredTy</span></a></a><span> </span><a name="local-6989586621681925773"><a href="#local-6989586621681925773"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tcIsConstraintKind"><span class="hs-identifier hs-var">tcIsConstraintKind</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a><span> </span><a href="#local-6989586621681925773"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2765"></a><span>
</span><a name="line-2766"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-2767"></a><span class="hs-identifier">typeLiteralKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyLit"><span class="hs-identifier hs-type">TyLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-2768"></a><a name="typeLiteralKind"><a href="Type.html#typeLiteralKind"><span class="hs-identifier">typeLiteralKind</span></a></a><span> </span><a name="local-6989586621681925774"><a href="#local-6989586621681925774"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2769"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681925774"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2770"></a><span>    </span><a href="TyCoRep.html#NumTyLit"><span class="hs-identifier hs-var">NumTyLit</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TysWiredIn.html#typeNatKind"><span class="hs-identifier hs-var">typeNatKind</span></a><span>
</span><a name="line-2771"></a><span>    </span><a href="TyCoRep.html#StrTyLit"><span class="hs-identifier hs-var">StrTyLit</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TysWiredIn.html#typeSymbolKind"><span class="hs-identifier hs-var">typeSymbolKind</span></a><span>
</span><a name="line-2772"></a><span>
</span><a name="line-2773"></a><span class="hs-comment">-- | Returns True if a type is levity polymorphic. Should be the same</span><span>
</span><a name="line-2774"></a><span class="hs-comment">-- as (isKindLevPoly . typeKind) but much faster.</span><span>
</span><a name="line-2775"></a><span class="hs-comment">-- Precondition: The type has kind (TYPE blah)</span><span>
</span><a name="line-2776"></a><span class="hs-identifier">isTypeLevPoly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2777"></a><a name="isTypeLevPoly"><a href="Type.html#isTypeLevPoly"><span class="hs-identifier">isTypeLevPoly</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925775"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-2778"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2779"></a><span>    </span><a name="local-6989586621681925775"><a href="#local-6989586621681925775"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925777"><a href="#local-6989586621681925777"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925776"><span class="hs-identifier hs-var">check_kind</span></a><span> </span><a href="#local-6989586621681925777"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2780"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925778"><a href="#local-6989586621681925778"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925776"><span class="hs-identifier hs-var">check_kind</span></a><span> </span><a href="#local-6989586621681925778"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2781"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925779"><a href="#local-6989586621681925779"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925780"><a href="#local-6989586621681925780"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#isTcLevPoly"><span class="hs-identifier hs-var">isTcLevPoly</span></a><span> </span><a href="#local-6989586621681925780"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2782"></a><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925776"><span class="hs-identifier hs-var">check_kind</span></a><span> </span><a href="#local-6989586621681925779"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2783"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925781"><a href="#local-6989586621681925781"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925775"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925781"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2784"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2785"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2786"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925782"><a href="#local-6989586621681925782"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925776"><span class="hs-identifier hs-var">check_kind</span></a><span> </span><a href="#local-6989586621681925782"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2787"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925783"><a href="#local-6989586621681925783"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;isTypeLevPoly co&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681925783"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2788"></a><span>
</span><a name="line-2789"></a><span>    </span><a name="local-6989586621681925776"><a href="#local-6989586621681925776"><span class="hs-identifier">check_kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Kind.html#isKindLevPoly"><span class="hs-identifier hs-var">isKindLevPoly</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Type.html#typeKind"><span class="hs-identifier hs-var">typeKind</span></a><span>
</span><a name="line-2790"></a><span>
</span><a name="line-2791"></a><span class="hs-comment">-- | Looking past all pi-types, is the end result potentially levity polymorphic?</span><span>
</span><a name="line-2792"></a><span class="hs-comment">-- Example: True for (forall r (a :: TYPE r). String -&gt; a)</span><span>
</span><a name="line-2793"></a><span class="hs-comment">-- Example: False for (forall r1 r2 (a :: TYPE r1) (b :: TYPE r2). a -&gt; b -&gt; Type)</span><span>
</span><a name="line-2794"></a><span class="hs-identifier">resultIsLevPoly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2795"></a><a name="resultIsLevPoly"><a href="Type.html#resultIsLevPoly"><span class="hs-identifier">resultIsLevPoly</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isTypeLevPoly"><span class="hs-identifier hs-var">isTypeLevPoly</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a><span>
</span><a name="line-2796"></a><span>
</span><a name="line-2797"></a><span>
</span><a name="line-2798"></a><span class="hs-comment">{- **********************************************************************
*                                                                       *
           Occurs check expansion
%*                                                                      *
%********************************************************************* -}</span><span>
</span><a name="line-2803"></a><span>
</span><a name="line-2804"></a><span class="hs-comment">{- Note [Occurs check expansion]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
(occurCheckExpand tv xi) expands synonyms in xi just enough to get rid
of occurrences of tv outside type function arguments, if that is
possible; otherwise, it returns Nothing.

For example, suppose we have
  type F a b = [a]
Then
  occCheckExpand b (F Int b) = Just [Int]
but
  occCheckExpand a (F a Int) = Nothing

We don't promise to do the absolute minimum amount of expanding
necessary, but we try not to do expansions we don't need to.  We
prefer doing inner expansions first.  For example,
  type F a b = (a, Int, a, [a])
  type G b   = Char
We have
  occCheckExpand b (F (G b)) = Just (F Char)
even though we could also expand F to get rid of b.
-}</span><span>
</span><a name="line-2826"></a><span>
</span><a name="line-2827"></a><span class="hs-identifier">occCheckExpand</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2828"></a><span class="hs-comment">-- See Note [Occurs check expansion]</span><span>
</span><a name="line-2829"></a><span class="hs-comment">-- We may have needed to do some type synonym unfolding in order to</span><span>
</span><a name="line-2830"></a><span class="hs-comment">-- get rid of the variable (or forall), so we also return the unfolded</span><span>
</span><a name="line-2831"></a><span class="hs-comment">-- version of the type, which is guaranteed to be syntactically free</span><span>
</span><a name="line-2832"></a><span class="hs-comment">-- of the given type variable.  If the type is already syntactically</span><span>
</span><a name="line-2833"></a><span class="hs-comment">-- free of the variable, then the same type is returned.</span><span>
</span><a name="line-2834"></a><a name="occCheckExpand"><a href="Type.html#occCheckExpand"><span class="hs-identifier">occCheckExpand</span></a></a><span> </span><a name="local-6989586621681925784"><a href="#local-6989586621681925784"><span class="hs-identifier">vs_to_avoid</span></a></a><span> </span><a name="local-6989586621681925785"><a href="#local-6989586621681925785"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2835"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="VarSet.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a><span> </span><a href="#local-6989586621681925784"><span class="hs-identifier hs-var">vs_to_avoid</span></a><span class="hs-special">,</span><span> </span><a href="VarEnv.html#emptyVarEnv"><span class="hs-identifier hs-var">emptyVarEnv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925785"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2836"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2837"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span class="hs-special">,</span><span> </span><a href="VarEnv.html#VarEnv"><span class="hs-identifier hs-type">VarEnv</span></a><span> </span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2838"></a><span>          </span><span class="hs-comment">-- The VarSet is the set of variables we are trying to avoid</span><span>
</span><a name="line-2839"></a><span>          </span><span class="hs-comment">-- The VarEnv carries mappings necessary</span><span>
</span><a name="line-2840"></a><span>          </span><span class="hs-comment">-- because of kind expansion</span><span>
</span><a name="line-2841"></a><span>    </span><a name="local-6989586621681925786"><a href="#local-6989586621681925786"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925791"><a href="#local-6989586621681925791"><span class="hs-identifier">cxt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-keyword">as</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681925793"><a href="#local-6989586621681925793"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681925794"><a href="#local-6989586621681925794"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2842"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925794"><span class="hs-identifier hs-var">tv'</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><span class="hs-keyword">as</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2843"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925795"><a href="#local-6989586621681925795"><span class="hs-identifier">tv''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-6989586621681925793"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925794"><span class="hs-identifier hs-var">tv'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-6989586621681925795"><span class="hs-identifier hs-var">tv''</span></a><span class="hs-special">)</span><span>
</span><a name="line-2844"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925796"><a href="#local-6989586621681925796"><span class="hs-identifier">tv''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925787"><span class="hs-identifier hs-var">go_var</span></a><span> </span><a href="#local-6989586621681925791"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925794"><span class="hs-identifier hs-var">tv'</span></a><span>
</span><a name="line-2845"></a><span>                                               </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-6989586621681925796"><span class="hs-identifier hs-var">tv''</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2846"></a><span>
</span><a name="line-2847"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>   </span><a name="local-6989586621681925797"><a href="#local-6989586621681925797"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681925797"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2848"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925798"><a href="#local-6989586621681925798"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925799"><a href="#local-6989586621681925799"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925800"><a href="#local-6989586621681925800"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925801"><a href="#local-6989586621681925801"><span class="hs-identifier">ty1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925798"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925799"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-2849"></a><span>                                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925802"><a href="#local-6989586621681925802"><span class="hs-identifier">ty2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925798"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925800"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2850"></a><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a><span> </span><a href="#local-6989586621681925801"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-6989586621681925802"><span class="hs-identifier hs-var">ty2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2851"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925803"><a href="#local-6989586621681925803"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925804"><a href="#local-6989586621681925804"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925805"><a href="#local-6989586621681925805"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925806"><a href="#local-6989586621681925806"><span class="hs-identifier">ty1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925803"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925804"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-2852"></a><span>                                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925807"><a href="#local-6989586621681925807"><span class="hs-identifier">ty2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925803"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925805"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2853"></a><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><a href="#local-6989586621681925806"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-6989586621681925807"><span class="hs-identifier hs-var">ty2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2854"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925808"><a href="#local-6989586621681925808"><span class="hs-identifier">cxt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-keyword">as</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681925810"><a href="#local-6989586621681925810"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925811"><a href="#local-6989586621681925811"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681925812"><a href="#local-6989586621681925812"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681925813"><a href="#local-6989586621681925813"><span class="hs-identifier">body_ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2855"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925814"><a href="#local-6989586621681925814"><span class="hs-identifier">ki'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925808"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925811"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2856"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681925815"><a href="#local-6989586621681925815"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a><span> </span><a href="#local-6989586621681925811"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681925814"><span class="hs-identifier hs-var">ki'</span></a><span>
</span><a name="line-2857"></a><span>                  </span><a name="local-6989586621681925816"><a href="#local-6989586621681925816"><span class="hs-identifier">env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-6989586621681925810"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925811"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681925815"><span class="hs-identifier hs-var">tv'</span></a><span>
</span><a name="line-2858"></a><span>                  </span><a name="local-6989586621681925817"><a href="#local-6989586621681925817"><span class="hs-identifier">as'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">`</span><a href="VarSet.html#delVarSet"><span class="hs-identifier hs-var">delVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925811"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2859"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925818"><a href="#local-6989586621681925818"><span class="hs-identifier">body'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925817"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925816"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925813"><span class="hs-identifier hs-var">body_ty</span></a><span>
</span><a name="line-2860"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a href="#local-6989586621681925815"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681925812"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925818"><span class="hs-identifier hs-var">body'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2861"></a><span>
</span><a name="line-2862"></a><span>    </span><span class="hs-comment">-- For a type constructor application, first try expanding away the</span><span>
</span><a name="line-2863"></a><span>    </span><span class="hs-comment">-- offending variable from the arguments.  If that doesn't work, next</span><span>
</span><a name="line-2864"></a><span>    </span><span class="hs-comment">-- see if the type constructor is a type synonym, and if so, expand</span><span>
</span><a name="line-2865"></a><span>    </span><span class="hs-comment">-- it and try again.</span><span>
</span><a name="line-2866"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925819"><a href="#local-6989586621681925819"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621681925820"><a href="#local-6989586621681925820"><span class="hs-identifier">ty</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925821"><a href="#local-6989586621681925821"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925822"><a href="#local-6989586621681925822"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2867"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925819"><span class="hs-identifier hs-var">cxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925822"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2868"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925823"><a href="#local-6989586621681925823"><span class="hs-identifier">tys'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a><span> </span><a href="#local-6989586621681925821"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681925823"><span class="hs-identifier hs-var">tys'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2869"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925824"><a href="#local-6989586621681925824"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcView"><span class="hs-identifier hs-var">tcView</span></a><span> </span><a href="#local-6989586621681925820"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925819"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925824"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-2870"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2871"></a><span>                      </span><span class="hs-comment">-- Failing that, try to expand a synonym</span><span>
</span><a name="line-2872"></a><span>
</span><a name="line-2873"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925825"><a href="#local-6989586621681925825"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925826"><a href="#local-6989586621681925826"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925827"><a href="#local-6989586621681925827"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925828"><a href="#local-6989586621681925828"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925825"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925826"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2874"></a><span>                                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925829"><a href="#local-6989586621681925829"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925825"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925827"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2875"></a><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkCastTy"><span class="hs-identifier hs-var">mkCastTy</span></a><span> </span><a href="#local-6989586621681925828"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925829"><span class="hs-identifier hs-var">co'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2876"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681925830"><a href="#local-6989586621681925830"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621681925831"><a href="#local-6989586621681925831"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925832"><a href="#local-6989586621681925832"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925830"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925831"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2877"></a><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Type.html#mkCoercionTy"><span class="hs-identifier hs-var">mkCoercionTy</span></a><span> </span><a href="#local-6989586621681925832"><span class="hs-identifier hs-var">co'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2878"></a><span>
</span><a name="line-2879"></a><span>    </span><span class="hs-comment">------------------</span><span>
</span><a name="line-2880"></a><span>    </span><a name="local-6989586621681925787"><a href="#local-6989586621681925787"><span class="hs-identifier">go_var</span></a></a><span> </span><a name="local-6989586621681925833"><a href="#local-6989586621681925833"><span class="hs-identifier">cxt</span></a></a><span> </span><a name="local-6989586621681925834"><a href="#local-6989586621681925834"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925835"><a href="#local-6989586621681925835"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925833"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925834"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-2881"></a><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a><span> </span><a href="#local-6989586621681925834"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621681925835"><span class="hs-identifier hs-var">k'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2882"></a><span>           </span><span class="hs-comment">-- Works for TyVar and CoVar</span><span>
</span><a name="line-2883"></a><span>           </span><span class="hs-comment">-- See Note [Occurrence checking: look inside kinds]</span><span>
</span><a name="line-2884"></a><span>
</span><a name="line-2885"></a><span>    </span><span class="hs-comment">------------------</span><span>
</span><a name="line-2886"></a><span>    </span><a name="local-6989586621681925788"><a href="#local-6989586621681925788"><span class="hs-identifier">go_mco</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><a href="TyCoRep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="TyCoRep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a><span>
</span><a name="line-2887"></a><span>    </span><span class="hs-identifier">go_mco</span><span> </span><a name="local-6989586621681925836"><a href="#local-6989586621681925836"><span class="hs-identifier">ctx</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a><span> </span><a name="local-6989586621681925837"><a href="#local-6989586621681925837"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925836"><span class="hs-identifier hs-var">ctx</span></a><span> </span><a href="#local-6989586621681925837"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2888"></a><span>
</span><a name="line-2889"></a><span>    </span><span class="hs-comment">------------------</span><span>
</span><a name="line-2890"></a><span>    </span><a name="local-6989586621681925789"><a href="#local-6989586621681925789"><span class="hs-identifier">go_co</span></a></a><span> </span><a name="local-6989586621681925838"><a href="#local-6989586621681925838"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621681925839"><a href="#local-6989586621681925839"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925840"><a href="#local-6989586621681925840"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925838"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925839"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2891"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNomReflCo"><span class="hs-identifier hs-var">mkNomReflCo</span></a><span> </span><a href="#local-6989586621681925840"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2892"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925841"><a href="#local-6989586621681925841"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a><span> </span><a name="local-6989586621681925842"><a href="#local-6989586621681925842"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681925843"><a href="#local-6989586621681925843"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925844"><a href="#local-6989586621681925844"><span class="hs-identifier">mco</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925845"><a href="#local-6989586621681925845"><span class="hs-identifier">mco'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925788"><span class="hs-identifier hs-var">go_mco</span></a><span> </span><a href="#local-6989586621681925841"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925844"><span class="hs-identifier hs-var">mco</span></a><span>
</span><a name="line-2893"></a><span>                                             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925846"><a href="#local-6989586621681925846"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925841"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925843"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2894"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkGReflCo"><span class="hs-identifier hs-var">mkGReflCo</span></a><span> </span><a href="#local-6989586621681925842"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681925846"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681925845"><span class="hs-identifier hs-var">mco'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2895"></a><span>      </span><span class="hs-comment">-- Note: Coercions do not contain type synonyms</span><span>
</span><a name="line-2896"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925847"><a href="#local-6989586621681925847"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><a name="local-6989586621681925848"><a href="#local-6989586621681925848"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681925849"><a href="#local-6989586621681925849"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925850"><a href="#local-6989586621681925850"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925851"><a href="#local-6989586621681925851"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925847"><span class="hs-identifier hs-var">cxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925850"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2897"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkTyConAppCo"><span class="hs-identifier hs-var">mkTyConAppCo</span></a><span> </span><a href="#local-6989586621681925848"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681925849"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681925851"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2898"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925852"><a href="#local-6989586621681925852"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621681925853"><a href="#local-6989586621681925853"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621681925854"><a href="#local-6989586621681925854"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925855"><a href="#local-6989586621681925855"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925852"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925853"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2899"></a><span>                                             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925856"><a href="#local-6989586621681925856"><span class="hs-identifier">arg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925852"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925854"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2900"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkAppCo"><span class="hs-identifier hs-var">mkAppCo</span></a><span> </span><a href="#local-6989586621681925855"><span class="hs-identifier hs-var">co'</span></a><span> </span><a href="#local-6989586621681925856"><span class="hs-identifier hs-var">arg'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2901"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925857"><a href="#local-6989586621681925857"><span class="hs-identifier">cxt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-keyword">as</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681925859"><a href="#local-6989586621681925859"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a name="local-6989586621681925860"><a href="#local-6989586621681925860"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681925861"><a href="#local-6989586621681925861"><span class="hs-identifier">kind_co</span></a></a><span> </span><a name="local-6989586621681925862"><a href="#local-6989586621681925862"><span class="hs-identifier">body_co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2902"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925863"><a href="#local-6989586621681925863"><span class="hs-identifier">kind_co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925857"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925861"><span class="hs-identifier hs-var">kind_co</span></a><span>
</span><a name="line-2903"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681925864"><a href="#local-6989586621681925864"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setVarType"><span class="hs-identifier hs-var">setVarType</span></a><span> </span><a href="#local-6989586621681925860"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-2904"></a><span>                       </span><span class="hs-identifier">pFst</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#coercionKind"><span class="hs-identifier hs-var">coercionKind</span></a><span> </span><a href="#local-6989586621681925863"><span class="hs-identifier hs-var">kind_co'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2905"></a><span>                 </span><a name="local-6989586621681925865"><a href="#local-6989586621681925865"><span class="hs-identifier">env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarEnv.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a><span> </span><a href="#local-6989586621681925859"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925860"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681925864"><span class="hs-identifier hs-var">tv'</span></a><span>
</span><a name="line-2906"></a><span>                 </span><a name="local-6989586621681925866"><a href="#local-6989586621681925866"><span class="hs-identifier">as'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-special">`</span><a href="VarSet.html#delVarSet"><span class="hs-identifier hs-var">delVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925860"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-2907"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925867"><a href="#local-6989586621681925867"><span class="hs-identifier">body'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925866"><span class="hs-identifier hs-var">as'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681925865"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925862"><span class="hs-identifier hs-var">body_co</span></a><span>
</span><a name="line-2908"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><a href="#local-6989586621681925864"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681925863"><span class="hs-identifier hs-var">kind_co'</span></a><span> </span><a href="#local-6989586621681925867"><span class="hs-identifier hs-var">body'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2909"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925868"><a href="#local-6989586621681925868"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><a name="local-6989586621681925869"><a href="#local-6989586621681925869"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681925870"><a href="#local-6989586621681925870"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621681925871"><a href="#local-6989586621681925871"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925872"><a href="#local-6989586621681925872"><span class="hs-identifier">co1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925868"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925870"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-2910"></a><span>                                             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925873"><a href="#local-6989586621681925873"><span class="hs-identifier">co2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925868"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925871"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-2911"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkFunCo"><span class="hs-identifier hs-var">mkFunCo</span></a><span> </span><a href="#local-6989586621681925869"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681925872"><span class="hs-identifier hs-var">co1'</span></a><span> </span><a href="#local-6989586621681925873"><span class="hs-identifier hs-var">co2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2912"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925874"><a href="#local-6989586621681925874"><span class="hs-identifier">cxt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-keyword">as</span><span class="hs-special">,</span><a name="local-6989586621681925876"><a href="#local-6989586621681925876"><span class="hs-identifier">env</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><a name="local-6989586621681925877"><a href="#local-6989586621681925877"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2913"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681925877"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><span class="hs-keyword">as</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2914"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925878"><a href="#local-6989586621681925878"><span class="hs-identifier">c'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="VarEnv.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a><span> </span><a href="#local-6989586621681925876"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681925877"><span class="hs-identifier hs-var">c</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a><span> </span><a href="#local-6989586621681925878"><span class="hs-identifier hs-var">c'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2915"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925879"><a href="#local-6989586621681925879"><span class="hs-identifier">c'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925787"><span class="hs-identifier hs-var">go_var</span></a><span> </span><a href="#local-6989586621681925874"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925877"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-2916"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a><span> </span><a href="#local-6989586621681925879"><span class="hs-identifier hs-var">c'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2917"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925880"><a href="#local-6989586621681925880"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><a name="local-6989586621681925881"><a href="#local-6989586621681925881"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925882"><a href="#local-6989586621681925882"><span class="hs-identifier">c'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925787"><span class="hs-identifier hs-var">go_var</span></a><span> </span><a href="#local-6989586621681925880"><span class="hs-identifier hs-var">cxt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ch_co_var</span><span> </span><a href="#local-6989586621681925881"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-2918"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925881"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ch_co_var</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925882"><span class="hs-identifier hs-var">c'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2919"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925883"><a href="#local-6989586621681925883"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a name="local-6989586621681925884"><a href="#local-6989586621681925884"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621681925885"><a href="#local-6989586621681925885"><span class="hs-identifier">ind</span></a></a><span> </span><a name="local-6989586621681925886"><a href="#local-6989586621681925886"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925887"><a href="#local-6989586621681925887"><span class="hs-identifier">args'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925883"><span class="hs-identifier hs-var">cxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925886"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2920"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkAxiomInstCo"><span class="hs-identifier hs-var">mkAxiomInstCo</span></a><span> </span><a href="#local-6989586621681925884"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-6989586621681925885"><span class="hs-identifier hs-var">ind</span></a><span> </span><a href="#local-6989586621681925887"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2921"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925888"><a href="#local-6989586621681925888"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a name="local-6989586621681925889"><a href="#local-6989586621681925889"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621681925890"><a href="#local-6989586621681925890"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681925891"><a href="#local-6989586621681925891"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621681925892"><a href="#local-6989586621681925892"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925893"><a href="#local-6989586621681925893"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925790"><span class="hs-identifier hs-var">go_prov</span></a><span> </span><a href="#local-6989586621681925888"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925889"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-2922"></a><span>                                             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925894"><a href="#local-6989586621681925894"><span class="hs-identifier">ty1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925888"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925891"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-2923"></a><span>                                             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925895"><a href="#local-6989586621681925895"><span class="hs-identifier">ty2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925786"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925888"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925892"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-2924"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkUnivCo"><span class="hs-identifier hs-var">mkUnivCo</span></a><span> </span><a href="#local-6989586621681925893"><span class="hs-identifier hs-var">p'</span></a><span> </span><a href="#local-6989586621681925890"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681925894"><span class="hs-identifier hs-var">ty1'</span></a><span> </span><a href="#local-6989586621681925895"><span class="hs-identifier hs-var">ty2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2925"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925896"><a href="#local-6989586621681925896"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621681925897"><a href="#local-6989586621681925897"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925898"><a href="#local-6989586621681925898"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925896"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925897"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2926"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><a href="#local-6989586621681925898"><span class="hs-identifier hs-var">co'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2927"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925899"><a href="#local-6989586621681925899"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-6989586621681925900"><a href="#local-6989586621681925900"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621681925901"><a href="#local-6989586621681925901"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925902"><a href="#local-6989586621681925902"><span class="hs-identifier">co1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925899"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925900"><span class="hs-identifier hs-var">co1</span></a><span>
</span><a name="line-2928"></a><span>                                             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925903"><a href="#local-6989586621681925903"><span class="hs-identifier">co2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925899"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925901"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-2929"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkTransCo"><span class="hs-identifier hs-var">mkTransCo</span></a><span> </span><a href="#local-6989586621681925902"><span class="hs-identifier hs-var">co1'</span></a><span> </span><a href="#local-6989586621681925903"><span class="hs-identifier hs-var">co2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2930"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925904"><a href="#local-6989586621681925904"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><a name="local-6989586621681925905"><a href="#local-6989586621681925905"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681925906"><a href="#local-6989586621681925906"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681925907"><a href="#local-6989586621681925907"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925908"><a href="#local-6989586621681925908"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925904"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925907"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2931"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkNthCo"><span class="hs-identifier hs-var">mkNthCo</span></a><span> </span><a href="#local-6989586621681925905"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681925906"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621681925908"><span class="hs-identifier hs-var">co'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2932"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925909"><a href="#local-6989586621681925909"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><a name="local-6989586621681925910"><a href="#local-6989586621681925910"><span class="hs-identifier">lr</span></a></a><span> </span><a name="local-6989586621681925911"><a href="#local-6989586621681925911"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925912"><a href="#local-6989586621681925912"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925909"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925911"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2933"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkLRCo"><span class="hs-identifier hs-var">mkLRCo</span></a><span> </span><a href="#local-6989586621681925910"><span class="hs-identifier hs-var">lr</span></a><span> </span><a href="#local-6989586621681925912"><span class="hs-identifier hs-var">co'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2934"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925913"><a href="#local-6989586621681925913"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621681925914"><a href="#local-6989586621681925914"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621681925915"><a href="#local-6989586621681925915"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925916"><a href="#local-6989586621681925916"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925913"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925914"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2935"></a><span>                                             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681925917"><a href="#local-6989586621681925917"><span class="hs-identifier">arg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925913"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925915"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2936"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkInstCo"><span class="hs-identifier hs-var">mkInstCo</span></a><span> </span><a href="#local-6989586621681925916"><span class="hs-identifier hs-var">co'</span></a><span> </span><a href="#local-6989586621681925917"><span class="hs-identifier hs-var">arg'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2937"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925918"><a href="#local-6989586621681925918"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a name="local-6989586621681925919"><a href="#local-6989586621681925919"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925920"><a href="#local-6989586621681925920"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925918"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925919"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2938"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkKindCo"><span class="hs-identifier hs-var">mkKindCo</span></a><span> </span><a href="#local-6989586621681925920"><span class="hs-identifier hs-var">co'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2939"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925921"><a href="#local-6989586621681925921"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-6989586621681925922"><a href="#local-6989586621681925922"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925923"><a href="#local-6989586621681925923"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925921"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925922"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2940"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkSubCo"><span class="hs-identifier hs-var">mkSubCo</span></a><span> </span><a href="#local-6989586621681925923"><span class="hs-identifier hs-var">co'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2941"></a><span>    </span><span class="hs-identifier">go_co</span><span> </span><a name="local-6989586621681925924"><a href="#local-6989586621681925924"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><a name="local-6989586621681925925"><a href="#local-6989586621681925925"><span class="hs-identifier">ax</span></a></a><span> </span><a name="local-6989586621681925926"><a href="#local-6989586621681925926"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681925927"><a href="#local-6989586621681925927"><span class="hs-identifier">cs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925924"><span class="hs-identifier hs-var">cxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681925926"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-2942"></a><span>                                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkAxiomRuleCo"><span class="hs-identifier hs-var">mkAxiomRuleCo</span></a><span> </span><a href="#local-6989586621681925925"><span class="hs-identifier hs-var">ax</span></a><span> </span><a href="#local-6989586621681925927"><span class="hs-identifier hs-var">cs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2943"></a><span>
</span><a name="line-2944"></a><span>    </span><span class="hs-comment">------------------</span><span>
</span><a name="line-2945"></a><span>    </span><a name="local-6989586621681925790"><a href="#local-6989586621681925790"><span class="hs-identifier">go_prov</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>
</span><a name="line-2946"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><a name="local-6989586621681925928"><a href="#local-6989586621681925928"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a name="local-6989586621681925929"><a href="#local-6989586621681925929"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925928"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925929"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2947"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><a name="local-6989586621681925930"><a href="#local-6989586621681925930"><span class="hs-identifier">cxt</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a name="local-6989586621681925931"><a href="#local-6989586621681925931"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681925789"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925930"><span class="hs-identifier hs-var">cxt</span></a><span> </span><a href="#local-6989586621681925931"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2948"></a><span>    </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-identifier">_</span><span>   </span><a name="local-6989586621681925932"><a href="#local-6989586621681925932"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681925932"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-2949"></a><span>
</span><a name="line-2950"></a><span>
</span><a name="line-2951"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
        Miscellaneous functions
%*                                                                      *
%************************************************************************

-}</span><span>
</span><a name="line-2959"></a><span class="hs-comment">-- | All type constructors occurring in the type; looking through type</span><span>
</span><a name="line-2960"></a><span class="hs-comment">--   synonyms, but not newtypes.</span><span>
</span><a name="line-2961"></a><span class="hs-comment">--  When it finds a Class, it returns the class TyCon.</span><span>
</span><a name="line-2962"></a><span class="hs-identifier">tyConsOfType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqSet.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-2963"></a><a name="tyConsOfType"><a href="Type.html#tyConsOfType"><span class="hs-identifier">tyConsOfType</span></a></a><span> </span><a name="local-6989586621681925933"><a href="#local-6989586621681925933"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-2964"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925933"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2965"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2966"></a><span>     </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqSet.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>  </span><span class="hs-comment">-- The UniqSet does duplicate elim</span><span>
</span><a name="line-2967"></a><span>     </span><a name="local-6989586621681925934"><a href="#local-6989586621681925934"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681925942"><a href="#local-6989586621681925942"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681925943"><a href="#local-6989586621681925943"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a><span> </span><a href="#local-6989586621681925942"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925943"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-2968"></a><span>     </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a><span>
</span><a name="line-2969"></a><span>     </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a><span>
</span><a name="line-2970"></a><span>     </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925944"><a href="#local-6989586621681925944"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925945"><a href="#local-6989586621681925945"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925940"><span class="hs-identifier hs-var">go_tc</span></a><span> </span><a href="#local-6989586621681925944"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925938"><span class="hs-identifier hs-var">go_s</span></a><span> </span><a href="#local-6989586621681925945"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-2971"></a><span>     </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925946"><a href="#local-6989586621681925946"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621681925947"><a href="#local-6989586621681925947"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925946"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925947"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-2972"></a><span>     </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681925948"><a href="#local-6989586621681925948"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621681925949"><a href="#local-6989586621681925949"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925948"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925949"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925940"><span class="hs-identifier hs-var">go_tc</span></a><span> </span><a href="TysPrim.html#funTyCon"><span class="hs-identifier hs-var">funTyCon</span></a><span>
</span><a name="line-2973"></a><span>     </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681925950"><a href="#local-6989586621681925950"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681925951"><a href="#local-6989586621681925951"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925951"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681925950"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2974"></a><span>     </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681925952"><a href="#local-6989586621681925952"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925953"><a href="#local-6989586621681925953"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925952"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925953"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2975"></a><span>     </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621681925954"><a href="#local-6989586621681925954"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925954"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2976"></a><span>
</span><a name="line-2977"></a><span>     </span><a name="local-6989586621681925935"><a href="#local-6989586621681925935"><span class="hs-identifier">go_co</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Refl"><span class="hs-identifier hs-var">Refl</span></a><span> </span><a name="local-6989586621681925955"><a href="#local-6989586621681925955"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925955"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2978"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#GRefl"><span class="hs-identifier hs-var">GRefl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925956"><a href="#local-6989586621681925956"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681925957"><a href="#local-6989586621681925957"><span class="hs-identifier">mco</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925956"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925936"><span class="hs-identifier hs-var">go_mco</span></a><span> </span><a href="#local-6989586621681925957"><span class="hs-identifier hs-var">mco</span></a><span>
</span><a name="line-2979"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConAppCo"><span class="hs-identifier hs-var">TyConAppCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925958"><a href="#local-6989586621681925958"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681925959"><a href="#local-6989586621681925959"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925940"><span class="hs-identifier hs-var">go_tc</span></a><span> </span><a href="#local-6989586621681925958"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925939"><span class="hs-identifier hs-var">go_cos</span></a><span> </span><a href="#local-6989586621681925959"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2980"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppCo"><span class="hs-identifier hs-var">AppCo</span></a><span> </span><a name="local-6989586621681925960"><a href="#local-6989586621681925960"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621681925961"><a href="#local-6989586621681925961"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925960"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925961"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2981"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllCo"><span class="hs-identifier hs-var">ForAllCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925962"><a href="#local-6989586621681925962"><span class="hs-identifier">kind_co</span></a></a><span> </span><a name="local-6989586621681925963"><a href="#local-6989586621681925963"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925962"><span class="hs-identifier hs-var">kind_co</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925963"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2982"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunCo"><span class="hs-identifier hs-var">FunCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925964"><a href="#local-6989586621681925964"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621681925965"><a href="#local-6989586621681925965"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925964"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925965"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-2983"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomInstCo"><span class="hs-identifier hs-var">AxiomInstCo</span></a><span> </span><a name="local-6989586621681925966"><a href="#local-6989586621681925966"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925967"><a href="#local-6989586621681925967"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925941"><span class="hs-identifier hs-var">go_ax</span></a><span> </span><a href="#local-6989586621681925966"><span class="hs-identifier hs-var">ax</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925939"><span class="hs-identifier hs-var">go_cos</span></a><span> </span><a href="#local-6989586621681925967"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2984"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#UnivCo"><span class="hs-identifier hs-var">UnivCo</span></a><span> </span><a name="local-6989586621681925968"><a href="#local-6989586621681925968"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925969"><a href="#local-6989586621681925969"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681925970"><a href="#local-6989586621681925970"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925937"><span class="hs-identifier hs-var">go_prov</span></a><span> </span><a href="#local-6989586621681925968"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925969"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925970"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-2985"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoVarCo"><span class="hs-identifier hs-var">CoVarCo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a><span>
</span><a name="line-2986"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#HoleCo"><span class="hs-identifier hs-var">HoleCo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a><span>
</span><a name="line-2987"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SymCo"><span class="hs-identifier hs-var">SymCo</span></a><span> </span><a name="local-6989586621681925971"><a href="#local-6989586621681925971"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925971"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2988"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TransCo"><span class="hs-identifier hs-var">TransCo</span></a><span> </span><a name="local-6989586621681925972"><a href="#local-6989586621681925972"><span class="hs-identifier">co1</span></a></a><span> </span><a name="local-6989586621681925973"><a href="#local-6989586621681925973"><span class="hs-identifier">co2</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925972"><span class="hs-identifier hs-var">co1</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925973"><span class="hs-identifier hs-var">co2</span></a><span>
</span><a name="line-2989"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#NthCo"><span class="hs-identifier hs-var">NthCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925974"><a href="#local-6989586621681925974"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925974"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2990"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LRCo"><span class="hs-identifier hs-var">LRCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925975"><a href="#local-6989586621681925975"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925975"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2991"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#InstCo"><span class="hs-identifier hs-var">InstCo</span></a><span> </span><a name="local-6989586621681925976"><a href="#local-6989586621681925976"><span class="hs-identifier">co</span></a></a><span> </span><a name="local-6989586621681925977"><a href="#local-6989586621681925977"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925976"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">`</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925977"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2992"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#KindCo"><span class="hs-identifier hs-var">KindCo</span></a><span> </span><a name="local-6989586621681925978"><a href="#local-6989586621681925978"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925978"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2993"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#SubCo"><span class="hs-identifier hs-var">SubCo</span></a><span> </span><a name="local-6989586621681925979"><a href="#local-6989586621681925979"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925979"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2994"></a><span>     </span><span class="hs-identifier">go_co</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AxiomRuleCo"><span class="hs-identifier hs-var">AxiomRuleCo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681925980"><a href="#local-6989586621681925980"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925939"><span class="hs-identifier hs-var">go_cos</span></a><span> </span><a href="#local-6989586621681925980"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-2995"></a><span>
</span><a name="line-2996"></a><span>     </span><a name="local-6989586621681925936"><a href="#local-6989586621681925936"><span class="hs-identifier">go_mco</span></a></a><span> </span><a href="TyCoRep.html#MRefl"><span class="hs-identifier hs-var">MRefl</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a><span>
</span><a name="line-2997"></a><span>     </span><span class="hs-identifier">go_mco</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#MCo"><span class="hs-identifier hs-var">MCo</span></a><span> </span><a name="local-6989586621681925981"><a href="#local-6989586621681925981"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925981"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-2998"></a><span>
</span><a name="line-2999"></a><span>     </span><a name="local-6989586621681925937"><a href="#local-6989586621681925937"><span class="hs-identifier">go_prov</span></a></a><span> </span><a href="TyCoRep.html#UnsafeCoerceProv"><span class="hs-identifier hs-var">UnsafeCoerceProv</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a><span>
</span><a name="line-3000"></a><span>     </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PhantomProv"><span class="hs-identifier hs-var">PhantomProv</span></a><span> </span><a name="local-6989586621681925982"><a href="#local-6989586621681925982"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925982"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-3001"></a><span>     </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ProofIrrelProv"><span class="hs-identifier hs-var">ProofIrrelProv</span></a><span> </span><a name="local-6989586621681925983"><a href="#local-6989586621681925983"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span> </span><a href="#local-6989586621681925983"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-3002"></a><span>     </span><span class="hs-identifier">go_prov</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#PluginProv"><span class="hs-identifier hs-var">PluginProv</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a><span>
</span><a name="line-3003"></a><span>        </span><span class="hs-comment">-- this last case can happen from the tyConsOfType used from</span><span>
</span><a name="line-3004"></a><span>        </span><span class="hs-comment">-- checkTauTvUpdate</span><span>
</span><a name="line-3005"></a><span>
</span><a name="line-3006"></a><span>     </span><a name="local-6989586621681925938"><a href="#local-6989586621681925938"><span class="hs-identifier">go_s</span></a></a><span> </span><a name="local-6989586621681925984"><a href="#local-6989586621681925984"><span class="hs-identifier">tys</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621681925934"><span class="hs-identifier hs-var">go</span></a><span class="hs-special">)</span><span>     </span><a href="UniqSet.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a><span> </span><a href="#local-6989586621681925984"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-3007"></a><span>     </span><a name="local-6989586621681925939"><a href="#local-6989586621681925939"><span class="hs-identifier">go_cos</span></a></a><span> </span><a name="local-6989586621681925985"><a href="#local-6989586621681925985"><span class="hs-identifier">cos</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621681925935"><span class="hs-identifier hs-var">go_co</span></a><span class="hs-special">)</span><span>  </span><a href="UniqSet.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a><span> </span><a href="#local-6989586621681925985"><span class="hs-identifier hs-var">cos</span></a><span>
</span><a name="line-3008"></a><span>
</span><a name="line-3009"></a><span>     </span><a name="local-6989586621681925940"><a href="#local-6989586621681925940"><span class="hs-identifier">go_tc</span></a></a><span> </span><a name="local-6989586621681925986"><a href="#local-6989586621681925986"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#unitUniqSet"><span class="hs-identifier hs-var">unitUniqSet</span></a><span> </span><a href="#local-6989586621681925986"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-3010"></a><span>     </span><a name="local-6989586621681925941"><a href="#local-6989586621681925941"><span class="hs-identifier">go_ax</span></a></a><span> </span><a name="local-6989586621681925987"><a href="#local-6989586621681925987"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925940"><span class="hs-identifier hs-var">go_tc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoAxiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a><span> </span><a href="#local-6989586621681925987"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-3011"></a><span>
</span><a name="line-3012"></a><span class="hs-comment">-- | Find the result 'Kind' of a type synonym,</span><span>
</span><a name="line-3013"></a><span class="hs-comment">-- after applying it to its 'arity' number of type variables</span><span>
</span><a name="line-3014"></a><span class="hs-comment">-- Actually this function works fine on data types too,</span><span>
</span><a name="line-3015"></a><span class="hs-comment">-- but they'd always return '*', so we never need to ask</span><span>
</span><a name="line-3016"></a><span class="hs-identifier">synTyConResKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-3017"></a><a name="synTyConResKind"><a href="Type.html#synTyConResKind"><span class="hs-identifier">synTyConResKind</span></a></a><span> </span><a name="local-6989586621681925988"><a href="#local-6989586621681925988"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#piResultTys"><span class="hs-identifier hs-var">piResultTys</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621681925988"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConTyVars</span><span> </span><a href="#local-6989586621681925988"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3018"></a><span>
</span><a name="line-3019"></a><span class="hs-comment">-- | Retrieve the free variables in this type, splitting them based</span><span>
</span><a name="line-3020"></a><span class="hs-comment">-- on whether they are used visibly or invisibly. Invisible ones come</span><span>
</span><a name="line-3021"></a><span class="hs-comment">-- first.</span><span>
</span><a name="line-3022"></a><span class="hs-identifier">splitVisVarsOfType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span>
</span><a name="line-3023"></a><a name="splitVisVarsOfType"><a href="Type.html#splitVisVarsOfType"><span class="hs-identifier">splitVisVarsOfType</span></a></a><span> </span><a name="local-6989586621681925989"><a href="#local-6989586621681925989"><span class="hs-identifier">orig_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621681925992"><span class="hs-identifier hs-var">invis_vars</span></a><span> </span><a href="#local-6989586621681925991"><span class="hs-identifier hs-var">vis_vars</span></a><span>
</span><a name="line-3024"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-3025"></a><span>    </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a name="local-6989586621681925990"><a href="#local-6989586621681925990"><span class="hs-identifier">invis_vars1</span></a></a><span> </span><a name="local-6989586621681925991"><a href="#local-6989586621681925991"><span class="hs-identifier">vis_vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925993"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925989"><span class="hs-identifier hs-var">orig_ty</span></a><span>
</span><a name="line-3026"></a><span>    </span><a name="local-6989586621681925992"><a href="#local-6989586621681925992"><span class="hs-identifier">invis_vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925990"><span class="hs-identifier hs-var">invis_vars1</span></a><span> </span><span class="hs-special">`</span><a href="VarSet.html#minusVarSet"><span class="hs-identifier hs-var">minusVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925991"><span class="hs-identifier hs-var">vis_vars</span></a><span>
</span><a name="line-3027"></a><span>
</span><a name="line-3028"></a><span>    </span><a name="local-6989586621681925993"><a href="#local-6989586621681925993"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyVarTy"><span class="hs-identifier hs-var">TyVarTy</span></a><span> </span><a name="local-6989586621681925996"><a href="#local-6989586621681925996"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621681925996"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="VarSet.html#unitVarSet"><span class="hs-identifier hs-var">unitVarSet</span></a><span> </span><a href="#local-6989586621681925996"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-3029"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AppTy"><span class="hs-identifier hs-var">AppTy</span></a><span> </span><a name="local-6989586621681925997"><a href="#local-6989586621681925997"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681925998"><a href="#local-6989586621681925998"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925993"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925997"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925993"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681925998"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-3030"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#TyConApp"><span class="hs-identifier hs-var">TyConApp</span></a><span> </span><a name="local-6989586621681925999"><a href="#local-6989586621681925999"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681926000"><a href="#local-6989586621681926000"><span class="hs-identifier">tys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925995"><span class="hs-identifier hs-var">go_tc</span></a><span> </span><a href="#local-6989586621681925999"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681926000"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-3031"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#FunTy"><span class="hs-identifier hs-var">FunTy</span></a><span> </span><a name="local-6989586621681926001"><a href="#local-6989586621681926001"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681926002"><a href="#local-6989586621681926002"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925993"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681926001"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925993"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681926002"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-3032"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ForAllTy"><span class="hs-identifier hs-var">ForAllTy</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a><span> </span><a name="local-6989586621681926003"><a href="#local-6989586621681926003"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681926004"><a href="#local-6989586621681926004"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3033"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">`</span><a href="VarSet.html#delVarSet"><span class="hs-identifier hs-var">delVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681926003"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621681925993"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681926004"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span>
</span><a name="line-3034"></a><span>        </span><span class="hs-special">(</span><a href="#local-6989586621681925994"><span class="hs-identifier hs-var">invisible</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681926003"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3035"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#LitTy"><span class="hs-identifier hs-var">LitTy</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mempty</span><span>
</span><a name="line-3036"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CastTy"><span class="hs-identifier hs-var">CastTy</span></a><span> </span><a name="local-6989586621681926005"><a href="#local-6989586621681926005"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681926006"><a href="#local-6989586621681926006"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925993"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681926005"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681925994"><span class="hs-identifier hs-var">invisible</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span> </span><a href="#local-6989586621681926006"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span>
</span><a name="line-3037"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#CoercionTy"><span class="hs-identifier hs-var">CoercionTy</span></a><span> </span><a name="local-6989586621681926007"><a href="#local-6989586621681926007"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681925994"><span class="hs-identifier hs-var">invisible</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TyCoRep.html#tyCoVarsOfCo"><span class="hs-identifier hs-var">tyCoVarsOfCo</span></a><span> </span><a href="#local-6989586621681926007"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-3038"></a><span>
</span><a name="line-3039"></a><span>    </span><a name="local-6989586621681925994"><a href="#local-6989586621681925994"><span class="hs-identifier">invisible</span></a></a><span> </span><a name="local-6989586621681926008"><a href="#local-6989586621681926008"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-var">Pair</span></a><span> </span><a href="#local-6989586621681926008"><span class="hs-identifier hs-var">vs</span></a><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-3040"></a><span>
</span><a name="line-3041"></a><span>    </span><a name="local-6989586621681925995"><a href="#local-6989586621681925995"><span class="hs-identifier">go_tc</span></a></a><span> </span><a name="local-6989586621681926009"><a href="#local-6989586621681926009"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681926010"><a href="#local-6989586621681926010"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681926011"><a href="#local-6989586621681926011"><span class="hs-identifier">invis</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681926012"><a href="#local-6989586621681926012"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#partitionInvisibleTypes"><span class="hs-identifier hs-var">partitionInvisibleTypes</span></a><span> </span><a href="#local-6989586621681926009"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="#local-6989586621681926010"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-3042"></a><span>                   </span><a href="#local-6989586621681925994"><span class="hs-identifier hs-var">invisible</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a><span> </span><a href="#local-6989586621681926011"><span class="hs-identifier hs-var">invis</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="#local-6989586621681925993"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681926012"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-3043"></a><span>
</span><a name="line-3044"></a><span class="hs-identifier">splitVisVarsOfTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Pair.html#Pair"><span class="hs-identifier hs-type">Pair</span></a><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span>
</span><a name="line-3045"></a><a name="splitVisVarsOfTypes"><a href="Type.html#splitVisVarsOfTypes"><span class="hs-identifier">splitVisVarsOfTypes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="Type.html#splitVisVarsOfType"><span class="hs-identifier hs-var">splitVisVarsOfType</span></a><span>
</span><a name="line-3046"></a><span>
</span><a name="line-3047"></a><span class="hs-identifier">modifyJoinResTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>            </span><span class="hs-comment">-- Number of binders to skip</span><span>
</span><a name="line-3048"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Function to apply to result type</span><span>
</span><a name="line-3049"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>           </span><span class="hs-comment">-- Type of join point</span><span>
</span><a name="line-3050"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>           </span><span class="hs-comment">-- New type</span><span>
</span><a name="line-3051"></a><span class="hs-comment">-- INVARIANT: If any of the first n binders are foralls, those tyvars cannot</span><span>
</span><a name="line-3052"></a><span class="hs-comment">-- appear in the original result type. See isValidJoinPointType.</span><span>
</span><a name="line-3053"></a><a name="modifyJoinResTy"><a href="Type.html#modifyJoinResTy"><span class="hs-identifier">modifyJoinResTy</span></a></a><span> </span><a name="local-6989586621681926013"><a href="#local-6989586621681926013"><span class="hs-identifier">orig_ar</span></a></a><span> </span><a name="local-6989586621681926014"><a href="#local-6989586621681926014"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621681926015"><a href="#local-6989586621681926015"><span class="hs-identifier">orig_ty</span></a></a><span>
</span><a name="line-3054"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681926016"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681926013"><span class="hs-identifier hs-var">orig_ar</span></a><span> </span><a href="#local-6989586621681926015"><span class="hs-identifier hs-var">orig_ty</span></a><span>
</span><a name="line-3055"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-3056"></a><span>    </span><a name="local-6989586621681926016"><a href="#local-6989586621681926016"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-number">0</span><span> </span><a name="local-6989586621681926017"><a href="#local-6989586621681926017"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681926014"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621681926017"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-3057"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681926018"><a href="#local-6989586621681926018"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681926019"><a href="#local-6989586621681926019"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681926020"><a href="#local-6989586621681926020"><span class="hs-identifier">arg_bndr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681926021"><a href="#local-6989586621681926021"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitPiTy_maybe"><span class="hs-identifier hs-var">splitPiTy_maybe</span></a><span> </span><a href="#local-6989586621681926019"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-3058"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyCoPiTy"><span class="hs-identifier hs-var">mkTyCoPiTy</span></a><span> </span><a href="#local-6989586621681926020"><span class="hs-identifier hs-var">arg_bndr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681926016"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681926018"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681926021"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-3059"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-3060"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;modifyJoinResTy&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681926013"><span class="hs-identifier hs-var">orig_ar</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681926015"><span class="hs-identifier hs-var">orig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-3061"></a><span>
</span><a name="line-3062"></a><span class="hs-identifier">setJoinResTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>  </span><span class="hs-comment">-- Number of binders to skip</span><span>
</span><a name="line-3063"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-comment">-- New result type</span><span>
</span><a name="line-3064"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-comment">-- Type of join point</span><span>
</span><a name="line-3065"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-comment">-- New type</span><span>
</span><a name="line-3066"></a><span class="hs-comment">-- INVARIANT: Same as for modifyJoinResTy</span><span>
</span><a name="line-3067"></a><a name="setJoinResTy"><a href="Type.html#setJoinResTy"><span class="hs-identifier">setJoinResTy</span></a></a><span> </span><a name="local-6989586621681926022"><a href="#local-6989586621681926022"><span class="hs-identifier">ar</span></a></a><span> </span><a name="local-6989586621681926023"><a href="#local-6989586621681926023"><span class="hs-identifier">new_res_ty</span></a></a><span> </span><a name="local-6989586621681926024"><a href="#local-6989586621681926024"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-3068"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#modifyJoinResTy"><span class="hs-identifier hs-var">modifyJoinResTy</span></a><span> </span><a href="#local-6989586621681926022"><span class="hs-identifier hs-var">ar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621681926023"><span class="hs-identifier hs-var">new_res_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681926024"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-3069"></a><span>
</span><a name="line-3070"></a><span>
</span><a name="line-3071"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
         Pretty-printing
%*                                                                      *
%************************************************************************

Most pretty-printing is either in TyCoRep or IfaceType.

-}</span><span>
</span><a name="line-3081"></a><span>
</span><a name="line-3082"></a><span class="hs-comment">-- | This variant preserves any use of TYPE in a type, effectively</span><span>
</span><a name="line-3083"></a><span class="hs-comment">-- locally setting -fprint-explicit-runtime-reps.</span><span>
</span><a name="line-3084"></a><span class="hs-identifier">pprWithTYPE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-3085"></a><a name="pprWithTYPE"><a href="Type.html#pprWithTYPE"><span class="hs-identifier">pprWithTYPE</span></a></a><span> </span><a name="local-6989586621681926025"><a href="#local-6989586621681926025"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#updSDocDynFlags"><span class="hs-identifier hs-var">updSDocDynFlags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><a href="DynFlags.html#gopt_set"><span class="hs-identifier hs-var">gopt_set</span></a><span> </span><a href="DynFlags.html#Opt_PrintExplicitRuntimeReps"><span class="hs-identifier hs-var">Opt_PrintExplicitRuntimeReps</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-3086"></a><span>                 </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681926025"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-3087"></a></pre></body></html>