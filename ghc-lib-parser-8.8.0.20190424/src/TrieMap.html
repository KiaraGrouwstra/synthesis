<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE TypeSynonymInstances #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TrieMap</span><span class="hs-special">(</span><span>
</span><a name="line-13"></a><span>   </span><span class="hs-comment">-- * Maps over 'Maybe' values</span><span>
</span><a name="line-14"></a><span>   </span><a href="TrieMap.html#MaybeMap"><span class="hs-identifier hs-type">MaybeMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>   </span><span class="hs-comment">-- * Maps over 'List' values</span><span>
</span><a name="line-16"></a><span>   </span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>   </span><span class="hs-comment">-- * Maps over 'Literal's</span><span>
</span><a name="line-18"></a><span>   </span><a href="TrieMap.html#LiteralMap"><span class="hs-identifier hs-type">LiteralMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>   </span><span class="hs-comment">-- * 'TrieMap' class</span><span>
</span><a name="line-20"></a><span>   </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TrieMap.html#insertTM"><span class="hs-identifier hs-var">insertTM</span></a><span class="hs-special">,</span><span> </span><a href="TrieMap.html#deleteTM"><span class="hs-identifier hs-var">deleteTM</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>   </span><span class="hs-comment">-- * Things helpful for adding additional Instances.</span><span>
</span><a name="line-23"></a><span>   </span><span class="hs-special">(</span><a href="TrieMap.html#%3E.%3E"><span class="hs-operator hs-var">&gt;.&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#%7C%3E"><span class="hs-operator hs-var">|&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#%7C%3E%3E"><span class="hs-operator hs-var">|&gt;&gt;</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>   </span><a href="TrieMap.html#foldMaybe"><span class="hs-identifier hs-var">foldMaybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>   </span><span class="hs-comment">-- * Map for leaf compression</span><span>
</span><a name="line-26"></a><span>   </span><a href="TrieMap.html#GenMap"><span class="hs-identifier hs-type">GenMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>   </span><a href="TrieMap.html#lkG"><span class="hs-identifier hs-var">lkG</span></a><span class="hs-special">,</span><span> </span><a href="TrieMap.html#xtG"><span class="hs-identifier hs-var">xtG</span></a><span class="hs-special">,</span><span> </span><a href="TrieMap.html#mapG"><span class="hs-identifier hs-var">mapG</span></a><span class="hs-special">,</span><span> </span><a href="TrieMap.html#fdG"><span class="hs-identifier hs-var">fdG</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>   </span><a href="TrieMap.html#xtList"><span class="hs-identifier hs-var">xtList</span></a><span class="hs-special">,</span><span> </span><a href="TrieMap.html#lkList"><span class="hs-identifier hs-var">lkList</span></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="Literal.html"><span class="hs-identifier">Literal</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="UniqDFM.html"><span class="hs-identifier">UniqDFM</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span class="hs-special">(</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.IntMap</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IntMap</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-comment">{-
This module implements TrieMaps, which are finite mappings
whose key is a structured value like a CoreExpr or Type.

This file implements tries over general data structures.
Implementation for tries over Core Expressions/Types are
available in coreSyn/TrieMap.

The regular pattern for handling TrieMaps on data structures was first
described (to my knowledge) in Connelly and Morris's 1995 paper &quot;A
generalization of the Trie Data Structure&quot;; there is also an accessible
description of the idea in Okasaki's book &quot;Purely Functional Data
Structures&quot;, Section 10.3.2

************************************************************************
*                                                                      *
                   The TrieMap class
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-keyword">type</span><span> </span><a name="XT"><a href="TrieMap.html#XT"><span class="hs-identifier">XT</span></a></a><span> </span><a name="local-6989586621682052818"><a href="#local-6989586621682052818"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052818"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052818"><span class="hs-identifier hs-type">a</span></a><span>  </span><span class="hs-comment">-- How to alter a non-existent elt (Nothing)</span><span>
</span><a name="line-65"></a><span>                                </span><span class="hs-comment">--               or an existing elt (Just)</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-keyword">class</span><span> </span><a name="TrieMap"><a href="TrieMap.html#TrieMap"><span class="hs-identifier">TrieMap</span></a></a><span> </span><a name="local-6989586621682052810"><a href="#local-6989586621682052810"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-68"></a><span>   </span><span class="hs-keyword">type</span><span> </span><a name="Key"><a href="TrieMap.html#Key"><span class="hs-identifier">Key</span></a></a><span> </span><a name="local-6989586621682052810"><a href="#local-6989586621682052810"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-operator">*</span><span>
</span><a name="line-69"></a><span>   </span><a name="emptyTM"><a href="TrieMap.html#emptyTM"><span class="hs-identifier">emptyTM</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621682052810"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052811"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-70"></a><span>   </span><a name="lookupTM"><a href="TrieMap.html#lookupTM"><span class="hs-identifier">lookupTM</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621682052812"><a href="#local-6989586621682052812"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052810"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052810"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052812"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052812"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-71"></a><span>   </span><a name="alterTM"><a href="TrieMap.html#alterTM"><span class="hs-identifier">alterTM</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621682052813"><a href="#local-6989586621682052813"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052810"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a><span> </span><a href="#local-6989586621682052813"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052810"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052813"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052810"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052813"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-72"></a><span>   </span><a name="mapTM"><a href="TrieMap.html#mapTM"><span class="hs-identifier">mapTM</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052814"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621682052815"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052810"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052814"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052810"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052815"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>   </span><a name="foldTM"><a href="TrieMap.html#foldTM"><span class="hs-identifier">foldTM</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052816"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052817"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052817"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052810"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052816"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052817"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052817"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-75"></a><span>      </span><span class="hs-comment">-- The unusual argument order here makes</span><span>
</span><a name="line-76"></a><span>      </span><span class="hs-comment">-- it easy to compose calls to foldTM;</span><span>
</span><a name="line-77"></a><span>      </span><span class="hs-comment">-- see for example fdE below</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-identifier">insertTM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052908"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052908"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052909"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052908"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052909"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052908"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052909"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-80"></a><a name="insertTM"><a href="TrieMap.html#insertTM"><span class="hs-identifier">insertTM</span></a></a><span> </span><a name="local-6989586621682052910"><a href="#local-6989586621682052910"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052911"><a href="#local-6989586621682052911"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621682052912"><a href="#local-6989586621682052912"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#alterTM"><span class="hs-identifier hs-var">alterTM</span></a><span> </span><a href="#local-6989586621682052910"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682052911"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682052912"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-identifier">deleteTM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052906"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052906"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052906"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052907"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052906"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052907"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-83"></a><a name="deleteTM"><a href="TrieMap.html#deleteTM"><span class="hs-identifier">deleteTM</span></a></a><span> </span><a name="local-6989586621682052913"><a href="#local-6989586621682052913"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052914"><a href="#local-6989586621682052914"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#alterTM"><span class="hs-identifier hs-var">alterTM</span></a><span> </span><a href="#local-6989586621682052913"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682052914"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-comment">----------------------</span><span>
</span><a name="line-86"></a><span class="hs-comment">-- Recall that</span><span>
</span><a name="line-87"></a><span class="hs-comment">--   Control.Monad.(&gt;=&gt;) :: (a -&gt; Maybe b) -&gt; (b -&gt; Maybe c) -&gt; a -&gt; Maybe c</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-special">(</span><span class="hs-operator">&gt;.&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052903"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052904"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052904"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052905"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052903"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052905"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-90"></a><span class="hs-comment">-- Reverse function composition (do f first, then g)</span><span>
</span><a name="line-91"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">1</span><span> </span><a href="TrieMap.html#%3E.%3E"><span class="hs-operator hs-var">&gt;.&gt;</span></a><span>
</span><a name="line-92"></a><span class="hs-special">(</span><a name="local-6989586621682052915"><a href="#local-6989586621682052915"><span class="hs-identifier">f</span></a></a><span> </span><a name="%3E.%3E"><a href="TrieMap.html#%3E.%3E"><span class="hs-operator">&gt;.&gt;</span></a></a><span> </span><a name="local-6989586621682052916"><a href="#local-6989586621682052916"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682052917"><a href="#local-6989586621682052917"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052916"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052915"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052917"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">1</span><span> </span><a href="TrieMap.html#%7C%3E"><span class="hs-operator hs-var">|&gt;</span></a><span class="hs-special">,</span><span> </span><a href="TrieMap.html#%7C%3E%3E"><span class="hs-operator hs-var">|&gt;&gt;</span></a><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-special">(</span><span class="hs-operator">|&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621682052901"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052901"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621682052902"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052902"><span class="hs-identifier hs-type">b</span></a><span>     </span><span class="hs-comment">-- Reverse application</span><span>
</span><a name="line-96"></a><a name="local-6989586621682052918"><a href="#local-6989586621682052918"><span class="hs-identifier">x</span></a></a><span> </span><a name="%7C%3E"><a href="TrieMap.html#%7C%3E"><span class="hs-operator">|&gt;</span></a></a><span> </span><a name="local-6989586621682052919"><a href="#local-6989586621682052919"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052919"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052918"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">----------------------</span><span>
</span><a name="line-99"></a><span class="hs-special">(</span><span class="hs-operator">|&gt;&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052898"><span class="hs-identifier hs-type">m2</span></a><span>
</span><a name="line-100"></a><span>      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052898"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621682052899"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052900"><span class="hs-identifier hs-type">m1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052898"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621682052899"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052900"><span class="hs-identifier hs-type">m1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052898"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621682052899"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052898"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621682052899"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052898"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621682052899"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052900"><span class="hs-identifier hs-type">m1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052898"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621682052899"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052900"><span class="hs-identifier hs-type">m1</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052898"><span class="hs-identifier hs-type">m2</span></a><span> </span><a href="#local-6989586621682052899"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span class="hs-special">(</span><a name="%7C%3E%3E"><a href="TrieMap.html#%7C%3E%3E"><span class="hs-operator">|&gt;&gt;</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682052920"><a href="#local-6989586621682052920"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052921"><a href="#local-6989586621682052921"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052920"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621682052921"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TrieMap.html#deMaybe"><span class="hs-identifier hs-var">deMaybe</span></a><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-identifier">deMaybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052896"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052896"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052897"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052896"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052897"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-106"></a><a name="deMaybe"><a href="TrieMap.html#deMaybe"><span class="hs-identifier">deMaybe</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a><span>
</span><a name="line-107"></a><span class="hs-identifier">deMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682052922"><a href="#local-6989586621682052922"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052922"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                   IntMaps
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-keyword">instance</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><span class="hs-identifier hs-type">IntMap.IntMap</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-118"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Key</span><span> </span><span class="hs-identifier hs-type">IntMap.IntMap</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-119"></a><span>  </span><a name="local-8214565720326827688"><a href="TrieMap.html#emptyTM"><span class="hs-identifier">emptyTM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IntMap.empty</span><span>
</span><a name="line-120"></a><span>  </span><a name="local-8214565720326827689"><a href="TrieMap.html#lookupTM"><span class="hs-identifier">lookupTM</span></a></a><span> </span><a name="local-6989586621682052848"><a href="#local-6989586621682052848"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052849"><a href="#local-6989586621682052849"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IntMap.lookup</span><span> </span><a href="#local-6989586621682052848"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052849"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-121"></a><span>  </span><a name="local-8214565720326827690"><a href="TrieMap.html#alterTM"><span class="hs-identifier">alterTM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#xtInt"><span class="hs-identifier hs-var">xtInt</span></a><span>
</span><a name="line-122"></a><span>  </span><a name="local-8214565720326827692"><a href="TrieMap.html#foldTM"><span class="hs-identifier">foldTM</span></a></a><span> </span><a name="local-6989586621682052850"><a href="#local-6989586621682052850"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052851"><a href="#local-6989586621682052851"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621682052852"><a href="#local-6989586621682052852"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IntMap.foldr</span><span> </span><a href="#local-6989586621682052850"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052852"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-6989586621682052851"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-123"></a><span>  </span><a name="local-8214565720326827691"><a href="TrieMap.html#mapTM"><span class="hs-identifier">mapTM</span></a></a><span> </span><a name="local-6989586621682052853"><a href="#local-6989586621682052853"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052854"><a href="#local-6989586621682052854"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IntMap.map</span><span> </span><a href="#local-6989586621682052853"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052854"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-identifier">xtInt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a><span> </span><a href="#local-6989586621682052895"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IntMap.IntMap</span><span> </span><a href="#local-6989586621682052895"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IntMap.IntMap</span><span> </span><a href="#local-6989586621682052895"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-126"></a><a name="xtInt"><a href="TrieMap.html#xtInt"><span class="hs-identifier">xtInt</span></a></a><span> </span><a name="local-6989586621682052923"><a href="#local-6989586621682052923"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052924"><a href="#local-6989586621682052924"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052925"><a href="#local-6989586621682052925"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IntMap.alter</span><span> </span><a href="#local-6989586621682052924"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052923"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052925"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621682052839"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="#local-6989586621682052839"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="#local-6989586621682052839"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052839"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-130"></a><span>  </span><a name="local-8214565720326827688"><a href="TrieMap.html#emptyTM"><span class="hs-identifier">emptyTM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.empty</span><span>
</span><a name="line-131"></a><span>  </span><a name="local-8214565720326827689"><a href="TrieMap.html#lookupTM"><span class="hs-identifier">lookupTM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span>
</span><a name="line-132"></a><span>  </span><a name="local-8214565720326827690"><a href="TrieMap.html#alterTM"><span class="hs-identifier">alterTM</span></a></a><span> </span><a name="local-6989586621682052840"><a href="#local-6989586621682052840"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052841"><a href="#local-6989586621682052841"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052842"><a href="#local-6989586621682052842"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.alter</span><span> </span><a href="#local-6989586621682052841"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052840"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052842"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-133"></a><span>  </span><a name="local-8214565720326827692"><a href="TrieMap.html#foldTM"><span class="hs-identifier">foldTM</span></a></a><span> </span><a name="local-6989586621682052843"><a href="#local-6989586621682052843"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052844"><a href="#local-6989586621682052844"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621682052845"><a href="#local-6989586621682052845"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.foldr</span><span> </span><a href="#local-6989586621682052843"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052845"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-6989586621682052844"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-134"></a><span>  </span><a name="local-8214565720326827691"><a href="TrieMap.html#mapTM"><span class="hs-identifier">mapTM</span></a></a><span> </span><a name="local-6989586621682052846"><a href="#local-6989586621682052846"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052847"><a href="#local-6989586621682052847"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.map</span><span> </span><a href="#local-6989586621682052846"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052847"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">{-
Note [foldTM determinism]
~~~~~~~~~~~~~~~~~~~~~~~~~
We want foldTM to be deterministic, which is why we have an instance of
TrieMap for UniqDFM, but not for UniqFM. Here's an example of some things that
go wrong if foldTM is nondeterministic. Consider:

  f a b = return (a &lt;&gt; b)

Depending on the order that the typechecker generates constraints you
get either:

  f :: (Monad m, Monoid a) =&gt; a -&gt; a -&gt; m a

or:

  f :: (Monoid a, Monad m) =&gt; a -&gt; a -&gt; m a

The generated code will be different after desugaring as the dictionaries
will be bound in different orders, leading to potential ABI incompatibility.

One way to solve this would be to notice that the typeclasses could be
sorted alphabetically.

Unfortunately that doesn't quite work with this example:

  f a b = let x = a &lt;&gt; a; y = b &lt;&gt; b in x

where you infer:

  f :: (Monoid m, Monoid m1) =&gt; m1 -&gt; m -&gt; m1

or:

  f :: (Monoid m1, Monoid m) =&gt; m1 -&gt; m -&gt; m1

Here you could decide to take the order of the type variables in the type
according to depth first traversal and use it to order the constraints.

The real trouble starts when the user enables incoherent instances and
the compiler has to make an arbitrary choice. Consider:

  class T a b where
    go :: a -&gt; b -&gt; String

  instance (Show b) =&gt; T Int b where
    go a b = show a ++ show b

  instance (Show a) =&gt; T a Bool where
    go a b = show a ++ show b

  f = go 10 True

GHC is free to choose either dictionary to implement f, but for the sake of
determinism we'd like it to be consistent when compiling the same sources
with the same flags.

inert_dicts :: DictMap is implemented with a TrieMap. In getUnsolvedInerts it
gets converted to a bag of (Wanted) Cts using a fold. Then in
solve_simple_wanteds it's merged with other WantedConstraints. We want the
conversion to a bag to be deterministic. For that purpose we use UniqDFM
instead of UniqFM to implement the TrieMap.

See Note [Deterministic UniqFM] in UniqDFM for more details on how it's made
deterministic.
-}</span><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-keyword">instance</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="UniqDFM.html#UniqDFM"><span class="hs-identifier hs-type">UniqDFM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-205"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Key</span><span> </span><a href="UniqDFM.html#UniqDFM"><span class="hs-identifier hs-type">UniqDFM</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-206"></a><span>  </span><a name="local-8214565720326827688"><a href="TrieMap.html#emptyTM"><span class="hs-identifier">emptyTM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#emptyUDFM"><span class="hs-identifier hs-var">emptyUDFM</span></a><span>
</span><a name="line-207"></a><span>  </span><a name="local-8214565720326827689"><a href="TrieMap.html#lookupTM"><span class="hs-identifier">lookupTM</span></a></a><span> </span><a name="local-6989586621682052829"><a href="#local-6989586621682052829"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052830"><a href="#local-6989586621682052830"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#lookupUDFM"><span class="hs-identifier hs-var">lookupUDFM</span></a><span> </span><a href="#local-6989586621682052830"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621682052829"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-208"></a><span>  </span><a name="local-8214565720326827690"><a href="TrieMap.html#alterTM"><span class="hs-identifier">alterTM</span></a></a><span> </span><a name="local-6989586621682052831"><a href="#local-6989586621682052831"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052832"><a href="#local-6989586621682052832"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052833"><a href="#local-6989586621682052833"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#alterUDFM"><span class="hs-identifier hs-var">alterUDFM</span></a><span> </span><a href="#local-6989586621682052832"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052833"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621682052831"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-209"></a><span>  </span><a name="local-8214565720326827692"><a href="TrieMap.html#foldTM"><span class="hs-identifier">foldTM</span></a></a><span> </span><a name="local-6989586621682052834"><a href="#local-6989586621682052834"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052835"><a href="#local-6989586621682052835"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621682052836"><a href="#local-6989586621682052836"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#foldUDFM"><span class="hs-identifier hs-var">foldUDFM</span></a><span> </span><a href="#local-6989586621682052834"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052836"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-6989586621682052835"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-210"></a><span>  </span><a name="local-8214565720326827691"><a href="TrieMap.html#mapTM"><span class="hs-identifier">mapTM</span></a></a><span> </span><a name="local-6989586621682052837"><a href="#local-6989586621682052837"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052838"><a href="#local-6989586621682052838"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#mapUDFM"><span class="hs-identifier hs-var">mapUDFM</span></a><span> </span><a href="#local-6989586621682052837"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052838"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                   Maybes
*                                                                      *
************************************************************************

If              m is a map from k -&gt; val
then (MaybeMap m) is a map from (Maybe k) -&gt; val
-}</span><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-keyword">data</span><span> </span><a name="MaybeMap"><a href="TrieMap.html#MaybeMap"><span class="hs-identifier">MaybeMap</span></a></a><span> </span><a name="local-6989586621682052808"><a href="#local-6989586621682052808"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621682052809"><a href="#local-6989586621682052809"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MM"><a href="TrieMap.html#MM"><span class="hs-identifier">MM</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="mm_nothing"><a href="TrieMap.html#mm_nothing"><span class="hs-identifier">mm_nothing</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052809"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a name="mm_just"><a href="TrieMap.html#mm_just"><span class="hs-identifier">mm_just</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621682052808"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052809"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-keyword">instance</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052828"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#MaybeMap"><span class="hs-identifier hs-type">MaybeMap</span></a><span> </span><a href="#local-6989586621682052828"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-226"></a><span>   </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#MaybeMap"><span class="hs-identifier hs-type">MaybeMap</span></a><span> </span><a href="#local-6989586621682052828"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052828"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-227"></a><span>   </span><a name="local-8214565720326827688"><a href="TrieMap.html#emptyTM"><span class="hs-identifier">emptyTM</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#MM"><span class="hs-identifier hs-var">MM</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mm_nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mm_just</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-228"></a><span>   </span><a name="local-8214565720326827689"><a href="TrieMap.html#lookupTM"><span class="hs-identifier">lookupTM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#lkMaybe"><span class="hs-identifier hs-var">lkMaybe</span></a><span> </span><a href="TrieMap.html#lookupTM"><span class="hs-identifier hs-var">lookupTM</span></a><span>
</span><a name="line-229"></a><span>   </span><a name="local-8214565720326827690"><a href="TrieMap.html#alterTM"><span class="hs-identifier">alterTM</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#xtMaybe"><span class="hs-identifier hs-var">xtMaybe</span></a><span> </span><a href="TrieMap.html#alterTM"><span class="hs-identifier hs-var">alterTM</span></a><span>
</span><a name="line-230"></a><span>   </span><a name="local-8214565720326827692"><a href="TrieMap.html#foldTM"><span class="hs-identifier">foldTM</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#fdMaybe"><span class="hs-identifier hs-var">fdMaybe</span></a><span>
</span><a name="line-231"></a><span>   </span><a name="local-8214565720326827691"><a href="TrieMap.html#mapTM"><span class="hs-identifier">mapTM</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#mapMb"><span class="hs-identifier hs-var">mapMb</span></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span class="hs-identifier">mapMb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052892"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052893"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621682052894"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#MaybeMap"><span class="hs-identifier hs-type">MaybeMap</span></a><span> </span><a href="#local-6989586621682052892"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052893"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#MaybeMap"><span class="hs-identifier hs-type">MaybeMap</span></a><span> </span><a href="#local-6989586621682052892"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052894"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-234"></a><a name="mapMb"><a href="TrieMap.html#mapMb"><span class="hs-identifier">mapMb</span></a></a><span> </span><a name="local-6989586621682052926"><a href="#local-6989586621682052926"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#MM"><span class="hs-identifier hs-var">MM</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mm_nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682052927"><a href="#local-6989586621682052927"><span class="hs-identifier">mn</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">mm_just</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682052928"><a href="#local-6989586621682052928"><span class="hs-identifier">mj</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#MM"><span class="hs-identifier hs-var">MM</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mm_nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621682052926"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052927"><span class="hs-identifier hs-var">mn</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">mm_just</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#mapTM"><span class="hs-identifier hs-var">mapTM</span></a><span> </span><a href="#local-6989586621682052926"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052928"><span class="hs-identifier hs-var">mj</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-identifier">lkMaybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621682052891"><a href="#local-6989586621682052891"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><a href="#local-6989586621682052888"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052889"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052891"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052891"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-238"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052888"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#MaybeMap"><span class="hs-identifier hs-type">MaybeMap</span></a><span> </span><a href="#local-6989586621682052889"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052890"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052890"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-239"></a><a name="lkMaybe"><a href="TrieMap.html#lkMaybe"><span class="hs-identifier">lkMaybe</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mm_nothing</span><span>
</span><a name="line-240"></a><span class="hs-identifier">lkMaybe</span><span> </span><a name="local-6989586621682052929"><a href="#local-6989586621682052929"><span class="hs-identifier">lk</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682052930"><a href="#local-6989586621682052930"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mm_just</span><span> </span><a href="TrieMap.html#%3E.%3E"><span class="hs-operator hs-var">&gt;.&gt;</span></a><span> </span><a href="#local-6989586621682052929"><span class="hs-identifier hs-var">lk</span></a><span> </span><a href="#local-6989586621682052930"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-identifier">xtMaybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621682052887"><a href="#local-6989586621682052887"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><a href="#local-6989586621682052884"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a><span> </span><a href="#local-6989586621682052887"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052885"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052887"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052885"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052887"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052884"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a><span> </span><a href="#local-6989586621682052886"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#MaybeMap"><span class="hs-identifier hs-type">MaybeMap</span></a><span> </span><a href="#local-6989586621682052885"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052886"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#MaybeMap"><span class="hs-identifier hs-type">MaybeMap</span></a><span> </span><a href="#local-6989586621682052885"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052886"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-244"></a><a name="xtMaybe"><a href="TrieMap.html#xtMaybe"><span class="hs-identifier">xtMaybe</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><a name="local-6989586621682052931"><a href="#local-6989586621682052931"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052932"><a href="#local-6989586621682052932"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052932"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mm_nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052931"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mm_nothing</span><span> </span><a href="#local-6989586621682052932"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-245"></a><span class="hs-identifier">xtMaybe</span><span> </span><a name="local-6989586621682052933"><a href="#local-6989586621682052933"><span class="hs-identifier">tr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682052934"><a href="#local-6989586621682052934"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682052935"><a href="#local-6989586621682052935"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052936"><a href="#local-6989586621682052936"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052936"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mm_just</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mm_just</span><span> </span><a href="#local-6989586621682052936"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="TrieMap.html#%7C%3E"><span class="hs-operator hs-var">|&gt;</span></a><span> </span><a href="#local-6989586621682052933"><span class="hs-identifier hs-var">tr</span></a><span> </span><a href="#local-6989586621682052934"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682052935"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-identifier">fdMaybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052881"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052882"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052883"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052883"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#MaybeMap"><span class="hs-identifier hs-type">MaybeMap</span></a><span> </span><a href="#local-6989586621682052881"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052882"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052883"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052883"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-248"></a><a name="fdMaybe"><a href="TrieMap.html#fdMaybe"><span class="hs-identifier">fdMaybe</span></a></a><span> </span><a name="local-6989586621682052937"><a href="#local-6989586621682052937"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052938"><a href="#local-6989586621682052938"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#foldMaybe"><span class="hs-identifier hs-var">foldMaybe</span></a><span> </span><a href="#local-6989586621682052937"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mm_nothing</span><span> </span><a href="#local-6989586621682052938"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>            </span><span class="hs-operator hs-var">.</span><span> </span><a href="TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a><span> </span><a href="#local-6989586621682052937"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mm_just</span><span> </span><a href="#local-6989586621682052938"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                   Lists
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-keyword">data</span><span> </span><a name="ListMap"><a href="TrieMap.html#ListMap"><span class="hs-identifier">ListMap</span></a></a><span> </span><a name="local-6989586621682052806"><a href="#local-6989586621682052806"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621682052807"><a href="#local-6989586621682052807"><span class="hs-identifier">a</span></a></a><span>
</span><a name="line-260"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="LM"><a href="TrieMap.html#LM"><span class="hs-identifier">LM</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="lm_nil"><a href="TrieMap.html#lm_nil"><span class="hs-identifier">lm_nil</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052807"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-261"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="lm_cons"><a href="TrieMap.html#lm_cons"><span class="hs-identifier">lm_cons</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621682052806"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="#local-6989586621682052806"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052807"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-keyword">instance</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052827"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="#local-6989586621682052827"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-264"></a><span>   </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="#local-6989586621682052827"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052827"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">]</span><span>
</span><a name="line-265"></a><span>   </span><a name="local-8214565720326827688"><a href="TrieMap.html#emptyTM"><span class="hs-identifier">emptyTM</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#LM"><span class="hs-identifier hs-var">LM</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lm_nil</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lm_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-266"></a><span>   </span><a name="local-8214565720326827689"><a href="TrieMap.html#lookupTM"><span class="hs-identifier">lookupTM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#lkList"><span class="hs-identifier hs-var">lkList</span></a><span> </span><a href="TrieMap.html#lookupTM"><span class="hs-identifier hs-var">lookupTM</span></a><span>
</span><a name="line-267"></a><span>   </span><a name="local-8214565720326827690"><a href="TrieMap.html#alterTM"><span class="hs-identifier">alterTM</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#xtList"><span class="hs-identifier hs-var">xtList</span></a><span> </span><a href="TrieMap.html#alterTM"><span class="hs-identifier hs-var">alterTM</span></a><span>
</span><a name="line-268"></a><span>   </span><a name="local-8214565720326827692"><a href="TrieMap.html#foldTM"><span class="hs-identifier">foldTM</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#fdList"><span class="hs-identifier hs-var">fdList</span></a><span>
</span><a name="line-269"></a><span>   </span><a name="local-8214565720326827691"><a href="TrieMap.html#mapTM"><span class="hs-identifier">mapTM</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#mapList"><span class="hs-identifier hs-var">mapList</span></a><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052824"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621682052825"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="#local-6989586621682052824"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052825"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-272"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621682052826"><a href="#local-6989586621682052826"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;List elts&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682052826"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span class="hs-identifier">mapList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052878"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052879"><span class="hs-identifier hs-type">a</span></a><span class="hs-glyph">-&gt;</span><a href="#local-6989586621682052880"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="#local-6989586621682052878"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052879"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="#local-6989586621682052878"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052880"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-275"></a><a name="mapList"><a href="TrieMap.html#mapList"><span class="hs-identifier">mapList</span></a></a><span> </span><a name="local-6989586621682052939"><a href="#local-6989586621682052939"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#LM"><span class="hs-identifier hs-var">LM</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lm_nil</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682052940"><a href="#local-6989586621682052940"><span class="hs-identifier">mnil</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">lm_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682052941"><a href="#local-6989586621682052941"><span class="hs-identifier">mcons</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#LM"><span class="hs-identifier hs-var">LM</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lm_nil</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621682052939"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052940"><span class="hs-identifier hs-var">mnil</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">lm_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#mapTM"><span class="hs-identifier hs-var">mapTM</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#mapTM"><span class="hs-identifier hs-var">mapTM</span></a><span> </span><a href="#local-6989586621682052939"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682052941"><span class="hs-identifier hs-var">mcons</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-identifier">lkList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052874"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621682052877"><a href="#local-6989586621682052877"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><a href="#local-6989586621682052875"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052874"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052877"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052877"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621682052875"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="#local-6989586621682052874"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052876"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052876"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-280"></a><a name="lkList"><a href="TrieMap.html#lkList"><span class="hs-identifier">lkList</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">lm_nil</span><span>
</span><a name="line-281"></a><span class="hs-identifier">lkList</span><span> </span><a name="local-6989586621682052942"><a href="#local-6989586621682052942"><span class="hs-identifier">lk</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621682052943"><a href="#local-6989586621682052943"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621682052944"><a href="#local-6989586621682052944"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">lm_cons</span><span> </span><a href="TrieMap.html#%3E.%3E"><span class="hs-operator hs-var">&gt;.&gt;</span></a><span> </span><a href="#local-6989586621682052942"><span class="hs-identifier hs-var">lk</span></a><span> </span><a href="#local-6989586621682052943"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;=&gt;</span><span> </span><a href="TrieMap.html#lkList"><span class="hs-identifier hs-var">lkList</span></a><span> </span><a href="#local-6989586621682052942"><span class="hs-identifier hs-var">lk</span></a><span> </span><a href="#local-6989586621682052944"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-identifier">xtList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052870"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621682052873"><a href="#local-6989586621682052873"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><a href="#local-6989586621682052871"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a><span> </span><a href="#local-6989586621682052873"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052870"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052873"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052870"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052873"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621682052871"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a><span> </span><a href="#local-6989586621682052872"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="#local-6989586621682052870"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052872"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="#local-6989586621682052870"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052872"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-285"></a><a name="xtList"><a href="TrieMap.html#xtList"><span class="hs-identifier">xtList</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><a name="local-6989586621682052945"><a href="#local-6989586621682052945"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052946"><a href="#local-6989586621682052946"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052946"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lm_nil</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052945"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">lm_nil</span><span> </span><a href="#local-6989586621682052946"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-286"></a><span class="hs-identifier">xtList</span><span> </span><a name="local-6989586621682052947"><a href="#local-6989586621682052947"><span class="hs-identifier">tr</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621682052948"><a href="#local-6989586621682052948"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621682052949"><a href="#local-6989586621682052949"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682052950"><a href="#local-6989586621682052950"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052951"><a href="#local-6989586621682052951"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052951"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lm_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">lm_cons</span><span> </span><a href="#local-6989586621682052951"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="TrieMap.html#%7C%3E"><span class="hs-operator hs-var">|&gt;</span></a><span> </span><a href="#local-6989586621682052947"><span class="hs-identifier hs-var">tr</span></a><span> </span><a href="#local-6989586621682052948"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="TrieMap.html#%7C%3E%3E"><span class="hs-operator hs-var">|&gt;&gt;</span></a><span> </span><a href="TrieMap.html#xtList"><span class="hs-identifier hs-var">xtList</span></a><span> </span><a href="#local-6989586621682052947"><span class="hs-identifier hs-var">tr</span></a><span> </span><a href="#local-6989586621682052949"><span class="hs-identifier hs-var">xs</span></a><span> </span><a href="#local-6989586621682052950"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span class="hs-identifier">fdList</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621682052867"><a href="#local-6989586621682052867"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621682052868"><a href="#local-6989586621682052868"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621682052869"><a href="#local-6989586621682052869"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052867"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-289"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052868"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052869"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052869"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#ListMap"><span class="hs-identifier hs-type">ListMap</span></a><span> </span><a href="#local-6989586621682052867"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052868"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052869"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052869"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-290"></a><a name="fdList"><a href="TrieMap.html#fdList"><span class="hs-identifier">fdList</span></a></a><span> </span><a name="local-6989586621682052952"><a href="#local-6989586621682052952"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052953"><a href="#local-6989586621682052953"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#foldMaybe"><span class="hs-identifier hs-var">foldMaybe</span></a><span> </span><a href="#local-6989586621682052952"><span class="hs-identifier hs-var">k</span></a><span>          </span><span class="hs-special">(</span><span class="hs-identifier">lm_nil</span><span> </span><a href="#local-6989586621682052953"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>           </span><span class="hs-operator hs-var">.</span><span> </span><a href="TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a><span>    </span><span class="hs-special">(</span><a href="TrieMap.html#fdList"><span class="hs-identifier hs-var">fdList</span></a><span> </span><a href="#local-6989586621682052952"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">lm_cons</span><span> </span><a href="#local-6989586621682052953"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-identifier">foldMaybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052865"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052866"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052866"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052865"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052866"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052866"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-294"></a><a name="foldMaybe"><a href="TrieMap.html#foldMaybe"><span class="hs-identifier">foldMaybe</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><a name="local-6989586621682052954"><a href="#local-6989586621682052954"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052954"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-295"></a><span class="hs-identifier">foldMaybe</span><span> </span><a name="local-6989586621682052955"><a href="#local-6989586621682052955"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682052956"><a href="#local-6989586621682052956"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682052957"><a href="#local-6989586621682052957"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682052955"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052956"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621682052957"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                   Basic maps
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-keyword">type</span><span> </span><a name="LiteralMap"><a href="TrieMap.html#LiteralMap"><span class="hs-identifier">LiteralMap</span></a></a><span>  </span><a name="local-6989586621682052805"><a href="#local-6989586621682052805"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><a href="#local-6989586621682052805"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                   GenMap
*                                                                      *
************************************************************************

Note [Compressed TrieMap]
~~~~~~~~~~~~~~~~~~~~~~~~~

The GenMap constructor augments TrieMaps with leaf compression.  This helps
solve the performance problem detailed in #9960: suppose we have a handful
H of entries in a TrieMap, each with a very large key, size K. If you fold over
such a TrieMap you'd expect time O(H). That would certainly be true of an
association list! But with TrieMap we actually have to navigate down a long
singleton structure to get to the elements, so it takes time O(K*H).  This
can really hurt on many type-level computation benchmarks:
see for example T9872d.

The point of a TrieMap is that you need to navigate to the point where only one
key remains, and then things should be fast.  So the point of a SingletonMap
is that, once we are down to a single (key,value) pair, we stop and
just use SingletonMap.

'EmptyMap' provides an even more basic (but essential) optimization: if there is
nothing in the map, don't bother building out the (possibly infinite) recursive
TrieMap structure!

Compressed triemaps are heavily used by CoreMap. So we have to mark some things
as INLINEABLE to permit specialization.
-}</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span class="hs-keyword">data</span><span> </span><a name="GenMap"><a href="TrieMap.html#GenMap"><span class="hs-identifier">GenMap</span></a></a><span> </span><a name="local-6989586621682052803"><a href="#local-6989586621682052803"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621682052804"><a href="#local-6989586621682052804"><span class="hs-identifier">a</span></a></a><span>
</span><a name="line-340"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="EmptyMap"><a href="TrieMap.html#EmptyMap"><span class="hs-identifier">EmptyMap</span></a></a><span>
</span><a name="line-341"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="SingletonMap"><a href="TrieMap.html#SingletonMap"><span class="hs-identifier">SingletonMap</span></a></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052803"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682052804"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-342"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="MultiMap"><a href="TrieMap.html#MultiMap"><span class="hs-identifier">MultiMap</span></a></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052803"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052804"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621682052820"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052821"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052820"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#GenMap"><span class="hs-identifier hs-type">GenMap</span></a><span> </span><a href="#local-6989586621682052821"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052820"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-345"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="TrieMap.html#EmptyMap"><span class="hs-identifier hs-var">EmptyMap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Empty map&quot;</span><span>
</span><a name="line-346"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#SingletonMap"><span class="hs-identifier hs-var">SingletonMap</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682052822"><a href="#local-6989586621682052822"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Singleton map&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621682052822"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-347"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#MultiMap"><span class="hs-identifier hs-var">MultiMap</span></a><span> </span><a name="local-6989586621682052823"><a href="#local-6989586621682052823"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621682052823"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-comment">-- TODO undecidable instance</span><span>
</span><a name="line-350"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052819"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052819"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#GenMap"><span class="hs-identifier hs-type">GenMap</span></a><span> </span><a href="#local-6989586621682052819"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-351"></a><span>   </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">Key</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#GenMap"><span class="hs-identifier hs-type">GenMap</span></a><span> </span><a href="#local-6989586621682052819"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052819"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-352"></a><span>   </span><a name="local-8214565720326827688"><a href="TrieMap.html#emptyTM"><span class="hs-identifier">emptyTM</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#EmptyMap"><span class="hs-identifier hs-var">EmptyMap</span></a><span>
</span><a name="line-353"></a><span>   </span><a name="local-8214565720326827689"><a href="TrieMap.html#lookupTM"><span class="hs-identifier">lookupTM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#lkG"><span class="hs-identifier hs-var">lkG</span></a><span>
</span><a name="line-354"></a><span>   </span><a name="local-8214565720326827690"><a href="TrieMap.html#alterTM"><span class="hs-identifier">alterTM</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#xtG"><span class="hs-identifier hs-var">xtG</span></a><span>
</span><a name="line-355"></a><span>   </span><a name="local-8214565720326827692"><a href="TrieMap.html#foldTM"><span class="hs-identifier">foldTM</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#fdG"><span class="hs-identifier hs-var">fdG</span></a><span>
</span><a name="line-356"></a><span>   </span><a name="local-8214565720326827691"><a href="TrieMap.html#mapTM"><span class="hs-identifier">mapTM</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#mapG"><span class="hs-identifier hs-var">mapG</span></a><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span class="hs-comment">--We want to be able to specialize these functions when defining eg</span><span>
</span><a name="line-359"></a><span class="hs-comment">--tries over (GenMap CoreExpr) which requires INLINEABLE</span><span>
</span><a name="line-360"></a><span>
</span><a name="line-361"></a><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">lkG</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-362"></a><span class="hs-identifier">lkG</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052863"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052863"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#GenMap"><span class="hs-identifier hs-type">GenMap</span></a><span> </span><a href="#local-6989586621682052863"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052864"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621682052864"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-363"></a><a name="lkG"><a href="TrieMap.html#lkG"><span class="hs-identifier">lkG</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="TrieMap.html#EmptyMap"><span class="hs-identifier hs-var">EmptyMap</span></a><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-364"></a><span class="hs-identifier">lkG</span><span> </span><a name="local-6989586621682052958"><a href="#local-6989586621682052958"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#SingletonMap"><span class="hs-identifier hs-var">SingletonMap</span></a><span> </span><a name="local-6989586621682052959"><a href="#local-6989586621682052959"><span class="hs-identifier">k'</span></a></a><span> </span><a name="local-6989586621682052960"><a href="#local-6989586621682052960"><span class="hs-identifier">v'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682052958"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621682052959"><span class="hs-identifier hs-var">k'</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682052960"><span class="hs-identifier hs-var">v'</span></a><span>
</span><a name="line-365"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-366"></a><span class="hs-identifier">lkG</span><span> </span><a name="local-6989586621682052961"><a href="#local-6989586621682052961"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#MultiMap"><span class="hs-identifier hs-var">MultiMap</span></a><span> </span><a name="local-6989586621682052962"><a href="#local-6989586621682052962"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#lookupTM"><span class="hs-identifier hs-var">lookupTM</span></a><span> </span><a href="#local-6989586621682052961"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052962"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">xtG</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-369"></a><span class="hs-identifier">xtG</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">(</span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052861"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052861"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TrieMap.html#Key"><span class="hs-identifier hs-type">Key</span></a><span> </span><a href="#local-6989586621682052861"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#XT"><span class="hs-identifier hs-type">XT</span></a><span> </span><a href="#local-6989586621682052862"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#GenMap"><span class="hs-identifier hs-type">GenMap</span></a><span> </span><a href="#local-6989586621682052861"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052862"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#GenMap"><span class="hs-identifier hs-type">GenMap</span></a><span> </span><a href="#local-6989586621682052861"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052862"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-370"></a><a name="xtG"><a href="TrieMap.html#xtG"><span class="hs-identifier">xtG</span></a></a><span> </span><a name="local-6989586621682052963"><a href="#local-6989586621682052963"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052964"><a href="#local-6989586621682052964"><span class="hs-identifier">f</span></a></a><span> </span><a href="TrieMap.html#EmptyMap"><span class="hs-identifier hs-var">EmptyMap</span></a><span>
</span><a name="line-371"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682052964"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-372"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682052965"><a href="#local-6989586621682052965"><span class="hs-identifier">v</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#SingletonMap"><span class="hs-identifier hs-var">SingletonMap</span></a><span> </span><a href="#local-6989586621682052963"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052965"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-373"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#EmptyMap"><span class="hs-identifier hs-var">EmptyMap</span></a><span>
</span><a name="line-374"></a><span class="hs-identifier">xtG</span><span> </span><a name="local-6989586621682052966"><a href="#local-6989586621682052966"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052967"><a href="#local-6989586621682052967"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621682052968"><a href="#local-6989586621682052968"><span class="hs-identifier">m</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TrieMap.html#SingletonMap"><span class="hs-identifier hs-var">SingletonMap</span></a><span> </span><a name="local-6989586621682052969"><a href="#local-6989586621682052969"><span class="hs-identifier">k'</span></a></a><span> </span><a name="local-6989586621682052970"><a href="#local-6989586621682052970"><span class="hs-identifier">v'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-375"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682052969"><span class="hs-identifier hs-var">k'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621682052966"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-376"></a><span>    </span><span class="hs-comment">-- The new key matches the (single) key already in the tree.  Hence,</span><span>
</span><a name="line-377"></a><span>    </span><span class="hs-comment">-- apply @f@ to @Just v'@ and build a singleton or empty map depending</span><span>
</span><a name="line-378"></a><span>    </span><span class="hs-comment">-- on the 'Just'/'Nothing' response respectively.</span><span>
</span><a name="line-379"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682052967"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682052970"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-380"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682052971"><a href="#local-6989586621682052971"><span class="hs-identifier">v''</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#SingletonMap"><span class="hs-identifier hs-var">SingletonMap</span></a><span> </span><a href="#local-6989586621682052969"><span class="hs-identifier hs-var">k'</span></a><span> </span><a href="#local-6989586621682052971"><span class="hs-identifier hs-var">v''</span></a><span>
</span><a name="line-381"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#EmptyMap"><span class="hs-identifier hs-var">EmptyMap</span></a><span>
</span><a name="line-382"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-383"></a><span>    </span><span class="hs-comment">-- We've hit a singleton tree for a different key than the one we are</span><span>
</span><a name="line-384"></a><span>    </span><span class="hs-comment">-- searching for. Hence apply @f@ to @Nothing@. If result is @Nothing@ then</span><span>
</span><a name="line-385"></a><span>    </span><span class="hs-comment">-- we can just return the old map. If not, we need a map with *two*</span><span>
</span><a name="line-386"></a><span>    </span><span class="hs-comment">-- entries. The easiest way to do that is to insert two items into an empty</span><span>
</span><a name="line-387"></a><span>    </span><span class="hs-comment">-- map of type @m a@.</span><span>
</span><a name="line-388"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682052967"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-389"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052968"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-390"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682052972"><a href="#local-6989586621682052972"><span class="hs-identifier">v</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#emptyTM"><span class="hs-identifier hs-var">emptyTM</span></a><span> </span><a href="TrieMap.html#%7C%3E"><span class="hs-operator hs-var">|&gt;</span></a><span> </span><a href="TrieMap.html#alterTM"><span class="hs-identifier hs-var">alterTM</span></a><span> </span><a href="#local-6989586621682052969"><span class="hs-identifier hs-var">k'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682052970"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-391"></a><span>                           </span><a href="TrieMap.html#%3E.%3E"><span class="hs-operator hs-var">&gt;.&gt;</span></a><span> </span><a href="TrieMap.html#alterTM"><span class="hs-identifier hs-var">alterTM</span></a><span> </span><a href="#local-6989586621682052966"><span class="hs-identifier hs-var">k</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682052972"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-392"></a><span>                           </span><a href="TrieMap.html#%3E.%3E"><span class="hs-operator hs-var">&gt;.&gt;</span></a><span> </span><a href="TrieMap.html#MultiMap"><span class="hs-identifier hs-var">MultiMap</span></a><span>
</span><a name="line-393"></a><span class="hs-identifier">xtG</span><span> </span><a name="local-6989586621682052973"><a href="#local-6989586621682052973"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052974"><a href="#local-6989586621682052974"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#MultiMap"><span class="hs-identifier hs-var">MultiMap</span></a><span> </span><a name="local-6989586621682052975"><a href="#local-6989586621682052975"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#MultiMap"><span class="hs-identifier hs-var">MultiMap</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#alterTM"><span class="hs-identifier hs-var">alterTM</span></a><span> </span><a href="#local-6989586621682052973"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052974"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052975"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-394"></a><span>
</span><a name="line-395"></a><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">mapG</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-396"></a><span class="hs-identifier">mapG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052858"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052859"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052860"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#GenMap"><span class="hs-identifier hs-type">GenMap</span></a><span> </span><a href="#local-6989586621682052858"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052859"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#GenMap"><span class="hs-identifier hs-type">GenMap</span></a><span> </span><a href="#local-6989586621682052858"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052860"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-397"></a><a name="mapG"><a href="TrieMap.html#mapG"><span class="hs-identifier">mapG</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="TrieMap.html#EmptyMap"><span class="hs-identifier hs-var">EmptyMap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#EmptyMap"><span class="hs-identifier hs-var">EmptyMap</span></a><span>
</span><a name="line-398"></a><span class="hs-identifier">mapG</span><span> </span><a name="local-6989586621682052976"><a href="#local-6989586621682052976"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#SingletonMap"><span class="hs-identifier hs-var">SingletonMap</span></a><span> </span><a name="local-6989586621682052977"><a href="#local-6989586621682052977"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621682052978"><a href="#local-6989586621682052978"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#SingletonMap"><span class="hs-identifier hs-var">SingletonMap</span></a><span> </span><a href="#local-6989586621682052977"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052976"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052978"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span class="hs-identifier">mapG</span><span> </span><a name="local-6989586621682052979"><a href="#local-6989586621682052979"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#MultiMap"><span class="hs-identifier hs-var">MultiMap</span></a><span> </span><a name="local-6989586621682052980"><a href="#local-6989586621682052980"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#MultiMap"><span class="hs-identifier hs-var">MultiMap</span></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#mapTM"><span class="hs-identifier hs-var">mapTM</span></a><span> </span><a href="#local-6989586621682052979"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621682052980"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-400"></a><span>
</span><a name="line-401"></a><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">fdG</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-402"></a><span class="hs-identifier">fdG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TrieMap.html#TrieMap"><span class="hs-identifier hs-type">TrieMap</span></a><span> </span><a href="#local-6989586621682052855"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682052856"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052857"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052857"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TrieMap.html#GenMap"><span class="hs-identifier hs-type">GenMap</span></a><span> </span><a href="#local-6989586621682052855"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621682052856"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052857"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052857"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-403"></a><a name="fdG"><a href="TrieMap.html#fdG"><span class="hs-identifier">fdG</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a href="TrieMap.html#EmptyMap"><span class="hs-identifier hs-var">EmptyMap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682052981"><a href="#local-6989586621682052981"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052981"><span class="hs-identifier hs-var">z</span></a><span>
</span><a name="line-404"></a><span class="hs-identifier">fdG</span><span> </span><a name="local-6989586621682052982"><a href="#local-6989586621682052982"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#SingletonMap"><span class="hs-identifier hs-var">SingletonMap</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682052983"><a href="#local-6989586621682052983"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682052984"><a href="#local-6989586621682052984"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682052982"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052983"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621682052984"><span class="hs-identifier hs-var">z</span></a><span>
</span><a name="line-405"></a><span class="hs-identifier">fdG</span><span> </span><a name="local-6989586621682052985"><a href="#local-6989586621682052985"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-special">(</span><a href="TrieMap.html#MultiMap"><span class="hs-identifier hs-var">MultiMap</span></a><span> </span><a name="local-6989586621682052986"><a href="#local-6989586621682052986"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TrieMap.html#foldTM"><span class="hs-identifier hs-var">foldTM</span></a><span> </span><a href="#local-6989586621682052985"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621682052986"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-406"></a></pre></body></html>