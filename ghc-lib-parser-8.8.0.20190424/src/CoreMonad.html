<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The AQUA Project, Glasgow University, 1993-1998

\section[CoreMonad]{The core pipeline monad}
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">CoreMonad</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-10"></a><span>    </span><span class="hs-comment">-- * Configuration of the core-to-core passes</span><span>
</span><a name="line-11"></a><span>    </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#runWhen"><span class="hs-identifier hs-var">runWhen</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#runMaybe"><span class="hs-identifier hs-var">runMaybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>    </span><a href="CoreMonad.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>    </span><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>    </span><a href="CoreMonad.html#pprPassDetails"><span class="hs-identifier hs-var">pprPassDetails</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-comment">-- * Plugins</span><span>
</span><a name="line-17"></a><span>    </span><a href="CoreMonad.html#CorePluginPass"><span class="hs-identifier hs-type">CorePluginPass</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#bindsOnlyPass"><span class="hs-identifier hs-var">bindsOnlyPass</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span>    </span><span class="hs-comment">-- * Counting</span><span>
</span><a name="line-20"></a><span>    </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#doSimplTick"><span class="hs-identifier hs-var">doSimplTick</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#doFreeSimplTick"><span class="hs-identifier hs-var">doFreeSimplTick</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#simplCountN"><span class="hs-identifier hs-var">simplCountN</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>    </span><a href="CoreMonad.html#pprSimplCount"><span class="hs-identifier hs-var">pprSimplCount</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#plusSimplCount"><span class="hs-identifier hs-var">plusSimplCount</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#zeroSimplCount"><span class="hs-identifier hs-var">zeroSimplCount</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>    </span><a href="CoreMonad.html#isZeroSimplCount"><span class="hs-identifier hs-var">isZeroSimplCount</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#hasDetailedCounts"><span class="hs-identifier hs-var">hasDetailedCounts</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>    </span><span class="hs-comment">-- * The monad</span><span>
</span><a name="line-25"></a><span>    </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#runCoreM"><span class="hs-identifier hs-var">runCoreM</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-comment">-- ** Reading from the monad</span><span>
</span><a name="line-28"></a><span>    </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#getRuleBase"><span class="hs-identifier hs-var">getRuleBase</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>    </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#getOrigNameCache"><span class="hs-identifier hs-var">getOrigNameCache</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#getPackageFamInstEnv"><span class="hs-identifier hs-var">getPackageFamInstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>    </span><a href="CoreMonad.html#getVisibleOrphanMods"><span class="hs-identifier hs-var">getVisibleOrphanMods</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>    </span><a href="CoreMonad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>    </span><span class="hs-comment">-- ** Writing to the monad</span><span>
</span><a name="line-34"></a><span>    </span><a href="CoreMonad.html#addSimplCount"><span class="hs-identifier hs-var">addSimplCount</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>    </span><span class="hs-comment">-- ** Lifting into the monad</span><span>
</span><a name="line-37"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#liftIOWithCount"><span class="hs-identifier hs-var">liftIOWithCount</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>    </span><a href="MonadUtils.html#liftIO1"><span class="hs-identifier hs-var">liftIO1</span></a><span class="hs-special">,</span><span> </span><a href="MonadUtils.html#liftIO2"><span class="hs-identifier hs-var">liftIO2</span></a><span class="hs-special">,</span><span> </span><a href="MonadUtils.html#liftIO3"><span class="hs-identifier hs-var">liftIO3</span></a><span class="hs-special">,</span><span> </span><a href="MonadUtils.html#liftIO4"><span class="hs-identifier hs-var">liftIO4</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-comment">-- ** Global initialization</span><span>
</span><a name="line-41"></a><span>    </span><a href="CoreMonad.html#reinitializeGlobals"><span class="hs-identifier hs-var">reinitializeGlobals</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>    </span><span class="hs-comment">-- ** Dealing with annotations</span><span>
</span><a name="line-44"></a><span>    </span><a href="CoreMonad.html#getAnnotations"><span class="hs-identifier hs-var">getAnnotations</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#getFirstAnnotations"><span class="hs-identifier hs-var">getFirstAnnotations</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>    </span><span class="hs-comment">-- ** Screen output</span><span>
</span><a name="line-47"></a><span>    </span><a href="CoreMonad.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#putMsgS"><span class="hs-identifier hs-var">putMsgS</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#errorMsgS"><span class="hs-identifier hs-var">errorMsgS</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#warnMsg"><span class="hs-identifier hs-var">warnMsg</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>    </span><a href="CoreMonad.html#fatalErrorMsg"><span class="hs-identifier hs-var">fatalErrorMsg</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#fatalErrorMsgS"><span class="hs-identifier hs-var">fatalErrorMsgS</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>    </span><a href="CoreMonad.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#debugTraceMsgS"><span class="hs-identifier hs-var">debugTraceMsgS</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>    </span><a href="CoreMonad.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a><span>
</span><a name="line-51"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">read</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="BasicTypes.html#CompilerPhase"><span class="hs-identifier hs-type">CompilerPhase</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="Annotations.html"><span class="hs-identifier">Annotations</span></a><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="IOEnv.html"><span class="hs-identifier">IOEnv</span></a><span> </span><span class="hs-keyword">hiding</span><span>     </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span class="hs-special">,</span><span> </span><a href="IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a><span class="hs-special">,</span><span> </span><a href="IOEnv.html#failWithM"><span class="hs-identifier hs-var">failWithM</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="IOEnv.html"><span class="hs-identifier">IOEnv</span></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Err</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span class="hs-special">(</span><span> </span><a href="ErrUtils.html#Severity"><span class="hs-identifier hs-type">Severity</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span class="hs-special">,</span><span> </span><a href="UniqFM.html#mapUFM"><span class="hs-identifier hs-var">mapUFM</span></a><span class="hs-special">,</span><span> </span><a href="UniqFM.html#filterUFM"><span class="hs-identifier hs-var">filterUFM</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="MonadUtils.html"><span class="hs-identifier">MonadUtils</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="NameCache.html"><span class="hs-identifier">NameCache</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Ord</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Dynamic</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.IORef</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MapStrict</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Alternative</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
              The CoreToDo type and related types
          Abstraction of core-to-core passes to run.
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-keyword">data</span><span> </span><a name="CoreToDo"><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier">CoreToDo</span></a></a><span>           </span><span class="hs-comment">-- These are diff core-to-core passes,</span><span>
</span><a name="line-95"></a><span>                        </span><span class="hs-comment">-- which may be invoked in any order,</span><span>
</span><a name="line-96"></a><span>                        </span><span class="hs-comment">-- as many times as you like.</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="CoreDoSimplify"><a href="CoreMonad.html#CoreDoSimplify"><span class="hs-identifier">CoreDoSimplify</span></a></a><span>      </span><span class="hs-comment">-- The core-to-core simplifier.</span><span>
</span><a name="line-99"></a><span>        </span><span class="hs-identifier hs-type">Int</span><span>                    </span><span class="hs-comment">-- Max iterations</span><span>
</span><a name="line-100"></a><span>        </span><a href="CoreMonad.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a><span>
</span><a name="line-101"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoPluginPass"><a href="CoreMonad.html#CoreDoPluginPass"><span class="hs-identifier">CoreDoPluginPass</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="CoreMonad.html#CorePluginPass"><span class="hs-identifier hs-type">CorePluginPass</span></a><span>
</span><a name="line-102"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoFloatInwards"><a href="CoreMonad.html#CoreDoFloatInwards"><span class="hs-identifier">CoreDoFloatInwards</span></a></a><span>
</span><a name="line-103"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoFloatOutwards"><a href="CoreMonad.html#CoreDoFloatOutwards"><span class="hs-identifier">CoreDoFloatOutwards</span></a></a><span> </span><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a><span>
</span><a name="line-104"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreLiberateCase"><a href="CoreMonad.html#CoreLiberateCase"><span class="hs-identifier">CoreLiberateCase</span></a></a><span>
</span><a name="line-105"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoPrintCore"><a href="CoreMonad.html#CoreDoPrintCore"><span class="hs-identifier">CoreDoPrintCore</span></a></a><span>
</span><a name="line-106"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoStaticArgs"><a href="CoreMonad.html#CoreDoStaticArgs"><span class="hs-identifier">CoreDoStaticArgs</span></a></a><span>
</span><a name="line-107"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoCallArity"><a href="CoreMonad.html#CoreDoCallArity"><span class="hs-identifier">CoreDoCallArity</span></a></a><span>
</span><a name="line-108"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoExitify"><a href="CoreMonad.html#CoreDoExitify"><span class="hs-identifier">CoreDoExitify</span></a></a><span>
</span><a name="line-109"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoStrictness"><a href="CoreMonad.html#CoreDoStrictness"><span class="hs-identifier">CoreDoStrictness</span></a></a><span>
</span><a name="line-110"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoWorkerWrapper"><a href="CoreMonad.html#CoreDoWorkerWrapper"><span class="hs-identifier">CoreDoWorkerWrapper</span></a></a><span>
</span><a name="line-111"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoSpecialising"><a href="CoreMonad.html#CoreDoSpecialising"><span class="hs-identifier">CoreDoSpecialising</span></a></a><span>
</span><a name="line-112"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoSpecConstr"><a href="CoreMonad.html#CoreDoSpecConstr"><span class="hs-identifier">CoreDoSpecConstr</span></a></a><span>
</span><a name="line-113"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreCSE"><a href="CoreMonad.html#CoreCSE"><span class="hs-identifier">CoreCSE</span></a></a><span>
</span><a name="line-114"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoRuleCheck"><a href="CoreMonad.html#CoreDoRuleCheck"><span class="hs-identifier">CoreDoRuleCheck</span></a></a><span> </span><a href="BasicTypes.html#CompilerPhase"><span class="hs-identifier hs-type">CompilerPhase</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>   </span><span class="hs-comment">-- Check for non-application of rules</span><span>
</span><a name="line-115"></a><span>                                           </span><span class="hs-comment">-- matching this string</span><span>
</span><a name="line-116"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoNothing"><a href="CoreMonad.html#CoreDoNothing"><span class="hs-identifier">CoreDoNothing</span></a></a><span>                </span><span class="hs-comment">-- Useful when building up</span><span>
</span><a name="line-117"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDoPasses"><a href="CoreMonad.html#CoreDoPasses"><span class="hs-identifier">CoreDoPasses</span></a></a><span> </span><span class="hs-special">[</span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- lists of these things</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDesugar"><a href="CoreMonad.html#CoreDesugar"><span class="hs-identifier">CoreDesugar</span></a></a><span>    </span><span class="hs-comment">-- Right after desugaring, no simple optimisation yet!</span><span>
</span><a name="line-120"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreDesugarOpt"><a href="CoreMonad.html#CoreDesugarOpt"><span class="hs-identifier">CoreDesugarOpt</span></a></a><span> </span><span class="hs-comment">-- CoreDesugarXXX: Not strictly a core-to-core pass, but produces</span><span>
</span><a name="line-121"></a><span>                       </span><span class="hs-comment">--                 Core output, and hence useful to pass to endPass</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreTidy"><a href="CoreMonad.html#CoreTidy"><span class="hs-identifier">CoreTidy</span></a></a><span>
</span><a name="line-124"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CorePrep"><a href="CoreMonad.html#CorePrep"><span class="hs-identifier">CorePrep</span></a></a><span>
</span><a name="line-125"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CoreOccurAnal"><a href="CoreMonad.html#CoreOccurAnal"><span class="hs-identifier">CoreOccurAnal</span></a></a><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-128"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoSimplify"><span class="hs-identifier hs-var">CoreDoSimplify</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Simplifier&quot;</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoPluginPass"><span class="hs-identifier hs-var">CoreDoPluginPass</span></a><span> </span><a name="local-6989586621684246519"><a href="#local-6989586621684246519"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Core plugin: &quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621684246519"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-130"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoFloatInwards"><span class="hs-identifier hs-var">CoreDoFloatInwards</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Float inwards&quot;</span><span>
</span><a name="line-131"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoFloatOutwards"><span class="hs-identifier hs-var">CoreDoFloatOutwards</span></a><span> </span><a name="local-6989586621684246520"><a href="#local-6989586621684246520"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Float out&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246520"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreLiberateCase"><span class="hs-identifier hs-var">CoreLiberateCase</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Liberate case&quot;</span><span>
</span><a name="line-133"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoStaticArgs"><span class="hs-identifier hs-var">CoreDoStaticArgs</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Static argument&quot;</span><span>
</span><a name="line-134"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoCallArity"><span class="hs-identifier hs-var">CoreDoCallArity</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Called arity analysis&quot;</span><span>
</span><a name="line-135"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoExitify"><span class="hs-identifier hs-var">CoreDoExitify</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Exitification transformation&quot;</span><span>
</span><a name="line-136"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoStrictness"><span class="hs-identifier hs-var">CoreDoStrictness</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Demand analysis&quot;</span><span>
</span><a name="line-137"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoWorkerWrapper"><span class="hs-identifier hs-var">CoreDoWorkerWrapper</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Worker Wrapper binds&quot;</span><span>
</span><a name="line-138"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoSpecialising"><span class="hs-identifier hs-var">CoreDoSpecialising</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Specialise&quot;</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoSpecConstr"><span class="hs-identifier hs-var">CoreDoSpecConstr</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;SpecConstr&quot;</span><span>
</span><a name="line-140"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreCSE"><span class="hs-identifier hs-var">CoreCSE</span></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Common sub-expression&quot;</span><span>
</span><a name="line-141"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDesugar"><span class="hs-identifier hs-var">CoreDesugar</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Desugar (before optimization)&quot;</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDesugarOpt"><span class="hs-identifier hs-var">CoreDesugarOpt</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Desugar (after optimization)&quot;</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreTidy"><span class="hs-identifier hs-var">CoreTidy</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Tidy Core&quot;</span><span>
</span><a name="line-144"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CorePrep"><span class="hs-identifier hs-var">CorePrep</span></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CorePrep&quot;</span><span>
</span><a name="line-145"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreOccurAnal"><span class="hs-identifier hs-var">CoreOccurAnal</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Occurrence analysis&quot;</span><span>
</span><a name="line-146"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoPrintCore"><span class="hs-identifier hs-var">CoreDoPrintCore</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Print core&quot;</span><span>
</span><a name="line-147"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoRuleCheck"><span class="hs-identifier hs-var">CoreDoRuleCheck</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Rule check&quot;</span><span>
</span><a name="line-148"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CoreMonad.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CoreDoNothing&quot;</span><span>
</span><a name="line-149"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoPasses"><span class="hs-identifier hs-var">CoreDoPasses</span></a><span> </span><a name="local-6989586621684246521"><a href="#local-6989586621684246521"><span class="hs-identifier">passes</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CoreDoPasses&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246521"><span class="hs-identifier hs-var">passes</span></a><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-identifier">pprPassDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-152"></a><a name="pprPassDetails"><a href="CoreMonad.html#pprPassDetails"><span class="hs-identifier">pprPassDetails</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreDoSimplify"><span class="hs-identifier hs-var">CoreDoSimplify</span></a><span> </span><a name="local-6989586621684246531"><a href="#local-6989586621684246531"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621684246532"><a href="#local-6989586621684246532"><span class="hs-identifier">md</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Max iterations =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-6989586621684246531"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-153"></a><span>                                            </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246532"><span class="hs-identifier hs-var">md</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-154"></a><span class="hs-identifier">pprPassDetails</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-keyword">data</span><span> </span><a name="SimplMode"><a href="CoreMonad.html#SimplMode"><span class="hs-identifier">SimplMode</span></a></a><span>             </span><span class="hs-comment">-- See comments in SimplMonad</span><span>
</span><a name="line-157"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="SimplMode"><a href="CoreMonad.html#SimplMode"><span class="hs-identifier">SimplMode</span></a></a><span>
</span><a name="line-158"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="sm_names"><a href="CoreMonad.html#sm_names"><span class="hs-identifier">sm_names</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Name(s) of the phase</span><span>
</span><a name="line-159"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_phase"><a href="CoreMonad.html#sm_phase"><span class="hs-identifier">sm_phase</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#CompilerPhase"><span class="hs-identifier hs-type">CompilerPhase</span></a><span>
</span><a name="line-160"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_dflags"><a href="CoreMonad.html#sm_dflags"><span class="hs-identifier">sm_dflags</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-comment">-- Just for convenient non-monadic</span><span>
</span><a name="line-161"></a><span>                                    </span><span class="hs-comment">-- access; we don't override these</span><span>
</span><a name="line-162"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_rules"><a href="CoreMonad.html#sm_rules"><span class="hs-identifier">sm_rules</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>     </span><span class="hs-comment">-- Whether RULES are enabled</span><span>
</span><a name="line-163"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_inline"><a href="CoreMonad.html#sm_inline"><span class="hs-identifier">sm_inline</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>     </span><span class="hs-comment">-- Whether inlining is enabled</span><span>
</span><a name="line-164"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_case_case"><a href="CoreMonad.html#sm_case_case"><span class="hs-identifier">sm_case_case</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>     </span><span class="hs-comment">-- Whether case-of-case is enabled</span><span>
</span><a name="line-165"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="sm_eta_expand"><a href="CoreMonad.html#sm_eta_expand"><span class="hs-identifier">sm_eta_expand</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>     </span><span class="hs-comment">-- Whether eta-expansion is enabled</span><span>
</span><a name="line-166"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CoreMonad.html#SimplMode"><span class="hs-identifier hs-type">SimplMode</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-169"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplMode"><span class="hs-identifier hs-var">SimplMode</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sm_phase</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246510"><a href="#local-6989586621684246510"><span class="hs-identifier">p</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sm_names</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246511"><a href="#local-6989586621684246511"><span class="hs-identifier">ss</span></a></a><span>
</span><a name="line-170"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sm_rules</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246512"><a href="#local-6989586621684246512"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sm_inline</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246513"><a href="#local-6989586621684246513"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-171"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sm_eta_expand</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246514"><a href="#local-6989586621684246514"><span class="hs-identifier">eta</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sm_case_case</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246515"><a href="#local-6989586621684246515"><span class="hs-identifier">cc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;SimplMode&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><span>
</span><a name="line-173"></a><span>         </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Phase =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246510"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span>
</span><a name="line-174"></a><span>               </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">intersperse</span><span> </span><span class="hs-string">&quot;,&quot;</span><span> </span><a href="#local-6989586621684246511"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-175"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684246516"><span class="hs-identifier hs-var">pp_flag</span></a><span> </span><a href="#local-6989586621684246513"><span class="hs-identifier hs-var">i</span></a><span>   </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;inline&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-176"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684246516"><span class="hs-identifier hs-var">pp_flag</span></a><span> </span><a href="#local-6989586621684246512"><span class="hs-identifier hs-var">r</span></a><span>   </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;rules&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-177"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684246516"><span class="hs-identifier hs-var">pp_flag</span></a><span> </span><a href="#local-6989586621684246514"><span class="hs-identifier hs-var">eta</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;eta-expand&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-178"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684246516"><span class="hs-identifier hs-var">pp_flag</span></a><span> </span><a href="#local-6989586621684246515"><span class="hs-identifier hs-var">cc</span></a><span>  </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;case-of-case&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>         </span><span class="hs-keyword">where</span><span>
</span><a name="line-180"></a><span>           </span><a name="local-6989586621684246516"><a href="#local-6989586621684246516"><span class="hs-identifier">pp_flag</span></a></a><span> </span><a name="local-6989586621684246517"><a href="#local-6989586621684246517"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621684246518"><a href="#local-6989586621684246518"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppUnless"><span class="hs-identifier hs-var">ppUnless</span></a><span> </span><a href="#local-6989586621684246517"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;no&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a><span> </span><a href="#local-6989586621684246518"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span class="hs-keyword">data</span><span> </span><a name="FloatOutSwitches"><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier">FloatOutSwitches</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="FloatOutSwitches"><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier">FloatOutSwitches</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-183"></a><span>  </span><a name="floatOutLambdas"><a href="CoreMonad.html#floatOutLambdas"><span class="hs-identifier">floatOutLambdas</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^ Just n &lt;=&gt; float lambdas to top level, if</span><span>
</span><a name="line-184"></a><span>                                   </span><span class="hs-comment">-- doing so will abstract over n or fewer</span><span>
</span><a name="line-185"></a><span>                                   </span><span class="hs-comment">-- value variables</span><span>
</span><a name="line-186"></a><span>                                   </span><span class="hs-comment">-- Nothing &lt;=&gt; float all lambdas to top level,</span><span>
</span><a name="line-187"></a><span>                                   </span><span class="hs-comment">--             regardless of how many free variables</span><span>
</span><a name="line-188"></a><span>                                   </span><span class="hs-comment">-- Just 0 is the vanilla case: float a lambda</span><span>
</span><a name="line-189"></a><span>                                   </span><span class="hs-comment">--    iff it has no free vars</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span>  </span><a name="floatOutConstants"><a href="CoreMonad.html#floatOutConstants"><span class="hs-identifier">floatOutConstants</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ True &lt;=&gt; float constants to top level,</span><span>
</span><a name="line-192"></a><span>                                   </span><span class="hs-comment">--            even if they do not escape a lambda</span><span>
</span><a name="line-193"></a><span>  </span><a name="floatOutOverSatApps"><a href="CoreMonad.html#floatOutOverSatApps"><span class="hs-identifier">floatOutOverSatApps</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>
</span><a name="line-194"></a><span>                             </span><span class="hs-comment">-- ^ True &lt;=&gt; float out over-saturated applications</span><span>
</span><a name="line-195"></a><span>                             </span><span class="hs-comment">--            based on arity information.</span><span>
</span><a name="line-196"></a><span>                             </span><span class="hs-comment">-- See Note [Floating over-saturated applications]</span><span>
</span><a name="line-197"></a><span>                             </span><span class="hs-comment">-- in SetLevels</span><span>
</span><a name="line-198"></a><span>  </span><a name="floatToTopLevelOnly"><a href="CoreMonad.html#floatToTopLevelOnly"><span class="hs-identifier">floatToTopLevelOnly</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>      </span><span class="hs-comment">-- ^ Allow floating to the top level only.</span><span>
</span><a name="line-199"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-200"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-201"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#pprFloatOutSwitches"><span class="hs-identifier hs-var">pprFloatOutSwitches</span></a><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-identifier">pprFloatOutSwitches</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#FloatOutSwitches"><span class="hs-identifier hs-type">FloatOutSwitches</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-204"></a><a name="pprFloatOutSwitches"><a href="CoreMonad.html#pprFloatOutSwitches"><span class="hs-identifier">pprFloatOutSwitches</span></a></a><span> </span><a name="local-6989586621684246533"><a href="#local-6989586621684246533"><span class="hs-identifier">sw</span></a></a><span>
</span><a name="line-205"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;FOS&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-206"></a><span>     </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-207"></a><span>     </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Lam =&quot;</span><span>    </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">floatOutLambdas</span><span> </span><a href="#local-6989586621684246533"><span class="hs-identifier hs-var">sw</span></a><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Consts =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">floatOutConstants</span><span> </span><a href="#local-6989586621684246533"><span class="hs-identifier hs-var">sw</span></a><span class="hs-special">)</span><span>
</span><a name="line-209"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;OverSatApps =&quot;</span><span>   </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">floatOutOverSatApps</span><span> </span><a href="#local-6989586621684246533"><span class="hs-identifier hs-var">sw</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-comment">-- The core-to-core pass ordering is derived from the DynFlags:</span><span>
</span><a name="line-212"></a><span class="hs-identifier">runWhen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span>
</span><a name="line-213"></a><a name="runWhen"><a href="CoreMonad.html#runWhen"><span class="hs-identifier">runWhen</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><a name="local-6989586621684246534"><a href="#local-6989586621684246534"><span class="hs-identifier">do_this</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246534"><span class="hs-identifier hs-var">do_this</span></a><span>
</span><a name="line-214"></a><span class="hs-identifier">runWhen</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-identifier">runMaybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621684246530"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246530"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreToDo"><span class="hs-identifier hs-type">CoreToDo</span></a><span>
</span><a name="line-217"></a><a name="runMaybe"><a href="CoreMonad.html#runMaybe"><span class="hs-identifier">runMaybe</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684246535"><a href="#local-6989586621684246535"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684246536"><a href="#local-6989586621684246536"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246536"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684246535"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-218"></a><span class="hs-identifier">runMaybe</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreDoNothing"><span class="hs-identifier hs-var">CoreDoNothing</span></a><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span class="hs-comment">{-

************************************************************************
*                                                                      *
             Types for Plugins
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-228"></a><span>
</span><a name="line-229"></a><span class="hs-comment">-- | A description of the plugin pass itself</span><span>
</span><a name="line-230"></a><span class="hs-keyword">type</span><span> </span><a name="CorePluginPass"><a href="CoreMonad.html#CorePluginPass"><span class="hs-identifier">CorePluginPass</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-identifier">bindsOnlyPass</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="CoreSyn.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span>
</span><a name="line-233"></a><a name="bindsOnlyPass"><a href="CoreMonad.html#bindsOnlyPass"><span class="hs-identifier">bindsOnlyPass</span></a></a><span> </span><a name="local-6989586621684246537"><a href="#local-6989586621684246537"><span class="hs-identifier">pass</span></a></a><span> </span><a name="local-6989586621684246538"><a href="#local-6989586621684246538"><span class="hs-identifier">guts</span></a></a><span>
</span><a name="line-234"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621684246539"><a href="#local-6989586621684246539"><span class="hs-identifier">binds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684246537"><span class="hs-identifier hs-var">pass</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mg_binds</span><span> </span><a href="#local-6989586621684246538"><span class="hs-identifier hs-var">guts</span></a><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246538"><span class="hs-identifier hs-var">guts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mg_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246539"><span class="hs-identifier hs-var">binds'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Counting and logging
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-identifier">getVerboseSimplStats</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-246"></a><a name="getVerboseSimplStats"><a href="CoreMonad.html#getVerboseSimplStats"><span class="hs-identifier">getVerboseSimplStats</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#getPprDebug"><span class="hs-identifier hs-var">getPprDebug</span></a><span>          </span><span class="hs-comment">-- For now, anyway</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span class="hs-identifier">zeroSimplCount</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span>
</span><a name="line-249"></a><span class="hs-identifier">isZeroSimplCount</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-250"></a><span class="hs-identifier">hasDetailedCounts</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-251"></a><span class="hs-identifier">pprSimplCount</span><span>      </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-252"></a><span class="hs-identifier">doSimplTick</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span>
</span><a name="line-253"></a><span class="hs-identifier">doFreeSimplTick</span><span>    </span><span class="hs-glyph">::</span><span>             </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span>
</span><a name="line-254"></a><span class="hs-identifier">plusSimplCount</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-keyword">data</span><span> </span><a name="SimplCount"><a href="CoreMonad.html#SimplCount"><span class="hs-identifier">SimplCount</span></a></a><span>
</span><a name="line-257"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="VerySimplCount"><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier">VerySimplCount</span></a></a><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>        </span><span class="hs-comment">-- Used when don't want detailed stats</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="SimplCount"><a href="CoreMonad.html#SimplCount"><span class="hs-identifier">SimplCount</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-260"></a><span>        </span><a name="ticks"><a href="CoreMonad.html#ticks"><span class="hs-identifier">ticks</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- Total ticks</span><span>
</span><a name="line-261"></a><span>        </span><a name="details"><a href="CoreMonad.html#details"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="CoreMonad.html#TickCounts"><span class="hs-identifier hs-type">TickCounts</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- How many of each type</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span>        </span><a name="n_log"><a href="CoreMonad.html#n_log"><span class="hs-identifier">n_log</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- N</span><span>
</span><a name="line-264"></a><span>        </span><a name="log1"><a href="CoreMonad.html#log1"><span class="hs-identifier">log1</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- Last N events; &lt;= opt_HistorySize,</span><span>
</span><a name="line-265"></a><span>                                </span><span class="hs-comment">--   most recent first</span><span>
</span><a name="line-266"></a><span>        </span><a name="log2"><a href="CoreMonad.html#log2"><span class="hs-identifier">log2</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Last opt_HistorySize events before that</span><span>
</span><a name="line-267"></a><span>                                </span><span class="hs-comment">-- Having log1, log2 lets us accumulate the</span><span>
</span><a name="line-268"></a><span>                                </span><span class="hs-comment">-- recent history reasonably efficiently</span><span>
</span><a name="line-269"></a><span>     </span><span class="hs-special">}</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-keyword">type</span><span> </span><a name="TickCounts"><a href="CoreMonad.html#TickCounts"><span class="hs-identifier">TickCounts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span class="hs-identifier">simplCountN</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-274"></a><a name="simplCountN"><a href="CoreMonad.html#simplCountN"><span class="hs-identifier">simplCountN</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-6989586621684246540"><a href="#local-6989586621684246540"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246540"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-275"></a><span class="hs-identifier">simplCountN</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246541"><a href="#local-6989586621684246541"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246541"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><a name="zeroSimplCount"><a href="CoreMonad.html#zeroSimplCount"><span class="hs-identifier">zeroSimplCount</span></a></a><span> </span><a name="local-6989586621684246542"><a href="#local-6989586621684246542"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-278"></a><span>                </span><span class="hs-comment">-- This is where we decide whether to do</span><span>
</span><a name="line-279"></a><span>                </span><span class="hs-comment">-- the VerySimpl version or the full-stats version</span><span>
</span><a name="line-280"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#dopt"><span class="hs-identifier hs-var">dopt</span></a><span> </span><a href="DynFlags.html#Opt_D_dump_simpl_stats"><span class="hs-identifier hs-var">Opt_D_dump_simpl_stats</span></a><span> </span><a href="#local-6989586621684246542"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-281"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.empty</span><span class="hs-special">,</span><span>
</span><a name="line-282"></a><span>                </span><span class="hs-identifier">n_log</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">log1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">log2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><a name="line-283"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-284"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><a name="isZeroSimplCount"><a href="CoreMonad.html#isZeroSimplCount"><span class="hs-identifier">isZeroSimplCount</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-6989586621684246543"><a href="#local-6989586621684246543"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246543"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">==</span><span class="hs-number">0</span><span>
</span><a name="line-287"></a><span class="hs-identifier">isZeroSimplCount</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246544"><a href="#local-6989586621684246544"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246544"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">==</span><span class="hs-number">0</span><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><a name="hasDetailedCounts"><a href="CoreMonad.html#hasDetailedCounts"><span class="hs-identifier">hasDetailedCounts</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-290"></a><span class="hs-identifier">hasDetailedCounts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><a name="doFreeSimplTick"><a href="CoreMonad.html#doFreeSimplTick"><span class="hs-identifier">doFreeSimplTick</span></a></a><span> </span><a name="local-6989586621684246545"><a href="#local-6989586621684246545"><span class="hs-identifier">tick</span></a></a><span> </span><a name="local-6989586621684246546"><a href="#local-6989586621684246546"><span class="hs-identifier">sc</span></a></a><span class="hs-glyph">@</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246547"><a href="#local-6989586621684246547"><span class="hs-identifier">dts</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-293"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246546"><span class="hs-identifier hs-var">sc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246547"><span class="hs-identifier hs-var">dts</span></a><span> </span><span class="hs-special">`</span><a href="CoreMonad.html#addTick"><span class="hs-identifier hs-var">addTick</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246545"><span class="hs-identifier hs-var">tick</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-294"></a><span class="hs-identifier">doFreeSimplTick</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684246548"><a href="#local-6989586621684246548"><span class="hs-identifier">sc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246548"><span class="hs-identifier hs-var">sc</span></a><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><a name="doSimplTick"><a href="CoreMonad.html#doSimplTick"><span class="hs-identifier">doSimplTick</span></a></a><span> </span><a name="local-6989586621684246549"><a href="#local-6989586621684246549"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684246550"><a href="#local-6989586621684246550"><span class="hs-identifier">tick</span></a></a><span>
</span><a name="line-297"></a><span>    </span><a name="local-6989586621684246551"><a href="#local-6989586621684246551"><span class="hs-identifier">sc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246552"><a href="#local-6989586621684246552"><span class="hs-identifier">tks</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246553"><a href="#local-6989586621684246553"><span class="hs-identifier">dts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">n_log</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246554"><a href="#local-6989586621684246554"><span class="hs-identifier">nl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">log1</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246555"><a href="#local-6989586621684246555"><span class="hs-identifier">l1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-298"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684246554"><span class="hs-identifier hs-var">nl</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">historySize</span><span> </span><a href="#local-6989586621684246549"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246556"><span class="hs-identifier hs-var">sc1</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">n_log</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">log1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684246550"><span class="hs-identifier hs-var">tick</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">log2</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246555"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-299"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246556"><span class="hs-identifier hs-var">sc1</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">n_log</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246554"><span class="hs-identifier hs-var">nl</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">log1</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246550"><span class="hs-identifier hs-var">tick</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684246555"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-300"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-301"></a><span>    </span><a name="local-6989586621684246556"><a href="#local-6989586621684246556"><span class="hs-identifier">sc1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246551"><span class="hs-identifier hs-var">sc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246552"><span class="hs-identifier hs-var">tks</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246553"><span class="hs-identifier hs-var">dts</span></a><span> </span><span class="hs-special">`</span><a href="CoreMonad.html#addTick"><span class="hs-identifier hs-var">addTick</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246550"><span class="hs-identifier hs-var">tick</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-identifier">doSimplTick</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-6989586621684246557"><a href="#local-6989586621684246557"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246557"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-identifier">addTick</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#TickCounts"><span class="hs-identifier hs-type">TickCounts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#TickCounts"><span class="hs-identifier hs-type">TickCounts</span></a><span>
</span><a name="line-307"></a><a name="addTick"><a href="CoreMonad.html#addTick"><span class="hs-identifier">addTick</span></a></a><span> </span><a name="local-6989586621684246558"><a href="#local-6989586621684246558"><span class="hs-identifier">fm</span></a></a><span> </span><a name="local-6989586621684246559"><a href="#local-6989586621684246559"><span class="hs-identifier">tick</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MapStrict.insertWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684246559"><span class="hs-identifier hs-var">tick</span></a><span> </span><span class="hs-number">1</span><span> </span><a href="#local-6989586621684246558"><span class="hs-identifier hs-var">fm</span></a><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><a name="plusSimplCount"><a href="CoreMonad.html#plusSimplCount"><span class="hs-identifier">plusSimplCount</span></a></a><span> </span><a name="local-6989586621684246560"><a href="#local-6989586621684246560"><span class="hs-identifier">sc1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246561"><a href="#local-6989586621684246561"><span class="hs-identifier">tks1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246562"><a href="#local-6989586621684246562"><span class="hs-identifier">dts1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-310"></a><span>               </span><a name="local-6989586621684246563"><a href="#local-6989586621684246563"><span class="hs-identifier">sc2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246564"><a href="#local-6989586621684246564"><span class="hs-identifier">tks2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246565"><a href="#local-6989586621684246565"><span class="hs-identifier">dts2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-311"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246566"><span class="hs-identifier hs-var">log_base</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246561"><span class="hs-identifier hs-var">tks1</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684246564"><span class="hs-identifier hs-var">tks2</span></a><span>
</span><a name="line-312"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MapStrict.unionWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684246562"><span class="hs-identifier hs-var">dts1</span></a><span> </span><a href="#local-6989586621684246565"><span class="hs-identifier hs-var">dts2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-313"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-314"></a><span>        </span><span class="hs-comment">-- A hackish way of getting recent log info</span><span>
</span><a name="line-315"></a><span>    </span><a name="local-6989586621684246566"><a href="#local-6989586621684246566"><span class="hs-identifier">log_base</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">log1</span><span> </span><a href="#local-6989586621684246563"><span class="hs-identifier hs-var">sc2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246560"><span class="hs-identifier hs-var">sc1</span></a><span>    </span><span class="hs-comment">-- Nothing at all in sc2</span><span>
</span><a name="line-316"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">log2</span><span> </span><a href="#local-6989586621684246563"><span class="hs-identifier hs-var">sc2</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246563"><span class="hs-identifier hs-var">sc2</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">log2</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">log1</span><span> </span><a href="#local-6989586621684246560"><span class="hs-identifier hs-var">sc1</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-317"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246563"><span class="hs-identifier hs-var">sc2</span></a><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-identifier">plusSimplCount</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-6989586621684246567"><a href="#local-6989586621684246567"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-6989586621684246568"><a href="#local-6989586621684246568"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246567"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684246568"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-320"></a><span class="hs-identifier">plusSimplCount</span><span> </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;plusSimplCount&quot;</span><span>
</span><a name="line-321"></a><span>       </span><span class="hs-comment">-- We use one or the other consistently</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><a name="pprSimplCount"><a href="CoreMonad.html#pprSimplCount"><span class="hs-identifier">pprSimplCount</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#VerySimplCount"><span class="hs-identifier hs-var">VerySimplCount</span></a><span> </span><a name="local-6989586621684246569"><a href="#local-6989586621684246569"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Total ticks:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-6989586621684246569"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-324"></a><span class="hs-identifier">pprSimplCount</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-var">SimplCount</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ticks</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246570"><a href="#local-6989586621684246570"><span class="hs-identifier">tks</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">details</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246571"><a href="#local-6989586621684246571"><span class="hs-identifier">dts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">log1</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246572"><a href="#local-6989586621684246572"><span class="hs-identifier">l1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">log2</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684246573"><a href="#local-6989586621684246573"><span class="hs-identifier">l2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-325"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Total ticks:    &quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-6989586621684246570"><span class="hs-identifier hs-var">tks</span></a><span class="hs-special">,</span><span>
</span><a name="line-326"></a><span>          </span><a href="Outputable.html#blankLine"><span class="hs-identifier hs-var">blankLine</span></a><span class="hs-special">,</span><span>
</span><a name="line-327"></a><span>          </span><a href="CoreMonad.html#pprTickCounts"><span class="hs-identifier hs-var">pprTickCounts</span></a><span> </span><a href="#local-6989586621684246571"><span class="hs-identifier hs-var">dts</span></a><span class="hs-special">,</span><span>
</span><a name="line-328"></a><span>          </span><a href="CoreMonad.html#getVerboseSimplStats"><span class="hs-identifier hs-var">getVerboseSimplStats</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684246574"><a href="#local-6989586621684246574"><span class="hs-identifier">dbg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684246574"><span class="hs-identifier hs-var">dbg</span></a><span>
</span><a name="line-329"></a><span>          </span><span class="hs-keyword">then</span><span>
</span><a name="line-330"></a><span>                </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#blankLine"><span class="hs-identifier hs-var">blankLine</span></a><span class="hs-special">,</span><span>
</span><a name="line-331"></a><span>                      </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Log (most recent first)&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-332"></a><span>                      </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246572"><span class="hs-identifier hs-var">l1</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246573"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-333"></a><span>          </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a><span>
</span><a name="line-334"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-comment">{- Note [Which transformations are innocuous]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
At one point (Jun 18) I wondered if some transformations (ticks)
might be  &quot;innocuous&quot;, in the sense that they do not unlock a later
transformation that does not occur in the same pass.  If so, we could
refrain from bumping the overall tick-count for such innocuous
transformations, and perhaps terminate the simplifier one pass
earlier.

BUt alas I found that virtually nothing was innocuous!  This Note
just records what I learned, in case anyone wants to try again.

These transformations are not innocuous:

*** NB: I think these ones could be made innocuous
          EtaExpansion
          LetFloatFromLet

LetFloatFromLet
    x = K (let z = e2 in Just z)
  prepareRhs transforms to
    x2 = let z=e2 in Just z
    x  = K xs
  And now more let-floating can happen in the
  next pass, on x2

PreInlineUnconditionally
  Example in spectral/cichelli/Auxil
     hinsert = ...let lo = e in
                  let j = ...lo... in
                  case x of
                    False -&gt; ()
                    True -&gt; case lo of I# lo' -&gt;
                              ...j...
  When we PreInlineUnconditionally j, lo's occ-info changes to once,
  so it can be PreInlineUnconditionally in the next pass, and a
  cascade of further things can happen.

PostInlineUnconditionally
  let x = e in
  let y = ...x.. in
  case .. of { A -&gt; ...x...y...
               B -&gt; ...x...y... }
  Current postinlineUnconditinaly will inline y, and then x; sigh.

  But PostInlineUnconditionally might also unlock subsequent
  transformations for the same reason as PreInlineUnconditionally,
  so it's probably not innocuous anyway.

KnownBranch, BetaReduction:
  May drop chunks of code, and thereby enable PreInlineUnconditionally
  for some let-binding which now occurs once

EtaExpansion:
  Example in imaginary/digits-of-e1
    fail = \void. e          where e :: IO ()
  --&gt; etaExpandRhs
    fail = \void. (\s. (e |&gt; g) s) |&gt; sym g      where g :: IO () ~ S -&gt; (S,())
  --&gt; Next iteration of simplify
    fail1 = \void. \s. (e |&gt; g) s
    fail = fail1 |&gt; Void#-&gt;sym g
  And now inline 'fail'

CaseMerge:
  case x of y {
    DEFAULT -&gt; case y of z { pi -&gt; ei }
    alts2 }
  ---&gt; CaseMerge
    case x of { pi -&gt; let z = y in ei
              ; alts2 }
  The &quot;let z=y&quot; case-binder-swap gets dealt with in the next pass
-}</span><span>
</span><a name="line-408"></a><span>
</span><a name="line-409"></a><span class="hs-identifier">pprTickCounts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-410"></a><a name="pprTickCounts"><a href="CoreMonad.html#pprTickCounts"><span class="hs-identifier">pprTickCounts</span></a></a><span> </span><a name="local-6989586621684246575"><a href="#local-6989586621684246575"><span class="hs-identifier">counts</span></a></a><span>
</span><a name="line-411"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="CoreMonad.html#pprTickGroup"><span class="hs-identifier hs-var">pprTickGroup</span></a><span> </span><a href="#local-6989586621684246576"><span class="hs-identifier hs-var">groups</span></a><span class="hs-special">)</span><span>
</span><a name="line-412"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-413"></a><span>    </span><span class="hs-identifier">groups</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Each group shares a comon tag</span><span>
</span><a name="line-414"></a><span>                                </span><span class="hs-comment">-- toList returns common tags adjacent</span><span>
</span><a name="line-415"></a><span>    </span><a name="local-6989586621684246576"><a href="#local-6989586621684246576"><span class="hs-identifier">groups</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">groupBy</span><span> </span><a href="#local-6989586621684246577"><span class="hs-identifier hs-var">same_tag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.toList</span><span> </span><a href="#local-6989586621684246575"><span class="hs-identifier hs-var">counts</span></a><span class="hs-special">)</span><span>
</span><a name="line-416"></a><span>    </span><a name="local-6989586621684246577"><a href="#local-6989586621684246577"><span class="hs-identifier">same_tag</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684246578"><a href="#local-6989586621684246578"><span class="hs-identifier">tick1</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684246579"><a href="#local-6989586621684246579"><span class="hs-identifier">tick2</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#tickToTag"><span class="hs-identifier hs-var">tickToTag</span></a><span> </span><a href="#local-6989586621684246578"><span class="hs-identifier hs-var">tick1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="CoreMonad.html#tickToTag"><span class="hs-identifier hs-var">tickToTag</span></a><span> </span><a href="#local-6989586621684246579"><span class="hs-identifier hs-var">tick2</span></a><span>
</span><a name="line-417"></a><span>
</span><a name="line-418"></a><span class="hs-identifier">pprTickGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-419"></a><a name="pprTickGroup"><a href="CoreMonad.html#pprTickGroup"><span class="hs-identifier">pprTickGroup</span></a></a><span> </span><a name="local-6989586621684246580"><a href="#local-6989586621684246580"><span class="hs-identifier">group</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621684246581"><a href="#local-6989586621684246581"><span class="hs-identifier">tick1</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-420"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sum</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684246582"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621684246582"><a href="#local-6989586621684246582"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684246580"><span class="hs-identifier hs-var">group</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#tickString"><span class="hs-identifier hs-var">tickString</span></a><span> </span><a href="#local-6989586621684246581"><span class="hs-identifier hs-var">tick1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-421"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#int"><span class="hs-identifier hs-var">int</span></a><span> </span><a href="#local-6989586621684246584"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="CoreMonad.html#pprTickCts"><span class="hs-identifier hs-var">pprTickCts</span></a><span> </span><a href="#local-6989586621684246583"><span class="hs-identifier hs-var">tick</span></a><span>
</span><a name="line-422"></a><span>                                    </span><span class="hs-comment">-- flip as we want largest first</span><span>
</span><a name="line-423"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684246583"><a href="#local-6989586621684246583"><span class="hs-identifier">tick</span></a></a><span class="hs-special">,</span><a name="local-6989586621684246584"><a href="#local-6989586621684246584"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comparing</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684246580"><span class="hs-identifier hs-var">group</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-424"></a><span class="hs-identifier">pprTickGroup</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;pprTickGroup&quot;</span><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span class="hs-keyword">data</span><span> </span><a name="Tick"><a href="CoreMonad.html#Tick"><span class="hs-identifier">Tick</span></a></a><span>  </span><span class="hs-comment">-- See Note [Which transformations are innocuous]</span><span>
</span><a name="line-427"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="PreInlineUnconditionally"><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier">PreInlineUnconditionally</span></a></a><span>    </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-428"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PostInlineUnconditionally"><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier">PostInlineUnconditionally</span></a></a><span>   </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-429"></a><span>
</span><a name="line-430"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UnfoldingDone"><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier">UnfoldingDone</span></a></a><span>               </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-431"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RuleFired"><a href="CoreMonad.html#RuleFired"><span class="hs-identifier">RuleFired</span></a></a><span>                   </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>      </span><span class="hs-comment">-- Rule name</span><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LetFloatFromLet"><a href="CoreMonad.html#LetFloatFromLet"><span class="hs-identifier">LetFloatFromLet</span></a></a><span>
</span><a name="line-434"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="EtaExpansion"><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier">EtaExpansion</span></a></a><span>                </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- LHS binder</span><span>
</span><a name="line-435"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="EtaReduction"><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier">EtaReduction</span></a></a><span>                </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Binder on outer lambda</span><span>
</span><a name="line-436"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="BetaReduction"><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier">BetaReduction</span></a></a><span>               </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Lambda binder</span><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CaseOfCase"><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier">CaseOfCase</span></a></a><span>                  </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Bndr on *inner* case</span><span>
</span><a name="line-440"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="KnownBranch"><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier">KnownBranch</span></a></a><span>                 </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Case binder</span><span>
</span><a name="line-441"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CaseMerge"><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier">CaseMerge</span></a></a><span>                   </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Binder on outer case</span><span>
</span><a name="line-442"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AltMerge"><a href="CoreMonad.html#AltMerge"><span class="hs-identifier">AltMerge</span></a></a><span>                    </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Case binder</span><span>
</span><a name="line-443"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CaseElim"><a href="CoreMonad.html#CaseElim"><span class="hs-identifier">CaseElim</span></a></a><span>                    </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Case binder</span><span>
</span><a name="line-444"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CaseIdentity"><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier">CaseIdentity</span></a></a><span>                </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Case binder</span><span>
</span><a name="line-445"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FillInCaseDefault"><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier">FillInCaseDefault</span></a></a><span>           </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>      </span><span class="hs-comment">-- Case binder</span><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SimplifierDone"><a href="CoreMonad.html#SimplifierDone"><span class="hs-identifier">SimplifierDone</span></a></a><span>              </span><span class="hs-comment">-- Ticked at each iteration of the simplifier</span><span>
</span><a name="line-448"></a><span>
</span><a name="line-449"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-450"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621684246509"><a href="#local-6989586621684246509"><span class="hs-identifier">tick</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#tickString"><span class="hs-identifier hs-var">tickString</span></a><span> </span><a href="#local-6989586621684246509"><span class="hs-identifier hs-var">tick</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="CoreMonad.html#pprTickCts"><span class="hs-identifier hs-var">pprTickCts</span></a><span> </span><a href="#local-6989586621684246509"><span class="hs-identifier hs-var">tick</span></a><span>
</span><a name="line-451"></a><span>
</span><a name="line-452"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-453"></a><span>  </span><a name="local-6989586621684246507"><a href="#local-6989586621684246507"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a name="local-6989586621684246508"><a href="#local-6989586621684246508"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684246507"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="CoreMonad.html#cmpTick"><span class="hs-identifier hs-var">cmpTick</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246508"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-454"></a><span>           </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-455"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-458"></a><span>  </span><a name="local-8214565720323790496"><span class="hs-identifier">compare</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#cmpTick"><span class="hs-identifier hs-var">cmpTick</span></a><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-461"></a><a name="tickToTag"><a href="CoreMonad.html#tickToTag"><span class="hs-identifier">tickToTag</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier hs-var">PreInlineUnconditionally</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-462"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier hs-var">PostInlineUnconditionally</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-463"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier hs-var">UnfoldingDone</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-464"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#RuleFired"><span class="hs-identifier hs-var">RuleFired</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-465"></a><span class="hs-identifier">tickToTag</span><span> </span><a href="CoreMonad.html#LetFloatFromLet"><span class="hs-identifier hs-var">LetFloatFromLet</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-466"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier hs-var">EtaExpansion</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-467"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier hs-var">EtaReduction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-468"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier hs-var">BetaReduction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-469"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier hs-var">CaseOfCase</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-470"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier hs-var">KnownBranch</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">9</span><span>
</span><a name="line-471"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier hs-var">CaseMerge</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-472"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseElim"><span class="hs-identifier hs-var">CaseElim</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">11</span><span>
</span><a name="line-473"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier hs-var">CaseIdentity</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-474"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier hs-var">FillInCaseDefault</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">13</span><span>
</span><a name="line-475"></a><span class="hs-identifier">tickToTag</span><span> </span><a href="CoreMonad.html#SimplifierDone"><span class="hs-identifier hs-var">SimplifierDone</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">16</span><span>
</span><a name="line-476"></a><span class="hs-identifier">tickToTag</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#AltMerge"><span class="hs-identifier hs-var">AltMerge</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">17</span><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-479"></a><a name="tickString"><a href="CoreMonad.html#tickString"><span class="hs-identifier">tickString</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier hs-var">PreInlineUnconditionally</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;PreInlineUnconditionally&quot;</span><span>
</span><a name="line-480"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier hs-var">PostInlineUnconditionally</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;PostInlineUnconditionally&quot;</span><span>
</span><a name="line-481"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier hs-var">UnfoldingDone</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;UnfoldingDone&quot;</span><span>
</span><a name="line-482"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#RuleFired"><span class="hs-identifier hs-var">RuleFired</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;RuleFired&quot;</span><span>
</span><a name="line-483"></a><span class="hs-identifier">tickString</span><span> </span><a href="CoreMonad.html#LetFloatFromLet"><span class="hs-identifier hs-var">LetFloatFromLet</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;LetFloatFromLet&quot;</span><span>
</span><a name="line-484"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier hs-var">EtaExpansion</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;EtaExpansion&quot;</span><span>
</span><a name="line-485"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier hs-var">EtaReduction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;EtaReduction&quot;</span><span>
</span><a name="line-486"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier hs-var">BetaReduction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;BetaReduction&quot;</span><span>
</span><a name="line-487"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier hs-var">CaseOfCase</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;CaseOfCase&quot;</span><span>
</span><a name="line-488"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier hs-var">KnownBranch</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;KnownBranch&quot;</span><span>
</span><a name="line-489"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier hs-var">CaseMerge</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;CaseMerge&quot;</span><span>
</span><a name="line-490"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#AltMerge"><span class="hs-identifier hs-var">AltMerge</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;AltMerge&quot;</span><span>
</span><a name="line-491"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseElim"><span class="hs-identifier hs-var">CaseElim</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;CaseElim&quot;</span><span>
</span><a name="line-492"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier hs-var">CaseIdentity</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;CaseIdentity&quot;</span><span>
</span><a name="line-493"></a><span class="hs-identifier">tickString</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier hs-var">FillInCaseDefault</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;FillInCaseDefault&quot;</span><span>
</span><a name="line-494"></a><span class="hs-identifier">tickString</span><span> </span><a href="CoreMonad.html#SimplifierDone"><span class="hs-identifier hs-var">SimplifierDone</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;SimplifierDone&quot;</span><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-497"></a><a name="pprTickCts"><a href="CoreMonad.html#pprTickCts"><span class="hs-identifier">pprTickCts</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier hs-var">PreInlineUnconditionally</span></a><span> </span><a name="local-6989586621684246585"><a href="#local-6989586621684246585"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246585"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-498"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier hs-var">PostInlineUnconditionally</span></a><span> </span><a name="local-6989586621684246586"><a href="#local-6989586621684246586"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246586"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-499"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier hs-var">UnfoldingDone</span></a><span> </span><a name="local-6989586621684246587"><a href="#local-6989586621684246587"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246587"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-500"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#RuleFired"><span class="hs-identifier hs-var">RuleFired</span></a><span> </span><a name="local-6989586621684246588"><a href="#local-6989586621684246588"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246588"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-501"></a><span class="hs-identifier">pprTickCts</span><span> </span><a href="CoreMonad.html#LetFloatFromLet"><span class="hs-identifier hs-var">LetFloatFromLet</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a><span>
</span><a name="line-502"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier hs-var">EtaExpansion</span></a><span> </span><a name="local-6989586621684246589"><a href="#local-6989586621684246589"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246589"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-503"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier hs-var">EtaReduction</span></a><span> </span><a name="local-6989586621684246590"><a href="#local-6989586621684246590"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246590"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-504"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier hs-var">BetaReduction</span></a><span> </span><a name="local-6989586621684246591"><a href="#local-6989586621684246591"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246591"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-505"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier hs-var">CaseOfCase</span></a><span> </span><a name="local-6989586621684246592"><a href="#local-6989586621684246592"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246592"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-506"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier hs-var">KnownBranch</span></a><span> </span><a name="local-6989586621684246593"><a href="#local-6989586621684246593"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246593"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-507"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier hs-var">CaseMerge</span></a><span> </span><a name="local-6989586621684246594"><a href="#local-6989586621684246594"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246594"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-508"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#AltMerge"><span class="hs-identifier hs-var">AltMerge</span></a><span> </span><a name="local-6989586621684246595"><a href="#local-6989586621684246595"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246595"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-509"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseElim"><span class="hs-identifier hs-var">CaseElim</span></a><span> </span><a name="local-6989586621684246596"><a href="#local-6989586621684246596"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246596"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-510"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier hs-var">CaseIdentity</span></a><span> </span><a name="local-6989586621684246597"><a href="#local-6989586621684246597"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246597"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-511"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier hs-var">FillInCaseDefault</span></a><span> </span><a name="local-6989586621684246598"><a href="#local-6989586621684246598"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684246598"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-512"></a><span class="hs-identifier">pprTickCts</span><span> </span><span class="hs-identifier">_</span><span>                            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span class="hs-identifier">cmpTick</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-515"></a><a name="cmpTick"><a href="CoreMonad.html#cmpTick"><span class="hs-identifier">cmpTick</span></a></a><span> </span><a name="local-6989586621684246599"><a href="#local-6989586621684246599"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621684246600"><a href="#local-6989586621684246600"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#tickToTag"><span class="hs-identifier hs-var">tickToTag</span></a><span> </span><a href="#local-6989586621684246599"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="CoreMonad.html#tickToTag"><span class="hs-identifier hs-var">tickToTag</span></a><span> </span><a href="#local-6989586621684246600"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-516"></a><span>                </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-517"></a><span>                </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#cmpEqTick"><span class="hs-identifier hs-var">cmpEqTick</span></a><span> </span><a href="#local-6989586621684246599"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621684246600"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-518"></a><span>                </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#Tick"><span class="hs-identifier hs-type">Tick</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-521"></a><a name="cmpEqTick"><a href="CoreMonad.html#cmpEqTick"><span class="hs-identifier">cmpEqTick</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier hs-var">PreInlineUnconditionally</span></a><span> </span><a name="local-6989586621684246601"><a href="#local-6989586621684246601"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><a href="CoreMonad.html#PreInlineUnconditionally"><span class="hs-identifier hs-var">PreInlineUnconditionally</span></a><span> </span><a name="local-6989586621684246602"><a href="#local-6989586621684246602"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246601"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246602"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-522"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier hs-var">PostInlineUnconditionally</span></a><span> </span><a name="local-6989586621684246603"><a href="#local-6989586621684246603"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#PostInlineUnconditionally"><span class="hs-identifier hs-var">PostInlineUnconditionally</span></a><span> </span><a name="local-6989586621684246604"><a href="#local-6989586621684246604"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246603"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246604"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-523"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier hs-var">UnfoldingDone</span></a><span> </span><a name="local-6989586621684246605"><a href="#local-6989586621684246605"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-special">(</span><a href="CoreMonad.html#UnfoldingDone"><span class="hs-identifier hs-var">UnfoldingDone</span></a><span> </span><a name="local-6989586621684246606"><a href="#local-6989586621684246606"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246605"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246606"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-524"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#RuleFired"><span class="hs-identifier hs-var">RuleFired</span></a><span> </span><a name="local-6989586621684246607"><a href="#local-6989586621684246607"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-special">(</span><a href="CoreMonad.html#RuleFired"><span class="hs-identifier hs-var">RuleFired</span></a><span> </span><a name="local-6989586621684246608"><a href="#local-6989586621684246608"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246607"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246608"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-525"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier hs-var">EtaExpansion</span></a><span> </span><a name="local-6989586621684246609"><a href="#local-6989586621684246609"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaExpansion"><span class="hs-identifier hs-var">EtaExpansion</span></a><span> </span><a name="local-6989586621684246610"><a href="#local-6989586621684246610"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246609"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246610"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-526"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier hs-var">EtaReduction</span></a><span> </span><a name="local-6989586621684246611"><a href="#local-6989586621684246611"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-special">(</span><a href="CoreMonad.html#EtaReduction"><span class="hs-identifier hs-var">EtaReduction</span></a><span> </span><a name="local-6989586621684246612"><a href="#local-6989586621684246612"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246611"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246612"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-527"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier hs-var">BetaReduction</span></a><span> </span><a name="local-6989586621684246613"><a href="#local-6989586621684246613"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-special">(</span><a href="CoreMonad.html#BetaReduction"><span class="hs-identifier hs-var">BetaReduction</span></a><span> </span><a name="local-6989586621684246614"><a href="#local-6989586621684246614"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246613"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246614"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-528"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier hs-var">CaseOfCase</span></a><span> </span><a name="local-6989586621684246615"><a href="#local-6989586621684246615"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseOfCase"><span class="hs-identifier hs-var">CaseOfCase</span></a><span> </span><a name="local-6989586621684246616"><a href="#local-6989586621684246616"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246615"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246616"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-529"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier hs-var">KnownBranch</span></a><span> </span><a name="local-6989586621684246617"><a href="#local-6989586621684246617"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-special">(</span><a href="CoreMonad.html#KnownBranch"><span class="hs-identifier hs-var">KnownBranch</span></a><span> </span><a name="local-6989586621684246618"><a href="#local-6989586621684246618"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246617"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246618"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-530"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier hs-var">CaseMerge</span></a><span> </span><a name="local-6989586621684246619"><a href="#local-6989586621684246619"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>                 </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseMerge"><span class="hs-identifier hs-var">CaseMerge</span></a><span> </span><a name="local-6989586621684246620"><a href="#local-6989586621684246620"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246619"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246620"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-531"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#AltMerge"><span class="hs-identifier hs-var">AltMerge</span></a><span> </span><a name="local-6989586621684246621"><a href="#local-6989586621684246621"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>                  </span><span class="hs-special">(</span><a href="CoreMonad.html#AltMerge"><span class="hs-identifier hs-var">AltMerge</span></a><span> </span><a name="local-6989586621684246622"><a href="#local-6989586621684246622"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246621"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246622"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-532"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseElim"><span class="hs-identifier hs-var">CaseElim</span></a><span> </span><a name="local-6989586621684246623"><a href="#local-6989586621684246623"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>                  </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseElim"><span class="hs-identifier hs-var">CaseElim</span></a><span> </span><a name="local-6989586621684246624"><a href="#local-6989586621684246624"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246623"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246624"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-533"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier hs-var">CaseIdentity</span></a><span> </span><a name="local-6989586621684246625"><a href="#local-6989586621684246625"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-special">(</span><a href="CoreMonad.html#CaseIdentity"><span class="hs-identifier hs-var">CaseIdentity</span></a><span> </span><a name="local-6989586621684246626"><a href="#local-6989586621684246626"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246625"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246626"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-534"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier hs-var">FillInCaseDefault</span></a><span> </span><a name="local-6989586621684246627"><a href="#local-6989586621684246627"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-special">(</span><a href="CoreMonad.html#FillInCaseDefault"><span class="hs-identifier hs-var">FillInCaseDefault</span></a><span> </span><a name="local-6989586621684246628"><a href="#local-6989586621684246628"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246627"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246628"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-535"></a><span class="hs-identifier">cmpEqTick</span><span> </span><span class="hs-identifier">_</span><span>                             </span><span class="hs-identifier">_</span><span>                               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-536"></a><span>
</span><a name="line-537"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Monad and carried data structure definitions
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-544"></a><span>
</span><a name="line-545"></a><span class="hs-keyword">newtype</span><span> </span><a name="CoreState"><a href="CoreMonad.html#CoreState"><span class="hs-identifier">CoreState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CoreState"><a href="CoreMonad.html#CoreState"><span class="hs-identifier">CoreState</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-546"></a><span>        </span><a name="cs_uniq_supply"><a href="CoreMonad.html#cs_uniq_supply"><span class="hs-identifier">cs_uniq_supply</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="UniqSupply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a><span>
</span><a name="line-547"></a><span class="hs-special">}</span><span>
</span><a name="line-548"></a><span>
</span><a name="line-549"></a><span class="hs-keyword">data</span><span> </span><a name="CoreReader"><a href="CoreMonad.html#CoreReader"><span class="hs-identifier">CoreReader</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CoreReader"><a href="CoreMonad.html#CoreReader"><span class="hs-identifier">CoreReader</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-550"></a><span>        </span><a name="cr_hsc_env"><a href="CoreMonad.html#cr_hsc_env"><span class="hs-identifier">cr_hsc_env</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-551"></a><span>        </span><a name="cr_rule_base"><a href="CoreMonad.html#cr_rule_base"><span class="hs-identifier">cr_rule_base</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleBase"><span class="hs-identifier hs-type">RuleBase</span></a><span class="hs-special">,</span><span>
</span><a name="line-552"></a><span>        </span><a name="cr_module"><a href="CoreMonad.html#cr_module"><span class="hs-identifier">cr_module</span></a></a><span>              </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>
</span><a name="line-553"></a><span>        </span><a name="cr_print_unqual"><a href="CoreMonad.html#cr_print_unqual"><span class="hs-identifier">cr_print_unqual</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span class="hs-special">,</span><span>
</span><a name="line-554"></a><span>        </span><a name="cr_loc"><a href="CoreMonad.html#cr_loc"><span class="hs-identifier">cr_loc</span></a></a><span>                 </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- Use this for log/error messages so they</span><span>
</span><a name="line-555"></a><span>                                             </span><span class="hs-comment">-- are at least tagged with the right source file</span><span>
</span><a name="line-556"></a><span>        </span><a name="cr_visible_orphan_mods"><a href="CoreMonad.html#cr_visible_orphan_mods"><span class="hs-identifier">cr_visible_orphan_mods</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-557"></a><span class="hs-special">}</span><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span class="hs-comment">-- Note: CoreWriter used to be defined with data, rather than newtype.  If it</span><span>
</span><a name="line-560"></a><span class="hs-comment">-- is defined that way again, the cw_simpl_count field, at least, must be</span><span>
</span><a name="line-561"></a><span class="hs-comment">-- strict to avoid a space leak (Trac #7702).</span><span>
</span><a name="line-562"></a><span class="hs-keyword">newtype</span><span> </span><a name="CoreWriter"><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier">CoreWriter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CoreWriter"><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier">CoreWriter</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-563"></a><span>        </span><a name="cw_simpl_count"><a href="CoreMonad.html#cw_simpl_count"><span class="hs-identifier">cw_simpl_count</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span>
</span><a name="line-564"></a><span class="hs-special">}</span><span>
</span><a name="line-565"></a><span>
</span><a name="line-566"></a><span class="hs-identifier">emptyWriter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span>
</span><a name="line-567"></a><a name="emptyWriter"><a href="CoreMonad.html#emptyWriter"><span class="hs-identifier">emptyWriter</span></a></a><span> </span><a name="local-6989586621684246629"><a href="#local-6989586621684246629"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-var">CoreWriter</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-568"></a><span>        </span><span class="hs-identifier">cw_simpl_count</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#zeroSimplCount"><span class="hs-identifier hs-var">zeroSimplCount</span></a><span> </span><a href="#local-6989586621684246629"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-569"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span class="hs-identifier">plusWriter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span>
</span><a name="line-572"></a><a name="plusWriter"><a href="CoreMonad.html#plusWriter"><span class="hs-identifier">plusWriter</span></a></a><span> </span><a name="local-6989586621684246630"><a href="#local-6989586621684246630"><span class="hs-identifier">w1</span></a></a><span> </span><a name="local-6989586621684246631"><a href="#local-6989586621684246631"><span class="hs-identifier">w2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-var">CoreWriter</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-573"></a><span>        </span><span class="hs-identifier">cw_simpl_count</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cw_simpl_count</span><span> </span><a href="#local-6989586621684246630"><span class="hs-identifier hs-var">w1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="CoreMonad.html#plusSimplCount"><span class="hs-identifier hs-var">plusSimplCount</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cw_simpl_count</span><span> </span><a href="#local-6989586621684246631"><span class="hs-identifier hs-var">w2</span></a><span class="hs-special">)</span><span>
</span><a name="line-574"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-575"></a><span>
</span><a name="line-576"></a><span class="hs-keyword">type</span><span> </span><a name="CoreIOEnv"><a href="CoreMonad.html#CoreIOEnv"><span class="hs-identifier">CoreIOEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IOEnv.html#IOEnv"><span class="hs-identifier hs-type">IOEnv</span></a><span> </span><a href="CoreMonad.html#CoreReader"><span class="hs-identifier hs-type">CoreReader</span></a><span>
</span><a name="line-577"></a><span>
</span><a name="line-578"></a><span class="hs-comment">-- | The monad used by Core-to-Core passes to access common state, register simplification</span><span>
</span><a name="line-579"></a><span class="hs-comment">-- statistics and so on</span><span>
</span><a name="line-580"></a><span class="hs-keyword">newtype</span><span> </span><a name="CoreM"><a href="CoreMonad.html#CoreM"><span class="hs-identifier">CoreM</span></a></a><span> </span><a name="local-6989586621684246481"><a href="#local-6989586621684246481"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CoreM"><a href="CoreMonad.html#CoreM"><span class="hs-identifier">CoreM</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unCoreM"><a href="CoreMonad.html#unCoreM"><span class="hs-identifier">unCoreM</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreIOEnv"><span class="hs-identifier hs-type">CoreIOEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246481"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-583"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-584"></a><span>
</span><a name="line-585"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-586"></a><span>    </span><a name="local-6989586621684246497"><a href="#local-6989586621684246497"><span class="hs-identifier">mx</span></a></a><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621684246498"><a href="#local-6989586621684246498"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684246499"><a href="#local-6989586621684246499"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-587"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621684246500"><a href="#local-6989586621684246500"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684246501"><a href="#local-6989586621684246501"><span class="hs-identifier">s'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684246502"><a href="#local-6989586621684246502"><span class="hs-identifier">w1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unCoreM</span><span> </span><a href="#local-6989586621684246497"><span class="hs-identifier hs-var">mx</span></a><span> </span><a href="#local-6989586621684246499"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-588"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621684246503"><a href="#local-6989586621684246503"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684246504"><a href="#local-6989586621684246504"><span class="hs-identifier">s''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684246505"><a href="#local-6989586621684246505"><span class="hs-identifier">w2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">unCoreM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246498"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684246500"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684246501"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-589"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684246506"><a href="#local-6989586621684246506"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246502"><span class="hs-identifier hs-var">w1</span></a><span> </span><span class="hs-special">`</span><a href="CoreMonad.html#plusWriter"><span class="hs-identifier hs-var">plusWriter</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684246505"><span class="hs-identifier hs-var">w2</span></a><span>
</span><a name="line-590"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">seq</span><span> </span><a href="#local-6989586621684246506"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246503"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684246504"><span class="hs-identifier hs-var">s''</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684246506"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-591"></a><span>            </span><span class="hs-comment">-- forcing w before building the tuple avoids a space leak</span><span>
</span><a name="line-592"></a><span>            </span><span class="hs-comment">-- (Trac #7702)</span><span>
</span><a name="line-593"></a><span>
</span><a name="line-594"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-595"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621684246493"><a href="#local-6989586621684246493"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684246494"><a href="#local-6989586621684246494"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#nop"><span class="hs-identifier hs-var">nop</span></a><span> </span><a href="#local-6989586621684246494"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621684246493"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-596"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-597"></a><span>    </span><a name="local-6989586621684246495"><a href="#local-6989586621684246495"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-3458764513820541681"><span class="hs-operator">*&gt;</span></a><span> </span><a name="local-6989586621684246496"><a href="#local-6989586621684246496"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246495"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246496"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-598"></a><span>
</span><a name="line-599"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Alternative</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-600"></a><span>    </span><a name="local-8214565720323790439"><span class="hs-identifier">empty</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Control.Applicative.empty</span><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>    </span><a name="local-6989586621684246490"><a href="#local-6989586621684246490"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-8214565720323790438"><span class="hs-operator">&lt;|&gt;</span></a><span> </span><a name="local-6989586621684246491"><a href="#local-6989586621684246491"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684246492"><a href="#local-6989586621684246492"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unCoreM</span><span> </span><a href="#local-6989586621684246490"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621684246492"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><span class="hs-identifier">unCoreM</span><span> </span><a href="#local-6989586621684246491"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621684246492"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-602"></a><span>
</span><a name="line-603"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadPlus</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span>
</span><a name="line-604"></a><span>
</span><a name="line-605"></a><span class="hs-keyword">instance</span><span> </span><a href="UniqSupply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-606"></a><span>    </span><a name="local-8214565720325055548"><a href="UniqSupply.html#getUniqueSupplyM"><span class="hs-identifier">getUniqueSupplyM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-607"></a><span>        </span><a name="local-6989586621684246482"><a href="#local-6989586621684246482"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getS"><span class="hs-identifier hs-var">getS</span></a><span> </span><span class="hs-identifier">cs_uniq_supply</span><span>
</span><a name="line-608"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684246483"><a href="#local-6989586621684246483"><span class="hs-identifier">us1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684246484"><a href="#local-6989586621684246484"><span class="hs-identifier">us2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#splitUniqSupply"><span class="hs-identifier hs-var">splitUniqSupply</span></a><span> </span><a href="#local-6989586621684246482"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-609"></a><span>        </span><a href="CoreMonad.html#modifyS"><span class="hs-identifier hs-var">modifyS</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684246485"><a href="#local-6989586621684246485"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246485"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cs_uniq_supply</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246484"><span class="hs-identifier hs-var">us2</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-610"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684246483"><span class="hs-identifier hs-var">us1</span></a><span>
</span><a name="line-611"></a><span>
</span><a name="line-612"></a><span>    </span><a name="local-8214565720325055549"><a href="UniqSupply.html#getUniqueM"><span class="hs-identifier">getUniqueM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-613"></a><span>        </span><a name="local-6989586621684246486"><a href="#local-6989586621684246486"><span class="hs-identifier">us</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getS"><span class="hs-identifier hs-var">getS</span></a><span> </span><span class="hs-identifier">cs_uniq_supply</span><span>
</span><a name="line-614"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684246487"><a href="#local-6989586621684246487"><span class="hs-identifier">u</span></a></a><span class="hs-special">,</span><a name="local-6989586621684246488"><a href="#local-6989586621684246488"><span class="hs-identifier">us'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#takeUniqFromSupply"><span class="hs-identifier hs-var">takeUniqFromSupply</span></a><span> </span><a href="#local-6989586621684246486"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-615"></a><span>        </span><a href="CoreMonad.html#modifyS"><span class="hs-identifier hs-var">modifyS</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684246489"><a href="#local-6989586621684246489"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246489"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cs_uniq_supply</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246488"><span class="hs-identifier hs-var">us'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-616"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684246487"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-617"></a><span>
</span><a name="line-618"></a><span class="hs-identifier">runCoreM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-619"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleBase"><span class="hs-identifier hs-type">RuleBase</span></a><span>
</span><a name="line-620"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqSupply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a><span>
</span><a name="line-621"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-622"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-623"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span>
</span><a name="line-624"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-625"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="#local-6989586621684246529"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-626"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246529"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span class="hs-special">)</span><span>
</span><a name="line-627"></a><a name="runCoreM"><a href="CoreMonad.html#runCoreM"><span class="hs-identifier">runCoreM</span></a></a><span> </span><a name="local-6989586621684246632"><a href="#local-6989586621684246632"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621684246633"><a href="#local-6989586621684246633"><span class="hs-identifier">rule_base</span></a></a><span> </span><a name="local-6989586621684246634"><a href="#local-6989586621684246634"><span class="hs-identifier">us</span></a></a><span> </span><a name="local-6989586621684246635"><a href="#local-6989586621684246635"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621684246636"><a href="#local-6989586621684246636"><span class="hs-identifier">orph_imps</span></a></a><span> </span><a name="local-6989586621684246637"><a href="#local-6989586621684246637"><span class="hs-identifier">print_unqual</span></a></a><span> </span><a name="local-6989586621684246638"><a href="#local-6989586621684246638"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621684246639"><a href="#local-6989586621684246639"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-628"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="#local-6989586621684246642"><span class="hs-identifier hs-var">extract</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="IOEnv.html#runIOEnv"><span class="hs-identifier hs-var">runIOEnv</span></a><span> </span><a href="#local-6989586621684246640"><span class="hs-identifier hs-var">reader</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">unCoreM</span><span> </span><a href="#local-6989586621684246639"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621684246641"><span class="hs-identifier hs-var">state</span></a><span>
</span><a name="line-629"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-630"></a><span>    </span><a name="local-6989586621684246640"><a href="#local-6989586621684246640"><span class="hs-identifier">reader</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreReader"><span class="hs-identifier hs-var">CoreReader</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-631"></a><span>            </span><span class="hs-identifier">cr_hsc_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246632"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">,</span><span>
</span><a name="line-632"></a><span>            </span><span class="hs-identifier">cr_rule_base</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246633"><span class="hs-identifier hs-var">rule_base</span></a><span class="hs-special">,</span><span>
</span><a name="line-633"></a><span>            </span><span class="hs-identifier">cr_module</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246635"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span>
</span><a name="line-634"></a><span>            </span><span class="hs-identifier">cr_visible_orphan_mods</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246636"><span class="hs-identifier hs-var">orph_imps</span></a><span class="hs-special">,</span><span>
</span><a name="line-635"></a><span>            </span><span class="hs-identifier">cr_print_unqual</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246637"><span class="hs-identifier hs-var">print_unqual</span></a><span class="hs-special">,</span><span>
</span><a name="line-636"></a><span>            </span><span class="hs-identifier">cr_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246638"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-637"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-638"></a><span>    </span><a name="local-6989586621684246641"><a href="#local-6989586621684246641"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-var">CoreState</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-639"></a><span>            </span><span class="hs-identifier">cs_uniq_supply</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246634"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-640"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-641"></a><span>
</span><a name="line-642"></a><span>    </span><span class="hs-identifier">extract</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246643"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246643"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span class="hs-special">)</span><span>
</span><a name="line-643"></a><span>    </span><a name="local-6989586621684246642"><a href="#local-6989586621684246642"><span class="hs-identifier">extract</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684246644"><a href="#local-6989586621684246644"><span class="hs-identifier">value</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684246645"><a href="#local-6989586621684246645"><span class="hs-identifier">writer</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246644"><span class="hs-identifier hs-var">value</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cw_simpl_count</span><span> </span><a href="#local-6989586621684246645"><span class="hs-identifier hs-var">writer</span></a><span class="hs-special">)</span><span>
</span><a name="line-644"></a><span>
</span><a name="line-645"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Core combinators, not exported
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-652"></a><span>
</span><a name="line-653"></a><span class="hs-identifier">nop</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246528"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreIOEnv"><span class="hs-identifier hs-type">CoreIOEnv</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246528"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span class="hs-special">)</span><span>
</span><a name="line-654"></a><a name="nop"><a href="CoreMonad.html#nop"><span class="hs-identifier">nop</span></a></a><span> </span><a name="local-6989586621684246646"><a href="#local-6989586621684246646"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621684246647"><a href="#local-6989586621684246647"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-655"></a><span>    </span><a name="local-6989586621684246648"><a href="#local-6989586621684246648"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a><span>
</span><a name="line-656"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246647"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684246646"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="CoreMonad.html#emptyWriter"><span class="hs-identifier hs-var">emptyWriter</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">cr_hsc_env</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684246648"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-657"></a><span>
</span><a name="line-658"></a><span class="hs-identifier">read</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreReader"><span class="hs-identifier hs-type">CoreReader</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246527"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="#local-6989586621684246527"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-659"></a><a name="read"><a href="CoreMonad.html#read"><span class="hs-identifier">read</span></a></a><span> </span><a name="local-6989586621684246649"><a href="#local-6989586621684246649"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684246650"><a href="#local-6989586621684246650"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684246651"><a href="#local-6989586621684246651"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#nop"><span class="hs-identifier hs-var">nop</span></a><span> </span><a href="#local-6989586621684246650"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246649"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684246651"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-660"></a><span>
</span><a name="line-661"></a><span class="hs-identifier">getS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246526"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="#local-6989586621684246526"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-662"></a><a name="getS"><a href="CoreMonad.html#getS"><span class="hs-identifier">getS</span></a></a><span> </span><a name="local-6989586621684246652"><a href="#local-6989586621684246652"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684246653"><a href="#local-6989586621684246653"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#nop"><span class="hs-identifier hs-var">nop</span></a><span> </span><a href="#local-6989586621684246653"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246652"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684246653"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-identifier">modifyS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreState"><span class="hs-identifier hs-type">CoreState</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-665"></a><a name="modifyS"><a href="CoreMonad.html#modifyS"><span class="hs-identifier">modifyS</span></a></a><span> </span><a name="local-6989586621684246654"><a href="#local-6989586621684246654"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684246655"><a href="#local-6989586621684246655"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#nop"><span class="hs-identifier hs-var">nop</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684246654"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684246655"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-identifier">write</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-type">CoreWriter</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-668"></a><a name="write"><a href="CoreMonad.html#write"><span class="hs-identifier">write</span></a></a><span> </span><a name="local-6989586621684246656"><a href="#local-6989586621684246656"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684246657"><a href="#local-6989586621684246657"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684246657"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684246656"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-669"></a><span>
</span><a name="line-670"></a><span class="hs-comment">-- \subsection{Lifting IO into the monad}</span><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span class="hs-comment">-- | Lift an 'IOEnv' operation into 'CoreM'</span><span>
</span><a name="line-673"></a><span class="hs-identifier">liftIOEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreIOEnv"><span class="hs-identifier hs-type">CoreIOEnv</span></a><span> </span><a href="#local-6989586621684246525"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="#local-6989586621684246525"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-674"></a><a name="liftIOEnv"><a href="CoreMonad.html#liftIOEnv"><span class="hs-identifier">liftIOEnv</span></a></a><span> </span><a name="local-6989586621684246658"><a href="#local-6989586621684246658"><span class="hs-identifier">mx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-var">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684246659"><a href="#local-6989586621684246659"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246658"><span class="hs-identifier hs-var">mx</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684246660"><a href="#local-6989586621684246660"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#nop"><span class="hs-identifier hs-var">nop</span></a><span> </span><a href="#local-6989586621684246659"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621684246660"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-675"></a><span>
</span><a name="line-676"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-677"></a><span>    </span><a name="local-8214565720323787328"><span class="hs-identifier">liftIO</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#liftIOEnv"><span class="hs-identifier hs-var">liftIOEnv</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">IOEnv.liftIO</span><span>
</span><a name="line-678"></a><span>
</span><a name="line-679"></a><span class="hs-comment">-- | Lift an 'IO' operation into 'CoreM' while consuming its 'SimplCount'</span><span>
</span><a name="line-680"></a><span class="hs-identifier">liftIOWithCount</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684246524"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="#local-6989586621684246524"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-681"></a><a name="liftIOWithCount"><a href="CoreMonad.html#liftIOWithCount"><span class="hs-identifier">liftIOWithCount</span></a></a><span> </span><a name="local-6989586621684246661"><a href="#local-6989586621684246661"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><a href="#local-6989586621684246661"><span class="hs-identifier hs-var">what</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621684246662"><a href="#local-6989586621684246662"><span class="hs-identifier">count</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684246663"><a href="#local-6989586621684246663"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#addSimplCount"><span class="hs-identifier hs-var">addSimplCount</span></a><span> </span><a href="#local-6989586621684246662"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684246663"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Reader, writer and state accessors
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-690"></a><span>
</span><a name="line-691"></a><span class="hs-identifier">getHscEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-692"></a><a name="getHscEnv"><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier">getHscEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_hsc_env</span><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span class="hs-identifier">getRuleBase</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="CoreSyn.html#RuleBase"><span class="hs-identifier hs-type">RuleBase</span></a><span>
</span><a name="line-695"></a><a name="getRuleBase"><a href="CoreMonad.html#getRuleBase"><span class="hs-identifier">getRuleBase</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_rule_base</span><span>
</span><a name="line-696"></a><span>
</span><a name="line-697"></a><span class="hs-identifier">getVisibleOrphanMods</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-698"></a><a name="getVisibleOrphanMods"><a href="CoreMonad.html#getVisibleOrphanMods"><span class="hs-identifier">getVisibleOrphanMods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_visible_orphan_mods</span><span>
</span><a name="line-699"></a><span>
</span><a name="line-700"></a><span class="hs-identifier">getPrintUnqualified</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span>
</span><a name="line-701"></a><a name="getPrintUnqualified"><a href="CoreMonad.html#getPrintUnqualified"><span class="hs-identifier">getPrintUnqualified</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_print_unqual</span><span>
</span><a name="line-702"></a><span>
</span><a name="line-703"></a><span class="hs-identifier">getSrcSpanM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-704"></a><a name="getSrcSpanM"><a href="CoreMonad.html#getSrcSpanM"><span class="hs-identifier">getSrcSpanM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_loc</span><span>
</span><a name="line-705"></a><span>
</span><a name="line-706"></a><span class="hs-identifier">addSimplCount</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#SimplCount"><span class="hs-identifier hs-type">SimplCount</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-707"></a><a name="addSimplCount"><a href="CoreMonad.html#addSimplCount"><span class="hs-identifier">addSimplCount</span></a></a><span> </span><a name="local-6989586621684246664"><a href="#local-6989586621684246664"><span class="hs-identifier">count</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#write"><span class="hs-identifier hs-var">write</span></a><span> </span><span class="hs-special">(</span><a href="CoreMonad.html#CoreWriter"><span class="hs-identifier hs-var">CoreWriter</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cw_simpl_count</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684246664"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-708"></a><span>
</span><a name="line-709"></a><span class="hs-comment">-- Convenience accessors for useful fields of HscEnv</span><span>
</span><a name="line-710"></a><span>
</span><a name="line-711"></a><span class="hs-keyword">instance</span><span> </span><a href="DynFlags.html#HasDynFlags"><span class="hs-identifier hs-type">HasDynFlags</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-712"></a><span>    </span><a name="local-8214565720325324395"><a href="DynFlags.html#getDynFlags"><span class="hs-identifier">getDynFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-713"></a><span>
</span><a name="line-714"></a><span class="hs-keyword">instance</span><span> </span><a href="Module.html#HasModule"><span class="hs-identifier hs-type">HasModule</span></a><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-715"></a><span>    </span><a name="local-8214565720325186562"><a href="Module.html#getModule"><span class="hs-identifier">getModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#read"><span class="hs-identifier hs-var">read</span></a><span> </span><span class="hs-identifier">cr_module</span><span>
</span><a name="line-716"></a><span>
</span><a name="line-717"></a><span class="hs-comment">-- | The original name cache is the current mapping from 'Module' and</span><span>
</span><a name="line-718"></a><span class="hs-comment">-- 'OccName' to a compiler-wide unique 'Name'</span><span>
</span><a name="line-719"></a><span class="hs-identifier">getOrigNameCache</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="NameCache.html#OrigNameCache"><span class="hs-identifier hs-type">OrigNameCache</span></a><span>
</span><a name="line-720"></a><a name="getOrigNameCache"><a href="CoreMonad.html#getOrigNameCache"><span class="hs-identifier">getOrigNameCache</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-721"></a><span>    </span><a name="local-6989586621684246665"><a href="#local-6989586621684246665"><span class="hs-identifier">nameCacheRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">hsc_NC</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-722"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">nsNames</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readIORef</span><span> </span><a href="#local-6989586621684246665"><span class="hs-identifier hs-var">nameCacheRef</span></a><span>
</span><a name="line-723"></a><span>
</span><a name="line-724"></a><span class="hs-identifier">getPackageFamInstEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><a href="HscTypes.html#PackageFamInstEnv"><span class="hs-identifier hs-type">PackageFamInstEnv</span></a><span>
</span><a name="line-725"></a><a name="getPackageFamInstEnv"><a href="CoreMonad.html#getPackageFamInstEnv"><span class="hs-identifier">getPackageFamInstEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-726"></a><span>    </span><a name="local-6989586621684246666"><a href="#local-6989586621684246666"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-727"></a><span>    </span><a name="local-6989586621684246667"><a href="#local-6989586621684246667"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HscTypes.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a><span> </span><a href="#local-6989586621684246666"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-728"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">eps_fam_inst_env</span><span> </span><a href="#local-6989586621684246667"><span class="hs-identifier hs-var">eps</span></a><span>
</span><a name="line-729"></a><span>
</span><a name="line-730"></a><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">reinitializeGlobals</span><span> </span><span class="hs-pragma">&quot;It is not necessary to call reinitializeGlobals. Since GHC 8.2, this function is a no-op and will be removed in GHC 8.4&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-731"></a><span class="hs-identifier">reinitializeGlobals</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-732"></a><a name="reinitializeGlobals"><a href="CoreMonad.html#reinitializeGlobals"><span class="hs-identifier">reinitializeGlobals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-733"></a><span>
</span><a name="line-734"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Dealing with annotations
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span class="hs-comment">-- | Get all annotations of a given type. This happens lazily, that is</span><span>
</span><a name="line-743"></a><span class="hs-comment">-- no deserialization will take place until the [a] is actually demanded and</span><span>
</span><a name="line-744"></a><span class="hs-comment">-- the [a] can also be empty (the UniqFM is not filtered).</span><span>
</span><a name="line-745"></a><span class="hs-comment">--</span><span>
</span><a name="line-746"></a><span class="hs-comment">-- This should be done once at the start of a Core-to-Core pass that uses</span><span>
</span><a name="line-747"></a><span class="hs-comment">-- annotations.</span><span>
</span><a name="line-748"></a><span class="hs-comment">--</span><span>
</span><a name="line-749"></a><span class="hs-comment">-- See Note [Annotations]</span><span>
</span><a name="line-750"></a><span class="hs-identifier">getAnnotations</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621684246523"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246523"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684246523"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-751"></a><a name="getAnnotations"><a href="CoreMonad.html#getAnnotations"><span class="hs-identifier">getAnnotations</span></a></a><span> </span><a name="local-6989586621684246668"><a href="#local-6989586621684246668"><span class="hs-identifier">deserialize</span></a></a><span> </span><a name="local-6989586621684246669"><a href="#local-6989586621684246669"><span class="hs-identifier">guts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-752"></a><span>     </span><a name="local-6989586621684246670"><a href="#local-6989586621684246670"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a><span>
</span><a name="line-753"></a><span>     </span><a name="local-6989586621684246671"><a href="#local-6989586621684246671"><span class="hs-identifier">ann_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HscTypes.html#prepareAnnotations"><span class="hs-identifier hs-var">prepareAnnotations</span></a><span> </span><a href="#local-6989586621684246670"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684246669"><span class="hs-identifier hs-var">guts</span></a><span class="hs-special">)</span><span>
</span><a name="line-754"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Annotations.html#deserializeAnns"><span class="hs-identifier hs-var">deserializeAnns</span></a><span> </span><a href="#local-6989586621684246668"><span class="hs-identifier hs-var">deserialize</span></a><span> </span><a href="#local-6989586621684246671"><span class="hs-identifier hs-var">ann_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-755"></a><span>
</span><a name="line-756"></a><span class="hs-comment">-- | Get at most one annotation of a given type per Unique.</span><span>
</span><a name="line-757"></a><span class="hs-identifier">getFirstAnnotations</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span> </span><a href="#local-6989586621684246522"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246522"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><a href="#local-6989586621684246522"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-758"></a><a name="getFirstAnnotations"><a href="CoreMonad.html#getFirstAnnotations"><span class="hs-identifier">getFirstAnnotations</span></a></a><span> </span><a name="local-6989586621684246672"><a href="#local-6989586621684246672"><span class="hs-identifier">deserialize</span></a></a><span> </span><a name="local-6989586621684246673"><a href="#local-6989586621684246673"><span class="hs-identifier">guts</span></a></a><span>
</span><a name="line-759"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><a href="UniqFM.html#mapUFM"><span class="hs-identifier hs-var">mapUFM</span></a><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="UniqFM.html#filterUFM"><span class="hs-identifier hs-var">filterUFM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">null</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-760"></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreMonad.html#getAnnotations"><span class="hs-identifier hs-var">getAnnotations</span></a><span> </span><a href="#local-6989586621684246672"><span class="hs-identifier hs-var">deserialize</span></a><span> </span><a href="#local-6989586621684246673"><span class="hs-identifier hs-var">guts</span></a><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span class="hs-comment">{-
Note [Annotations]
~~~~~~~~~~~~~~~~~~
A Core-to-Core pass that wants to make use of annotations calls
getAnnotations or getFirstAnnotations at the beginning to obtain a UniqFM with
annotations of a specific type. This produces all annotations from interface
files read so far. However, annotations from interface files read during the
pass will not be visible until getAnnotations is called again. This is similar
to how rules work and probably isn't too bad.

The current implementation could be optimised a bit: when looking up
annotations for a thing from the HomePackageTable, we could search directly in
the module where the thing is defined rather than building one UniqFM which
contains all annotations we know of. This would work because annotations can
only be given to things defined in the same module. However, since we would
only want to deserialise every annotation once, we would have to build a cache
for every module in the HTP. In the end, it's probably not worth it as long as
we aren't using annotations heavily.

************************************************************************
*                                                                      *
                Direct screen output
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-787"></a><span>
</span><a name="line-788"></a><span class="hs-identifier">msg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ErrUtils.html#Severity"><span class="hs-identifier hs-type">Severity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-789"></a><a name="msg"><a href="CoreMonad.html#msg"><span class="hs-identifier">msg</span></a></a><span> </span><a name="local-6989586621684246674"><a href="#local-6989586621684246674"><span class="hs-identifier">sev</span></a></a><span> </span><a name="local-6989586621684246675"><a href="#local-6989586621684246675"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-790"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621684246676"><a href="#local-6989586621684246676"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-791"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621684246677"><a href="#local-6989586621684246677"><span class="hs-identifier">loc</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a><span>
</span><a name="line-792"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621684246678"><a href="#local-6989586621684246678"><span class="hs-identifier">unqual</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a><span>
</span><a name="line-793"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684246679"><a href="#local-6989586621684246679"><span class="hs-identifier">sty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684246674"><span class="hs-identifier hs-var">sev</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-794"></a><span>                     </span><a href="ErrUtils.html#SevError"><span class="hs-identifier hs-var">SevError</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246680"><span class="hs-identifier hs-var">err_sty</span></a><span>
</span><a name="line-795"></a><span>                     </span><a href="ErrUtils.html#SevWarning"><span class="hs-identifier hs-var">SevWarning</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246680"><span class="hs-identifier hs-var">err_sty</span></a><span>
</span><a name="line-796"></a><span>                     </span><a href="ErrUtils.html#SevDump"><span class="hs-identifier hs-var">SevDump</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246682"><span class="hs-identifier hs-var">dump_sty</span></a><span>
</span><a name="line-797"></a><span>                     </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684246681"><span class="hs-identifier hs-var">user_sty</span></a><span>
</span><a name="line-798"></a><span>             </span><a name="local-6989586621684246680"><a href="#local-6989586621684246680"><span class="hs-identifier">err_sty</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#mkErrStyle"><span class="hs-identifier hs-var">mkErrStyle</span></a><span> </span><a href="#local-6989586621684246676"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684246678"><span class="hs-identifier hs-var">unqual</span></a><span>
</span><a name="line-799"></a><span>             </span><a name="local-6989586621684246681"><a href="#local-6989586621684246681"><span class="hs-identifier">user_sty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#mkUserStyle"><span class="hs-identifier hs-var">mkUserStyle</span></a><span> </span><a href="#local-6989586621684246676"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684246678"><span class="hs-identifier hs-var">unqual</span></a><span> </span><a href="Outputable.html#AllTheWay"><span class="hs-identifier hs-var">AllTheWay</span></a><span>
</span><a name="line-800"></a><span>             </span><a name="local-6989586621684246682"><a href="#local-6989586621684246682"><span class="hs-identifier">dump_sty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#mkDumpStyle"><span class="hs-identifier hs-var">mkDumpStyle</span></a><span> </span><a href="#local-6989586621684246676"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684246678"><span class="hs-identifier hs-var">unqual</span></a><span>
</span><a name="line-801"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="DynFlags.html#putLogMsg"><span class="hs-identifier hs-var">putLogMsg</span></a><span> </span><a href="#local-6989586621684246676"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="DynFlags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a><span> </span><a href="#local-6989586621684246674"><span class="hs-identifier hs-var">sev</span></a><span> </span><a href="#local-6989586621684246677"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621684246679"><span class="hs-identifier hs-var">sty</span></a><span> </span><a href="#local-6989586621684246675"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-802"></a><span>
</span><a name="line-803"></a><span class="hs-comment">-- | Output a String message to the screen</span><span>
</span><a name="line-804"></a><span class="hs-identifier">putMsgS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-805"></a><a name="putMsgS"><a href="CoreMonad.html#putMsgS"><span class="hs-identifier">putMsgS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span>
</span><a name="line-806"></a><span>
</span><a name="line-807"></a><span class="hs-comment">-- | Output a message to the screen</span><span>
</span><a name="line-808"></a><span class="hs-identifier">putMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-809"></a><a name="putMsg"><a href="CoreMonad.html#putMsg"><span class="hs-identifier">putMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#msg"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="ErrUtils.html#SevInfo"><span class="hs-identifier hs-var">SevInfo</span></a><span>
</span><a name="line-810"></a><span>
</span><a name="line-811"></a><span class="hs-comment">-- | Output an error to the screen. Does not cause the compiler to die.</span><span>
</span><a name="line-812"></a><span class="hs-identifier">errorMsgS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-813"></a><a name="errorMsgS"><a href="CoreMonad.html#errorMsgS"><span class="hs-identifier">errorMsgS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span>
</span><a name="line-814"></a><span>
</span><a name="line-815"></a><span class="hs-comment">-- | Output an error to the screen. Does not cause the compiler to die.</span><span>
</span><a name="line-816"></a><span class="hs-identifier">errorMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-817"></a><a name="errorMsg"><a href="CoreMonad.html#errorMsg"><span class="hs-identifier">errorMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#msg"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="ErrUtils.html#SevError"><span class="hs-identifier hs-var">SevError</span></a><span>
</span><a name="line-818"></a><span>
</span><a name="line-819"></a><span class="hs-identifier">warnMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-820"></a><a name="warnMsg"><a href="CoreMonad.html#warnMsg"><span class="hs-identifier">warnMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#msg"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="ErrUtils.html#SevWarning"><span class="hs-identifier hs-var">SevWarning</span></a><span>
</span><a name="line-821"></a><span>
</span><a name="line-822"></a><span class="hs-comment">-- | Output a fatal error to the screen. Does not cause the compiler to die.</span><span>
</span><a name="line-823"></a><span class="hs-identifier">fatalErrorMsgS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-824"></a><a name="fatalErrorMsgS"><a href="CoreMonad.html#fatalErrorMsgS"><span class="hs-identifier">fatalErrorMsgS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#fatalErrorMsg"><span class="hs-identifier hs-var">fatalErrorMsg</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span>
</span><a name="line-825"></a><span>
</span><a name="line-826"></a><span class="hs-comment">-- | Output a fatal error to the screen. Does not cause the compiler to die.</span><span>
</span><a name="line-827"></a><span class="hs-identifier">fatalErrorMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-828"></a><a name="fatalErrorMsg"><a href="CoreMonad.html#fatalErrorMsg"><span class="hs-identifier">fatalErrorMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#msg"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="ErrUtils.html#SevFatal"><span class="hs-identifier hs-var">SevFatal</span></a><span>
</span><a name="line-829"></a><span>
</span><a name="line-830"></a><span class="hs-comment">-- | Output a string debugging message at verbosity level of @-v@ or higher</span><span>
</span><a name="line-831"></a><span class="hs-identifier">debugTraceMsgS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-832"></a><a name="debugTraceMsgS"><a href="CoreMonad.html#debugTraceMsgS"><span class="hs-identifier">debugTraceMsgS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span>
</span><a name="line-833"></a><span>
</span><a name="line-834"></a><span class="hs-comment">-- | Outputs a debugging message at verbosity level of @-v@ or higher</span><span>
</span><a name="line-835"></a><span class="hs-identifier">debugTraceMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-836"></a><a name="debugTraceMsg"><a href="CoreMonad.html#debugTraceMsg"><span class="hs-identifier">debugTraceMsg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreMonad.html#msg"><span class="hs-identifier hs-var">msg</span></a><span> </span><a href="ErrUtils.html#SevDump"><span class="hs-identifier hs-var">SevDump</span></a><span>
</span><a name="line-837"></a><span>
</span><a name="line-838"></a><span class="hs-comment">-- | Show some labelled 'SDoc' if a particular flag is set or at a verbosity level of @-v -ddump-most@ or higher</span><span>
</span><a name="line-839"></a><span class="hs-identifier">dumpIfSet_dyn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreMonad.html#CoreM"><span class="hs-identifier hs-type">CoreM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-840"></a><a name="dumpIfSet_dyn"><a href="CoreMonad.html#dumpIfSet_dyn"><span class="hs-identifier">dumpIfSet_dyn</span></a></a><span> </span><a name="local-6989586621684246683"><a href="#local-6989586621684246683"><span class="hs-identifier">flag</span></a></a><span> </span><a name="local-6989586621684246684"><a href="#local-6989586621684246684"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684246685"><a href="#local-6989586621684246685"><span class="hs-identifier">doc</span></a></a><span>
</span><a name="line-841"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621684246686"><a href="#local-6989586621684246686"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-842"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621684246687"><a href="#local-6989586621684246687"><span class="hs-identifier">unqual</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreMonad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a><span>
</span><a name="line-843"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#dopt"><span class="hs-identifier hs-var">dopt</span></a><span> </span><a href="#local-6989586621684246683"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-6989586621684246686"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-844"></a><span>         </span><a href="ErrUtils.html#dumpSDoc"><span class="hs-identifier hs-var">Err.dumpSDoc</span></a><span> </span><a href="#local-6989586621684246686"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684246687"><span class="hs-identifier hs-var">unqual</span></a><span> </span><a href="#local-6989586621684246683"><span class="hs-identifier hs-var">flag</span></a><span> </span><a href="#local-6989586621684246684"><span class="hs-identifier hs-var">str</span></a><span> </span><a href="#local-6989586621684246685"><span class="hs-identifier hs-var">doc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-845"></a></pre></body></html>