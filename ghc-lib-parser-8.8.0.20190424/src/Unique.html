<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


@Uniques@ are used to distinguish entities in the compiler (@Ids@,
@Classes@, etc.) from each other.  Thus, @Uniques@ are the basic
comparison key in the compiler.

If there is any single operation that needs to be fast, it is @Unique@

comparison.  Unsurprisingly, there is quite a bit of huff-and-puff
directed to that end.

Some of the other hair in this code is to be able to use a
``splittable @UniqueSupply@'' if requested/possible (not standard
Haskell).
-}</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-pragma">{-# LANGUAGE CPP, BangPatterns, MagicHash #-}</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unique</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-23"></a><span>        </span><span class="hs-comment">-- * Main data types</span><span>
</span><a name="line-24"></a><span>        </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="Unique.html#uNIQUE_BITS"><span class="hs-identifier hs-var">uNIQUE_BITS</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>        </span><span class="hs-comment">-- ** Constructors, destructors and operations on 'Unique's</span><span>
</span><a name="line-28"></a><span>        </span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span>        </span><a href="Unique.html#pprUniqueAlways"><span class="hs-identifier hs-var">pprUniqueAlways</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span>        </span><a href="Unique.html#mkUniqueGrimily"><span class="hs-identifier hs-var">mkUniqueGrimily</span></a><span class="hs-special">,</span><span>                </span><span class="hs-comment">-- Used in UniqSupply only!</span><span>
</span><a name="line-33"></a><span>        </span><a href="Unique.html#getKey"><span class="hs-identifier hs-var">getKey</span></a><span class="hs-special">,</span><span>                         </span><span class="hs-comment">-- Used in Var, UniqFM, Name only!</span><span>
</span><a name="line-34"></a><span>        </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#unpkUnique"><span class="hs-identifier hs-var">unpkUnique</span></a><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- Used in BinIface only</span><span>
</span><a name="line-35"></a><span>        </span><a href="Unique.html#eqUnique"><span class="hs-identifier hs-var">eqUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#ltUnique"><span class="hs-identifier hs-var">ltUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span>        </span><a href="Unique.html#deriveUnique"><span class="hs-identifier hs-var">deriveUnique</span></a><span class="hs-special">,</span><span>                   </span><span class="hs-comment">-- Ditto</span><span>
</span><a name="line-38"></a><span>        </span><a href="Unique.html#newTagUnique"><span class="hs-identifier hs-var">newTagUnique</span></a><span class="hs-special">,</span><span>                   </span><span class="hs-comment">-- Used in CgCase</span><span>
</span><a name="line-39"></a><span>        </span><a href="Unique.html#initTyVarUnique"><span class="hs-identifier hs-var">initTyVarUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="Unique.html#initExitJoinUnique"><span class="hs-identifier hs-var">initExitJoinUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="Unique.html#nonDetCmpUnique"><span class="hs-identifier hs-var">nonDetCmpUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>        </span><a href="Unique.html#isValidKnownKeyUnique"><span class="hs-identifier hs-var">isValidKnownKeyUnique</span></a><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- Used in PrelInfo.knownKeyNamesOkay</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span>        </span><span class="hs-comment">-- ** Making built-in uniques</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span>        </span><span class="hs-comment">-- now all the built-in Uniques (and functions to make them)</span><span>
</span><a name="line-47"></a><span>        </span><span class="hs-comment">-- [the Oh-So-Wonderful Haskell module system wins again...]</span><span>
</span><a name="line-48"></a><span>        </span><a href="Unique.html#mkAlphaTyVarUnique"><span class="hs-identifier hs-var">mkAlphaTyVarUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="Unique.html#mkPrimOpIdUnique"><span class="hs-identifier hs-var">mkPrimOpIdUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>        </span><a href="Unique.html#mkPreludeMiscIdUnique"><span class="hs-identifier hs-var">mkPreludeMiscIdUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#mkPreludeDataConUnique"><span class="hs-identifier hs-var">mkPreludeDataConUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>        </span><a href="Unique.html#mkPreludeTyConUnique"><span class="hs-identifier hs-var">mkPreludeTyConUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#mkPreludeClassUnique"><span class="hs-identifier hs-var">mkPreludeClassUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="Unique.html#mkCoVarUnique"><span class="hs-identifier hs-var">mkCoVarUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span>        </span><a href="Unique.html#mkVarOccUnique"><span class="hs-identifier hs-var">mkVarOccUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#mkDataOccUnique"><span class="hs-identifier hs-var">mkDataOccUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#mkTvOccUnique"><span class="hs-identifier hs-var">mkTvOccUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#mkTcOccUnique"><span class="hs-identifier hs-var">mkTcOccUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>        </span><a href="Unique.html#mkRegSingleUnique"><span class="hs-identifier hs-var">mkRegSingleUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#mkRegPairUnique"><span class="hs-identifier hs-var">mkRegPairUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#mkRegClassUnique"><span class="hs-identifier hs-var">mkRegClassUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#mkRegSubUnique"><span class="hs-identifier hs-var">mkRegSubUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>        </span><a href="Unique.html#mkCostCentreUnique"><span class="hs-identifier hs-var">mkCostCentreUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span>        </span><a href="Unique.html#mkBuiltinUnique"><span class="hs-identifier hs-var">mkBuiltinUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>        </span><a href="Unique.html#mkPseudoUniqueD"><span class="hs-identifier hs-var">mkPseudoUniqueD</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>        </span><a href="Unique.html#mkPseudoUniqueE"><span class="hs-identifier hs-var">mkPseudoUniqueE</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>        </span><a href="Unique.html#mkPseudoUniqueH"><span class="hs-identifier hs-var">mkPseudoUniqueH</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span>        </span><span class="hs-comment">-- ** Deriving uniques</span><span>
</span><a name="line-64"></a><span>        </span><span class="hs-comment">-- *** From TyCon name uniques</span><span>
</span><a name="line-65"></a><span>        </span><a href="Unique.html#tyConRepNameUnique"><span class="hs-identifier hs-var">tyConRepNameUnique</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>        </span><span class="hs-comment">-- *** From DataCon name uniques</span><span>
</span><a name="line-67"></a><span>        </span><a href="Unique.html#dataConWorkerUnique"><span class="hs-identifier hs-var">dataConWorkerUnique</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#dataConTyRepNameUnique"><span class="hs-identifier hs-var">dataConTyRepNameUnique</span></a><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
#include &quot;Unique.h&quot;
</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-comment">-- just for implementing a fast [0,61) -&gt; Char function</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Exts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">indexCharOffAddr#</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Char</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">chr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Unique-type]{@Unique@ type and operations}
*                                                                      *
************************************************************************

The @Chars@ are ``tag letters'' that identify the @UniqueSupply@.
Fast comparison is everything on @Uniques@:
-}</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-comment">-- | Unique identifier.</span><span>
</span><a name="line-98"></a><span class="hs-comment">--</span><span>
</span><a name="line-99"></a><span class="hs-comment">-- The type of unique identifiers that are used in many places in GHC</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- for fast ordering and equality tests. You should generate these with</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- the functions from the 'UniqSupply' module</span><span>
</span><a name="line-102"></a><span class="hs-comment">--</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- These are sometimes also referred to as \&quot;keys\&quot; in comments in GHC.</span><span>
</span><a name="line-104"></a><span class="hs-keyword">newtype</span><span> </span><a name="Unique"><a href="Unique.html#Unique"><span class="hs-identifier">Unique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="MkUnique"><a href="Unique.html#MkUnique"><span class="hs-identifier">MkUnique</span></a></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">uNIQUE_BITS</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-107"></a><span class="hs-identifier">uNIQUE_BITS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-108"></a><a name="uNIQUE_BITS"><a href="Unique.html#uNIQUE_BITS"><span class="hs-identifier">uNIQUE_BITS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">finiteBitSize</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">UNIQUE_TAG_BITS</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-comment">{-
Now come the functions which construct uniques from their pieces, and vice versa.
The stuff about unique *supplies* is handled further down this module.
-}</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-identifier">unpkUnique</span><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- The reverse</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-identifier">mkUniqueGrimily</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>                </span><span class="hs-comment">-- A trap-door for UniqSupply</span><span>
</span><a name="line-118"></a><span class="hs-identifier">getKey</span><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>                </span><span class="hs-comment">-- for Var</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-identifier">incrUnique</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-121"></a><span class="hs-identifier">stepUnique</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-122"></a><span class="hs-identifier">deriveUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-123"></a><span class="hs-identifier">newTagUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><a name="mkUniqueGrimily"><a href="Unique.html#mkUniqueGrimily"><span class="hs-identifier">mkUniqueGrimily</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">getKey</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-128"></a><a name="getKey"><a href="Unique.html#getKey"><span class="hs-identifier">getKey</span></a></a><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276185"><a href="#local-6989586621680276185"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680276185"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><a name="incrUnique"><a href="Unique.html#incrUnique"><span class="hs-identifier">incrUnique</span></a></a><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276186"><a href="#local-6989586621680276186"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680276186"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><a name="stepUnique"><a href="Unique.html#stepUnique"><span class="hs-identifier">stepUnique</span></a></a><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276187"><a href="#local-6989586621680276187"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680276188"><a href="#local-6989586621680276188"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680276187"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680276188"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- deriveUnique uses an 'X' tag so that it won't clash with</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- any of the uniques produced any other way</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- SPJ says: this looks terribly smelly to me!</span><span>
</span><a name="line-136"></a><a name="deriveUnique"><a href="Unique.html#deriveUnique"><span class="hs-identifier">deriveUnique</span></a></a><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276189"><a href="#local-6989586621680276189"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680276190"><a href="#local-6989586621680276190"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'X'</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680276189"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680276190"><span class="hs-identifier hs-var">delta</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- newTagUnique changes the &quot;domain&quot; of a unique to a different char</span><span>
</span><a name="line-139"></a><a name="newTagUnique"><a href="Unique.html#newTagUnique"><span class="hs-identifier">newTagUnique</span></a></a><span> </span><a name="local-6989586621680276191"><a href="#local-6989586621680276191"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621680276192"><a href="#local-6989586621680276192"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><a href="#local-6989586621680276192"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621680276193"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621680276193"><a href="#local-6989586621680276193"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#unpkUnique"><span class="hs-identifier hs-var">unpkUnique</span></a><span> </span><a href="#local-6989586621680276191"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-comment">-- | How many bits are devoted to the unique index (as opposed to the class</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- character).</span><span>
</span><a name="line-143"></a><span class="hs-identifier">uniqueMask</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-144"></a><a name="uniqueMask"><a href="Unique.html#uniqueMask"><span class="hs-identifier">uniqueMask</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><a href="Unique.html#uNIQUE_BITS"><span class="hs-identifier hs-var">uNIQUE_BITS</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- pop the Char in the top 8 bits of the Unique(Supply)</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-comment">-- No 64-bit bugs here, as long as we have at least 32 bits. --JSM</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span class="hs-comment">-- and as long as the Char fits in 8 bits, which we assume anyway!</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-identifier">mkUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>       </span><span class="hs-comment">-- Builds a unique from pieces</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- NOT EXPORTED, so that we can see all the Chars that</span><span>
</span><a name="line-154"></a><span class="hs-comment">--               are used in this one module</span><span>
</span><a name="line-155"></a><a name="mkUnique"><a href="Unique.html#mkUnique"><span class="hs-identifier">mkUnique</span></a></a><span> </span><a name="local-6989586621680276194"><a href="#local-6989586621680276194"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621680276195"><a href="#local-6989586621680276195"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-156"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680276196"><span class="hs-identifier hs-var">tag</span></a><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621680276197"><span class="hs-identifier hs-var">bits</span></a><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-158"></a><span>    </span><a name="local-6989586621680276196"><a href="#local-6989586621680276196"><span class="hs-identifier">tag</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621680276194"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><a href="Unique.html#uNIQUE_BITS"><span class="hs-identifier hs-var">uNIQUE_BITS</span></a><span>
</span><a name="line-159"></a><span>    </span><a name="local-6989586621680276197"><a href="#local-6989586621680276197"><span class="hs-identifier">bits</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680276195"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="Unique.html#uniqueMask"><span class="hs-identifier hs-var">uniqueMask</span></a><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><a name="unpkUnique"><a href="Unique.html#unpkUnique"><span class="hs-identifier">unpkUnique</span></a></a><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276198"><a href="#local-6989586621680276198"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><a name="line-163"></a><span>        </span><span class="hs-comment">-- as long as the Char may have its eighth bit set, we</span><span>
</span><a name="line-164"></a><span>        </span><span class="hs-comment">-- really do need the logical right-shift here!</span><span>
</span><a name="line-165"></a><span>        </span><a name="local-6989586621680276199"><a href="#local-6989586621680276199"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">chr</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680276198"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><a href="Unique.html#uNIQUE_BITS"><span class="hs-identifier hs-var">uNIQUE_BITS</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>        </span><a name="local-6989586621680276200"><a href="#local-6989586621680276200"><span class="hs-identifier">i</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680276198"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="Unique.html#uniqueMask"><span class="hs-identifier hs-var">uniqueMask</span></a><span>
</span><a name="line-167"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621680276199"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680276200"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">-- | The interface file symbol-table encoding assumes that known-key uniques fit</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- in 30-bits; verify this.</span><span>
</span><a name="line-172"></a><span class="hs-comment">--</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- See Note [Symbol table representation of names] in BinIface for details.</span><span>
</span><a name="line-174"></a><span class="hs-identifier">isValidKnownKeyUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-175"></a><a name="isValidKnownKeyUnique"><a href="Unique.html#isValidKnownKeyUnique"><span class="hs-identifier">isValidKnownKeyUnique</span></a></a><span> </span><a name="local-6989586621680276201"><a href="#local-6989586621680276201"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-176"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Unique.html#unpkUnique"><span class="hs-identifier hs-var">unpkUnique</span></a><span> </span><a href="#local-6989586621680276201"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-177"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621680276202"><a href="#local-6989586621680276202"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680276203"><a href="#local-6989586621680276203"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621680276202"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0xff</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621680276203"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-number">22</span><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Uniquable-class]{The @Uniquable@ class}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">-- | Class of things that we can obtain a 'Unique' from</span><span>
</span><a name="line-188"></a><span class="hs-keyword">class</span><span> </span><a name="Uniquable"><a href="Unique.html#Uniquable"><span class="hs-identifier">Uniquable</span></a></a><span> </span><a name="local-6989586621680276175"><a href="#local-6989586621680276175"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-189"></a><span>    </span><a name="getUnique"><a href="Unique.html#getUnique"><span class="hs-identifier">getUnique</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680276175"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-identifier">hasKey</span><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="#local-6989586621680276184"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680276184"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-192"></a><a name="local-6989586621680276204"><a href="#local-6989586621680276204"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">`</span><a name="hasKey"><a href="Unique.html#hasKey"><span class="hs-identifier">hasKey</span></a></a><span class="hs-special">`</span><span> </span><a name="local-6989586621680276205"><a href="#local-6989586621680276205"><span class="hs-identifier">k</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680276204"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680276205"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-keyword">instance</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-195"></a><span> </span><a name="local-8214565720325051039"><a href="Unique.html#getUnique"><span class="hs-identifier">getUnique</span></a></a><span> </span><a name="local-6989586621680276183"><a href="#local-6989586621680276183"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUniqueGrimily"><span class="hs-identifier hs-var">mkUniqueGrimily</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#uniqueOfFS"><span class="hs-identifier hs-var">uniqueOfFS</span></a><span> </span><a href="#local-6989586621680276183"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-keyword">instance</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-198"></a><span> </span><a name="local-8214565720325051039"><a href="Unique.html#getUnique"><span class="hs-identifier">getUnique</span></a></a><span> </span><a name="local-6989586621680276182"><a href="#local-6989586621680276182"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUniqueGrimily"><span class="hs-identifier hs-var">mkUniqueGrimily</span></a><span> </span><a href="#local-6989586621680276182"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Unique-instances]{Instance declarations for @Unique@}
*                                                                      *
************************************************************************

And the whole point (besides uniqueness) is fast equality.  We don't
use `deriving' because we want {\em precise} control of ordering
(equality on @Uniques@ is v common).
-}</span><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">-- Note [Unique Determinism]</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- The order of allocated @Uniques@ is not stable across rebuilds.</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- The main reason for that is that typechecking interface files pulls</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- @Uniques@ from @UniqSupply@ and the interface file for the module being</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- currently compiled can, but doesn't have to exist.</span><span>
</span><a name="line-218"></a><span class="hs-comment">--</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- It gets more complicated if you take into account that the interface</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- files are loaded lazily and that building multiple files at once has to</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- work for any subset of interface files present. When you add parallelism</span><span>
</span><a name="line-222"></a><span class="hs-comment">-- this makes @Uniques@ hopelessly random.</span><span>
</span><a name="line-223"></a><span class="hs-comment">--</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- As such, to get deterministic builds, the order of the allocated</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- @Uniques@ should not affect the final result.</span><span>
</span><a name="line-226"></a><span class="hs-comment">-- see also wiki/DeterministicBuilds</span><span>
</span><a name="line-227"></a><span class="hs-comment">--</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- Note [Unique Determinism and code generation]</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- The goal of the deterministic builds (wiki/DeterministicBuilds, #4012)</span><span>
</span><a name="line-231"></a><span class="hs-comment">-- is to get ABI compatible binaries given the same inputs and environment.</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- The motivation behind that is that if the ABI doesn't change the</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- binaries can be safely reused.</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- Note that this is weaker than bit-for-bit identical binaries and getting</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- bit-for-bit identical binaries is not a goal for now.</span><span>
</span><a name="line-236"></a><span class="hs-comment">-- This means that we don't care about nondeterminism that happens after</span><span>
</span><a name="line-237"></a><span class="hs-comment">-- the interface files are created, in particular we don't care about</span><span>
</span><a name="line-238"></a><span class="hs-comment">-- register allocation and code generation.</span><span>
</span><a name="line-239"></a><span class="hs-comment">-- To track progress on bit-for-bit determinism see #12262.</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-identifier">eqUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-242"></a><a name="eqUnique"><a href="Unique.html#eqUnique"><span class="hs-identifier">eqUnique</span></a></a><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276206"><a href="#local-6989586621680276206"><span class="hs-identifier">u1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276207"><a href="#local-6989586621680276207"><span class="hs-identifier">u2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680276206"><span class="hs-identifier hs-var">u1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680276207"><span class="hs-identifier hs-var">u2</span></a><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span class="hs-identifier">ltUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-245"></a><a name="ltUnique"><a href="Unique.html#ltUnique"><span class="hs-identifier">ltUnique</span></a></a><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276208"><a href="#local-6989586621680276208"><span class="hs-identifier">u1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276209"><a href="#local-6989586621680276209"><span class="hs-identifier">u2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680276208"><span class="hs-identifier hs-var">u1</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621680276209"><span class="hs-identifier hs-var">u2</span></a><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-comment">-- Provided here to make it explicit at the call-site that it can</span><span>
</span><a name="line-248"></a><span class="hs-comment">-- introduce non-determinism.</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- See Note [Unique Determinism]</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- See Note [No Ord for Unique]</span><span>
</span><a name="line-251"></a><span class="hs-identifier">nonDetCmpUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-252"></a><a name="nonDetCmpUnique"><a href="Unique.html#nonDetCmpUnique"><span class="hs-identifier">nonDetCmpUnique</span></a></a><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276210"><a href="#local-6989586621680276210"><span class="hs-identifier">u1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Unique.html#MkUnique"><span class="hs-identifier hs-var">MkUnique</span></a><span> </span><a name="local-6989586621680276211"><a href="#local-6989586621680276211"><span class="hs-identifier">u2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680276210"><span class="hs-identifier hs-var">u1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680276211"><span class="hs-identifier hs-var">u2</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680276210"><span class="hs-identifier hs-var">u1</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621680276211"><span class="hs-identifier hs-var">u2</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-comment">{-
Note [No Ord for Unique]
~~~~~~~~~~~~~~~~~~~~~~~~~~
As explained in Note [Unique Determinism] the relative order of Uniques
is nondeterministic. To prevent from accidental use the Ord Unique
instance has been removed.
This makes it easier to maintain deterministic builds, but comes with some
drawbacks.
The biggest drawback is that Maps keyed by Uniques can't directly be used.
The alternatives are:

  1) Use UniqFM or UniqDFM, see Note [Deterministic UniqFM] to decide which
  2) Create a newtype wrapper based on Unique ordering where nondeterminism
     is controlled. See Module.ModuleEnv
  3) Change the algorithm to use nonDetCmpUnique and document why it's still
     deterministic
  4) Use TrieMap as done in CmmCommonBlockElim.groupByLabel
-}</span><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-275"></a><span>    </span><a name="local-6989586621680276178"><a href="#local-6989586621680276178"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a name="local-6989586621680276179"><a href="#local-6989586621680276179"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#eqUnique"><span class="hs-identifier hs-var">eqUnique</span></a><span> </span><a href="#local-6989586621680276178"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621680276179"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-276"></a><span>    </span><a name="local-6989586621680276180"><a href="#local-6989586621680276180"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-8214565720323790494"><span class="hs-operator">/=</span></a><span> </span><a name="local-6989586621680276181"><a href="#local-6989586621680276181"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Unique.html#eqUnique"><span class="hs-identifier hs-var">eqUnique</span></a><span> </span><a href="#local-6989586621680276180"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621680276181"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-keyword">instance</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-279"></a><span>    </span><a name="local-8214565720325051039"><a href="Unique.html#getUnique"><span class="hs-identifier">getUnique</span></a></a><span> </span><a name="local-6989586621680276177"><a href="#local-6989586621680276177"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680276177"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-comment">-- We do sometimes make strings with @Uniques@ in them:</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-identifier">showUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-284"></a><a name="showUnique"><a href="Unique.html#showUnique"><span class="hs-identifier">showUnique</span></a></a><span> </span><a name="local-6989586621680276212"><a href="#local-6989586621680276212"><span class="hs-identifier">uniq</span></a></a><span>
</span><a name="line-285"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Unique.html#unpkUnique"><span class="hs-identifier hs-var">unpkUnique</span></a><span> </span><a href="#local-6989586621680276212"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-286"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621680276213"><a href="#local-6989586621680276213"><span class="hs-identifier">tag</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680276214"><a href="#local-6989586621680276214"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#finish_show"><span class="hs-identifier hs-var">finish_show</span></a><span> </span><a href="#local-6989586621680276213"><span class="hs-identifier hs-var">tag</span></a><span> </span><a href="#local-6989586621680276214"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#iToBase62"><span class="hs-identifier hs-var">iToBase62</span></a><span> </span><a href="#local-6989586621680276214"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span class="hs-identifier">finish_show</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Char</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-289"></a><a name="finish_show"><a href="Unique.html#finish_show"><span class="hs-identifier">finish_show</span></a></a><span> </span><span class="hs-char">'t'</span><span> </span><a name="local-6989586621680276215"><a href="#local-6989586621680276215"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621680276216"><a href="#local-6989586621680276216"><span class="hs-identifier">_pp_u</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680276215"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">26</span><span>
</span><a name="line-290"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Special case to make v common tyvars, t1, t2, ...</span><span>
</span><a name="line-291"></a><span>    </span><span class="hs-comment">-- come out as a, b, ... (shorter, easier to read)</span><span>
</span><a name="line-292"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier hs-var">chr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-char">'a'</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621680276215"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-293"></a><span class="hs-identifier">finish_show</span><span> </span><a name="local-6989586621680276217"><a href="#local-6989586621680276217"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680276218"><a href="#local-6989586621680276218"><span class="hs-identifier">pp_u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680276217"><span class="hs-identifier hs-var">tag</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680276218"><span class="hs-identifier hs-var">pp_u</span></a><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-identifier">pprUniqueAlways</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-296"></a><span class="hs-comment">-- The &quot;always&quot; means regardless of -dsuppress-uniques</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- It replaces the old pprUnique to remind callers that</span><span>
</span><a name="line-298"></a><span class="hs-comment">-- they should consider whether they want to consult</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- Opt_SuppressUniques</span><span>
</span><a name="line-300"></a><a name="pprUniqueAlways"><a href="Unique.html#pprUniqueAlways"><span class="hs-identifier">pprUniqueAlways</span></a></a><span> </span><a name="local-6989586621680276219"><a href="#local-6989586621680276219"><span class="hs-identifier">u</span></a></a><span>
</span><a name="line-301"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#showUnique"><span class="hs-identifier hs-var">showUnique</span></a><span> </span><a href="#local-6989586621680276219"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-304"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#pprUniqueAlways"><span class="hs-identifier hs-var">pprUniqueAlways</span></a><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-307"></a><span>    </span><a name="local-8214565720323790323"><span class="hs-identifier">show</span></a><span> </span><a name="local-6989586621680276176"><a href="#local-6989586621680276176"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#showUnique"><span class="hs-identifier hs-var">showUnique</span></a><span> </span><a href="#local-6989586621680276176"><span class="hs-identifier hs-var">uniq</span></a><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Utils-base62]{Base-62 numbers}
*                                                                      *
************************************************************************

A character-stingy way to read/write numbers (notably Uniques).
The ``62-its'' are \tr{[0-9a-zA-Z]}.  We don't handle negative Ints.
Code stolen from Lennart.
-}</span><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span class="hs-identifier">iToBase62</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-322"></a><a name="iToBase62"><a href="Unique.html#iToBase62"><span class="hs-identifier">iToBase62</span></a></a><span> </span><a name="local-6989586621680276220"><a href="#local-6989586621680276220"><span class="hs-identifier">n_</span></a></a><span>
</span><a name="line-323"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">n_</span></a><span> </span><a href="Util.html#debugIsOn"><span class="hs-operator hs-var">&gt;=</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">go</span><span> </span><span class="hs-identifier">n_</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-324"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-325"></a><span>    </span><a name="local-6989586621680276221"><a href="#local-6989586621680276221"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621680276224"><a href="#local-6989586621680276224"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621680276225"><a href="#local-6989586621680276225"><span class="hs-identifier">cs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680276224"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">62</span><span>
</span><a name="line-326"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621680276229"><a href="#local-6989586621680276229"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680276222"><span class="hs-identifier hs-var">chooseChar62</span></a><span> </span><a href="#local-6989586621680276224"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621680276229"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680276225"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-327"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-328"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680276221"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680276226"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680276228"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680276225"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><a name="local-6989586621680276226"><a href="#local-6989586621680276226"><span class="hs-identifier">q</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680276227"><a href="#local-6989586621680276227"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">quotRem</span><span> </span><a href="#local-6989586621680276224"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">62</span><span>
</span><a name="line-329"></a><span>                                  </span><span class="hs-glyph">!</span><a name="local-6989586621680276228"><a href="#local-6989586621680276228"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680276222"><span class="hs-identifier hs-var">chooseChar62</span></a><span> </span><a href="#local-6989586621680276227"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span>    </span><span class="hs-identifier">chooseChar62</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-332"></a><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">chooseChar62</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-333"></a><span>    </span><a name="local-6989586621680276222"><a href="#local-6989586621680276222"><span class="hs-identifier">chooseChar62</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I#</span><span> </span><a name="local-6989586621680276230"><a href="#local-6989586621680276230"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">C#</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">indexCharOffAddr#</span><span> </span><a href="#local-6989586621680276223"><span class="hs-identifier hs-var">chars62</span></a><span> </span><a href="#local-6989586621680276230"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>    </span><a name="local-6989586621680276223"><a href="#local-6989586621680276223"><span class="hs-identifier">chars62</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;#</span><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Uniques-prelude]{@Uniques@ for wired-in Prelude things}
*                                                                      *
************************************************************************

Allocation of unique supply characters:
        v,t,u : for renumbering value-, type- and usage- vars.
        B:   builtin
        C-E: pseudo uniques     (used in native-code generator)
        X:   uniques derived by deriveUnique
        _:   unifiable tyvars   (above)
        0-9: prelude things below
             (no numbers left any more..)
        ::   (prelude) parallel array data constructors

        other a-z: lower case chars for unique supplies.  Used so far:

        d       desugarer
        f       AbsC flattener
        g       SimplStg
        k       constraint tuple tycons
        m       constraint tuple datacons
        n       Native codegen
        r       Hsc name cache
        s       simplifier
        z       anonymous sums
-}</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-identifier">mkAlphaTyVarUnique</span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-367"></a><span class="hs-identifier">mkPreludeClassUnique</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-368"></a><span class="hs-identifier">mkPreludeTyConUnique</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-369"></a><span class="hs-identifier">mkPreludeDataConUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-370"></a><span class="hs-identifier">mkPrimOpIdUnique</span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-371"></a><span class="hs-identifier">mkPreludeMiscIdUnique</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-372"></a><span class="hs-identifier">mkCoVarUnique</span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><a name="mkAlphaTyVarUnique"><a href="Unique.html#mkAlphaTyVarUnique"><span class="hs-identifier">mkAlphaTyVarUnique</span></a></a><span>   </span><a name="local-6989586621680276231"><a href="#local-6989586621680276231"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'1'</span><span> </span><a href="#local-6989586621680276231"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-375"></a><a name="mkCoVarUnique"><a href="Unique.html#mkCoVarUnique"><span class="hs-identifier">mkCoVarUnique</span></a></a><span>        </span><a name="local-6989586621680276232"><a href="#local-6989586621680276232"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'g'</span><span> </span><a href="#local-6989586621680276232"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-376"></a><a name="mkPreludeClassUnique"><a href="Unique.html#mkPreludeClassUnique"><span class="hs-identifier">mkPreludeClassUnique</span></a></a><span> </span><a name="local-6989586621680276233"><a href="#local-6989586621680276233"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'2'</span><span> </span><a href="#local-6989586621680276233"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-comment">--------------------------------------------------</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- Wired-in type constructor keys occupy *two* slots:</span><span>
</span><a name="line-380"></a><span class="hs-comment">--    * u: the TyCon itself</span><span>
</span><a name="line-381"></a><span class="hs-comment">--    * u+1: the TyConRepName of the TyCon</span><span>
</span><a name="line-382"></a><a name="mkPreludeTyConUnique"><a href="Unique.html#mkPreludeTyConUnique"><span class="hs-identifier">mkPreludeTyConUnique</span></a></a><span> </span><a name="local-6989586621680276234"><a href="#local-6989586621680276234"><span class="hs-identifier">i</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'3'</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-operator hs-var">*</span><a href="#local-6989586621680276234"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span class="hs-identifier">tyConRepNameUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-385"></a><a name="tyConRepNameUnique"><a href="Unique.html#tyConRepNameUnique"><span class="hs-identifier">tyConRepNameUnique</span></a></a><span>  </span><a name="local-6989586621680276235"><a href="#local-6989586621680276235"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#incrUnique"><span class="hs-identifier hs-var">incrUnique</span></a><span> </span><a href="#local-6989586621680276235"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-386"></a><span>
</span><a name="line-387"></a><span class="hs-comment">-- Data constructor keys occupy *two* slots.  The first is used for the</span><span>
</span><a name="line-388"></a><span class="hs-comment">-- data constructor itself and its wrapper function (the function that</span><span>
</span><a name="line-389"></a><span class="hs-comment">-- evaluates arguments as necessary and calls the worker). The second is</span><span>
</span><a name="line-390"></a><span class="hs-comment">-- used for the worker function (the function that builds the constructor</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- representation).</span><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span class="hs-comment">--------------------------------------------------</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- Wired-in data constructor keys occupy *three* slots:</span><span>
</span><a name="line-395"></a><span class="hs-comment">--    * u: the DataCon itself</span><span>
</span><a name="line-396"></a><span class="hs-comment">--    * u+1: its worker Id</span><span>
</span><a name="line-397"></a><span class="hs-comment">--    * u+2: the TyConRepName of the promoted TyCon</span><span>
</span><a name="line-398"></a><span class="hs-comment">-- Prelude data constructors are too simple to need wrappers.</span><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><a name="mkPreludeDataConUnique"><a href="Unique.html#mkPreludeDataConUnique"><span class="hs-identifier">mkPreludeDataConUnique</span></a></a><span> </span><a name="local-6989586621680276236"><a href="#local-6989586621680276236"><span class="hs-identifier">i</span></a></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'6'</span><span> </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-operator hs-var">*</span><a href="#local-6989586621680276236"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Must be alphabetic</span><span>
</span><a name="line-401"></a><span>
</span><a name="line-402"></a><span class="hs-comment">--------------------------------------------------</span><span>
</span><a name="line-403"></a><span class="hs-identifier">dataConTyRepNameUnique</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">dataConWorkerUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-404"></a><a name="dataConWorkerUnique"><a href="Unique.html#dataConWorkerUnique"><span class="hs-identifier">dataConWorkerUnique</span></a></a><span>  </span><a name="local-6989586621680276237"><a href="#local-6989586621680276237"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#incrUnique"><span class="hs-identifier hs-var">incrUnique</span></a><span> </span><a href="#local-6989586621680276237"><span class="hs-identifier hs-var">u</span></a><span>
</span><a name="line-405"></a><a name="dataConTyRepNameUnique"><a href="Unique.html#dataConTyRepNameUnique"><span class="hs-identifier">dataConTyRepNameUnique</span></a></a><span> </span><a name="local-6989586621680276238"><a href="#local-6989586621680276238"><span class="hs-identifier">u</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#stepUnique"><span class="hs-identifier hs-var">stepUnique</span></a><span> </span><a href="#local-6989586621680276238"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><span class="hs-comment">--------------------------------------------------</span><span>
</span><a name="line-408"></a><a name="mkPrimOpIdUnique"><a href="Unique.html#mkPrimOpIdUnique"><span class="hs-identifier">mkPrimOpIdUnique</span></a></a><span> </span><a name="local-6989586621680276239"><a href="#local-6989586621680276239"><span class="hs-identifier">op</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'9'</span><span> </span><a href="#local-6989586621680276239"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-409"></a><a name="mkPreludeMiscIdUnique"><a href="Unique.html#mkPreludeMiscIdUnique"><span class="hs-identifier">mkPreludeMiscIdUnique</span></a></a><span>  </span><a name="local-6989586621680276240"><a href="#local-6989586621680276240"><span class="hs-identifier">i</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'0'</span><span> </span><a href="#local-6989586621680276240"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span class="hs-comment">-- The &quot;tyvar uniques&quot; print specially nicely: a, b, c, etc.</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- See pprUnique for details</span><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span class="hs-identifier">initTyVarUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-415"></a><a name="initTyVarUnique"><a href="Unique.html#initTyVarUnique"><span class="hs-identifier">initTyVarUnique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'t'</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-identifier">mkPseudoUniqueD</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkPseudoUniqueE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkPseudoUniqueH</span><span class="hs-special">,</span><span>
</span><a name="line-418"></a><span>   </span><span class="hs-identifier">mkBuiltinUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><a name="mkBuiltinUnique"><a href="Unique.html#mkBuiltinUnique"><span class="hs-identifier">mkBuiltinUnique</span></a></a><span> </span><a name="local-6989586621680276241"><a href="#local-6989586621680276241"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'B'</span><span> </span><a href="#local-6989586621680276241"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-421"></a><a name="mkPseudoUniqueD"><a href="Unique.html#mkPseudoUniqueD"><span class="hs-identifier">mkPseudoUniqueD</span></a></a><span> </span><a name="local-6989586621680276242"><a href="#local-6989586621680276242"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'D'</span><span> </span><a href="#local-6989586621680276242"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-comment">-- used in NCG for getUnique on RealRegs</span><span>
</span><a name="line-422"></a><a name="mkPseudoUniqueE"><a href="Unique.html#mkPseudoUniqueE"><span class="hs-identifier">mkPseudoUniqueE</span></a></a><span> </span><a name="local-6989586621680276243"><a href="#local-6989586621680276243"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'E'</span><span> </span><a href="#local-6989586621680276243"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-comment">-- used in NCG spiller to create spill VirtualRegs</span><span>
</span><a name="line-423"></a><a name="mkPseudoUniqueH"><a href="Unique.html#mkPseudoUniqueH"><span class="hs-identifier">mkPseudoUniqueH</span></a></a><span> </span><a name="local-6989586621680276244"><a href="#local-6989586621680276244"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'H'</span><span> </span><a href="#local-6989586621680276244"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-comment">-- used in NCG spiller to create spill VirtualRegs</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span class="hs-identifier">mkRegSingleUnique</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkRegPairUnique</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkRegSubUnique</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkRegClassUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-426"></a><a name="mkRegSingleUnique"><a href="Unique.html#mkRegSingleUnique"><span class="hs-identifier">mkRegSingleUnique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'R'</span><span>
</span><a name="line-427"></a><a name="mkRegSubUnique"><a href="Unique.html#mkRegSubUnique"><span class="hs-identifier">mkRegSubUnique</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'S'</span><span>
</span><a name="line-428"></a><a name="mkRegPairUnique"><a href="Unique.html#mkRegPairUnique"><span class="hs-identifier">mkRegPairUnique</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'P'</span><span>
</span><a name="line-429"></a><a name="mkRegClassUnique"><a href="Unique.html#mkRegClassUnique"><span class="hs-identifier">mkRegClassUnique</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'L'</span><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span class="hs-identifier">mkCostCentreUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-432"></a><a name="mkCostCentreUnique"><a href="Unique.html#mkCostCentreUnique"><span class="hs-identifier">mkCostCentreUnique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'C'</span><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span class="hs-identifier">mkVarOccUnique</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkDataOccUnique</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkTvOccUnique</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkTcOccUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-435"></a><span class="hs-comment">-- See Note [The Unique of an OccName] in OccName</span><span>
</span><a name="line-436"></a><a name="mkVarOccUnique"><a href="Unique.html#mkVarOccUnique"><span class="hs-identifier">mkVarOccUnique</span></a></a><span>  </span><a name="local-6989586621680276245"><a href="#local-6989586621680276245"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'i'</span><span> </span><span class="hs-special">(</span><a href="FastString.html#uniqueOfFS"><span class="hs-identifier hs-var">uniqueOfFS</span></a><span> </span><a href="#local-6989586621680276245"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-437"></a><a name="mkDataOccUnique"><a href="Unique.html#mkDataOccUnique"><span class="hs-identifier">mkDataOccUnique</span></a></a><span> </span><a name="local-6989586621680276246"><a href="#local-6989586621680276246"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'d'</span><span> </span><span class="hs-special">(</span><a href="FastString.html#uniqueOfFS"><span class="hs-identifier hs-var">uniqueOfFS</span></a><span> </span><a href="#local-6989586621680276246"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-438"></a><a name="mkTvOccUnique"><a href="Unique.html#mkTvOccUnique"><span class="hs-identifier">mkTvOccUnique</span></a></a><span>   </span><a name="local-6989586621680276247"><a href="#local-6989586621680276247"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'v'</span><span> </span><span class="hs-special">(</span><a href="FastString.html#uniqueOfFS"><span class="hs-identifier hs-var">uniqueOfFS</span></a><span> </span><a href="#local-6989586621680276247"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-439"></a><a name="mkTcOccUnique"><a href="Unique.html#mkTcOccUnique"><span class="hs-identifier">mkTcOccUnique</span></a></a><span>   </span><a name="local-6989586621680276248"><a href="#local-6989586621680276248"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'c'</span><span> </span><span class="hs-special">(</span><a href="FastString.html#uniqueOfFS"><span class="hs-identifier hs-var">uniqueOfFS</span></a><span> </span><a href="#local-6989586621680276248"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><span class="hs-identifier">initExitJoinUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-442"></a><a name="initExitJoinUnique"><a href="Unique.html#initExitJoinUnique"><span class="hs-identifier">initExitJoinUnique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#mkUnique"><span class="hs-identifier hs-var">mkUnique</span></a><span> </span><span class="hs-char">'s'</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-443"></a></pre></body></html>