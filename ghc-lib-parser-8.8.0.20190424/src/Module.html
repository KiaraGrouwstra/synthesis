<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow, 2004-2006


Module
~~~~~~~~~~
Simply the name of a module, represented as a FastString.
These are Uniquable, hence we can build Maps with Modules as
the keys.
-}</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Module</span><span>
</span><a name="line-16"></a><span>    </span><span class="hs-special">(</span><span>
</span><a name="line-17"></a><span>        </span><span class="hs-comment">-- * The ModuleName type</span><span>
</span><a name="line-18"></a><span>        </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>        </span><a href="Module.html#pprModuleName"><span class="hs-identifier hs-var">pprModuleName</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="Module.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="Module.html#moduleNameSlashes"><span class="hs-identifier hs-var">moduleNameSlashes</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#moduleNameColons"><span class="hs-identifier hs-var">moduleNameColons</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="Module.html#moduleStableString"><span class="hs-identifier hs-var">moduleStableString</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="Module.html#moduleFreeHoles"><span class="hs-identifier hs-var">moduleFreeHoles</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><a href="Module.html#moduleIsDefinite"><span class="hs-identifier hs-var">moduleIsDefinite</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>        </span><a href="Module.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>        </span><a href="Module.html#mkModuleNameFS"><span class="hs-identifier hs-var">mkModuleNameFS</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="Module.html#stableModuleNameCmp"><span class="hs-identifier hs-var">stableModuleNameCmp</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span>        </span><span class="hs-comment">-- * The UnitId type</span><span>
</span><a name="line-31"></a><span>        </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>        </span><a href="Module.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>        </span><a href="Module.html#unitIdKey"><span class="hs-identifier hs-var">unitIdKey</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="Module.html#IndefModule"><span class="hs-identifier hs-type">IndefModule</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="Module.html#indefUnitIdToUnitId"><span class="hs-identifier hs-var">indefUnitIdToUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="Module.html#indefModuleToModule"><span class="hs-identifier hs-var">indefModuleToModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>        </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="Module.html#toInstalledUnitId"><span class="hs-identifier hs-var">toInstalledUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="Module.html#ShHoleSubst"><span class="hs-identifier hs-type">ShHoleSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>        </span><a href="Module.html#unitIdIsDefinite"><span class="hs-identifier hs-var">unitIdIsDefinite</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="Module.html#unitIdString"><span class="hs-identifier hs-var">unitIdString</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>        </span><a href="Module.html#unitIdFreeHoles"><span class="hs-identifier hs-var">unitIdFreeHoles</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span>        </span><a href="Module.html#newUnitId"><span class="hs-identifier hs-var">newUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="Module.html#newIndefUnitId"><span class="hs-identifier hs-var">newIndefUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="Module.html#newSimpleUnitId"><span class="hs-identifier hs-var">newSimpleUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>        </span><a href="Module.html#hashUnitId"><span class="hs-identifier hs-var">hashUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>        </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="Module.html#stringToUnitId"><span class="hs-identifier hs-var">stringToUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="Module.html#stableUnitIdCmp"><span class="hs-identifier hs-var">stableUnitIdCmp</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>        </span><span class="hs-comment">-- * HOLE renaming</span><span>
</span><a name="line-56"></a><span>        </span><a href="Module.html#renameHoleUnitId"><span class="hs-identifier hs-var">renameHoleUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>        </span><a href="Module.html#renameHoleModule"><span class="hs-identifier hs-var">renameHoleModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>        </span><a href="Module.html#renameHoleUnitId%27"><span class="hs-identifier hs-var">renameHoleUnitId'</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>        </span><a href="Module.html#renameHoleModule%27"><span class="hs-identifier hs-var">renameHoleModule'</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span>        </span><span class="hs-comment">-- * Generalization</span><span>
</span><a name="line-62"></a><span>        </span><a href="Module.html#splitModuleInsts"><span class="hs-identifier hs-var">splitModuleInsts</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>        </span><a href="Module.html#splitUnitIdInsts"><span class="hs-identifier hs-var">splitUnitIdInsts</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>        </span><a href="Module.html#generalizeIndefUnitId"><span class="hs-identifier hs-var">generalizeIndefUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>        </span><a href="Module.html#generalizeIndefModule"><span class="hs-identifier hs-var">generalizeIndefModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>        </span><span class="hs-comment">-- * Parsers</span><span>
</span><a name="line-68"></a><span>        </span><a href="Module.html#parseModuleName"><span class="hs-identifier hs-var">parseModuleName</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>        </span><a href="Module.html#parseUnitId"><span class="hs-identifier hs-var">parseUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>        </span><a href="Module.html#parseComponentId"><span class="hs-identifier hs-var">parseComponentId</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>        </span><a href="Module.html#parseModuleId"><span class="hs-identifier hs-var">parseModuleId</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>        </span><a href="Module.html#parseModSubst"><span class="hs-identifier hs-var">parseModSubst</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>        </span><span class="hs-comment">-- * Wired-in UnitIds</span><span>
</span><a name="line-75"></a><span>        </span><span class="hs-comment">-- $wired_in_packages</span><span>
</span><a name="line-76"></a><span>        </span><a href="Module.html#primUnitId"><span class="hs-identifier hs-var">primUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>        </span><a href="Module.html#integerUnitId"><span class="hs-identifier hs-var">integerUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>        </span><a href="Module.html#baseUnitId"><span class="hs-identifier hs-var">baseUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>        </span><a href="Module.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>        </span><a href="Module.html#thUnitId"><span class="hs-identifier hs-var">thUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>        </span><a href="Module.html#mainUnitId"><span class="hs-identifier hs-var">mainUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>        </span><a href="Module.html#thisGhcUnitId"><span class="hs-identifier hs-var">thisGhcUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>        </span><a href="Module.html#isHoleModule"><span class="hs-identifier hs-var">isHoleModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>        </span><a href="Module.html#interactiveUnitId"><span class="hs-identifier hs-var">interactiveUnitId</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#isInteractiveModule"><span class="hs-identifier hs-var">isInteractiveModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>        </span><a href="Module.html#wiredInUnitIds"><span class="hs-identifier hs-var">wiredInUnitIds</span></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span>        </span><span class="hs-comment">-- * The Module type</span><span>
</span><a name="line-88"></a><span>        </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>        </span><a href="Module.html#moduleUnitId"><span class="hs-identifier hs-var">moduleUnitId</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#moduleName"><span class="hs-identifier hs-var">moduleName</span></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>        </span><a href="Module.html#pprModule"><span class="hs-identifier hs-var">pprModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-91"></a><span>        </span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>        </span><a href="Module.html#mkHoleModule"><span class="hs-identifier hs-var">mkHoleModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>        </span><a href="Module.html#stableModuleCmp"><span class="hs-identifier hs-var">stableModuleCmp</span></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>        </span><a href="Module.html#HasModule"><span class="hs-identifier hs-type">HasModule</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>        </span><a href="Module.html#ContainsModule"><span class="hs-identifier hs-type">ContainsModule</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span>        </span><span class="hs-comment">-- * Installed unit ids and modules</span><span>
</span><a name="line-98"></a><span>        </span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>        </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>        </span><a href="Module.html#installedModuleEq"><span class="hs-identifier hs-var">installedModuleEq</span></a><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>        </span><a href="Module.html#installedUnitIdEq"><span class="hs-identifier hs-var">installedUnitIdEq</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>        </span><a href="Module.html#installedUnitIdString"><span class="hs-identifier hs-var">installedUnitIdString</span></a><span class="hs-special">,</span><span>
</span><a name="line-103"></a><span>        </span><a href="Module.html#fsToInstalledUnitId"><span class="hs-identifier hs-var">fsToInstalledUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-104"></a><span>        </span><a href="Module.html#componentIdToInstalledUnitId"><span class="hs-identifier hs-var">componentIdToInstalledUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-105"></a><span>        </span><a href="Module.html#stringToInstalledUnitId"><span class="hs-identifier hs-var">stringToInstalledUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>        </span><a href="Module.html#emptyInstalledModuleEnv"><span class="hs-identifier hs-var">emptyInstalledModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-107"></a><span>        </span><a href="Module.html#lookupInstalledModuleEnv"><span class="hs-identifier hs-var">lookupInstalledModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span>        </span><a href="Module.html#extendInstalledModuleEnv"><span class="hs-identifier hs-var">extendInstalledModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>        </span><a href="Module.html#filterInstalledModuleEnv"><span class="hs-identifier hs-var">filterInstalledModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>        </span><a href="Module.html#delInstalledModuleEnv"><span class="hs-identifier hs-var">delInstalledModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-111"></a><span>        </span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-type">DefUnitId</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span>        </span><span class="hs-comment">-- * The ModuleLocation type</span><span>
</span><a name="line-114"></a><span>        </span><a href="Module.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-115"></a><span>        </span><a href="Module.html#addBootSuffix"><span class="hs-identifier hs-var">addBootSuffix</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#addBootSuffix_maybe"><span class="hs-identifier hs-var">addBootSuffix_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-116"></a><span>        </span><a href="Module.html#addBootSuffixLocn"><span class="hs-identifier hs-var">addBootSuffixLocn</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#addBootSuffixLocnOut"><span class="hs-identifier hs-var">addBootSuffixLocnOut</span></a><span class="hs-special">,</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span>        </span><span class="hs-comment">-- * Module mappings</span><span>
</span><a name="line-119"></a><span>        </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-120"></a><span>        </span><a href="Module.html#elemModuleEnv"><span class="hs-identifier hs-var">elemModuleEnv</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#extendModuleEnv"><span class="hs-identifier hs-var">extendModuleEnv</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#extendModuleEnvList"><span class="hs-identifier hs-var">extendModuleEnvList</span></a><span class="hs-special">,</span><span>
</span><a name="line-121"></a><span>        </span><a href="Module.html#extendModuleEnvList_C"><span class="hs-identifier hs-var">extendModuleEnvList_C</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#plusModuleEnv_C"><span class="hs-identifier hs-var">plusModuleEnv_C</span></a><span class="hs-special">,</span><span>
</span><a name="line-122"></a><span>        </span><a href="Module.html#delModuleEnvList"><span class="hs-identifier hs-var">delModuleEnvList</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#delModuleEnv"><span class="hs-identifier hs-var">delModuleEnv</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#plusModuleEnv"><span class="hs-identifier hs-var">plusModuleEnv</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#lookupModuleEnv"><span class="hs-identifier hs-var">lookupModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-123"></a><span>        </span><a href="Module.html#lookupWithDefaultModuleEnv"><span class="hs-identifier hs-var">lookupWithDefaultModuleEnv</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#mapModuleEnv"><span class="hs-identifier hs-var">mapModuleEnv</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#mkModuleEnv"><span class="hs-identifier hs-var">mkModuleEnv</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#emptyModuleEnv"><span class="hs-identifier hs-var">emptyModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-124"></a><span>        </span><a href="Module.html#moduleEnvKeys"><span class="hs-identifier hs-var">moduleEnvKeys</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#moduleEnvElts"><span class="hs-identifier hs-var">moduleEnvElts</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#moduleEnvToList"><span class="hs-identifier hs-var">moduleEnvToList</span></a><span class="hs-special">,</span><span>
</span><a name="line-125"></a><span>        </span><a href="Module.html#unitModuleEnv"><span class="hs-identifier hs-var">unitModuleEnv</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#isEmptyModuleEnv"><span class="hs-identifier hs-var">isEmptyModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-126"></a><span>        </span><a href="Module.html#extendModuleEnvWith"><span class="hs-identifier hs-var">extendModuleEnvWith</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#filterModuleEnv"><span class="hs-identifier hs-var">filterModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>        </span><span class="hs-comment">-- * ModuleName mappings</span><span>
</span><a name="line-129"></a><span>        </span><a href="Module.html#ModuleNameEnv"><span class="hs-identifier hs-type">ModuleNameEnv</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#DModuleNameEnv"><span class="hs-identifier hs-type">DModuleNameEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span>        </span><span class="hs-comment">-- * Sets of Modules</span><span>
</span><a name="line-132"></a><span>        </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-133"></a><span>        </span><a href="Module.html#emptyModuleSet"><span class="hs-identifier hs-var">emptyModuleSet</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#mkModuleSet"><span class="hs-identifier hs-var">mkModuleSet</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#moduleSetElts"><span class="hs-identifier hs-var">moduleSetElts</span></a><span class="hs-special">,</span><span>
</span><a name="line-134"></a><span>        </span><a href="Module.html#extendModuleSet"><span class="hs-identifier hs-var">extendModuleSet</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#extendModuleSetList"><span class="hs-identifier hs-var">extendModuleSetList</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#delModuleSet"><span class="hs-identifier hs-var">delModuleSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-135"></a><span>        </span><a href="Module.html#elemModuleSet"><span class="hs-identifier hs-var">elemModuleSet</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#intersectModuleSet"><span class="hs-identifier hs-var">intersectModuleSet</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#minusModuleSet"><span class="hs-identifier hs-var">minusModuleSet</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#unionModuleSet"><span class="hs-identifier hs-var">unionModuleSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-136"></a><span>        </span><a href="Module.html#unitModuleSet"><span class="hs-identifier hs-var">unitModuleSet</span></a><span>
</span><a name="line-137"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-142"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-143"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-144"></a><span class="hs-keyword">import</span><span> </span><a href="UniqDFM.html"><span class="hs-identifier">UniqDFM</span></a><span>
</span><a name="line-145"></a><span class="hs-keyword">import</span><span> </span><a href="UniqDSet.html"><span class="hs-identifier">UniqDSet</span></a><span>
</span><a name="line-146"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-147"></a><span class="hs-keyword">import</span><span> </span><a href="Binary.html"><span class="hs-identifier">Binary</span></a><span>
</span><a name="line-148"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-149"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>
</span><a name="line-150"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Ord</span><span>
</span><a name="line-151"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.PackageDb.html"><span class="hs-identifier">GHC.PackageDb</span></a><span> </span><span class="hs-special">(</span><a href="GHC.PackageDb.html#BinaryStringRep"><span class="hs-identifier hs-type">BinaryStringRep</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="GHC.PackageDb.html#DbUnitIdModuleRep"><span class="hs-identifier hs-type">DbUnitIdModuleRep</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="GHC.PackageDb.html#DbModule"><span class="hs-identifier hs-type">DbModule</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="GHC.PackageDb.html#DbUnitId"><span class="hs-identifier hs-type">DbUnitId</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span class="hs-keyword">import</span><span> </span><a href="Fingerprint.html"><span class="hs-identifier">Fingerprint</span></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS</span><span>
</span><a name="line-155"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Char8</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS.Char8</span><span>
</span><a name="line-156"></a><span class="hs-keyword">import</span><span> </span><a href="Encoding.html"><span class="hs-identifier">Encoding</span></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Text.ParserCombinators.ReadP</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Parse</span><span>
</span><a name="line-159"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text.ParserCombinators.ReadP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ReadP</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;++</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isAlphaNum</span><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.DeepSeq</span><span>
</span><a name="line-162"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Coerce</span><span>
</span><a name="line-163"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Data</span><span>
</span><a name="line-164"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Function</span><span>
</span><a name="line-165"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set</span><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-168"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-169"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="FiniteMap.html"><span class="hs-identifier">FiniteMap</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-170"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.FilePath</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Packages.html"><span class="hs-identifier">Packages</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#componentIdString"><span class="hs-identifier hs-var">componentIdString</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#improveUnitId"><span class="hs-identifier hs-var">improveUnitId</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#getPackageConfigMap"><span class="hs-identifier hs-var">getPackageConfigMap</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#displayInstalledUnitId"><span class="hs-identifier hs-var">displayInstalledUnitId</span></a><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span class="hs-comment">-- Note [The identifier lexicon]</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-177"></a><span class="hs-comment">-- Unit IDs, installed package IDs, ABI hashes, package names,</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- versions, there are a *lot* of different identifiers for closely</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- related things.  What do they all mean? Here's what.  (See also</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- https://ghc.haskell.org/trac/ghc/wiki/Commentary/Packages/Concepts )</span><span>
</span><a name="line-181"></a><span class="hs-comment">--</span><span>
</span><a name="line-182"></a><span class="hs-comment">-- THE IMPORTANT ONES</span><span>
</span><a name="line-183"></a><span class="hs-comment">--</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- ComponentId: An opaque identifier provided by Cabal, which should</span><span>
</span><a name="line-185"></a><span class="hs-comment">-- uniquely identify such things as the package name, the package</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- version, the name of the component, the hash of the source code</span><span>
</span><a name="line-187"></a><span class="hs-comment">-- tarball, the selected Cabal flags, GHC flags, direct dependencies of</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- the component.  These are very similar to InstalledPackageId, but</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- an 'InstalledPackageId' implies that it identifies a package, while</span><span>
</span><a name="line-190"></a><span class="hs-comment">-- a package may install multiple components with different</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- 'ComponentId's.</span><span>
</span><a name="line-192"></a><span class="hs-comment">--      - Same as Distribution.Package.ComponentId</span><span>
</span><a name="line-193"></a><span class="hs-comment">--</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- UnitId/InstalledUnitId: A ComponentId + a mapping from hole names</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- (ModuleName) to Modules.  This is how the compiler identifies instantiated</span><span>
</span><a name="line-196"></a><span class="hs-comment">-- components, and also is the main identifier by which GHC identifies things.</span><span>
</span><a name="line-197"></a><span class="hs-comment">--      - When Backpack is not being used, UnitId = ComponentId.</span><span>
</span><a name="line-198"></a><span class="hs-comment">--        this means a useful fiction for end-users is that there are</span><span>
</span><a name="line-199"></a><span class="hs-comment">--        only ever ComponentIds, and some ComponentIds happen to have</span><span>
</span><a name="line-200"></a><span class="hs-comment">--        more information (UnitIds).</span><span>
</span><a name="line-201"></a><span class="hs-comment">--      - Same as Language.Haskell.TH.Syntax:PkgName, see</span><span>
</span><a name="line-202"></a><span class="hs-comment">--          https://ghc.haskell.org/trac/ghc/ticket/10279</span><span>
</span><a name="line-203"></a><span class="hs-comment">--      - The same as PackageKey in GHC 7.10 (we renamed it because</span><span>
</span><a name="line-204"></a><span class="hs-comment">--        they don't necessarily identify packages anymore.)</span><span>
</span><a name="line-205"></a><span class="hs-comment">--      - Same as -this-package-key/-package-name flags</span><span>
</span><a name="line-206"></a><span class="hs-comment">--      - An InstalledUnitId corresponds to an actual package which</span><span>
</span><a name="line-207"></a><span class="hs-comment">--        we have installed on disk.  It could be definite or indefinite,</span><span>
</span><a name="line-208"></a><span class="hs-comment">--        but if it's indefinite, it has nothing instantiated (we</span><span>
</span><a name="line-209"></a><span class="hs-comment">--        never install partially instantiated units.)</span><span>
</span><a name="line-210"></a><span class="hs-comment">--</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- Module/InstalledModule: A UnitId/InstalledUnitId + ModuleName. This is how</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- the compiler identifies modules (e.g. a Name is a Module + OccName)</span><span>
</span><a name="line-213"></a><span class="hs-comment">--      - Same as Language.Haskell.TH.Syntax:Module</span><span>
</span><a name="line-214"></a><span class="hs-comment">--</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- THE LESS IMPORTANT ONES</span><span>
</span><a name="line-216"></a><span class="hs-comment">--</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- PackageName: The &quot;name&quot; field in a Cabal file, something like &quot;lens&quot;.</span><span>
</span><a name="line-218"></a><span class="hs-comment">--      - Same as Distribution.Package.PackageName</span><span>
</span><a name="line-219"></a><span class="hs-comment">--      - DIFFERENT FROM Language.Haskell.TH.Syntax:PkgName, see</span><span>
</span><a name="line-220"></a><span class="hs-comment">--          https://ghc.haskell.org/trac/ghc/ticket/10279</span><span>
</span><a name="line-221"></a><span class="hs-comment">--      - DIFFERENT FROM -package-name flag</span><span>
</span><a name="line-222"></a><span class="hs-comment">--      - DIFFERENT FROM the 'name' field in an installed package</span><span>
</span><a name="line-223"></a><span class="hs-comment">--        information.  This field could more accurately be described</span><span>
</span><a name="line-224"></a><span class="hs-comment">--        as a munged package name: when it's for the main library</span><span>
</span><a name="line-225"></a><span class="hs-comment">--        it is the same as the package name, but if it's an internal</span><span>
</span><a name="line-226"></a><span class="hs-comment">--        library it's a munged combination of the package name and</span><span>
</span><a name="line-227"></a><span class="hs-comment">--        the component name.</span><span>
</span><a name="line-228"></a><span class="hs-comment">--</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- LEGACY ONES</span><span>
</span><a name="line-230"></a><span class="hs-comment">--</span><span>
</span><a name="line-231"></a><span class="hs-comment">-- InstalledPackageId: This is what we used to call ComponentId.</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- It's a still pretty useful concept for packages that have only</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- one library; in that case the logical InstalledPackageId =</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- ComponentId.  Also, the Cabal nix-local-build continues to</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- compute an InstalledPackageId which is then forcibly used</span><span>
</span><a name="line-236"></a><span class="hs-comment">-- for all components in a package.  This means that if a dependency</span><span>
</span><a name="line-237"></a><span class="hs-comment">-- from one component in a package changes, the InstalledPackageId</span><span>
</span><a name="line-238"></a><span class="hs-comment">-- changes: you don't get as fine-grained dependency tracking,</span><span>
</span><a name="line-239"></a><span class="hs-comment">-- but it means your builds are hermetic.  Eventually, Cabal will</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- deal completely in components and we can get rid of this.</span><span>
</span><a name="line-241"></a><span class="hs-comment">--</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- PackageKey: This is what we used to call UnitId.  We ditched</span><span>
</span><a name="line-243"></a><span class="hs-comment">-- &quot;Package&quot; from the name when we realized that you might want to</span><span>
</span><a name="line-244"></a><span class="hs-comment">-- assign different &quot;PackageKeys&quot; to components from the same package.</span><span>
</span><a name="line-245"></a><span class="hs-comment">-- (For a brief, non-released period of time, we also called these</span><span>
</span><a name="line-246"></a><span class="hs-comment">-- UnitKeys).</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Module locations}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-comment">-- | Module Location</span><span>
</span><a name="line-257"></a><span class="hs-comment">--</span><span>
</span><a name="line-258"></a><span class="hs-comment">-- Where a module lives on the file system: the actual locations</span><span>
</span><a name="line-259"></a><span class="hs-comment">-- of the .hs, .hi and .o files, if we have them</span><span>
</span><a name="line-260"></a><span class="hs-keyword">data</span><span> </span><a name="ModLocation"><a href="Module.html#ModLocation"><span class="hs-identifier">ModLocation</span></a></a><span>
</span><a name="line-261"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="ModLocation"><a href="Module.html#ModLocation"><span class="hs-identifier">ModLocation</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-262"></a><span>        </span><a name="ml_hs_file"><a href="Module.html#ml_hs_file"><span class="hs-identifier">ml_hs_file</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span>
</span><a name="line-263"></a><span>                </span><span class="hs-comment">-- The source file, if we have one.  Package modules</span><span>
</span><a name="line-264"></a><span>                </span><span class="hs-comment">-- probably don't have source files.</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span>        </span><a name="ml_hi_file"><a href="Module.html#ml_hi_file"><span class="hs-identifier">ml_hi_file</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span>
</span><a name="line-267"></a><span>                </span><span class="hs-comment">-- Where the .hi file is, whether or not it exists</span><span>
</span><a name="line-268"></a><span>                </span><span class="hs-comment">-- yet.  Always of form foo.hi, even if there is an</span><span>
</span><a name="line-269"></a><span>                </span><span class="hs-comment">-- hi-boot file (we add the -boot suffix later)</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span>        </span><a name="ml_obj_file"><a href="Module.html#ml_obj_file"><span class="hs-identifier">ml_obj_file</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span>
</span><a name="line-272"></a><span>                </span><span class="hs-comment">-- Where the .o file is, whether or not it exists yet.</span><span>
</span><a name="line-273"></a><span>                </span><span class="hs-comment">-- (might not exist either because the module hasn't</span><span>
</span><a name="line-274"></a><span>                </span><span class="hs-comment">-- been compiled yet, or because it is part of a</span><span>
</span><a name="line-275"></a><span>                </span><span class="hs-comment">-- package with a .a file)</span><span>
</span><a name="line-276"></a><span>        </span><a name="ml_hie_file"><a href="Module.html#ml_hie_file"><span class="hs-identifier">ml_hie_file</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-277"></a><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Module.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-280"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-comment">{-
For a module in another package, the hs_file and obj_file
components of ModLocation are undefined.

The locations specified by a ModLocation may or may not
correspond to actual files yet: for example, even if the object
file doesn't exist, the ModLocation still contains the path to
where the object file will reside if/when it is created.
-}</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-identifier">addBootSuffix</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-293"></a><span class="hs-comment">-- ^ Add the @-boot@ suffix to .hs, .hi and .o files</span><span>
</span><a name="line-294"></a><a name="addBootSuffix"><a href="Module.html#addBootSuffix"><span class="hs-identifier">addBootSuffix</span></a></a><span> </span><a name="local-6989586621680411888"><a href="#local-6989586621680411888"><span class="hs-identifier">path</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411888"><span class="hs-identifier hs-var">path</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;-boot&quot;</span><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span class="hs-identifier">addBootSuffix_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-297"></a><span class="hs-comment">-- ^ Add the @-boot@ suffix if the @Bool@ argument is @True@</span><span>
</span><a name="line-298"></a><a name="addBootSuffix_maybe"><a href="Module.html#addBootSuffix_maybe"><span class="hs-identifier">addBootSuffix_maybe</span></a></a><span> </span><a name="local-6989586621680411889"><a href="#local-6989586621680411889"><span class="hs-identifier">is_boot</span></a></a><span> </span><a name="local-6989586621680411890"><a href="#local-6989586621680411890"><span class="hs-identifier">path</span></a></a><span>
</span><a name="line-299"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680411889"><span class="hs-identifier hs-var">is_boot</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#addBootSuffix"><span class="hs-identifier hs-var">addBootSuffix</span></a><span> </span><a href="#local-6989586621680411890"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-300"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411890"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span class="hs-identifier">addBootSuffixLocn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a><span>
</span><a name="line-303"></a><span class="hs-comment">-- ^ Add the @-boot@ suffix to all file paths associated with the module</span><span>
</span><a name="line-304"></a><a name="addBootSuffixLocn"><a href="Module.html#addBootSuffixLocn"><span class="hs-identifier">addBootSuffixLocn</span></a></a><span> </span><a name="local-6989586621680411891"><a href="#local-6989586621680411891"><span class="hs-identifier">locn</span></a></a><span>
</span><a name="line-305"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411891"><span class="hs-identifier hs-var">locn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ml_hs_file</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Module.html#addBootSuffix"><span class="hs-identifier hs-var">addBootSuffix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ml_hs_file</span><span> </span><a href="#local-6989586621680411891"><span class="hs-identifier hs-var">locn</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ml_hi_file</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#addBootSuffix"><span class="hs-identifier hs-var">addBootSuffix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ml_hi_file</span><span> </span><a href="#local-6989586621680411891"><span class="hs-identifier hs-var">locn</span></a><span class="hs-special">)</span><span>
</span><a name="line-307"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ml_obj_file</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#addBootSuffix"><span class="hs-identifier hs-var">addBootSuffix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ml_obj_file</span><span> </span><a href="#local-6989586621680411891"><span class="hs-identifier hs-var">locn</span></a><span class="hs-special">)</span><span>
</span><a name="line-308"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ml_hie_file</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#addBootSuffix"><span class="hs-identifier hs-var">addBootSuffix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ml_hie_file</span><span> </span><a href="#local-6989586621680411891"><span class="hs-identifier hs-var">locn</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span class="hs-identifier">addBootSuffixLocnOut</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a><span>
</span><a name="line-311"></a><span class="hs-comment">-- ^ Add the @-boot@ suffix to all output file paths associated with the</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- module, not including the input file itself</span><span>
</span><a name="line-313"></a><a name="addBootSuffixLocnOut"><a href="Module.html#addBootSuffixLocnOut"><span class="hs-identifier">addBootSuffixLocnOut</span></a></a><span> </span><a name="local-6989586621680411892"><a href="#local-6989586621680411892"><span class="hs-identifier">locn</span></a></a><span>
</span><a name="line-314"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411892"><span class="hs-identifier hs-var">locn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ml_hi_file</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#addBootSuffix"><span class="hs-identifier hs-var">addBootSuffix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ml_hi_file</span><span> </span><a href="#local-6989586621680411892"><span class="hs-identifier hs-var">locn</span></a><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ml_obj_file</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#addBootSuffix"><span class="hs-identifier hs-var">addBootSuffix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ml_obj_file</span><span> </span><a href="#local-6989586621680411892"><span class="hs-identifier hs-var">locn</span></a><span class="hs-special">)</span><span>
</span><a name="line-316"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ml_hie_file</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#addBootSuffix"><span class="hs-identifier hs-var">addBootSuffix</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ml_hie_file</span><span> </span><a href="#local-6989586621680411892"><span class="hs-identifier hs-var">locn</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{The name of a module}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-comment">-- | A ModuleName is essentially a simple string, e.g. @Data.List@.</span><span>
</span><a name="line-327"></a><span class="hs-keyword">newtype</span><span> </span><a name="ModuleName"><a href="Module.html#ModuleName"><span class="hs-identifier">ModuleName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ModuleName"><a href="Module.html#ModuleName"><span class="hs-identifier">ModuleName</span></a></a><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span class="hs-keyword">instance</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-330"></a><span>  </span><a name="local-8214565720325051039"><a href="Unique.html#getUnique"><span class="hs-identifier">getUnique</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-var">ModuleName</span></a><span> </span><a name="local-6989586621680411861"><a href="#local-6989586621680411861"><span class="hs-identifier">nm</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680411861"><span class="hs-identifier hs-var">nm</span></a><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-333"></a><span>  </span><a name="local-6989586621680411859"><a href="#local-6989586621680411859"><span class="hs-identifier">nm1</span></a></a><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a name="local-6989586621680411860"><a href="#local-6989586621680411860"><span class="hs-identifier">nm2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680411859"><span class="hs-identifier hs-var">nm1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680411860"><span class="hs-identifier hs-var">nm2</span></a><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-336"></a><span>  </span><a name="local-6989586621680411857"><a href="#local-6989586621680411857"><span class="hs-identifier">nm1</span></a></a><span> </span><span class="hs-special">`</span><a name="local-8214565720323790496"><span class="hs-identifier">compare</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621680411858"><a href="#local-6989586621680411858"><span class="hs-identifier">nm2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#stableModuleNameCmp"><span class="hs-identifier hs-var">stableModuleNameCmp</span></a><span> </span><a href="#local-6989586621680411857"><span class="hs-identifier hs-var">nm1</span></a><span> </span><a href="#local-6989586621680411858"><span class="hs-identifier hs-var">nm2</span></a><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-339"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#pprModuleName"><span class="hs-identifier hs-var">pprModuleName</span></a><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-342"></a><span>  </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621680411853"><a href="#local-6989586621680411853"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-var">ModuleName</span></a><span> </span><a name="local-6989586621680411854"><a href="#local-6989586621680411854"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621680411853"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621680411854"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-343"></a><span>  </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621680411855"><a href="#local-6989586621680411855"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680411856"><a href="#local-6989586621680411856"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621680411855"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-var">ModuleName</span></a><span> </span><a href="#local-6989586621680411856"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.PackageDb.html#BinaryStringRep"><span class="hs-identifier hs-type">BinaryStringRep</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-346"></a><span>  </span><a name="local-8214565720323971162"><a href="GHC.PackageDb.html#fromStringRep"><span class="hs-identifier">fromStringRep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#mkModuleNameFS"><span class="hs-identifier hs-var">mkModuleNameFS</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="FastString.html#mkFastStringByteString"><span class="hs-identifier hs-var">mkFastStringByteString</span></a><span>
</span><a name="line-347"></a><span>  </span><a name="local-8214565720323971163"><a href="GHC.PackageDb.html#toStringRep"><span class="hs-identifier">toStringRep</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fastStringToByteString"><span class="hs-identifier hs-var">fastStringToByteString</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Module.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Data</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-350"></a><span>  </span><span class="hs-comment">-- don't traverse?</span><span>
</span><a name="line-351"></a><span>  </span><a name="local-8214565720323786785"><span class="hs-identifier">toConstr</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#abstractConstr"><span class="hs-identifier hs-var">abstractConstr</span></a><span> </span><span class="hs-string">&quot;ModuleName&quot;</span><span>
</span><a name="line-352"></a><span>  </span><a name="local-8214565720323786786"><span class="hs-identifier">gunfold</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;gunfold&quot;</span><span>
</span><a name="line-353"></a><span>  </span><a name="local-8214565720323786784"><span class="hs-identifier">dataTypeOf</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNoRepType</span><span> </span><span class="hs-string">&quot;ModuleName&quot;</span><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-356"></a><span>  </span><a name="local-8214565720323792605"><span class="hs-identifier">rnf</span></a><span> </span><a name="local-6989586621680411852"><a href="#local-6989586621680411852"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411852"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span class="hs-identifier">stableModuleNameCmp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- ^ Compares module names lexically, rather than by their 'Unique's</span><span>
</span><a name="line-360"></a><a name="stableModuleNameCmp"><a href="Module.html#stableModuleNameCmp"><span class="hs-identifier">stableModuleNameCmp</span></a></a><span> </span><a name="local-6989586621680411893"><a href="#local-6989586621680411893"><span class="hs-identifier">n1</span></a></a><span> </span><a name="local-6989586621680411894"><a href="#local-6989586621680411894"><span class="hs-identifier">n2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a><span> </span><a href="#local-6989586621680411893"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="Module.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a><span> </span><a href="#local-6989586621680411894"><span class="hs-identifier hs-var">n2</span></a><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-identifier">pprModuleName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-363"></a><a name="pprModuleName"><a href="Module.html#pprModuleName"><span class="hs-identifier">pprModuleName</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-var">ModuleName</span></a><span> </span><a name="local-6989586621680411895"><a href="#local-6989586621680411895"><span class="hs-identifier">nm</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-364"></a><span>    </span><a href="Outputable.html#getPprStyle"><span class="hs-identifier hs-var">getPprStyle</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621680411896"><a href="#local-6989586621680411896"><span class="hs-identifier">sty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-365"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="Outputable.html#codeStyle"><span class="hs-identifier hs-var">codeStyle</span></a><span> </span><a href="#local-6989586621680411896"><span class="hs-identifier hs-var">sty</span></a><span>
</span><a name="line-366"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#ztext"><span class="hs-identifier hs-var">ztext</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#zEncodeFS"><span class="hs-identifier hs-var">zEncodeFS</span></a><span> </span><a href="#local-6989586621680411895"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">)</span><span>
</span><a name="line-367"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a><span> </span><a href="#local-6989586621680411895"><span class="hs-identifier hs-var">nm</span></a><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-identifier">moduleNameFS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-370"></a><a name="moduleNameFS"><a href="Module.html#moduleNameFS"><span class="hs-identifier">moduleNameFS</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-var">ModuleName</span></a><span> </span><a name="local-6989586621680411897"><a href="#local-6989586621680411897"><span class="hs-identifier">mod</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411897"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-371"></a><span>
</span><a name="line-372"></a><span class="hs-identifier">moduleNameString</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-373"></a><a name="moduleNameString"><a href="Module.html#moduleNameString"><span class="hs-identifier">moduleNameString</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-var">ModuleName</span></a><span> </span><a name="local-6989586621680411898"><a href="#local-6989586621680411898"><span class="hs-identifier">mod</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a><span> </span><a href="#local-6989586621680411898"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-comment">-- | Get a string representation of a 'Module' that's unique and stable</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- across recompilations.</span><span>
</span><a name="line-377"></a><span class="hs-comment">-- eg. &quot;$aeson_70dylHtv1FFGeai1IoxcQr$Data.Aeson.Types.Internal&quot;</span><span>
</span><a name="line-378"></a><span class="hs-identifier">moduleStableString</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-379"></a><a name="moduleStableString"><a href="Module.html#moduleStableString"><span class="hs-identifier">moduleStableString</span></a></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-380"></a><span>  </span><span class="hs-string">&quot;$&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Module.html#unitIdString"><span class="hs-identifier hs-var">unitIdString</span></a><span> </span><a href="#local-6989586621680411899"><span class="hs-identifier hs-var">moduleUnitId</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;$&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span> </span><a href="#local-6989586621680411900"><span class="hs-identifier hs-var">moduleName</span></a><span>
</span><a name="line-381"></a><span>
</span><a name="line-382"></a><span class="hs-identifier">mkModuleName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-383"></a><a name="mkModuleName"><a href="Module.html#mkModuleName"><span class="hs-identifier">mkModuleName</span></a></a><span> </span><a name="local-6989586621680411901"><a href="#local-6989586621680411901"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-var">ModuleName</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a><span> </span><a href="#local-6989586621680411901"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span class="hs-identifier">mkModuleNameFS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-386"></a><a name="mkModuleNameFS"><a href="Module.html#mkModuleNameFS"><span class="hs-identifier">mkModuleNameFS</span></a></a><span> </span><a name="local-6989586621680411902"><a href="#local-6989586621680411902"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-var">ModuleName</span></a><span> </span><a href="#local-6989586621680411902"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span class="hs-comment">-- |Returns the string version of the module name, with dots replaced by slashes.</span><span>
</span><a name="line-389"></a><span class="hs-comment">--</span><span>
</span><a name="line-390"></a><span class="hs-identifier">moduleNameSlashes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-391"></a><a name="moduleNameSlashes"><a href="Module.html#moduleNameSlashes"><span class="hs-identifier">moduleNameSlashes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411903"><span class="hs-identifier hs-var">dots_to_slashes</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span>
</span><a name="line-392"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680411903"><a href="#local-6989586621680411903"><span class="hs-identifier">dots_to_slashes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680411904"><a href="#local-6989586621680411904"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680411904"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'.'</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">pathSeparator</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621680411904"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span class="hs-comment">-- |Returns the string version of the module name, with dots replaced by colons.</span><span>
</span><a name="line-395"></a><span class="hs-comment">--</span><span>
</span><a name="line-396"></a><span class="hs-identifier">moduleNameColons</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-397"></a><a name="moduleNameColons"><a href="Module.html#moduleNameColons"><span class="hs-identifier">moduleNameColons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411905"><span class="hs-identifier hs-var">dots_to_colons</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Module.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a><span>
</span><a name="line-398"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680411905"><a href="#local-6989586621680411905"><span class="hs-identifier">dots_to_colons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680411906"><a href="#local-6989586621680411906"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680411906"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-char">'.'</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-char">':'</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621680411906"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{A fully qualified module}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span class="hs-comment">-- | A Module is a pair of a 'UnitId' and a 'ModuleName'.</span><span>
</span><a name="line-409"></a><span class="hs-comment">--</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- Module variables (i.e. @&lt;H&gt;@) which can be instantiated to a</span><span>
</span><a name="line-411"></a><span class="hs-comment">-- specific module at some later point in time are represented</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- with 'moduleUnitId' set to 'holeUnitId' (this allows us to</span><span>
</span><a name="line-413"></a><span class="hs-comment">-- avoid having to make 'moduleUnitId' a partial operation.)</span><span>
</span><a name="line-414"></a><span class="hs-comment">--</span><span>
</span><a name="line-415"></a><span class="hs-keyword">data</span><span> </span><a name="Module"><a href="Module.html#Module"><span class="hs-identifier">Module</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Module"><a href="Module.html#Module"><span class="hs-identifier">Module</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-416"></a><span>   </span><a name="moduleUnitId"><a href="Module.html#moduleUnitId"><span class="hs-identifier">moduleUnitId</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- pkg-1.0</span><span>
</span><a name="line-417"></a><span>   </span><a name="moduleName"><a href="Module.html#moduleName"><span class="hs-identifier">moduleName</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>  </span><span class="hs-comment">-- A.B.C</span><span>
</span><a name="line-418"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-419"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-comment">-- | Calculate the free holes of a 'Module'.  If this set is non-empty,</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- this module was defined in an indefinite library that had required</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- signatures.</span><span>
</span><a name="line-424"></a><span class="hs-comment">--</span><span>
</span><a name="line-425"></a><span class="hs-comment">-- If a module has free holes, that means that substitutions can operate on it;</span><span>
</span><a name="line-426"></a><span class="hs-comment">-- if it has no free holes, substituting over a module has no effect.</span><span>
</span><a name="line-427"></a><span class="hs-identifier">moduleFreeHoles</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqDSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-428"></a><a name="moduleFreeHoles"><a href="Module.html#moduleFreeHoles"><span class="hs-identifier">moduleFreeHoles</span></a></a><span> </span><a name="local-6989586621680411907"><a href="#local-6989586621680411907"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-429"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Module.html#isHoleModule"><span class="hs-identifier hs-var">isHoleModule</span></a><span> </span><a href="#local-6989586621680411907"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDSet.html#unitUniqDSet"><span class="hs-identifier hs-var">unitUniqDSet</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621680411907"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-430"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#unitIdFreeHoles"><span class="hs-identifier hs-var">unitIdFreeHoles</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-6989586621680411907"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">-- | A 'Module' is definite if it has no free holes.</span><span>
</span><a name="line-433"></a><span class="hs-identifier">moduleIsDefinite</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-434"></a><a name="moduleIsDefinite"><a href="Module.html#moduleIsDefinite"><span class="hs-identifier">moduleIsDefinite</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDSet.html#isEmptyUniqDSet"><span class="hs-identifier hs-var">isEmptyUniqDSet</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Module.html#moduleFreeHoles"><span class="hs-identifier hs-var">moduleFreeHoles</span></a><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span class="hs-comment">-- | Create a module variable at some 'ModuleName'.</span><span>
</span><a name="line-437"></a><span class="hs-comment">-- See Note [Representation of module/name variables]</span><span>
</span><a name="line-438"></a><span class="hs-identifier">mkHoleModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-439"></a><a name="mkHoleModule"><a href="Module.html#mkHoleModule"><span class="hs-identifier">mkHoleModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span> </span><a href="Module.html#holeUnitId"><span class="hs-identifier hs-var">holeUnitId</span></a><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><span class="hs-keyword">instance</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-442"></a><span>  </span><a name="local-8214565720325051039"><a href="Unique.html#getUnique"><span class="hs-identifier">getUnique</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a name="local-6989586621680411850"><a href="#local-6989586621680411850"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680411851"><a href="#local-6989586621680411851"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a><span> </span><a href="#local-6989586621680411850"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="FastString.html#appendFS"><span class="hs-identifier hs-var">appendFS</span></a><span class="hs-special">`</span><span> </span><a href="Module.html#moduleNameFS"><span class="hs-identifier hs-var">moduleNameFS</span></a><span> </span><a href="#local-6989586621680411851"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-445"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#pprModule"><span class="hs-identifier hs-var">pprModule</span></a><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-448"></a><span>  </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621680411844"><a href="#local-6989586621680411844"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a name="local-6989586621680411845"><a href="#local-6989586621680411845"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680411846"><a href="#local-6989586621680411846"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621680411844"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621680411845"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621680411844"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621680411846"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-449"></a><span>  </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621680411847"><a href="#local-6989586621680411847"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680411848"><a href="#local-6989586621680411848"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621680411847"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">;</span><span> </span><a name="local-6989586621680411849"><a href="#local-6989586621680411849"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621680411847"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a href="#local-6989586621680411848"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621680411849"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Data</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-452"></a><span>  </span><span class="hs-comment">-- don't traverse?</span><span>
</span><a name="line-453"></a><span>  </span><a name="local-8214565720323786785"><span class="hs-identifier">toConstr</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#abstractConstr"><span class="hs-identifier hs-var">abstractConstr</span></a><span> </span><span class="hs-string">&quot;Module&quot;</span><span>
</span><a name="line-454"></a><span>  </span><a name="local-8214565720323786786"><span class="hs-identifier">gunfold</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;gunfold&quot;</span><span>
</span><a name="line-455"></a><span>  </span><a name="local-8214565720323786784"><span class="hs-identifier">dataTypeOf</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNoRepType</span><span> </span><span class="hs-string">&quot;Module&quot;</span><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-458"></a><span>  </span><a name="local-8214565720323792605"><span class="hs-identifier">rnf</span></a><span> </span><a name="local-6989586621680411843"><a href="#local-6989586621680411843"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411843"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span class="hs-comment">-- | This gives a stable ordering, as opposed to the Ord instance which</span><span>
</span><a name="line-461"></a><span class="hs-comment">-- gives an ordering based on the 'Unique's of the components, which may</span><span>
</span><a name="line-462"></a><span class="hs-comment">-- not be stable from run to run of the compiler.</span><span>
</span><a name="line-463"></a><span class="hs-identifier">stableModuleCmp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-464"></a><a name="stableModuleCmp"><a href="Module.html#stableModuleCmp"><span class="hs-identifier">stableModuleCmp</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a name="local-6989586621680411908"><a href="#local-6989586621680411908"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621680411909"><a href="#local-6989586621680411909"><span class="hs-identifier">n1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a name="local-6989586621680411910"><a href="#local-6989586621680411910"><span class="hs-identifier">p2</span></a></a><span> </span><a name="local-6989586621680411911"><a href="#local-6989586621680411911"><span class="hs-identifier">n2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-465"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680411908"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-special">`</span><a href="Module.html#stableUnitIdCmp"><span class="hs-identifier hs-var">stableUnitIdCmp</span></a><span class="hs-special">`</span><span>  </span><a href="#local-6989586621680411910"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span>
</span><a name="line-466"></a><span>     </span><span class="hs-special">(</span><a href="#local-6989586621680411909"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-special">`</span><a href="Module.html#stableModuleNameCmp"><span class="hs-identifier hs-var">stableModuleNameCmp</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621680411911"><span class="hs-identifier hs-var">n2</span></a><span class="hs-special">)</span><span>
</span><a name="line-467"></a><span>
</span><a name="line-468"></a><span class="hs-identifier">mkModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-469"></a><a name="mkModule"><a href="Module.html#mkModule"><span class="hs-identifier">mkModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span>
</span><a name="line-470"></a><span>
</span><a name="line-471"></a><span class="hs-identifier">pprModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-472"></a><a name="pprModule"><a href="Module.html#pprModule"><span class="hs-identifier">pprModule</span></a></a><span> </span><a name="local-6989586621680411912"><a href="#local-6989586621680411912"><span class="hs-identifier">mod</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a name="local-6989586621680411913"><a href="#local-6989586621680411913"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680411914"><a href="#local-6989586621680411914"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#getPprStyle"><span class="hs-identifier hs-var">getPprStyle</span></a><span> </span><a href="#local-6989586621680411915"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-473"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-474"></a><span>  </span><a name="local-6989586621680411915"><a href="#local-6989586621680411915"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621680411916"><a href="#local-6989586621680411916"><span class="hs-identifier">sty</span></a></a><span>
</span><a name="line-475"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Outputable.html#codeStyle"><span class="hs-identifier hs-var">codeStyle</span></a><span> </span><a href="#local-6989586621680411916"><span class="hs-identifier hs-var">sty</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-476"></a><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621680411913"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Module.html#mainUnitId"><span class="hs-identifier hs-var">mainUnitId</span></a><span>
</span><a name="line-477"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><span class="hs-comment">-- never qualify the main package in code</span><span>
</span><a name="line-478"></a><span>                </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#ztext"><span class="hs-identifier hs-var">ztext</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#zEncodeFS"><span class="hs-identifier hs-var">zEncodeFS</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a><span> </span><a href="#local-6989586621680411913"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'_'</span><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span>            </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Module.html#pprModuleName"><span class="hs-identifier hs-var">pprModuleName</span></a><span> </span><a href="#local-6989586621680411914"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-480"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Outputable.html#qualModule"><span class="hs-identifier hs-var">qualModule</span></a><span> </span><a href="#local-6989586621680411916"><span class="hs-identifier hs-var">sty</span></a><span> </span><a href="#local-6989586621680411912"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-481"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="Module.html#isHoleModule"><span class="hs-identifier hs-var">isHoleModule</span></a><span> </span><a href="#local-6989586621680411912"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-482"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#angleBrackets"><span class="hs-identifier hs-var">angleBrackets</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#pprModuleName"><span class="hs-identifier hs-var">pprModuleName</span></a><span> </span><a href="#local-6989586621680411914"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-483"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-6989586621680411912"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">':'</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Module.html#pprModuleName"><span class="hs-identifier hs-var">pprModuleName</span></a><span> </span><a href="#local-6989586621680411914"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-484"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-485"></a><span>        </span><a href="Module.html#pprModuleName"><span class="hs-identifier hs-var">pprModuleName</span></a><span> </span><a href="#local-6989586621680411914"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-486"></a><span>
</span><a name="line-487"></a><span class="hs-keyword">class</span><span> </span><a name="ContainsModule"><a href="Module.html#ContainsModule"><span class="hs-identifier">ContainsModule</span></a></a><span> </span><a name="local-6989586621680411771"><a href="#local-6989586621680411771"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-488"></a><span>    </span><a name="extractModule"><a href="Module.html#extractModule"><span class="hs-identifier">extractModule</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680411771"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span class="hs-keyword">class</span><span> </span><a name="HasModule"><a href="Module.html#HasModule"><span class="hs-identifier">HasModule</span></a></a><span> </span><a name="local-6989586621680411770"><a href="#local-6989586621680411770"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-491"></a><span>    </span><a name="getModule"><a href="Module.html#getModule"><span class="hs-identifier">getModule</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680411770"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-492"></a><span>
</span><a name="line-493"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.PackageDb.html#DbUnitIdModuleRep"><span class="hs-identifier hs-type">DbUnitIdModuleRep</span></a><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-494"></a><span>  </span><a name="local-8214565720323971174"><a href="GHC.PackageDb.html#fromDbModule"><span class="hs-identifier">fromDbModule</span></a></a><span> </span><span class="hs-special">(</span><a href="GHC.PackageDb.html#DbModule"><span class="hs-identifier hs-var">DbModule</span></a><span> </span><a name="local-6989586621680411837"><a href="#local-6989586621680411837"><span class="hs-identifier">uid</span></a></a><span> </span><a name="local-6989586621680411838"><a href="#local-6989586621680411838"><span class="hs-identifier">mod_name</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span> </span><a href="#local-6989586621680411837"><span class="hs-identifier hs-var">uid</span></a><span> </span><a href="#local-6989586621680411838"><span class="hs-identifier hs-var">mod_name</span></a><span>
</span><a name="line-495"></a><span>  </span><span class="hs-identifier">fromDbModule</span><span> </span><span class="hs-special">(</span><a href="GHC.PackageDb.html#DbModuleVar"><span class="hs-identifier hs-var">DbModuleVar</span></a><span> </span><a name="local-6989586621680411839"><a href="#local-6989586621680411839"><span class="hs-identifier">mod_name</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#mkHoleModule"><span class="hs-identifier hs-var">mkHoleModule</span></a><span> </span><a href="#local-6989586621680411839"><span class="hs-identifier hs-var">mod_name</span></a><span>
</span><a name="line-496"></a><span>  </span><a name="local-8214565720323971176"><a href="GHC.PackageDb.html#fromDbUnitId"><span class="hs-identifier">fromDbUnitId</span></a></a><span> </span><span class="hs-special">(</span><a href="GHC.PackageDb.html#DbUnitId"><span class="hs-identifier hs-var">DbUnitId</span></a><span> </span><a name="local-6989586621680411840"><a href="#local-6989586621680411840"><span class="hs-identifier">cid</span></a></a><span> </span><a name="local-6989586621680411841"><a href="#local-6989586621680411841"><span class="hs-identifier">insts</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#newUnitId"><span class="hs-identifier hs-var">newUnitId</span></a><span> </span><a href="#local-6989586621680411840"><span class="hs-identifier hs-var">cid</span></a><span> </span><a href="#local-6989586621680411841"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-497"></a><span>  </span><span class="hs-identifier">fromDbUnitId</span><span> </span><span class="hs-special">(</span><a href="GHC.PackageDb.html#DbInstalledUnitId"><span class="hs-identifier hs-var">DbInstalledUnitId</span></a><span> </span><a name="local-6989586621680411842"><a href="#local-6989586621680411842"><span class="hs-identifier">iuid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#DefiniteUnitId"><span class="hs-identifier hs-var">DefiniteUnitId</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-var">DefUnitId</span></a><span> </span><a href="#local-6989586621680411842"><span class="hs-identifier hs-var">iuid</span></a><span class="hs-special">)</span><span>
</span><a name="line-498"></a><span>  </span><span class="hs-comment">-- GHC never writes to the database, so it's not needed</span><span>
</span><a name="line-499"></a><span>  </span><a name="local-8214565720323971175"><a href="GHC.PackageDb.html#toDbModule"><span class="hs-identifier">toDbModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;toDbModule: not implemented&quot;</span><span>
</span><a name="line-500"></a><span>  </span><a name="local-8214565720323971177"><a href="GHC.PackageDb.html#toDbUnitId"><span class="hs-identifier">toDbUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;toDbUnitId: not implemented&quot;</span><span>
</span><a name="line-501"></a><span>
</span><a name="line-502"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{ComponentId}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><span class="hs-comment">-- | A 'ComponentId' consists of the package name, package version, component</span><span>
</span><a name="line-511"></a><span class="hs-comment">-- ID, the transitive dependencies of the component, and other information to</span><span>
</span><a name="line-512"></a><span class="hs-comment">-- uniquely identify the source code and build configuration of a component.</span><span>
</span><a name="line-513"></a><span class="hs-comment">--</span><span>
</span><a name="line-514"></a><span class="hs-comment">-- This used to be known as an 'InstalledPackageId', but a package can contain</span><span>
</span><a name="line-515"></a><span class="hs-comment">-- multiple components and a 'ComponentId' uniquely identifies a component</span><span>
</span><a name="line-516"></a><span class="hs-comment">-- within a package.  When a package only has one component, the 'ComponentId'</span><span>
</span><a name="line-517"></a><span class="hs-comment">-- coincides with the 'InstalledPackageId'</span><span>
</span><a name="line-518"></a><span class="hs-keyword">newtype</span><span> </span><a name="ComponentId"><a href="Module.html#ComponentId"><span class="hs-identifier">ComponentId</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="ComponentId"><a href="Module.html#ComponentId"><span class="hs-identifier">ComponentId</span></a></a><span>        </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.PackageDb.html#BinaryStringRep"><span class="hs-identifier hs-type">BinaryStringRep</span></a><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-521"></a><span>  </span><a name="local-8214565720323971162"><a href="GHC.PackageDb.html#fromStringRep"><span class="hs-identifier">fromStringRep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-var">ComponentId</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="FastString.html#mkFastStringByteString"><span class="hs-identifier hs-var">mkFastStringByteString</span></a><span>
</span><a name="line-522"></a><span>  </span><a name="local-8214565720323971163"><a href="GHC.PackageDb.html#toStringRep"><span class="hs-identifier">toStringRep</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ComponentId"><span class="hs-identifier hs-var">ComponentId</span></a><span> </span><a name="local-6989586621680411836"><a href="#local-6989586621680411836"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fastStringToByteString"><span class="hs-identifier hs-var">fastStringToByteString</span></a><span> </span><a href="#local-6989586621680411836"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-523"></a><span>
</span><a name="line-524"></a><span class="hs-keyword">instance</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-525"></a><span>  </span><a name="local-8214565720325051039"><a href="Unique.html#getUnique"><span class="hs-identifier">getUnique</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ComponentId"><span class="hs-identifier hs-var">ComponentId</span></a><span> </span><a name="local-6989586621680411835"><a href="#local-6989586621680411835"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680411835"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-528"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621680411830"><a href="#local-6989586621680411830"><span class="hs-identifier">cid</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Module.html#ComponentId"><span class="hs-identifier hs-var">ComponentId</span></a><span> </span><a name="local-6989586621680411831"><a href="#local-6989586621680411831"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-529"></a><span>    </span><a href="Outputable.html#getPprStyle"><span class="hs-identifier hs-var">getPprStyle</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680411832"><a href="#local-6989586621680411832"><span class="hs-identifier">sty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-530"></a><span>    </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680411833"><a href="#local-6989586621680411833"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-531"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="Packages.html#componentIdString"><span class="hs-identifier hs-var">componentIdString</span></a><span> </span><a href="#local-6989586621680411833"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680411830"><span class="hs-identifier hs-var">cid</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-532"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680411834"><a href="#local-6989586621680411834"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#debugStyle"><span class="hs-identifier hs-var">debugStyle</span></a><span> </span><a href="#local-6989586621680411832"><span class="hs-identifier hs-var">sty</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621680411834"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-533"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a><span> </span><a href="#local-6989586621680411831"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-534"></a><span>
</span><a name="line-535"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{UnitId}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><span class="hs-comment">-- | A unit identifier identifies a (possibly partially) instantiated</span><span>
</span><a name="line-544"></a><span class="hs-comment">-- library.  It is primarily used as part of 'Module', which in turn</span><span>
</span><a name="line-545"></a><span class="hs-comment">-- is used in 'Name', which is used to give names to entities when</span><span>
</span><a name="line-546"></a><span class="hs-comment">-- typechecking.</span><span>
</span><a name="line-547"></a><span class="hs-comment">--</span><span>
</span><a name="line-548"></a><span class="hs-comment">-- There are two possible forms for a 'UnitId'.  It can be a</span><span>
</span><a name="line-549"></a><span class="hs-comment">-- 'DefiniteUnitId', in which case we just have a string that uniquely</span><span>
</span><a name="line-550"></a><span class="hs-comment">-- identifies some fully compiled, installed library we have on disk.</span><span>
</span><a name="line-551"></a><span class="hs-comment">-- However, when we are typechecking a library with missing holes,</span><span>
</span><a name="line-552"></a><span class="hs-comment">-- we may need to instantiate a library on the fly (in which case</span><span>
</span><a name="line-553"></a><span class="hs-comment">-- we don't have any on-disk representation.)  In that case, you</span><span>
</span><a name="line-554"></a><span class="hs-comment">-- have an 'IndefiniteUnitId', which explicitly records the</span><span>
</span><a name="line-555"></a><span class="hs-comment">-- instantiation, so that we can substitute over it.</span><span>
</span><a name="line-556"></a><span class="hs-keyword">data</span><span> </span><a name="UnitId"><a href="Module.html#UnitId"><span class="hs-identifier">UnitId</span></a></a><span>
</span><a name="line-557"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="IndefiniteUnitId"><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier">IndefiniteUnitId</span></a></a><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span>
</span><a name="line-558"></a><span>    </span><span class="hs-glyph">|</span><span>   </span><a name="DefiniteUnitId"><a href="Module.html#DefiniteUnitId"><span class="hs-identifier">DefiniteUnitId</span></a></a><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-type">DefUnitId</span></a><span>
</span><a name="line-559"></a><span>
</span><a name="line-560"></a><span class="hs-identifier">unitIdFS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-561"></a><a name="unitIdFS"><a href="Module.html#unitIdFS"><span class="hs-identifier">unitIdFS</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span> </span><a name="local-6989586621680411917"><a href="#local-6989586621680411917"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">indefUnitIdFS</span><span> </span><a href="#local-6989586621680411917"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-562"></a><span class="hs-identifier">unitIdFS</span><span> </span><span class="hs-special">(</span><a href="Module.html#DefiniteUnitId"><span class="hs-identifier hs-var">DefiniteUnitId</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-var">DefUnitId</span></a><span> </span><a name="local-6989586621680411918"><a href="#local-6989586621680411918"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">installedUnitIdFS</span><span> </span><a href="#local-6989586621680411918"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-563"></a><span>
</span><a name="line-564"></a><span class="hs-identifier">unitIdKey</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-565"></a><a name="unitIdKey"><a href="Module.html#unitIdKey"><span class="hs-identifier">unitIdKey</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span> </span><a name="local-6989586621680411919"><a href="#local-6989586621680411919"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">indefUnitIdKey</span><span> </span><a href="#local-6989586621680411919"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-566"></a><span class="hs-identifier">unitIdKey</span><span> </span><span class="hs-special">(</span><a href="Module.html#DefiniteUnitId"><span class="hs-identifier hs-var">DefiniteUnitId</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-var">DefUnitId</span></a><span> </span><a name="local-6989586621680411920"><a href="#local-6989586621680411920"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#installedUnitIdKey"><span class="hs-identifier hs-var">installedUnitIdKey</span></a><span> </span><a href="#local-6989586621680411920"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span class="hs-comment">-- | A unit identifier which identifies an indefinite</span><span>
</span><a name="line-569"></a><span class="hs-comment">-- library (with holes) that has been *on-the-fly* instantiated</span><span>
</span><a name="line-570"></a><span class="hs-comment">-- with a substitution 'indefUnitIdInsts'.  In fact, an indefinite</span><span>
</span><a name="line-571"></a><span class="hs-comment">-- unit identifier could have no holes, but we haven't gotten</span><span>
</span><a name="line-572"></a><span class="hs-comment">-- around to compiling the actual library yet.</span><span>
</span><a name="line-573"></a><span class="hs-comment">--</span><span>
</span><a name="line-574"></a><span class="hs-comment">-- An indefinite unit identifier pretty-prints to something like</span><span>
</span><a name="line-575"></a><span class="hs-comment">-- @p[H=&lt;H&gt;,A=aimpl:A&gt;]@ (@p@ is the 'ComponentId', and the</span><span>
</span><a name="line-576"></a><span class="hs-comment">-- brackets enclose the module substitution).</span><span>
</span><a name="line-577"></a><span class="hs-keyword">data</span><span> </span><a name="IndefUnitId"><a href="Module.html#IndefUnitId"><span class="hs-identifier">IndefUnitId</span></a></a><span>
</span><a name="line-578"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="IndefUnitId"><a href="Module.html#IndefUnitId"><span class="hs-identifier">IndefUnitId</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-579"></a><span>        </span><span class="hs-comment">-- | A private, uniquely identifying representation of</span><span>
</span><a name="line-580"></a><span>        </span><span class="hs-comment">-- a UnitId.  This string is completely private to GHC</span><span>
</span><a name="line-581"></a><span>        </span><span class="hs-comment">-- and is just used to get a unique; in particular, we don't use it for</span><span>
</span><a name="line-582"></a><span>        </span><span class="hs-comment">-- symbols (indefinite libraries are not compiled).</span><span>
</span><a name="line-583"></a><span>        </span><a name="indefUnitIdFS"><a href="Module.html#indefUnitIdFS"><span class="hs-identifier">indefUnitIdFS</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span class="hs-special">,</span><span>
</span><a name="line-584"></a><span>        </span><span class="hs-comment">-- | Cached unique of 'unitIdFS'.</span><span>
</span><a name="line-585"></a><span>        </span><a name="indefUnitIdKey"><a href="Module.html#indefUnitIdKey"><span class="hs-identifier">indefUnitIdKey</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span class="hs-special">,</span><span>
</span><a name="line-586"></a><span>        </span><span class="hs-comment">-- | The component identity of the indefinite library that</span><span>
</span><a name="line-587"></a><span>        </span><span class="hs-comment">-- is being instantiated.</span><span>
</span><a name="line-588"></a><span>        </span><a name="indefUnitIdComponentId"><a href="Module.html#indefUnitIdComponentId"><span class="hs-identifier">indefUnitIdComponentId</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span class="hs-special">,</span><span>
</span><a name="line-589"></a><span>        </span><span class="hs-comment">-- | The sorted (by 'ModuleName') instantiations of this library.</span><span>
</span><a name="line-590"></a><span>        </span><a name="indefUnitIdInsts"><a href="Module.html#indefUnitIdInsts"><span class="hs-identifier">indefUnitIdInsts</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-591"></a><span>        </span><span class="hs-comment">-- | A cache of the free module variables of 'unitIdInsts'.</span><span>
</span><a name="line-592"></a><span>        </span><span class="hs-comment">-- This lets us efficiently tell if a 'UnitId' has been</span><span>
</span><a name="line-593"></a><span>        </span><span class="hs-comment">-- fully instantiated (free module variables are empty)</span><span>
</span><a name="line-594"></a><span>        </span><span class="hs-comment">-- and whether or not a substitution can have any effect.</span><span>
</span><a name="line-595"></a><span>        </span><a name="indefUnitIdFreeHoles"><a href="Module.html#indefUnitIdFreeHoles"><span class="hs-identifier">indefUnitIdFreeHoles</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="UniqDSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-596"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-599"></a><span>  </span><a name="local-6989586621680411828"><a href="#local-6989586621680411828"><span class="hs-identifier">u1</span></a></a><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a name="local-6989586621680411829"><a href="#local-6989586621680411829"><span class="hs-identifier">u2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">indefUnitIdKey</span><span> </span><a href="#local-6989586621680411828"><span class="hs-identifier hs-var">u1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">indefUnitIdKey</span><span> </span><a href="#local-6989586621680411829"><span class="hs-identifier hs-var">u2</span></a><span>
</span><a name="line-600"></a><span>
</span><a name="line-601"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-602"></a><span>  </span><a name="local-6989586621680411826"><a href="#local-6989586621680411826"><span class="hs-identifier">u1</span></a></a><span> </span><span class="hs-special">`</span><a name="local-8214565720323790496"><span class="hs-identifier">compare</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621680411827"><a href="#local-6989586621680411827"><span class="hs-identifier">u2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">indefUnitIdFS</span><span> </span><a href="#local-6989586621680411826"><span class="hs-identifier hs-var">u1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">indefUnitIdFS</span><span> </span><a href="#local-6989586621680411827"><span class="hs-identifier hs-var">u2</span></a><span>
</span><a name="line-603"></a><span>
</span><a name="line-604"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-605"></a><span>  </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621680411820"><a href="#local-6989586621680411820"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621680411821"><a href="#local-6989586621680411821"><span class="hs-identifier">indef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-606"></a><span>    </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621680411820"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">indefUnitIdComponentId</span><span> </span><a href="#local-6989586621680411821"><span class="hs-identifier hs-var">indef</span></a><span class="hs-special">)</span><span>
</span><a name="line-607"></a><span>    </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621680411820"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">indefUnitIdInsts</span><span> </span><a href="#local-6989586621680411821"><span class="hs-identifier hs-var">indef</span></a><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span>  </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621680411822"><a href="#local-6989586621680411822"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-609"></a><span>    </span><a name="local-6989586621680411823"><a href="#local-6989586621680411823"><span class="hs-identifier">cid</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621680411822"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-610"></a><span>    </span><a name="local-6989586621680411824"><a href="#local-6989586621680411824"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621680411822"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-611"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680411825"><a href="#local-6989586621680411825"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#hashUnitId"><span class="hs-identifier hs-var">hashUnitId</span></a><span> </span><a href="#local-6989586621680411823"><span class="hs-identifier hs-var">cid</span></a><span> </span><a href="#local-6989586621680411824"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-612"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-var">IndefUnitId</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-613"></a><span>            </span><span class="hs-identifier">indefUnitIdComponentId</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411823"><span class="hs-identifier hs-var">cid</span></a><span class="hs-special">,</span><span>
</span><a name="line-614"></a><span>            </span><span class="hs-identifier">indefUnitIdInsts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411824"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">,</span><span>
</span><a name="line-615"></a><span>            </span><span class="hs-identifier">indefUnitIdFreeHoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDSet.html#unionManyUniqDSets"><span class="hs-identifier hs-var">unionManyUniqDSets</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Module.html#moduleFreeHoles"><span class="hs-identifier hs-var">moduleFreeHoles</span></a><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680411824"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-616"></a><span>            </span><span class="hs-identifier">indefUnitIdFS</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411825"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">,</span><span>
</span><a name="line-617"></a><span>            </span><span class="hs-identifier">indefUnitIdKey</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680411825"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-618"></a><span>           </span><span class="hs-special">}</span><span>
</span><a name="line-619"></a><span>
</span><a name="line-620"></a><span class="hs-comment">-- | Create a new 'IndefUnitId' given an explicit module substitution.</span><span>
</span><a name="line-621"></a><span class="hs-identifier">newIndefUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span>
</span><a name="line-622"></a><a name="newIndefUnitId"><a href="Module.html#newIndefUnitId"><span class="hs-identifier">newIndefUnitId</span></a></a><span> </span><a name="local-6989586621680411921"><a href="#local-6989586621680411921"><span class="hs-identifier">cid</span></a></a><span> </span><a name="local-6989586621680411922"><a href="#local-6989586621680411922"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-623"></a><span>    </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-var">IndefUnitId</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-624"></a><span>        </span><span class="hs-identifier">indefUnitIdComponentId</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411921"><span class="hs-identifier hs-var">cid</span></a><span class="hs-special">,</span><span>
</span><a name="line-625"></a><span>        </span><span class="hs-identifier">indefUnitIdInsts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411924"><span class="hs-identifier hs-var">sorted_insts</span></a><span class="hs-special">,</span><span>
</span><a name="line-626"></a><span>        </span><span class="hs-identifier">indefUnitIdFreeHoles</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDSet.html#unionManyUniqDSets"><span class="hs-identifier hs-var">unionManyUniqDSets</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="Module.html#moduleFreeHoles"><span class="hs-identifier hs-var">moduleFreeHoles</span></a><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680411922"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-627"></a><span>        </span><span class="hs-identifier">indefUnitIdFS</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411923"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">,</span><span>
</span><a name="line-628"></a><span>        </span><span class="hs-identifier">indefUnitIdKey</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680411923"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-629"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-630"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-631"></a><span>     </span><a name="local-6989586621680411923"><a href="#local-6989586621680411923"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#hashUnitId"><span class="hs-identifier hs-var">hashUnitId</span></a><span> </span><a href="#local-6989586621680411921"><span class="hs-identifier hs-var">cid</span></a><span> </span><a href="#local-6989586621680411924"><span class="hs-identifier hs-var">sorted_insts</span></a><span>
</span><a name="line-632"></a><span>     </span><a name="local-6989586621680411924"><a href="#local-6989586621680411924"><span class="hs-identifier">sorted_insts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><a href="Module.html#stableModuleNameCmp"><span class="hs-identifier hs-var">stableModuleNameCmp</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680411922"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span class="hs-comment">-- | Injects an 'IndefUnitId' (indefinite library which</span><span>
</span><a name="line-635"></a><span class="hs-comment">-- was on-the-fly instantiated) to a 'UnitId' (either</span><span>
</span><a name="line-636"></a><span class="hs-comment">-- an indefinite or definite library).</span><span>
</span><a name="line-637"></a><span class="hs-identifier">indefUnitIdToUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-638"></a><a name="indefUnitIdToUnitId"><a href="Module.html#indefUnitIdToUnitId"><span class="hs-identifier">indefUnitIdToUnitId</span></a></a><span> </span><a name="local-6989586621680411925"><a href="#local-6989586621680411925"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621680411926"><a href="#local-6989586621680411926"><span class="hs-identifier">iuid</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-639"></a><span>    </span><span class="hs-comment">-- NB: suppose that we want to compare the indefinite</span><span>
</span><a name="line-640"></a><span>    </span><span class="hs-comment">-- unit id p[H=impl:H] against p+abcd (where p+abcd</span><span>
</span><a name="line-641"></a><span>    </span><span class="hs-comment">-- happens to be the existing, installed version of</span><span>
</span><a name="line-642"></a><span>    </span><span class="hs-comment">-- p[H=impl:H].  If we *only* wrap in p[H=impl:H]</span><span>
</span><a name="line-643"></a><span>    </span><span class="hs-comment">-- IndefiniteUnitId, they won't compare equal; only</span><span>
</span><a name="line-644"></a><span>    </span><span class="hs-comment">-- after improvement will the equality hold.</span><span>
</span><a name="line-645"></a><span>    </span><a href="Packages.html#improveUnitId"><span class="hs-identifier hs-var">improveUnitId</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#getPackageConfigMap"><span class="hs-identifier hs-var">getPackageConfigMap</span></a><span> </span><a href="#local-6989586621680411925"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-646"></a><span>        </span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span> </span><a href="#local-6989586621680411926"><span class="hs-identifier hs-var">iuid</span></a><span>
</span><a name="line-647"></a><span>
</span><a name="line-648"></a><span class="hs-keyword">data</span><span> </span><a name="IndefModule"><a href="Module.html#IndefModule"><span class="hs-identifier">IndefModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="IndefModule"><a href="Module.html#IndefModule"><span class="hs-identifier">IndefModule</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-649"></a><span>        </span><a name="indefModuleUnitId"><a href="Module.html#indefModuleUnitId"><span class="hs-identifier">indefModuleUnitId</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-650"></a><span>        </span><a name="indefModuleName"><a href="Module.html#indefModuleName"><span class="hs-identifier">indefModuleName</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-651"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>
</span><a name="line-653"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Module.html#IndefModule"><span class="hs-identifier hs-type">IndefModule</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-654"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#IndefModule"><span class="hs-identifier hs-var">IndefModule</span></a><span> </span><a name="local-6989586621680411818"><a href="#local-6989586621680411818"><span class="hs-identifier">uid</span></a></a><span> </span><a name="local-6989586621680411819"><a href="#local-6989586621680411819"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-655"></a><span>    </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680411818"><span class="hs-identifier hs-var">uid</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">':'</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680411819"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-656"></a><span>
</span><a name="line-657"></a><span class="hs-comment">-- | Injects an 'IndefModule' to 'Module' (see also</span><span>
</span><a name="line-658"></a><span class="hs-comment">-- 'indefUnitIdToUnitId'.</span><span>
</span><a name="line-659"></a><span class="hs-identifier">indefModuleToModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#IndefModule"><span class="hs-identifier hs-type">IndefModule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-660"></a><a name="indefModuleToModule"><a href="Module.html#indefModuleToModule"><span class="hs-identifier">indefModuleToModule</span></a></a><span> </span><a name="local-6989586621680411927"><a href="#local-6989586621680411927"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#IndefModule"><span class="hs-identifier hs-var">IndefModule</span></a><span> </span><a name="local-6989586621680411928"><a href="#local-6989586621680411928"><span class="hs-identifier">iuid</span></a></a><span> </span><a name="local-6989586621680411929"><a href="#local-6989586621680411929"><span class="hs-identifier">mod_name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-661"></a><span>    </span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#indefUnitIdToUnitId"><span class="hs-identifier hs-var">indefUnitIdToUnitId</span></a><span> </span><a href="#local-6989586621680411927"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680411928"><span class="hs-identifier hs-var">iuid</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680411929"><span class="hs-identifier hs-var">mod_name</span></a><span>
</span><a name="line-662"></a><span>
</span><a name="line-663"></a><span class="hs-comment">-- | An installed unit identifier identifies a library which has</span><span>
</span><a name="line-664"></a><span class="hs-comment">-- been installed to the package database.  These strings are</span><span>
</span><a name="line-665"></a><span class="hs-comment">-- provided to us via the @-this-unit-id@ flag.  The library</span><span>
</span><a name="line-666"></a><span class="hs-comment">-- in question may be definite or indefinite; if it is indefinite,</span><span>
</span><a name="line-667"></a><span class="hs-comment">-- none of the holes have been filled (we never install partially</span><span>
</span><a name="line-668"></a><span class="hs-comment">-- instantiated libraries.)  Put another way, an installed unit id</span><span>
</span><a name="line-669"></a><span class="hs-comment">-- is either fully instantiated, or not instantiated at all.</span><span>
</span><a name="line-670"></a><span class="hs-comment">--</span><span>
</span><a name="line-671"></a><span class="hs-comment">-- Installed unit identifiers look something like @p+af23SAj2dZ219@,</span><span>
</span><a name="line-672"></a><span class="hs-comment">-- or maybe just @p@ if they don't use Backpack.</span><span>
</span><a name="line-673"></a><span class="hs-keyword">newtype</span><span> </span><a name="InstalledUnitId"><a href="Module.html#InstalledUnitId"><span class="hs-identifier">InstalledUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-674"></a><span>    </span><a name="InstalledUnitId"><a href="Module.html#InstalledUnitId"><span class="hs-identifier">InstalledUnitId</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-675"></a><span>      </span><span class="hs-comment">-- | The full hashed unit identifier, including the component id</span><span>
</span><a name="line-676"></a><span>      </span><span class="hs-comment">-- and the hash.</span><span>
</span><a name="line-677"></a><span>      </span><a name="installedUnitIdFS"><a href="Module.html#installedUnitIdFS"><span class="hs-identifier">installedUnitIdFS</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-678"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-679"></a><span>
</span><a name="line-680"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-681"></a><span>  </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621680411814"><a href="#local-6989586621680411814"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-var">InstalledUnitId</span></a><span> </span><a name="local-6989586621680411815"><a href="#local-6989586621680411815"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621680411814"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621680411815"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-682"></a><span>  </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621680411816"><a href="#local-6989586621680411816"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680411817"><a href="#local-6989586621680411817"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621680411816"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-var">InstalledUnitId</span></a><span> </span><a href="#local-6989586621680411817"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span>
</span><a name="line-683"></a><span>
</span><a name="line-684"></a><span class="hs-keyword">instance</span><span> </span><a href="GHC.PackageDb.html#BinaryStringRep"><span class="hs-identifier hs-type">BinaryStringRep</span></a><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-685"></a><span>  </span><a name="local-8214565720323971162"><a href="GHC.PackageDb.html#fromStringRep"><span class="hs-identifier">fromStringRep</span></a></a><span> </span><a name="local-6989586621680411813"><a href="#local-6989586621680411813"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-var">InstalledUnitId</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#mkFastStringByteString"><span class="hs-identifier hs-var">mkFastStringByteString</span></a><span> </span><a href="#local-6989586621680411813"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-686"></a><span>  </span><span class="hs-comment">-- GHC doesn't write to database</span><span>
</span><a name="line-687"></a><span>  </span><a name="local-8214565720323971163"><a href="GHC.PackageDb.html#toStringRep"><span class="hs-identifier">toStringRep</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;BinaryStringRep InstalledUnitId: not implemented&quot;</span><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-690"></a><span>    </span><a name="local-6989586621680411811"><a href="#local-6989586621680411811"><span class="hs-identifier">uid1</span></a></a><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a name="local-6989586621680411812"><a href="#local-6989586621680411812"><span class="hs-identifier">uid2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#installedUnitIdKey"><span class="hs-identifier hs-var">installedUnitIdKey</span></a><span> </span><a href="#local-6989586621680411811"><span class="hs-identifier hs-var">uid1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Module.html#installedUnitIdKey"><span class="hs-identifier hs-var">installedUnitIdKey</span></a><span> </span><a href="#local-6989586621680411812"><span class="hs-identifier hs-var">uid2</span></a><span>
</span><a name="line-691"></a><span>
</span><a name="line-692"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-693"></a><span>    </span><a name="local-6989586621680411809"><a href="#local-6989586621680411809"><span class="hs-identifier">u1</span></a></a><span> </span><span class="hs-special">`</span><a name="local-8214565720323790496"><span class="hs-identifier">compare</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621680411810"><a href="#local-6989586621680411810"><span class="hs-identifier">u2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">installedUnitIdFS</span><span> </span><a href="#local-6989586621680411809"><span class="hs-identifier hs-var">u1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">installedUnitIdFS</span><span> </span><a href="#local-6989586621680411810"><span class="hs-identifier hs-var">u2</span></a><span>
</span><a name="line-694"></a><span>
</span><a name="line-695"></a><span class="hs-keyword">instance</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-696"></a><span>    </span><a name="local-8214565720325051039"><a href="Unique.html#getUnique"><span class="hs-identifier">getUnique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#installedUnitIdKey"><span class="hs-identifier hs-var">installedUnitIdKey</span></a><span>
</span><a name="line-697"></a><span>
</span><a name="line-698"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-699"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621680411804"><a href="#local-6989586621680411804"><span class="hs-identifier">uid</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-var">InstalledUnitId</span></a><span> </span><a name="local-6989586621680411805"><a href="#local-6989586621680411805"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-700"></a><span>        </span><a href="Outputable.html#getPprStyle"><span class="hs-identifier hs-var">getPprStyle</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680411806"><a href="#local-6989586621680411806"><span class="hs-identifier">sty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-701"></a><span>        </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680411807"><a href="#local-6989586621680411807"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-702"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="Packages.html#displayInstalledUnitId"><span class="hs-identifier hs-var">displayInstalledUnitId</span></a><span> </span><a href="#local-6989586621680411807"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621680411804"><span class="hs-identifier hs-var">uid</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-703"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680411808"><a href="#local-6989586621680411808"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#debugStyle"><span class="hs-identifier hs-var">debugStyle</span></a><span> </span><a href="#local-6989586621680411806"><span class="hs-identifier hs-var">sty</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621680411808"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-704"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a><span> </span><a href="#local-6989586621680411805"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-705"></a><span>
</span><a name="line-706"></a><span class="hs-identifier">installedUnitIdKey</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-707"></a><a name="installedUnitIdKey"><a href="Module.html#installedUnitIdKey"><span class="hs-identifier">installedUnitIdKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">installedUnitIdFS</span><span>
</span><a name="line-708"></a><span>
</span><a name="line-709"></a><span class="hs-comment">-- | Lossy conversion to the on-disk 'InstalledUnitId' for a component.</span><span>
</span><a name="line-710"></a><span class="hs-identifier">toInstalledUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span>
</span><a name="line-711"></a><a name="toInstalledUnitId"><a href="Module.html#toInstalledUnitId"><span class="hs-identifier">toInstalledUnitId</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#DefiniteUnitId"><span class="hs-identifier hs-var">DefiniteUnitId</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-var">DefUnitId</span></a><span> </span><a name="local-6989586621680411930"><a href="#local-6989586621680411930"><span class="hs-identifier">iuid</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411930"><span class="hs-identifier hs-var">iuid</span></a><span>
</span><a name="line-712"></a><span class="hs-identifier">toInstalledUnitId</span><span> </span><span class="hs-special">(</span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span> </span><a name="local-6989586621680411931"><a href="#local-6989586621680411931"><span class="hs-identifier">indef</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-713"></a><span>    </span><a href="Module.html#componentIdToInstalledUnitId"><span class="hs-identifier hs-var">componentIdToInstalledUnitId</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">indefUnitIdComponentId</span><span> </span><a href="#local-6989586621680411931"><span class="hs-identifier hs-var">indef</span></a><span class="hs-special">)</span><span>
</span><a name="line-714"></a><span>
</span><a name="line-715"></a><span class="hs-identifier">installedUnitIdString</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-716"></a><a name="installedUnitIdString"><a href="Module.html#installedUnitIdString"><span class="hs-identifier">installedUnitIdString</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">installedUnitIdFS</span><span>
</span><a name="line-717"></a><span>
</span><a name="line-718"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-719"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621680411799"><a href="#local-6989586621680411799"><span class="hs-identifier">uid</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-720"></a><span>      </span><span class="hs-comment">-- getPprStyle $ \sty -&gt;</span><span>
</span><a name="line-721"></a><span>      </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680411800"><span class="hs-identifier hs-var">cid</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-722"></a><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680411801"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- pprIf</span><span>
</span><a name="line-723"></a><span>          </span><span class="hs-keyword">then</span><span>
</span><a name="line-724"></a><span>            </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a><span>
</span><a name="line-725"></a><span>                </span><span class="hs-special">(</span><a href="Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-726"></a><span>                    </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680411802"><span class="hs-identifier hs-var">modname</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;=&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680411803"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-727"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680411802"><a href="#local-6989586621680411802"><span class="hs-identifier">modname</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680411803"><a href="#local-6989586621680411803"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680411801"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-728"></a><span>          </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">)</span><span>
</span><a name="line-729"></a><span>     </span><span class="hs-keyword">where</span><span>
</span><a name="line-730"></a><span>      </span><a name="local-6989586621680411800"><a href="#local-6989586621680411800"><span class="hs-identifier">cid</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">indefUnitIdComponentId</span><span> </span><a href="#local-6989586621680411799"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-731"></a><span>      </span><a name="local-6989586621680411801"><a href="#local-6989586621680411801"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">indefUnitIdInsts</span><span> </span><a href="#local-6989586621680411799"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-732"></a><span>
</span><a name="line-733"></a><span class="hs-comment">-- | A 'InstalledModule' is a 'Module' which contains a 'InstalledUnitId'.</span><span>
</span><a name="line-734"></a><span class="hs-keyword">data</span><span> </span><a name="InstalledModule"><a href="Module.html#InstalledModule"><span class="hs-identifier">InstalledModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="InstalledModule"><a href="Module.html#InstalledModule"><span class="hs-identifier">InstalledModule</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-735"></a><span>   </span><a name="installedModuleUnitId"><a href="Module.html#installedModuleUnitId"><span class="hs-identifier">installedModuleUnitId</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-736"></a><span>   </span><a name="installedModuleName"><a href="Module.html#installedModuleName"><span class="hs-identifier">installedModuleName</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-737"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-738"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-739"></a><span>
</span><a name="line-740"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-741"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-var">InstalledModule</span></a><span> </span><a name="local-6989586621680411797"><a href="#local-6989586621680411797"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621680411798"><a href="#local-6989586621680411798"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-742"></a><span>    </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680411797"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">':'</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Module.html#pprModuleName"><span class="hs-identifier hs-var">pprModuleName</span></a><span> </span><a href="#local-6989586621680411798"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-743"></a><span>
</span><a name="line-744"></a><span class="hs-identifier">fsToInstalledUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span>
</span><a name="line-745"></a><a name="fsToInstalledUnitId"><a href="Module.html#fsToInstalledUnitId"><span class="hs-identifier">fsToInstalledUnitId</span></a></a><span> </span><a name="local-6989586621680411932"><a href="#local-6989586621680411932"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-var">InstalledUnitId</span></a><span> </span><a href="#local-6989586621680411932"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-746"></a><span>
</span><a name="line-747"></a><span class="hs-identifier">componentIdToInstalledUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span>
</span><a name="line-748"></a><a name="componentIdToInstalledUnitId"><a href="Module.html#componentIdToInstalledUnitId"><span class="hs-identifier">componentIdToInstalledUnitId</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ComponentId"><span class="hs-identifier hs-var">ComponentId</span></a><span> </span><a name="local-6989586621680411933"><a href="#local-6989586621680411933"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToInstalledUnitId"><span class="hs-identifier hs-var">fsToInstalledUnitId</span></a><span> </span><a href="#local-6989586621680411933"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-749"></a><span>
</span><a name="line-750"></a><span class="hs-identifier">stringToInstalledUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span>
</span><a name="line-751"></a><a name="stringToInstalledUnitId"><a href="Module.html#stringToInstalledUnitId"><span class="hs-identifier">stringToInstalledUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToInstalledUnitId"><span class="hs-identifier hs-var">fsToInstalledUnitId</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a><span>
</span><a name="line-752"></a><span>
</span><a name="line-753"></a><span class="hs-comment">-- | Test if a 'Module' corresponds to a given 'InstalledModule',</span><span>
</span><a name="line-754"></a><span class="hs-comment">-- modulo instantiation.</span><span>
</span><a name="line-755"></a><span class="hs-identifier">installedModuleEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-756"></a><a name="installedModuleEq"><a href="Module.html#installedModuleEq"><span class="hs-identifier">installedModuleEq</span></a></a><span> </span><a name="local-6989586621680411934"><a href="#local-6989586621680411934"><span class="hs-identifier">imod</span></a></a><span> </span><a name="local-6989586621680411935"><a href="#local-6989586621680411935"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-757"></a><span>    </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><a href="Module.html#splitModuleInsts"><span class="hs-identifier hs-var">splitModuleInsts</span></a><span> </span><a href="#local-6989586621680411935"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680411934"><span class="hs-identifier hs-var">imod</span></a><span>
</span><a name="line-758"></a><span>
</span><a name="line-759"></a><span class="hs-comment">-- | Test if a 'UnitId' corresponds to a given 'InstalledUnitId',</span><span>
</span><a name="line-760"></a><span class="hs-comment">-- modulo instantiation.</span><span>
</span><a name="line-761"></a><span class="hs-identifier">installedUnitIdEq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-762"></a><a name="installedUnitIdEq"><a href="Module.html#installedUnitIdEq"><span class="hs-identifier">installedUnitIdEq</span></a></a><span> </span><a name="local-6989586621680411936"><a href="#local-6989586621680411936"><span class="hs-identifier">iuid</span></a></a><span> </span><a name="local-6989586621680411937"><a href="#local-6989586621680411937"><span class="hs-identifier">uid</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-763"></a><span>    </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><a href="Module.html#splitUnitIdInsts"><span class="hs-identifier hs-var">splitUnitIdInsts</span></a><span> </span><a href="#local-6989586621680411937"><span class="hs-identifier hs-var">uid</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680411936"><span class="hs-identifier hs-var">iuid</span></a><span>
</span><a name="line-764"></a><span>
</span><a name="line-765"></a><span class="hs-comment">-- | A 'DefUnitId' is an 'InstalledUnitId' with the invariant that</span><span>
</span><a name="line-766"></a><span class="hs-comment">-- it only refers to a definite library; i.e., one we have generated</span><span>
</span><a name="line-767"></a><span class="hs-comment">-- code for.</span><span>
</span><a name="line-768"></a><span class="hs-keyword">newtype</span><span> </span><a name="DefUnitId"><a href="Module.html#DefUnitId"><span class="hs-identifier">DefUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DefUnitId"><a href="Module.html#DefUnitId"><span class="hs-identifier">DefUnitId</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unDefUnitId"><a href="Module.html#unDefUnitId"><span class="hs-identifier">unDefUnitId</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-769"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-770"></a><span>
</span><a name="line-771"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-type">DefUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-772"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-var">DefUnitId</span></a><span> </span><a name="local-6989586621680411796"><a href="#local-6989586621680411796"><span class="hs-identifier">uid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680411796"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-773"></a><span>
</span><a name="line-774"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-type">DefUnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-775"></a><span>    </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621680411792"><a href="#local-6989586621680411792"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-var">DefUnitId</span></a><span> </span><a name="local-6989586621680411793"><a href="#local-6989586621680411793"><span class="hs-identifier">uid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621680411792"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621680411793"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-776"></a><span>    </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621680411794"><a href="#local-6989586621680411794"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680411795"><a href="#local-6989586621680411795"><span class="hs-identifier">uid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621680411794"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-var">DefUnitId</span></a><span> </span><a href="#local-6989586621680411795"><span class="hs-identifier hs-var">uid</span></a><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>
</span><a name="line-778"></a><span class="hs-comment">-- | A map keyed off of 'InstalledModule'</span><span>
</span><a name="line-779"></a><span class="hs-keyword">newtype</span><span> </span><a name="InstalledModuleEnv"><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier">InstalledModuleEnv</span></a></a><span> </span><a name="local-6989586621680411769"><a href="#local-6989586621680411769"><span class="hs-identifier">elt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="InstalledModuleEnv"><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier">InstalledModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span> </span><a href="#local-6989586621680411769"><span class="hs-identifier hs-type">elt</span></a><span class="hs-special">)</span><span>
</span><a name="line-780"></a><span>
</span><a name="line-781"></a><span class="hs-identifier">emptyInstalledModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span> </span><a href="#local-6989586621680411887"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-782"></a><a name="emptyInstalledModuleEnv"><a href="Module.html#emptyInstalledModuleEnv"><span class="hs-identifier">emptyInstalledModuleEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-var">InstalledModuleEnv</span></a><span> </span><span class="hs-identifier hs-var">Map.empty</span><span>
</span><a name="line-783"></a><span>
</span><a name="line-784"></a><span class="hs-identifier">lookupInstalledModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span> </span><a href="#local-6989586621680411886"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621680411886"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-785"></a><a name="lookupInstalledModuleEnv"><a href="Module.html#lookupInstalledModuleEnv"><span class="hs-identifier">lookupInstalledModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-var">InstalledModuleEnv</span></a><span> </span><a name="local-6989586621680411938"><a href="#local-6989586621680411938"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680411939"><a href="#local-6989586621680411939"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621680411939"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621680411938"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-786"></a><span>
</span><a name="line-787"></a><span class="hs-identifier">extendInstalledModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span> </span><a href="#local-6989586621680411885"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411885"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span> </span><a href="#local-6989586621680411885"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-788"></a><a name="extendInstalledModuleEnv"><a href="Module.html#extendInstalledModuleEnv"><span class="hs-identifier">extendInstalledModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-var">InstalledModuleEnv</span></a><span> </span><a name="local-6989586621680411940"><a href="#local-6989586621680411940"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680411941"><a href="#local-6989586621680411941"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680411942"><a href="#local-6989586621680411942"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-var">InstalledModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.insert</span><span> </span><a href="#local-6989586621680411941"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621680411942"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680411940"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-789"></a><span>
</span><a name="line-790"></a><span class="hs-identifier">filterInstalledModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411884"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span> </span><a href="#local-6989586621680411884"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span> </span><a href="#local-6989586621680411884"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-791"></a><a name="filterInstalledModuleEnv"><a href="Module.html#filterInstalledModuleEnv"><span class="hs-identifier">filterInstalledModuleEnv</span></a></a><span> </span><a name="local-6989586621680411943"><a href="#local-6989586621680411943"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-var">InstalledModuleEnv</span></a><span> </span><a name="local-6989586621680411944"><a href="#local-6989586621680411944"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-792"></a><span>  </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-var">InstalledModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.filterWithKey</span><span> </span><a href="#local-6989586621680411943"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680411944"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-793"></a><span>
</span><a name="line-794"></a><span class="hs-identifier">delInstalledModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span> </span><a href="#local-6989586621680411883"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span> </span><a href="#local-6989586621680411883"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-795"></a><a name="delInstalledModuleEnv"><a href="Module.html#delInstalledModuleEnv"><span class="hs-identifier">delInstalledModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-var">InstalledModuleEnv</span></a><span> </span><a name="local-6989586621680411945"><a href="#local-6989586621680411945"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680411946"><a href="#local-6989586621680411946"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-var">InstalledModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.delete</span><span> </span><a href="#local-6989586621680411946"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621680411945"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-796"></a><span>
</span><a name="line-797"></a><span class="hs-comment">-- Note [UnitId to InstalledUnitId improvement]</span><span>
</span><a name="line-798"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-799"></a><span class="hs-comment">-- Just because a UnitId is definite (has no holes) doesn't</span><span>
</span><a name="line-800"></a><span class="hs-comment">-- mean it's necessarily a InstalledUnitId; it could just be</span><span>
</span><a name="line-801"></a><span class="hs-comment">-- that over the course of renaming UnitIds on the fly</span><span>
</span><a name="line-802"></a><span class="hs-comment">-- while typechecking an indefinite library, we</span><span>
</span><a name="line-803"></a><span class="hs-comment">-- ended up with a fully instantiated unit id with no hash,</span><span>
</span><a name="line-804"></a><span class="hs-comment">-- since we haven't built it yet.  This is fine.</span><span>
</span><a name="line-805"></a><span class="hs-comment">--</span><span>
</span><a name="line-806"></a><span class="hs-comment">-- However, if there is a hashed unit id for this instantiation</span><span>
</span><a name="line-807"></a><span class="hs-comment">-- in the package database, we *better use it*, because</span><span>
</span><a name="line-808"></a><span class="hs-comment">-- that hashed unit id may be lurking in another interface,</span><span>
</span><a name="line-809"></a><span class="hs-comment">-- and chaos will ensue if we attempt to compare the two</span><span>
</span><a name="line-810"></a><span class="hs-comment">-- (the unitIdFS for a UnitId never corresponds to a Cabal-provided</span><span>
</span><a name="line-811"></a><span class="hs-comment">-- hash of a compiled instantiated library).</span><span>
</span><a name="line-812"></a><span class="hs-comment">--</span><span>
</span><a name="line-813"></a><span class="hs-comment">-- There is one last niggle: improvement based on the package database means</span><span>
</span><a name="line-814"></a><span class="hs-comment">-- that we might end up developing on a package that is not transitively</span><span>
</span><a name="line-815"></a><span class="hs-comment">-- depended upon by the packages the user specified directly via command line</span><span>
</span><a name="line-816"></a><span class="hs-comment">-- flags.  This could lead to strange and difficult to understand bugs if those</span><span>
</span><a name="line-817"></a><span class="hs-comment">-- instantiations are out of date.  The solution is to only improve a</span><span>
</span><a name="line-818"></a><span class="hs-comment">-- unit id if the new unit id is part of the 'preloadClosure'; i.e., the</span><span>
</span><a name="line-819"></a><span class="hs-comment">-- closure of all the packages which were explicitly specified.</span><span>
</span><a name="line-820"></a><span>
</span><a name="line-821"></a><span class="hs-comment">-- | Retrieve the set of free holes of a 'UnitId'.</span><span>
</span><a name="line-822"></a><span class="hs-identifier">unitIdFreeHoles</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqDSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-823"></a><a name="unitIdFreeHoles"><a href="Module.html#unitIdFreeHoles"><span class="hs-identifier">unitIdFreeHoles</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span> </span><a name="local-6989586621680411947"><a href="#local-6989586621680411947"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">indefUnitIdFreeHoles</span><span> </span><a href="#local-6989586621680411947"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-824"></a><span class="hs-comment">-- Hashed unit ids are always fully instantiated</span><span>
</span><a name="line-825"></a><span class="hs-identifier">unitIdFreeHoles</span><span> </span><span class="hs-special">(</span><a href="Module.html#DefiniteUnitId"><span class="hs-identifier hs-var">DefiniteUnitId</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDSet.html#emptyUniqDSet"><span class="hs-identifier hs-var">emptyUniqDSet</span></a><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-828"></a><span>    </span><a name="local-8214565720323790323"><span class="hs-identifier">show</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#unitIdString"><span class="hs-identifier hs-var">unitIdString</span></a><span>
</span><a name="line-829"></a><span>
</span><a name="line-830"></a><span class="hs-comment">-- | A 'UnitId' is definite if it has no free holes.</span><span>
</span><a name="line-831"></a><span class="hs-identifier">unitIdIsDefinite</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-832"></a><a name="unitIdIsDefinite"><a href="Module.html#unitIdIsDefinite"><span class="hs-identifier">unitIdIsDefinite</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDSet.html#isEmptyUniqDSet"><span class="hs-identifier hs-var">isEmptyUniqDSet</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Module.html#unitIdFreeHoles"><span class="hs-identifier hs-var">unitIdFreeHoles</span></a><span>
</span><a name="line-833"></a><span>
</span><a name="line-834"></a><span class="hs-comment">-- | Generate a uniquely identifying 'FastString' for a unit</span><span>
</span><a name="line-835"></a><span class="hs-comment">-- identifier.  This is a one-way function.  You can rely on one special</span><span>
</span><a name="line-836"></a><span class="hs-comment">-- property: if a unit identifier is in most general form, its 'FastString'</span><span>
</span><a name="line-837"></a><span class="hs-comment">-- coincides with its 'ComponentId'.  This hash is completely internal</span><span>
</span><a name="line-838"></a><span class="hs-comment">-- to GHC and is not used for symbol names or file paths.</span><span>
</span><a name="line-839"></a><span class="hs-identifier">hashUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>
</span><a name="line-840"></a><a name="hashUnitId"><a href="Module.html#hashUnitId"><span class="hs-identifier">hashUnitId</span></a></a><span> </span><a name="local-6989586621680411948"><a href="#local-6989586621680411948"><span class="hs-identifier">cid</span></a></a><span> </span><a name="local-6989586621680411949"><a href="#local-6989586621680411949"><span class="hs-identifier">sorted_holes</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-841"></a><span>    </span><a href="FastString.html#mkFastStringByteString"><span class="hs-identifier hs-var">mkFastStringByteString</span></a><span>
</span><a name="line-842"></a><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="Module.html#fingerprintUnitId"><span class="hs-identifier hs-var">fingerprintUnitId</span></a><span> </span><span class="hs-special">(</span><a href="GHC.PackageDb.html#toStringRep"><span class="hs-identifier hs-var">toStringRep</span></a><span> </span><a href="#local-6989586621680411948"><span class="hs-identifier hs-var">cid</span></a><span class="hs-special">)</span><span>
</span><a name="line-843"></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><a href="Module.html#rawHashUnitId"><span class="hs-identifier hs-var">rawHashUnitId</span></a><span> </span><a href="#local-6989586621680411949"><span class="hs-identifier hs-var">sorted_holes</span></a><span>
</span><a name="line-844"></a><span>
</span><a name="line-845"></a><span class="hs-comment">-- | Generate a hash for a sorted module substitution.</span><span>
</span><a name="line-846"></a><span class="hs-identifier">rawHashUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span>
</span><a name="line-847"></a><a name="rawHashUnitId"><a href="Module.html#rawHashUnitId"><span class="hs-identifier">rawHashUnitId</span></a></a><span> </span><a name="local-6989586621680411950"><a href="#local-6989586621680411950"><span class="hs-identifier">sorted_holes</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-848"></a><span>    </span><a href="Fingerprint.html#fingerprintByteString"><span class="hs-identifier hs-var">fingerprintByteString</span></a><span>
</span><a name="line-849"></a><span>  </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">BS.concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-850"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680411951"><a href="#local-6989586621680411951"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680411952"><a href="#local-6989586621680411952"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680411950"><span class="hs-identifier hs-var">sorted_holes</span></a><span>
</span><a name="line-851"></a><span>        </span><span class="hs-special">[</span><span> </span><a href="GHC.PackageDb.html#toStringRep"><span class="hs-identifier hs-var">toStringRep</span></a><span> </span><a href="#local-6989586621680411951"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span>                </span><span class="hs-identifier hs-var">BS.Char8.singleton</span><span> </span><span class="hs-char">' '</span><span class="hs-special">,</span><span>
</span><a name="line-852"></a><span>          </span><a href="FastString.html#fastStringToByteString"><span class="hs-identifier hs-var">fastStringToByteString</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-6989586621680411952"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">BS.Char8.singleton</span><span> </span><span class="hs-char">':'</span><span class="hs-special">,</span><span>
</span><a name="line-853"></a><span>          </span><a href="GHC.PackageDb.html#toStringRep"><span class="hs-identifier hs-var">toStringRep</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621680411952"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>   </span><span class="hs-identifier hs-var">BS.Char8.singleton</span><span> </span><span class="hs-char">'\n'</span><span class="hs-special">]</span><span>
</span><a name="line-854"></a><span>
</span><a name="line-855"></a><span class="hs-identifier">fingerprintUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BS.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BS.ByteString</span><span>
</span><a name="line-856"></a><a name="fingerprintUnitId"><a href="Module.html#fingerprintUnitId"><span class="hs-identifier">fingerprintUnitId</span></a></a><span> </span><a name="local-6989586621680411953"><a href="#local-6989586621680411953"><span class="hs-identifier">prefix</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Fingerprint</span><span> </span><a name="local-6989586621680411954"><a href="#local-6989586621680411954"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621680411955"><a href="#local-6989586621680411955"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-857"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BS.concat</span><span>
</span><a name="line-858"></a><span>    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621680411953"><span class="hs-identifier hs-var">prefix</span></a><span>
</span><a name="line-859"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">BS.Char8.singleton</span><span> </span><span class="hs-char">'-'</span><span>
</span><a name="line-860"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">BS.Char8.pack</span><span> </span><span class="hs-special">(</span><a href="Encoding.html#toBase62Padded"><span class="hs-identifier hs-var">toBase62Padded</span></a><span> </span><a href="#local-6989586621680411954"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-861"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">BS.Char8.pack</span><span> </span><span class="hs-special">(</span><a href="Encoding.html#toBase62Padded"><span class="hs-identifier hs-var">toBase62Padded</span></a><span> </span><a href="#local-6989586621680411955"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-862"></a><span>
</span><a name="line-863"></a><span class="hs-comment">-- | Create a new, un-hashed unit identifier.</span><span>
</span><a name="line-864"></a><span class="hs-identifier">newUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-865"></a><a name="newUnitId"><a href="Module.html#newUnitId"><span class="hs-identifier">newUnitId</span></a></a><span> </span><a name="local-6989586621680411956"><a href="#local-6989586621680411956"><span class="hs-identifier">cid</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#newSimpleUnitId"><span class="hs-identifier hs-var">newSimpleUnitId</span></a><span> </span><a href="#local-6989586621680411956"><span class="hs-identifier hs-var">cid</span></a><span> </span><span class="hs-comment">-- TODO: this indicates some latent bug...</span><span>
</span><a name="line-866"></a><span class="hs-identifier">newUnitId</span><span> </span><a name="local-6989586621680411957"><a href="#local-6989586621680411957"><span class="hs-identifier">cid</span></a></a><span> </span><a name="local-6989586621680411958"><a href="#local-6989586621680411958"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Module.html#newIndefUnitId"><span class="hs-identifier hs-var">newIndefUnitId</span></a><span> </span><a href="#local-6989586621680411957"><span class="hs-identifier hs-var">cid</span></a><span> </span><a href="#local-6989586621680411958"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-867"></a><span>
</span><a name="line-868"></a><span class="hs-identifier">pprUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-869"></a><a name="pprUnitId"><a href="Module.html#pprUnitId"><span class="hs-identifier">pprUnitId</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#DefiniteUnitId"><span class="hs-identifier hs-var">DefiniteUnitId</span></a><span> </span><a name="local-6989586621680411959"><a href="#local-6989586621680411959"><span class="hs-identifier">uid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680411959"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-870"></a><span class="hs-identifier">pprUnitId</span><span> </span><span class="hs-special">(</span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span> </span><a name="local-6989586621680411960"><a href="#local-6989586621680411960"><span class="hs-identifier">uid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680411960"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-871"></a><span>
</span><a name="line-872"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-873"></a><span>  </span><a name="local-6989586621680411790"><a href="#local-6989586621680411790"><span class="hs-identifier">uid1</span></a></a><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a name="local-6989586621680411791"><a href="#local-6989586621680411791"><span class="hs-identifier">uid2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#unitIdKey"><span class="hs-identifier hs-var">unitIdKey</span></a><span> </span><a href="#local-6989586621680411790"><span class="hs-identifier hs-var">uid1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Module.html#unitIdKey"><span class="hs-identifier hs-var">unitIdKey</span></a><span> </span><a href="#local-6989586621680411791"><span class="hs-identifier hs-var">uid2</span></a><span>
</span><a name="line-874"></a><span>
</span><a name="line-875"></a><span class="hs-keyword">instance</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-876"></a><span>  </span><a name="local-8214565720325051039"><a href="Unique.html#getUnique"><span class="hs-identifier">getUnique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#unitIdKey"><span class="hs-identifier hs-var">unitIdKey</span></a><span>
</span><a name="line-877"></a><span>
</span><a name="line-878"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-879"></a><span>  </span><a name="local-6989586621680411788"><a href="#local-6989586621680411788"><span class="hs-identifier">nm1</span></a></a><span> </span><span class="hs-special">`</span><a name="local-8214565720323790496"><span class="hs-identifier">compare</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621680411789"><a href="#local-6989586621680411789"><span class="hs-identifier">nm2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#stableUnitIdCmp"><span class="hs-identifier hs-var">stableUnitIdCmp</span></a><span> </span><a href="#local-6989586621680411788"><span class="hs-identifier hs-var">nm1</span></a><span> </span><a href="#local-6989586621680411789"><span class="hs-identifier hs-var">nm2</span></a><span>
</span><a name="line-880"></a><span>
</span><a name="line-881"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Data</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-882"></a><span>  </span><span class="hs-comment">-- don't traverse?</span><span>
</span><a name="line-883"></a><span>  </span><a name="local-8214565720323786785"><span class="hs-identifier">toConstr</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#abstractConstr"><span class="hs-identifier hs-var">abstractConstr</span></a><span> </span><span class="hs-string">&quot;UnitId&quot;</span><span>
</span><a name="line-884"></a><span>  </span><a name="local-8214565720323786786"><span class="hs-identifier">gunfold</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;gunfold&quot;</span><span>
</span><a name="line-885"></a><span>  </span><a name="local-8214565720323786784"><span class="hs-identifier">dataTypeOf</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNoRepType</span><span> </span><span class="hs-string">&quot;UnitId&quot;</span><span>
</span><a name="line-886"></a><span>
</span><a name="line-887"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">NFData</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-888"></a><span>  </span><a name="local-8214565720323792605"><span class="hs-identifier">rnf</span></a><span> </span><a name="local-6989586621680411787"><a href="#local-6989586621680411787"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411787"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-889"></a><span>
</span><a name="line-890"></a><span class="hs-identifier">stableUnitIdCmp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-891"></a><span class="hs-comment">-- ^ Compares package ids lexically, rather than by their 'Unique's</span><span>
</span><a name="line-892"></a><a name="stableUnitIdCmp"><a href="Module.html#stableUnitIdCmp"><span class="hs-identifier">stableUnitIdCmp</span></a></a><span> </span><a name="local-6989586621680411961"><a href="#local-6989586621680411961"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621680411962"><a href="#local-6989586621680411962"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a><span> </span><a href="#local-6989586621680411961"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="Module.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a><span> </span><a href="#local-6989586621680411962"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-893"></a><span>
</span><a name="line-894"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-895"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621680411786"><a href="#local-6989586621680411786"><span class="hs-identifier">pk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#pprUnitId"><span class="hs-identifier hs-var">pprUnitId</span></a><span> </span><a href="#local-6989586621680411786"><span class="hs-identifier hs-var">pk</span></a><span>
</span><a name="line-896"></a><span>
</span><a name="line-897"></a><span class="hs-comment">-- Performance: would prefer to have a NameCache like thing</span><span>
</span><a name="line-898"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-899"></a><span>  </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621680411780"><a href="#local-6989586621680411780"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#DefiniteUnitId"><span class="hs-identifier hs-var">DefiniteUnitId</span></a><span> </span><a name="local-6989586621680411781"><a href="#local-6989586621680411781"><span class="hs-identifier">def_uid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-900"></a><span>    </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621680411780"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-901"></a><span>    </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621680411780"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621680411781"><span class="hs-identifier hs-var">def_uid</span></a><span>
</span><a name="line-902"></a><span>  </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621680411782"><a href="#local-6989586621680411782"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span> </span><a name="local-6989586621680411783"><a href="#local-6989586621680411783"><span class="hs-identifier">indef_uid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-903"></a><span>    </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621680411782"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-904"></a><span>    </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621680411782"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621680411783"><span class="hs-identifier hs-var">indef_uid</span></a><span>
</span><a name="line-905"></a><span>  </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621680411784"><a href="#local-6989586621680411784"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680411785"><a href="#local-6989586621680411785"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a><span> </span><a href="#local-6989586621680411784"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-906"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680411785"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-907"></a><span>                </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Module.html#DefiniteUnitId"><span class="hs-identifier hs-var">DefiniteUnitId</span></a><span>   </span><span class="hs-special">(</span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621680411784"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">)</span><span>
</span><a name="line-908"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span> </span><span class="hs-special">(</span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621680411784"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">)</span><span>
</span><a name="line-909"></a><span>
</span><a name="line-910"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-911"></a><span>  </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621680411776"><a href="#local-6989586621680411776"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ComponentId"><span class="hs-identifier hs-var">ComponentId</span></a><span> </span><a name="local-6989586621680411777"><a href="#local-6989586621680411777"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621680411776"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621680411777"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-912"></a><span>  </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621680411778"><a href="#local-6989586621680411778"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680411779"><a href="#local-6989586621680411779"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621680411778"><span class="hs-identifier hs-var">bh</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Module.html#ComponentId"><span class="hs-identifier hs-var">ComponentId</span></a><span> </span><a href="#local-6989586621680411779"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-913"></a><span>
</span><a name="line-914"></a><span class="hs-comment">-- | Create a new simple unit identifier (no holes) from a 'ComponentId'.</span><span>
</span><a name="line-915"></a><span class="hs-identifier">newSimpleUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-916"></a><a name="newSimpleUnitId"><a href="Module.html#newSimpleUnitId"><span class="hs-identifier">newSimpleUnitId</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ComponentId"><span class="hs-identifier hs-var">ComponentId</span></a><span> </span><a name="local-6989586621680411963"><a href="#local-6989586621680411963"><span class="hs-identifier">fs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><a href="#local-6989586621680411963"><span class="hs-identifier hs-var">fs</span></a><span>
</span><a name="line-917"></a><span>
</span><a name="line-918"></a><span class="hs-comment">-- | Create a new simple unit identifier from a 'FastString'.  Internally,</span><span>
</span><a name="line-919"></a><span class="hs-comment">-- this is primarily used to specify wired-in unit identifiers.</span><span>
</span><a name="line-920"></a><span class="hs-identifier">fsToUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-921"></a><a name="fsToUnitId"><a href="Module.html#fsToUnitId"><span class="hs-identifier">fsToUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#DefiniteUnitId"><span class="hs-identifier hs-var">DefiniteUnitId</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-var">DefUnitId</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-var">InstalledUnitId</span></a><span>
</span><a name="line-922"></a><span>
</span><a name="line-923"></a><span class="hs-identifier">stringToUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-924"></a><a name="stringToUnitId"><a href="Module.html#stringToUnitId"><span class="hs-identifier">stringToUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a><span>
</span><a name="line-925"></a><span>
</span><a name="line-926"></a><span class="hs-identifier">unitIdString</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-927"></a><a name="unitIdString"><a href="Module.html#unitIdString"><span class="hs-identifier">unitIdString</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Module.html#unitIdFS"><span class="hs-identifier hs-var">unitIdFS</span></a><span>
</span><a name="line-928"></a><span>
</span><a name="line-929"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        Hole substitutions
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-936"></a><span>
</span><a name="line-937"></a><span class="hs-comment">-- | Substitution on module variables, mapping module names to module</span><span>
</span><a name="line-938"></a><span class="hs-comment">-- identifiers.</span><span>
</span><a name="line-939"></a><span class="hs-keyword">type</span><span> </span><a name="ShHoleSubst"><a href="Module.html#ShHoleSubst"><span class="hs-identifier">ShHoleSubst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleNameEnv"><span class="hs-identifier hs-type">ModuleNameEnv</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-940"></a><span>
</span><a name="line-941"></a><span class="hs-comment">-- | Substitutes holes in a 'Module'.  NOT suitable for being called</span><span>
</span><a name="line-942"></a><span class="hs-comment">-- directly on a 'nameModule', see Note [Representation of module/name variable].</span><span>
</span><a name="line-943"></a><span class="hs-comment">-- @p[A=&lt;A&gt;]:B@ maps to @p[A=q():A]:B@ with @A=q():A@;</span><span>
</span><a name="line-944"></a><span class="hs-comment">-- similarly, @&lt;A&gt;@ maps to @q():A@.</span><span>
</span><a name="line-945"></a><span class="hs-identifier">renameHoleModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ShHoleSubst"><span class="hs-identifier hs-type">ShHoleSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-946"></a><a name="renameHoleModule"><a href="Module.html#renameHoleModule"><span class="hs-identifier">renameHoleModule</span></a></a><span> </span><a name="local-6989586621680411964"><a href="#local-6989586621680411964"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#renameHoleModule%27"><span class="hs-identifier hs-var">renameHoleModule'</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#getPackageConfigMap"><span class="hs-identifier hs-var">getPackageConfigMap</span></a><span> </span><a href="#local-6989586621680411964"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span class="hs-comment">-- | Substitutes holes in a 'UnitId', suitable for renaming when</span><span>
</span><a name="line-949"></a><span class="hs-comment">-- an include occurs; see Note [Representation of module/name variable].</span><span>
</span><a name="line-950"></a><span class="hs-comment">--</span><span>
</span><a name="line-951"></a><span class="hs-comment">-- @p[A=&lt;A&gt;]@ maps to @p[A=&lt;B&gt;]@ with @A=&lt;B&gt;@.</span><span>
</span><a name="line-952"></a><span class="hs-identifier">renameHoleUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ShHoleSubst"><span class="hs-identifier hs-type">ShHoleSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-953"></a><a name="renameHoleUnitId"><a href="Module.html#renameHoleUnitId"><span class="hs-identifier">renameHoleUnitId</span></a></a><span> </span><a name="local-6989586621680411965"><a href="#local-6989586621680411965"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#renameHoleUnitId%27"><span class="hs-identifier hs-var">renameHoleUnitId'</span></a><span> </span><span class="hs-special">(</span><a href="Packages.html#getPackageConfigMap"><span class="hs-identifier hs-var">getPackageConfigMap</span></a><span> </span><a href="#local-6989586621680411965"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><span class="hs-comment">-- | Like 'renameHoleModule', but requires only 'PackageConfigMap'</span><span>
</span><a name="line-956"></a><span class="hs-comment">-- so it can be used by &quot;Packages&quot;.</span><span>
</span><a name="line-957"></a><span class="hs-identifier">renameHoleModule'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ShHoleSubst"><span class="hs-identifier hs-type">ShHoleSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-958"></a><a name="renameHoleModule%27"><a href="Module.html#renameHoleModule%27"><span class="hs-identifier">renameHoleModule'</span></a></a><span> </span><a name="local-6989586621680411966"><a href="#local-6989586621680411966"><span class="hs-identifier">pkg_map</span></a></a><span> </span><a name="local-6989586621680411967"><a href="#local-6989586621680411967"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621680411968"><a href="#local-6989586621680411968"><span class="hs-identifier">m</span></a></a><span>
</span><a name="line-959"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Module.html#isHoleModule"><span class="hs-identifier hs-var">isHoleModule</span></a><span> </span><a href="#local-6989586621680411968"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-960"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680411969"><a href="#local-6989586621680411969"><span class="hs-identifier">uid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#renameHoleUnitId%27"><span class="hs-identifier hs-var">renameHoleUnitId'</span></a><span> </span><a href="#local-6989586621680411966"><span class="hs-identifier hs-var">pkg_map</span></a><span> </span><a href="#local-6989586621680411967"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-6989586621680411968"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-961"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span> </span><a href="#local-6989586621680411969"><span class="hs-identifier hs-var">uid</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621680411968"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-962"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680411970"><a href="#local-6989586621680411970"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span> </span><a href="#local-6989586621680411967"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621680411968"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411970"><span class="hs-identifier hs-var">m'</span></a><span>
</span><a name="line-963"></a><span>  </span><span class="hs-comment">-- NB m = &lt;Blah&gt;, that's what's in scope.</span><span>
</span><a name="line-964"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411968"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-965"></a><span>
</span><a name="line-966"></a><span class="hs-comment">-- | Like 'renameHoleUnitId, but requires only 'PackageConfigMap'</span><span>
</span><a name="line-967"></a><span class="hs-comment">-- so it can be used by &quot;Packages&quot;.</span><span>
</span><a name="line-968"></a><span class="hs-identifier">renameHoleUnitId'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Packages.html#PackageConfigMap"><span class="hs-identifier hs-type">PackageConfigMap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ShHoleSubst"><span class="hs-identifier hs-type">ShHoleSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-969"></a><a name="renameHoleUnitId%27"><a href="Module.html#renameHoleUnitId%27"><span class="hs-identifier">renameHoleUnitId'</span></a></a><span> </span><a name="local-6989586621680411971"><a href="#local-6989586621680411971"><span class="hs-identifier">pkg_map</span></a></a><span> </span><a name="local-6989586621680411972"><a href="#local-6989586621680411972"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621680411973"><a href="#local-6989586621680411973"><span class="hs-identifier">uid</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-970"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680411973"><span class="hs-identifier hs-var">uid</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-971"></a><span>      </span><span class="hs-special">(</span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span>
</span><a name="line-972"></a><span>        </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-var">IndefUnitId</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">indefUnitIdComponentId</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680411974"><a href="#local-6989586621680411974"><span class="hs-identifier">cid</span></a></a><span>
</span><a name="line-973"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">indefUnitIdInsts</span><span>       </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680411975"><a href="#local-6989586621680411975"><span class="hs-identifier">insts</span></a></a><span>
</span><a name="line-974"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">indefUnitIdFreeHoles</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680411976"><a href="#local-6989586621680411976"><span class="hs-identifier">fh</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-975"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="UniqFM.html#isNullUFM"><span class="hs-identifier hs-var">isNullUFM</span></a><span> </span><span class="hs-special">(</span><a href="UniqFM.html#intersectUFM_C"><span class="hs-identifier hs-var">intersectUFM_C</span></a><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><a href="UniqDFM.html#udfmToUfm"><span class="hs-identifier hs-var">udfmToUfm</span></a><span> </span><span class="hs-special">(</span><a href="UniqDSet.html#getUniqDSet"><span class="hs-identifier hs-var">getUniqDSet</span></a><span> </span><a href="#local-6989586621680411976"><span class="hs-identifier hs-var">fh</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680411972"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-976"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621680411973"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-977"></a><span>                </span><span class="hs-comment">-- Functorially apply the substitution to the instantiation,</span><span>
</span><a name="line-978"></a><span>                </span><span class="hs-comment">-- then check the 'PackageConfigMap' to see if there is</span><span>
</span><a name="line-979"></a><span>                </span><span class="hs-comment">-- a compiled version of this 'UnitId' we can improve to.</span><span>
</span><a name="line-980"></a><span>                </span><span class="hs-comment">-- See Note [UnitId to InstalledUnitId] improvement</span><span>
</span><a name="line-981"></a><span>                </span><span class="hs-keyword">else</span><span> </span><a href="Packages.html#improveUnitId"><span class="hs-identifier hs-var">improveUnitId</span></a><span> </span><a href="#local-6989586621680411971"><span class="hs-identifier hs-var">pkg_map</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-982"></a><span>                        </span><a href="Module.html#newUnitId"><span class="hs-identifier hs-var">newUnitId</span></a><span> </span><a href="#local-6989586621680411974"><span class="hs-identifier hs-var">cid</span></a><span>
</span><a name="line-983"></a><span>                            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621680411977"><a href="#local-6989586621680411977"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621680411978"><a href="#local-6989586621680411978"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680411977"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#renameHoleModule%27"><span class="hs-identifier hs-var">renameHoleModule'</span></a><span> </span><a href="#local-6989586621680411971"><span class="hs-identifier hs-var">pkg_map</span></a><span> </span><a href="#local-6989586621680411972"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621680411978"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680411975"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">)</span><span>
</span><a name="line-984"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411973"><span class="hs-identifier hs-var">uid</span></a><span>
</span><a name="line-985"></a><span>
</span><a name="line-986"></a><span class="hs-comment">-- | Given a possibly on-the-fly instantiated module, split it into</span><span>
</span><a name="line-987"></a><span class="hs-comment">-- a 'Module' that we definitely can find on-disk, as well as an</span><span>
</span><a name="line-988"></a><span class="hs-comment">-- instantiation if we need to instantiate it on the fly.  If the</span><span>
</span><a name="line-989"></a><span class="hs-comment">-- instantiation is @Nothing@ no on-the-fly renaming is needed.</span><span>
</span><a name="line-990"></a><span class="hs-identifier">splitModuleInsts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Module.html#IndefModule"><span class="hs-identifier hs-type">IndefModule</span></a><span class="hs-special">)</span><span>
</span><a name="line-991"></a><a name="splitModuleInsts"><a href="Module.html#splitModuleInsts"><span class="hs-identifier">splitModuleInsts</span></a></a><span> </span><a name="local-6989586621680411979"><a href="#local-6989586621680411979"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-992"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680411980"><a href="#local-6989586621680411980"><span class="hs-identifier">uid</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680411981"><a href="#local-6989586621680411981"><span class="hs-identifier">mb_iuid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#splitUnitIdInsts"><span class="hs-identifier hs-var">splitUnitIdInsts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-6989586621680411979"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-993"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-var">InstalledModule</span></a><span> </span><a href="#local-6989586621680411980"><span class="hs-identifier hs-var">uid</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621680411979"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-994"></a><span>        </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680411982"><a href="#local-6989586621680411982"><span class="hs-identifier">iuid</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#IndefModule"><span class="hs-identifier hs-var">IndefModule</span></a><span> </span><a href="#local-6989586621680411982"><span class="hs-identifier hs-var">iuid</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621680411979"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680411981"><span class="hs-identifier hs-var">mb_iuid</span></a><span class="hs-special">)</span><span>
</span><a name="line-995"></a><span>
</span><a name="line-996"></a><span class="hs-comment">-- | See 'splitModuleInsts'.</span><span>
</span><a name="line-997"></a><span class="hs-identifier">splitUnitIdInsts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span class="hs-special">)</span><span>
</span><a name="line-998"></a><a name="splitUnitIdInsts"><a href="Module.html#splitUnitIdInsts"><span class="hs-identifier">splitUnitIdInsts</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#IndefiniteUnitId"><span class="hs-identifier hs-var">IndefiniteUnitId</span></a><span> </span><a name="local-6989586621680411983"><a href="#local-6989586621680411983"><span class="hs-identifier">iuid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-999"></a><span>    </span><span class="hs-special">(</span><a href="Module.html#componentIdToInstalledUnitId"><span class="hs-identifier hs-var">componentIdToInstalledUnitId</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">indefUnitIdComponentId</span><span> </span><a href="#local-6989586621680411983"><span class="hs-identifier hs-var">iuid</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621680411983"><span class="hs-identifier hs-var">iuid</span></a><span class="hs-special">)</span><span>
</span><a name="line-1000"></a><span class="hs-identifier">splitUnitIdInsts</span><span> </span><span class="hs-special">(</span><a href="Module.html#DefiniteUnitId"><span class="hs-identifier hs-var">DefiniteUnitId</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#DefUnitId"><span class="hs-identifier hs-var">DefUnitId</span></a><span> </span><a name="local-6989586621680411984"><a href="#local-6989586621680411984"><span class="hs-identifier">uid</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680411984"><span class="hs-identifier hs-var">uid</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-1001"></a><span>
</span><a name="line-1002"></a><span class="hs-identifier">generalizeIndefUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-type">IndefUnitId</span></a><span>
</span><a name="line-1003"></a><a name="generalizeIndefUnitId"><a href="Module.html#generalizeIndefUnitId"><span class="hs-identifier">generalizeIndefUnitId</span></a></a><span> </span><a href="Module.html#IndefUnitId"><span class="hs-identifier hs-var">IndefUnitId</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">indefUnitIdComponentId</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680411985"><a href="#local-6989586621680411985"><span class="hs-identifier">cid</span></a></a><span>
</span><a name="line-1004"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">indefUnitIdInsts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680411986"><a href="#local-6989586621680411986"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1005"></a><span>    </span><a href="Module.html#newIndefUnitId"><span class="hs-identifier hs-var">newIndefUnitId</span></a><span> </span><a href="#local-6989586621680411985"><span class="hs-identifier hs-var">cid</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621680411987"><a href="#local-6989586621680411987"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680411987"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#mkHoleModule"><span class="hs-identifier hs-var">mkHoleModule</span></a><span> </span><a href="#local-6989586621680411987"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680411986"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1006"></a><span>
</span><a name="line-1007"></a><span class="hs-identifier">generalizeIndefModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#IndefModule"><span class="hs-identifier hs-type">IndefModule</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#IndefModule"><span class="hs-identifier hs-type">IndefModule</span></a><span>
</span><a name="line-1008"></a><a name="generalizeIndefModule"><a href="Module.html#generalizeIndefModule"><span class="hs-identifier">generalizeIndefModule</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#IndefModule"><span class="hs-identifier hs-var">IndefModule</span></a><span> </span><a name="local-6989586621680411988"><a href="#local-6989586621680411988"><span class="hs-identifier">uid</span></a></a><span> </span><a name="local-6989586621680411989"><a href="#local-6989586621680411989"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#IndefModule"><span class="hs-identifier hs-var">IndefModule</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#generalizeIndefUnitId"><span class="hs-identifier hs-var">generalizeIndefUnitId</span></a><span> </span><a href="#local-6989586621680411988"><span class="hs-identifier hs-var">uid</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680411989"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1009"></a><span>
</span><a name="line-1010"></a><span class="hs-identifier">parseModuleName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ReadP</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-1011"></a><a name="parseModuleName"><a href="Module.html#parseModuleName"><span class="hs-identifier">parseModuleName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Module.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a><span>
</span><a name="line-1012"></a><span>                </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Parse.munch1</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680411990"><a href="#local-6989586621680411990"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">isAlphaNum</span><span> </span><a href="#local-6989586621680411990"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621680411990"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;_.&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1013"></a><span>
</span><a name="line-1014"></a><span class="hs-identifier">parseUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ReadP</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-1015"></a><a name="parseUnitId"><a href="Module.html#parseUnitId"><span class="hs-identifier">parseUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680411991"><span class="hs-identifier hs-var">parseFullUnitId</span></a><span> </span><span class="hs-operator hs-var">&lt;++</span><span> </span><a href="#local-6989586621680411992"><span class="hs-identifier hs-var">parseDefiniteUnitId</span></a><span> </span><span class="hs-operator hs-var">&lt;++</span><span> </span><a href="#local-6989586621680411993"><span class="hs-identifier hs-var">parseSimpleUnitId</span></a><span>
</span><a name="line-1016"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1017"></a><span>    </span><a name="local-6989586621680411991"><a href="#local-6989586621680411991"><span class="hs-identifier">parseFullUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1018"></a><span>        </span><a name="local-6989586621680411994"><a href="#local-6989586621680411994"><span class="hs-identifier">cid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#parseComponentId"><span class="hs-identifier hs-var">parseComponentId</span></a><span>
</span><a name="line-1019"></a><span>        </span><a name="local-6989586621680411995"><a href="#local-6989586621680411995"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#parseModSubst"><span class="hs-identifier hs-var">parseModSubst</span></a><span>
</span><a name="line-1020"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Module.html#newUnitId"><span class="hs-identifier hs-var">newUnitId</span></a><span> </span><a href="#local-6989586621680411994"><span class="hs-identifier hs-var">cid</span></a><span> </span><a href="#local-6989586621680411995"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">)</span><span>
</span><a name="line-1021"></a><span>    </span><a name="local-6989586621680411992"><a href="#local-6989586621680411992"><span class="hs-identifier">parseDefiniteUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1022"></a><span>        </span><a name="local-6989586621680411997"><a href="#local-6989586621680411997"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Parse.munch1</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680411996"><a href="#local-6989586621680411996"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">isAlphaNum</span><span> </span><a href="#local-6989586621680411996"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621680411996"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;-_.+&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1023"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Module.html#stringToUnitId"><span class="hs-identifier hs-var">stringToUnitId</span></a><span> </span><a href="#local-6989586621680411997"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-1024"></a><span>    </span><a name="local-6989586621680411993"><a href="#local-6989586621680411993"><span class="hs-identifier">parseSimpleUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1025"></a><span>        </span><a name="local-6989586621680411998"><a href="#local-6989586621680411998"><span class="hs-identifier">cid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#parseComponentId"><span class="hs-identifier hs-var">parseComponentId</span></a><span>
</span><a name="line-1026"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Module.html#newSimpleUnitId"><span class="hs-identifier hs-var">newSimpleUnitId</span></a><span> </span><a href="#local-6989586621680411998"><span class="hs-identifier hs-var">cid</span></a><span class="hs-special">)</span><span>
</span><a name="line-1027"></a><span>
</span><a name="line-1028"></a><span class="hs-identifier">parseComponentId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ReadP</span><span> </span><a href="Module.html#ComponentId"><span class="hs-identifier hs-type">ComponentId</span></a><span>
</span><a name="line-1029"></a><a name="parseComponentId"><a href="Module.html#parseComponentId"><span class="hs-identifier">parseComponentId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Module.html#ComponentId"><span class="hs-identifier hs-var">ComponentId</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a><span class="hs-special">)</span><span>  </span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">Parse.munch1</span><span> </span><a href="#local-6989586621680411999"><span class="hs-identifier hs-var">abi_char</span></a><span>
</span><a name="line-1030"></a><span>   </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680411999"><a href="#local-6989586621680411999"><span class="hs-identifier">abi_char</span></a></a><span> </span><a name="local-6989586621680412000"><a href="#local-6989586621680412000"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isAlphaNum</span><span> </span><a href="#local-6989586621680412000"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621680412000"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;-_.&quot;</span><span>
</span><a name="line-1031"></a><span>
</span><a name="line-1032"></a><span class="hs-identifier">parseModuleId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ReadP</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-1033"></a><a name="parseModuleId"><a href="Module.html#parseModuleId"><span class="hs-identifier">parseModuleId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680412001"><span class="hs-identifier hs-var">parseModuleVar</span></a><span> </span><span class="hs-operator hs-var">&lt;++</span><span> </span><a href="#local-6989586621680412002"><span class="hs-identifier hs-var">parseModule</span></a><span>
</span><a name="line-1034"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1035"></a><span>      </span><a name="local-6989586621680412001"><a href="#local-6989586621680412001"><span class="hs-identifier">parseModuleVar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1036"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Parse.char</span><span> </span><span class="hs-char">'&lt;'</span><span>
</span><a name="line-1037"></a><span>        </span><a name="local-6989586621680412003"><a href="#local-6989586621680412003"><span class="hs-identifier">modname</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#parseModuleName"><span class="hs-identifier hs-var">parseModuleName</span></a><span>
</span><a name="line-1038"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Parse.char</span><span> </span><span class="hs-char">'&gt;'</span><span>
</span><a name="line-1039"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Module.html#mkHoleModule"><span class="hs-identifier hs-var">mkHoleModule</span></a><span> </span><a href="#local-6989586621680412003"><span class="hs-identifier hs-var">modname</span></a><span class="hs-special">)</span><span>
</span><a name="line-1040"></a><span>      </span><a name="local-6989586621680412002"><a href="#local-6989586621680412002"><span class="hs-identifier">parseModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1041"></a><span>        </span><a name="local-6989586621680412004"><a href="#local-6989586621680412004"><span class="hs-identifier">uid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#parseUnitId"><span class="hs-identifier hs-var">parseUnitId</span></a><span>
</span><a name="line-1042"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Parse.char</span><span> </span><span class="hs-char">':'</span><span>
</span><a name="line-1043"></a><span>        </span><a name="local-6989586621680412005"><a href="#local-6989586621680412005"><span class="hs-identifier">modname</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#parseModuleName"><span class="hs-identifier hs-var">parseModuleName</span></a><span>
</span><a name="line-1044"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span> </span><a href="#local-6989586621680412004"><span class="hs-identifier hs-var">uid</span></a><span> </span><a href="#local-6989586621680412005"><span class="hs-identifier hs-var">modname</span></a><span class="hs-special">)</span><span>
</span><a name="line-1045"></a><span>
</span><a name="line-1046"></a><span class="hs-identifier">parseModSubst</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ReadP</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1047"></a><a name="parseModSubst"><a href="Module.html#parseModSubst"><span class="hs-identifier">parseModSubst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Parse.between</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Parse.char</span><span> </span><span class="hs-char">'['</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Parse.char</span><span> </span><span class="hs-char">']'</span><span class="hs-special">)</span><span>
</span><a name="line-1048"></a><span>      </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">Parse.sepBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Parse.char</span><span> </span><span class="hs-char">','</span><span class="hs-special">)</span><span>
</span><a name="line-1049"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621680412006"><a href="#local-6989586621680412006"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#parseModuleName"><span class="hs-identifier hs-var">parseModuleName</span></a><span>
</span><a name="line-1050"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Parse.char</span><span> </span><span class="hs-char">'='</span><span>
</span><a name="line-1051"></a><span>           </span><a name="local-6989586621680412007"><a href="#local-6989586621680412007"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Module.html#parseModuleId"><span class="hs-identifier hs-var">parseModuleId</span></a><span>
</span><a name="line-1052"></a><span>           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680412006"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680412007"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1053"></a><span>
</span><a name="line-1054"></a><span>
</span><a name="line-1055"></a><span class="hs-comment">{-
Note [Wired-in packages]
~~~~~~~~~~~~~~~~~~~~~~~~

Certain packages are known to the compiler, in that we know about certain
entities that reside in these packages, and the compiler needs to
declare static Modules and Names that refer to these packages.  Hence
the wired-in packages can't include version numbers in their package UnitId,
since we don't want to bake the version numbers of these packages into GHC.

So here's the plan.  Wired-in packages are still versioned as
normal in the packages database, and you can still have multiple
versions of them installed. To the user, everything looks normal.

However, for each invocation of GHC, only a single instance of each wired-in
package will be recognised (the desired one is selected via
@-package@\/@-hide-package@), and GHC will internall pretend that it has the
*unversioned* 'UnitId', including in .hi files and object file symbols.

Unselected versions of wired-in packages will be ignored, as will any other
package that depends directly or indirectly on it (much as if you
had used @-ignore-package@).

The affected packages are compiled with, e.g., @-this-unit-id base@, so that
the symbols in the object files have the unversioned unit id in their name.

Make sure you change 'Packages.findWiredInPackages' if you add an entry here.

For `integer-gmp`/`integer-simple` we also change the base name to
`integer-wired-in`, but this is fundamentally no different.
See Note [The integer library] in PrelNames.
-}</span><span>
</span><a name="line-1087"></a><span>
</span><a name="line-1088"></a><span class="hs-identifier">integerUnitId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">primUnitId</span><span class="hs-special">,</span><span>
</span><a name="line-1089"></a><span>  </span><span class="hs-identifier">baseUnitId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rtsUnitId</span><span class="hs-special">,</span><span>
</span><a name="line-1090"></a><span>  </span><span class="hs-identifier">thUnitId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mainUnitId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">thisGhcUnitId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">interactiveUnitId</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-1091"></a><a name="primUnitId"><a href="Module.html#primUnitId"><span class="hs-identifier">primUnitId</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;ghc-prim&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1092"></a><a name="integerUnitId"><a href="Module.html#integerUnitId"><span class="hs-identifier">integerUnitId</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;integer-wired-in&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1093"></a><span>   </span><span class="hs-comment">-- See Note [The integer library] in PrelNames</span><span>
</span><a name="line-1094"></a><a name="baseUnitId"><a href="Module.html#baseUnitId"><span class="hs-identifier">baseUnitId</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;base&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1095"></a><a name="rtsUnitId"><a href="Module.html#rtsUnitId"><span class="hs-identifier">rtsUnitId</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;rts&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1096"></a><a name="thUnitId"><a href="Module.html#thUnitId"><span class="hs-identifier">thUnitId</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;template-haskell&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1097"></a><a name="thisGhcUnitId"><a href="Module.html#thisGhcUnitId"><span class="hs-identifier">thisGhcUnitId</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;ghc&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1098"></a><a name="interactiveUnitId"><a href="Module.html#interactiveUnitId"><span class="hs-identifier">interactiveUnitId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;interactive&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1099"></a><span>
</span><a name="line-1100"></a><span class="hs-comment">-- | This is the package Id for the current program.  It is the default</span><span>
</span><a name="line-1101"></a><span class="hs-comment">-- package Id if you don't specify a package name.  We don't add this prefix</span><span>
</span><a name="line-1102"></a><span class="hs-comment">-- to symbol names, since there can be only one main package per program.</span><span>
</span><a name="line-1103"></a><a name="mainUnitId"><a href="Module.html#mainUnitId"><span class="hs-identifier">mainUnitId</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;main&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1104"></a><span>
</span><a name="line-1105"></a><span class="hs-comment">-- | This is a fake package id used to provide identities to any un-implemented</span><span>
</span><a name="line-1106"></a><span class="hs-comment">-- signatures.  The set of hole identities is global over an entire compilation.</span><span>
</span><a name="line-1107"></a><span class="hs-comment">-- Don't use this directly: use 'mkHoleModule' or 'isHoleModule' instead.</span><span>
</span><a name="line-1108"></a><span class="hs-comment">-- See Note [Representation of module/name variables]</span><span>
</span><a name="line-1109"></a><span class="hs-identifier">holeUnitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-1110"></a><a name="holeUnitId"><a href="Module.html#holeUnitId"><span class="hs-identifier">holeUnitId</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#fsToUnitId"><span class="hs-identifier hs-var">fsToUnitId</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;hole&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1111"></a><span>
</span><a name="line-1112"></a><span class="hs-identifier">isInteractiveModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1113"></a><a name="isInteractiveModule"><a href="Module.html#isInteractiveModule"><span class="hs-identifier">isInteractiveModule</span></a></a><span> </span><a name="local-6989586621680412008"><a href="#local-6989586621680412008"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-6989586621680412008"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Module.html#interactiveUnitId"><span class="hs-identifier hs-var">interactiveUnitId</span></a><span>
</span><a name="line-1114"></a><span>
</span><a name="line-1115"></a><span class="hs-comment">-- Note [Representation of module/name variables]</span><span>
</span><a name="line-1116"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-1117"></a><span class="hs-comment">-- In our ICFP'16, we use &lt;A&gt; to represent module holes, and {A.T} to represent</span><span>
</span><a name="line-1118"></a><span class="hs-comment">-- name holes.  This could have been represented by adding some new cases</span><span>
</span><a name="line-1119"></a><span class="hs-comment">-- to the core data types, but this would have made the existing 'nameModule'</span><span>
</span><a name="line-1120"></a><span class="hs-comment">-- and 'moduleUnitId' partial, which would have required a lot of modifications</span><span>
</span><a name="line-1121"></a><span class="hs-comment">-- to existing code.</span><span>
</span><a name="line-1122"></a><span class="hs-comment">--</span><span>
</span><a name="line-1123"></a><span class="hs-comment">-- Instead, we adopted the following encoding scheme:</span><span>
</span><a name="line-1124"></a><span class="hs-comment">--</span><span>
</span><a name="line-1125"></a><span class="hs-comment">--      &lt;A&gt;   ===&gt; hole:A</span><span>
</span><a name="line-1126"></a><span class="hs-comment">--      {A.T} ===&gt; hole:A.T</span><span>
</span><a name="line-1127"></a><span class="hs-comment">--</span><span>
</span><a name="line-1128"></a><span class="hs-comment">-- This encoding is quite convenient, but it is also a bit dangerous too,</span><span>
</span><a name="line-1129"></a><span class="hs-comment">-- because if you have a 'hole:A' you need to know if it's actually a</span><span>
</span><a name="line-1130"></a><span class="hs-comment">-- 'Module' or just a module stored in a 'Name'; these two cases must be</span><span>
</span><a name="line-1131"></a><span class="hs-comment">-- treated differently when doing substitutions.  'renameHoleModule'</span><span>
</span><a name="line-1132"></a><span class="hs-comment">-- and 'renameHoleUnitId' assume they are NOT operating on a</span><span>
</span><a name="line-1133"></a><span class="hs-comment">-- 'Name'; 'NameShape' handles name substitutions exclusively.</span><span>
</span><a name="line-1134"></a><span>
</span><a name="line-1135"></a><span class="hs-identifier">isHoleModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1136"></a><a name="isHoleModule"><a href="Module.html#isHoleModule"><span class="hs-identifier">isHoleModule</span></a></a><span> </span><a name="local-6989586621680412009"><a href="#local-6989586621680412009"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-6989586621680412009"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Module.html#holeUnitId"><span class="hs-identifier hs-var">holeUnitId</span></a><span>
</span><a name="line-1137"></a><span>
</span><a name="line-1138"></a><span class="hs-identifier">wiredInUnitIds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>
</span><a name="line-1139"></a><a name="wiredInUnitIds"><a href="Module.html#wiredInUnitIds"><span class="hs-identifier">wiredInUnitIds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="Module.html#primUnitId"><span class="hs-identifier hs-var">primUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-1140"></a><span>                       </span><a href="Module.html#integerUnitId"><span class="hs-identifier hs-var">integerUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-1141"></a><span>                       </span><a href="Module.html#baseUnitId"><span class="hs-identifier hs-var">baseUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-1142"></a><span>                       </span><a href="Module.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-1143"></a><span>                       </span><a href="Module.html#thUnitId"><span class="hs-identifier hs-var">thUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-1144"></a><span>                       </span><a href="Module.html#thisGhcUnitId"><span class="hs-identifier hs-var">thisGhcUnitId</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1145"></a><span>
</span><a name="line-1146"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{@ModuleEnv@s}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1153"></a><span>
</span><a name="line-1154"></a><span class="hs-comment">-- | A map keyed off of 'Module's</span><span>
</span><a name="line-1155"></a><span class="hs-keyword">newtype</span><span> </span><a name="ModuleEnv"><a href="Module.html#ModuleEnv"><span class="hs-identifier">ModuleEnv</span></a></a><span> </span><a name="local-6989586621680411768"><a href="#local-6989586621680411768"><span class="hs-identifier">elt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ModuleEnv"><a href="Module.html#ModuleEnv"><span class="hs-identifier">ModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><a href="Module.html#NDModule"><span class="hs-identifier hs-type">NDModule</span></a><span> </span><a href="#local-6989586621680411768"><span class="hs-identifier hs-type">elt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1156"></a><span>
</span><a name="line-1157"></a><span class="hs-comment">{-
Note [ModuleEnv performance and determinism]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
To prevent accidental reintroduction of nondeterminism the Ord instance
for Module was changed to not depend on Unique ordering and to use the
lexicographic order. This is potentially expensive, but when measured
there was no difference in performance.

To be on the safe side and not pessimize ModuleEnv uses nondeterministic
ordering on Module and normalizes by doing the lexicographic sort when
turning the env to a list.
See Note [Unique Determinism] for more information about the source of
nondeterminismand and Note [Deterministic UniqFM] for explanation of why
it matters for maps.
-}</span><span>
</span><a name="line-1172"></a><span>
</span><a name="line-1173"></a><span class="hs-keyword">newtype</span><span> </span><a name="NDModule"><a href="Module.html#NDModule"><span class="hs-identifier">NDModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="NDModule"><a href="Module.html#NDModule"><span class="hs-identifier">NDModule</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unNDModule"><a href="Module.html#unNDModule"><span class="hs-identifier">unNDModule</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1174"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>
</span><a name="line-1175"></a><span>  </span><span class="hs-comment">-- A wrapper for Module with faster nondeterministic Ord.</span><span>
</span><a name="line-1176"></a><span>  </span><span class="hs-comment">-- Don't export, See [ModuleEnv performance and determinism]</span><span>
</span><a name="line-1177"></a><span>
</span><a name="line-1178"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="Module.html#NDModule"><span class="hs-identifier hs-type">NDModule</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1179"></a><span>  </span><a name="local-8214565720323790496"><span class="hs-identifier">compare</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a name="local-6989586621680411772"><a href="#local-6989586621680411772"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621680411773"><a href="#local-6989586621680411773"><span class="hs-identifier">n1</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-var">Module</span></a><span> </span><a name="local-6989586621680411774"><a href="#local-6989586621680411774"><span class="hs-identifier">p2</span></a></a><span> </span><a name="local-6989586621680411775"><a href="#local-6989586621680411775"><span class="hs-identifier">n2</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1180"></a><span>    </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680411772"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#nonDetCmpUnique"><span class="hs-identifier hs-var">nonDetCmpUnique</span></a><span class="hs-special">`</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680411774"><span class="hs-identifier hs-var">p2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span>
</span><a name="line-1181"></a><span>    </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680411773"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#nonDetCmpUnique"><span class="hs-identifier hs-var">nonDetCmpUnique</span></a><span class="hs-special">`</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680411775"><span class="hs-identifier hs-var">n2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1182"></a><span>
</span><a name="line-1183"></a><span class="hs-identifier">filterModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411882"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411882"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411882"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1184"></a><a name="filterModuleEnv"><a href="Module.html#filterModuleEnv"><span class="hs-identifier">filterModuleEnv</span></a></a><span> </span><a name="local-6989586621680412010"><a href="#local-6989586621680412010"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412011"><a href="#local-6989586621680412011"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1185"></a><span>  </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.filterWithKey</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680412010"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">unNDModule</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412011"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1186"></a><span>
</span><a name="line-1187"></a><span class="hs-identifier">elemModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411881"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1188"></a><a name="elemModuleEnv"><a href="Module.html#elemModuleEnv"><span class="hs-identifier">elemModuleEnv</span></a></a><span> </span><a name="local-6989586621680412012"><a href="#local-6989586621680412012"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412013"><a href="#local-6989586621680412013"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.member</span><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412012"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412013"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1189"></a><span>
</span><a name="line-1190"></a><span class="hs-identifier">extendModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411880"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411880"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411880"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1191"></a><a name="extendModuleEnv"><a href="Module.html#extendModuleEnv"><span class="hs-identifier">extendModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412014"><a href="#local-6989586621680412014"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680412015"><a href="#local-6989586621680412015"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680412016"><a href="#local-6989586621680412016"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.insert</span><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412015"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412016"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680412014"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1192"></a><span>
</span><a name="line-1193"></a><span class="hs-identifier">extendModuleEnvWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680411879"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411879"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411879"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411879"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411879"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1194"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411879"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1195"></a><a name="extendModuleEnvWith"><a href="Module.html#extendModuleEnvWith"><span class="hs-identifier">extendModuleEnvWith</span></a></a><span> </span><a name="local-6989586621680412017"><a href="#local-6989586621680412017"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412018"><a href="#local-6989586621680412018"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680412019"><a href="#local-6989586621680412019"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680412020"><a href="#local-6989586621680412020"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1196"></a><span>  </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.insertWith</span><span> </span><a href="#local-6989586621680412017"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412019"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412020"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621680412018"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1197"></a><span>
</span><a name="line-1198"></a><span class="hs-identifier">extendModuleEnvList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411878"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680411878"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411878"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1199"></a><a name="extendModuleEnvList"><a href="Module.html#extendModuleEnvList"><span class="hs-identifier">extendModuleEnvList</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412021"><a href="#local-6989586621680412021"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680412022"><a href="#local-6989586621680412022"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1200"></a><span>  </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><a href="FiniteMap.html#insertList"><span class="hs-identifier hs-var">Map.insertList</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412023"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680412024"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680412023"><a href="#local-6989586621680412023"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621680412024"><a href="#local-6989586621680412024"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680412022"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621680412021"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1201"></a><span>
</span><a name="line-1202"></a><span class="hs-identifier">extendModuleEnvList_C</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680411877"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411877"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411877"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411877"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680411877"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1203"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411877"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1204"></a><a name="extendModuleEnvList_C"><a href="Module.html#extendModuleEnvList_C"><span class="hs-identifier">extendModuleEnvList_C</span></a></a><span> </span><a name="local-6989586621680412025"><a href="#local-6989586621680412025"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412026"><a href="#local-6989586621680412026"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680412027"><a href="#local-6989586621680412027"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1205"></a><span>  </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><a href="FiniteMap.html#insertListWith"><span class="hs-identifier hs-var">Map.insertListWith</span></a><span> </span><a href="#local-6989586621680412025"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412028"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680412029"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680412028"><a href="#local-6989586621680412028"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621680412029"><a href="#local-6989586621680412029"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680412027"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621680412026"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1206"></a><span>
</span><a name="line-1207"></a><span class="hs-identifier">plusModuleEnv_C</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680411876"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411876"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411876"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411876"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411876"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411876"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1208"></a><a name="plusModuleEnv_C"><a href="Module.html#plusModuleEnv_C"><span class="hs-identifier">plusModuleEnv_C</span></a></a><span> </span><a name="local-6989586621680412030"><a href="#local-6989586621680412030"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412031"><a href="#local-6989586621680412031"><span class="hs-identifier">e1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412032"><a href="#local-6989586621680412032"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1209"></a><span>  </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.unionWith</span><span> </span><a href="#local-6989586621680412030"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680412031"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-6989586621680412032"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1210"></a><span>
</span><a name="line-1211"></a><span class="hs-identifier">delModuleEnvList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411875"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411875"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1212"></a><a name="delModuleEnvList"><a href="Module.html#delModuleEnvList"><span class="hs-identifier">delModuleEnvList</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412033"><a href="#local-6989586621680412033"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680412034"><a href="#local-6989586621680412034"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1213"></a><span>  </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><a href="FiniteMap.html#deleteList"><span class="hs-identifier hs-var">Map.deleteList</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412034"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412033"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1214"></a><span>
</span><a name="line-1215"></a><span class="hs-identifier">delModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411874"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411874"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1216"></a><a name="delModuleEnv"><a href="Module.html#delModuleEnv"><span class="hs-identifier">delModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412035"><a href="#local-6989586621680412035"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680412036"><a href="#local-6989586621680412036"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.delete</span><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412036"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412035"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span>
</span><a name="line-1218"></a><span class="hs-identifier">plusModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411873"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411873"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411873"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1219"></a><a name="plusModuleEnv"><a href="Module.html#plusModuleEnv"><span class="hs-identifier">plusModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412037"><a href="#local-6989586621680412037"><span class="hs-identifier">e1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412038"><a href="#local-6989586621680412038"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.union</span><span> </span><a href="#local-6989586621680412037"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-6989586621680412038"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1220"></a><span>
</span><a name="line-1221"></a><span class="hs-identifier">lookupModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411872"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621680411872"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1222"></a><a name="lookupModuleEnv"><a href="Module.html#lookupModuleEnv"><span class="hs-identifier">lookupModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412039"><a href="#local-6989586621680412039"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680412040"><a href="#local-6989586621680412040"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412040"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412039"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1223"></a><span>
</span><a name="line-1224"></a><span class="hs-identifier">lookupWithDefaultModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411871"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411871"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411871"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1225"></a><a name="lookupWithDefaultModuleEnv"><a href="Module.html#lookupWithDefaultModuleEnv"><span class="hs-identifier">lookupWithDefaultModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412041"><a href="#local-6989586621680412041"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680412042"><a href="#local-6989586621680412042"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621680412043"><a href="#local-6989586621680412043"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1226"></a><span>  </span><span class="hs-identifier hs-var">Map.findWithDefault</span><span> </span><a href="#local-6989586621680412042"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412043"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412041"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1227"></a><span>
</span><a name="line-1228"></a><span class="hs-identifier">mapModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680411869"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411870"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411869"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411870"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-1229"></a><a name="mapModuleEnv"><a href="Module.html#mapModuleEnv"><span class="hs-identifier">mapModuleEnv</span></a></a><span> </span><a name="local-6989586621680412044"><a href="#local-6989586621680412044"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412045"><a href="#local-6989586621680412045"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.mapWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680412046"><a href="#local-6989586621680412046"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680412044"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680412046"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412045"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1230"></a><span>
</span><a name="line-1231"></a><span class="hs-identifier">mkModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680411868"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411868"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1232"></a><a name="mkModuleEnv"><a href="Module.html#mkModuleEnv"><span class="hs-identifier">mkModuleEnv</span></a></a><span> </span><a name="local-6989586621680412047"><a href="#local-6989586621680412047"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412048"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680412049"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680412048"><a href="#local-6989586621680412048"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621680412049"><a href="#local-6989586621680412049"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680412047"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1233"></a><span>
</span><a name="line-1234"></a><span class="hs-identifier">emptyModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411867"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1235"></a><a name="emptyModuleEnv"><a href="Module.html#emptyModuleEnv"><span class="hs-identifier">emptyModuleEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-identifier hs-var">Map.empty</span><span>
</span><a name="line-1236"></a><span>
</span><a name="line-1237"></a><span class="hs-identifier">moduleEnvKeys</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411866"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">]</span><span>
</span><a name="line-1238"></a><a name="moduleEnvKeys"><a href="Module.html#moduleEnvKeys"><span class="hs-identifier">moduleEnvKeys</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412050"><a href="#local-6989586621680412050"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">unNDModule</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map.keys</span><span> </span><a href="#local-6989586621680412050"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1239"></a><span>  </span><span class="hs-comment">-- See Note [ModuleEnv performance and determinism]</span><span>
</span><a name="line-1240"></a><span>
</span><a name="line-1241"></a><span class="hs-identifier">moduleEnvElts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411865"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680411865"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-1242"></a><a name="moduleEnvElts"><a href="Module.html#moduleEnvElts"><span class="hs-identifier">moduleEnvElts</span></a></a><span> </span><a name="local-6989586621680412051"><a href="#local-6989586621680412051"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Module.html#moduleEnvToList"><span class="hs-identifier hs-var">moduleEnvToList</span></a><span> </span><a href="#local-6989586621680412051"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1243"></a><span>  </span><span class="hs-comment">-- See Note [ModuleEnv performance and determinism]</span><span>
</span><a name="line-1244"></a><span>
</span><a name="line-1245"></a><span class="hs-identifier">moduleEnvToList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411864"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680411864"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1246"></a><a name="moduleEnvToList"><a href="Module.html#moduleEnvToList"><span class="hs-identifier">moduleEnvToList</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412052"><a href="#local-6989586621680412052"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1247"></a><span>  </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">comparing</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680412053"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680412054"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a name="local-6989586621680412053"><a href="#local-6989586621680412053"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680412054"><a href="#local-6989586621680412054"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Map.toList</span><span> </span><a href="#local-6989586621680412052"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">]</span><span>
</span><a name="line-1248"></a><span>  </span><span class="hs-comment">-- See Note [ModuleEnv performance and determinism]</span><span>
</span><a name="line-1249"></a><span>
</span><a name="line-1250"></a><span class="hs-identifier">unitModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680411863"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411863"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1251"></a><a name="unitModuleEnv"><a href="Module.html#unitModuleEnv"><span class="hs-identifier">unitModuleEnv</span></a></a><span> </span><a name="local-6989586621680412055"><a href="#local-6989586621680412055"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680412056"><a href="#local-6989586621680412056"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.singleton</span><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412055"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412056"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1252"></a><span>
</span><a name="line-1253"></a><span class="hs-identifier">isEmptyModuleEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="#local-6989586621680411862"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1254"></a><a name="isEmptyModuleEnv"><a href="Module.html#isEmptyModuleEnv"><span class="hs-identifier">isEmptyModuleEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-var">ModuleEnv</span></a><span> </span><a name="local-6989586621680412057"><a href="#local-6989586621680412057"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.null</span><span> </span><a href="#local-6989586621680412057"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1255"></a><span>
</span><a name="line-1256"></a><span class="hs-comment">-- | A set of 'Module's</span><span>
</span><a name="line-1257"></a><span class="hs-keyword">type</span><span> </span><a name="ModuleSet"><a href="Module.html#ModuleSet"><span class="hs-identifier">ModuleSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><a href="Module.html#NDModule"><span class="hs-identifier hs-type">NDModule</span></a><span>
</span><a name="line-1258"></a><span>
</span><a name="line-1259"></a><span class="hs-identifier">mkModuleSet</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-1260"></a><a name="mkModuleSet"><a href="Module.html#mkModuleSet"><span class="hs-identifier">mkModuleSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.fromList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerce</span><span>
</span><a name="line-1261"></a><span>
</span><a name="line-1262"></a><span class="hs-identifier">extendModuleSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-1263"></a><a name="extendModuleSet"><a href="Module.html#extendModuleSet"><span class="hs-identifier">extendModuleSet</span></a></a><span> </span><a name="local-6989586621680412058"><a href="#local-6989586621680412058"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621680412059"><a href="#local-6989586621680412059"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.insert</span><span> </span><span class="hs-special">(</span><a href="Module.html#NDModule"><span class="hs-identifier hs-var">NDModule</span></a><span> </span><a href="#local-6989586621680412059"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412058"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1264"></a><span>
</span><a name="line-1265"></a><span class="hs-identifier">extendModuleSetList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-1266"></a><a name="extendModuleSetList"><a href="Module.html#extendModuleSetList"><span class="hs-identifier">extendModuleSetList</span></a></a><span> </span><a name="local-6989586621680412060"><a href="#local-6989586621680412060"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621680412061"><a href="#local-6989586621680412061"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">Set.insert</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680412060"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621680412061"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-1267"></a><span>
</span><a name="line-1268"></a><span class="hs-identifier">emptyModuleSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-1269"></a><a name="emptyModuleSet"><a href="Module.html#emptyModuleSet"><span class="hs-identifier">emptyModuleSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.empty</span><span>
</span><a name="line-1270"></a><span>
</span><a name="line-1271"></a><span class="hs-identifier">moduleSetElts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">]</span><span>
</span><a name="line-1272"></a><a name="moduleSetElts"><a href="Module.html#moduleSetElts"><span class="hs-identifier">moduleSetElts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Set.toList</span><span>
</span><a name="line-1273"></a><span>
</span><a name="line-1274"></a><span class="hs-identifier">elemModuleSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1275"></a><a name="elemModuleSet"><a href="Module.html#elemModuleSet"><span class="hs-identifier">elemModuleSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.member</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">coerce</span><span>
</span><a name="line-1276"></a><span>
</span><a name="line-1277"></a><span class="hs-identifier">intersectModuleSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-1278"></a><a name="intersectModuleSet"><a href="Module.html#intersectModuleSet"><span class="hs-identifier">intersectModuleSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-identifier hs-var">Set.intersection</span><span>
</span><a name="line-1279"></a><span>
</span><a name="line-1280"></a><span class="hs-identifier">minusModuleSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-1281"></a><a name="minusModuleSet"><a href="Module.html#minusModuleSet"><span class="hs-identifier">minusModuleSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-identifier hs-var">Set.difference</span><span>
</span><a name="line-1282"></a><span>
</span><a name="line-1283"></a><span class="hs-identifier">delModuleSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-1284"></a><a name="delModuleSet"><a href="Module.html#delModuleSet"><span class="hs-identifier">delModuleSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">Set.delete</span><span class="hs-special">)</span><span>
</span><a name="line-1285"></a><span>
</span><a name="line-1286"></a><span class="hs-identifier">unionModuleSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-1287"></a><a name="unionModuleSet"><a href="Module.html#unionModuleSet"><span class="hs-identifier">unionModuleSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-identifier hs-var">Set.union</span><span>
</span><a name="line-1288"></a><span>
</span><a name="line-1289"></a><span class="hs-identifier">unitModuleSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-1290"></a><a name="unitModuleSet"><a href="Module.html#unitModuleSet"><span class="hs-identifier">unitModuleSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">coerce</span><span> </span><span class="hs-identifier hs-var">Set.singleton</span><span>
</span><a name="line-1291"></a><span>
</span><a name="line-1292"></a><span class="hs-comment">{-
A ModuleName has a Unique, so we can build mappings of these using
UniqFM.
-}</span><span>
</span><a name="line-1296"></a><span>
</span><a name="line-1297"></a><span class="hs-comment">-- | A map keyed off of 'ModuleName's (actually, their 'Unique's)</span><span>
</span><a name="line-1298"></a><span class="hs-keyword">type</span><span> </span><a name="ModuleNameEnv"><a href="Module.html#ModuleNameEnv"><span class="hs-identifier">ModuleNameEnv</span></a></a><span> </span><a name="local-6989586621680411767"><a href="#local-6989586621680411767"><span class="hs-identifier">elt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><a href="#local-6989586621680411767"><span class="hs-identifier hs-type">elt</span></a><span>
</span><a name="line-1299"></a><span>
</span><a name="line-1300"></a><span>
</span><a name="line-1301"></a><span class="hs-comment">-- | A map keyed off of 'ModuleName's (actually, their 'Unique's)</span><span>
</span><a name="line-1302"></a><span class="hs-comment">-- Has deterministic folds and can be deterministically converted to a list</span><span>
</span><a name="line-1303"></a><span class="hs-keyword">type</span><span> </span><a name="DModuleNameEnv"><a href="Module.html#DModuleNameEnv"><span class="hs-identifier">DModuleNameEnv</span></a></a><span> </span><a name="local-6989586621680411766"><a href="#local-6989586621680411766"><span class="hs-identifier">elt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#UniqDFM"><span class="hs-identifier hs-type">UniqDFM</span></a><span> </span><a href="#local-6989586621680411766"><span class="hs-identifier hs-type">elt</span></a><span>
</span><a name="line-1304"></a></pre></body></html>