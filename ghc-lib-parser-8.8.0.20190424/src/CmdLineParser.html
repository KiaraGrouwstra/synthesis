<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-4"></a><span class="hs-comment">--</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- | Command-line parser</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- This is an abstract command-line parser used by DynFlags.</span><span>
</span><a name="line-8"></a><span class="hs-comment">--</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- (c) The University of Glasgow 2005</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">CmdLineParser</span><span>
</span><a name="line-14"></a><span>    </span><span class="hs-special">(</span><span>
</span><a name="line-15"></a><span>      </span><a href="CmdLineParser.html#processArgs"><span class="hs-identifier hs-var">processArgs</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#OptKind"><span class="hs-identifier hs-type">OptKind</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#GhcFlagMode"><span class="hs-identifier hs-type">GhcFlagMode</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>      </span><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier hs-type">CmdLineP</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#getCmdLineState"><span class="hs-identifier hs-var">getCmdLineState</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#putCmdLineState"><span class="hs-identifier hs-var">putCmdLineState</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>      </span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#defFlag"><span class="hs-identifier hs-var">defFlag</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#defGhcFlag"><span class="hs-identifier hs-var">defGhcFlag</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#defGhciFlag"><span class="hs-identifier hs-var">defGhciFlag</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#defHiddenFlag"><span class="hs-identifier hs-var">defHiddenFlag</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>      </span><a href="CmdLineParser.html#errorsToGhcException"><span class="hs-identifier hs-var">errorsToGhcException</span></a><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span>      </span><a href="CmdLineParser.html#Err"><span class="hs-identifier hs-type">Err</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#Warn"><span class="hs-identifier hs-type">Warn</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>      </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#runEwM"><span class="hs-identifier hs-var">runEwM</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#addFlagWarn"><span class="hs-identifier hs-var">addFlagWarn</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#getArg"><span class="hs-identifier hs-var">getArg</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#getCurLoc"><span class="hs-identifier hs-var">getCurLoc</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#liftEwM"><span class="hs-identifier hs-var">liftEwM</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>      </span><a href="CmdLineParser.html#deprecate"><span class="hs-identifier hs-var">deprecate</span></a><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="Panic.html"><span class="hs-identifier">Panic</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="Json.html"><span class="hs-identifier">Json</span></a><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Function</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ap</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-43"></a><span class="hs-comment">--         The Flag and OptKind types</span><span>
</span><a name="line-44"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">data</span><span> </span><a name="Flag"><a href="CmdLineParser.html#Flag"><span class="hs-identifier">Flag</span></a></a><span> </span><a name="local-6989586621680538096"><a href="#local-6989586621680538096"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Flag"><a href="CmdLineParser.html#Flag"><span class="hs-identifier">Flag</span></a></a><span>
</span><a name="line-47"></a><span>    </span><span class="hs-special">{</span><span>   </span><a name="flagName"><a href="CmdLineParser.html#flagName"><span class="hs-identifier">flagName</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Flag, without the leading &quot;-&quot;</span><span>
</span><a name="line-48"></a><span>        </span><a name="flagOptKind"><a href="CmdLineParser.html#flagOptKind"><span class="hs-identifier">flagOptKind</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmdLineParser.html#OptKind"><span class="hs-identifier hs-type">OptKind</span></a><span> </span><a href="#local-6989586621680538096"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- What to do if we see it</span><span>
</span><a name="line-49"></a><span>        </span><a name="flagGhcMode"><a href="CmdLineParser.html#flagGhcMode"><span class="hs-identifier">flagGhcMode</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmdLineParser.html#GhcFlagMode"><span class="hs-identifier hs-type">GhcFlagMode</span></a><span>    </span><span class="hs-comment">-- Which modes this flag affects</span><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-identifier">defFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#OptKind"><span class="hs-identifier hs-type">OptKind</span></a><span> </span><a href="#local-6989586621680538144"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="#local-6989586621680538144"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-53"></a><a name="defFlag"><a href="CmdLineParser.html#defFlag"><span class="hs-identifier">defFlag</span></a></a><span> </span><a name="local-6989586621680538145"><a href="#local-6989586621680538145"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621680538146"><a href="#local-6989586621680538146"><span class="hs-identifier">optKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><a href="#local-6989586621680538145"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680538146"><span class="hs-identifier hs-var">optKind</span></a><span> </span><a href="CmdLineParser.html#AllModes"><span class="hs-identifier hs-var">AllModes</span></a><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-identifier">defGhcFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#OptKind"><span class="hs-identifier hs-type">OptKind</span></a><span> </span><a href="#local-6989586621680538143"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="#local-6989586621680538143"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-56"></a><a name="defGhcFlag"><a href="CmdLineParser.html#defGhcFlag"><span class="hs-identifier">defGhcFlag</span></a></a><span> </span><a name="local-6989586621680538147"><a href="#local-6989586621680538147"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621680538148"><a href="#local-6989586621680538148"><span class="hs-identifier">optKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><a href="#local-6989586621680538147"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680538148"><span class="hs-identifier hs-var">optKind</span></a><span> </span><a href="CmdLineParser.html#OnlyGhc"><span class="hs-identifier hs-var">OnlyGhc</span></a><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-identifier">defGhciFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#OptKind"><span class="hs-identifier hs-type">OptKind</span></a><span> </span><a href="#local-6989586621680538142"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="#local-6989586621680538142"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-59"></a><a name="defGhciFlag"><a href="CmdLineParser.html#defGhciFlag"><span class="hs-identifier">defGhciFlag</span></a></a><span> </span><a name="local-6989586621680538149"><a href="#local-6989586621680538149"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621680538150"><a href="#local-6989586621680538150"><span class="hs-identifier">optKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><a href="#local-6989586621680538149"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680538150"><span class="hs-identifier hs-var">optKind</span></a><span> </span><a href="CmdLineParser.html#OnlyGhci"><span class="hs-identifier hs-var">OnlyGhci</span></a><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-identifier">defHiddenFlag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#OptKind"><span class="hs-identifier hs-type">OptKind</span></a><span> </span><a href="#local-6989586621680538141"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="#local-6989586621680538141"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-62"></a><a name="defHiddenFlag"><a href="CmdLineParser.html#defHiddenFlag"><span class="hs-identifier">defHiddenFlag</span></a></a><span> </span><a name="local-6989586621680538151"><a href="#local-6989586621680538151"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621680538152"><a href="#local-6989586621680538152"><span class="hs-identifier">optKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-var">Flag</span></a><span> </span><a href="#local-6989586621680538151"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621680538152"><span class="hs-identifier hs-var">optKind</span></a><span> </span><a href="CmdLineParser.html#HiddenFlag"><span class="hs-identifier hs-var">HiddenFlag</span></a><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">-- | GHC flag modes describing when a flag has an effect.</span><span>
</span><a name="line-65"></a><span class="hs-keyword">data</span><span> </span><a name="GhcFlagMode"><a href="CmdLineParser.html#GhcFlagMode"><span class="hs-identifier">GhcFlagMode</span></a></a><span>
</span><a name="line-66"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="OnlyGhc"><a href="CmdLineParser.html#OnlyGhc"><span class="hs-identifier">OnlyGhc</span></a></a><span>  </span><span class="hs-comment">-- ^ The flag only affects the non-interactive GHC</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="OnlyGhci"><a href="CmdLineParser.html#OnlyGhci"><span class="hs-identifier">OnlyGhci</span></a></a><span> </span><span class="hs-comment">-- ^ The flag only affects the interactive GHC</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="AllModes"><a href="CmdLineParser.html#AllModes"><span class="hs-identifier">AllModes</span></a></a><span> </span><span class="hs-comment">-- ^ The flag affects multiple ghc modes</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="HiddenFlag"><a href="CmdLineParser.html#HiddenFlag"><span class="hs-identifier">HiddenFlag</span></a></a><span> </span><span class="hs-comment">-- ^ This flag should not be seen in cli completion</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-keyword">data</span><span> </span><a name="OptKind"><a href="CmdLineParser.html#OptKind"><span class="hs-identifier">OptKind</span></a></a><span> </span><a name="local-6989586621680538095"><a href="#local-6989586621680538095"><span class="hs-identifier">m</span></a></a><span>                             </span><span class="hs-comment">-- Suppose the flag is -f</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="NoArg"><a href="CmdLineParser.html#NoArg"><span class="hs-identifier">NoArg</span></a></a><span>     </span><span class="hs-special">(</span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- -f all by itself</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="HasArg"><a href="CmdLineParser.html#HasArg"><span class="hs-identifier">HasArg</span></a></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- -farg or -f arg</span><span>
</span><a name="line-74"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="SepArg"><a href="CmdLineParser.html#SepArg"><span class="hs-identifier">SepArg</span></a></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- -f arg</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Prefix"><a href="CmdLineParser.html#Prefix"><span class="hs-identifier">Prefix</span></a></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- -farg</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="OptPrefix"><a href="CmdLineParser.html#OptPrefix"><span class="hs-identifier">OptPrefix</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- -f or -farg (i.e. the arg is optional)</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="OptIntSuffix"><a href="CmdLineParser.html#OptIntSuffix"><span class="hs-identifier">OptIntSuffix</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- -f or -f=n; pass n to fn</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="IntSuffix"><a href="CmdLineParser.html#IntSuffix"><span class="hs-identifier">IntSuffix</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>          </span><span class="hs-comment">-- -f or -f=n; pass n to fn</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="FloatSuffix"><a href="CmdLineParser.html#FloatSuffix"><span class="hs-identifier">FloatSuffix</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Float</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- -f or -f=n; pass n to fn</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="PassFlag"><a href="CmdLineParser.html#PassFlag"><span class="hs-identifier">PassFlag</span></a></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- -f; pass &quot;-f&quot; fn</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="AnySuffix"><a href="CmdLineParser.html#AnySuffix"><span class="hs-identifier">AnySuffix</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538095"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- -f or -farg; pass entire &quot;-farg&quot; to fn</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-85"></a><span class="hs-comment">--         The EwM monad</span><span>
</span><a name="line-86"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">-- | Used when filtering warnings: if a reason is given</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- it can be filtered out when displaying.</span><span>
</span><a name="line-90"></a><span class="hs-keyword">data</span><span> </span><a name="WarnReason"><a href="CmdLineParser.html#WarnReason"><span class="hs-identifier">WarnReason</span></a></a><span>
</span><a name="line-91"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NoReason"><a href="CmdLineParser.html#NoReason"><span class="hs-identifier">NoReason</span></a></a><span>
</span><a name="line-92"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ReasonDeprecatedFlag"><a href="CmdLineParser.html#ReasonDeprecatedFlag"><span class="hs-identifier">ReasonDeprecatedFlag</span></a></a><span>
</span><a name="line-93"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ReasonUnrecognisedFlag"><a href="CmdLineParser.html#ReasonUnrecognisedFlag"><span class="hs-identifier">ReasonUnrecognisedFlag</span></a></a><span>
</span><a name="line-94"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CmdLineParser.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-97"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-keyword">instance</span><span> </span><a href="Json.html#ToJson"><span class="hs-identifier hs-type">ToJson</span></a><span> </span><a href="CmdLineParser.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-100"></a><span>  </span><a name="local-8214565720324958899"><a href="Json.html#json"><span class="hs-identifier">json</span></a></a><span> </span><a href="CmdLineParser.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Json.html#JSNull"><span class="hs-identifier hs-var">JSNull</span></a><span>
</span><a name="line-101"></a><span>  </span><span class="hs-identifier">json</span><span> </span><a name="local-6989586621680538121"><a href="#local-6989586621680538121"><span class="hs-identifier">reason</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Json.html#JSString"><span class="hs-identifier hs-var">JSString</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621680538121"><span class="hs-identifier hs-var">reason</span></a><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-comment">-- | A command-line error message</span><span>
</span><a name="line-104"></a><span class="hs-keyword">newtype</span><span> </span><a name="Err"><a href="CmdLineParser.html#Err"><span class="hs-identifier">Err</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Err"><a href="CmdLineParser.html#Err"><span class="hs-identifier">Err</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="errMsg"><a href="CmdLineParser.html#errMsg"><span class="hs-identifier">errMsg</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">-- | A command-line warning message and the reason it arose</span><span>
</span><a name="line-107"></a><span class="hs-keyword">data</span><span> </span><a name="Warn"><a href="CmdLineParser.html#Warn"><span class="hs-identifier">Warn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Warn"><a href="CmdLineParser.html#Warn"><span class="hs-identifier">Warn</span></a></a><span>
</span><a name="line-108"></a><span>  </span><span class="hs-special">{</span><span>   </span><a name="warnReason"><a href="CmdLineParser.html#warnReason"><span class="hs-identifier">warnReason</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmdLineParser.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>      </span><a name="warnMsg"><a href="CmdLineParser.html#warnMsg"><span class="hs-identifier">warnMsg</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-110"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-keyword">type</span><span> </span><a name="Errs"><a href="CmdLineParser.html#Errs"><span class="hs-identifier">Errs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="CmdLineParser.html#Err"><span class="hs-identifier hs-type">Err</span></a><span>
</span><a name="line-113"></a><span class="hs-keyword">type</span><span> </span><a name="Warns"><a href="CmdLineParser.html#Warns"><span class="hs-identifier">Warns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="CmdLineParser.html#Warn"><span class="hs-identifier hs-type">Warn</span></a><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">-- EwM (&quot;errors and warnings monad&quot;) is a monad</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- transformer for m that adds an (err, warn) state</span><span>
</span><a name="line-117"></a><span class="hs-keyword">newtype</span><span> </span><a name="EwM"><a href="CmdLineParser.html#EwM"><span class="hs-identifier">EwM</span></a></a><span> </span><a name="local-6989586621680538093"><a href="#local-6989586621680538093"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680538094"><a href="#local-6989586621680538094"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="EwM"><a href="CmdLineParser.html#EwM"><span class="hs-identifier">EwM</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unEwM"><a href="CmdLineParser.html#unEwM"><span class="hs-identifier">unEwM</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- Current parse arg</span><span>
</span><a name="line-118"></a><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#Errs"><span class="hs-identifier hs-type">Errs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#Warns"><span class="hs-identifier hs-type">Warns</span></a><span>
</span><a name="line-119"></a><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680538093"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#Errs"><span class="hs-identifier hs-type">Errs</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#Warns"><span class="hs-identifier hs-type">Warns</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538094"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538120"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538120"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-122"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538116"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538116"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-125"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621680538117"><a href="#local-6989586621680538117"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-var">EwM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680538118"><a href="#local-6989586621680538118"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621680538119"><a href="#local-6989586621680538119"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538118"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538119"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538117"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538107"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538107"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-129"></a><span>    </span><span class="hs-special">(</span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-var">EwM</span></a><span> </span><a name="local-6989586621680538108"><a href="#local-6989586621680538108"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621680538109"><a href="#local-6989586621680538109"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-var">EwM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621680538110"><a href="#local-6989586621680538110"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621680538111"><a href="#local-6989586621680538111"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621680538112"><a href="#local-6989586621680538112"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680538113"><a href="#local-6989586621680538113"><span class="hs-identifier">e'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680538114"><a href="#local-6989586621680538114"><span class="hs-identifier">w'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680538115"><a href="#local-6989586621680538115"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680538108"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538110"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621680538111"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621680538112"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-130"></a><span>                                      </span><span class="hs-identifier">unEwM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538109"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621680538115"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680538110"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621680538113"><span class="hs-identifier hs-var">e'</span></a><span> </span><a href="#local-6989586621680538114"><span class="hs-identifier hs-var">w'</span></a><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-identifier">runEwM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538139"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680538140"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680538139"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#Errs"><span class="hs-identifier hs-type">Errs</span></a><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#Warns"><span class="hs-identifier hs-type">Warns</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538140"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><a name="runEwM"><a href="CmdLineParser.html#runEwM"><span class="hs-identifier">runEwM</span></a></a><span> </span><a name="local-6989586621680538153"><a href="#local-6989586621680538153"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unEwM</span><span> </span><a href="#local-6989586621680538153"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-special">(</span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;processArgs: no arg yet&quot;</span><span class="hs-special">)</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-identifier">setArg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538138"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538138"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-136"></a><a name="setArg"><a href="CmdLineParser.html#setArg"><span class="hs-identifier">setArg</span></a></a><span> </span><a name="local-6989586621680538154"><a href="#local-6989586621680538154"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-var">EwM</span></a><span> </span><a name="local-6989586621680538155"><a href="#local-6989586621680538155"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-var">EwM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680538156"><a href="#local-6989586621680538156"><span class="hs-identifier">es</span></a></a><span> </span><a name="local-6989586621680538157"><a href="#local-6989586621680538157"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680538155"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538154"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621680538156"><span class="hs-identifier hs-var">es</span></a><span> </span><a href="#local-6989586621680538157"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-identifier">addErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538137"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538137"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-139"></a><a name="addErr"><a href="CmdLineParser.html#addErr"><span class="hs-identifier">addErr</span></a></a><span> </span><a name="local-6989586621680538158"><a href="#local-6989586621680538158"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-var">EwM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621680538159"><a href="#local-6989586621680538159"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680538160"><a href="#local-6989586621680538160"><span class="hs-identifier">es</span></a></a><span> </span><a name="local-6989586621680538161"><a href="#local-6989586621680538161"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538160"><span class="hs-identifier hs-var">es</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#snocBag"><span class="hs-identifier hs-var">snocBag</span></a><span class="hs-special">`</span><span> </span><a href="CmdLineParser.html#Err"><span class="hs-identifier hs-var">Err</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621680538159"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621680538158"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538161"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-identifier">addWarn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538136"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538136"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-142"></a><a name="addWarn"><a href="CmdLineParser.html#addWarn"><span class="hs-identifier">addWarn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#addFlagWarn"><span class="hs-identifier hs-var">addFlagWarn</span></a><span> </span><a href="CmdLineParser.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-identifier">addFlagWarn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538135"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="CmdLineParser.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538135"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><a name="addFlagWarn"><a href="CmdLineParser.html#addFlagWarn"><span class="hs-identifier">addFlagWarn</span></a></a><span> </span><a name="local-6989586621680538162"><a href="#local-6989586621680538162"><span class="hs-identifier">reason</span></a></a><span> </span><a name="local-6989586621680538163"><a href="#local-6989586621680538163"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-var">EwM</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-146"></a><span>  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621680538164"><a href="#local-6989586621680538164"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680538165"><a href="#local-6989586621680538165"><span class="hs-identifier">es</span></a></a><span> </span><a name="local-6989586621680538166"><a href="#local-6989586621680538166"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538165"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538166"><span class="hs-identifier hs-var">ws</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#snocBag"><span class="hs-identifier hs-var">snocBag</span></a><span class="hs-special">`</span><span> </span><a href="CmdLineParser.html#Warn"><span class="hs-identifier hs-var">Warn</span></a><span> </span><a href="#local-6989586621680538162"><span class="hs-identifier hs-var">reason</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a href="#local-6989586621680538164"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621680538163"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-identifier">deprecate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538134"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538134"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-149"></a><a name="deprecate"><a href="CmdLineParser.html#deprecate"><span class="hs-identifier">deprecate</span></a></a><span> </span><a name="local-6989586621680538167"><a href="#local-6989586621680538167"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-150"></a><span>    </span><a name="local-6989586621680538168"><a href="#local-6989586621680538168"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CmdLineParser.html#getArg"><span class="hs-identifier hs-var">getArg</span></a><span>
</span><a name="line-151"></a><span>    </span><a href="CmdLineParser.html#addFlagWarn"><span class="hs-identifier hs-var">addFlagWarn</span></a><span> </span><a href="CmdLineParser.html#ReasonDeprecatedFlag"><span class="hs-identifier hs-var">ReasonDeprecatedFlag</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538168"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; is deprecated: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680538167"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span class="hs-identifier">getArg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538133"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538133"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-154"></a><a name="getArg"><a href="CmdLineParser.html#getArg"><span class="hs-identifier">getArg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-var">EwM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680538169"><a href="#local-6989586621680538169"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680538170"><a href="#local-6989586621680538170"><span class="hs-identifier">es</span></a></a><span> </span><a name="local-6989586621680538171"><a href="#local-6989586621680538171"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538170"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538171"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538169"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-155"></a><span>
</span><a name="line-156"></a><span class="hs-identifier">getCurLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538132"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538132"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-157"></a><a name="getCurLoc"><a href="CmdLineParser.html#getCurLoc"><span class="hs-identifier">getCurLoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-var">EwM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621680538172"><a href="#local-6989586621680538172"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621680538173"><a href="#local-6989586621680538173"><span class="hs-identifier">es</span></a></a><span> </span><a name="local-6989586621680538174"><a href="#local-6989586621680538174"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538173"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538174"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538172"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-identifier">liftEwM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538130"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680538130"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680538131"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538130"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680538131"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-160"></a><a name="liftEwM"><a href="CmdLineParser.html#liftEwM"><span class="hs-identifier">liftEwM</span></a></a><span> </span><a name="local-6989586621680538175"><a href="#local-6989586621680538175"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-var">EwM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680538176"><a href="#local-6989586621680538176"><span class="hs-identifier">es</span></a></a><span> </span><a name="local-6989586621680538177"><a href="#local-6989586621680538177"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621680538178"><a href="#local-6989586621680538178"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680538175"><span class="hs-identifier hs-var">action</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538176"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538177"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538178"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-164"></a><span class="hs-comment">-- A state monad for use in the command-line parser</span><span>
</span><a name="line-165"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-comment">-- (CmdLineP s) typically instantiates the 'm' in (EwM m) and (OptKind m)</span><span>
</span><a name="line-168"></a><span class="hs-keyword">newtype</span><span> </span><a name="CmdLineP"><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier">CmdLineP</span></a></a><span> </span><a name="local-6989586621680538091"><a href="#local-6989586621680538091"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621680538092"><a href="#local-6989586621680538092"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CmdLineP"><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier">CmdLineP</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="runCmdLine"><a href="CmdLineParser.html#runCmdLine"><span class="hs-identifier">runCmdLine</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680538091"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538092"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538091"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier hs-type">CmdLineP</span></a><span> </span><a href="#local-6989586621680538106"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-171"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier hs-type">CmdLineP</span></a><span> </span><a href="#local-6989586621680538103"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-174"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621680538104"><a href="#local-6989586621680538104"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier hs-var">CmdLineP</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680538105"><a href="#local-6989586621680538105"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538104"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538105"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier hs-type">CmdLineP</span></a><span> </span><a href="#local-6989586621680538097"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-178"></a><span>    </span><a name="local-6989586621680538098"><a href="#local-6989586621680538098"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621680538099"><a href="#local-6989586621680538099"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier hs-var">CmdLineP</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680538100"><a href="#local-6989586621680538100"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-179"></a><span>                  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680538101"><a href="#local-6989586621680538101"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680538102"><a href="#local-6989586621680538102"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runCmdLine</span><span> </span><a href="#local-6989586621680538098"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621680538100"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-180"></a><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">runCmdLine</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538099"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621680538101"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680538102"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-identifier">getCmdLineState</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier hs-type">CmdLineP</span></a><span> </span><a href="#local-6989586621680538129"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621680538129"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-184"></a><a name="getCmdLineState"><a href="CmdLineParser.html#getCmdLineState"><span class="hs-identifier">getCmdLineState</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier hs-var">CmdLineP</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621680538179"><a href="#local-6989586621680538179"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538179"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><a href="#local-6989586621680538179"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span class="hs-identifier">putCmdLineState</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680538128"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier hs-type">CmdLineP</span></a><span> </span><a href="#local-6989586621680538128"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-186"></a><a name="putCmdLineState"><a href="CmdLineParser.html#putCmdLineState"><span class="hs-identifier">putCmdLineState</span></a></a><span> </span><a name="local-6989586621680538180"><a href="#local-6989586621680538180"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#CmdLineP"><span class="hs-identifier hs-var">CmdLineP</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621680538180"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-190"></a><span class="hs-comment">--         Processing arguments</span><span>
</span><a name="line-191"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span class="hs-identifier">processArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680538127"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-194"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="#local-6989586621680538127"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- cmdline parser spec</span><span>
</span><a name="line-195"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- args</span><span>
</span><a name="line-196"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680538127"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- spare args</span><span>
</span><a name="line-197"></a><span>                   </span><span class="hs-special">[</span><a href="CmdLineParser.html#Err"><span class="hs-identifier hs-type">Err</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- errors</span><span>
</span><a name="line-198"></a><span>                   </span><span class="hs-special">[</span><a href="CmdLineParser.html#Warn"><span class="hs-identifier hs-type">Warn</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- warnings</span><span>
</span><a name="line-199"></a><a name="processArgs"><a href="CmdLineParser.html#processArgs"><span class="hs-identifier">processArgs</span></a></a><span> </span><a name="local-6989586621680538181"><a href="#local-6989586621680538181"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621680538182"><a href="#local-6989586621680538182"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-200"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680538200"><a href="#local-6989586621680538200"><span class="hs-identifier">errs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680538201"><a href="#local-6989586621680538201"><span class="hs-identifier">warns</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680538202"><a href="#local-6989586621680538202"><span class="hs-identifier">spare</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CmdLineParser.html#runEwM"><span class="hs-identifier hs-var">runEwM</span></a><span> </span><a href="#local-6989586621680538183"><span class="hs-identifier hs-var">action</span></a><span>
</span><a name="line-201"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538202"><span class="hs-identifier hs-var">spare</span></a><span class="hs-special">,</span><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-6989586621680538200"><span class="hs-identifier hs-var">errs</span></a><span class="hs-special">,</span><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-6989586621680538201"><span class="hs-identifier hs-var">warns</span></a><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-203"></a><span>    </span><a name="local-6989586621680538183"><a href="#local-6989586621680538183"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680538184"><span class="hs-identifier hs-var">process</span></a><span> </span><a href="#local-6989586621680538182"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span>    </span><span class="hs-comment">-- process :: [Located String] -&gt; [Located String] -&gt; EwM m [Located String]</span><span>
</span><a name="line-206"></a><span>    </span><a name="local-6989586621680538184"><a href="#local-6989586621680538184"><span class="hs-identifier">process</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680538185"><a href="#local-6989586621680538185"><span class="hs-identifier">spare</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621680538185"><span class="hs-identifier hs-var">spare</span></a><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span>    </span><span class="hs-identifier">process</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680538186"><a href="#local-6989586621680538186"><span class="hs-identifier">locArg</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-char">'-'</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680538187"><a href="#local-6989586621680538187"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680538188"><a href="#local-6989586621680538188"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680538189"><a href="#local-6989586621680538189"><span class="hs-identifier">spare</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-209"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="CmdLineParser.html#findArg"><span class="hs-identifier hs-var">findArg</span></a><span> </span><a href="#local-6989586621680538181"><span class="hs-identifier hs-var">spec</span></a><span> </span><a href="#local-6989586621680538187"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-210"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680538190"><a href="#local-6989586621680538190"><span class="hs-identifier">rest</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680538191"><a href="#local-6989586621680538191"><span class="hs-identifier">opt_kind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-211"></a><span>                </span><span class="hs-keyword">case</span><span> </span><a href="CmdLineParser.html#processOneArg"><span class="hs-identifier hs-var">processOneArg</span></a><span> </span><a href="#local-6989586621680538191"><span class="hs-identifier hs-var">opt_kind</span></a><span> </span><a href="#local-6989586621680538190"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621680538187"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621680538188"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-212"></a><span>                    </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621680538192"><a href="#local-6989586621680538192"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-213"></a><span>                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680538193"><a href="#local-6989586621680538193"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680538184"><span class="hs-identifier hs-var">process</span></a><span> </span><a href="#local-6989586621680538188"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621680538189"><span class="hs-identifier hs-var">spare</span></a><span>
</span><a name="line-214"></a><span>                        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#setArg"><span class="hs-identifier hs-var">setArg</span></a><span> </span><a href="#local-6989586621680538186"><span class="hs-identifier hs-var">locArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmdLineParser.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="#local-6989586621680538192"><span class="hs-identifier hs-var">err</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621680538193"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span>                    </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680538194"><a href="#local-6989586621680538194"><span class="hs-identifier">action</span></a></a><span class="hs-special">,</span><a name="local-6989586621680538195"><a href="#local-6989586621680538195"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-217"></a><span>                        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680538196"><a href="#local-6989586621680538196"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680538184"><span class="hs-identifier hs-var">process</span></a><span> </span><a href="#local-6989586621680538195"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621680538189"><span class="hs-identifier hs-var">spare</span></a><span>
</span><a name="line-218"></a><span>                        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#setArg"><span class="hs-identifier hs-var">setArg</span></a><span> </span><a href="#local-6989586621680538186"><span class="hs-identifier hs-var">locArg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621680538194"><span class="hs-identifier hs-var">action</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621680538196"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680538184"><span class="hs-identifier hs-var">process</span></a><span> </span><a href="#local-6989586621680538188"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538186"><span class="hs-identifier hs-var">locArg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680538189"><span class="hs-identifier hs-var">spare</span></a><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span>    </span><span class="hs-identifier">process</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680538197"><a href="#local-6989586621680538197"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680538198"><a href="#local-6989586621680538198"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680538199"><a href="#local-6989586621680538199"><span class="hs-identifier">spare</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680538184"><span class="hs-identifier hs-var">process</span></a><span> </span><a href="#local-6989586621680538198"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538197"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680538199"><span class="hs-identifier hs-var">spare</span></a><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-identifier">processOneArg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmdLineParser.html#OptKind"><span class="hs-identifier hs-type">OptKind</span></a><span> </span><a href="#local-6989586621680538126"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-226"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#EwM"><span class="hs-identifier hs-type">EwM</span></a><span> </span><a href="#local-6989586621680538126"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-227"></a><a name="processOneArg"><a href="CmdLineParser.html#processOneArg"><span class="hs-identifier">processOneArg</span></a></a><span> </span><a name="local-6989586621680538203"><a href="#local-6989586621680538203"><span class="hs-identifier">opt_kind</span></a></a><span> </span><a name="local-6989586621680538204"><a href="#local-6989586621680538204"><span class="hs-identifier">rest</span></a></a><span> </span><a name="local-6989586621680538205"><a href="#local-6989586621680538205"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621680538206"><a href="#local-6989586621680538206"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-228"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680538207"><a href="#local-6989586621680538207"><span class="hs-identifier">dash_arg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">'-'</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680538205"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-229"></a><span>        </span><a name="local-6989586621680538208"><a href="#local-6989586621680538208"><span class="hs-identifier">rest_no_eq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmdLineParser.html#dropEq"><span class="hs-identifier hs-var">dropEq</span></a><span> </span><a href="#local-6989586621680538204"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-230"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680538203"><span class="hs-identifier hs-var">opt_kind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-231"></a><span>        </span><a href="CmdLineParser.html#NoArg"><span class="hs-identifier hs-var">NoArg</span></a><span>  </span><a name="local-6989586621680538209"><a href="#local-6989586621680538209"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-identifier">rest</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">args</span><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span>        </span><a href="CmdLineParser.html#HasArg"><span class="hs-identifier hs-var">HasArg</span></a><span> </span><a name="local-6989586621680538210"><a href="#local-6989586621680538210"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><a href="#local-6989586621680538208"><span class="hs-identifier hs-var">rest_no_eq</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538210"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538208"><span class="hs-identifier hs-var">rest_no_eq</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-235"></a><span>                                    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#missingArgErr"><span class="hs-identifier hs-var">missingArgErr</span></a><span> </span><a href="#local-6989586621680538207"><span class="hs-identifier hs-var">dash_arg</span></a><span>
</span><a name="line-236"></a><span>                                    </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680538211"><a href="#local-6989586621680538211"><span class="hs-identifier">arg1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680538212"><a href="#local-6989586621680538212"><span class="hs-identifier">args1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538210"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538211"><span class="hs-identifier hs-var">arg1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538212"><span class="hs-identifier hs-var">args1</span></a><span class="hs-special">)</span><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span>        </span><span class="hs-comment">-- See Trac #9776</span><span>
</span><a name="line-239"></a><span>        </span><a href="CmdLineParser.html#SepArg"><span class="hs-identifier hs-var">SepArg</span></a><span> </span><a name="local-6989586621680538213"><a href="#local-6989586621680538213"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-240"></a><span>                        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#missingArgErr"><span class="hs-identifier hs-var">missingArgErr</span></a><span> </span><a href="#local-6989586621680538207"><span class="hs-identifier hs-var">dash_arg</span></a><span>
</span><a name="line-241"></a><span>                        </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621680538214"><a href="#local-6989586621680538214"><span class="hs-identifier">arg1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621680538215"><a href="#local-6989586621680538215"><span class="hs-identifier">args1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538213"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538214"><span class="hs-identifier hs-var">arg1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538215"><span class="hs-identifier hs-var">args1</span></a><span class="hs-special">)</span><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span>        </span><span class="hs-comment">-- See Trac #12625</span><span>
</span><a name="line-244"></a><span>        </span><a href="CmdLineParser.html#Prefix"><span class="hs-identifier hs-var">Prefix</span></a><span> </span><a name="local-6989586621680538216"><a href="#local-6989586621680538216"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><a href="#local-6989586621680538208"><span class="hs-identifier hs-var">rest_no_eq</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538216"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538208"><span class="hs-identifier hs-var">rest_no_eq</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-245"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#missingArgErr"><span class="hs-identifier hs-var">missingArgErr</span></a><span>  </span><a href="#local-6989586621680538207"><span class="hs-identifier hs-var">dash_arg</span></a><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span>        </span><a href="CmdLineParser.html#PassFlag"><span class="hs-identifier hs-var">PassFlag</span></a><span> </span><a name="local-6989586621680538217"><a href="#local-6989586621680538217"><span class="hs-identifier">f</span></a></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Util.html#notNull"><span class="hs-identifier hs-var">notNull</span></a><span> </span><a href="#local-6989586621680538204"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#unknownFlagErr"><span class="hs-identifier hs-var">unknownFlagErr</span></a><span> </span><a href="#local-6989586621680538207"><span class="hs-identifier hs-var">dash_arg</span></a><span>
</span><a name="line-248"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538217"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538207"><span class="hs-identifier hs-var">dash_arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span>        </span><a href="CmdLineParser.html#OptIntSuffix"><span class="hs-identifier hs-var">OptIntSuffix</span></a><span> </span><a name="local-6989586621680538218"><a href="#local-6989586621680538218"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680538204"><span class="hs-identifier hs-var">rest</span></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538218"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>  </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-251"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680538219"><a href="#local-6989586621680538219"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CmdLineParser.html#parseInt"><span class="hs-identifier hs-var">parseInt</span></a><span> </span><a href="#local-6989586621680538208"><span class="hs-identifier hs-var">rest_no_eq</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538218"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621680538219"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-252"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;malformed integer argument in &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680538207"><span class="hs-identifier hs-var">dash_arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span>        </span><a href="CmdLineParser.html#IntSuffix"><span class="hs-identifier hs-var">IntSuffix</span></a><span> </span><a name="local-6989586621680538220"><a href="#local-6989586621680538220"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680538221"><a href="#local-6989586621680538221"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CmdLineParser.html#parseInt"><span class="hs-identifier hs-var">parseInt</span></a><span> </span><a href="#local-6989586621680538208"><span class="hs-identifier hs-var">rest_no_eq</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538220"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538221"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;malformed integer argument in &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680538207"><span class="hs-identifier hs-var">dash_arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span>        </span><a href="CmdLineParser.html#FloatSuffix"><span class="hs-identifier hs-var">FloatSuffix</span></a><span> </span><a name="local-6989586621680538222"><a href="#local-6989586621680538222"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680538223"><a href="#local-6989586621680538223"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CmdLineParser.html#parseFloat"><span class="hs-identifier hs-var">parseFloat</span></a><span> </span><a href="#local-6989586621680538208"><span class="hs-identifier hs-var">rest_no_eq</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538222"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538223"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;malformed float argument in &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680538207"><span class="hs-identifier hs-var">dash_arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span>        </span><a href="CmdLineParser.html#OptPrefix"><span class="hs-identifier hs-var">OptPrefix</span></a><span> </span><a name="local-6989586621680538224"><a href="#local-6989586621680538224"><span class="hs-identifier">f</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538224"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538208"><span class="hs-identifier hs-var">rest_no_eq</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>        </span><a href="CmdLineParser.html#AnySuffix"><span class="hs-identifier hs-var">AnySuffix</span></a><span> </span><a name="local-6989586621680538225"><a href="#local-6989586621680538225"><span class="hs-identifier">f</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680538225"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621680538207"><span class="hs-identifier hs-var">dash_arg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538206"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-identifier">findArg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CmdLineParser.html#Flag"><span class="hs-identifier hs-type">Flag</span></a><span> </span><a href="#local-6989586621680538125"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="CmdLineParser.html#OptKind"><span class="hs-identifier hs-type">OptKind</span></a><span> </span><a href="#local-6989586621680538125"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-264"></a><a name="findArg"><a href="CmdLineParser.html#findArg"><span class="hs-identifier">findArg</span></a></a><span> </span><a name="local-6989586621680538226"><a href="#local-6989586621680538226"><span class="hs-identifier">spec</span></a></a><span> </span><a name="local-6989586621680538227"><a href="#local-6989586621680538227"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-265"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">on</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- prefer longest matching flag</span><span>
</span><a name="line-266"></a><span>           </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="Util.html#removeSpaces"><span class="hs-identifier hs-var">removeSpaces</span></a><span> </span><a href="#local-6989586621680538230"><span class="hs-identifier hs-var">rest</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680538229"><span class="hs-identifier hs-var">optKind</span></a><span class="hs-special">)</span><span>
</span><a name="line-267"></a><span>           </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680538228"><a href="#local-6989586621680538228"><span class="hs-identifier">flag</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680538226"><span class="hs-identifier hs-var">spec</span></a><span class="hs-special">,</span><span>
</span><a name="line-268"></a><span>             </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621680538229"><a href="#local-6989586621680538229"><span class="hs-identifier">optKind</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">flagOptKind</span><span> </span><a href="#local-6989586621680538228"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">,</span><span>
</span><a name="line-269"></a><span>             </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680538230"><a href="#local-6989586621680538230"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">stripPrefix</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">flagName</span><span> </span><a href="#local-6989586621680538228"><span class="hs-identifier hs-var">flag</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680538227"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-270"></a><span>             </span><a href="CmdLineParser.html#arg_ok"><span class="hs-identifier hs-var">arg_ok</span></a><span> </span><a href="#local-6989586621680538229"><span class="hs-identifier hs-var">optKind</span></a><span> </span><a href="#local-6989586621680538230"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621680538227"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-271"></a><span>    </span><span class="hs-keyword">of</span><span>
</span><a name="line-272"></a><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-273"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680538231"><a href="#local-6989586621680538231"><span class="hs-identifier">one</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621680538231"><span class="hs-identifier hs-var">one</span></a><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-identifier">arg_ok</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmdLineParser.html#OptKind"><span class="hs-identifier hs-type">OptKind</span></a><span> </span><a href="#local-6989586621680538124"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Char</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-276"></a><a name="arg_ok"><a href="CmdLineParser.html#arg_ok"><span class="hs-identifier">arg_ok</span></a></a><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#NoArg"><span class="hs-identifier hs-var">NoArg</span></a><span>           </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><a name="local-6989586621680538232"><a href="#local-6989586621680538232"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680538232"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-277"></a><span class="hs-identifier">arg_ok</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#HasArg"><span class="hs-identifier hs-var">HasArg</span></a><span>          </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-278"></a><span class="hs-identifier">arg_ok</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#SepArg"><span class="hs-identifier hs-var">SepArg</span></a><span>          </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><a name="local-6989586621680538233"><a href="#local-6989586621680538233"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680538233"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-279"></a><span class="hs-identifier">arg_ok</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#Prefix"><span class="hs-identifier hs-var">Prefix</span></a><span>          </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-comment">-- Missing argument checked for in processOneArg t</span><span>
</span><a name="line-280"></a><span>                                            </span><span class="hs-comment">-- to improve error message (Trac #12625)</span><span>
</span><a name="line-281"></a><span class="hs-identifier">arg_ok</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#OptIntSuffix"><span class="hs-identifier hs-var">OptIntSuffix</span></a><span>    </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-282"></a><span class="hs-identifier">arg_ok</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#IntSuffix"><span class="hs-identifier hs-var">IntSuffix</span></a><span>       </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-283"></a><span class="hs-identifier">arg_ok</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#FloatSuffix"><span class="hs-identifier hs-var">FloatSuffix</span></a><span>     </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-284"></a><span class="hs-identifier">arg_ok</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#OptPrefix"><span class="hs-identifier hs-var">OptPrefix</span></a><span>       </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-285"></a><span class="hs-identifier">arg_ok</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#PassFlag"><span class="hs-identifier hs-var">PassFlag</span></a><span>        </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><a name="local-6989586621680538234"><a href="#local-6989586621680538234"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621680538234"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-286"></a><span class="hs-identifier">arg_ok</span><span> </span><span class="hs-special">(</span><a href="CmdLineParser.html#AnySuffix"><span class="hs-identifier hs-var">AnySuffix</span></a><span>       </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span>    </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span class="hs-comment">-- | Parse an Int</span><span>
</span><a name="line-289"></a><span class="hs-comment">--</span><span>
</span><a name="line-290"></a><span class="hs-comment">-- Looks for &quot;433&quot; or &quot;=342&quot;, with no trailing gubbins</span><span>
</span><a name="line-291"></a><span class="hs-comment">--   * n or =n      =&gt; Just n</span><span>
</span><a name="line-292"></a><span class="hs-comment">--   * gibberish    =&gt; Nothing</span><span>
</span><a name="line-293"></a><span class="hs-identifier">parseInt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-294"></a><a name="parseInt"><a href="CmdLineParser.html#parseInt"><span class="hs-identifier">parseInt</span></a></a><span> </span><a name="local-6989586621680538235"><a href="#local-6989586621680538235"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">reads</span><span> </span><a href="#local-6989586621680538235"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-295"></a><span>                 </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621680538236"><a href="#local-6989586621680538236"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621680538236"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-296"></a><span>                 </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-identifier">parseFloat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Float</span><span>
</span><a name="line-299"></a><a name="parseFloat"><a href="CmdLineParser.html#parseFloat"><span class="hs-identifier">parseFloat</span></a></a><span> </span><a name="local-6989586621680538237"><a href="#local-6989586621680538237"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">reads</span><span> </span><a href="#local-6989586621680538237"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-300"></a><span>                   </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621680538238"><a href="#local-6989586621680538238"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621680538238"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-301"></a><span>                   </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-comment">-- | Discards a leading equals sign</span><span>
</span><a name="line-304"></a><span class="hs-identifier">dropEq</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-305"></a><a name="dropEq"><a href="CmdLineParser.html#dropEq"><span class="hs-identifier">dropEq</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-char">'='</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680538239"><a href="#local-6989586621680538239"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680538239"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-306"></a><span class="hs-identifier">dropEq</span><span> </span><a name="local-6989586621680538240"><a href="#local-6989586621680538240"><span class="hs-identifier">s</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680538240"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span class="hs-identifier">unknownFlagErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="#local-6989586621680538123"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-309"></a><a name="unknownFlagErr"><a href="CmdLineParser.html#unknownFlagErr"><span class="hs-identifier">unknownFlagErr</span></a></a><span> </span><a name="local-6989586621680538241"><a href="#local-6989586621680538241"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;unrecognised flag: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680538241"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span class="hs-identifier">missingArgErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><a href="#local-6989586621680538122"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-312"></a><a name="missingArgErr"><a href="CmdLineParser.html#missingArgErr"><span class="hs-identifier">missingArgErr</span></a></a><span> </span><a name="local-6989586621680538242"><a href="#local-6989586621680538242"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;missing argument for flag: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680538242"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-315"></a><span class="hs-comment">-- Utils</span><span>
</span><a name="line-316"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-comment">-- See Note [Handling errors when parsing flags]</span><span>
</span><a name="line-320"></a><span class="hs-identifier">errorsToGhcException</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Location</span><span>
</span><a name="line-321"></a><span>                          </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Error</span><span>
</span><a name="line-322"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#GhcException"><span class="hs-identifier hs-type">GhcException</span></a><span>
</span><a name="line-323"></a><a name="errorsToGhcException"><a href="CmdLineParser.html#errorsToGhcException"><span class="hs-identifier">errorsToGhcException</span></a></a><span> </span><a name="local-6989586621680538243"><a href="#local-6989586621680538243"><span class="hs-identifier">errs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-324"></a><span>    </span><a href="Panic.html#UsageError"><span class="hs-identifier hs-var">UsageError</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-string">&quot;\n&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621680538244"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680538245"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680538244"><a href="#local-6989586621680538244"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680538245"><a href="#local-6989586621680538245"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680538243"><span class="hs-identifier hs-var">errs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-comment">{- Note [Handling errors when parsing commandline flags]

Parsing of static and mode flags happens before any session is started, i.e.,
before the first call to 'GHC.withGhc'. Therefore, to report errors for
invalid usage of these two types of flags, we can not call any function that
needs DynFlags, as there are no DynFlags available yet (unsafeGlobalDynFlags
is not set either). So we always print &quot;on the commandline&quot; as the location,
which is true except for Api users, which is probably ok.

When reporting errors for invalid usage of dynamic flags we /can/ make use of
DynFlags, and we do so explicitly in DynFlags.parseDynamicFlagsFull.

Before, we called unsafeGlobalDynFlags when an invalid (combination of)
flag(s) was given on the commandline, resulting in panics (#9963).
-}</span><span>
</span><a name="line-341"></a></pre></body></html>