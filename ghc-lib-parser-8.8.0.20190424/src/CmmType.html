<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">CmmType</span><span>
</span><a name="line-2"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>   </span><span class="hs-comment">-- Abstract</span><span>
</span><a name="line-3"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#b8"><span class="hs-identifier hs-var">b8</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#b16"><span class="hs-identifier hs-var">b16</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#b32"><span class="hs-identifier hs-var">b32</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#b64"><span class="hs-identifier hs-var">b64</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#b128"><span class="hs-identifier hs-var">b128</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#b256"><span class="hs-identifier hs-var">b256</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#b512"><span class="hs-identifier hs-var">b512</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#f32"><span class="hs-identifier hs-var">f32</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#f64"><span class="hs-identifier hs-var">f64</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#bWord"><span class="hs-identifier hs-var">bWord</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#bHalfWord"><span class="hs-identifier hs-var">bHalfWord</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#gcWord"><span class="hs-identifier hs-var">gcWord</span></a><span>
</span><a name="line-4"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#cInt"><span class="hs-identifier hs-var">cInt</span></a><span>
</span><a name="line-5"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#cmmFloat"><span class="hs-identifier hs-var">cmmFloat</span></a><span>
</span><a name="line-6"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#typeWidth"><span class="hs-identifier hs-var">typeWidth</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#cmmEqType"><span class="hs-identifier hs-var">cmmEqType</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#cmmEqType_ignoring_ptrhood"><span class="hs-identifier hs-var">cmmEqType_ignoring_ptrhood</span></a><span>
</span><a name="line-7"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#isFloatType"><span class="hs-identifier hs-var">isFloatType</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#isGcPtrType"><span class="hs-identifier hs-var">isGcPtrType</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#isBitsType"><span class="hs-identifier hs-var">isBitsType</span></a><span>
</span><a name="line-8"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#isWord32"><span class="hs-identifier hs-var">isWord32</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#isWord64"><span class="hs-identifier hs-var">isWord64</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#isFloat64"><span class="hs-identifier hs-var">isFloat64</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#isFloat32"><span class="hs-identifier hs-var">isFloat32</span></a><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#widthInLog"><span class="hs-identifier hs-var">widthInLog</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#widthFromBytes"><span class="hs-identifier hs-var">widthFromBytes</span></a><span>
</span><a name="line-12"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#halfWordWidth"><span class="hs-identifier hs-var">halfWordWidth</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#cIntWidth"><span class="hs-identifier hs-var">cIntWidth</span></a><span>
</span><a name="line-13"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#halfWordMask"><span class="hs-identifier hs-var">halfWordMask</span></a><span>
</span><a name="line-14"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#narrowU"><span class="hs-identifier hs-var">narrowU</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#narrowS"><span class="hs-identifier hs-var">narrowS</span></a><span>
</span><a name="line-15"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#rEP_CostCentreStack_mem_alloc"><span class="hs-identifier hs-var">rEP_CostCentreStack_mem_alloc</span></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#rEP_CostCentreStack_scc_count"><span class="hs-identifier hs-var">rEP_CostCentreStack_scc_count</span></a><span>
</span><a name="line-17"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#rEP_StgEntCounter_allocs"><span class="hs-identifier hs-var">rEP_StgEntCounter_allocs</span></a><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#rEP_StgEntCounter_allocd"><span class="hs-identifier hs-var">rEP_StgEntCounter_allocd</span></a><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#ForeignHint"><span class="hs-identifier hs-type">ForeignHint</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#Length"><span class="hs-identifier hs-type">Length</span></a><span>
</span><a name="line-23"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec2"><span class="hs-identifier hs-var">vec2</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec4"><span class="hs-identifier hs-var">vec4</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec8"><span class="hs-identifier hs-var">vec8</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec16"><span class="hs-identifier hs-var">vec16</span></a><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec2f64"><span class="hs-identifier hs-var">vec2f64</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec2b64"><span class="hs-identifier hs-var">vec2b64</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec4f32"><span class="hs-identifier hs-var">vec4f32</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec4b32"><span class="hs-identifier hs-var">vec4b32</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec8b16"><span class="hs-identifier hs-var">vec8b16</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#vec16b8"><span class="hs-identifier hs-var">vec16b8</span></a><span>
</span><a name="line-25"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#cmmVec"><span class="hs-identifier hs-var">cmmVec</span></a><span>
</span><a name="line-26"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#vecLength"><span class="hs-identifier hs-var">vecLength</span></a><span class="hs-special">,</span><span> </span><a href="CmmType.html#vecElemType"><span class="hs-identifier hs-var">vecElemType</span></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="CmmType.html#isVecType"><span class="hs-identifier hs-var">isVecType</span></a><span>
</span><a name="line-28"></a><span>   </span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">where</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Int</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-42"></a><span class="hs-comment">--              CmmType</span><span>
</span><a name="line-43"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-comment">-- NOTE: CmmType is an abstract type, not exported from this</span><span>
</span><a name="line-46"></a><span>  </span><span class="hs-comment">--       module so you can easily change its representation</span><span>
</span><a name="line-47"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-48"></a><span>  </span><span class="hs-comment">-- However Width is exported in a concrete way,</span><span>
</span><a name="line-49"></a><span>  </span><span class="hs-comment">-- and is used extensively in pattern-matching</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-keyword">data</span><span> </span><a name="CmmType"><a href="CmmType.html#CmmType"><span class="hs-identifier">CmmType</span></a></a><span>    </span><span class="hs-comment">-- The important one!</span><span>
</span><a name="line-52"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="CmmType"><a href="CmmType.html#CmmType"><span class="hs-identifier">CmmType</span></a></a><span> </span><a href="CmmType.html#CmmCat"><span class="hs-identifier hs-type">CmmCat</span></a><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">data</span><span> </span><a name="CmmCat"><a href="CmmType.html#CmmCat"><span class="hs-identifier">CmmCat</span></a></a><span>                </span><span class="hs-comment">-- &quot;Category&quot; (not exported)</span><span>
</span><a name="line-55"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="GcPtrCat"><a href="CmmType.html#GcPtrCat"><span class="hs-identifier">GcPtrCat</span></a></a><span>              </span><span class="hs-comment">-- GC pointer</span><span>
</span><a name="line-56"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="BitsCat"><a href="CmmType.html#BitsCat"><span class="hs-identifier">BitsCat</span></a></a><span>               </span><span class="hs-comment">-- Non-pointer</span><span>
</span><a name="line-57"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="FloatCat"><a href="CmmType.html#FloatCat"><span class="hs-identifier">FloatCat</span></a></a><span>              </span><span class="hs-comment">-- Float</span><span>
</span><a name="line-58"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="VecCat"><a href="CmmType.html#VecCat"><span class="hs-identifier">VecCat</span></a></a><span> </span><a href="CmmType.html#Length"><span class="hs-identifier hs-type">Length</span></a><span> </span><a href="CmmType.html#CmmCat"><span class="hs-identifier hs-type">CmmCat</span></a><span>  </span><span class="hs-comment">-- Vector</span><span>
</span><a name="line-59"></a><span>   </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>        </span><span class="hs-comment">-- See Note [Signed vs unsigned] at the end</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-63"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a name="local-6989586621681285334"><a href="#local-6989586621681285334"><span class="hs-identifier">cat</span></a></a><span> </span><a name="local-6989586621681285335"><a href="#local-6989586621681285335"><span class="hs-identifier">wid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681285334"><span class="hs-identifier hs-var">cat</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#widthInBits"><span class="hs-identifier hs-var">widthInBits</span></a><span> </span><a href="#local-6989586621681285335"><span class="hs-identifier hs-var">wid</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CmmType.html#CmmCat"><span class="hs-identifier hs-type">CmmCat</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-66"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="CmmType.html#FloatCat"><span class="hs-identifier hs-var">FloatCat</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;F&quot;</span><span>
</span><a name="line-67"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CmmType.html#GcPtrCat"><span class="hs-identifier hs-var">GcPtrCat</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;P&quot;</span><span>
</span><a name="line-68"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="CmmType.html#BitsCat"><span class="hs-identifier hs-var">BitsCat</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;I&quot;</span><span>
</span><a name="line-69"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="CmmType.html#VecCat"><span class="hs-identifier hs-var">VecCat</span></a><span> </span><a name="local-6989586621681285332"><a href="#local-6989586621681285332"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681285333"><a href="#local-6989586621681285333"><span class="hs-identifier">cat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681285333"><span class="hs-identifier hs-var">cat</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;x&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681285332"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;V&quot;</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-comment">-- Why is CmmType stratified?  For native code generation,</span><span>
</span><a name="line-72"></a><span class="hs-comment">-- most of the time you just want to know what sort of register</span><span>
</span><a name="line-73"></a><span class="hs-comment">-- to put the thing in, and for this you need to know how</span><span>
</span><a name="line-74"></a><span class="hs-comment">-- many bits thing has, and whether it goes in a floating-point</span><span>
</span><a name="line-75"></a><span class="hs-comment">-- register.  By contrast, the distinction between GcPtr and</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- GcNonPtr is of interest to only a few parts of the code generator.</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-comment">-------- Equality on CmmType --------------</span><span>
</span><a name="line-79"></a><span class="hs-comment">-- CmmType is *not* an instance of Eq; sometimes we care about the</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- Gc/NonGc distinction, and sometimes we don't</span><span>
</span><a name="line-81"></a><span class="hs-comment">-- So we use an explicit function to force you to think about it</span><span>
</span><a name="line-82"></a><span class="hs-identifier">cmmEqType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-comment">-- Exact equality</span><span>
</span><a name="line-83"></a><a name="cmmEqType"><a href="CmmType.html#cmmEqType"><span class="hs-identifier">cmmEqType</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a name="local-6989586621681285336"><a href="#local-6989586621681285336"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681285337"><a href="#local-6989586621681285337"><span class="hs-identifier">w1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a name="local-6989586621681285338"><a href="#local-6989586621681285338"><span class="hs-identifier">c2</span></a></a><span> </span><a name="local-6989586621681285339"><a href="#local-6989586621681285339"><span class="hs-identifier">w2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681285336"><span class="hs-identifier hs-var">c1</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681285338"><span class="hs-identifier hs-var">c2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621681285337"><span class="hs-identifier hs-var">w1</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681285339"><span class="hs-identifier hs-var">w2</span></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-identifier">cmmEqType_ignoring_ptrhood</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-comment">-- This equality is temporary; used in CmmLint</span><span>
</span><a name="line-87"></a><span>  </span><span class="hs-comment">-- but the RTS files are not yet well-typed wrt pointers</span><span>
</span><a name="line-88"></a><a name="cmmEqType_ignoring_ptrhood"><a href="CmmType.html#cmmEqType_ignoring_ptrhood"><span class="hs-identifier">cmmEqType_ignoring_ptrhood</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a name="local-6989586621681285340"><a href="#local-6989586621681285340"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681285341"><a href="#local-6989586621681285341"><span class="hs-identifier">w1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a name="local-6989586621681285342"><a href="#local-6989586621681285342"><span class="hs-identifier">c2</span></a></a><span> </span><a name="local-6989586621681285343"><a href="#local-6989586621681285343"><span class="hs-identifier">w2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681285340"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621681285344"><span class="hs-identifier hs-var">weak_eq</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681285342"><span class="hs-identifier hs-var">c2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621681285341"><span class="hs-identifier hs-var">w1</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681285343"><span class="hs-identifier hs-var">w2</span></a><span>
</span><a name="line-90"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-91"></a><span>     </span><span class="hs-identifier">weak_eq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmCat"><span class="hs-identifier hs-type">CmmCat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmCat"><span class="hs-identifier hs-type">CmmCat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-92"></a><span>     </span><a href="CmmType.html#FloatCat"><span class="hs-identifier hs-var">FloatCat</span></a><span>         </span><span class="hs-special">`</span><a name="local-6989586621681285344"><a href="#local-6989586621681285344"><span class="hs-identifier">weak_eq</span></a></a><span class="hs-special">`</span><span> </span><a href="CmmType.html#FloatCat"><span class="hs-identifier hs-var">FloatCat</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-93"></a><span>     </span><a href="CmmType.html#FloatCat"><span class="hs-identifier hs-var">FloatCat</span></a><span>         </span><span class="hs-special">`</span><span class="hs-identifier">weak_eq</span><span class="hs-special">`</span><span> </span><a name="local-6989586621681285345"><a href="#local-6989586621681285345"><span class="hs-identifier">_other</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-94"></a><span>     </span><a name="local-6989586621681285346"><a href="#local-6989586621681285346"><span class="hs-identifier">_other</span></a></a><span>           </span><span class="hs-special">`</span><span class="hs-identifier">weak_eq</span><span class="hs-special">`</span><span> </span><a href="CmmType.html#FloatCat"><span class="hs-identifier hs-var">FloatCat</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-95"></a><span>     </span><span class="hs-special">(</span><a href="CmmType.html#VecCat"><span class="hs-identifier hs-var">VecCat</span></a><span> </span><a name="local-6989586621681285347"><a href="#local-6989586621681285347"><span class="hs-identifier">l1</span></a></a><span> </span><a name="local-6989586621681285348"><a href="#local-6989586621681285348"><span class="hs-identifier">cat1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">weak_eq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="CmmType.html#VecCat"><span class="hs-identifier hs-var">VecCat</span></a><span> </span><a name="local-6989586621681285349"><a href="#local-6989586621681285349"><span class="hs-identifier">l2</span></a></a><span> </span><a name="local-6989586621681285350"><a href="#local-6989586621681285350"><span class="hs-identifier">cat2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681285347"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621681285349"><span class="hs-identifier hs-var">l2</span></a><span>
</span><a name="line-96"></a><span>                                                   </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621681285348"><span class="hs-identifier hs-var">cat1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621681285344"><span class="hs-identifier hs-var">weak_eq</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681285350"><span class="hs-identifier hs-var">cat2</span></a><span>
</span><a name="line-97"></a><span>     </span><span class="hs-special">(</span><a href="CmmType.html#VecCat"><span class="hs-identifier hs-var">VecCat</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-special">`</span><span class="hs-identifier">weak_eq</span><span class="hs-special">`</span><span> </span><a name="local-6989586621681285351"><a href="#local-6989586621681285351"><span class="hs-identifier">_other</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-98"></a><span>     </span><a name="local-6989586621681285352"><a href="#local-6989586621681285352"><span class="hs-identifier">_other</span></a></a><span>           </span><span class="hs-special">`</span><span class="hs-identifier">weak_eq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="CmmType.html#VecCat"><span class="hs-identifier hs-var">VecCat</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-99"></a><span>     </span><a name="local-6989586621681285353"><a href="#local-6989586621681285353"><span class="hs-identifier">_word1</span></a></a><span>           </span><span class="hs-special">`</span><span class="hs-identifier">weak_eq</span><span class="hs-special">`</span><span> </span><a name="local-6989586621681285354"><a href="#local-6989586621681285354"><span class="hs-identifier">_word2</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>        </span><span class="hs-comment">-- Ignores GcPtr</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-comment">--- Simple operations on CmmType -----</span><span>
</span><a name="line-102"></a><span class="hs-identifier">typeWidth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span>
</span><a name="line-103"></a><a name="typeWidth"><a href="CmmType.html#typeWidth"><span class="hs-identifier">typeWidth</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681285355"><a href="#local-6989586621681285355"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681285355"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span class="hs-identifier">cmmBits</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cmmFloat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-106"></a><a name="cmmBits"><a href="CmmType.html#cmmBits"><span class="hs-identifier">cmmBits</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#BitsCat"><span class="hs-identifier hs-var">BitsCat</span></a><span>
</span><a name="line-107"></a><a name="cmmFloat"><a href="CmmType.html#cmmFloat"><span class="hs-identifier">cmmFloat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#FloatCat"><span class="hs-identifier hs-var">FloatCat</span></a><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span class="hs-comment">-------- Common CmmTypes ------------</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- Floats and words of specific widths</span><span>
</span><a name="line-111"></a><span class="hs-identifier">b8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b16</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b32</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b64</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b128</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b256</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">b512</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f32</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f64</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-112"></a><a name="b8"><a href="CmmType.html#b8"><span class="hs-identifier">b8</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><a href="CmmType.html#W8"><span class="hs-identifier hs-var">W8</span></a><span>
</span><a name="line-113"></a><a name="b16"><a href="CmmType.html#b16"><span class="hs-identifier">b16</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><a href="CmmType.html#W16"><span class="hs-identifier hs-var">W16</span></a><span>
</span><a name="line-114"></a><a name="b32"><a href="CmmType.html#b32"><span class="hs-identifier">b32</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span>
</span><a name="line-115"></a><a name="b64"><a href="CmmType.html#b64"><span class="hs-identifier">b64</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span>
</span><a name="line-116"></a><a name="b128"><a href="CmmType.html#b128"><span class="hs-identifier">b128</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><a href="CmmType.html#W128"><span class="hs-identifier hs-var">W128</span></a><span>
</span><a name="line-117"></a><a name="b256"><a href="CmmType.html#b256"><span class="hs-identifier">b256</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><a href="CmmType.html#W256"><span class="hs-identifier hs-var">W256</span></a><span>
</span><a name="line-118"></a><a name="b512"><a href="CmmType.html#b512"><span class="hs-identifier">b512</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><a href="CmmType.html#W512"><span class="hs-identifier hs-var">W512</span></a><span>
</span><a name="line-119"></a><a name="f32"><a href="CmmType.html#f32"><span class="hs-identifier">f32</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmFloat"><span class="hs-identifier hs-var">cmmFloat</span></a><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span>
</span><a name="line-120"></a><a name="f64"><a href="CmmType.html#f64"><span class="hs-identifier">f64</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmFloat"><span class="hs-identifier hs-var">cmmFloat</span></a><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">-- CmmTypes of native word widths</span><span>
</span><a name="line-123"></a><span class="hs-identifier">bWord</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-124"></a><a name="bWord"><a href="CmmType.html#bWord"><span class="hs-identifier">bWord</span></a></a><span> </span><a name="local-6989586621681285356"><a href="#local-6989586621681285356"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a><span> </span><a href="#local-6989586621681285356"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-identifier">bHalfWord</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-127"></a><a name="bHalfWord"><a href="CmmType.html#bHalfWord"><span class="hs-identifier">bHalfWord</span></a></a><span> </span><a name="local-6989586621681285357"><a href="#local-6989586621681285357"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#halfWordWidth"><span class="hs-identifier hs-var">halfWordWidth</span></a><span> </span><a href="#local-6989586621681285357"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-identifier">gcWord</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-130"></a><a name="gcWord"><a href="CmmType.html#gcWord"><span class="hs-identifier">gcWord</span></a></a><span> </span><a name="local-6989586621681285358"><a href="#local-6989586621681285358"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#GcPtrCat"><span class="hs-identifier hs-var">GcPtrCat</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#wordWidth"><span class="hs-identifier hs-var">wordWidth</span></a><span> </span><a href="#local-6989586621681285358"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-identifier">cInt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-133"></a><a name="cInt"><a href="CmmType.html#cInt"><span class="hs-identifier">cInt</span></a></a><span> </span><a name="local-6989586621681285359"><a href="#local-6989586621681285359"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#cIntWidth"><span class="hs-identifier hs-var">cIntWidth</span></a><span>  </span><a href="#local-6989586621681285359"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span class="hs-comment">------------ Predicates ----------------</span><span>
</span><a name="line-136"></a><span class="hs-identifier">isFloatType</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isGcPtrType</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isBitsType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-137"></a><a name="isFloatType"><a href="CmmType.html#isFloatType"><span class="hs-identifier">isFloatType</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#FloatCat"><span class="hs-identifier hs-var">FloatCat</span></a><span>    </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-138"></a><span class="hs-identifier">isFloatType</span><span> </span><a name="local-6989586621681285360"><a href="#local-6989586621681285360"><span class="hs-identifier">_other</span></a></a><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><a name="isGcPtrType"><a href="CmmType.html#isGcPtrType"><span class="hs-identifier">isGcPtrType</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#GcPtrCat"><span class="hs-identifier hs-var">GcPtrCat</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-141"></a><span class="hs-identifier">isGcPtrType</span><span> </span><a name="local-6989586621681285361"><a href="#local-6989586621681285361"><span class="hs-identifier">_other</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><a name="isBitsType"><a href="CmmType.html#isBitsType"><span class="hs-identifier">isBitsType</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#BitsCat"><span class="hs-identifier hs-var">BitsCat</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-144"></a><span class="hs-identifier">isBitsType</span><span> </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-identifier">isWord32</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isWord64</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isFloat32</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isFloat64</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- isWord64 is true of 64-bit non-floats (both gc-ptrs and otherwise)</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- isFloat32 and 64 are obvious</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><a name="isWord64"><a href="CmmType.html#isWord64"><span class="hs-identifier">isWord64</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#BitsCat"><span class="hs-identifier hs-var">BitsCat</span></a><span>  </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-151"></a><span class="hs-identifier">isWord64</span><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#GcPtrCat"><span class="hs-identifier hs-var">GcPtrCat</span></a><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-152"></a><span class="hs-identifier">isWord64</span><span> </span><a name="local-6989586621681285362"><a href="#local-6989586621681285362"><span class="hs-identifier">_other</span></a></a><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><a name="isWord32"><a href="CmmType.html#isWord32"><span class="hs-identifier">isWord32</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#BitsCat"><span class="hs-identifier hs-var">BitsCat</span></a><span>  </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-155"></a><span class="hs-identifier">isWord32</span><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#GcPtrCat"><span class="hs-identifier hs-var">GcPtrCat</span></a><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-156"></a><span class="hs-identifier">isWord32</span><span> </span><a name="local-6989586621681285363"><a href="#local-6989586621681285363"><span class="hs-identifier">_other</span></a></a><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><a name="isFloat32"><a href="CmmType.html#isFloat32"><span class="hs-identifier">isFloat32</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#FloatCat"><span class="hs-identifier hs-var">FloatCat</span></a><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-159"></a><span class="hs-identifier">isFloat32</span><span> </span><a name="local-6989586621681285364"><a href="#local-6989586621681285364"><span class="hs-identifier">_other</span></a></a><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><a name="isFloat64"><a href="CmmType.html#isFloat64"><span class="hs-identifier">isFloat64</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="CmmType.html#FloatCat"><span class="hs-identifier hs-var">FloatCat</span></a><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-162"></a><span class="hs-identifier">isFloat64</span><span> </span><a name="local-6989586621681285365"><a href="#local-6989586621681285365"><span class="hs-identifier">_other</span></a></a><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-165"></a><span class="hs-comment">--              Width</span><span>
</span><a name="line-166"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-keyword">data</span><span> </span><a name="Width"><a href="CmmType.html#Width"><span class="hs-identifier">Width</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="W8"><a href="CmmType.html#W8"><span class="hs-identifier">W8</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="W16"><a href="CmmType.html#W16"><span class="hs-identifier">W16</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="W32"><a href="CmmType.html#W32"><span class="hs-identifier">W32</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="W64"><a href="CmmType.html#W64"><span class="hs-identifier">W64</span></a></a><span>
</span><a name="line-169"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a name="W80"><a href="CmmType.html#W80"><span class="hs-identifier">W80</span></a></a><span>      </span><span class="hs-comment">-- Extended double-precision float,</span><span>
</span><a name="line-170"></a><span>                        </span><span class="hs-comment">-- used in x86 native codegen only.</span><span>
</span><a name="line-171"></a><span>                        </span><span class="hs-comment">-- (we use Ord, so it'd better be in this order)</span><span>
</span><a name="line-172"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a name="W128"><a href="CmmType.html#W128"><span class="hs-identifier">W128</span></a></a><span>
</span><a name="line-173"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a name="W256"><a href="CmmType.html#W256"><span class="hs-identifier">W256</span></a></a><span>
</span><a name="line-174"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a name="W512"><a href="CmmType.html#W512"><span class="hs-identifier">W512</span></a></a><span>
</span><a name="line-175"></a><span>             </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-178"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621681285331"><a href="#local-6989586621681285331"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#mrStr"><span class="hs-identifier hs-var">mrStr</span></a><span> </span><a href="#local-6989586621681285331"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-identifier">mrStr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a><span>
</span><a name="line-181"></a><a name="mrStr"><a href="CmmType.html#mrStr"><span class="hs-identifier">mrStr</span></a></a><span> </span><a href="CmmType.html#W8"><span class="hs-identifier hs-var">W8</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span class="hs-special">(</span><span class="hs-string">&quot;W8&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span class="hs-identifier">mrStr</span><span> </span><a href="CmmType.html#W16"><span class="hs-identifier hs-var">W16</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span class="hs-special">(</span><span class="hs-string">&quot;W16&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span class="hs-identifier">mrStr</span><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span class="hs-special">(</span><span class="hs-string">&quot;W32&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span class="hs-identifier">mrStr</span><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span class="hs-special">(</span><span class="hs-string">&quot;W64&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span class="hs-identifier">mrStr</span><span> </span><a href="CmmType.html#W128"><span class="hs-identifier hs-var">W128</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span class="hs-special">(</span><span class="hs-string">&quot;W128&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span class="hs-identifier">mrStr</span><span> </span><a href="CmmType.html#W256"><span class="hs-identifier hs-var">W256</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span class="hs-special">(</span><span class="hs-string">&quot;W256&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span class="hs-identifier">mrStr</span><span> </span><a href="CmmType.html#W512"><span class="hs-identifier hs-var">W512</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span class="hs-special">(</span><span class="hs-string">&quot;W512&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span class="hs-identifier">mrStr</span><span> </span><a href="CmmType.html#W80"><span class="hs-identifier hs-var">W80</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span class="hs-special">(</span><span class="hs-string">&quot;W80&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-comment">-------- Common Widths  ------------</span><span>
</span><a name="line-192"></a><span class="hs-identifier">wordWidth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span>
</span><a name="line-193"></a><a name="wordWidth"><a href="CmmType.html#wordWidth"><span class="hs-identifier">wordWidth</span></a></a><span> </span><a name="local-6989586621681285366"><a href="#local-6989586621681285366"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-194"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#wORD_SIZE"><span class="hs-identifier hs-var">wORD_SIZE</span></a><span> </span><a href="#local-6989586621681285366"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span>
</span><a name="line-195"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#wORD_SIZE"><span class="hs-identifier hs-var">wORD_SIZE</span></a><span> </span><a href="#local-6989586621681285366"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span>
</span><a name="line-196"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;MachOp.wordRep: Unknown word size&quot;</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-identifier">halfWordWidth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span>
</span><a name="line-199"></a><a name="halfWordWidth"><a href="CmmType.html#halfWordWidth"><span class="hs-identifier">halfWordWidth</span></a></a><span> </span><a name="local-6989586621681285367"><a href="#local-6989586621681285367"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-200"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#wORD_SIZE"><span class="hs-identifier hs-var">wORD_SIZE</span></a><span> </span><a href="#local-6989586621681285367"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W16"><span class="hs-identifier hs-var">W16</span></a><span>
</span><a name="line-201"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#wORD_SIZE"><span class="hs-identifier hs-var">wORD_SIZE</span></a><span> </span><a href="#local-6989586621681285367"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span>
</span><a name="line-202"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;MachOp.halfWordRep: Unknown word size&quot;</span><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-identifier">halfWordMask</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-205"></a><a name="halfWordMask"><a href="CmmType.html#halfWordMask"><span class="hs-identifier">halfWordMask</span></a></a><span> </span><a name="local-6989586621681285368"><a href="#local-6989586621681285368"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-206"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#wORD_SIZE"><span class="hs-identifier hs-var">wORD_SIZE</span></a><span> </span><a href="#local-6989586621681285368"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0xFFFF</span><span>
</span><a name="line-207"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#wORD_SIZE"><span class="hs-identifier hs-var">wORD_SIZE</span></a><span> </span><a href="#local-6989586621681285368"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0xFFFFFFFF</span><span>
</span><a name="line-208"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;MachOp.halfWordMask: Unknown word size&quot;</span><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span class="hs-comment">-- cIntRep is the Width for a C-language 'int'</span><span>
</span><a name="line-211"></a><span class="hs-identifier">cIntWidth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span>
</span><a name="line-212"></a><a name="cIntWidth"><a href="CmmType.html#cIntWidth"><span class="hs-identifier">cIntWidth</span></a></a><span> </span><a name="local-6989586621681285369"><a href="#local-6989586621681285369"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="DynFlags.html#cINT_SIZE"><span class="hs-identifier hs-var">cINT_SIZE</span></a><span> </span><a href="#local-6989586621681285369"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-213"></a><span>                   </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span>
</span><a name="line-214"></a><span>                   </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span>
</span><a name="line-215"></a><span>                   </span><a name="local-6989586621681285370"><a href="#local-6989586621681285370"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;cIntWidth: Unknown cINT_SIZE: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621681285370"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-identifier">widthInBits</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-218"></a><a name="widthInBits"><a href="CmmType.html#widthInBits"><span class="hs-identifier">widthInBits</span></a></a><span> </span><a href="CmmType.html#W8"><span class="hs-identifier hs-var">W8</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-219"></a><span class="hs-identifier">widthInBits</span><span> </span><a href="CmmType.html#W16"><span class="hs-identifier hs-var">W16</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">16</span><span>
</span><a name="line-220"></a><span class="hs-identifier">widthInBits</span><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">32</span><span>
</span><a name="line-221"></a><span class="hs-identifier">widthInBits</span><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">64</span><span>
</span><a name="line-222"></a><span class="hs-identifier">widthInBits</span><span> </span><a href="CmmType.html#W128"><span class="hs-identifier hs-var">W128</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">128</span><span>
</span><a name="line-223"></a><span class="hs-identifier">widthInBits</span><span> </span><a href="CmmType.html#W256"><span class="hs-identifier hs-var">W256</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">256</span><span>
</span><a name="line-224"></a><span class="hs-identifier">widthInBits</span><span> </span><a href="CmmType.html#W512"><span class="hs-identifier hs-var">W512</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">512</span><span>
</span><a name="line-225"></a><span class="hs-identifier">widthInBits</span><span> </span><a href="CmmType.html#W80"><span class="hs-identifier hs-var">W80</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">80</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-identifier">widthInBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-228"></a><a name="widthInBytes"><a href="CmmType.html#widthInBytes"><span class="hs-identifier">widthInBytes</span></a></a><span> </span><a href="CmmType.html#W8"><span class="hs-identifier hs-var">W8</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-229"></a><span class="hs-identifier">widthInBytes</span><span> </span><a href="CmmType.html#W16"><span class="hs-identifier hs-var">W16</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-230"></a><span class="hs-identifier">widthInBytes</span><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-231"></a><span class="hs-identifier">widthInBytes</span><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-232"></a><span class="hs-identifier">widthInBytes</span><span> </span><a href="CmmType.html#W128"><span class="hs-identifier hs-var">W128</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">16</span><span>
</span><a name="line-233"></a><span class="hs-identifier">widthInBytes</span><span> </span><a href="CmmType.html#W256"><span class="hs-identifier hs-var">W256</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">32</span><span>
</span><a name="line-234"></a><span class="hs-identifier">widthInBytes</span><span> </span><a href="CmmType.html#W512"><span class="hs-identifier hs-var">W512</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">64</span><span>
</span><a name="line-235"></a><span class="hs-identifier">widthInBytes</span><span> </span><a href="CmmType.html#W80"><span class="hs-identifier hs-var">W80</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span class="hs-identifier">widthFromBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span>
</span><a name="line-238"></a><a name="widthFromBytes"><a href="CmmType.html#widthFromBytes"><span class="hs-identifier">widthFromBytes</span></a></a><span> </span><span class="hs-number">1</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W8"><span class="hs-identifier hs-var">W8</span></a><span>
</span><a name="line-239"></a><span class="hs-identifier">widthFromBytes</span><span> </span><span class="hs-number">2</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W16"><span class="hs-identifier hs-var">W16</span></a><span>
</span><a name="line-240"></a><span class="hs-identifier">widthFromBytes</span><span> </span><span class="hs-number">4</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span>
</span><a name="line-241"></a><span class="hs-identifier">widthFromBytes</span><span> </span><span class="hs-number">8</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span>
</span><a name="line-242"></a><span class="hs-identifier">widthFromBytes</span><span> </span><span class="hs-number">16</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W128"><span class="hs-identifier hs-var">W128</span></a><span>
</span><a name="line-243"></a><span class="hs-identifier">widthFromBytes</span><span> </span><span class="hs-number">32</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W256"><span class="hs-identifier hs-var">W256</span></a><span>
</span><a name="line-244"></a><span class="hs-identifier">widthFromBytes</span><span> </span><span class="hs-number">64</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W512"><span class="hs-identifier hs-var">W512</span></a><span>
</span><a name="line-245"></a><span class="hs-identifier">widthFromBytes</span><span> </span><span class="hs-number">10</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#W80"><span class="hs-identifier hs-var">W80</span></a><span>
</span><a name="line-246"></a><span class="hs-identifier">widthFromBytes</span><span> </span><a name="local-6989586621681285371"><a href="#local-6989586621681285371"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;no width for given number of bytes&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681285371"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span class="hs-comment">-- log_2 of the width in bytes, useful for generating shifts.</span><span>
</span><a name="line-249"></a><span class="hs-identifier">widthInLog</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-250"></a><a name="widthInLog"><a href="CmmType.html#widthInLog"><span class="hs-identifier">widthInLog</span></a></a><span> </span><a href="CmmType.html#W8"><span class="hs-identifier hs-var">W8</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-251"></a><span class="hs-identifier">widthInLog</span><span> </span><a href="CmmType.html#W16"><span class="hs-identifier hs-var">W16</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-252"></a><span class="hs-identifier">widthInLog</span><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-253"></a><span class="hs-identifier">widthInLog</span><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-254"></a><span class="hs-identifier">widthInLog</span><span> </span><a href="CmmType.html#W128"><span class="hs-identifier hs-var">W128</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-255"></a><span class="hs-identifier">widthInLog</span><span> </span><a href="CmmType.html#W256"><span class="hs-identifier hs-var">W256</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-256"></a><span class="hs-identifier">widthInLog</span><span> </span><a href="CmmType.html#W512"><span class="hs-identifier hs-var">W512</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-257"></a><span class="hs-identifier">widthInLog</span><span> </span><a href="CmmType.html#W80"><span class="hs-identifier hs-var">W80</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;widthInLog: F80&quot;</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-comment">-- widening / narrowing</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-identifier">narrowU</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-262"></a><a name="narrowU"><a href="CmmType.html#narrowU"><span class="hs-identifier">narrowU</span></a></a><span> </span><a href="CmmType.html#W8"><span class="hs-identifier hs-var">W8</span></a><span>  </span><a name="local-6989586621681285372"><a href="#local-6989586621681285372"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621681285372"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span class="hs-identifier">narrowU</span><span> </span><a href="CmmType.html#W16"><span class="hs-identifier hs-var">W16</span></a><span> </span><a name="local-6989586621681285373"><a href="#local-6989586621681285373"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621681285373"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word16</span><span class="hs-special">)</span><span>
</span><a name="line-264"></a><span class="hs-identifier">narrowU</span><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span> </span><a name="local-6989586621681285374"><a href="#local-6989586621681285374"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621681285374"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span class="hs-identifier">narrowU</span><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span> </span><a name="local-6989586621681285375"><a href="#local-6989586621681285375"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621681285375"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-266"></a><span class="hs-identifier">narrowU</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;narrowTo&quot;</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-identifier">narrowS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-269"></a><a name="narrowS"><a href="CmmType.html#narrowS"><span class="hs-identifier">narrowS</span></a></a><span> </span><a href="CmmType.html#W8"><span class="hs-identifier hs-var">W8</span></a><span>  </span><a name="local-6989586621681285376"><a href="#local-6989586621681285376"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621681285376"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int8</span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span class="hs-identifier">narrowS</span><span> </span><a href="CmmType.html#W16"><span class="hs-identifier hs-var">W16</span></a><span> </span><a name="local-6989586621681285377"><a href="#local-6989586621681285377"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621681285377"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int16</span><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span class="hs-identifier">narrowS</span><span> </span><a href="CmmType.html#W32"><span class="hs-identifier hs-var">W32</span></a><span> </span><a name="local-6989586621681285378"><a href="#local-6989586621681285378"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621681285378"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int32</span><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span class="hs-identifier">narrowS</span><span> </span><a href="CmmType.html#W64"><span class="hs-identifier hs-var">W64</span></a><span> </span><a name="local-6989586621681285379"><a href="#local-6989586621681285379"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621681285379"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int64</span><span class="hs-special">)</span><span>
</span><a name="line-273"></a><span class="hs-identifier">narrowS</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;narrowTo&quot;</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-276"></a><span class="hs-comment">--              SIMD</span><span>
</span><a name="line-277"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-keyword">type</span><span> </span><a name="Length"><a href="CmmType.html#Length"><span class="hs-identifier">Length</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-identifier">vec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#Length"><span class="hs-identifier hs-type">Length</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-282"></a><a name="vec"><a href="CmmType.html#vec"><span class="hs-identifier">vec</span></a></a><span> </span><a name="local-6989586621681285380"><a href="#local-6989586621681285380"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a name="local-6989586621681285381"><a href="#local-6989586621681285381"><span class="hs-identifier">cat</span></a></a><span> </span><a name="local-6989586621681285382"><a href="#local-6989586621681285382"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#VecCat"><span class="hs-identifier hs-var">VecCat</span></a><span> </span><a href="#local-6989586621681285380"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681285381"><span class="hs-identifier hs-var">cat</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681285383"><span class="hs-identifier hs-var">vecw</span></a><span>
</span><a name="line-283"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-284"></a><span>    </span><span class="hs-identifier">vecw</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span>
</span><a name="line-285"></a><span>    </span><a name="local-6989586621681285383"><a href="#local-6989586621681285383"><span class="hs-identifier">vecw</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#widthFromBytes"><span class="hs-identifier hs-var">widthFromBytes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681285380"><span class="hs-identifier hs-var">l</span></a><span class="hs-operator hs-var">*</span><a href="CmmType.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a><span> </span><a href="#local-6989586621681285382"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-identifier">vec2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vec4</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vec8</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vec16</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-288"></a><a name="vec2"><a href="CmmType.html#vec2"><span class="hs-identifier">vec2</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-289"></a><a name="vec4"><a href="CmmType.html#vec4"><span class="hs-identifier">vec4</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-number">4</span><span>
</span><a name="line-290"></a><a name="vec8"><a href="CmmType.html#vec8"><span class="hs-identifier">vec8</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-number">8</span><span>
</span><a name="line-291"></a><a name="vec16"><a href="CmmType.html#vec16"><span class="hs-identifier">vec16</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-number">16</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-identifier">vec2f64</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vec2b64</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vec4f32</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vec4b32</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vec8b16</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vec16b8</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-294"></a><a name="vec2f64"><a href="CmmType.html#vec2f64"><span class="hs-identifier">vec2f64</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="CmmType.html#f64"><span class="hs-identifier hs-var">f64</span></a><span>
</span><a name="line-295"></a><a name="vec2b64"><a href="CmmType.html#vec2b64"><span class="hs-identifier">vec2b64</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-number">2</span><span> </span><a href="CmmType.html#b64"><span class="hs-identifier hs-var">b64</span></a><span>
</span><a name="line-296"></a><a name="vec4f32"><a href="CmmType.html#vec4f32"><span class="hs-identifier">vec4f32</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-number">4</span><span> </span><a href="CmmType.html#f32"><span class="hs-identifier hs-var">f32</span></a><span>
</span><a name="line-297"></a><a name="vec4b32"><a href="CmmType.html#vec4b32"><span class="hs-identifier">vec4b32</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-number">4</span><span> </span><a href="CmmType.html#b32"><span class="hs-identifier hs-var">b32</span></a><span>
</span><a name="line-298"></a><a name="vec8b16"><a href="CmmType.html#vec8b16"><span class="hs-identifier">vec8b16</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-number">8</span><span> </span><a href="CmmType.html#b16"><span class="hs-identifier hs-var">b16</span></a><span>
</span><a name="line-299"></a><a name="vec16b8"><a href="CmmType.html#vec16b8"><span class="hs-identifier">vec16b8</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#vec"><span class="hs-identifier hs-var">vec</span></a><span> </span><span class="hs-number">16</span><span> </span><a href="CmmType.html#b8"><span class="hs-identifier hs-var">b8</span></a><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span class="hs-identifier">cmmVec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-302"></a><a name="cmmVec"><a href="CmmType.html#cmmVec"><span class="hs-identifier">cmmVec</span></a></a><span> </span><a name="local-6989586621681285384"><a href="#local-6989586621681285384"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a name="local-6989586621681285385"><a href="#local-6989586621681285385"><span class="hs-identifier">cat</span></a></a><span> </span><a name="local-6989586621681285386"><a href="#local-6989586621681285386"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-303"></a><span>    </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#VecCat"><span class="hs-identifier hs-var">VecCat</span></a><span> </span><a href="#local-6989586621681285384"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621681285385"><span class="hs-identifier hs-var">cat</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CmmType.html#widthFromBytes"><span class="hs-identifier hs-var">widthFromBytes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681285384"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">*</span><a href="CmmType.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a><span> </span><a href="#local-6989586621681285386"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-identifier">vecLength</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#Length"><span class="hs-identifier hs-type">Length</span></a><span>
</span><a name="line-306"></a><a name="vecLength"><a href="CmmType.html#vecLength"><span class="hs-identifier">vecLength</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#VecCat"><span class="hs-identifier hs-var">VecCat</span></a><span> </span><a name="local-6989586621681285387"><a href="#local-6989586621681285387"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681285387"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-307"></a><span class="hs-identifier">vecLength</span><span> </span><span class="hs-identifier">_</span><span>                        </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;vecLength: not a vector&quot;</span><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-identifier">vecElemType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-310"></a><a name="vecElemType"><a href="CmmType.html#vecElemType"><span class="hs-identifier">vecElemType</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#VecCat"><span class="hs-identifier hs-var">VecCat</span></a><span> </span><a name="local-6989586621681285388"><a href="#local-6989586621681285388"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681285389"><a href="#local-6989586621681285389"><span class="hs-identifier">cat</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681285390"><a href="#local-6989586621681285390"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><a href="#local-6989586621681285389"><span class="hs-identifier hs-var">cat</span></a><span> </span><a href="#local-6989586621681285391"><span class="hs-identifier hs-var">scalw</span></a><span>
</span><a name="line-311"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-312"></a><span>    </span><span class="hs-identifier">scalw</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#Width"><span class="hs-identifier hs-type">Width</span></a><span>
</span><a name="line-313"></a><span>    </span><a name="local-6989586621681285391"><a href="#local-6989586621681285391"><span class="hs-identifier">scalw</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#widthFromBytes"><span class="hs-identifier hs-var">widthFromBytes</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#widthInBytes"><span class="hs-identifier hs-var">widthInBytes</span></a><span> </span><a href="#local-6989586621681285390"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681285388"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-314"></a><span class="hs-identifier">vecElemType</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;vecElemType: not a vector&quot;</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-identifier">isVecType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-317"></a><a name="isVecType"><a href="CmmType.html#isVecType"><span class="hs-identifier">isVecType</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-var">CmmType</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#VecCat"><span class="hs-identifier hs-var">VecCat</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-318"></a><span class="hs-identifier">isVecType</span><span> </span><span class="hs-identifier">_</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-321"></a><span class="hs-comment">-- Hints</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span class="hs-comment">-- Hints are extra type information we attach to the arguments and</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- results of a foreign call, where more type information is sometimes</span><span>
</span><a name="line-325"></a><span class="hs-comment">-- needed by the ABI to make the correct kind of call.</span><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span class="hs-keyword">data</span><span> </span><a name="ForeignHint"><a href="CmmType.html#ForeignHint"><span class="hs-identifier">ForeignHint</span></a></a><span>
</span><a name="line-328"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NoHint"><a href="CmmType.html#NoHint"><span class="hs-identifier">NoHint</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="AddrHint"><a href="CmmType.html#AddrHint"><span class="hs-identifier">AddrHint</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="SignedHint"><a href="CmmType.html#SignedHint"><span class="hs-identifier">SignedHint</span></a></a><span>
</span><a name="line-329"></a><span>  </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>        </span><span class="hs-comment">-- Used to give extra per-argument or per-result</span><span>
</span><a name="line-331"></a><span>        </span><span class="hs-comment">-- information needed by foreign calling conventions</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-comment">-- These don't really belong here, but I don't know where is best to</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- put them.</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-identifier">rEP_CostCentreStack_mem_alloc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-339"></a><a name="rEP_CostCentreStack_mem_alloc"><a href="CmmType.html#rEP_CostCentreStack_mem_alloc"><span class="hs-identifier">rEP_CostCentreStack_mem_alloc</span></a></a><span> </span><a name="local-6989586621681285392"><a href="#local-6989586621681285392"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-340"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#widthFromBytes"><span class="hs-identifier hs-var">widthFromBytes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pc_REP_CostCentreStack_mem_alloc</span><span> </span><a href="#local-6989586621681285393"><span class="hs-identifier hs-var">pc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681285393"><a href="#local-6989586621681285393"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sPlatformConstants</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">settings</span><span> </span><a href="#local-6989586621681285392"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span class="hs-identifier">rEP_CostCentreStack_scc_count</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-344"></a><a name="rEP_CostCentreStack_scc_count"><a href="CmmType.html#rEP_CostCentreStack_scc_count"><span class="hs-identifier">rEP_CostCentreStack_scc_count</span></a></a><span> </span><a name="local-6989586621681285394"><a href="#local-6989586621681285394"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-345"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#widthFromBytes"><span class="hs-identifier hs-var">widthFromBytes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pc_REP_CostCentreStack_scc_count</span><span> </span><a href="#local-6989586621681285395"><span class="hs-identifier hs-var">pc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-346"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681285395"><a href="#local-6989586621681285395"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sPlatformConstants</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">settings</span><span> </span><a href="#local-6989586621681285394"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-identifier">rEP_StgEntCounter_allocs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-349"></a><a name="rEP_StgEntCounter_allocs"><a href="CmmType.html#rEP_StgEntCounter_allocs"><span class="hs-identifier">rEP_StgEntCounter_allocs</span></a></a><span> </span><a name="local-6989586621681285396"><a href="#local-6989586621681285396"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-350"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#widthFromBytes"><span class="hs-identifier hs-var">widthFromBytes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pc_REP_StgEntCounter_allocs</span><span> </span><a href="#local-6989586621681285397"><span class="hs-identifier hs-var">pc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681285397"><a href="#local-6989586621681285397"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sPlatformConstants</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">settings</span><span> </span><a href="#local-6989586621681285396"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-identifier">rEP_StgEntCounter_allocd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmType.html#CmmType"><span class="hs-identifier hs-type">CmmType</span></a><span>
</span><a name="line-354"></a><a name="rEP_StgEntCounter_allocd"><a href="CmmType.html#rEP_StgEntCounter_allocd"><span class="hs-identifier">rEP_StgEntCounter_allocd</span></a></a><span> </span><a name="local-6989586621681285398"><a href="#local-6989586621681285398"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-355"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CmmType.html#cmmBits"><span class="hs-identifier hs-var">cmmBits</span></a><span> </span><span class="hs-special">(</span><a href="CmmType.html#widthFromBytes"><span class="hs-identifier hs-var">widthFromBytes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pc_REP_StgEntCounter_allocd</span><span> </span><a href="#local-6989586621681285399"><span class="hs-identifier hs-var">pc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-356"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681285399"><a href="#local-6989586621681285399"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">sPlatformConstants</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">settings</span><span> </span><a href="#local-6989586621681285398"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-359"></a><span class="hs-comment">{-      Note [Signed vs unsigned]
        ~~~~~~~~~~~~~~~~~~~~~~~~~
Should a CmmType include a signed vs. unsigned distinction?

This is very much like a &quot;hint&quot; in C-- terminology: it isn't necessary
in order to generate correct code, but it might be useful in that the
compiler can generate better code if it has access to higher-level
hints about data.  This is important at call boundaries, because the
definition of a function is not visible at all of its call sites, so
the compiler cannot infer the hints.

Here in Cmm, we're taking a slightly different approach.  We include
the int vs. float hint in the CmmType, because (a) the majority of
platforms have a strong distinction between float and int registers,
and (b) we don't want to do any heavyweight hint-inference in the
native code backend in order to get good code.  We're treating the
hint more like a type: our Cmm is always completely consistent with
respect to hints.  All coercions between float and int are explicit.

What about the signed vs. unsigned hint?  This information might be
useful if we want to keep sub-word-sized values in word-size
registers, which we must do if we only have word-sized registers.

On such a system, there are two straightforward conventions for
representing sub-word-sized values:

(a) Leave the upper bits undefined.  Comparison operations must
    sign- or zero-extend both operands before comparing them,
    depending on whether the comparison is signed or unsigned.

(b) Always keep the values sign- or zero-extended as appropriate.
    Arithmetic operations must narrow the result to the appropriate
    size.

A clever compiler might not use either (a) or (b) exclusively, instead
it would attempt to minimize the coercions by analysis: the same kind
of analysis that propagates hints around.  In Cmm we don't want to
have to do this, so we plump for having richer types and keeping the
type information consistent.

If signed/unsigned hints are missing from CmmType, then the only
choice we have is (a), because we don't know whether the result of an
operation should be sign- or zero-extended.

Many architectures have extending load operations, which work well
with (b).  To make use of them with (a), you need to know whether the
value is going to be sign- or zero-extended by an enclosing comparison
(for example), which involves knowing above the context.  This is
doable but more complex.

Further complicating the issue is foreign calls: a foreign calling
convention can specify that signed 8-bit quantities are passed as
sign-extended 32 bit quantities, for example (this is the case on the
PowerPC).  So we *do* need sign information on foreign call arguments.

Pros for adding signed vs. unsigned to CmmType:

  - It would let us use convention (b) above, and get easier
    code generation for extending loads.

  - Less information required on foreign calls.

  - MachOp type would be simpler

Cons:

  - More complexity

  - What is the CmmType for a VanillaReg?  Currently it is
    always wordRep, but now we have to decide whether it is
    signed or unsigned.  The same VanillaReg can thus have
    different CmmType in different parts of the program.

  - Extra coercions cluttering up expressions.

Currently for GHC, the foreign call point is moot, because we do our
own promotion of sub-word-sized values to word-sized values.  The Int8
type is represented by an Int# which is kept sign-extended at all times
(this is slightly naughty, because we're making assumptions about the
C calling convention rather early on in the compiler).  However, given
this, the cons outweigh the pros.

-}</span><span>
</span><a name="line-442"></a><span>
</span><a name="line-443"></a></pre></body></html>