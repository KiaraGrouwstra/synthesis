<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1998
-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-7"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NameSet</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-8"></a><span>        </span><span class="hs-comment">-- * Names set type</span><span>
</span><a name="line-9"></a><span>        </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span>        </span><span class="hs-comment">-- ** Manipulating these sets</span><span>
</span><a name="line-12"></a><span>        </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unitNameSet"><span class="hs-identifier hs-var">unitNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unionNameSets"><span class="hs-identifier hs-var">unionNameSets</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="NameSet.html#minusNameSet"><span class="hs-identifier hs-var">minusNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#extendNameSetList"><span class="hs-identifier hs-var">extendNameSetList</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="NameSet.html#delFromNameSet"><span class="hs-identifier hs-var">delFromNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#delListFromNameSet"><span class="hs-identifier hs-var">delListFromNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#filterNameSet"><span class="hs-identifier hs-var">filterNameSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="NameSet.html#intersectsNameSet"><span class="hs-identifier hs-var">intersectsNameSet</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#intersectNameSet"><span class="hs-identifier hs-var">intersectNameSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="NameSet.html#nameSetAny"><span class="hs-identifier hs-var">nameSetAny</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#nameSetAll"><span class="hs-identifier hs-var">nameSetAll</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#nameSetElemsStable"><span class="hs-identifier hs-var">nameSetElemsStable</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span>        </span><span class="hs-comment">-- * Free variables</span><span>
</span><a name="line-19"></a><span>        </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>        </span><span class="hs-comment">-- ** Manipulating sets of free variables</span><span>
</span><a name="line-22"></a><span>        </span><a href="NameSet.html#isEmptyFVs"><span class="hs-identifier hs-var">isEmptyFVs</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyFVs"><span class="hs-identifier hs-var">emptyFVs</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#plusFVs"><span class="hs-identifier hs-var">plusFVs</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#plusFV"><span class="hs-identifier hs-var">plusFV</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="NameSet.html#mkFVs"><span class="hs-identifier hs-var">mkFVs</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#addOneFV"><span class="hs-identifier hs-var">addOneFV</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#unitFV"><span class="hs-identifier hs-var">unitFV</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#delFV"><span class="hs-identifier hs-var">delFV</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#delFVs"><span class="hs-identifier hs-var">delFVs</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="NameSet.html#intersectFVs"><span class="hs-identifier hs-var">intersectFVs</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>        </span><span class="hs-comment">-- * Defs and uses</span><span>
</span><a name="line-27"></a><span>        </span><a href="NameSet.html#Defs"><span class="hs-identifier hs-type">Defs</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#Uses"><span class="hs-identifier hs-type">Uses</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#DefUse"><span class="hs-identifier hs-type">DefUse</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>        </span><span class="hs-comment">-- ** Manipulating defs and uses</span><span>
</span><a name="line-30"></a><span>        </span><a href="NameSet.html#emptyDUs"><span class="hs-identifier hs-var">emptyDUs</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#usesOnly"><span class="hs-identifier hs-var">usesOnly</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#mkDUs"><span class="hs-identifier hs-var">mkDUs</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#plusDU"><span class="hs-identifier hs-var">plusDU</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="NameSet.html#findUses"><span class="hs-identifier hs-var">findUses</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#duDefs"><span class="hs-identifier hs-var">duDefs</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#duUses"><span class="hs-identifier hs-var">duUses</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#allUses"><span class="hs-identifier hs-var">allUses</span></a><span>
</span><a name="line-32"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSet.html"><span class="hs-identifier">UniqSet</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sortBy</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[Sets of names}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span class="hs-keyword">type</span><span> </span><a name="NameSet"><a href="NameSet.html#NameSet"><span class="hs-identifier">NameSet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-identifier">emptyNameSet</span><span>       </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-53"></a><span class="hs-identifier">unitNameSet</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-54"></a><span class="hs-identifier">extendNameSetList</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-55"></a><span class="hs-identifier">extendNameSet</span><span>    </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-56"></a><span class="hs-identifier">mkNameSet</span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-57"></a><span class="hs-identifier">unionNameSet</span><span>      </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-58"></a><span class="hs-identifier">unionNameSets</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-59"></a><span class="hs-identifier">minusNameSet</span><span>       </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-60"></a><span class="hs-identifier">elemNameSet</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-61"></a><span class="hs-identifier">isEmptyNameSet</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-62"></a><span class="hs-identifier">delFromNameSet</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-63"></a><span class="hs-identifier">delListFromNameSet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-64"></a><span class="hs-identifier">filterNameSet</span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-65"></a><span class="hs-identifier">intersectNameSet</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-66"></a><span class="hs-identifier">intersectsNameSet</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- ^ True if there is a non-empty intersection.</span><span>
</span><a name="line-68"></a><span class="hs-comment">-- @s1 `intersectsNameSet` s2@ doesn't compute @s2@ if @s1@ is empty</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><a name="isEmptyNameSet"><a href="NameSet.html#isEmptyNameSet"><span class="hs-identifier">isEmptyNameSet</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#isEmptyUniqSet"><span class="hs-identifier hs-var">isEmptyUniqSet</span></a><span>
</span><a name="line-71"></a><a name="emptyNameSet"><a href="NameSet.html#emptyNameSet"><span class="hs-identifier">emptyNameSet</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a><span>
</span><a name="line-72"></a><a name="unitNameSet"><a href="NameSet.html#unitNameSet"><span class="hs-identifier">unitNameSet</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#unitUniqSet"><span class="hs-identifier hs-var">unitUniqSet</span></a><span>
</span><a name="line-73"></a><a name="mkNameSet"><a href="NameSet.html#mkNameSet"><span class="hs-identifier">mkNameSet</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#mkUniqSet"><span class="hs-identifier hs-var">mkUniqSet</span></a><span>
</span><a name="line-74"></a><a name="extendNameSetList"><a href="NameSet.html#extendNameSetList"><span class="hs-identifier">extendNameSetList</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#addListToUniqSet"><span class="hs-identifier hs-var">addListToUniqSet</span></a><span>
</span><a name="line-75"></a><a name="extendNameSet"><a href="NameSet.html#extendNameSet"><span class="hs-identifier">extendNameSet</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#addOneToUniqSet"><span class="hs-identifier hs-var">addOneToUniqSet</span></a><span>
</span><a name="line-76"></a><a name="unionNameSet"><a href="NameSet.html#unionNameSet"><span class="hs-identifier">unionNameSet</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#unionUniqSets"><span class="hs-identifier hs-var">unionUniqSets</span></a><span>
</span><a name="line-77"></a><a name="unionNameSets"><a href="NameSet.html#unionNameSets"><span class="hs-identifier">unionNameSets</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#unionManyUniqSets"><span class="hs-identifier hs-var">unionManyUniqSets</span></a><span>
</span><a name="line-78"></a><a name="minusNameSet"><a href="NameSet.html#minusNameSet"><span class="hs-identifier">minusNameSet</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#minusUniqSet"><span class="hs-identifier hs-var">minusUniqSet</span></a><span>
</span><a name="line-79"></a><a name="elemNameSet"><a href="NameSet.html#elemNameSet"><span class="hs-identifier">elemNameSet</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#elementOfUniqSet"><span class="hs-identifier hs-var">elementOfUniqSet</span></a><span>
</span><a name="line-80"></a><a name="delFromNameSet"><a href="NameSet.html#delFromNameSet"><span class="hs-identifier">delFromNameSet</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#delOneFromUniqSet"><span class="hs-identifier hs-var">delOneFromUniqSet</span></a><span>
</span><a name="line-81"></a><a name="filterNameSet"><a href="NameSet.html#filterNameSet"><span class="hs-identifier">filterNameSet</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#filterUniqSet"><span class="hs-identifier hs-var">filterUniqSet</span></a><span>
</span><a name="line-82"></a><a name="intersectNameSet"><a href="NameSet.html#intersectNameSet"><span class="hs-identifier">intersectNameSet</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#intersectUniqSets"><span class="hs-identifier hs-var">intersectUniqSets</span></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><a name="delListFromNameSet"><a href="NameSet.html#delListFromNameSet"><span class="hs-identifier">delListFromNameSet</span></a></a><span> </span><a name="local-6989586621681172829"><a href="#local-6989586621681172829"><span class="hs-identifier">set</span></a></a><span> </span><a name="local-6989586621681172830"><a href="#local-6989586621681172830"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="NameSet.html#delFromNameSet"><span class="hs-identifier hs-var">delFromNameSet</span></a><span> </span><a href="#local-6989586621681172829"><span class="hs-identifier hs-var">set</span></a><span> </span><a href="#local-6989586621681172830"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><a name="intersectsNameSet"><a href="NameSet.html#intersectsNameSet"><span class="hs-identifier">intersectsNameSet</span></a></a><span> </span><a name="local-6989586621681172831"><a href="#local-6989586621681172831"><span class="hs-identifier">s1</span></a></a><span> </span><a name="local-6989586621681172832"><a href="#local-6989586621681172832"><span class="hs-identifier">s2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="NameSet.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681172831"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#intersectNameSet"><span class="hs-identifier hs-var">intersectNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681172832"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-identifier">nameSetAny</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-89"></a><a name="nameSetAny"><a href="NameSet.html#nameSetAny"><span class="hs-identifier">nameSetAny</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#uniqSetAny"><span class="hs-identifier hs-var">uniqSetAny</span></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-identifier">nameSetAll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-92"></a><a name="nameSetAll"><a href="NameSet.html#nameSetAll"><span class="hs-identifier">nameSetAll</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSet.html#uniqSetAll"><span class="hs-identifier hs-var">uniqSetAll</span></a><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-comment">-- | Get the elements of a NameSet with some stable ordering.</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- This only works for Names that originate in the source code or have been</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- tidied.</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- See Note [Deterministic UniqFM] to learn about nondeterminism</span><span>
</span><a name="line-98"></a><span class="hs-identifier">nameSetElemsStable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-99"></a><a name="nameSetElemsStable"><a href="NameSet.html#nameSetElemsStable"><span class="hs-identifier">nameSetElemsStable</span></a></a><span> </span><a name="local-6989586621681172833"><a href="#local-6989586621681172833"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-100"></a><span>  </span><span class="hs-identifier hs-var">sortBy</span><span> </span><a href="Name.html#stableNameCmp"><span class="hs-identifier hs-var">stableNameCmp</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="UniqSet.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a><span> </span><a href="#local-6989586621681172833"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-101"></a><span>  </span><span class="hs-comment">-- It's OK to use nonDetEltsUniqSet here because we immediately sort</span><span>
</span><a name="line-102"></a><span>  </span><span class="hs-comment">-- with stableNameCmp</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Free variables}
*                                                                      *
************************************************************************

These synonyms are useful when we are thinking of free variables
-}</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-keyword">type</span><span> </span><a name="FreeVars"><a href="NameSet.html#FreeVars"><span class="hs-identifier">FreeVars</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-identifier">plusFV</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span>
</span><a name="line-117"></a><span class="hs-identifier">addOneFV</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span>
</span><a name="line-118"></a><span class="hs-identifier">unitFV</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span>
</span><a name="line-119"></a><span class="hs-identifier">emptyFVs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span>
</span><a name="line-120"></a><span class="hs-identifier">plusFVs</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span>
</span><a name="line-121"></a><span class="hs-identifier">mkFVs</span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span>
</span><a name="line-122"></a><span class="hs-identifier">delFV</span><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span>
</span><a name="line-123"></a><span class="hs-identifier">delFVs</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span>
</span><a name="line-124"></a><span class="hs-identifier">intersectFVs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#FreeVars"><span class="hs-identifier hs-type">FreeVars</span></a><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-identifier">isEmptyFVs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-127"></a><a name="isEmptyFVs"><a href="NameSet.html#isEmptyFVs"><span class="hs-identifier">isEmptyFVs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#isEmptyNameSet"><span class="hs-identifier hs-var">isEmptyNameSet</span></a><span>
</span><a name="line-128"></a><a name="emptyFVs"><a href="NameSet.html#emptyFVs"><span class="hs-identifier">emptyFVs</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span>
</span><a name="line-129"></a><a name="plusFVs"><a href="NameSet.html#plusFVs"><span class="hs-identifier">plusFVs</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#unionNameSets"><span class="hs-identifier hs-var">unionNameSets</span></a><span>
</span><a name="line-130"></a><a name="plusFV"><a href="NameSet.html#plusFV"><span class="hs-identifier">plusFV</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span>
</span><a name="line-131"></a><a name="mkFVs"><a href="NameSet.html#mkFVs"><span class="hs-identifier">mkFVs</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a><span>
</span><a name="line-132"></a><a name="addOneFV"><a href="NameSet.html#addOneFV"><span class="hs-identifier">addOneFV</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a><span>
</span><a name="line-133"></a><a name="unitFV"><a href="NameSet.html#unitFV"><span class="hs-identifier">unitFV</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#unitNameSet"><span class="hs-identifier hs-var">unitNameSet</span></a><span>
</span><a name="line-134"></a><a name="delFV"><a href="NameSet.html#delFV"><span class="hs-identifier">delFV</span></a></a><span> </span><a name="local-6989586621681172834"><a href="#local-6989586621681172834"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681172835"><a href="#local-6989586621681172835"><span class="hs-identifier">s</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#delFromNameSet"><span class="hs-identifier hs-var">delFromNameSet</span></a><span> </span><a href="#local-6989586621681172835"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621681172834"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-135"></a><a name="delFVs"><a href="NameSet.html#delFVs"><span class="hs-identifier">delFVs</span></a></a><span> </span><a name="local-6989586621681172836"><a href="#local-6989586621681172836"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621681172837"><a href="#local-6989586621681172837"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#delListFromNameSet"><span class="hs-identifier hs-var">delListFromNameSet</span></a><span> </span><a href="#local-6989586621681172837"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621681172836"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-136"></a><a name="intersectFVs"><a href="NameSet.html#intersectFVs"><span class="hs-identifier">intersectFVs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#intersectNameSet"><span class="hs-identifier hs-var">intersectNameSet</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Defs and uses
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- | A set of names that are defined somewhere</span><span>
</span><a name="line-147"></a><span class="hs-keyword">type</span><span> </span><a name="Defs"><a href="NameSet.html#Defs"><span class="hs-identifier">Defs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span class="hs-comment">-- | A set of names that are used somewhere</span><span>
</span><a name="line-150"></a><span class="hs-keyword">type</span><span> </span><a name="Uses"><a href="NameSet.html#Uses"><span class="hs-identifier">Uses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-comment">-- | @(Just ds, us) =&gt;@ The use of any member of the @ds@</span><span>
</span><a name="line-153"></a><span class="hs-comment">--                      implies that all the @us@ are used too.</span><span>
</span><a name="line-154"></a><span class="hs-comment">--                      Also, @us@ may mention @ds@.</span><span>
</span><a name="line-155"></a><span class="hs-comment">--</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- @Nothing =&gt;@ Nothing is defined in this group, but</span><span>
</span><a name="line-157"></a><span class="hs-comment">--              nevertheless all the uses are essential.</span><span>
</span><a name="line-158"></a><span class="hs-comment">--              Used for instance declarations, for example</span><span>
</span><a name="line-159"></a><span class="hs-keyword">type</span><span> </span><a name="DefUse"><a href="NameSet.html#DefUse"><span class="hs-identifier">DefUse</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="NameSet.html#Defs"><span class="hs-identifier hs-type">Defs</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#Uses"><span class="hs-identifier hs-type">Uses</span></a><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-comment">-- | A number of 'DefUse's in dependency order: earlier 'Defs' scope over later 'Uses'</span><span>
</span><a name="line-162"></a><span class="hs-comment">--   In a single (def, use) pair, the defs also scope over the uses</span><span>
</span><a name="line-163"></a><span class="hs-keyword">type</span><span> </span><a name="DefUses"><a href="NameSet.html#DefUses"><span class="hs-identifier">DefUses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="NameSet.html#DefUse"><span class="hs-identifier hs-type">DefUse</span></a><span class="hs-special">]</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-identifier">emptyDUs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span>
</span><a name="line-166"></a><a name="emptyDUs"><a href="NameSet.html#emptyDUs"><span class="hs-identifier">emptyDUs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-identifier">usesOnly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#Uses"><span class="hs-identifier hs-type">Uses</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span>
</span><a name="line-169"></a><a name="usesOnly"><a href="NameSet.html#usesOnly"><span class="hs-identifier">usesOnly</span></a></a><span> </span><a name="local-6989586621681172838"><a href="#local-6989586621681172838"><span class="hs-identifier">uses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681172838"><span class="hs-identifier hs-var">uses</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-identifier">mkDUs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="NameSet.html#Defs"><span class="hs-identifier hs-type">Defs</span></a><span class="hs-special">,</span><a href="NameSet.html#Uses"><span class="hs-identifier hs-type">Uses</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span>
</span><a name="line-172"></a><a name="mkDUs"><a href="NameSet.html#mkDUs"><span class="hs-identifier">mkDUs</span></a></a><span> </span><a name="local-6989586621681172839"><a href="#local-6989586621681172839"><span class="hs-identifier">pairs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681172840"><span class="hs-identifier hs-var">defs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681172841"><span class="hs-identifier hs-var">uses</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681172840"><a href="#local-6989586621681172840"><span class="hs-identifier">defs</span></a></a><span class="hs-special">,</span><a name="local-6989586621681172841"><a href="#local-6989586621681172841"><span class="hs-identifier">uses</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681172839"><span class="hs-identifier hs-var">pairs</span></a><span class="hs-special">]</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-identifier">plusDU</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span>
</span><a name="line-175"></a><a name="plusDU"><a href="NameSet.html#plusDU"><span class="hs-identifier">plusDU</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-identifier">duDefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#Defs"><span class="hs-identifier hs-type">Defs</span></a><span>
</span><a name="line-178"></a><a name="duDefs"><a href="NameSet.html#duDefs"><span class="hs-identifier">duDefs</span></a></a><span> </span><a name="local-6989586621681172842"><a href="#local-6989586621681172842"><span class="hs-identifier">dus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621681172843"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span> </span><a href="#local-6989586621681172842"><span class="hs-identifier hs-var">dus</span></a><span>
</span><a name="line-179"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-180"></a><span>    </span><a name="local-6989586621681172843"><a href="#local-6989586621681172843"><span class="hs-identifier">get</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681172844"><a href="#local-6989586621681172844"><span class="hs-identifier">_u1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681172845"><a href="#local-6989586621681172845"><span class="hs-identifier">d2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681172845"><span class="hs-identifier hs-var">d2</span></a><span>
</span><a name="line-181"></a><span>    </span><span class="hs-identifier">get</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681172846"><a href="#local-6989586621681172846"><span class="hs-identifier">d1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681172847"><a href="#local-6989586621681172847"><span class="hs-identifier">_u1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681172848"><a href="#local-6989586621681172848"><span class="hs-identifier">d2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681172846"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681172848"><span class="hs-identifier hs-var">d2</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-identifier">allUses</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#Uses"><span class="hs-identifier hs-type">Uses</span></a><span>
</span><a name="line-184"></a><span class="hs-comment">-- ^ Just like 'duUses', but 'Defs' are not eliminated from the 'Uses' returned</span><span>
</span><a name="line-185"></a><a name="allUses"><a href="NameSet.html#allUses"><span class="hs-identifier">allUses</span></a></a><span> </span><a name="local-6989586621681172849"><a href="#local-6989586621681172849"><span class="hs-identifier">dus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621681172850"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span> </span><a href="#local-6989586621681172849"><span class="hs-identifier hs-var">dus</span></a><span>
</span><a name="line-186"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-187"></a><span>    </span><a name="local-6989586621681172850"><a href="#local-6989586621681172850"><span class="hs-identifier">get</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681172851"><a href="#local-6989586621681172851"><span class="hs-identifier">_d1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681172852"><a href="#local-6989586621681172852"><span class="hs-identifier">u1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681172853"><a href="#local-6989586621681172853"><span class="hs-identifier">u2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681172852"><span class="hs-identifier hs-var">u1</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681172853"><span class="hs-identifier hs-var">u2</span></a><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span class="hs-identifier">duUses</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#Uses"><span class="hs-identifier hs-type">Uses</span></a><span>
</span><a name="line-190"></a><span class="hs-comment">-- ^ Collect all 'Uses', regardless of whether the group is itself used,</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- but remove 'Defs' on the way</span><span>
</span><a name="line-192"></a><a name="duUses"><a href="NameSet.html#duUses"><span class="hs-identifier">duUses</span></a></a><span> </span><a name="local-6989586621681172854"><a href="#local-6989586621681172854"><span class="hs-identifier">dus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621681172855"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span> </span><a href="#local-6989586621681172854"><span class="hs-identifier hs-var">dus</span></a><span>
</span><a name="line-193"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-194"></a><span>    </span><a name="local-6989586621681172855"><a href="#local-6989586621681172855"><span class="hs-identifier">get</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>   </span><a name="local-6989586621681172856"><a href="#local-6989586621681172856"><span class="hs-identifier">rhs_uses</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681172857"><a href="#local-6989586621681172857"><span class="hs-identifier">uses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681172856"><span class="hs-identifier hs-var">rhs_uses</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681172857"><span class="hs-identifier hs-var">uses</span></a><span>
</span><a name="line-195"></a><span>    </span><span class="hs-identifier">get</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681172858"><a href="#local-6989586621681172858"><span class="hs-identifier">defs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681172859"><a href="#local-6989586621681172859"><span class="hs-identifier">rhs_uses</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681172860"><a href="#local-6989586621681172860"><span class="hs-identifier">uses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681172859"><span class="hs-identifier hs-var">rhs_uses</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681172860"><span class="hs-identifier hs-var">uses</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>                                     </span><span class="hs-special">`</span><a href="NameSet.html#minusNameSet"><span class="hs-identifier hs-var">minusNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681172858"><span class="hs-identifier hs-var">defs</span></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-identifier">findUses</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#Uses"><span class="hs-identifier hs-type">Uses</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameSet.html#Uses"><span class="hs-identifier hs-type">Uses</span></a><span>
</span><a name="line-199"></a><span class="hs-comment">-- ^ Given some 'DefUses' and some 'Uses', find all the uses, transitively.</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- The result is a superset of the input 'Uses'; and includes things defined</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- in the input 'DefUses' (but only if they are used)</span><span>
</span><a name="line-202"></a><a name="findUses"><a href="NameSet.html#findUses"><span class="hs-identifier">findUses</span></a></a><span> </span><a name="local-6989586621681172861"><a href="#local-6989586621681172861"><span class="hs-identifier">dus</span></a></a><span> </span><a name="local-6989586621681172862"><a href="#local-6989586621681172862"><span class="hs-identifier">uses</span></a></a><span>
</span><a name="line-203"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621681172863"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621681172862"><span class="hs-identifier hs-var">uses</span></a><span> </span><a href="#local-6989586621681172861"><span class="hs-identifier hs-var">dus</span></a><span>
</span><a name="line-204"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-205"></a><span>    </span><a name="local-6989586621681172863"><a href="#local-6989586621681172863"><span class="hs-identifier">get</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681172864"><a href="#local-6989586621681172864"><span class="hs-identifier">rhs_uses</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681172865"><a href="#local-6989586621681172865"><span class="hs-identifier">uses</span></a></a><span>
</span><a name="line-206"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681172864"><span class="hs-identifier hs-var">rhs_uses</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681172865"><span class="hs-identifier hs-var">uses</span></a><span>
</span><a name="line-207"></a><span>    </span><span class="hs-identifier">get</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681172866"><a href="#local-6989586621681172866"><span class="hs-identifier">defs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681172867"><a href="#local-6989586621681172867"><span class="hs-identifier">rhs_uses</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681172868"><a href="#local-6989586621681172868"><span class="hs-identifier">uses</span></a></a><span>
</span><a name="line-208"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681172866"><span class="hs-identifier hs-var">defs</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#intersectsNameSet"><span class="hs-identifier hs-var">intersectsNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681172868"><span class="hs-identifier hs-var">uses</span></a><span>         </span><span class="hs-comment">-- Used</span><span>
</span><a name="line-209"></a><span>        </span><span class="hs-operator hs-var">||</span><span> </span><a href="NameSet.html#nameSetAny"><span class="hs-identifier hs-var">nameSetAny</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#startsWithUnderscore"><span class="hs-identifier hs-var">startsWithUnderscore</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681172866"><span class="hs-identifier hs-var">defs</span></a><span>
</span><a name="line-210"></a><span>                </span><span class="hs-comment">-- At least one starts with an &quot;_&quot;,</span><span>
</span><a name="line-211"></a><span>                </span><span class="hs-comment">-- so treat the group as used</span><span>
</span><a name="line-212"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681172867"><span class="hs-identifier hs-var">rhs_uses</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#unionNameSet"><span class="hs-identifier hs-var">unionNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681172868"><span class="hs-identifier hs-var">uses</span></a><span>
</span><a name="line-213"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-comment">-- No def is used</span><span>
</span><a name="line-214"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681172868"><span class="hs-identifier hs-var">uses</span></a><span>
</span><a name="line-215"></a></pre></body></html>