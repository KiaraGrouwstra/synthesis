<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- (c) The University of Glasgow 2006</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE CPP, ScopedTypeVariables, ViewPatterns #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Digraph</span><span class="hs-special">(</span><span>
</span><a name="line-7"></a><span>        </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span class="hs-special">,</span><span> </span><a href="Digraph.html#graphFromEdgedVerticesOrd"><span class="hs-identifier hs-var">graphFromEdgedVerticesOrd</span></a><span class="hs-special">,</span><span> </span><a href="Digraph.html#graphFromEdgedVerticesUniq"><span class="hs-identifier hs-var">graphFromEdgedVerticesUniq</span></a><span class="hs-special">,</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span>        </span><span class="hs-identifier hs-type">SCC</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">flattenSCC</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">flattenSCCs</span><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>        </span><a href="Digraph.html#stronglyConnCompG"><span class="hs-identifier hs-var">stronglyConnCompG</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>        </span><a href="Digraph.html#topologicalSortG"><span class="hs-identifier hs-var">topologicalSortG</span></a><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>        </span><a href="Digraph.html#verticesG"><span class="hs-identifier hs-var">verticesG</span></a><span class="hs-special">,</span><span> </span><a href="Digraph.html#edgesG"><span class="hs-identifier hs-var">edgesG</span></a><span class="hs-special">,</span><span> </span><a href="Digraph.html#hasVertexG"><span class="hs-identifier hs-var">hasVertexG</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>        </span><a href="Digraph.html#reachableG"><span class="hs-identifier hs-var">reachableG</span></a><span class="hs-special">,</span><span> </span><a href="Digraph.html#reachablesG"><span class="hs-identifier hs-var">reachablesG</span></a><span class="hs-special">,</span><span> </span><a href="Digraph.html#transposeG"><span class="hs-identifier hs-var">transposeG</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="Digraph.html#emptyG"><span class="hs-identifier hs-var">emptyG</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>
</span><a name="line-16"></a><span>        </span><a href="Digraph.html#findCycle"><span class="hs-identifier hs-var">findCycle</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span>        </span><span class="hs-comment">-- For backwards compatibility with the simpler version of Digraph</span><span>
</span><a name="line-19"></a><span>        </span><a href="Digraph.html#stronglyConnCompFromEdgedVerticesOrd"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesOrd</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>        </span><a href="Digraph.html#stronglyConnCompFromEdgedVerticesOrdR"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesOrdR</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="Digraph.html#stronglyConnCompFromEdgedVerticesUniq"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesUniq</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="Digraph.html#stronglyConnCompFromEdgedVerticesUniqR"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesUniqR</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>        </span><span class="hs-comment">-- Simple way to classify edges</span><span>
</span><a name="line-25"></a><span>        </span><a href="Digraph.html#EdgeType"><span class="hs-identifier hs-type">EdgeType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Digraph.html#classifyEdges"><span class="hs-identifier hs-var">classifyEdges</span></a><span>
</span><a name="line-26"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-30"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- A version of the graph algorithms described in:</span><span>
</span><a name="line-32"></a><span class="hs-comment">--</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- ``Lazy Depth-First Search and Linear IntGraph Algorithms in Haskell''</span><span>
</span><a name="line-34"></a><span class="hs-comment">--   by David King and John Launchbury</span><span>
</span><a name="line-35"></a><span class="hs-comment">--</span><span>
</span><a name="line-36"></a><span class="hs-comment">-- Also included is some additional code for printing tree structures ...</span><span>
</span><a name="line-37"></a><span class="hs-comment">--</span><span>
</span><a name="line-38"></a><span class="hs-comment">-- If you ever find yourself in need of algorithms for classifying edges,</span><span>
</span><a name="line-39"></a><span class="hs-comment">-- or finding connected/biconnected components, consult the history; Sigbjorn</span><span>
</span><a name="line-40"></a><span class="hs-comment">-- Finne contributed some implementations in 1997, although we've since</span><span>
</span><a name="line-41"></a><span class="hs-comment">-- removed them since they were not used anywhere in GHC.</span><span>
</span><a name="line-42"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="Util.html#minWith"><span class="hs-identifier hs-var">minWith</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#count"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>      </span><span class="hs-special">(</span><span> </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-comment">-- std interfaces</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Array</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">transpose</span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Graph</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">G</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Graph</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Graph</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Edge</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">transposeG</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">reachable</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Tree</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
*      Graphs and Graph Construction
*                                                                      *
************************************************************************

Note [Nodes, keys, vertices]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * A 'node' is a big blob of client-stuff

 * Each 'node' has a unique (client) 'key', but the latter
        is in Ord and has fast comparison

 * Digraph then maps each 'key' to a Vertex (Int) which is
        arranged densely in 0.n
-}</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-keyword">data</span><span> </span><a name="Graph"><a href="Digraph.html#Graph"><span class="hs-identifier">Graph</span></a></a><span> </span><a name="local-6989586621680508728"><a href="#local-6989586621680508728"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Graph"><a href="Digraph.html#Graph"><span class="hs-identifier">Graph</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-83"></a><span>    </span><a name="gr_int_graph"><a href="Digraph.html#gr_int_graph"><span class="hs-identifier">gr_int_graph</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#IntGraph"><span class="hs-identifier hs-type">IntGraph</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>    </span><a name="gr_vertex_to_node"><a href="Digraph.html#gr_vertex_to_node"><span class="hs-identifier">gr_vertex_to_node</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Vertex</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680508728"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>    </span><a name="gr_node_to_vertex"><a href="Digraph.html#gr_node_to_vertex"><span class="hs-identifier">gr_node_to_vertex</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680508728"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Vertex</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-keyword">data</span><span> </span><a name="Edge"><a href="Digraph.html#Edge"><span class="hs-identifier">Edge</span></a></a><span> </span><a name="local-6989586621680508727"><a href="#local-6989586621680508727"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Edge"><a href="Digraph.html#Edge"><span class="hs-identifier">Edge</span></a></a><span> </span><a href="#local-6989586621680508727"><span class="hs-identifier hs-type">node</span></a><span> </span><a href="#local-6989586621680508727"><span class="hs-identifier hs-type">node</span></a><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-comment">{-| Representation for nodes of the Graph.

 * The @payload@ is user data, just carried around in this module

 * The @key@ is the node identifier.
   Key has an Ord instance for performance reasons.

 * The @[key]@ are the dependencies of the node;
   it's ok to have extra keys in the dependencies that
   are not the key of any Node in the graph
-}</span><span>
</span><a name="line-101"></a><span class="hs-keyword">data</span><span> </span><a name="Node"><a href="Digraph.html#Node"><span class="hs-identifier">Node</span></a></a><span> </span><a name="local-6989586621680508725"><a href="#local-6989586621680508725"><span class="hs-identifier">key</span></a></a><span> </span><a name="local-6989586621680508726"><a href="#local-6989586621680508726"><span class="hs-identifier">payload</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DigraphNode"><a href="Digraph.html#DigraphNode"><span class="hs-identifier">DigraphNode</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-102"></a><span>      </span><a name="node_payload"><a href="Digraph.html#node_payload"><span class="hs-identifier">node_payload</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680508726"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ User data</span><span>
</span><a name="line-103"></a><span>      </span><a name="node_key"><a href="Digraph.html#node_key"><span class="hs-identifier">node_key</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621680508725"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ User defined node id</span><span>
</span><a name="line-104"></a><span>      </span><a name="node_dependencies"><a href="Digraph.html#node_dependencies"><span class="hs-identifier">node_dependencies</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508725"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Dependencies/successors of the node</span><span>
</span><a name="line-105"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621680508734"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621680508735"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><span class="hs-special">(</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span>  </span><a href="#local-6989586621680508734"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621680508735"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-109"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="Digraph.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a><span> </span><a name="local-6989586621680508736"><a href="#local-6989586621680508736"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621680508737"><a href="#local-6989586621680508737"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621680508738"><a href="#local-6989586621680508738"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508736"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508737"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508738"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-identifier">emptyGraph</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508774"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-112"></a><a name="emptyGraph"><a href="Digraph.html#emptyGraph"><span class="hs-identifier">emptyGraph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-var">Graph</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">array</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;emptyGraph&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-comment">-- See Note [Deterministic SCC]</span><span>
</span><a name="line-115"></a><span class="hs-identifier">graphFromEdgedVertices</span><span>
</span><a name="line-116"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#ReduceFn"><span class="hs-identifier hs-type">ReduceFn</span></a><span> </span><a href="#local-6989586621680508772"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508773"><span class="hs-identifier hs-type">payload</span></a><span>
</span><a name="line-117"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508772"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508773"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- The graph; its ok for the</span><span>
</span><a name="line-118"></a><span>                                        </span><span class="hs-comment">-- out-list to contain keys which aren't</span><span>
</span><a name="line-119"></a><span>                                        </span><span class="hs-comment">-- a vertex key, they are ignored</span><span>
</span><a name="line-120"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><span class="hs-special">(</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508772"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508773"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">)</span><span>
</span><a name="line-121"></a><a name="graphFromEdgedVertices"><a href="Digraph.html#graphFromEdgedVertices"><span class="hs-identifier">graphFromEdgedVertices</span></a></a><span> </span><a name="local-6989586621680508775"><a href="#local-6989586621680508775"><span class="hs-identifier">_reduceFn</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#emptyGraph"><span class="hs-identifier hs-var">emptyGraph</span></a><span>
</span><a name="line-122"></a><span class="hs-identifier">graphFromEdgedVertices</span><span> </span><a name="local-6989586621680508776"><a href="#local-6989586621680508776"><span class="hs-identifier">reduceFn</span></a></a><span> </span><a name="local-6989586621680508777"><a href="#local-6989586621680508777"><span class="hs-identifier">edged_vertices</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-123"></a><span>  </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-var">Graph</span></a><span> </span><a href="#local-6989586621680508783"><span class="hs-identifier hs-var">graph</span></a><span> </span><a href="#local-6989586621680508780"><span class="hs-identifier hs-var">vertex_fn</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508781"><span class="hs-identifier hs-var">key_vertex</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621680508778"><span class="hs-identifier hs-var">key_extractor</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680508778"><a href="#local-6989586621680508778"><span class="hs-identifier">key_extractor</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">node_key</span><span>
</span><a name="line-125"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621680508779"><a href="#local-6989586621680508779"><span class="hs-identifier">bounds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680508780"><a href="#local-6989586621680508780"><span class="hs-identifier">vertex_fn</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680508781"><a href="#local-6989586621680508781"><span class="hs-identifier">key_vertex</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680508782"><a href="#local-6989586621680508782"><span class="hs-identifier">numbered_nodes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-126"></a><span>          </span><a href="#local-6989586621680508776"><span class="hs-identifier hs-var">reduceFn</span></a><span> </span><a href="#local-6989586621680508777"><span class="hs-identifier hs-var">edged_vertices</span></a><span> </span><a href="#local-6989586621680508778"><span class="hs-identifier hs-var">key_extractor</span></a><span>
</span><a name="line-127"></a><span>        </span><a name="local-6989586621680508783"><a href="#local-6989586621680508783"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">array</span><span> </span><a href="#local-6989586621680508779"><span class="hs-identifier hs-var">bounds</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508784"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><a href="#local-6989586621680508781"><span class="hs-identifier hs-var">key_vertex</span></a><span> </span><a href="#local-6989586621680508785"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>                             </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680508784"><a href="#local-6989586621680508784"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">node_dependencies</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a name="local-6989586621680508785"><a href="#local-6989586621680508785"><span class="hs-identifier">ks</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680508782"><span class="hs-identifier hs-var">numbered_nodes</span></a><span class="hs-special">]</span><span>
</span><a name="line-129"></a><span>                </span><span class="hs-comment">-- We normalize outgoing edges by sorting on node order, so</span><span>
</span><a name="line-130"></a><span>                </span><span class="hs-comment">-- that the result doesn't depend on the order of the edges</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-comment">-- See Note [Deterministic SCC]</span><span>
</span><a name="line-133"></a><span class="hs-comment">-- See Note [reduceNodesIntoVertices implementations]</span><span>
</span><a name="line-134"></a><span class="hs-identifier">graphFromEdgedVerticesOrd</span><span>
</span><a name="line-135"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621680508770"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-136"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508770"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508771"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- The graph; its ok for the</span><span>
</span><a name="line-137"></a><span>                                        </span><span class="hs-comment">-- out-list to contain keys which aren't</span><span>
</span><a name="line-138"></a><span>                                        </span><span class="hs-comment">-- a vertex key, they are ignored</span><span>
</span><a name="line-139"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><span class="hs-special">(</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508770"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508771"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><a name="graphFromEdgedVerticesOrd"><a href="Digraph.html#graphFromEdgedVerticesOrd"><span class="hs-identifier">graphFromEdgedVerticesOrd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#graphFromEdgedVertices"><span class="hs-identifier hs-var">graphFromEdgedVertices</span></a><span> </span><a href="Digraph.html#reduceNodesIntoVerticesOrd"><span class="hs-identifier hs-var">reduceNodesIntoVerticesOrd</span></a><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">-- See Note [Deterministic SCC]</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- See Note [reduceNodesIntoVertices implementations]</span><span>
</span><a name="line-144"></a><span class="hs-identifier">graphFromEdgedVerticesUniq</span><span>
</span><a name="line-145"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="#local-6989586621680508768"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-146"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508768"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508769"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- The graph; its ok for the</span><span>
</span><a name="line-147"></a><span>                                        </span><span class="hs-comment">-- out-list to contain keys which aren't</span><span>
</span><a name="line-148"></a><span>                                        </span><span class="hs-comment">-- a vertex key, they are ignored</span><span>
</span><a name="line-149"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><span class="hs-special">(</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508768"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508769"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">)</span><span>
</span><a name="line-150"></a><a name="graphFromEdgedVerticesUniq"><a href="Digraph.html#graphFromEdgedVerticesUniq"><span class="hs-identifier">graphFromEdgedVerticesUniq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#graphFromEdgedVertices"><span class="hs-identifier hs-var">graphFromEdgedVertices</span></a><span> </span><a href="Digraph.html#reduceNodesIntoVerticesUniq"><span class="hs-identifier hs-var">reduceNodesIntoVerticesUniq</span></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-keyword">type</span><span> </span><a name="ReduceFn"><a href="Digraph.html#ReduceFn"><span class="hs-identifier">ReduceFn</span></a></a><span> </span><a name="local-6989586621680508723"><a href="#local-6989586621680508723"><span class="hs-identifier">key</span></a></a><span> </span><a name="local-6989586621680508724"><a href="#local-6989586621680508724"><span class="hs-identifier">payload</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-153"></a><span>  </span><span class="hs-special">[</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508723"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508724"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508723"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508724"><span class="hs-identifier hs-type">payload</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680508723"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-154"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bounds</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Vertex</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508723"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508724"><span class="hs-identifier hs-type">payload</span></a><span>
</span><a name="line-155"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508723"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Vertex</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vertex</span><span class="hs-special">,</span><span> </span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508723"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508724"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">{-
Note [reduceNodesIntoVertices implementations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
reduceNodesIntoVertices is parameterized by the container type.
This is to accomodate key types that don't have an Ord instance
and hence preclude the use of Data.Map. An example of such type
would be Unique, there's no way to implement Ord Unique
deterministically.

For such types, there's a version with a Uniquable constraint.
This leaves us with two versions of every function that depends on
reduceNodesIntoVertices, one with Ord constraint and the other with
Uniquable constraint.
For example: graphFromEdgedVerticesOrd and graphFromEdgedVerticesUniq.

The Uniq version should be a tiny bit more efficient since it uses
Data.IntMap internally.
-}</span><span>
</span><a name="line-175"></a><span class="hs-identifier">reduceNodesIntoVertices</span><span>
</span><a name="line-176"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680508765"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Vertex</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680508766"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-177"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508765"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680508766"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Vertex</span><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Digraph.html#ReduceFn"><span class="hs-identifier hs-type">ReduceFn</span></a><span> </span><a href="#local-6989586621680508765"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508767"><span class="hs-identifier hs-type">payload</span></a><span>
</span><a name="line-179"></a><a name="reduceNodesIntoVertices"><a href="Digraph.html#reduceNodesIntoVertices"><span class="hs-identifier">reduceNodesIntoVertices</span></a></a><span> </span><a name="local-6989586621680508786"><a href="#local-6989586621680508786"><span class="hs-identifier">fromList</span></a></a><span> </span><a name="local-6989586621680508787"><a href="#local-6989586621680508787"><span class="hs-identifier">lookup</span></a></a><span> </span><a name="local-6989586621680508788"><a href="#local-6989586621680508788"><span class="hs-identifier">nodes</span></a></a><span> </span><a name="local-6989586621680508789"><a href="#local-6989586621680508789"><span class="hs-identifier">key_extractor</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-180"></a><span>  </span><span class="hs-special">(</span><a href="#local-6989586621680508791"><span class="hs-identifier hs-var">bounds</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621680508793"><span class="hs-identifier hs-var">vertex_map</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508795"><span class="hs-identifier hs-var">key_vertex</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508792"><span class="hs-identifier hs-var">numbered_nodes</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-182"></a><span>    </span><a name="local-6989586621680508790"><a href="#local-6989586621680508790"><span class="hs-identifier">max_v</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621680508788"><span class="hs-identifier hs-var">nodes</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-183"></a><span>    </span><a name="local-6989586621680508791"><a href="#local-6989586621680508791"><span class="hs-identifier">bounds</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508790"><span class="hs-identifier hs-var">max_v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Vertex</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Vertex</span><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>    </span><span class="hs-comment">-- Keep the order intact to make the result depend on input order</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-comment">-- instead of key order</span><span>
</span><a name="line-187"></a><span>    </span><a name="local-6989586621680508792"><a href="#local-6989586621680508792"><span class="hs-identifier">numbered_nodes</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621680508788"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-188"></a><span>    </span><a name="local-6989586621680508793"><a href="#local-6989586621680508793"><span class="hs-identifier">vertex_map</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">array</span><span> </span><a href="#local-6989586621680508791"><span class="hs-identifier hs-var">bounds</span></a><span> </span><a href="#local-6989586621680508792"><span class="hs-identifier hs-var">numbered_nodes</span></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span>    </span><a name="local-6989586621680508794"><a href="#local-6989586621680508794"><span class="hs-identifier">key_map</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508786"><span class="hs-identifier hs-var">fromList</span></a><span>
</span><a name="line-191"></a><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508789"><span class="hs-identifier hs-var">key_extractor</span></a><span> </span><a href="#local-6989586621680508797"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508796"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680508796"><a href="#local-6989586621680508796"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680508797"><a href="#local-6989586621680508797"><span class="hs-identifier">node</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680508792"><span class="hs-identifier hs-var">numbered_nodes</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-192"></a><span>    </span><a name="local-6989586621680508795"><a href="#local-6989586621680508795"><span class="hs-identifier">key_vertex</span></a></a><span> </span><a name="local-6989586621680508798"><a href="#local-6989586621680508798"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508787"><span class="hs-identifier hs-var">lookup</span></a><span> </span><a href="#local-6989586621680508798"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621680508794"><span class="hs-identifier hs-var">key_map</span></a><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-comment">-- See Note [reduceNodesIntoVertices implementations]</span><span>
</span><a name="line-195"></a><span class="hs-identifier">reduceNodesIntoVerticesOrd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621680508763"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Digraph.html#ReduceFn"><span class="hs-identifier hs-type">ReduceFn</span></a><span> </span><a href="#local-6989586621680508763"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508764"><span class="hs-identifier hs-type">payload</span></a><span>
</span><a name="line-196"></a><a name="reduceNodesIntoVerticesOrd"><a href="Digraph.html#reduceNodesIntoVerticesOrd"><span class="hs-identifier">reduceNodesIntoVerticesOrd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#reduceNodesIntoVertices"><span class="hs-identifier hs-var">reduceNodesIntoVertices</span></a><span> </span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">-- See Note [reduceNodesIntoVertices implementations]</span><span>
</span><a name="line-199"></a><span class="hs-identifier">reduceNodesIntoVerticesUniq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="#local-6989586621680508761"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Digraph.html#ReduceFn"><span class="hs-identifier hs-type">ReduceFn</span></a><span> </span><a href="#local-6989586621680508761"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508762"><span class="hs-identifier hs-type">payload</span></a><span>
</span><a name="line-200"></a><a name="reduceNodesIntoVerticesUniq"><a href="Digraph.html#reduceNodesIntoVerticesUniq"><span class="hs-identifier">reduceNodesIntoVerticesUniq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#reduceNodesIntoVertices"><span class="hs-identifier hs-var">reduceNodesIntoVertices</span></a><span> </span><a href="UniqFM.html#listToUFM"><span class="hs-identifier hs-var">listToUFM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
*      SCC
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span class="hs-keyword">type</span><span> </span><a name="WorkItem"><a href="Digraph.html#WorkItem"><span class="hs-identifier">WorkItem</span></a></a><span> </span><a name="local-6989586621680508721"><a href="#local-6989586621680508721"><span class="hs-identifier">key</span></a></a><span> </span><a name="local-6989586621680508722"><a href="#local-6989586621680508722"><span class="hs-identifier">payload</span></a></a><span>
</span><a name="line-211"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508721"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508722"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- Tip of the path</span><span>
</span><a name="line-212"></a><span>     </span><span class="hs-special">[</span><a href="#local-6989586621680508722"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Rest of the path;</span><span>
</span><a name="line-213"></a><span>                        </span><span class="hs-comment">--  [a,b,c] means c depends on b, b depends on a</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-comment">-- | Find a reasonably short cycle a-&gt;b-&gt;c-&gt;a, in a strongly</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- connected component.  The input nodes are presumed to be</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- a SCC, so you can start anywhere.</span><span>
</span><a name="line-218"></a><span class="hs-identifier">findCycle</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621680508759"><a href="#local-6989586621680508759"><span class="hs-identifier">payload</span></a></a><span> </span><a name="local-6989586621680508760"><a href="#local-6989586621680508760"><span class="hs-identifier">key</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621680508760"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-219"></a><span>          </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508760"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508759"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- The nodes.  The dependencies can</span><span>
</span><a name="line-220"></a><span>                                    </span><span class="hs-comment">-- contain extra keys, which are ignored</span><span>
</span><a name="line-221"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508759"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- A cycle, starting with node</span><span>
</span><a name="line-222"></a><span>                                    </span><span class="hs-comment">-- so each depends on the next</span><span>
</span><a name="line-223"></a><a name="findCycle"><a href="Digraph.html#findCycle"><span class="hs-identifier">findCycle</span></a></a><span> </span><a name="local-6989586621680508799"><a href="#local-6989586621680508799"><span class="hs-identifier">graph</span></a></a><span>
</span><a name="line-224"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508805"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">Set.empty</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508806"><span class="hs-identifier hs-var">new_work</span></a><span> </span><a href="#local-6989586621680508804"><span class="hs-identifier hs-var">root_deps</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-225"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-226"></a><span>    </span><span class="hs-identifier">env</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="#local-6989586621680508760"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-special">(</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508760"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508759"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">)</span><span>
</span><a name="line-227"></a><span>    </span><a name="local-6989586621680508800"><a href="#local-6989586621680508800"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">node_key</span><span> </span><a href="#local-6989586621680508807"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508807"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680508807"><a href="#local-6989586621680508807"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680508799"><span class="hs-identifier hs-var">graph</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-228"></a><span>
</span><a name="line-229"></a><span>    </span><span class="hs-comment">-- Find the node with fewest dependencies among the SCC modules</span><span>
</span><a name="line-230"></a><span>    </span><span class="hs-comment">-- This is just a heuristic to find some plausible root module</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-identifier">root</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508760"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508759"><span class="hs-identifier hs-type">payload</span></a><span>
</span><a name="line-232"></a><span>    </span><a name="local-6989586621680508801"><a href="#local-6989586621680508801"><span class="hs-identifier">root</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><a href="Util.html#minWith"><span class="hs-identifier hs-var">minWith</span></a><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508808"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">,</span><span> </span><a href="Util.html#count"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">Map.member</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680508800"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>                                           </span><span class="hs-special">(</span><span class="hs-identifier">node_dependencies</span><span> </span><a href="#local-6989586621680508808"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621680508808"><a href="#local-6989586621680508808"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621680508799"><span class="hs-identifier hs-var">graph</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>    </span><a href="Digraph.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a><span> </span><a name="local-6989586621680508802"><a href="#local-6989586621680508802"><span class="hs-identifier">root_payload</span></a></a><span> </span><a name="local-6989586621680508803"><a href="#local-6989586621680508803"><span class="hs-identifier">root_key</span></a></a><span> </span><a name="local-6989586621680508804"><a href="#local-6989586621680508804"><span class="hs-identifier">root_deps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508801"><span class="hs-identifier hs-var">root</span></a><span>
</span><a name="line-236"></a><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span>    </span><span class="hs-comment">-- 'go' implements Dijkstra's algorithm, more or less</span><span>
</span><a name="line-239"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Set.Set</span><span> </span><a href="#local-6989586621680508760"><span class="hs-identifier hs-type">key</span></a><span>   </span><span class="hs-comment">-- Visited</span><span>
</span><a name="line-240"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#WorkItem"><span class="hs-identifier hs-type">WorkItem</span></a><span> </span><a href="#local-6989586621680508760"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508759"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Work list, items length n</span><span>
</span><a name="line-241"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#WorkItem"><span class="hs-identifier hs-type">WorkItem</span></a><span> </span><a href="#local-6989586621680508760"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508759"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Work list, items length n+1</span><span>
</span><a name="line-242"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508759"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Returned cycle</span><span>
</span><a name="line-243"></a><span>       </span><span class="hs-comment">-- Invariant: in a call (go visited ps qs),</span><span>
</span><a name="line-244"></a><span>       </span><span class="hs-comment">--            visited = union (map tail (ps ++ qs))</span><span>
</span><a name="line-245"></a><span>
</span><a name="line-246"></a><span>    </span><a name="local-6989586621680508805"><a href="#local-6989586621680508805"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-comment">-- No cycles</span><span>
</span><a name="line-247"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680508809"><a href="#local-6989586621680508809"><span class="hs-identifier">visited</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621680508810"><a href="#local-6989586621680508810"><span class="hs-identifier">qs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508805"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680508809"><span class="hs-identifier hs-var">visited</span></a><span> </span><a href="#local-6989586621680508810"><span class="hs-identifier hs-var">qs</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-248"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621680508811"><a href="#local-6989586621680508811"><span class="hs-identifier">visited</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Digraph.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a><span> </span><a name="local-6989586621680508812"><a href="#local-6989586621680508812"><span class="hs-identifier">payload</span></a></a><span> </span><a name="local-6989586621680508813"><a href="#local-6989586621680508813"><span class="hs-identifier">key</span></a></a><span> </span><a name="local-6989586621680508814"><a href="#local-6989586621680508814"><span class="hs-identifier">deps</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621680508815"><a href="#local-6989586621680508815"><span class="hs-identifier">path</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621680508816"><a href="#local-6989586621680508816"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680508817"><a href="#local-6989586621680508817"><span class="hs-identifier">qs</span></a></a><span>
</span><a name="line-249"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680508813"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621680508803"><span class="hs-identifier hs-var">root_key</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508802"><span class="hs-identifier hs-var">root_payload</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621680508815"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680508813"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Set.member</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680508811"><span class="hs-identifier hs-var">visited</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508805"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680508811"><span class="hs-identifier hs-var">visited</span></a><span> </span><a href="#local-6989586621680508816"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621680508817"><span class="hs-identifier hs-var">qs</span></a><span>
</span><a name="line-251"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680508813"><span class="hs-identifier hs-var">key</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Map.notMember</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680508800"><span class="hs-identifier hs-var">env</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508805"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621680508811"><span class="hs-identifier hs-var">visited</span></a><span> </span><a href="#local-6989586621680508816"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="#local-6989586621680508817"><span class="hs-identifier hs-var">qs</span></a><span>
</span><a name="line-252"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508805"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Set.insert</span><span> </span><a href="#local-6989586621680508813"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="#local-6989586621680508811"><span class="hs-identifier hs-var">visited</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>                                        </span><a href="#local-6989586621680508816"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508818"><span class="hs-identifier hs-var">new_qs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621680508817"><span class="hs-identifier hs-var">qs</span></a><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>       </span><span class="hs-keyword">where</span><span>
</span><a name="line-255"></a><span>         </span><a name="local-6989586621680508818"><a href="#local-6989586621680508818"><span class="hs-identifier">new_qs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508806"><span class="hs-identifier hs-var">new_work</span></a><span> </span><a href="#local-6989586621680508814"><span class="hs-identifier hs-var">deps</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508812"><span class="hs-identifier hs-var">payload</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621680508815"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span>    </span><span class="hs-identifier">new_work</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508760"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508759"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#WorkItem"><span class="hs-identifier hs-type">WorkItem</span></a><span> </span><a href="#local-6989586621680508760"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508759"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>
</span><a name="line-258"></a><span>    </span><a name="local-6989586621680508806"><a href="#local-6989586621680508806"><span class="hs-identifier">new_work</span></a></a><span> </span><a name="local-6989586621680508819"><a href="#local-6989586621680508819"><span class="hs-identifier">deps</span></a></a><span> </span><a name="local-6989586621680508820"><a href="#local-6989586621680508820"><span class="hs-identifier">path</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508821"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508820"><span class="hs-identifier hs-var">path</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680508821"><a href="#local-6989586621680508821"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">Map.lookup</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621680508800"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680508819"><span class="hs-identifier hs-var">deps</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
*      Strongly Connected Component wrappers for Graph
*                                                                      *
************************************************************************

Note: the components are returned topologically sorted: later components
depend on earlier ones, but not vice versa i.e. later components only have
edges going from them to earlier ones.
-}</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-comment">{-
Note [Deterministic SCC]
~~~~~~~~~~~~~~~~~~~~~~~~
stronglyConnCompFromEdgedVerticesUniq,
stronglyConnCompFromEdgedVerticesUniqR,
stronglyConnCompFromEdgedVerticesOrd and
stronglyConnCompFromEdgedVerticesOrdR
provide a following guarantee:
Given a deterministically ordered list of nodes it returns a deterministically
ordered list of strongly connected components, where the list of vertices
in an SCC is also deterministically ordered.
Note that the order of edges doesn't need to be deterministic for this to work.
We use the order of nodes to normalize the order of edges.
-}</span><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-identifier">stronglyConnCompG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508758"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SCC</span><span> </span><a href="#local-6989586621680508758"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">]</span><span>
</span><a name="line-288"></a><a name="stronglyConnCompG"><a href="Digraph.html#stronglyConnCompG"><span class="hs-identifier">stronglyConnCompG</span></a></a><span> </span><a name="local-6989586621680508822"><a href="#local-6989586621680508822"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#decodeSccs"><span class="hs-identifier hs-var">decodeSccs</span></a><span> </span><a href="#local-6989586621680508822"><span class="hs-identifier hs-var">graph</span></a><span> </span><a href="#local-6989586621680508823"><span class="hs-identifier hs-var">forest</span></a><span>
</span><a name="line-289"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680508823"><a href="#local-6989586621680508823"><span class="hs-identifier">forest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Digraph.scc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-identifier hs-var">scc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_int_graph</span><span> </span><a href="#local-6989586621680508822"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span class="hs-identifier">decodeSccs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508757"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Forest</span><span> </span><span class="hs-identifier hs-type">Vertex</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SCC</span><span> </span><a href="#local-6989586621680508757"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">]</span><span>
</span><a name="line-292"></a><a name="decodeSccs"><a href="Digraph.html#decodeSccs"><span class="hs-identifier">decodeSccs</span></a></a><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-var">Graph</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gr_int_graph</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680508824"><a href="#local-6989586621680508824"><span class="hs-identifier">graph</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gr_vertex_to_node</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621680508825"><a href="#local-6989586621680508825"><span class="hs-identifier">vertex_fn</span></a></a><span> </span><span class="hs-special">}</span><span> </span><a name="local-6989586621680508826"><a href="#local-6989586621680508826"><span class="hs-identifier">forest</span></a></a><span>
</span><a name="line-293"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621680508827"><span class="hs-identifier hs-var">decode</span></a><span> </span><a href="#local-6989586621680508826"><span class="hs-identifier hs-var">forest</span></a><span>
</span><a name="line-294"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-295"></a><span>    </span><a name="local-6989586621680508827"><a href="#local-6989586621680508827"><span class="hs-identifier">decode</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Node</span><span> </span><a name="local-6989586621680508829"><a href="#local-6989586621680508829"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680508828"><span class="hs-identifier hs-var">mentions_itself</span></a><span> </span><a href="#local-6989586621680508829"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">CyclicSCC</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508825"><span class="hs-identifier hs-var">vertex_fn</span></a><span> </span><a href="#local-6989586621680508829"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">]</span><span>
</span><a name="line-296"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AcyclicSCC</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508825"><span class="hs-identifier hs-var">vertex_fn</span></a><span> </span><a href="#local-6989586621680508829"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>    </span><span class="hs-identifier">decode</span><span> </span><a name="local-6989586621680508830"><a href="#local-6989586621680508830"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">CyclicSCC</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508831"><span class="hs-identifier hs-var">dec</span></a><span> </span><a href="#local-6989586621680508830"><span class="hs-identifier hs-var">other</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-298"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680508831"><a href="#local-6989586621680508831"><span class="hs-identifier">dec</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Node</span><span> </span><a name="local-6989586621680508832"><a href="#local-6989586621680508832"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621680508833"><a href="#local-6989586621680508833"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680508834"><a href="#local-6989586621680508834"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508825"><span class="hs-identifier hs-var">vertex_fn</span></a><span> </span><a href="#local-6989586621680508832"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621680508831"><span class="hs-identifier hs-var">dec</span></a><span> </span><a href="#local-6989586621680508834"><span class="hs-identifier hs-var">vs</span></a><span> </span><a href="#local-6989586621680508833"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-299"></a><span>    </span><a name="local-6989586621680508828"><a href="#local-6989586621680508828"><span class="hs-identifier">mentions_itself</span></a></a><span> </span><a name="local-6989586621680508835"><a href="#local-6989586621680508835"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508835"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508824"><span class="hs-identifier hs-var">graph</span></a><span> </span><span class="hs-glyph">!</span><span> </span><a href="#local-6989586621680508835"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span class="hs-comment">-- The following two versions are provided for backwards compatibility:</span><span>
</span><a name="line-303"></a><span class="hs-comment">-- See Note [Deterministic SCC]</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- See Note [reduceNodesIntoVertices implementations]</span><span>
</span><a name="line-305"></a><span class="hs-identifier">stronglyConnCompFromEdgedVerticesOrd</span><span>
</span><a name="line-306"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621680508755"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-307"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508755"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508756"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>
</span><a name="line-308"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SCC</span><span> </span><a href="#local-6989586621680508756"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>
</span><a name="line-309"></a><a name="stronglyConnCompFromEdgedVerticesOrd"><a href="Digraph.html#stronglyConnCompFromEdgedVerticesOrd"><span class="hs-identifier">stronglyConnCompFromEdgedVerticesOrd</span></a></a><span>
</span><a name="line-310"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">node_payload</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Digraph.html#stronglyConnCompFromEdgedVerticesOrdR"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesOrdR</span></a><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span class="hs-comment">-- The following two versions are provided for backwards compatibility:</span><span>
</span><a name="line-313"></a><span class="hs-comment">-- See Note [Deterministic SCC]</span><span>
</span><a name="line-314"></a><span class="hs-comment">-- See Note [reduceNodesIntoVertices implementations]</span><span>
</span><a name="line-315"></a><span class="hs-identifier">stronglyConnCompFromEdgedVerticesUniq</span><span>
</span><a name="line-316"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="#local-6989586621680508753"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-317"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508753"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508754"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>
</span><a name="line-318"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SCC</span><span> </span><a href="#local-6989586621680508754"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>
</span><a name="line-319"></a><a name="stronglyConnCompFromEdgedVerticesUniq"><a href="Digraph.html#stronglyConnCompFromEdgedVerticesUniq"><span class="hs-identifier">stronglyConnCompFromEdgedVerticesUniq</span></a></a><span>
</span><a name="line-320"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">node_payload</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Digraph.html#stronglyConnCompFromEdgedVerticesUniqR"><span class="hs-identifier hs-var">stronglyConnCompFromEdgedVerticesUniqR</span></a><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-comment">-- The &quot;R&quot; interface is used when you expect to apply SCC to</span><span>
</span><a name="line-323"></a><span class="hs-comment">-- (some of) the result of SCC, so you don't want to lose the dependency info</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- See Note [Deterministic SCC]</span><span>
</span><a name="line-325"></a><span class="hs-comment">-- See Note [reduceNodesIntoVertices implementations]</span><span>
</span><a name="line-326"></a><span class="hs-identifier">stronglyConnCompFromEdgedVerticesOrdR</span><span>
</span><a name="line-327"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621680508751"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-328"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508751"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508752"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>
</span><a name="line-329"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SCC</span><span> </span><span class="hs-special">(</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508751"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508752"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-330"></a><a name="stronglyConnCompFromEdgedVerticesOrdR"><a href="Digraph.html#stronglyConnCompFromEdgedVerticesOrdR"><span class="hs-identifier">stronglyConnCompFromEdgedVerticesOrdR</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-331"></a><span>  </span><a href="Digraph.html#stronglyConnCompG"><span class="hs-identifier hs-var">stronglyConnCompG</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Digraph.html#graphFromEdgedVertices"><span class="hs-identifier hs-var">graphFromEdgedVertices</span></a><span> </span><a href="Digraph.html#reduceNodesIntoVerticesOrd"><span class="hs-identifier hs-var">reduceNodesIntoVerticesOrd</span></a><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-comment">-- The &quot;R&quot; interface is used when you expect to apply SCC to</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- (some of) the result of SCC, so you don't want to lose the dependency info</span><span>
</span><a name="line-335"></a><span class="hs-comment">-- See Note [Deterministic SCC]</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- See Note [reduceNodesIntoVertices implementations]</span><span>
</span><a name="line-337"></a><span class="hs-identifier">stronglyConnCompFromEdgedVerticesUniqR</span><span>
</span><a name="line-338"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="#local-6989586621680508749"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-339"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508749"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508750"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">]</span><span>
</span><a name="line-340"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">SCC</span><span> </span><span class="hs-special">(</span><a href="Digraph.html#Node"><span class="hs-identifier hs-type">Node</span></a><span> </span><a href="#local-6989586621680508749"><span class="hs-identifier hs-type">key</span></a><span> </span><a href="#local-6989586621680508750"><span class="hs-identifier hs-type">payload</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-341"></a><a name="stronglyConnCompFromEdgedVerticesUniqR"><a href="Digraph.html#stronglyConnCompFromEdgedVerticesUniqR"><span class="hs-identifier">stronglyConnCompFromEdgedVerticesUniqR</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-342"></a><span>  </span><a href="Digraph.html#stronglyConnCompG"><span class="hs-identifier hs-var">stronglyConnCompG</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Digraph.html#graphFromEdgedVertices"><span class="hs-identifier hs-var">graphFromEdgedVertices</span></a><span> </span><a href="Digraph.html#reduceNodesIntoVerticesUniq"><span class="hs-identifier hs-var">reduceNodesIntoVerticesUniq</span></a><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
*      Misc wrappers for Graph
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span class="hs-identifier">topologicalSortG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508748"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508748"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">]</span><span>
</span><a name="line-353"></a><a name="topologicalSortG"><a href="Digraph.html#topologicalSortG"><span class="hs-identifier">topologicalSortG</span></a></a><span> </span><a name="local-6989586621680508836"><a href="#local-6989586621680508836"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_vertex_to_node</span><span> </span><a href="#local-6989586621680508836"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680508837"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-354"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680508837"><a href="#local-6989586621680508837"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Digraph.topSort&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-identifier hs-var">topSort</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_int_graph</span><span> </span><a href="#local-6989586621680508836"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span>
</span><a name="line-355"></a><span>
</span><a name="line-356"></a><span class="hs-identifier">reachableG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508747"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680508747"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508747"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">]</span><span>
</span><a name="line-357"></a><a name="reachableG"><a href="Digraph.html#reachableG"><span class="hs-identifier">reachableG</span></a></a><span> </span><a name="local-6989586621680508838"><a href="#local-6989586621680508838"><span class="hs-identifier">graph</span></a></a><span> </span><a name="local-6989586621680508839"><a href="#local-6989586621680508839"><span class="hs-identifier">from</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_vertex_to_node</span><span> </span><a href="#local-6989586621680508838"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680508841"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-358"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680508840"><a href="#local-6989586621680508840"><span class="hs-identifier">from_vertex</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-string">&quot;reachableG&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_node_to_vertex</span><span> </span><a href="#local-6989586621680508838"><span class="hs-identifier hs-var">graph</span></a><span> </span><a href="#local-6989586621680508839"><span class="hs-identifier hs-var">from</span></a><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>        </span><a name="local-6989586621680508841"><a href="#local-6989586621680508841"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Digraph.reachable&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Digraph.html#reachable"><span class="hs-identifier hs-var">reachable</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_int_graph</span><span> </span><a href="#local-6989586621680508838"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508840"><span class="hs-identifier hs-var">from_vertex</span></a><span class="hs-special">]</span><span>
</span><a name="line-360"></a><span>
</span><a name="line-361"></a><span class="hs-comment">-- | Given a list of roots return all reachable nodes.</span><span>
</span><a name="line-362"></a><span class="hs-identifier">reachablesG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508746"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508746"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508746"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">]</span><span>
</span><a name="line-363"></a><a name="reachablesG"><a href="Digraph.html#reachablesG"><span class="hs-identifier">reachablesG</span></a></a><span> </span><a name="local-6989586621680508842"><a href="#local-6989586621680508842"><span class="hs-identifier">graph</span></a></a><span> </span><a name="local-6989586621680508843"><a href="#local-6989586621680508843"><span class="hs-identifier">froms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_vertex_to_node</span><span> </span><a href="#local-6989586621680508842"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680508844"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-364"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680508844"><a href="#local-6989586621680508844"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Digraph.reachable&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-365"></a><span>                 </span><a href="Digraph.html#reachable"><span class="hs-identifier hs-var">reachable</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_int_graph</span><span> </span><a href="#local-6989586621680508842"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680508845"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-366"></a><span>        </span><a name="local-6989586621680508845"><a href="#local-6989586621680508845"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621680508846"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680508846"><a href="#local-6989586621680508846"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_node_to_vertex</span><span> </span><a href="#local-6989586621680508842"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680508843"><span class="hs-identifier hs-var">froms</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span class="hs-identifier">hasVertexG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508745"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680508745"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-369"></a><a name="hasVertexG"><a href="Digraph.html#hasVertexG"><span class="hs-identifier">hasVertexG</span></a></a><span> </span><a name="local-6989586621680508847"><a href="#local-6989586621680508847"><span class="hs-identifier">graph</span></a></a><span> </span><a name="local-6989586621680508848"><a href="#local-6989586621680508848"><span class="hs-identifier">node</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">gr_node_to_vertex</span><span> </span><a href="#local-6989586621680508847"><span class="hs-identifier hs-var">graph</span></a><span> </span><a href="#local-6989586621680508848"><span class="hs-identifier hs-var">node</span></a><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-identifier">verticesG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508744"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508744"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">]</span><span>
</span><a name="line-372"></a><a name="verticesG"><a href="Digraph.html#verticesG"><span class="hs-identifier">verticesG</span></a></a><span> </span><a name="local-6989586621680508849"><a href="#local-6989586621680508849"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_vertex_to_node</span><span> </span><a href="#local-6989586621680508849"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">vertices</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_int_graph</span><span> </span><a href="#local-6989586621680508849"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span class="hs-identifier">edgesG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508743"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Digraph.html#Edge"><span class="hs-identifier hs-type">Edge</span></a><span> </span><a href="#local-6989586621680508743"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">]</span><span>
</span><a name="line-375"></a><a name="edgesG"><a href="Digraph.html#edgesG"><span class="hs-identifier">edgesG</span></a></a><span> </span><a name="local-6989586621680508850"><a href="#local-6989586621680508850"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621680508852"><a href="#local-6989586621680508852"><span class="hs-identifier">v1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680508853"><a href="#local-6989586621680508853"><span class="hs-identifier">v2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Digraph.html#Edge"><span class="hs-identifier hs-var">Edge</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508851"><span class="hs-identifier hs-var">v2n</span></a><span> </span><a href="#local-6989586621680508852"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508851"><span class="hs-identifier hs-var">v2n</span></a><span> </span><a href="#local-6989586621680508853"><span class="hs-identifier hs-var">v2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">edges</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_int_graph</span><span> </span><a href="#local-6989586621680508850"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621680508851"><a href="#local-6989586621680508851"><span class="hs-identifier">v2n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gr_vertex_to_node</span><span> </span><a href="#local-6989586621680508850"><span class="hs-identifier hs-var">graph</span></a><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-identifier">transposeG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508742"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508742"><span class="hs-identifier hs-type">node</span></a><span>
</span><a name="line-379"></a><a name="transposeG"><a href="Digraph.html#transposeG"><span class="hs-identifier">transposeG</span></a></a><span> </span><a name="local-6989586621680508854"><a href="#local-6989586621680508854"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-var">Graph</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">G.transposeG</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_int_graph</span><span> </span><a href="#local-6989586621680508854"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier">gr_vertex_to_node</span><span> </span><a href="#local-6989586621680508854"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span>
</span><a name="line-381"></a><span>                         </span><span class="hs-special">(</span><span class="hs-identifier">gr_node_to_vertex</span><span> </span><a href="#local-6989586621680508854"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-identifier">emptyG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508741"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-384"></a><a name="emptyG"><a href="Digraph.html#emptyG"><span class="hs-identifier">emptyG</span></a></a><span> </span><a name="local-6989586621680508855"><a href="#local-6989586621680508855"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#graphEmpty"><span class="hs-identifier hs-var">graphEmpty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gr_int_graph</span><span> </span><a href="#local-6989586621680508855"><span class="hs-identifier hs-var">g</span></a><span class="hs-special">)</span><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
*      Showing Graphs
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621680508732"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><span class="hs-special">(</span><a href="Digraph.html#Graph"><span class="hs-identifier hs-type">Graph</span></a><span> </span><a href="#local-6989586621680508732"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-395"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621680508733"><a href="#local-6989586621680508733"><span class="hs-identifier">graph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span>
</span><a name="line-396"></a><span>                  </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Vertices:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Digraph.html#verticesG"><span class="hs-identifier hs-var">verticesG</span></a><span> </span><a href="#local-6989586621680508733"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-397"></a><span>                  </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Edges:&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Digraph.html#edgesG"><span class="hs-identifier hs-var">edgesG</span></a><span> </span><a href="#local-6989586621680508733"><span class="hs-identifier hs-var">graph</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span>                </span><span class="hs-special">]</span><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621680508729"><span class="hs-identifier hs-type">node</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><span class="hs-special">(</span><a href="Digraph.html#Edge"><span class="hs-identifier hs-type">Edge</span></a><span> </span><a href="#local-6989586621680508729"><span class="hs-identifier hs-type">node</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-401"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="Digraph.html#Edge"><span class="hs-identifier hs-var">Edge</span></a><span> </span><a name="local-6989586621680508730"><a href="#local-6989586621680508730"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621680508731"><a href="#local-6989586621680508731"><span class="hs-identifier">to</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680508730"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;-&gt;&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680508731"><span class="hs-identifier hs-var">to</span></a><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span class="hs-identifier">graphEmpty</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">G.Graph</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-404"></a><a name="graphEmpty"><a href="Digraph.html#graphEmpty"><span class="hs-identifier">graphEmpty</span></a></a><span> </span><a name="local-6989586621680508856"><a href="#local-6989586621680508856"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508857"><span class="hs-identifier hs-var">lo</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621680508858"><span class="hs-identifier hs-var">hi</span></a><span>
</span><a name="line-405"></a><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><a name="local-6989586621680508857"><a href="#local-6989586621680508857"><span class="hs-identifier">lo</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680508858"><a href="#local-6989586621680508858"><span class="hs-identifier">hi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">bounds</span><span> </span><a href="#local-6989586621680508856"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
*      IntGraphs
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><span class="hs-keyword">type</span><span> </span><a name="IntGraph"><a href="Digraph.html#IntGraph"><span class="hs-identifier">IntGraph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">G.Graph</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-comment">{-
------------------------------------------------------------
-- Depth first search numbering
------------------------------------------------------------
-}</span><span>
</span><a name="line-422"></a><span>
</span><a name="line-423"></a><span class="hs-comment">-- Data.Tree has flatten for Tree, but nothing for Forest</span><span>
</span><a name="line-424"></a><span class="hs-identifier">preorderF</span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Forest</span><span> </span><a href="#local-6989586621680508740"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508740"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-425"></a><a name="preorderF"><a href="Digraph.html#preorderF"><span class="hs-identifier">preorderF</span></a></a><span> </span><a name="local-6989586621680508859"><a href="#local-6989586621680508859"><span class="hs-identifier">ts</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">flatten</span><span> </span><a href="#local-6989586621680508859"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-comment">{-
------------------------------------------------------------
-- Finding reachable vertices
------------------------------------------------------------
-}</span><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span class="hs-comment">-- This generalizes reachable which was found in Data.Graph</span><span>
</span><a name="line-434"></a><span class="hs-identifier">reachable</span><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Digraph.html#IntGraph"><span class="hs-identifier hs-type">IntGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Vertex</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Vertex</span><span class="hs-special">]</span><span>
</span><a name="line-435"></a><a name="reachable"><a href="Digraph.html#reachable"><span class="hs-identifier">reachable</span></a></a><span> </span><a name="local-6989586621680508860"><a href="#local-6989586621680508860"><span class="hs-identifier">g</span></a></a><span> </span><a name="local-6989586621680508861"><a href="#local-6989586621680508861"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#preorderF"><span class="hs-identifier hs-var">preorderF</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dfs</span><span> </span><a href="#local-6989586621680508860"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621680508861"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">)</span><span>
</span><a name="line-436"></a><span>
</span><a name="line-437"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
*                         Classify Edge Types
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span class="hs-comment">-- Remark: While we could generalize this algorithm this comes at a runtime</span><span>
</span><a name="line-446"></a><span class="hs-comment">-- cost and with no advantages. If you find yourself using this with graphs</span><span>
</span><a name="line-447"></a><span class="hs-comment">-- not easily represented using Int nodes please consider rewriting this</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- using the more general Graph type.</span><span>
</span><a name="line-449"></a><span>
</span><a name="line-450"></a><span class="hs-comment">-- | Edge direction based on DFS Classification</span><span>
</span><a name="line-451"></a><span class="hs-keyword">data</span><span> </span><a name="EdgeType"><a href="Digraph.html#EdgeType"><span class="hs-identifier">EdgeType</span></a></a><span>
</span><a name="line-452"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Forward"><a href="Digraph.html#Forward"><span class="hs-identifier">Forward</span></a></a><span>
</span><a name="line-453"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Cross"><a href="Digraph.html#Cross"><span class="hs-identifier">Cross</span></a></a><span>
</span><a name="line-454"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Backward"><a href="Digraph.html#Backward"><span class="hs-identifier">Backward</span></a></a><span> </span><span class="hs-comment">-- ^ Loop back towards the root node.</span><span>
</span><a name="line-455"></a><span>             </span><span class="hs-comment">-- Eg backjumps in loops</span><span>
</span><a name="line-456"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SelfLoop"><a href="Digraph.html#SelfLoop"><span class="hs-identifier">SelfLoop</span></a></a><span> </span><span class="hs-comment">-- ^ v -&gt; v</span><span>
</span><a name="line-457"></a><span>   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="Digraph.html#EdgeType"><span class="hs-identifier hs-type">EdgeType</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-460"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="Digraph.html#Forward"><span class="hs-identifier hs-var">Forward</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Forward&quot;</span><span>
</span><a name="line-461"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="Digraph.html#Cross"><span class="hs-identifier hs-var">Cross</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Cross&quot;</span><span>
</span><a name="line-462"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="Digraph.html#Backward"><span class="hs-identifier hs-var">Backward</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Backward&quot;</span><span>
</span><a name="line-463"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="Digraph.html#SelfLoop"><span class="hs-identifier hs-var">SelfLoop</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;SelfLoop&quot;</span><span>
</span><a name="line-464"></a><span>
</span><a name="line-465"></a><span class="hs-keyword">newtype</span><span> </span><a name="Time"><a href="Digraph.html#Time"><span class="hs-identifier">Time</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Time"><a href="Digraph.html#Time"><span class="hs-identifier">Time</span></a></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Num</span><span class="hs-special">,</span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span class="hs-special">)</span><span>
</span><a name="line-466"></a><span>
</span><a name="line-467"></a><span class="hs-comment">--Allow for specialzation</span><span>
</span><a name="line-468"></a><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="hs-pragma">classifyEdges</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span class="hs-comment">-- | Given a start vertex, a way to get successors from a node</span><span>
</span><a name="line-471"></a><span class="hs-comment">-- and a list of (directed) edges classify the types of edges.</span><span>
</span><a name="line-472"></a><span class="hs-identifier">classifyEdges</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621680508739"><a href="#local-6989586621680508739"><span class="hs-identifier">key</span></a></a><span class="hs-operator">.</span><span> </span><a href="Unique.html#Uniquable"><span class="hs-identifier hs-type">Uniquable</span></a><span> </span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-473"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">,</span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Digraph.html#EdgeType"><span class="hs-identifier hs-type">EdgeType</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-474"></a><a name="classifyEdges"><a href="Digraph.html#classifyEdges"><span class="hs-identifier">classifyEdges</span></a></a><span> </span><a name="local-6989586621680508862"><a href="#local-6989586621680508862"><span class="hs-identifier">root</span></a></a><span> </span><a name="local-6989586621680508863"><a href="#local-6989586621680508863"><span class="hs-identifier">getSucc</span></a></a><span> </span><a name="local-6989586621680508864"><a href="#local-6989586621680508864"><span class="hs-identifier">edges</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-475"></a><span>    </span><span class="hs-comment">--let uqe (from,to) = (getUnique from, getUnique to)</span><span>
</span><a name="line-476"></a><span>    </span><span class="hs-comment">--in pprTrace &quot;Edges:&quot; (ppr $ map uqe edges) $</span><span>
</span><a name="line-477"></a><span>    </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621680508864"><span class="hs-identifier hs-var">edges</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621680508868"><span class="hs-identifier hs-var">classify</span></a><span> </span><a href="#local-6989586621680508864"><span class="hs-identifier hs-var">edges</span></a><span>
</span><a name="line-478"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-479"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621680508865"><a href="#local-6989586621680508865"><span class="hs-identifier">_time</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680508866"><a href="#local-6989586621680508866"><span class="hs-identifier">starts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621680508867"><a href="#local-6989586621680508867"><span class="hs-identifier">ends</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508869"><span class="hs-identifier hs-var">addTimes</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">,</span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span class="hs-special">,</span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680508862"><span class="hs-identifier hs-var">root</span></a><span>
</span><a name="line-480"></a><span>    </span><span class="hs-identifier">classify</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">,</span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Digraph.html#EdgeType"><span class="hs-identifier hs-type">EdgeType</span></a><span>
</span><a name="line-481"></a><span>    </span><a name="local-6989586621680508868"><a href="#local-6989586621680508868"><span class="hs-identifier">classify</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680508870"><a href="#local-6989586621680508870"><span class="hs-identifier">from</span></a></a><span class="hs-special">,</span><a name="local-6989586621680508871"><a href="#local-6989586621680508871"><span class="hs-identifier">to</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-482"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680508873"><span class="hs-identifier hs-var">startFrom</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621680508874"><span class="hs-identifier hs-var">startTo</span></a><span>
</span><a name="line-483"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508875"><span class="hs-identifier hs-var">endFrom</span></a><span>   </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621680508876"><span class="hs-identifier hs-var">endTo</span></a><span>
</span><a name="line-484"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#Forward"><span class="hs-identifier hs-var">Forward</span></a><span>
</span><a name="line-485"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680508873"><span class="hs-identifier hs-var">startFrom</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621680508874"><span class="hs-identifier hs-var">startTo</span></a><span>
</span><a name="line-486"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508875"><span class="hs-identifier hs-var">endFrom</span></a><span>   </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621680508876"><span class="hs-identifier hs-var">endTo</span></a><span>
</span><a name="line-487"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#Backward"><span class="hs-identifier hs-var">Backward</span></a><span>
</span><a name="line-488"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621680508873"><span class="hs-identifier hs-var">startFrom</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621680508874"><span class="hs-identifier hs-var">startTo</span></a><span>
</span><a name="line-489"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508875"><span class="hs-identifier hs-var">endFrom</span></a><span>   </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621680508876"><span class="hs-identifier hs-var">endTo</span></a><span>
</span><a name="line-490"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#Cross"><span class="hs-identifier hs-var">Cross</span></a><span>
</span><a name="line-491"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680508870"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680508871"><span class="hs-identifier hs-var">to</span></a><span>
</span><a name="line-492"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Digraph.html#SelfLoop"><span class="hs-identifier hs-var">SelfLoop</span></a><span>
</span><a name="line-493"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-494"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;Failed to classify edge of Graph&quot;</span><span>
</span><a name="line-495"></a><span>                 </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680508870"><span class="hs-identifier hs-var">from</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680508871"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-496"></a><span>
</span><a name="line-497"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-498"></a><span>        </span><a name="local-6989586621680508872"><a href="#local-6989586621680508872"><span class="hs-identifier">getTime</span></a></a><span> </span><a name="local-6989586621680508877"><a href="#local-6989586621680508877"><span class="hs-identifier">event</span></a></a><span> </span><a name="local-6989586621680508878"><a href="#local-6989586621680508878"><span class="hs-identifier">node</span></a></a><span>
</span><a name="line-499"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621680508879"><a href="#local-6989586621680508879"><span class="hs-identifier">time</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span> </span><a href="#local-6989586621680508877"><span class="hs-identifier hs-var">event</span></a><span> </span><a href="#local-6989586621680508878"><span class="hs-identifier hs-var">node</span></a><span>
</span><a name="line-500"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508879"><span class="hs-identifier hs-var">time</span></a><span>
</span><a name="line-501"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-502"></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;Failed to classify edge of CFG - not not timed&quot;</span><span>
</span><a name="line-503"></a><span>            </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;edges&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680508870"><span class="hs-identifier hs-var">from</span></a><span class="hs-special">,</span><span> </span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621680508871"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span>
</span><a name="line-504"></a><span>                          </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680508866"><span class="hs-identifier hs-var">starts</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621680508867"><span class="hs-identifier hs-var">ends</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-505"></a><span>        </span><a name="local-6989586621680508873"><a href="#local-6989586621680508873"><span class="hs-identifier">startFrom</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508872"><span class="hs-identifier hs-var">getTime</span></a><span> </span><a href="#local-6989586621680508866"><span class="hs-identifier hs-var">starts</span></a><span> </span><a href="#local-6989586621680508870"><span class="hs-identifier hs-var">from</span></a><span>
</span><a name="line-506"></a><span>        </span><a name="local-6989586621680508874"><a href="#local-6989586621680508874"><span class="hs-identifier">startTo</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508872"><span class="hs-identifier hs-var">getTime</span></a><span> </span><a href="#local-6989586621680508866"><span class="hs-identifier hs-var">starts</span></a><span> </span><a href="#local-6989586621680508871"><span class="hs-identifier hs-var">to</span></a><span>
</span><a name="line-507"></a><span>        </span><a name="local-6989586621680508875"><a href="#local-6989586621680508875"><span class="hs-identifier">endFrom</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508872"><span class="hs-identifier hs-var">getTime</span></a><span> </span><a href="#local-6989586621680508867"><span class="hs-identifier hs-var">ends</span></a><span>   </span><a href="#local-6989586621680508870"><span class="hs-identifier hs-var">from</span></a><span>
</span><a name="line-508"></a><span>        </span><a name="local-6989586621680508876"><a href="#local-6989586621680508876"><span class="hs-identifier">endTo</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508872"><span class="hs-identifier hs-var">getTime</span></a><span> </span><a href="#local-6989586621680508867"><span class="hs-identifier hs-var">ends</span></a><span>   </span><a href="#local-6989586621680508871"><span class="hs-identifier hs-var">to</span></a><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><span>    </span><span class="hs-identifier">addTimes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Digraph.html#Time"><span class="hs-identifier hs-type">Time</span></a><span class="hs-special">,</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><a href="Digraph.html#Time"><span class="hs-identifier hs-type">Time</span></a><span class="hs-special">,</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><a href="Digraph.html#Time"><span class="hs-identifier hs-type">Time</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span>
</span><a name="line-511"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Digraph.html#Time"><span class="hs-identifier hs-type">Time</span></a><span class="hs-special">,</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><a href="Digraph.html#Time"><span class="hs-identifier hs-type">Time</span></a><span class="hs-special">,</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><a href="Digraph.html#Time"><span class="hs-identifier hs-type">Time</span></a><span class="hs-special">)</span><span>
</span><a name="line-512"></a><span>    </span><a name="local-6989586621680508869"><a href="#local-6989586621680508869"><span class="hs-identifier">addTimes</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621680508880"><a href="#local-6989586621680508880"><span class="hs-identifier">time</span></a></a><span class="hs-special">,</span><a name="local-6989586621680508881"><a href="#local-6989586621680508881"><span class="hs-identifier">starts</span></a></a><span class="hs-special">,</span><a name="local-6989586621680508882"><a href="#local-6989586621680508882"><span class="hs-identifier">ends</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621680508883"><a href="#local-6989586621680508883"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-513"></a><span>      </span><span class="hs-comment">--Dont reenter nodes</span><span>
</span><a name="line-514"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="UniqFM.html#elemUFM"><span class="hs-identifier hs-var">elemUFM</span></a><span> </span><a href="#local-6989586621680508883"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680508881"><span class="hs-identifier hs-var">starts</span></a><span>
</span><a name="line-515"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508880"><span class="hs-identifier hs-var">time</span></a><span class="hs-special">,</span><a href="#local-6989586621680508881"><span class="hs-identifier hs-var">starts</span></a><span class="hs-special">,</span><a href="#local-6989586621680508882"><span class="hs-identifier hs-var">ends</span></a><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-517"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-518"></a><span>          </span><a name="local-6989586621680508884"><a href="#local-6989586621680508884"><span class="hs-identifier">starts'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a><span> </span><a href="#local-6989586621680508881"><span class="hs-identifier hs-var">starts</span></a><span> </span><a href="#local-6989586621680508883"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680508880"><span class="hs-identifier hs-var">time</span></a><span>
</span><a name="line-519"></a><span>          </span><a name="local-6989586621680508885"><a href="#local-6989586621680508885"><span class="hs-identifier">time'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508880"><span class="hs-identifier hs-var">time</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-520"></a><span>          </span><a name="local-6989586621680508886"><a href="#local-6989586621680508886"><span class="hs-identifier">succs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680508863"><span class="hs-identifier hs-var">getSucc</span></a><span> </span><a href="#local-6989586621680508883"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621680508739"><span class="hs-identifier hs-type">key</span></a><span class="hs-special">]</span><span>
</span><a name="line-521"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621680508887"><a href="#local-6989586621680508887"><span class="hs-identifier">time''</span></a></a><span class="hs-special">,</span><a name="local-6989586621680508888"><a href="#local-6989586621680508888"><span class="hs-identifier">starts''</span></a></a><span class="hs-special">,</span><a name="local-6989586621680508889"><a href="#local-6989586621680508889"><span class="hs-identifier">ends'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621680508869"><span class="hs-identifier hs-var">addTimes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680508885"><span class="hs-identifier hs-var">time'</span></a><span class="hs-special">,</span><a href="#local-6989586621680508884"><span class="hs-identifier hs-var">starts'</span></a><span class="hs-special">,</span><a href="#local-6989586621680508882"><span class="hs-identifier hs-var">ends</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621680508886"><span class="hs-identifier hs-var">succs</span></a><span>
</span><a name="line-522"></a><span>          </span><a name="local-6989586621680508890"><a href="#local-6989586621680508890"><span class="hs-identifier">ends''</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a><span> </span><a href="#local-6989586621680508889"><span class="hs-identifier hs-var">ends'</span></a><span> </span><a href="#local-6989586621680508883"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621680508887"><span class="hs-identifier hs-var">time''</span></a><span>
</span><a name="line-523"></a><span>        </span><span class="hs-keyword">in</span><span>
</span><a name="line-524"></a><span>        </span><span class="hs-special">(</span><a href="#local-6989586621680508887"><span class="hs-identifier hs-var">time''</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508888"><span class="hs-identifier hs-var">starts''</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621680508890"><span class="hs-identifier hs-var">ends''</span></a><span class="hs-special">)</span><span>
</span><a name="line-525"></a></pre></body></html>