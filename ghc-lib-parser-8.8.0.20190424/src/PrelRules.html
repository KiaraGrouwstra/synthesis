<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[ConFold]{Constant Folder}

Conceptually, constant folding should be parameterized with the kind
of target machine to get identical behaviour during compilation time
and runtime. We cheat a little bit here...

ToDo:
   check boundaries before folding, e.g. we can fold the Float addition
   (i1 + i2) only if it results in a valid Float.
-}</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE CPP, RankNTypes, PatternSynonyms, ViewPatterns, RecordWildCards #-}</span><span>
</span><a name="line-16"></a><span class="hs-pragma">{-# OPTIONS_GHC -optc-DNON_POSIX_SOURCE #-}</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PrelRules</span><span>
</span><a name="line-19"></a><span>   </span><span class="hs-special">(</span><span> </span><a href="PrelRules.html#primOpRules"><span class="hs-identifier hs-var">primOpRules</span></a><span>
</span><a name="line-20"></a><span>   </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#builtinRules"><span class="hs-identifier hs-var">builtinRules</span></a><span>
</span><a name="line-21"></a><span>   </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#caseRules"><span class="hs-identifier hs-var">caseRules</span></a><span>
</span><a name="line-22"></a><span>   </span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">where</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
#include &quot;../includes/MachDeps.h&quot;
</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="MkId.html"><span class="hs-identifier">MkId</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="MkId.html#mkPrimOpId"><span class="hs-identifier hs-var">mkPrimOpId</span></a><span class="hs-special">,</span><span> </span><a href="MkId.html#magicDictId"><span class="hs-identifier hs-var">magicDictId</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><a href="MkCore.html"><span class="hs-identifier">MkCore</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="Literal.html"><span class="hs-identifier">Literal</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="CoreOpt.html"><span class="hs-identifier">CoreOpt</span></a><span>     </span><span class="hs-special">(</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="PrimOp.html"><span class="hs-identifier">PrimOp</span></a><span>      </span><span class="hs-special">(</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="PrimOp.html#tagToEnumKey"><span class="hs-identifier hs-var">tagToEnumKey</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="TyCon.html#tyConDataCons_maybe"><span class="hs-identifier hs-var">tyConDataCons_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#isEnumerationTyCon"><span class="hs-identifier hs-var">isEnumerationTyCon</span></a><span>
</span><a name="line-41"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#unwrapNewTyCon_maybe"><span class="hs-identifier hs-var">unwrapNewTyCon_maybe</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span>
</span><a name="line-42"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="TyCon.html#tyConFamilySize"><span class="hs-identifier hs-var">tyConFamilySize</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>     </span><span class="hs-special">(</span><span> </span><a href="DataCon.html#dataConTagZ"><span class="hs-identifier hs-var">dataConTagZ</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConWorkId"><span class="hs-identifier hs-var">dataConWorkId</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="CoreUtils.html"><span class="hs-identifier">CoreUtils</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span class="hs-special">,</span><span> </span><a href="CoreUtils.html#exprIsHNF"><span class="hs-identifier hs-var">exprIsHNF</span></a><span class="hs-special">,</span><span> </span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="CoreUnfold.html"><span class="hs-identifier">CoreUnfold</span></a><span>  </span><span class="hs-special">(</span><span> </span><a href="CoreOpt.html#exprIsConApp_maybe"><span class="hs-identifier hs-var">exprIsConApp_maybe</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><a href="OccName.html"><span class="hs-identifier">OccName</span></a><span>     </span><span class="hs-special">(</span><span> </span><a href="OccName.html#occNameFS"><span class="hs-identifier hs-var">occNameFS</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>      </span><span class="hs-special">(</span><span> </span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="Platform.html"><span class="hs-identifier">Platform</span></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span>     </span><span class="hs-special">(</span><a href="Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a><span class="hs-special">,</span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span class="hs-special">,</span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Alternative</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Fail</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MonadFail</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Bits</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Int</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Ratio</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">{-
Note [Constant folding]
~~~~~~~~~~~~~~~~~~~~~~~
primOpRules generates a rewrite rule for each primop
These rules do what is often called &quot;constant folding&quot;
E.g. the rules for +# might say
        4 +# 5 = 9
Well, of course you'd need a lot of rules if you did it
like that, so we use a BuiltinRule instead, so that we
can match in any two literal values.  So the rule is really
more like
        (Lit x) +# (Lit y) = Lit (x+#y)
where the (+#) on the rhs is done at compile time

That is why these rules are built in here.
-}</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-identifier">primOpRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span>
</span><a name="line-87"></a><span>    </span><span class="hs-comment">-- ToDo: something for integer-shift ops?</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-comment">--       NotOp</span><span>
</span><a name="line-89"></a><a name="primOpRules"><a href="PrelRules.html#primOpRules"><span class="hs-identifier">primOpRules</span></a></a><span> </span><a name="local-6989586621684814070"><a href="#local-6989586621684814070"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#TagToEnumOp"><span class="hs-identifier hs-var">TagToEnumOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814070"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#tagToEnumRule"><span class="hs-identifier hs-var">tagToEnumRule</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-90"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814071"><a href="#local-6989586621684814071"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DataToTagOp"><span class="hs-identifier hs-var">DataToTagOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814071"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#dataToTagRule"><span class="hs-identifier hs-var">dataToTagRule</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- Int operations</span><span>
</span><a name="line-93"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814072"><a href="#local-6989586621684814072"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntAddOp"><span class="hs-identifier hs-var">IntAddOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814072"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOp2"><span class="hs-identifier hs-var">intOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identityDynFlags"><span class="hs-identifier hs-var">identityDynFlags</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-95"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#numFoldingRules"><span class="hs-identifier hs-var">numFoldingRules</span></a><span> </span><a href="PrimOp.html#IntAddOp"><span class="hs-identifier hs-var">IntAddOp</span></a><span> </span><a href="PrelRules.html#intPrimOps"><span class="hs-identifier hs-var">intPrimOps</span></a><span>
</span><a name="line-96"></a><span>                                               </span><span class="hs-special">]</span><span>
</span><a name="line-97"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814073"><a href="#local-6989586621684814073"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntSubOp"><span class="hs-identifier hs-var">IntSubOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814073"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOp2"><span class="hs-identifier hs-var">intOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier hs-var">rightIdentityDynFlags</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-99"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#retLit"><span class="hs-identifier hs-var">retLit</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-100"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#numFoldingRules"><span class="hs-identifier hs-var">numFoldingRules</span></a><span> </span><a href="PrimOp.html#IntSubOp"><span class="hs-identifier hs-var">IntSubOp</span></a><span> </span><a href="PrelRules.html#intPrimOps"><span class="hs-identifier hs-var">intPrimOps</span></a><span>
</span><a name="line-101"></a><span>                                               </span><span class="hs-special">]</span><span>
</span><a name="line-102"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814074"><a href="#local-6989586621684814074"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntAddCOp"><span class="hs-identifier hs-var">IntAddCOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814074"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOpC2"><span class="hs-identifier hs-var">intOpC2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identityCDynFlags"><span class="hs-identifier hs-var">identityCDynFlags</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-104"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814075"><a href="#local-6989586621684814075"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntSubCOp"><span class="hs-identifier hs-var">IntSubCOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814075"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOpC2"><span class="hs-identifier hs-var">intOpC2</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentityCDynFlags"><span class="hs-identifier hs-var">rightIdentityCDynFlags</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-106"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#retLitNoC"><span class="hs-identifier hs-var">retLitNoC</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-107"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814076"><a href="#local-6989586621684814076"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntMulOp"><span class="hs-identifier hs-var">IntMulOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814076"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOp2"><span class="hs-identifier hs-var">intOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#zeroElem"><span class="hs-identifier hs-var">zeroElem</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-109"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identityDynFlags"><span class="hs-identifier hs-var">identityDynFlags</span></a><span> </span><a href="PrelRules.html#onei"><span class="hs-identifier hs-var">onei</span></a><span>
</span><a name="line-110"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#numFoldingRules"><span class="hs-identifier hs-var">numFoldingRules</span></a><span> </span><a href="PrimOp.html#IntMulOp"><span class="hs-identifier hs-var">IntMulOp</span></a><span> </span><a href="PrelRules.html#intPrimOps"><span class="hs-identifier hs-var">intPrimOps</span></a><span>
</span><a name="line-111"></a><span>                                               </span><span class="hs-special">]</span><span>
</span><a name="line-112"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814077"><a href="#local-6989586621684814077"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntQuotOp"><span class="hs-identifier hs-var">IntQuotOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814077"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#nonZeroLit"><span class="hs-identifier hs-var">nonZeroLit</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOp2"><span class="hs-identifier hs-var">intOp2</span></a><span> </span><span class="hs-identifier hs-var">quot</span><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#leftZero"><span class="hs-identifier hs-var">leftZero</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-114"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier hs-var">rightIdentityDynFlags</span></a><span> </span><a href="PrelRules.html#onei"><span class="hs-identifier hs-var">onei</span></a><span>
</span><a name="line-115"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#retLit"><span class="hs-identifier hs-var">retLit</span></a><span> </span><a href="PrelRules.html#onei"><span class="hs-identifier hs-var">onei</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-116"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814078"><a href="#local-6989586621684814078"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntRemOp"><span class="hs-identifier hs-var">IntRemOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814078"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#nonZeroLit"><span class="hs-identifier hs-var">nonZeroLit</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOp2"><span class="hs-identifier hs-var">intOp2</span></a><span> </span><span class="hs-identifier hs-var">rem</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#leftZero"><span class="hs-identifier hs-var">leftZero</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-118"></a><span>                                               </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684814079"><a href="#local-6989586621684814079"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getLiteral"><span class="hs-identifier hs-var">getLiteral</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-119"></a><span>                                                    </span><a name="local-6989586621684814080"><a href="#local-6989586621684814080"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-120"></a><span>                                                    </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814079"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelRules.html#onei"><span class="hs-identifier hs-var">onei</span></a><span> </span><a href="#local-6989586621684814080"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span>                                                    </span><a href="PrelRules.html#retLit"><span class="hs-identifier hs-var">retLit</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-122"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#retLit"><span class="hs-identifier hs-var">retLit</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-123"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#retLit"><span class="hs-identifier hs-var">retLit</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-124"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814081"><a href="#local-6989586621684814081"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#AndIOp"><span class="hs-identifier hs-var">AndIOp</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814081"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOp2"><span class="hs-identifier hs-var">intOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.&amp;.</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#idempotent"><span class="hs-identifier hs-var">idempotent</span></a><span>
</span><a name="line-126"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#zeroElem"><span class="hs-identifier hs-var">zeroElem</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-127"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814082"><a href="#local-6989586621684814082"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#OrIOp"><span class="hs-identifier hs-var">OrIOp</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814082"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOp2"><span class="hs-identifier hs-var">intOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#idempotent"><span class="hs-identifier hs-var">idempotent</span></a><span>
</span><a name="line-129"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identityDynFlags"><span class="hs-identifier hs-var">identityDynFlags</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-130"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814083"><a href="#local-6989586621684814083"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#XorIOp"><span class="hs-identifier hs-var">XorIOp</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814083"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOp2"><span class="hs-identifier hs-var">intOp2</span></a><span> </span><span class="hs-identifier hs-var">xor</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identityDynFlags"><span class="hs-identifier hs-var">identityDynFlags</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-132"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#retLit"><span class="hs-identifier hs-var">retLit</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-133"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814084"><a href="#local-6989586621684814084"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#NotIOp"><span class="hs-identifier hs-var">NotIOp</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814084"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#unaryLit"><span class="hs-identifier hs-var">unaryLit</span></a><span> </span><a href="PrelRules.html#complementOp"><span class="hs-identifier hs-var">complementOp</span></a><span>
</span><a name="line-134"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#inversePrimOp"><span class="hs-identifier hs-var">inversePrimOp</span></a><span> </span><a href="PrimOp.html#NotIOp"><span class="hs-identifier hs-var">NotIOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-135"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814085"><a href="#local-6989586621684814085"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntNegOp"><span class="hs-identifier hs-var">IntNegOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814085"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#unaryLit"><span class="hs-identifier hs-var">unaryLit</span></a><span> </span><a href="PrelRules.html#negOp"><span class="hs-identifier hs-var">negOp</span></a><span>
</span><a name="line-136"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#inversePrimOp"><span class="hs-identifier hs-var">inversePrimOp</span></a><span> </span><a href="PrimOp.html#IntNegOp"><span class="hs-identifier hs-var">IntNegOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-137"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814086"><a href="#local-6989586621684814086"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#ISllOp"><span class="hs-identifier hs-var">ISllOp</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814086"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#shiftRule"><span class="hs-identifier hs-var">shiftRule</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Bits.shiftL</span><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier hs-var">rightIdentityDynFlags</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-139"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814087"><a href="#local-6989586621684814087"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#ISraOp"><span class="hs-identifier hs-var">ISraOp</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814087"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#shiftRule"><span class="hs-identifier hs-var">shiftRule</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Bits.shiftR</span><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier hs-var">rightIdentityDynFlags</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-141"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814088"><a href="#local-6989586621684814088"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#ISrlOp"><span class="hs-identifier hs-var">ISrlOp</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814088"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#shiftRule"><span class="hs-identifier hs-var">shiftRule</span></a><span> </span><a href="PrelRules.html#shiftRightLogical"><span class="hs-identifier hs-var">shiftRightLogical</span></a><span>
</span><a name="line-142"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier hs-var">rightIdentityDynFlags</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-comment">-- Word operations</span><span>
</span><a name="line-145"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814089"><a href="#local-6989586621684814089"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordAddOp"><span class="hs-identifier hs-var">WordAddOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814089"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordOp2"><span class="hs-identifier hs-var">wordOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identityDynFlags"><span class="hs-identifier hs-var">identityDynFlags</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span>
</span><a name="line-147"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#numFoldingRules"><span class="hs-identifier hs-var">numFoldingRules</span></a><span> </span><a href="PrimOp.html#WordAddOp"><span class="hs-identifier hs-var">WordAddOp</span></a><span> </span><a href="PrelRules.html#wordPrimOps"><span class="hs-identifier hs-var">wordPrimOps</span></a><span>
</span><a name="line-148"></a><span>                                               </span><span class="hs-special">]</span><span>
</span><a name="line-149"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814090"><a href="#local-6989586621684814090"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordSubOp"><span class="hs-identifier hs-var">WordSubOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814090"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordOp2"><span class="hs-identifier hs-var">wordOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier hs-var">rightIdentityDynFlags</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span>
</span><a name="line-151"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#retLit"><span class="hs-identifier hs-var">retLit</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span>
</span><a name="line-152"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#numFoldingRules"><span class="hs-identifier hs-var">numFoldingRules</span></a><span> </span><a href="PrimOp.html#WordSubOp"><span class="hs-identifier hs-var">WordSubOp</span></a><span> </span><a href="PrelRules.html#wordPrimOps"><span class="hs-identifier hs-var">wordPrimOps</span></a><span>
</span><a name="line-153"></a><span>                                               </span><span class="hs-special">]</span><span>
</span><a name="line-154"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814091"><a href="#local-6989586621684814091"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordAddCOp"><span class="hs-identifier hs-var">WordAddCOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814091"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordOpC2"><span class="hs-identifier hs-var">wordOpC2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-155"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identityCDynFlags"><span class="hs-identifier hs-var">identityCDynFlags</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-156"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814092"><a href="#local-6989586621684814092"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordSubCOp"><span class="hs-identifier hs-var">WordSubCOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814092"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordOpC2"><span class="hs-identifier hs-var">wordOpC2</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentityCDynFlags"><span class="hs-identifier hs-var">rightIdentityCDynFlags</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span>
</span><a name="line-158"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#retLitNoC"><span class="hs-identifier hs-var">retLitNoC</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-159"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814093"><a href="#local-6989586621684814093"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordMulOp"><span class="hs-identifier hs-var">WordMulOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814093"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordOp2"><span class="hs-identifier hs-var">wordOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identityDynFlags"><span class="hs-identifier hs-var">identityDynFlags</span></a><span> </span><a href="PrelRules.html#onew"><span class="hs-identifier hs-var">onew</span></a><span>
</span><a name="line-161"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#numFoldingRules"><span class="hs-identifier hs-var">numFoldingRules</span></a><span> </span><a href="PrimOp.html#WordMulOp"><span class="hs-identifier hs-var">WordMulOp</span></a><span> </span><a href="PrelRules.html#wordPrimOps"><span class="hs-identifier hs-var">wordPrimOps</span></a><span>
</span><a name="line-162"></a><span>                                               </span><span class="hs-special">]</span><span>
</span><a name="line-163"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814094"><a href="#local-6989586621684814094"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordQuotOp"><span class="hs-identifier hs-var">WordQuotOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814094"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#nonZeroLit"><span class="hs-identifier hs-var">nonZeroLit</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordOp2"><span class="hs-identifier hs-var">wordOp2</span></a><span> </span><span class="hs-identifier hs-var">quot</span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier hs-var">rightIdentityDynFlags</span></a><span> </span><a href="PrelRules.html#onew"><span class="hs-identifier hs-var">onew</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-165"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814095"><a href="#local-6989586621684814095"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordRemOp"><span class="hs-identifier hs-var">WordRemOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814095"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#nonZeroLit"><span class="hs-identifier hs-var">nonZeroLit</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordOp2"><span class="hs-identifier hs-var">wordOp2</span></a><span> </span><span class="hs-identifier hs-var">rem</span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#leftZero"><span class="hs-identifier hs-var">leftZero</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span>
</span><a name="line-167"></a><span>                                               </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684814096"><a href="#local-6989586621684814096"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getLiteral"><span class="hs-identifier hs-var">getLiteral</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-168"></a><span>                                                    </span><a name="local-6989586621684814097"><a href="#local-6989586621684814097"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-169"></a><span>                                                    </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814096"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelRules.html#onew"><span class="hs-identifier hs-var">onew</span></a><span> </span><a href="#local-6989586621684814097"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>                                                    </span><a href="PrelRules.html#retLit"><span class="hs-identifier hs-var">retLit</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span>
</span><a name="line-171"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#retLit"><span class="hs-identifier hs-var">retLit</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-172"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814098"><a href="#local-6989586621684814098"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#AndOp"><span class="hs-identifier hs-var">AndOp</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814098"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordOp2"><span class="hs-identifier hs-var">wordOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.&amp;.</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#idempotent"><span class="hs-identifier hs-var">idempotent</span></a><span>
</span><a name="line-174"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#zeroElem"><span class="hs-identifier hs-var">zeroElem</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-175"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814099"><a href="#local-6989586621684814099"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#OrOp"><span class="hs-identifier hs-var">OrOp</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814099"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordOp2"><span class="hs-identifier hs-var">wordOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#idempotent"><span class="hs-identifier hs-var">idempotent</span></a><span>
</span><a name="line-177"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identityDynFlags"><span class="hs-identifier hs-var">identityDynFlags</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-178"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814100"><a href="#local-6989586621684814100"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#XorOp"><span class="hs-identifier hs-var">XorOp</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814100"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordOp2"><span class="hs-identifier hs-var">wordOp2</span></a><span> </span><span class="hs-identifier hs-var">xor</span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identityDynFlags"><span class="hs-identifier hs-var">identityDynFlags</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span>
</span><a name="line-180"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#retLit"><span class="hs-identifier hs-var">retLit</span></a><span> </span><a href="PrelRules.html#zerow"><span class="hs-identifier hs-var">zerow</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-181"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814101"><a href="#local-6989586621684814101"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#NotOp"><span class="hs-identifier hs-var">NotOp</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814101"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#unaryLit"><span class="hs-identifier hs-var">unaryLit</span></a><span> </span><a href="PrelRules.html#complementOp"><span class="hs-identifier hs-var">complementOp</span></a><span>
</span><a name="line-182"></a><span>                                               </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#inversePrimOp"><span class="hs-identifier hs-var">inversePrimOp</span></a><span> </span><a href="PrimOp.html#NotOp"><span class="hs-identifier hs-var">NotOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-183"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814102"><a href="#local-6989586621684814102"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#SllOp"><span class="hs-identifier hs-var">SllOp</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814102"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#shiftRule"><span class="hs-identifier hs-var">shiftRule</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Bits.shiftL</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-184"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814103"><a href="#local-6989586621684814103"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#SrlOp"><span class="hs-identifier hs-var">SrlOp</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814103"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#shiftRule"><span class="hs-identifier hs-var">shiftRule</span></a><span> </span><a href="PrelRules.html#shiftRightLogical"><span class="hs-identifier hs-var">shiftRightLogical</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-comment">-- coercions</span><span>
</span><a name="line-187"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814104"><a href="#local-6989586621684814104"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Word2IntOp"><span class="hs-identifier hs-var">Word2IntOp</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814104"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLitDynFlags"><span class="hs-identifier hs-var">liftLitDynFlags</span></a><span> </span><a href="Literal.html#word2IntLit"><span class="hs-identifier hs-var">word2IntLit</span></a><span>
</span><a name="line-188"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#inversePrimOp"><span class="hs-identifier hs-var">inversePrimOp</span></a><span> </span><a href="PrimOp.html#Int2WordOp"><span class="hs-identifier hs-var">Int2WordOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-189"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814105"><a href="#local-6989586621684814105"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Int2WordOp"><span class="hs-identifier hs-var">Int2WordOp</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814105"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLitDynFlags"><span class="hs-identifier hs-var">liftLitDynFlags</span></a><span> </span><a href="Literal.html#int2WordLit"><span class="hs-identifier hs-var">int2WordLit</span></a><span>
</span><a name="line-190"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#inversePrimOp"><span class="hs-identifier hs-var">inversePrimOp</span></a><span> </span><a href="PrimOp.html#Word2IntOp"><span class="hs-identifier hs-var">Word2IntOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-191"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814106"><a href="#local-6989586621684814106"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Narrow8IntOp"><span class="hs-identifier hs-var">Narrow8IntOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814106"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#narrow8IntLit"><span class="hs-identifier hs-var">narrow8IntLit</span></a><span>
</span><a name="line-192"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow8IntOp"><span class="hs-identifier hs-var">Narrow8IntOp</span></a><span>
</span><a name="line-193"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrimOp.html#Narrow8IntOp"><span class="hs-identifier hs-var">Narrow8IntOp</span></a><span> </span><span class="hs-special">`</span><a href="PrelRules.html#subsumesPrimOp"><span class="hs-identifier hs-var">subsumesPrimOp</span></a><span class="hs-special">`</span><span> </span><a href="PrimOp.html#Narrow16IntOp"><span class="hs-identifier hs-var">Narrow16IntOp</span></a><span>
</span><a name="line-194"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrimOp.html#Narrow8IntOp"><span class="hs-identifier hs-var">Narrow8IntOp</span></a><span> </span><span class="hs-special">`</span><a href="PrelRules.html#subsumesPrimOp"><span class="hs-identifier hs-var">subsumesPrimOp</span></a><span class="hs-special">`</span><span> </span><a href="PrimOp.html#Narrow32IntOp"><span class="hs-identifier hs-var">Narrow32IntOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-195"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814107"><a href="#local-6989586621684814107"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Narrow16IntOp"><span class="hs-identifier hs-var">Narrow16IntOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814107"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#narrow16IntLit"><span class="hs-identifier hs-var">narrow16IntLit</span></a><span>
</span><a name="line-196"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow8IntOp"><span class="hs-identifier hs-var">Narrow8IntOp</span></a><span>
</span><a name="line-197"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow16IntOp"><span class="hs-identifier hs-var">Narrow16IntOp</span></a><span>
</span><a name="line-198"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrimOp.html#Narrow16IntOp"><span class="hs-identifier hs-var">Narrow16IntOp</span></a><span> </span><span class="hs-special">`</span><a href="PrelRules.html#subsumesPrimOp"><span class="hs-identifier hs-var">subsumesPrimOp</span></a><span class="hs-special">`</span><span> </span><a href="PrimOp.html#Narrow32IntOp"><span class="hs-identifier hs-var">Narrow32IntOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-199"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814108"><a href="#local-6989586621684814108"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Narrow32IntOp"><span class="hs-identifier hs-var">Narrow32IntOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814108"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#narrow32IntLit"><span class="hs-identifier hs-var">narrow32IntLit</span></a><span>
</span><a name="line-200"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow8IntOp"><span class="hs-identifier hs-var">Narrow8IntOp</span></a><span>
</span><a name="line-201"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow16IntOp"><span class="hs-identifier hs-var">Narrow16IntOp</span></a><span>
</span><a name="line-202"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow32IntOp"><span class="hs-identifier hs-var">Narrow32IntOp</span></a><span>
</span><a name="line-203"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#removeOp32"><span class="hs-identifier hs-var">removeOp32</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-204"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814109"><a href="#local-6989586621684814109"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Narrow8WordOp"><span class="hs-identifier hs-var">Narrow8WordOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814109"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#narrow8WordLit"><span class="hs-identifier hs-var">narrow8WordLit</span></a><span>
</span><a name="line-205"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow8WordOp"><span class="hs-identifier hs-var">Narrow8WordOp</span></a><span>
</span><a name="line-206"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrimOp.html#Narrow8WordOp"><span class="hs-identifier hs-var">Narrow8WordOp</span></a><span> </span><span class="hs-special">`</span><a href="PrelRules.html#subsumesPrimOp"><span class="hs-identifier hs-var">subsumesPrimOp</span></a><span class="hs-special">`</span><span> </span><a href="PrimOp.html#Narrow16WordOp"><span class="hs-identifier hs-var">Narrow16WordOp</span></a><span>
</span><a name="line-207"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrimOp.html#Narrow8WordOp"><span class="hs-identifier hs-var">Narrow8WordOp</span></a><span> </span><span class="hs-special">`</span><a href="PrelRules.html#subsumesPrimOp"><span class="hs-identifier hs-var">subsumesPrimOp</span></a><span class="hs-special">`</span><span> </span><a href="PrimOp.html#Narrow32WordOp"><span class="hs-identifier hs-var">Narrow32WordOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-208"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814110"><a href="#local-6989586621684814110"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Narrow16WordOp"><span class="hs-identifier hs-var">Narrow16WordOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814110"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#narrow16WordLit"><span class="hs-identifier hs-var">narrow16WordLit</span></a><span>
</span><a name="line-209"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow8WordOp"><span class="hs-identifier hs-var">Narrow8WordOp</span></a><span>
</span><a name="line-210"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow16WordOp"><span class="hs-identifier hs-var">Narrow16WordOp</span></a><span>
</span><a name="line-211"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrimOp.html#Narrow16WordOp"><span class="hs-identifier hs-var">Narrow16WordOp</span></a><span> </span><span class="hs-special">`</span><a href="PrelRules.html#subsumesPrimOp"><span class="hs-identifier hs-var">subsumesPrimOp</span></a><span class="hs-special">`</span><span> </span><a href="PrimOp.html#Narrow32WordOp"><span class="hs-identifier hs-var">Narrow32WordOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-212"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814111"><a href="#local-6989586621684814111"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Narrow32WordOp"><span class="hs-identifier hs-var">Narrow32WordOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814111"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#narrow32WordLit"><span class="hs-identifier hs-var">narrow32WordLit</span></a><span>
</span><a name="line-213"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow8WordOp"><span class="hs-identifier hs-var">Narrow8WordOp</span></a><span>
</span><a name="line-214"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow16WordOp"><span class="hs-identifier hs-var">Narrow16WordOp</span></a><span>
</span><a name="line-215"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier hs-var">subsumedByPrimOp</span></a><span> </span><a href="PrimOp.html#Narrow32WordOp"><span class="hs-identifier hs-var">Narrow32WordOp</span></a><span>
</span><a name="line-216"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#removeOp32"><span class="hs-identifier hs-var">removeOp32</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-217"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814112"><a href="#local-6989586621684814112"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#OrdOp"><span class="hs-identifier hs-var">OrdOp</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814112"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#char2IntLit"><span class="hs-identifier hs-var">char2IntLit</span></a><span>
</span><a name="line-218"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#inversePrimOp"><span class="hs-identifier hs-var">inversePrimOp</span></a><span> </span><a href="PrimOp.html#ChrOp"><span class="hs-identifier hs-var">ChrOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-219"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814113"><a href="#local-6989586621684814113"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#ChrOp"><span class="hs-identifier hs-var">ChrOp</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814113"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814114"><a href="#local-6989586621684814114"><span class="hs-identifier">lit</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-220"></a><span>                                                       </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="Literal.html#litFitsInChar"><span class="hs-identifier hs-var">litFitsInChar</span></a><span> </span><a href="#local-6989586621684814114"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>                                                       </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#int2CharLit"><span class="hs-identifier hs-var">int2CharLit</span></a><span>
</span><a name="line-222"></a><span>                                                  </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#inversePrimOp"><span class="hs-identifier hs-var">inversePrimOp</span></a><span> </span><a href="PrimOp.html#OrdOp"><span class="hs-identifier hs-var">OrdOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-223"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814115"><a href="#local-6989586621684814115"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Float2IntOp"><span class="hs-identifier hs-var">Float2IntOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814115"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#float2IntLit"><span class="hs-identifier hs-var">float2IntLit</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-224"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814116"><a href="#local-6989586621684814116"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Int2FloatOp"><span class="hs-identifier hs-var">Int2FloatOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814116"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#int2FloatLit"><span class="hs-identifier hs-var">int2FloatLit</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-225"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814117"><a href="#local-6989586621684814117"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Double2IntOp"><span class="hs-identifier hs-var">Double2IntOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814117"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#double2IntLit"><span class="hs-identifier hs-var">double2IntLit</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-226"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814118"><a href="#local-6989586621684814118"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Int2DoubleOp"><span class="hs-identifier hs-var">Int2DoubleOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814118"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#int2DoubleLit"><span class="hs-identifier hs-var">int2DoubleLit</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- SUP: Not sure what the standard says about precision in the following 2 cases</span><span>
</span><a name="line-228"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814119"><a href="#local-6989586621684814119"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Float2DoubleOp"><span class="hs-identifier hs-var">Float2DoubleOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814119"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#float2DoubleLit"><span class="hs-identifier hs-var">float2DoubleLit</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-229"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814120"><a href="#local-6989586621684814120"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#Double2FloatOp"><span class="hs-identifier hs-var">Double2FloatOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814120"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#liftLit"><span class="hs-identifier hs-var">liftLit</span></a><span> </span><a href="Literal.html#double2FloatLit"><span class="hs-identifier hs-var">double2FloatLit</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">-- Float</span><span>
</span><a name="line-232"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814121"><a href="#local-6989586621684814121"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatAddOp"><span class="hs-identifier hs-var">FloatAddOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814121"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#floatOp2"><span class="hs-identifier hs-var">floatOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identity"><span class="hs-identifier hs-var">identity</span></a><span> </span><a href="PrelRules.html#zerof"><span class="hs-identifier hs-var">zerof</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-234"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814122"><a href="#local-6989586621684814122"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatSubOp"><span class="hs-identifier hs-var">FloatSubOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814122"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#floatOp2"><span class="hs-identifier hs-var">floatOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentity"><span class="hs-identifier hs-var">rightIdentity</span></a><span> </span><a href="PrelRules.html#zerof"><span class="hs-identifier hs-var">zerof</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-236"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814123"><a href="#local-6989586621684814123"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatMulOp"><span class="hs-identifier hs-var">FloatMulOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814123"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#floatOp2"><span class="hs-identifier hs-var">floatOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-237"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identity"><span class="hs-identifier hs-var">identity</span></a><span> </span><a href="PrelRules.html#onef"><span class="hs-identifier hs-var">onef</span></a><span>
</span><a name="line-238"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#strengthReduction"><span class="hs-identifier hs-var">strengthReduction</span></a><span> </span><a href="PrelRules.html#twof"><span class="hs-identifier hs-var">twof</span></a><span> </span><a href="PrimOp.html#FloatAddOp"><span class="hs-identifier hs-var">FloatAddOp</span></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-239"></a><span>                         </span><span class="hs-comment">-- zeroElem zerof doesn't hold because of NaN</span><span>
</span><a name="line-240"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814124"><a href="#local-6989586621684814124"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatDivOp"><span class="hs-identifier hs-var">FloatDivOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814124"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#guardFloatDiv"><span class="hs-identifier hs-var">guardFloatDiv</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#floatOp2"><span class="hs-identifier hs-var">floatOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentity"><span class="hs-identifier hs-var">rightIdentity</span></a><span> </span><a href="PrelRules.html#onef"><span class="hs-identifier hs-var">onef</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-242"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814125"><a href="#local-6989586621684814125"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatNegOp"><span class="hs-identifier hs-var">FloatNegOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814125"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#unaryLit"><span class="hs-identifier hs-var">unaryLit</span></a><span> </span><a href="PrelRules.html#negOp"><span class="hs-identifier hs-var">negOp</span></a><span>
</span><a name="line-243"></a><span>                                                </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#inversePrimOp"><span class="hs-identifier hs-var">inversePrimOp</span></a><span> </span><a href="PrimOp.html#FloatNegOp"><span class="hs-identifier hs-var">FloatNegOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span class="hs-comment">-- Double</span><span>
</span><a name="line-246"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814126"><a href="#local-6989586621684814126"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleAddOp"><span class="hs-identifier hs-var">DoubleAddOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814126"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#doubleOp2"><span class="hs-identifier hs-var">doubleOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identity"><span class="hs-identifier hs-var">identity</span></a><span> </span><a href="PrelRules.html#zerod"><span class="hs-identifier hs-var">zerod</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-248"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814127"><a href="#local-6989586621684814127"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleSubOp"><span class="hs-identifier hs-var">DoubleSubOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814127"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#doubleOp2"><span class="hs-identifier hs-var">doubleOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentity"><span class="hs-identifier hs-var">rightIdentity</span></a><span> </span><a href="PrelRules.html#zerod"><span class="hs-identifier hs-var">zerod</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-250"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814128"><a href="#local-6989586621684814128"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleMulOp"><span class="hs-identifier hs-var">DoubleMulOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814128"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#doubleOp2"><span class="hs-identifier hs-var">doubleOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-251"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#identity"><span class="hs-identifier hs-var">identity</span></a><span> </span><a href="PrelRules.html#oned"><span class="hs-identifier hs-var">oned</span></a><span>
</span><a name="line-252"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#strengthReduction"><span class="hs-identifier hs-var">strengthReduction</span></a><span> </span><a href="PrelRules.html#twod"><span class="hs-identifier hs-var">twod</span></a><span> </span><a href="PrimOp.html#DoubleAddOp"><span class="hs-identifier hs-var">DoubleAddOp</span></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-253"></a><span>                          </span><span class="hs-comment">-- zeroElem zerod doesn't hold because of NaN</span><span>
</span><a name="line-254"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814129"><a href="#local-6989586621684814129"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleDivOp"><span class="hs-identifier hs-var">DoubleDivOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814129"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#guardDoubleDiv"><span class="hs-identifier hs-var">guardDoubleDiv</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#doubleOp2"><span class="hs-identifier hs-var">doubleOp2</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#rightIdentity"><span class="hs-identifier hs-var">rightIdentity</span></a><span> </span><a href="PrelRules.html#oned"><span class="hs-identifier hs-var">oned</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-256"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814130"><a href="#local-6989586621684814130"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleNegOp"><span class="hs-identifier hs-var">DoubleNegOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814130"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#unaryLit"><span class="hs-identifier hs-var">unaryLit</span></a><span> </span><a href="PrelRules.html#negOp"><span class="hs-identifier hs-var">negOp</span></a><span>
</span><a name="line-257"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#inversePrimOp"><span class="hs-identifier hs-var">inversePrimOp</span></a><span> </span><a href="PrimOp.html#DoubleNegOp"><span class="hs-identifier hs-var">DoubleNegOp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-comment">-- Relational operators</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814131"><a href="#local-6989586621684814131"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntEqOp"><span class="hs-identifier hs-var">IntEqOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814131"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#litEq"><span class="hs-identifier hs-var">litEq</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-262"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814132"><a href="#local-6989586621684814132"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntNeOp"><span class="hs-identifier hs-var">IntNeOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814132"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#litEq"><span class="hs-identifier hs-var">litEq</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-263"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814133"><a href="#local-6989586621684814133"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#CharEqOp"><span class="hs-identifier hs-var">CharEqOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814133"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#litEq"><span class="hs-identifier hs-var">litEq</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-264"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814134"><a href="#local-6989586621684814134"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#CharNeOp"><span class="hs-identifier hs-var">CharNeOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814134"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#litEq"><span class="hs-identifier hs-var">litEq</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814135"><a href="#local-6989586621684814135"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntGtOp"><span class="hs-identifier hs-var">IntGtOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814135"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Gt"><span class="hs-identifier hs-var">Gt</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-267"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814136"><a href="#local-6989586621684814136"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntGeOp"><span class="hs-identifier hs-var">IntGeOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814136"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Ge"><span class="hs-identifier hs-var">Ge</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-268"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814137"><a href="#local-6989586621684814137"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntLeOp"><span class="hs-identifier hs-var">IntLeOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814137"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Le"><span class="hs-identifier hs-var">Le</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-269"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814138"><a href="#local-6989586621684814138"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#IntLtOp"><span class="hs-identifier hs-var">IntLtOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814138"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Lt"><span class="hs-identifier hs-var">Lt</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814139"><a href="#local-6989586621684814139"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#CharGtOp"><span class="hs-identifier hs-var">CharGtOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814139"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Gt"><span class="hs-identifier hs-var">Gt</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-272"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814140"><a href="#local-6989586621684814140"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#CharGeOp"><span class="hs-identifier hs-var">CharGeOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814140"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Ge"><span class="hs-identifier hs-var">Ge</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-273"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814141"><a href="#local-6989586621684814141"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#CharLeOp"><span class="hs-identifier hs-var">CharLeOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814141"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Le"><span class="hs-identifier hs-var">Le</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-274"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814142"><a href="#local-6989586621684814142"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#CharLtOp"><span class="hs-identifier hs-var">CharLtOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814142"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Lt"><span class="hs-identifier hs-var">Lt</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814143"><a href="#local-6989586621684814143"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatGtOp"><span class="hs-identifier hs-var">FloatGtOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814143"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814144"><a href="#local-6989586621684814144"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatGeOp"><span class="hs-identifier hs-var">FloatGeOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814144"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=</span><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814145"><a href="#local-6989586621684814145"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatLeOp"><span class="hs-identifier hs-var">FloatLeOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814145"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814146"><a href="#local-6989586621684814146"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatLtOp"><span class="hs-identifier hs-var">FloatLtOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814146"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814147"><a href="#local-6989586621684814147"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatEqOp"><span class="hs-identifier hs-var">FloatEqOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814147"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814148"><a href="#local-6989586621684814148"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#FloatNeOp"><span class="hs-identifier hs-var">FloatNeOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814148"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span class="hs-special">)</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814149"><a href="#local-6989586621684814149"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleGtOp"><span class="hs-identifier hs-var">DoubleGtOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814149"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814150"><a href="#local-6989586621684814150"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleGeOp"><span class="hs-identifier hs-var">DoubleGeOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814150"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=</span><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814151"><a href="#local-6989586621684814151"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleLeOp"><span class="hs-identifier hs-var">DoubleLeOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814151"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814152"><a href="#local-6989586621684814152"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleLtOp"><span class="hs-identifier hs-var">DoubleLtOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814152"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814153"><a href="#local-6989586621684814153"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleEqOp"><span class="hs-identifier hs-var">DoubleEqOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814153"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814154"><a href="#local-6989586621684814154"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#DoubleNeOp"><span class="hs-identifier hs-var">DoubleNeOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier hs-var">mkFloatingRelOpRule</span></a><span> </span><a href="#local-6989586621684814154"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span class="hs-special">)</span><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814155"><a href="#local-6989586621684814155"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordGtOp"><span class="hs-identifier hs-var">WordGtOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814155"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Gt"><span class="hs-identifier hs-var">Gt</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-291"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814156"><a href="#local-6989586621684814156"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordGeOp"><span class="hs-identifier hs-var">WordGeOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814156"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Ge"><span class="hs-identifier hs-var">Ge</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-292"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814157"><a href="#local-6989586621684814157"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordLeOp"><span class="hs-identifier hs-var">WordLeOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814157"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Le"><span class="hs-identifier hs-var">Le</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-293"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814158"><a href="#local-6989586621684814158"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordLtOp"><span class="hs-identifier hs-var">WordLtOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814158"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-special">)</span><span>  </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#boundsCmp"><span class="hs-identifier hs-var">boundsCmp</span></a><span> </span><a href="PrelRules.html#Lt"><span class="hs-identifier hs-var">Lt</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-294"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814159"><a href="#local-6989586621684814159"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordEqOp"><span class="hs-identifier hs-var">WordEqOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814159"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#litEq"><span class="hs-identifier hs-var">litEq</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-295"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814160"><a href="#local-6989586621684814160"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#WordNeOp"><span class="hs-identifier hs-var">WordNeOp</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier hs-var">mkRelOpRule</span></a><span> </span><a href="#local-6989586621684814160"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#litEq"><span class="hs-identifier hs-var">litEq</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814161"><a href="#local-6989586621684814161"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#AddrAddOp"><span class="hs-identifier hs-var">AddrAddOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814161"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier hs-var">rightIdentityDynFlags</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814162"><a href="#local-6989586621684814162"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#SeqOp"><span class="hs-identifier hs-var">SeqOp</span></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814162"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#seqRule"><span class="hs-identifier hs-var">seqRule</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-300"></a><span class="hs-identifier">primOpRules</span><span> </span><a name="local-6989586621684814163"><a href="#local-6989586621684814163"><span class="hs-identifier">nm</span></a></a><span> </span><a href="PrimOp.html#SparkOp"><span class="hs-identifier hs-var">SparkOp</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814163"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#sparkRule"><span class="hs-identifier hs-var">sparkRule</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span class="hs-identifier">primOpRules</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Doing the business}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span class="hs-comment">-- useful shorthands</span><span>
</span><a name="line-313"></a><span class="hs-identifier">mkPrimOpRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span>
</span><a name="line-314"></a><a name="mkPrimOpRule"><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier">mkPrimOpRule</span></a></a><span> </span><a name="local-6989586621684814164"><a href="#local-6989586621684814164"><span class="hs-identifier">nm</span></a></a><span> </span><a name="local-6989586621684814165"><a href="#local-6989586621684814165"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621684814166"><a href="#local-6989586621684814166"><span class="hs-identifier">rules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#mkBasicRule"><span class="hs-identifier hs-var">mkBasicRule</span></a><span> </span><a href="#local-6989586621684814164"><span class="hs-identifier hs-var">nm</span></a><span> </span><a href="#local-6989586621684814165"><span class="hs-identifier hs-var">arity</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">msum</span><span> </span><a href="#local-6989586621684814166"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-identifier">mkRelOpRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621684814069"><a href="#local-6989586621684814069"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621684814069"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621684814069"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814069"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span>
</span><a name="line-318"></a><a name="mkRelOpRule"><a href="PrelRules.html#mkRelOpRule"><span class="hs-identifier">mkRelOpRule</span></a></a><span> </span><a name="local-6989586621684814167"><a href="#local-6989586621684814167"><span class="hs-identifier">nm</span></a></a><span> </span><a name="local-6989586621684814168"><a href="#local-6989586621684814168"><span class="hs-identifier">cmp</span></a></a><span> </span><a name="local-6989586621684814169"><a href="#local-6989586621684814169"><span class="hs-identifier">extra</span></a></a><span>
</span><a name="line-319"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814167"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-320"></a><span>    </span><a href="PrelRules.html#binaryCmpLit"><span class="hs-identifier hs-var">binaryCmpLit</span></a><span> </span><a href="#local-6989586621684814168"><span class="hs-identifier hs-var">cmp</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684814170"><span class="hs-identifier hs-var">equal_rule</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684814169"><span class="hs-identifier hs-var">extra</span></a><span>
</span><a name="line-321"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-322"></a><span>        </span><span class="hs-comment">-- x `cmp` x does not depend on x, so</span><span>
</span><a name="line-323"></a><span>        </span><span class="hs-comment">-- compute it for the arbitrary value 'True'</span><span>
</span><a name="line-324"></a><span>        </span><span class="hs-comment">-- and use that result</span><span>
</span><a name="line-325"></a><span>    </span><a name="local-6989586621684814170"><a href="#local-6989586621684814170"><span class="hs-identifier">equal_rule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="PrelRules.html#equalArgs"><span class="hs-identifier hs-var">equalArgs</span></a><span>
</span><a name="line-326"></a><span>                    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621684814171"><a href="#local-6989586621684814171"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-327"></a><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684814168"><span class="hs-identifier hs-var">cmp</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-328"></a><span>                              </span><span class="hs-keyword">then</span><span> </span><a href="PrelRules.html#trueValInt"><span class="hs-identifier hs-var">trueValInt</span></a><span>  </span><a href="#local-6989586621684814171"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-329"></a><span>                              </span><span class="hs-keyword">else</span><span> </span><a href="PrelRules.html#falseValInt"><span class="hs-identifier hs-var">falseValInt</span></a><span> </span><a href="#local-6989586621684814171"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span class="hs-comment">{- Note [Rules for floating-point comparisons]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We need different rules for floating-point values because for floats
it is not true that x = x (for NaNs); so we do not want the equal_rule
rule that mkRelOpRule uses.

Note also that, in the case of equality/inequality, we do /not/
want to switch to a case-expression.  For example, we do not want
to convert
   case (eqFloat# x 3.8#) of
     True -&gt; this
     False -&gt; that
to
  case x of
    3.8#::Float# -&gt; this
    _            -&gt; that
See Trac #9238.  Reason: comparing floating-point values for equality
delicate, and we don't want to implement that delicacy in the code for
case expressions.  So we make it an invariant of Core that a case
expression never scrutinises a Float# or Double#.

This transformation is what the litEq rule does;
see Note [The litEq rule: converting equality to case].
So we /refrain/ from using litEq for mkFloatingRelOpRule.
-}</span><span>
</span><a name="line-356"></a><span>
</span><a name="line-357"></a><span class="hs-identifier">mkFloatingRelOpRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621684814068"><a href="#local-6989586621684814068"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621684814068"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621684814068"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814068"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-358"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span>
</span><a name="line-359"></a><span class="hs-comment">-- See Note [Rules for floating-point comparisons]</span><span>
</span><a name="line-360"></a><a name="mkFloatingRelOpRule"><a href="PrelRules.html#mkFloatingRelOpRule"><span class="hs-identifier">mkFloatingRelOpRule</span></a></a><span> </span><a name="local-6989586621684814172"><a href="#local-6989586621684814172"><span class="hs-identifier">nm</span></a></a><span> </span><a name="local-6989586621684814173"><a href="#local-6989586621684814173"><span class="hs-identifier">cmp</span></a></a><span>
</span><a name="line-361"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#mkPrimOpRule"><span class="hs-identifier hs-var">mkPrimOpRule</span></a><span> </span><a href="#local-6989586621684814172"><span class="hs-identifier hs-var">nm</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">[</span><a href="PrelRules.html#binaryCmpLit"><span class="hs-identifier hs-var">binaryCmpLit</span></a><span> </span><a href="#local-6989586621684814173"><span class="hs-identifier hs-var">cmp</span></a><span class="hs-special">]</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-comment">-- common constants</span><span>
</span><a name="line-364"></a><span class="hs-identifier">zeroi</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">onei</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">zerow</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">onew</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span>
</span><a name="line-365"></a><a name="zeroi"><a href="PrelRules.html#zeroi"><span class="hs-identifier">zeroi</span></a></a><span> </span><a name="local-6989586621684814174"><a href="#local-6989586621684814174"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitInt"><span class="hs-identifier hs-var">mkLitInt</span></a><span>  </span><a href="#local-6989586621684814174"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-366"></a><a name="onei"><a href="PrelRules.html#onei"><span class="hs-identifier">onei</span></a></a><span>  </span><a name="local-6989586621684814175"><a href="#local-6989586621684814175"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitInt"><span class="hs-identifier hs-var">mkLitInt</span></a><span>  </span><a href="#local-6989586621684814175"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-367"></a><a name="zerow"><a href="PrelRules.html#zerow"><span class="hs-identifier">zerow</span></a></a><span> </span><a name="local-6989586621684814176"><a href="#local-6989586621684814176"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitWord"><span class="hs-identifier hs-var">mkLitWord</span></a><span> </span><a href="#local-6989586621684814176"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-368"></a><a name="onew"><a href="PrelRules.html#onew"><span class="hs-identifier">onew</span></a></a><span>  </span><a name="local-6989586621684814177"><a href="#local-6989586621684814177"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitWord"><span class="hs-identifier hs-var">mkLitWord</span></a><span> </span><a href="#local-6989586621684814177"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span class="hs-identifier">zerof</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">onef</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">twof</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">zerod</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">oned</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">twod</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span>
</span><a name="line-371"></a><a name="zerof"><a href="PrelRules.html#zerof"><span class="hs-identifier">zerof</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitFloat"><span class="hs-identifier hs-var">mkLitFloat</span></a><span> </span><span class="hs-number">0.0</span><span>
</span><a name="line-372"></a><a name="onef"><a href="PrelRules.html#onef"><span class="hs-identifier">onef</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitFloat"><span class="hs-identifier hs-var">mkLitFloat</span></a><span> </span><span class="hs-number">1.0</span><span>
</span><a name="line-373"></a><a name="twof"><a href="PrelRules.html#twof"><span class="hs-identifier">twof</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitFloat"><span class="hs-identifier hs-var">mkLitFloat</span></a><span> </span><span class="hs-number">2.0</span><span>
</span><a name="line-374"></a><a name="zerod"><a href="PrelRules.html#zerod"><span class="hs-identifier">zerod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitDouble"><span class="hs-identifier hs-var">mkLitDouble</span></a><span> </span><span class="hs-number">0.0</span><span>
</span><a name="line-375"></a><a name="oned"><a href="PrelRules.html#oned"><span class="hs-identifier">oned</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitDouble"><span class="hs-identifier hs-var">mkLitDouble</span></a><span> </span><span class="hs-number">1.0</span><span>
</span><a name="line-376"></a><a name="twod"><a href="PrelRules.html#twod"><span class="hs-identifier">twod</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitDouble"><span class="hs-identifier hs-var">mkLitDouble</span></a><span> </span><span class="hs-number">2.0</span><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-identifier">cmpOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621684814067"><a href="#local-6989586621684814067"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621684814067"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621684814067"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814067"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-379"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-380"></a><a name="cmpOp"><a href="PrelRules.html#cmpOp"><span class="hs-identifier">cmpOp</span></a></a><span> </span><a name="local-6989586621684814178"><a href="#local-6989586621684814178"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814179"><a href="#local-6989586621684814179"><span class="hs-identifier">cmp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814181"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-381"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-382"></a><span>    </span><a name="local-6989586621684814180"><a href="#local-6989586621684814180"><span class="hs-identifier">done</span></a></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#trueValInt"><span class="hs-identifier hs-var">trueValInt</span></a><span>  </span><a href="#local-6989586621684814178"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-383"></a><span>    </span><span class="hs-identifier">done</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#falseValInt"><span class="hs-identifier hs-var">falseValInt</span></a><span> </span><a href="#local-6989586621684814178"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span>    </span><span class="hs-comment">-- These compares are at different types</span><span>
</span><a name="line-386"></a><span>    </span><a name="local-6989586621684814181"><a href="#local-6989586621684814181"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitChar"><span class="hs-identifier hs-var">LitChar</span></a><span> </span><a name="local-6989586621684814182"><a href="#local-6989586621684814182"><span class="hs-identifier">i1</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><a href="Literal.html#LitChar"><span class="hs-identifier hs-var">LitChar</span></a><span> </span><a name="local-6989586621684814183"><a href="#local-6989586621684814183"><span class="hs-identifier">i2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814180"><span class="hs-identifier hs-var">done</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814182"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814179"><span class="hs-identifier hs-var">cmp</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814183"><span class="hs-identifier hs-var">i2</span></a><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span> </span><a name="local-6989586621684814184"><a href="#local-6989586621684814184"><span class="hs-identifier">i1</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span> </span><a name="local-6989586621684814185"><a href="#local-6989586621684814185"><span class="hs-identifier">i2</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814180"><span class="hs-identifier hs-var">done</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814184"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814179"><span class="hs-identifier hs-var">cmp</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814185"><span class="hs-identifier hs-var">i2</span></a><span class="hs-special">)</span><span>
</span><a name="line-388"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><a name="local-6989586621684814186"><a href="#local-6989586621684814186"><span class="hs-identifier">i1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><a name="local-6989586621684814187"><a href="#local-6989586621684814187"><span class="hs-identifier">i2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814180"><span class="hs-identifier hs-var">done</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814186"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814179"><span class="hs-identifier hs-var">cmp</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814187"><span class="hs-identifier hs-var">i2</span></a><span class="hs-special">)</span><span>
</span><a name="line-389"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a name="local-6989586621684814188"><a href="#local-6989586621684814188"><span class="hs-identifier">nt1</span></a></a><span> </span><a name="local-6989586621684814189"><a href="#local-6989586621684814189"><span class="hs-identifier">i1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a name="local-6989586621684814190"><a href="#local-6989586621684814190"><span class="hs-identifier">nt2</span></a></a><span> </span><a name="local-6989586621684814191"><a href="#local-6989586621684814191"><span class="hs-identifier">i2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-390"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814188"><span class="hs-identifier hs-var">nt1</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621684814190"><span class="hs-identifier hs-var">nt2</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-391"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814180"><span class="hs-identifier hs-var">done</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814189"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814179"><span class="hs-identifier hs-var">cmp</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814191"><span class="hs-identifier hs-var">i2</span></a><span class="hs-special">)</span><span>
</span><a name="line-392"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span class="hs-identifier">negOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>  </span><span class="hs-comment">-- Negate</span><span>
</span><a name="line-397"></a><a name="negOp"><a href="PrelRules.html#negOp"><span class="hs-identifier">negOp</span></a></a><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-special">(</span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span> </span><span class="hs-number">0.0</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-comment">-- can't represent -0.0 as a Rational</span><span>
</span><a name="line-398"></a><span class="hs-identifier">negOp</span><span> </span><a name="local-6989586621684814192"><a href="#local-6989586621684814192"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span> </span><a name="local-6989586621684814193"><a href="#local-6989586621684814193"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="PrelRules.html#mkFloatVal"><span class="hs-identifier hs-var">mkFloatVal</span></a><span> </span><a href="#local-6989586621684814192"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684814193"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span class="hs-identifier">negOp</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><span class="hs-number">0.0</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-400"></a><span class="hs-identifier">negOp</span><span> </span><a name="local-6989586621684814194"><a href="#local-6989586621684814194"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><a name="local-6989586621684814195"><a href="#local-6989586621684814195"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="PrelRules.html#mkDoubleVal"><span class="hs-identifier hs-var">mkDoubleVal</span></a><span> </span><a href="#local-6989586621684814194"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684814195"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-401"></a><span class="hs-identifier">negOp</span><span> </span><a name="local-6989586621684814196"><a href="#local-6989586621684814196"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a name="local-6989586621684814197"><a href="#local-6989586621684814197"><span class="hs-identifier">nt</span></a></a><span> </span><a name="local-6989586621684814198"><a href="#local-6989586621684814198"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621684814199"><a href="#local-6989586621684814199"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-402"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="Literal.html#litNumIsSigned"><span class="hs-identifier hs-var">litNumIsSigned</span></a><span> </span><a href="#local-6989586621684814197"><span class="hs-identifier hs-var">nt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitNumberWrap"><span class="hs-identifier hs-var">mkLitNumberWrap</span></a><span> </span><a href="#local-6989586621684814196"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814197"><span class="hs-identifier hs-var">nt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684814198"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814199"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-403"></a><span class="hs-identifier">negOp</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span class="hs-identifier">complementOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>  </span><span class="hs-comment">-- Binary complement</span><span>
</span><a name="line-406"></a><a name="complementOp"><a href="PrelRules.html#complementOp"><span class="hs-identifier">complementOp</span></a></a><span> </span><a name="local-6989586621684814200"><a href="#local-6989586621684814200"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a name="local-6989586621684814201"><a href="#local-6989586621684814201"><span class="hs-identifier">nt</span></a></a><span> </span><a name="local-6989586621684814202"><a href="#local-6989586621684814202"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621684814203"><a href="#local-6989586621684814203"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-407"></a><span>   </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitNumberWrap"><span class="hs-identifier hs-var">mkLitNumberWrap</span></a><span> </span><a href="#local-6989586621684814200"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814201"><span class="hs-identifier hs-var">nt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">complement</span><span> </span><a href="#local-6989586621684814202"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814203"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span class="hs-identifier">complementOp</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-409"></a><span>
</span><a name="line-410"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-411"></a><span class="hs-identifier">intOp2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621684814065"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621684814066"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-412"></a><span>       </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814065"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814066"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-413"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-414"></a><a name="intOp2"><a href="PrelRules.html#intOp2"><span class="hs-identifier">intOp2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#intOp2%27"><span class="hs-identifier hs-var">intOp2'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">const</span><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span class="hs-identifier">intOp2'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621684814063"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621684814064"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814063"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814064"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-419"></a><a name="intOp2%27"><a href="PrelRules.html#intOp2%27"><span class="hs-identifier">intOp2'</span></a></a><span> </span><a name="local-6989586621684814204"><a href="#local-6989586621684814204"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684814205"><a href="#local-6989586621684814205"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814206"><a href="#local-6989586621684814206"><span class="hs-identifier">i1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814207"><a href="#local-6989586621684814207"><span class="hs-identifier">i2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-420"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684814208"><a href="#local-6989586621684814208"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814204"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621684814205"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-421"></a><span>  </span><span class="hs-keyword">in</span><span>  </span><a href="PrelRules.html#intResult"><span class="hs-identifier hs-var">intResult</span></a><span> </span><a href="#local-6989586621684814205"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814206"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814208"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814207"><span class="hs-identifier hs-var">i2</span></a><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span class="hs-identifier">intOp2'</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>            </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-comment">-- Could find LitLit</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-identifier">intOpC2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621684814061"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621684814062"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-425"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814061"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814062"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-427"></a><a name="intOpC2"><a href="PrelRules.html#intOpC2"><span class="hs-identifier">intOpC2</span></a></a><span> </span><a name="local-6989586621684814209"><a href="#local-6989586621684814209"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684814210"><a href="#local-6989586621684814210"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814211"><a href="#local-6989586621684814211"><span class="hs-identifier">i1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814212"><a href="#local-6989586621684814212"><span class="hs-identifier">i2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-428"></a><span>  </span><a href="PrelRules.html#intCResult"><span class="hs-identifier hs-var">intCResult</span></a><span> </span><a href="#local-6989586621684814210"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814211"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814209"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814212"><span class="hs-identifier hs-var">i2</span></a><span class="hs-special">)</span><span>
</span><a name="line-429"></a><span class="hs-identifier">intOpC2</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>            </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-comment">-- Could find LitLit</span><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span class="hs-identifier">shiftRightLogical</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-432"></a><span class="hs-comment">-- Shift right, putting zeros in rather than sign-propagating as Bits.shiftR would do</span><span>
</span><a name="line-433"></a><span class="hs-comment">-- Do this by converting to Word and back.  Obviously this won't work for big</span><span>
</span><a name="line-434"></a><span class="hs-comment">-- values, but its ok as we use it here</span><span>
</span><a name="line-435"></a><a name="shiftRightLogical"><a href="PrelRules.html#shiftRightLogical"><span class="hs-identifier">shiftRightLogical</span></a></a><span> </span><a name="local-6989586621684814213"><a href="#local-6989586621684814213"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814214"><a href="#local-6989586621684814214"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814215"><a href="#local-6989586621684814215"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-436"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="PrelRules.html#wordSizeInBits"><span class="hs-identifier hs-var">wordSizeInBits</span></a><span> </span><a href="#local-6989586621684814213"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">32</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814214"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814215"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-437"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="PrelRules.html#wordSizeInBits"><span class="hs-identifier hs-var">wordSizeInBits</span></a><span> </span><a href="#local-6989586621684814213"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">64</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814214"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814215"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-438"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;shiftRightLogical: unsupported word size&quot;</span><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-441"></a><span class="hs-identifier">retLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-442"></a><a name="retLit"><a href="PrelRules.html#retLit"><span class="hs-identifier">retLit</span></a></a><span> </span><a name="local-6989586621684814216"><a href="#local-6989586621684814216"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684814217"><a href="#local-6989586621684814217"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-443"></a><span>              </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814216"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621684814217"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span class="hs-identifier">retLitNoC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-446"></a><a name="retLitNoC"><a href="PrelRules.html#retLitNoC"><span class="hs-identifier">retLitNoC</span></a></a><span> </span><a name="local-6989586621684814218"><a href="#local-6989586621684814218"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684814219"><a href="#local-6989586621684814219"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-447"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684814220"><a href="#local-6989586621684814220"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814218"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621684814219"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-448"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684814221"><a href="#local-6989586621684814221"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#literalType"><span class="hs-identifier hs-var">literalType</span></a><span> </span><a href="#local-6989586621684814220"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-449"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier hs-var">mkCoreUbxTup</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684814221"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814221"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a href="#local-6989586621684814220"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><a href="#local-6989586621684814219"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span class="hs-identifier">wordOp2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621684814059"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621684814060"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-452"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814059"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814060"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-453"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-454"></a><a name="wordOp2"><a href="PrelRules.html#wordOp2"><span class="hs-identifier">wordOp2</span></a></a><span> </span><a name="local-6989586621684814222"><a href="#local-6989586621684814222"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684814223"><a href="#local-6989586621684814223"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a><span> </span><a name="local-6989586621684814224"><a href="#local-6989586621684814224"><span class="hs-identifier">w1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a><span> </span><a name="local-6989586621684814225"><a href="#local-6989586621684814225"><span class="hs-identifier">w2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-455"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#wordResult"><span class="hs-identifier hs-var">wordResult</span></a><span> </span><a href="#local-6989586621684814223"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814224"><span class="hs-identifier hs-var">w1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814222"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814225"><span class="hs-identifier hs-var">w2</span></a><span class="hs-special">)</span><span>
</span><a name="line-456"></a><span class="hs-identifier">wordOp2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-comment">-- Could find LitLit</span><span>
</span><a name="line-457"></a><span>
</span><a name="line-458"></a><span class="hs-identifier">wordOpC2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621684814057"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621684814058"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814057"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814058"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-460"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-461"></a><a name="wordOpC2"><a href="PrelRules.html#wordOpC2"><span class="hs-identifier">wordOpC2</span></a></a><span> </span><a name="local-6989586621684814226"><a href="#local-6989586621684814226"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684814227"><a href="#local-6989586621684814227"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a><span> </span><a name="local-6989586621684814228"><a href="#local-6989586621684814228"><span class="hs-identifier">w1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a><span> </span><a name="local-6989586621684814229"><a href="#local-6989586621684814229"><span class="hs-identifier">w2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-462"></a><span>  </span><a href="PrelRules.html#wordCResult"><span class="hs-identifier hs-var">wordCResult</span></a><span> </span><a href="#local-6989586621684814227"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814228"><span class="hs-identifier hs-var">w1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814226"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814229"><span class="hs-identifier hs-var">w2</span></a><span class="hs-special">)</span><span>
</span><a name="line-463"></a><span class="hs-identifier">wordOpC2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-comment">-- Could find LitLit</span><span>
</span><a name="line-464"></a><span>
</span><a name="line-465"></a><span class="hs-identifier">shiftRule</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-466"></a><span class="hs-comment">-- Shifts take an Int; hence third arg of op is Int</span><span>
</span><a name="line-467"></a><span class="hs-comment">-- Used for shift primops</span><span>
</span><a name="line-468"></a><span class="hs-comment">--    ISllOp, ISraOp, ISrlOp :: Word# -&gt; Int# -&gt; Word#</span><span>
</span><a name="line-469"></a><span class="hs-comment">--    SllOp, SrlOp           :: Word# -&gt; Int# -&gt; Word#</span><span>
</span><a name="line-470"></a><span class="hs-comment">-- See Note [Guarding against silly shifts]</span><span>
</span><a name="line-471"></a><a name="shiftRule"><a href="PrelRules.html#shiftRule"><span class="hs-identifier">shiftRule</span></a></a><span> </span><a name="local-6989586621684814230"><a href="#local-6989586621684814230"><span class="hs-identifier">shift_op</span></a></a><span>
</span><a name="line-472"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621684814231"><a href="#local-6989586621684814231"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-473"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814232"><a href="#local-6989586621684814232"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814233"><a href="#local-6989586621684814233"><span class="hs-identifier">shift_len</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-474"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684814232"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-475"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814233"><span class="hs-identifier hs-var">shift_len</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-476"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814232"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span>           </span><span class="hs-comment">-- Do the shift at type Integer, but shift length is Int</span><span>
</span><a name="line-479"></a><span>           </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a name="local-6989586621684814234"><a href="#local-6989586621684814234"><span class="hs-identifier">nt</span></a></a><span> </span><a name="local-6989586621684814235"><a href="#local-6989586621684814235"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814236"><a href="#local-6989586621684814236"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-480"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621684814233"><span class="hs-identifier hs-var">shift_len</span></a><span>
</span><a name="line-481"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814233"><span class="hs-identifier hs-var">shift_len</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="PrelRules.html#wordSizeInBits"><span class="hs-identifier hs-var">wordSizeInBits</span></a><span> </span><a href="#local-6989586621684814231"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-482"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684814237"><a href="#local-6989586621684814237"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814230"><span class="hs-identifier hs-var">shift_op</span></a><span> </span><a href="#local-6989586621684814231"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-483"></a><span>                    </span><a name="local-6989586621684814238"><a href="#local-6989586621684814238"><span class="hs-identifier">y</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814235"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814237"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814233"><span class="hs-identifier hs-var">shift_len</span></a><span>
</span><a name="line-484"></a><span>                </span><span class="hs-keyword">in</span><span>  </span><a href="PrelRules.html#liftMaybe"><span class="hs-identifier hs-var">liftMaybe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitNumberWrap"><span class="hs-identifier hs-var">mkLitNumberWrap</span></a><span> </span><a href="#local-6989586621684814231"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814234"><span class="hs-identifier hs-var">nt</span></a><span> </span><a href="#local-6989586621684814238"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684814236"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-485"></a><span>
</span><a name="line-486"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mzero</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span class="hs-identifier">wordSizeInBits</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-489"></a><a name="wordSizeInBits"><a href="PrelRules.html#wordSizeInBits"><span class="hs-identifier">wordSizeInBits</span></a></a><span> </span><a name="local-6989586621684814239"><a href="#local-6989586621684814239"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">platformWordSize</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#targetPlatform"><span class="hs-identifier hs-var">targetPlatform</span></a><span> </span><a href="#local-6989586621684814239"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-492"></a><span class="hs-identifier">floatOp2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span class="hs-special">)</span><span>
</span><a name="line-493"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span>
</span><a name="line-494"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-495"></a><a name="floatOp2"><a href="PrelRules.html#floatOp2"><span class="hs-identifier">floatOp2</span></a></a><span> </span><a name="local-6989586621684814240"><a href="#local-6989586621684814240"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684814241"><a href="#local-6989586621684814241"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span> </span><a name="local-6989586621684814242"><a href="#local-6989586621684814242"><span class="hs-identifier">f1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span> </span><a name="local-6989586621684814243"><a href="#local-6989586621684814243"><span class="hs-identifier">f2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-496"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="PrelRules.html#mkFloatVal"><span class="hs-identifier hs-var">mkFloatVal</span></a><span> </span><a href="#local-6989586621684814241"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814242"><span class="hs-identifier hs-var">f1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814240"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814243"><span class="hs-identifier hs-var">f2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-497"></a><span class="hs-identifier">floatOp2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-498"></a><span>
</span><a name="line-499"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-500"></a><span class="hs-identifier">doubleOp2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span class="hs-special">)</span><span>
</span><a name="line-501"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span>
</span><a name="line-502"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-503"></a><a name="doubleOp2"><a href="PrelRules.html#doubleOp2"><span class="hs-identifier">doubleOp2</span></a></a><span> </span><a name="local-6989586621684814244"><a href="#local-6989586621684814244"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684814245"><a href="#local-6989586621684814245"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><a name="local-6989586621684814246"><a href="#local-6989586621684814246"><span class="hs-identifier">f1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><a name="local-6989586621684814247"><a href="#local-6989586621684814247"><span class="hs-identifier">f2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-504"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="PrelRules.html#mkDoubleVal"><span class="hs-identifier hs-var">mkDoubleVal</span></a><span> </span><a href="#local-6989586621684814245"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814246"><span class="hs-identifier hs-var">f1</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814244"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814247"><span class="hs-identifier hs-var">f2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-505"></a><span class="hs-identifier">doubleOp2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-508"></a><span class="hs-comment">{- Note [The litEq rule: converting equality to case]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This stuff turns
     n ==# 3#
into
     case n of
       3# -&gt; True
       m  -&gt; False

This is a Good Thing, because it allows case-of case things
to happen, and case-default absorption to happen.  For
example:

     if (n ==# 3#) || (n ==# 4#) then e1 else e2
will transform to
     case n of
       3# -&gt; e1
       4# -&gt; e1
       m  -&gt; e2
(modulo the usual precautions to avoid duplicating e1)
-}</span><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span class="hs-identifier">litEq</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>  </span><span class="hs-comment">-- True &lt;=&gt; equality, False &lt;=&gt; inequality</span><span>
</span><a name="line-531"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-532"></a><a name="litEq"><a href="PrelRules.html#litEq"><span class="hs-identifier">litEq</span></a></a><span> </span><a name="local-6989586621684814248"><a href="#local-6989586621684814248"><span class="hs-identifier">is_eq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">msum</span><span>
</span><a name="line-533"></a><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814255"><a href="#local-6989586621684814255"><span class="hs-identifier">lit</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814256"><a href="#local-6989586621684814256"><span class="hs-identifier">expr</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-534"></a><span>       </span><a name="local-6989586621684814257"><a href="#local-6989586621684814257"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-535"></a><span>       </span><a href="#local-6989586621684814249"><span class="hs-identifier hs-var">do_lit_eq</span></a><span> </span><a href="#local-6989586621684814257"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814255"><span class="hs-identifier hs-var">lit</span></a><span> </span><a href="#local-6989586621684814256"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-536"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814258"><a href="#local-6989586621684814258"><span class="hs-identifier">expr</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814259"><a href="#local-6989586621684814259"><span class="hs-identifier">lit</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-537"></a><span>       </span><a name="local-6989586621684814260"><a href="#local-6989586621684814260"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-538"></a><span>       </span><a href="#local-6989586621684814249"><span class="hs-identifier hs-var">do_lit_eq</span></a><span> </span><a href="#local-6989586621684814260"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814259"><span class="hs-identifier hs-var">lit</span></a><span> </span><a href="#local-6989586621684814258"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-539"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-540"></a><span>    </span><a name="local-6989586621684814249"><a href="#local-6989586621684814249"><span class="hs-identifier">do_lit_eq</span></a></a><span> </span><a name="local-6989586621684814250"><a href="#local-6989586621684814250"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814251"><a href="#local-6989586621684814251"><span class="hs-identifier">lit</span></a></a><span> </span><a name="local-6989586621684814252"><a href="#local-6989586621684814252"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-541"></a><span>      </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Literal.html#litIsLifted"><span class="hs-identifier hs-var">litIsLifted</span></a><span> </span><a href="#local-6989586621684814251"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-542"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-6989586621684814252"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#literalType"><span class="hs-identifier hs-var">literalType</span></a><span> </span><a href="#local-6989586621684814251"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span> </span><a href="TysPrim.html#intPrimTy"><span class="hs-identifier hs-var">intPrimTy</span></a><span>
</span><a name="line-543"></a><span>                    </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a><span class="hs-special">,</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814254"><span class="hs-identifier hs-var">val_if_neq</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-544"></a><span>                     </span><span class="hs-special">(</span><a href="CoreSyn.html#LitAlt"><span class="hs-identifier hs-var">LitAlt</span></a><span> </span><a href="#local-6989586621684814251"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814253"><span class="hs-identifier hs-var">val_if_eq</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-545"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-546"></a><span>        </span><a name="local-6989586621684814253"><a href="#local-6989586621684814253"><span class="hs-identifier">val_if_eq</span></a></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814248"><span class="hs-identifier hs-var">is_eq</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#trueValInt"><span class="hs-identifier hs-var">trueValInt</span></a><span>  </span><a href="#local-6989586621684814250"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-547"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#falseValInt"><span class="hs-identifier hs-var">falseValInt</span></a><span> </span><a href="#local-6989586621684814250"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-548"></a><span>        </span><a name="local-6989586621684814254"><a href="#local-6989586621684814254"><span class="hs-identifier">val_if_neq</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814248"><span class="hs-identifier hs-var">is_eq</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#falseValInt"><span class="hs-identifier hs-var">falseValInt</span></a><span> </span><a href="#local-6989586621684814250"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-549"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#trueValInt"><span class="hs-identifier hs-var">trueValInt</span></a><span>  </span><a href="#local-6989586621684814250"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><span>
</span><a name="line-552"></a><span class="hs-comment">-- | Check if there is comparison with minBound or maxBound, that is</span><span>
</span><a name="line-553"></a><span class="hs-comment">-- always true or false. For instance, an Int cannot be smaller than its</span><span>
</span><a name="line-554"></a><span class="hs-comment">-- minBound, so we can replace such comparison with False.</span><span>
</span><a name="line-555"></a><span class="hs-identifier">boundsCmp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-556"></a><a name="boundsCmp"><a href="PrelRules.html#boundsCmp"><span class="hs-identifier">boundsCmp</span></a></a><span> </span><a name="local-6989586621684814261"><a href="#local-6989586621684814261"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-557"></a><span>  </span><a name="local-6989586621684814262"><a href="#local-6989586621684814262"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-558"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621684814263"><a href="#local-6989586621684814263"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814264"><a href="#local-6989586621684814264"><span class="hs-identifier">b</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-559"></a><span>  </span><a href="PrelRules.html#liftMaybe"><span class="hs-identifier hs-var">liftMaybe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#mkRuleFn"><span class="hs-identifier hs-var">mkRuleFn</span></a><span> </span><a href="#local-6989586621684814262"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814261"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621684814263"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621684814264"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-560"></a><span>
</span><a name="line-561"></a><span class="hs-keyword">data</span><span> </span><a name="Comparison"><a href="PrelRules.html#Comparison"><span class="hs-identifier">Comparison</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Gt"><a href="PrelRules.html#Gt"><span class="hs-identifier">Gt</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Ge"><a href="PrelRules.html#Ge"><span class="hs-identifier">Ge</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Lt"><a href="PrelRules.html#Lt"><span class="hs-identifier">Lt</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Le"><a href="PrelRules.html#Le"><span class="hs-identifier">Le</span></a></a><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span class="hs-identifier">mkRuleFn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#Comparison"><span class="hs-identifier hs-type">Comparison</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-564"></a><a name="mkRuleFn"><a href="PrelRules.html#mkRuleFn"><span class="hs-identifier">mkRuleFn</span></a></a><span> </span><a name="local-6989586621684814265"><a href="#local-6989586621684814265"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="PrelRules.html#Gt"><span class="hs-identifier hs-var">Gt</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814266"><a href="#local-6989586621684814266"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="PrelRules.html#isMinBound"><span class="hs-identifier hs-var">isMinBound</span></a><span> </span><a href="#local-6989586621684814265"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814266"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#falseValInt"><span class="hs-identifier hs-var">falseValInt</span></a><span> </span><a href="#local-6989586621684814265"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-565"></a><span class="hs-identifier">mkRuleFn</span><span> </span><a name="local-6989586621684814267"><a href="#local-6989586621684814267"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="PrelRules.html#Le"><span class="hs-identifier hs-var">Le</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814268"><a href="#local-6989586621684814268"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="PrelRules.html#isMinBound"><span class="hs-identifier hs-var">isMinBound</span></a><span> </span><a href="#local-6989586621684814267"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814268"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#trueValInt"><span class="hs-identifier hs-var">trueValInt</span></a><span>  </span><a href="#local-6989586621684814267"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-566"></a><span class="hs-identifier">mkRuleFn</span><span> </span><a name="local-6989586621684814269"><a href="#local-6989586621684814269"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="PrelRules.html#Ge"><span class="hs-identifier hs-var">Ge</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814270"><a href="#local-6989586621684814270"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="PrelRules.html#isMinBound"><span class="hs-identifier hs-var">isMinBound</span></a><span> </span><a href="#local-6989586621684814269"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814270"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#trueValInt"><span class="hs-identifier hs-var">trueValInt</span></a><span>  </span><a href="#local-6989586621684814269"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-567"></a><span class="hs-identifier">mkRuleFn</span><span> </span><a name="local-6989586621684814271"><a href="#local-6989586621684814271"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="PrelRules.html#Lt"><span class="hs-identifier hs-var">Lt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814272"><a href="#local-6989586621684814272"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="PrelRules.html#isMinBound"><span class="hs-identifier hs-var">isMinBound</span></a><span> </span><a href="#local-6989586621684814271"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814272"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#falseValInt"><span class="hs-identifier hs-var">falseValInt</span></a><span> </span><a href="#local-6989586621684814271"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-568"></a><span class="hs-identifier">mkRuleFn</span><span> </span><a name="local-6989586621684814273"><a href="#local-6989586621684814273"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="PrelRules.html#Ge"><span class="hs-identifier hs-var">Ge</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814274"><a href="#local-6989586621684814274"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="PrelRules.html#isMaxBound"><span class="hs-identifier hs-var">isMaxBound</span></a><span> </span><a href="#local-6989586621684814273"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814274"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#trueValInt"><span class="hs-identifier hs-var">trueValInt</span></a><span>  </span><a href="#local-6989586621684814273"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-569"></a><span class="hs-identifier">mkRuleFn</span><span> </span><a name="local-6989586621684814275"><a href="#local-6989586621684814275"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="PrelRules.html#Lt"><span class="hs-identifier hs-var">Lt</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814276"><a href="#local-6989586621684814276"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="PrelRules.html#isMaxBound"><span class="hs-identifier hs-var">isMaxBound</span></a><span> </span><a href="#local-6989586621684814275"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814276"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#falseValInt"><span class="hs-identifier hs-var">falseValInt</span></a><span> </span><a href="#local-6989586621684814275"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-570"></a><span class="hs-identifier">mkRuleFn</span><span> </span><a name="local-6989586621684814277"><a href="#local-6989586621684814277"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="PrelRules.html#Gt"><span class="hs-identifier hs-var">Gt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814278"><a href="#local-6989586621684814278"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="PrelRules.html#isMaxBound"><span class="hs-identifier hs-var">isMaxBound</span></a><span> </span><a href="#local-6989586621684814277"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814278"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#falseValInt"><span class="hs-identifier hs-var">falseValInt</span></a><span> </span><a href="#local-6989586621684814277"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-571"></a><span class="hs-identifier">mkRuleFn</span><span> </span><a name="local-6989586621684814279"><a href="#local-6989586621684814279"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="PrelRules.html#Le"><span class="hs-identifier hs-var">Le</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814280"><a href="#local-6989586621684814280"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="PrelRules.html#isMaxBound"><span class="hs-identifier hs-var">isMaxBound</span></a><span> </span><a href="#local-6989586621684814279"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814280"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#trueValInt"><span class="hs-identifier hs-var">trueValInt</span></a><span>  </span><a href="#local-6989586621684814279"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-572"></a><span class="hs-identifier">mkRuleFn</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>                                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-573"></a><span>
</span><a name="line-574"></a><span class="hs-identifier">isMinBound</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-575"></a><a name="isMinBound"><a href="PrelRules.html#isMinBound"><span class="hs-identifier">isMinBound</span></a></a><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-special">(</span><a href="Literal.html#LitChar"><span class="hs-identifier hs-var">LitChar</span></a><span> </span><a name="local-6989586621684814281"><a href="#local-6989586621684814281"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814281"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">minBound</span><span>
</span><a name="line-576"></a><span class="hs-identifier">isMinBound</span><span> </span><a name="local-6989586621684814282"><a href="#local-6989586621684814282"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a name="local-6989586621684814283"><a href="#local-6989586621684814283"><span class="hs-identifier">nt</span></a></a><span> </span><a name="local-6989586621684814284"><a href="#local-6989586621684814284"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684814283"><span class="hs-identifier hs-var">nt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-577"></a><span>   </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814284"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="DynFlags.html#tARGET_MIN_INT"><span class="hs-identifier hs-var">tARGET_MIN_INT</span></a><span> </span><a href="#local-6989586621684814282"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-578"></a><span>   </span><a href="Literal.html#LitNumInt64"><span class="hs-identifier hs-var">LitNumInt64</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814284"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minBound</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int64</span><span class="hs-special">)</span><span>
</span><a name="line-579"></a><span>   </span><a href="Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814284"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-580"></a><span>   </span><a href="Literal.html#LitNumWord64"><span class="hs-identifier hs-var">LitNumWord64</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814284"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-581"></a><span>   </span><a href="Literal.html#LitNumNatural"><span class="hs-identifier hs-var">LitNumNatural</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814284"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-582"></a><span>   </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-583"></a><span class="hs-identifier">isMinBound</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-584"></a><span>
</span><a name="line-585"></a><span class="hs-identifier">isMaxBound</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-586"></a><a name="isMaxBound"><a href="PrelRules.html#isMaxBound"><span class="hs-identifier">isMaxBound</span></a></a><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-special">(</span><a href="Literal.html#LitChar"><span class="hs-identifier hs-var">LitChar</span></a><span> </span><a name="local-6989586621684814285"><a href="#local-6989586621684814285"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814285"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">maxBound</span><span>
</span><a name="line-587"></a><span class="hs-identifier">isMaxBound</span><span> </span><a name="local-6989586621684814286"><a href="#local-6989586621684814286"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a name="local-6989586621684814287"><a href="#local-6989586621684814287"><span class="hs-identifier">nt</span></a></a><span> </span><a name="local-6989586621684814288"><a href="#local-6989586621684814288"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684814287"><span class="hs-identifier hs-var">nt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-588"></a><span>   </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814288"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="DynFlags.html#tARGET_MAX_INT"><span class="hs-identifier hs-var">tARGET_MAX_INT</span></a><span> </span><a href="#local-6989586621684814286"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-589"></a><span>   </span><a href="Literal.html#LitNumInt64"><span class="hs-identifier hs-var">LitNumInt64</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814288"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int64</span><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>   </span><a href="Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814288"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="DynFlags.html#tARGET_MAX_WORD"><span class="hs-identifier hs-var">tARGET_MAX_WORD</span></a><span> </span><a href="#local-6989586621684814286"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-591"></a><span>   </span><a href="Literal.html#LitNumWord64"><span class="hs-identifier hs-var">LitNumWord64</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814288"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-592"></a><span>   </span><a href="Literal.html#LitNumNatural"><span class="hs-identifier hs-var">LitNumNatural</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-593"></a><span>   </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-594"></a><span class="hs-identifier">isMaxBound</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-595"></a><span>
</span><a name="line-596"></a><span class="hs-comment">-- | Create an Int literal expression while ensuring the given Integer is in the</span><span>
</span><a name="line-597"></a><span class="hs-comment">-- target Int range</span><span>
</span><a name="line-598"></a><span class="hs-identifier">intResult</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-599"></a><a name="intResult"><a href="PrelRules.html#intResult"><span class="hs-identifier">intResult</span></a></a><span> </span><a name="local-6989586621684814289"><a href="#local-6989586621684814289"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814290"><a href="#local-6989586621684814290"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intResult%27"><span class="hs-identifier hs-var">intResult'</span></a><span> </span><a href="#local-6989586621684814289"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814290"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-600"></a><span>
</span><a name="line-601"></a><span class="hs-identifier">intResult'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-602"></a><a name="intResult%27"><a href="PrelRules.html#intResult%27"><span class="hs-identifier">intResult'</span></a></a><span> </span><a name="local-6989586621684814291"><a href="#local-6989586621684814291"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814292"><a href="#local-6989586621684814292"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitIntWrap"><span class="hs-identifier hs-var">mkLitIntWrap</span></a><span> </span><a href="#local-6989586621684814291"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814292"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-603"></a><span>
</span><a name="line-604"></a><span class="hs-comment">-- | Create an unboxed pair of an Int literal expression, ensuring the given</span><span>
</span><a name="line-605"></a><span class="hs-comment">-- Integer is in the target Int range and the corresponding overflow flag</span><span>
</span><a name="line-606"></a><span class="hs-comment">-- (@0#@/@1#@) if it wasn't.</span><span>
</span><a name="line-607"></a><span class="hs-identifier">intCResult</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-608"></a><a name="intCResult"><a href="PrelRules.html#intCResult"><span class="hs-identifier">intCResult</span></a></a><span> </span><a name="local-6989586621684814293"><a href="#local-6989586621684814293"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814294"><a href="#local-6989586621684814294"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814295"><span class="hs-identifier hs-var">mkPair</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a href="#local-6989586621684814296"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a href="#local-6989586621684814298"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-609"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-610"></a><span>    </span><a name="local-6989586621684814295"><a href="#local-6989586621684814295"><span class="hs-identifier">mkPair</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier hs-var">mkCoreUbxTup</span></a><span> </span><span class="hs-special">[</span><a href="TysPrim.html#intPrimTy"><span class="hs-identifier hs-var">intPrimTy</span></a><span class="hs-special">,</span><span> </span><a href="TysPrim.html#intPrimTy"><span class="hs-identifier hs-var">intPrimTy</span></a><span class="hs-special">]</span><span>
</span><a name="line-611"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684814296"><a href="#local-6989586621684814296"><span class="hs-identifier">lit</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814297"><a href="#local-6989586621684814297"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitIntWrapC"><span class="hs-identifier hs-var">mkLitIntWrapC</span></a><span> </span><a href="#local-6989586621684814293"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814294"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-612"></a><span>    </span><a name="local-6989586621684814298"><a href="#local-6989586621684814298"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684814297"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PrelRules.html#onei"><span class="hs-identifier hs-var">onei</span></a><span> </span><a href="#local-6989586621684814293"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><a href="#local-6989586621684814293"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-613"></a><span>
</span><a name="line-614"></a><span class="hs-comment">-- | Create a Word literal expression while ensuring the given Integer is in the</span><span>
</span><a name="line-615"></a><span class="hs-comment">-- target Word range</span><span>
</span><a name="line-616"></a><span class="hs-identifier">wordResult</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-617"></a><a name="wordResult"><a href="PrelRules.html#wordResult"><span class="hs-identifier">wordResult</span></a></a><span> </span><a name="local-6989586621684814299"><a href="#local-6989586621684814299"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814300"><a href="#local-6989586621684814300"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordResult%27"><span class="hs-identifier hs-var">wordResult'</span></a><span> </span><a href="#local-6989586621684814299"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814300"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-618"></a><span>
</span><a name="line-619"></a><span class="hs-identifier">wordResult'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-620"></a><a name="wordResult%27"><a href="PrelRules.html#wordResult%27"><span class="hs-identifier">wordResult'</span></a></a><span> </span><a name="local-6989586621684814301"><a href="#local-6989586621684814301"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814302"><a href="#local-6989586621684814302"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitWordWrap"><span class="hs-identifier hs-var">mkLitWordWrap</span></a><span> </span><a href="#local-6989586621684814301"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814302"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">)</span><span>
</span><a name="line-621"></a><span>
</span><a name="line-622"></a><span class="hs-comment">-- | Create an unboxed pair of a Word literal expression, ensuring the given</span><span>
</span><a name="line-623"></a><span class="hs-comment">-- Integer is in the target Word range and the corresponding carry flag</span><span>
</span><a name="line-624"></a><span class="hs-comment">-- (@0#@/@1#@) if it wasn't.</span><span>
</span><a name="line-625"></a><span class="hs-identifier">wordCResult</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-626"></a><a name="wordCResult"><a href="PrelRules.html#wordCResult"><span class="hs-identifier">wordCResult</span></a></a><span> </span><a name="local-6989586621684814303"><a href="#local-6989586621684814303"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814304"><a href="#local-6989586621684814304"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814305"><span class="hs-identifier hs-var">mkPair</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a href="#local-6989586621684814306"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a href="#local-6989586621684814308"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-627"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-628"></a><span>    </span><a name="local-6989586621684814305"><a href="#local-6989586621684814305"><span class="hs-identifier">mkPair</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier hs-var">mkCoreUbxTup</span></a><span> </span><span class="hs-special">[</span><a href="TysPrim.html#wordPrimTy"><span class="hs-identifier hs-var">wordPrimTy</span></a><span class="hs-special">,</span><span> </span><a href="TysPrim.html#intPrimTy"><span class="hs-identifier hs-var">intPrimTy</span></a><span class="hs-special">]</span><span>
</span><a name="line-629"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684814306"><a href="#local-6989586621684814306"><span class="hs-identifier">lit</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814307"><a href="#local-6989586621684814307"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Literal.html#mkLitWordWrapC"><span class="hs-identifier hs-var">mkLitWordWrapC</span></a><span> </span><a href="#local-6989586621684814303"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814304"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-630"></a><span>    </span><a name="local-6989586621684814308"><a href="#local-6989586621684814308"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684814307"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PrelRules.html#onei"><span class="hs-identifier hs-var">onei</span></a><span> </span><a href="#local-6989586621684814303"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><a href="#local-6989586621684814303"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span class="hs-identifier">inversePrimOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-633"></a><a name="inversePrimOp"><a href="PrelRules.html#inversePrimOp"><span class="hs-identifier">inversePrimOp</span></a></a><span> </span><a name="local-6989586621684814309"><a href="#local-6989586621684814309"><span class="hs-identifier">primop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-634"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814310"><a href="#local-6989586621684814310"><span class="hs-identifier">primop_id</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814311"><a href="#local-6989586621684814311"><span class="hs-identifier">e</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-635"></a><span>  </span><a href="PrelRules.html#matchPrimOpId"><span class="hs-identifier hs-var">matchPrimOpId</span></a><span> </span><a href="#local-6989586621684814309"><span class="hs-identifier hs-var">primop</span></a><span> </span><a href="#local-6989586621684814310"><span class="hs-identifier hs-var">primop_id</span></a><span>
</span><a name="line-636"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814311"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-637"></a><span>
</span><a name="line-638"></a><span class="hs-identifier">subsumesPrimOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-639"></a><a name="local-6989586621684814312"><a href="#local-6989586621684814312"><span class="hs-identifier">this</span></a></a><span> </span><span class="hs-special">`</span><a name="subsumesPrimOp"><a href="PrelRules.html#subsumesPrimOp"><span class="hs-identifier">subsumesPrimOp</span></a></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814313"><a href="#local-6989586621684814313"><span class="hs-identifier">that</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-640"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814314"><a href="#local-6989586621684814314"><span class="hs-identifier">primop_id</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814315"><a href="#local-6989586621684814315"><span class="hs-identifier">e</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-641"></a><span>  </span><a href="PrelRules.html#matchPrimOpId"><span class="hs-identifier hs-var">matchPrimOpId</span></a><span> </span><a href="#local-6989586621684814313"><span class="hs-identifier hs-var">that</span></a><span> </span><a href="#local-6989586621684814314"><span class="hs-identifier hs-var">primop_id</span></a><span>
</span><a name="line-642"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkPrimOpId"><span class="hs-identifier hs-var">mkPrimOpId</span></a><span> </span><a href="#local-6989586621684814312"><span class="hs-identifier hs-var">this</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814315"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-643"></a><span>
</span><a name="line-644"></a><span class="hs-identifier">subsumedByPrimOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-645"></a><a name="subsumedByPrimOp"><a href="PrelRules.html#subsumedByPrimOp"><span class="hs-identifier">subsumedByPrimOp</span></a></a><span> </span><a name="local-6989586621684814316"><a href="#local-6989586621684814316"><span class="hs-identifier">primop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-646"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621684814317"><a href="#local-6989586621684814317"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814318"><a href="#local-6989586621684814318"><span class="hs-identifier">primop_id</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-647"></a><span>  </span><a href="PrelRules.html#matchPrimOpId"><span class="hs-identifier hs-var">matchPrimOpId</span></a><span> </span><a href="#local-6989586621684814316"><span class="hs-identifier hs-var">primop</span></a><span> </span><a href="#local-6989586621684814318"><span class="hs-identifier hs-var">primop_id</span></a><span>
</span><a name="line-648"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814317"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span class="hs-identifier">idempotent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-651"></a><a name="idempotent"><a href="PrelRules.html#idempotent"><span class="hs-identifier">idempotent</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814319"><a href="#local-6989586621684814319"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814320"><a href="#local-6989586621684814320"><span class="hs-identifier">e2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-652"></a><span>                </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span> </span><a href="#local-6989586621684814319"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-6989586621684814320"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-653"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814319"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-654"></a><span>
</span><a name="line-655"></a><span class="hs-comment">{-
Note [Guarding against silly shifts]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this code:

  import Data.Bits( (.|.), shiftL )
  chunkToBitmap :: [Bool] -&gt; Word32
  chunkToBitmap chunk = foldr (.|.) 0 [ 1 `shiftL` n | (True,n) &lt;- zip chunk [0..] ]

This optimises to:
Shift.$wgo = \ (w_sCS :: GHC.Prim.Int#) (w1_sCT :: [GHC.Types.Bool]) -&gt;
    case w1_sCT of _ {
      [] -&gt; 0##;
      : x_aAW xs_aAX -&gt;
        case x_aAW of _ {
          GHC.Types.False -&gt;
            case w_sCS of wild2_Xh {
              __DEFAULT -&gt; Shift.$wgo (GHC.Prim.+# wild2_Xh 1) xs_aAX;
              9223372036854775807 -&gt; 0## };
          GHC.Types.True -&gt;
            case GHC.Prim.&gt;=# w_sCS 64 of _ {
              GHC.Types.False -&gt;
                case w_sCS of wild3_Xh {
                  __DEFAULT -&gt;
                    case Shift.$wgo (GHC.Prim.+# wild3_Xh 1) xs_aAX of ww_sCW { __DEFAULT -&gt;
                      GHC.Prim.or# (GHC.Prim.narrow32Word#
                                      (GHC.Prim.uncheckedShiftL# 1## wild3_Xh))
                                   ww_sCW
                     };
                  9223372036854775807 -&gt;
                    GHC.Prim.narrow32Word#
!!!!--&gt;                  (GHC.Prim.uncheckedShiftL# 1## 9223372036854775807)
                };
              GHC.Types.True -&gt;
                case w_sCS of wild3_Xh {
                  __DEFAULT -&gt; Shift.$wgo (GHC.Prim.+# wild3_Xh 1) xs_aAX;
                  9223372036854775807 -&gt; 0##
                } } } }

Note the massive shift on line &quot;!!!!&quot;.  It can't happen, because we've checked
that w &lt; 64, but the optimiser didn't spot that. We DO NOT want to constant-fold this!
Moreover, if the programmer writes (n `uncheckedShiftL` 9223372036854775807), we
can't constant fold it, but if it gets to the assember we get
     Error: operand type mismatch for `shl'

So the best thing to do is to rewrite the shift with a call to error,
when the second arg is stupid.

There are two cases:

- Shifting fixed-width things: the primops ISll, Sll, etc
  These are handled by shiftRule.

  We are happy to shift by any amount up to wordSize but no more.

- Shifting Integers: the function shiftLInteger, shiftRInteger
  from the 'integer' library.   These are handled by rule_shift_op,
  and match_Integer_shift_op.

  Here we could in principle shift by any amount, but we arbitary
  limit the shift to 4 bits; in particualr we do not want shift by a
  huge amount, which can happen in code like that above.

The two cases are more different in their code paths that is comfortable,
but that is only a historical accident.


************************************************************************
*                                                                      *
\subsection{Vaguely generic functions}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-728"></a><span>
</span><a name="line-729"></a><span class="hs-identifier">mkBasicRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span>
</span><a name="line-730"></a><span class="hs-comment">-- Gives the Rule the same name as the primop itself</span><span>
</span><a name="line-731"></a><a name="mkBasicRule"><a href="PrelRules.html#mkBasicRule"><span class="hs-identifier">mkBasicRule</span></a></a><span> </span><a name="local-6989586621684814321"><a href="#local-6989586621684814321"><span class="hs-identifier">op_name</span></a></a><span> </span><a name="local-6989586621684814322"><a href="#local-6989586621684814322"><span class="hs-identifier">n_args</span></a></a><span> </span><a name="local-6989586621684814323"><a href="#local-6989586621684814323"><span class="hs-identifier">rm</span></a></a><span>
</span><a name="line-732"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">occNameFS</span><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621684814321"><span class="hs-identifier hs-var">op_name</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-733"></a><span>                  </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814321"><span class="hs-identifier hs-var">op_name</span></a><span class="hs-special">,</span><span>
</span><a name="line-734"></a><span>                  </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814322"><span class="hs-identifier hs-var">n_args</span></a><span class="hs-special">,</span><span>
</span><a name="line-735"></a><span>                  </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621684814324"><a href="#local-6989586621684814324"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814325"><a href="#local-6989586621684814325"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">runRuleM</span><span> </span><a href="#local-6989586621684814323"><span class="hs-identifier hs-var">rm</span></a><span> </span><a href="#local-6989586621684814324"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814325"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-736"></a><span>
</span><a name="line-737"></a><span class="hs-keyword">newtype</span><span> </span><a name="RuleM"><a href="PrelRules.html#RuleM"><span class="hs-identifier">RuleM</span></a></a><span> </span><a name="local-6989586621684814038"><a href="#local-6989586621684814038"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="RuleM"><a href="PrelRules.html#RuleM"><span class="hs-identifier">RuleM</span></a></a><span>
</span><a name="line-738"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="runRuleM"><a href="PrelRules.html#runRuleM"><span class="hs-identifier">runRuleM</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#InScopeEnv"><span class="hs-identifier hs-type">InScopeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621684814038"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-739"></a><span>
</span><a name="line-740"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-741"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-742"></a><span>
</span><a name="line-743"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-744"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621684814051"><a href="#local-6989586621684814051"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684814051"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-745"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-746"></a><span>
</span><a name="line-747"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-748"></a><span>  </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><a name="local-6989586621684814045"><a href="#local-6989586621684814045"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621684814046"><a href="#local-6989586621684814046"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814047"><a href="#local-6989586621684814047"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814048"><a href="#local-6989586621684814048"><span class="hs-identifier">iu</span></a></a><span> </span><a name="local-6989586621684814049"><a href="#local-6989586621684814049"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684814045"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684814047"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814048"><span class="hs-identifier hs-var">iu</span></a><span> </span><a href="#local-6989586621684814049"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-749"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-750"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814050"><a href="#local-6989586621684814050"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">runRuleM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814046"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621684814050"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814047"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814048"><span class="hs-identifier hs-var">iu</span></a><span> </span><a href="#local-6989586621684814049"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-751"></a><span class="hs-cpp">#if !MIN_VERSION_base(4,13,0)
</span><span>  </span><a name="local-3458764513820541098"><span class="hs-identifier">fail</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MonadFail.fail</span><span>
</span><a name="line-753"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-755"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadFail.MonadFail</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-756"></a><span>    </span><a name="local-3458764513820541104"><span class="hs-identifier">fail</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mzero</span><span>
</span><a name="line-757"></a><span>
</span><a name="line-758"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Alternative</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-759"></a><span>  </span><a name="local-8214565720323790439"><span class="hs-identifier">empty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-760"></a><span>  </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><a name="local-6989586621684814040"><a href="#local-6989586621684814040"><span class="hs-identifier">f1</span></a></a><span> </span><a name="local-8214565720323790438"><span class="hs-operator">&lt;|&gt;</span></a><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><a name="local-6989586621684814041"><a href="#local-6989586621684814041"><span class="hs-identifier">f2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814042"><a href="#local-6989586621684814042"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814043"><a href="#local-6989586621684814043"><span class="hs-identifier">iu</span></a></a><span> </span><a name="local-6989586621684814044"><a href="#local-6989586621684814044"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-761"></a><span>    </span><a href="#local-6989586621684814040"><span class="hs-identifier hs-var">f1</span></a><span> </span><a href="#local-6989586621684814042"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814043"><span class="hs-identifier hs-var">iu</span></a><span> </span><a href="#local-6989586621684814044"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-operator hs-var">&lt;|&gt;</span><span> </span><a href="#local-6989586621684814041"><span class="hs-identifier hs-var">f2</span></a><span> </span><a href="#local-6989586621684814042"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814043"><span class="hs-identifier hs-var">iu</span></a><span> </span><a href="#local-6989586621684814044"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-762"></a><span>
</span><a name="line-763"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadPlus</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span>
</span><a name="line-764"></a><span>
</span><a name="line-765"></a><span class="hs-keyword">instance</span><span> </span><a href="DynFlags.html#HasDynFlags"><span class="hs-identifier hs-type">HasDynFlags</span></a><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-766"></a><span>    </span><a name="local-8214565720325324395"><a href="DynFlags.html#getDynFlags"><span class="hs-identifier">getDynFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814039"><a href="#local-6989586621684814039"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684814039"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-767"></a><span>
</span><a name="line-768"></a><span class="hs-identifier">liftMaybe</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621684814056"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="#local-6989586621684814056"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-769"></a><a name="liftMaybe"><a href="PrelRules.html#liftMaybe"><span class="hs-identifier">liftMaybe</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mzero</span><span>
</span><a name="line-770"></a><span class="hs-identifier">liftMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814326"><a href="#local-6989586621684814326"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814326"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-771"></a><span>
</span><a name="line-772"></a><span class="hs-identifier">liftLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-773"></a><a name="liftLit"><a href="PrelRules.html#liftLit"><span class="hs-identifier">liftLit</span></a></a><span> </span><a name="local-6989586621684814327"><a href="#local-6989586621684814327"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#liftLitDynFlags"><span class="hs-identifier hs-var">liftLitDynFlags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621684814327"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-774"></a><span>
</span><a name="line-775"></a><span class="hs-identifier">liftLitDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-776"></a><a name="liftLitDynFlags"><a href="PrelRules.html#liftLitDynFlags"><span class="hs-identifier">liftLitDynFlags</span></a></a><span> </span><a name="local-6989586621684814328"><a href="#local-6989586621684814328"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-777"></a><span>  </span><a name="local-6989586621684814329"><a href="#local-6989586621684814329"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-778"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814330"><a href="#local-6989586621684814330"><span class="hs-identifier">lit</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-779"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814328"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684814329"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814330"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-780"></a><span>
</span><a name="line-781"></a><span class="hs-identifier">removeOp32</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-782"></a><a name="removeOp32"><a href="PrelRules.html#removeOp32"><span class="hs-identifier">removeOp32</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-783"></a><span>  </span><a name="local-6989586621684814331"><a href="#local-6989586621684814331"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-784"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="PrelRules.html#wordSizeInBits"><span class="hs-identifier hs-var">wordSizeInBits</span></a><span> </span><a href="#local-6989586621684814331"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">32</span><span>
</span><a name="line-785"></a><span>  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-786"></a><span>    </span><span class="hs-special">[</span><a name="local-6989586621684814332"><a href="#local-6989586621684814332"><span class="hs-identifier">e</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-787"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814332"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-788"></a><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">mzero</span><span>
</span><a name="line-789"></a><span>
</span><a name="line-790"></a><span class="hs-identifier">getArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span>
</span><a name="line-791"></a><a name="getArgs"><a href="PrelRules.html#getArgs"><span class="hs-identifier">getArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814333"><a href="#local-6989586621684814333"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684814333"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-792"></a><span>
</span><a name="line-793"></a><span class="hs-identifier">getInScopeEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#InScopeEnv"><span class="hs-identifier hs-type">InScopeEnv</span></a><span>
</span><a name="line-794"></a><a name="getInScopeEnv"><a href="PrelRules.html#getInScopeEnv"><span class="hs-identifier">getInScopeEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814334"><a href="#local-6989586621684814334"><span class="hs-identifier">iu</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684814334"><span class="hs-identifier hs-var">iu</span></a><span>
</span><a name="line-795"></a><span>
</span><a name="line-796"></a><span class="hs-comment">-- return the n-th argument of this rule, if it is a literal</span><span>
</span><a name="line-797"></a><span class="hs-comment">-- argument indices start from 0</span><span>
</span><a name="line-798"></a><span class="hs-identifier">getLiteral</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span>
</span><a name="line-799"></a><a name="getLiteral"><a href="PrelRules.html#getLiteral"><span class="hs-identifier">getLiteral</span></a></a><span> </span><a name="local-6989586621684814335"><a href="#local-6989586621684814335"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-var">RuleM</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814336"><a href="#local-6989586621684814336"><span class="hs-identifier">exprs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">drop</span><span> </span><a href="#local-6989586621684814335"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621684814336"><span class="hs-identifier hs-var">exprs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-800"></a><span>  </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814337"><a href="#local-6989586621684814337"><span class="hs-identifier">l</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684814337"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-801"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-802"></a><span>
</span><a name="line-803"></a><span class="hs-identifier">unaryLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-804"></a><a name="unaryLit"><a href="PrelRules.html#unaryLit"><span class="hs-identifier">unaryLit</span></a></a><span> </span><a name="local-6989586621684814338"><a href="#local-6989586621684814338"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-805"></a><span>  </span><a name="local-6989586621684814339"><a href="#local-6989586621684814339"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-806"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814340"><a href="#local-6989586621684814340"><span class="hs-identifier">l</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-807"></a><span>  </span><a href="PrelRules.html#liftMaybe"><span class="hs-identifier hs-var">liftMaybe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814338"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621684814339"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#convFloating"><span class="hs-identifier hs-var">convFloating</span></a><span> </span><a href="#local-6989586621684814339"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814340"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-808"></a><span>
</span><a name="line-809"></a><span class="hs-identifier">binaryLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-810"></a><a name="binaryLit"><a href="PrelRules.html#binaryLit"><span class="hs-identifier">binaryLit</span></a></a><span> </span><a name="local-6989586621684814341"><a href="#local-6989586621684814341"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-811"></a><span>  </span><a name="local-6989586621684814342"><a href="#local-6989586621684814342"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-812"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814343"><a href="#local-6989586621684814343"><span class="hs-identifier">l1</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814344"><a href="#local-6989586621684814344"><span class="hs-identifier">l2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-813"></a><span>  </span><a href="PrelRules.html#liftMaybe"><span class="hs-identifier hs-var">liftMaybe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814341"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621684814342"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#convFloating"><span class="hs-identifier hs-var">convFloating</span></a><span> </span><a href="#local-6989586621684814342"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814343"><span class="hs-identifier hs-var">l1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="PrelRules.html#convFloating"><span class="hs-identifier hs-var">convFloating</span></a><span> </span><a href="#local-6989586621684814342"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814344"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span>
</span><a name="line-814"></a><span>
</span><a name="line-815"></a><span class="hs-identifier">binaryCmpLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621684814055"><a href="#local-6989586621684814055"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621684814055"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621684814055"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814055"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-816"></a><a name="binaryCmpLit"><a href="PrelRules.html#binaryCmpLit"><span class="hs-identifier">binaryCmpLit</span></a></a><span> </span><a name="local-6989586621684814345"><a href="#local-6989586621684814345"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-817"></a><span>  </span><a name="local-6989586621684814346"><a href="#local-6989586621684814346"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-818"></a><span>  </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#cmpOp"><span class="hs-identifier hs-var">cmpOp</span></a><span> </span><a href="#local-6989586621684814346"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814345"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span>
</span><a name="line-819"></a><span>
</span><a name="line-820"></a><span class="hs-identifier">leftIdentity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-821"></a><a name="leftIdentity"><a href="PrelRules.html#leftIdentity"><span class="hs-identifier">leftIdentity</span></a></a><span> </span><a name="local-6989586621684814347"><a href="#local-6989586621684814347"><span class="hs-identifier">id_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#leftIdentityDynFlags"><span class="hs-identifier hs-var">leftIdentityDynFlags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621684814347"><span class="hs-identifier hs-var">id_lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-822"></a><span>
</span><a name="line-823"></a><span class="hs-identifier">rightIdentity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-824"></a><a name="rightIdentity"><a href="PrelRules.html#rightIdentity"><span class="hs-identifier">rightIdentity</span></a></a><span> </span><a name="local-6989586621684814348"><a href="#local-6989586621684814348"><span class="hs-identifier">id_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier hs-var">rightIdentityDynFlags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621684814348"><span class="hs-identifier hs-var">id_lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-825"></a><span>
</span><a name="line-826"></a><span class="hs-identifier">identity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-827"></a><a name="identity"><a href="PrelRules.html#identity"><span class="hs-identifier">identity</span></a></a><span> </span><a name="local-6989586621684814349"><a href="#local-6989586621684814349"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#leftIdentity"><span class="hs-identifier hs-var">leftIdentity</span></a><span> </span><a href="#local-6989586621684814349"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">`</span><span> </span><a href="PrelRules.html#rightIdentity"><span class="hs-identifier hs-var">rightIdentity</span></a><span> </span><a href="#local-6989586621684814349"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-828"></a><span>
</span><a name="line-829"></a><span class="hs-identifier">leftIdentityDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-830"></a><a name="leftIdentityDynFlags"><a href="PrelRules.html#leftIdentityDynFlags"><span class="hs-identifier">leftIdentityDynFlags</span></a></a><span> </span><a name="local-6989586621684814350"><a href="#local-6989586621684814350"><span class="hs-identifier">id_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-831"></a><span>  </span><a name="local-6989586621684814351"><a href="#local-6989586621684814351"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-832"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814352"><a href="#local-6989586621684814352"><span class="hs-identifier">l1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814353"><a href="#local-6989586621684814353"><span class="hs-identifier">e2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-833"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814352"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814350"><span class="hs-identifier hs-var">id_lit</span></a><span> </span><a href="#local-6989586621684814351"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-834"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814353"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-835"></a><span>
</span><a name="line-836"></a><span class="hs-comment">-- | Left identity rule for PrimOps like 'IntAddC' and 'WordAddC', where, in</span><span>
</span><a name="line-837"></a><span class="hs-comment">-- addition to the result, we have to indicate that no carry/overflow occured.</span><span>
</span><a name="line-838"></a><span class="hs-identifier">leftIdentityCDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-839"></a><a name="leftIdentityCDynFlags"><a href="PrelRules.html#leftIdentityCDynFlags"><span class="hs-identifier">leftIdentityCDynFlags</span></a></a><span> </span><a name="local-6989586621684814354"><a href="#local-6989586621684814354"><span class="hs-identifier">id_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-840"></a><span>  </span><a name="local-6989586621684814355"><a href="#local-6989586621684814355"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-841"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814356"><a href="#local-6989586621684814356"><span class="hs-identifier">l1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814357"><a href="#local-6989586621684814357"><span class="hs-identifier">e2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-842"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814356"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814354"><span class="hs-identifier hs-var">id_lit</span></a><span> </span><a href="#local-6989586621684814355"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-843"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684814358"><a href="#local-6989586621684814358"><span class="hs-identifier">no_c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><a href="#local-6989586621684814355"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-844"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier hs-var">mkCoreUbxTup</span></a><span> </span><span class="hs-special">[</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621684814357"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">,</span><span> </span><a href="TysPrim.html#intPrimTy"><span class="hs-identifier hs-var">intPrimTy</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684814357"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814358"><span class="hs-identifier hs-var">no_c</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-845"></a><span>
</span><a name="line-846"></a><span class="hs-identifier">rightIdentityDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-847"></a><a name="rightIdentityDynFlags"><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier">rightIdentityDynFlags</span></a></a><span> </span><a name="local-6989586621684814359"><a href="#local-6989586621684814359"><span class="hs-identifier">id_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-848"></a><span>  </span><a name="local-6989586621684814360"><a href="#local-6989586621684814360"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-849"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621684814361"><a href="#local-6989586621684814361"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814362"><a href="#local-6989586621684814362"><span class="hs-identifier">l2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-850"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814362"><span class="hs-identifier hs-var">l2</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814359"><span class="hs-identifier hs-var">id_lit</span></a><span> </span><a href="#local-6989586621684814360"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-851"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814361"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-852"></a><span>
</span><a name="line-853"></a><span class="hs-comment">-- | Right identity rule for PrimOps like 'IntSubC' and 'WordSubC', where, in</span><span>
</span><a name="line-854"></a><span class="hs-comment">-- addition to the result, we have to indicate that no carry/overflow occured.</span><span>
</span><a name="line-855"></a><span class="hs-identifier">rightIdentityCDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-856"></a><a name="rightIdentityCDynFlags"><a href="PrelRules.html#rightIdentityCDynFlags"><span class="hs-identifier">rightIdentityCDynFlags</span></a></a><span> </span><a name="local-6989586621684814363"><a href="#local-6989586621684814363"><span class="hs-identifier">id_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-857"></a><span>  </span><a name="local-6989586621684814364"><a href="#local-6989586621684814364"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-858"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621684814365"><a href="#local-6989586621684814365"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814366"><a href="#local-6989586621684814366"><span class="hs-identifier">l2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-859"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814366"><span class="hs-identifier hs-var">l2</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814363"><span class="hs-identifier hs-var">id_lit</span></a><span> </span><a href="#local-6989586621684814364"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-860"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684814367"><a href="#local-6989586621684814367"><span class="hs-identifier">no_c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><a href="#local-6989586621684814364"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-861"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier hs-var">mkCoreUbxTup</span></a><span> </span><span class="hs-special">[</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621684814365"><span class="hs-identifier hs-var">e1</span></a><span class="hs-special">,</span><span> </span><a href="TysPrim.html#intPrimTy"><span class="hs-identifier hs-var">intPrimTy</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684814365"><span class="hs-identifier hs-var">e1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814367"><span class="hs-identifier hs-var">no_c</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-862"></a><span>
</span><a name="line-863"></a><span class="hs-identifier">identityDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-864"></a><a name="identityDynFlags"><a href="PrelRules.html#identityDynFlags"><span class="hs-identifier">identityDynFlags</span></a></a><span> </span><a name="local-6989586621684814368"><a href="#local-6989586621684814368"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-865"></a><span>  </span><a href="PrelRules.html#leftIdentityDynFlags"><span class="hs-identifier hs-var">leftIdentityDynFlags</span></a><span> </span><a href="#local-6989586621684814368"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">`</span><span> </span><a href="PrelRules.html#rightIdentityDynFlags"><span class="hs-identifier hs-var">rightIdentityDynFlags</span></a><span> </span><a href="#local-6989586621684814368"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-866"></a><span>
</span><a name="line-867"></a><span class="hs-comment">-- | Identity rule for PrimOps like 'IntAddC' and 'WordAddC', where, in addition</span><span>
</span><a name="line-868"></a><span class="hs-comment">-- to the result, we have to indicate that no carry/overflow occured.</span><span>
</span><a name="line-869"></a><span class="hs-identifier">identityCDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-870"></a><a name="identityCDynFlags"><a href="PrelRules.html#identityCDynFlags"><span class="hs-identifier">identityCDynFlags</span></a></a><span> </span><a name="local-6989586621684814369"><a href="#local-6989586621684814369"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-871"></a><span>  </span><a href="PrelRules.html#leftIdentityCDynFlags"><span class="hs-identifier hs-var">leftIdentityCDynFlags</span></a><span> </span><a href="#local-6989586621684814369"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">`</span><span> </span><a href="PrelRules.html#rightIdentityCDynFlags"><span class="hs-identifier hs-var">rightIdentityCDynFlags</span></a><span> </span><a href="#local-6989586621684814369"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-872"></a><span>
</span><a name="line-873"></a><span class="hs-identifier">leftZero</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-874"></a><a name="leftZero"><a href="PrelRules.html#leftZero"><span class="hs-identifier">leftZero</span></a></a><span> </span><a name="local-6989586621684814370"><a href="#local-6989586621684814370"><span class="hs-identifier">zero</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-875"></a><span>  </span><a name="local-6989586621684814371"><a href="#local-6989586621684814371"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-876"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814372"><a href="#local-6989586621684814372"><span class="hs-identifier">l1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-877"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814372"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814370"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="#local-6989586621684814371"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-878"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a href="#local-6989586621684814372"><span class="hs-identifier hs-var">l1</span></a><span>
</span><a name="line-879"></a><span>
</span><a name="line-880"></a><span class="hs-identifier">rightZero</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-881"></a><a name="rightZero"><a href="PrelRules.html#rightZero"><span class="hs-identifier">rightZero</span></a></a><span> </span><a name="local-6989586621684814373"><a href="#local-6989586621684814373"><span class="hs-identifier">zero</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-882"></a><span>  </span><a name="local-6989586621684814374"><a href="#local-6989586621684814374"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-883"></a><span>  </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814375"><a href="#local-6989586621684814375"><span class="hs-identifier">l2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-884"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814375"><span class="hs-identifier hs-var">l2</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814373"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="#local-6989586621684814374"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-885"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a href="#local-6989586621684814375"><span class="hs-identifier hs-var">l2</span></a><span>
</span><a name="line-886"></a><span>
</span><a name="line-887"></a><span class="hs-identifier">zeroElem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-888"></a><a name="zeroElem"><a href="PrelRules.html#zeroElem"><span class="hs-identifier">zeroElem</span></a></a><span> </span><a name="local-6989586621684814376"><a href="#local-6989586621684814376"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#leftZero"><span class="hs-identifier hs-var">leftZero</span></a><span> </span><a href="#local-6989586621684814376"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">`</span><span> </span><a href="PrelRules.html#rightZero"><span class="hs-identifier hs-var">rightZero</span></a><span> </span><a href="#local-6989586621684814376"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-889"></a><span>
</span><a name="line-890"></a><span class="hs-identifier">equalArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-891"></a><a name="equalArgs"><a href="PrelRules.html#equalArgs"><span class="hs-identifier">equalArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-892"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621684814377"><a href="#local-6989586621684814377"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814378"><a href="#local-6989586621684814378"><span class="hs-identifier">e2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-893"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814377"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-special">`</span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814378"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-894"></a><span>
</span><a name="line-895"></a><span class="hs-identifier">nonZeroLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-896"></a><a name="nonZeroLit"><a href="PrelRules.html#nonZeroLit"><span class="hs-identifier">nonZeroLit</span></a></a><span> </span><a name="local-6989586621684814379"><a href="#local-6989586621684814379"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#getLiteral"><span class="hs-identifier hs-var">getLiteral</span></a><span> </span><a href="#local-6989586621684814379"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Literal.html#isZeroLit"><span class="hs-identifier hs-var">isZeroLit</span></a><span>
</span><a name="line-897"></a><span>
</span><a name="line-898"></a><span class="hs-comment">-- When excess precision is not requested, cut down the precision of the</span><span>
</span><a name="line-899"></a><span class="hs-comment">-- Rational value to that of Float/Double. We confuse host architecture</span><span>
</span><a name="line-900"></a><span class="hs-comment">-- and target architecture here, but it's convenient (and wrong :-).</span><span>
</span><a name="line-901"></a><span class="hs-identifier">convFloating</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span>
</span><a name="line-902"></a><a name="convFloating"><a href="PrelRules.html#convFloating"><span class="hs-identifier">convFloating</span></a></a><span> </span><a name="local-6989586621684814380"><a href="#local-6989586621684814380"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span>  </span><a name="local-6989586621684814381"><a href="#local-6989586621684814381"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_ExcessPrecision"><span class="hs-identifier hs-var">Opt_ExcessPrecision</span></a><span> </span><a href="#local-6989586621684814380"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-903"></a><span>   </span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toRational</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromRational</span><span> </span><a href="#local-6989586621684814381"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Float</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-904"></a><span class="hs-identifier">convFloating</span><span> </span><a name="local-6989586621684814382"><a href="#local-6989586621684814382"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><a name="local-6989586621684814383"><a href="#local-6989586621684814383"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_ExcessPrecision"><span class="hs-identifier hs-var">Opt_ExcessPrecision</span></a><span> </span><a href="#local-6989586621684814382"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-905"></a><span>   </span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toRational</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromRational</span><span> </span><a href="#local-6989586621684814383"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-906"></a><span class="hs-identifier">convFloating</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814384"><a href="#local-6989586621684814384"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814384"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-907"></a><span>
</span><a name="line-908"></a><span class="hs-identifier">guardFloatDiv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-909"></a><a name="guardFloatDiv"><a href="PrelRules.html#guardFloatDiv"><span class="hs-identifier">guardFloatDiv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-910"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span> </span><a name="local-6989586621684814385"><a href="#local-6989586621684814385"><span class="hs-identifier">f1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span> </span><a name="local-6989586621684814386"><a href="#local-6989586621684814386"><span class="hs-identifier">f2</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-911"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814385"><span class="hs-identifier hs-var">f1</span></a><span> </span><span class="hs-operator hs-var">/=</span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684814386"><span class="hs-identifier hs-var">f2</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- see Note [negative zero]</span><span>
</span><a name="line-912"></a><span>       </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621684814386"><span class="hs-identifier hs-var">f2</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span>            </span><span class="hs-comment">-- avoid NaN and Infinity/-Infinity</span><span>
</span><a name="line-913"></a><span>
</span><a name="line-914"></a><span class="hs-identifier">guardDoubleDiv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-915"></a><a name="guardDoubleDiv"><a href="PrelRules.html#guardDoubleDiv"><span class="hs-identifier">guardDoubleDiv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-916"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><a name="local-6989586621684814387"><a href="#local-6989586621684814387"><span class="hs-identifier">d1</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><a name="local-6989586621684814388"><a href="#local-6989586621684814388"><span class="hs-identifier">d2</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-917"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814387"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-operator hs-var">/=</span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684814388"><span class="hs-identifier hs-var">d2</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- see Note [negative zero]</span><span>
</span><a name="line-918"></a><span>       </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621684814388"><span class="hs-identifier hs-var">d2</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span>            </span><span class="hs-comment">-- avoid NaN and Infinity/-Infinity</span><span>
</span><a name="line-919"></a><span class="hs-comment">-- Note [negative zero] Avoid (0 / -d), otherwise 0/(-1) reduces to</span><span>
</span><a name="line-920"></a><span class="hs-comment">-- zero, but we might want to preserve the negative zero here which</span><span>
</span><a name="line-921"></a><span class="hs-comment">-- is representable in Float/Double but not in (normalised)</span><span>
</span><a name="line-922"></a><span class="hs-comment">-- Rational. (#3676) Perhaps we should generate (0 :% (-1)) instead?</span><span>
</span><a name="line-923"></a><span>
</span><a name="line-924"></a><span class="hs-identifier">strengthReduction</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Literal.html#Literal"><span class="hs-identifier hs-type">Literal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-925"></a><a name="strengthReduction"><a href="PrelRules.html#strengthReduction"><span class="hs-identifier">strengthReduction</span></a></a><span> </span><a name="local-6989586621684814389"><a href="#local-6989586621684814389"><span class="hs-identifier">two_lit</span></a></a><span> </span><a name="local-6989586621684814390"><a href="#local-6989586621684814390"><span class="hs-identifier">add_op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Note [Strength reduction]</span><span>
</span><a name="line-926"></a><span>  </span><a name="local-6989586621684814395"><a href="#local-6989586621684814395"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">msum</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814391"><a href="#local-6989586621684814391"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814392"><a href="#local-6989586621684814392"><span class="hs-identifier">mult_lit</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-927"></a><span>                   </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814392"><span class="hs-identifier hs-var">mult_lit</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814389"><span class="hs-identifier hs-var">two_lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-928"></a><span>                   </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814391"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-929"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814393"><a href="#local-6989586621684814393"><span class="hs-identifier">mult_lit</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814394"><a href="#local-6989586621684814394"><span class="hs-identifier">arg</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-930"></a><span>                   </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814393"><span class="hs-identifier hs-var">mult_lit</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814389"><span class="hs-identifier hs-var">two_lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-931"></a><span>                   </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814394"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-932"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkPrimOpId"><span class="hs-identifier hs-var">mkPrimOpId</span></a><span> </span><a href="#local-6989586621684814390"><span class="hs-identifier hs-var">add_op</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814395"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814395"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-933"></a><span>
</span><a name="line-934"></a><span class="hs-comment">-- Note [Strength reduction]</span><span>
</span><a name="line-935"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-936"></a><span class="hs-comment">--</span><span>
</span><a name="line-937"></a><span class="hs-comment">-- This rule turns floating point multiplications of the form 2.0 * x and</span><span>
</span><a name="line-938"></a><span class="hs-comment">-- x * 2.0 into x + x addition, because addition costs less than multiplication.</span><span>
</span><a name="line-939"></a><span class="hs-comment">-- See #7116</span><span>
</span><a name="line-940"></a><span>
</span><a name="line-941"></a><span class="hs-comment">-- Note [What's true and false]</span><span>
</span><a name="line-942"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-943"></a><span class="hs-comment">--</span><span>
</span><a name="line-944"></a><span class="hs-comment">-- trueValInt and falseValInt represent true and false values returned by</span><span>
</span><a name="line-945"></a><span class="hs-comment">-- comparison primops for Char, Int, Word, Integer, Double, Float and Addr.</span><span>
</span><a name="line-946"></a><span class="hs-comment">-- True is represented as an unboxed 1# literal, while false is represented</span><span>
</span><a name="line-947"></a><span class="hs-comment">-- as 0# literal.</span><span>
</span><a name="line-948"></a><span class="hs-comment">-- We still need Bool data constructors (True and False) to use in a rule</span><span>
</span><a name="line-949"></a><span class="hs-comment">-- for constant folding of equal Strings</span><span>
</span><a name="line-950"></a><span>
</span><a name="line-951"></a><span class="hs-identifier">trueValInt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">falseValInt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span>
</span><a name="line-952"></a><a name="trueValInt"><a href="PrelRules.html#trueValInt"><span class="hs-identifier">trueValInt</span></a></a><span>  </span><a name="local-6989586621684814396"><a href="#local-6989586621684814396"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#onei"><span class="hs-identifier hs-var">onei</span></a><span>  </span><a href="#local-6989586621684814396"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-comment">-- see Note [What's true and false]</span><span>
</span><a name="line-953"></a><a name="falseValInt"><a href="PrelRules.html#falseValInt"><span class="hs-identifier">falseValInt</span></a></a><span> </span><a name="local-6989586621684814397"><a href="#local-6989586621684814397"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span> </span><a href="#local-6989586621684814397"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-954"></a><span>
</span><a name="line-955"></a><span class="hs-identifier">trueValBool</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">falseValBool</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span>
</span><a name="line-956"></a><a name="trueValBool"><a href="PrelRules.html#trueValBool"><span class="hs-identifier">trueValBool</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="TysWiredIn.html#trueDataConId"><span class="hs-identifier hs-var">trueDataConId</span></a><span> </span><span class="hs-comment">-- see Note [What's true and false]</span><span>
</span><a name="line-957"></a><a name="falseValBool"><a href="PrelRules.html#falseValBool"><span class="hs-identifier">falseValBool</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="TysWiredIn.html#falseDataConId"><span class="hs-identifier hs-var">falseDataConId</span></a><span>
</span><a name="line-958"></a><span>
</span><a name="line-959"></a><span class="hs-identifier">ltVal</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">eqVal</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gtVal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span>
</span><a name="line-960"></a><a name="ltVal"><a href="PrelRules.html#ltVal"><span class="hs-identifier">ltVal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="TysWiredIn.html#ordLTDataConId"><span class="hs-identifier hs-var">ordLTDataConId</span></a><span>
</span><a name="line-961"></a><a name="eqVal"><a href="PrelRules.html#eqVal"><span class="hs-identifier">eqVal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="TysWiredIn.html#ordEQDataConId"><span class="hs-identifier hs-var">ordEQDataConId</span></a><span>
</span><a name="line-962"></a><a name="gtVal"><a href="PrelRules.html#gtVal"><span class="hs-identifier">gtVal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="TysWiredIn.html#ordGTDataConId"><span class="hs-identifier hs-var">ordGTDataConId</span></a><span>
</span><a name="line-963"></a><span>
</span><a name="line-964"></a><span class="hs-identifier">mkIntVal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span>
</span><a name="line-965"></a><a name="mkIntVal"><a href="PrelRules.html#mkIntVal"><span class="hs-identifier">mkIntVal</span></a></a><span> </span><a name="local-6989586621684814398"><a href="#local-6989586621684814398"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814399"><a href="#local-6989586621684814399"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInt"><span class="hs-identifier hs-var">mkLitInt</span></a><span> </span><a href="#local-6989586621684814398"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814399"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-966"></a><span class="hs-identifier">mkFloatVal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span>
</span><a name="line-967"></a><a name="mkFloatVal"><a href="PrelRules.html#mkFloatVal"><span class="hs-identifier">mkFloatVal</span></a></a><span> </span><a name="local-6989586621684814400"><a href="#local-6989586621684814400"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814401"><a href="#local-6989586621684814401"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#convFloating"><span class="hs-identifier hs-var">convFloating</span></a><span> </span><a href="#local-6989586621684814400"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitFloat"><span class="hs-identifier hs-var">LitFloat</span></a><span>  </span><a href="#local-6989586621684814401"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-968"></a><span class="hs-identifier">mkDoubleVal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Rational</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span>
</span><a name="line-969"></a><a name="mkDoubleVal"><a href="PrelRules.html#mkDoubleVal"><span class="hs-identifier">mkDoubleVal</span></a></a><span> </span><a name="local-6989586621684814402"><a href="#local-6989586621684814402"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814403"><a href="#local-6989586621684814403"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#convFloating"><span class="hs-identifier hs-var">convFloating</span></a><span> </span><a href="#local-6989586621684814402"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><a href="#local-6989586621684814403"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-970"></a><span>
</span><a name="line-971"></a><span class="hs-identifier">matchPrimOpId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-972"></a><a name="matchPrimOpId"><a href="PrelRules.html#matchPrimOpId"><span class="hs-identifier">matchPrimOpId</span></a></a><span> </span><a name="local-6989586621684814404"><a href="#local-6989586621684814404"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684814405"><a href="#local-6989586621684814405"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-973"></a><span>  </span><a name="local-6989586621684814406"><a href="#local-6989586621684814406"><span class="hs-identifier">op'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#liftMaybe"><span class="hs-identifier hs-var">liftMaybe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a><span> </span><a href="#local-6989586621684814405"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-974"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814404"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814406"><span class="hs-identifier hs-var">op'</span></a><span>
</span><a name="line-975"></a><span>
</span><a name="line-976"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Special rules for seq, tagToEnum, dataToTag}
*                                                                      *
************************************************************************

Note [tagToEnum#]
~~~~~~~~~~~~~~~~~
Nasty check to ensure that tagToEnum# is applied to a type that is an
enumeration TyCon.  Unification may refine the type later, but this
check won't see that, alas.  It's crude but it works.

Here's are two cases that should fail
        f :: forall a. a
        f = tagToEnum# 0        -- Can't do tagToEnum# at a type variable

        g :: Int
        g = tagToEnum# 0        -- Int is not an enumeration

We used to make this check in the type inference engine, but it's quite
ugly to do so, because the delayed constraint solving means that we don't
really know what's going on until the end. It's very much a corner case
because we don't expect the user to call tagToEnum# at all; we merely
generate calls in derived instances of Enum.  So we compromise: a
rewrite rule rewrites a bad instance of tagToEnum# to an error call,
and emits a warning.
-}</span><span>
</span><a name="line-1004"></a><span>
</span><a name="line-1005"></a><span class="hs-identifier">tagToEnumRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1006"></a><span class="hs-comment">-- If     data T a = A | B | C</span><span>
</span><a name="line-1007"></a><span class="hs-comment">-- then   tag2Enum# (T ty) 2# --&gt;  B ty</span><span>
</span><a name="line-1008"></a><a name="tagToEnumRule"><a href="PrelRules.html#tagToEnumRule"><span class="hs-identifier">tagToEnumRule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1009"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621684814407"><a href="#local-6989586621684814407"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814408"><a href="#local-6989586621684814408"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-1010"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621684814407"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1011"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684814409"><a href="#local-6989586621684814409"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814410"><a href="#local-6989586621684814410"><span class="hs-identifier">tc_args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCon.html#isEnumerationTyCon"><span class="hs-identifier hs-var">isEnumerationTyCon</span></a><span> </span><a href="#local-6989586621684814409"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1012"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684814411"><a href="#local-6989586621684814411"><span class="hs-identifier">tag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814408"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-1013"></a><span>          </span><a name="local-6989586621684814412"><a href="#local-6989586621684814412"><span class="hs-identifier">correct_tag</span></a></a><span> </span><a name="local-6989586621684814413"><a href="#local-6989586621684814413"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConTagZ"><span class="hs-identifier hs-var">dataConTagZ</span></a><span> </span><a href="#local-6989586621684814413"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814411"><span class="hs-identifier hs-var">tag</span></a><span>
</span><a name="line-1014"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621684814414"><a href="#local-6989586621684814414"><span class="hs-identifier">dc</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621684814415"><a href="#local-6989586621684814415"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621684814412"><span class="hs-identifier hs-var">correct_tag</span></a><span> </span><span class="hs-special">(</span><a href="TyCon.html#tyConDataCons_maybe"><span class="hs-identifier hs-var">tyConDataCons_maybe</span></a><span> </span><a href="#local-6989586621684814409"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1015"></a><span>      </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">null</span></a><span> </span><span class="hs-identifier">rest</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1016"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#mkTyApps"><span class="hs-identifier hs-var">mkTyApps</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConWorkId"><span class="hs-identifier hs-var">dataConWorkId</span></a><span> </span><a href="#local-6989586621684814414"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814410"><span class="hs-identifier hs-var">tc_args</span></a><span>
</span><a name="line-1017"></a><span>
</span><a name="line-1018"></a><span>    </span><span class="hs-comment">-- See Note [tagToEnum#]</span><span>
</span><a name="line-1019"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><a href="Outputable.html#warnPprTrace"><span class="hs-identifier hs-var">True</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;tagToEnum# on non-enumeration type&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1020"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MkCore.html#mkRuntimeErrorApp"><span class="hs-identifier hs-var">mkRuntimeErrorApp</span></a><span> </span><a href="MkCore.html#rUNTIME_ERROR_ID"><span class="hs-identifier hs-var">rUNTIME_ERROR_ID</span></a><span> </span><a href="#local-6989586621684814407"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-string">&quot;tagToEnum# on non-enumeration type&quot;</span><span>
</span><a name="line-1021"></a><span>
</span><a name="line-1022"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-1023"></a><span class="hs-identifier">dataToTagRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1024"></a><span class="hs-comment">-- See Note [dataToTag#] in primops.txt.pp</span><span>
</span><a name="line-1025"></a><a name="dataToTagRule"><a href="PrelRules.html#dataToTagRule"><span class="hs-identifier">dataToTagRule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814416"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mplus</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814417"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1026"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1027"></a><span>    </span><span class="hs-comment">-- dataToTag (tagToEnum x)   ==&gt;   x</span><span>
</span><a name="line-1028"></a><span>    </span><a name="local-6989586621684814416"><a href="#local-6989586621684814416"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1029"></a><span>      </span><span class="hs-special">[</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621684814418"><a href="#local-6989586621684814418"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814419"><a href="#local-6989586621684814419"><span class="hs-identifier">tag_to_enum</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621684814420"><a href="#local-6989586621684814420"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814421"><a href="#local-6989586621684814421"><span class="hs-identifier">tag</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-1030"></a><span>      </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814419"><span class="hs-identifier hs-var">tag_to_enum</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrimOp.html#tagToEnumKey"><span class="hs-identifier hs-var">tagToEnumKey</span></a><span>
</span><a name="line-1031"></a><span>      </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814418"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814420"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1032"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684814421"><span class="hs-identifier hs-var">tag</span></a><span>
</span><a name="line-1033"></a><span>
</span><a name="line-1034"></a><span>    </span><span class="hs-comment">-- dataToTag (K e1 e2)  ==&gt;   tag-of K</span><span>
</span><a name="line-1035"></a><span>    </span><span class="hs-comment">-- This also works (via exprIsConApp_maybe) for</span><span>
</span><a name="line-1036"></a><span>    </span><span class="hs-comment">--   dataToTag x</span><span>
</span><a name="line-1037"></a><span>    </span><span class="hs-comment">-- where x's unfolding is a constructor application</span><span>
</span><a name="line-1038"></a><span>    </span><a name="local-6989586621684814417"><a href="#local-6989586621684814417"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1039"></a><span>      </span><a name="local-6989586621684814422"><a href="#local-6989586621684814422"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-1040"></a><span>      </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814423"><a href="#local-6989586621684814423"><span class="hs-identifier">val_arg</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-1041"></a><span>      </span><a name="local-6989586621684814424"><a href="#local-6989586621684814424"><span class="hs-identifier">in_scope</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getInScopeEnv"><span class="hs-identifier hs-var">getInScopeEnv</span></a><span>
</span><a name="line-1042"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621684814425"><a href="#local-6989586621684814425"><span class="hs-identifier">dc</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#liftMaybe"><span class="hs-identifier hs-var">liftMaybe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreOpt.html#exprIsConApp_maybe"><span class="hs-identifier hs-var">exprIsConApp_maybe</span></a><span> </span><a href="#local-6989586621684814424"><span class="hs-identifier hs-var">in_scope</span></a><span> </span><a href="#local-6989586621684814423"><span class="hs-identifier hs-var">val_arg</span></a><span>
</span><a name="line-1043"></a><span>      </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">isNewTyCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dataConTyCon</span><span> </span><span class="hs-identifier">dc</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><a href="DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">return</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1044"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="PrelRules.html#mkIntVal"><span class="hs-identifier hs-var">mkIntVal</span></a><span> </span><a href="#local-6989586621684814422"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConTagZ"><span class="hs-identifier hs-var">dataConTagZ</span></a><span> </span><a href="#local-6989586621684814425"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1045"></a><span>
</span><a name="line-1046"></a><span class="hs-comment">{- Note [dataToTag# magic]
~~~~~~~~~~~~~~~~~~~~~~~~~~
The primop dataToTag# is unusual because it evaluates its argument.
Only `SeqOp` shares that property.  (Other primops do not do anything
as fancy as argument evaluation.)  The special handling for dataToTag#
is:

* CoreUtils.exprOkForSpeculation has a special case for DataToTagOp,
  (actually in app_ok).  Most primops with lifted arguments do not
  evaluate those arguments, but DataToTagOp and SeqOp are two
  exceptions.  We say that they are /never/ ok-for-speculation,
  regardless of the evaluated-ness of their argument.
  See CoreUtils Note [exprOkForSpeculation and SeqOp/DataToTagOp]

* There is a special case for DataToTagOp in StgCmmExpr.cgExpr,
  that evaluates its argument and then extracts the tag from
  the returned value.

* An application like (dataToTag# (Just x)) is optimised by
  dataToTagRule in PrelRules.

* A case expression like
     case (dataToTag# e) of &lt;alts&gt;
  gets transformed t
     case e of &lt;transformed alts&gt;
  by PrelRules.caseRules; see Note [caseRules for dataToTag]

See Trac #15696 for a long saga.


************************************************************************
*                                                                      *
\subsection{Rules for seq# and spark#}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1082"></a><span>
</span><a name="line-1083"></a><span class="hs-comment">{- Note [seq# magic]
~~~~~~~~~~~~~~~~~~~~
The primop
   seq# :: forall a s . a -&gt; State# s -&gt; (# State# s, a #)

is /not/ the same as the Prelude function seq :: a -&gt; b -&gt; b
as you can see from its type.  In fact, seq# is the implementation
mechanism for 'evaluate'

   evaluate :: a -&gt; IO a
   evaluate a = IO $ \s -&gt; seq# a s

The semantics of seq# is
  * evaluate its first argument
  * and return it

Things to note

* Why do we need a primop at all?  That is, instead of
      case seq# x s of (# x, s #) -&gt; blah
  why not instead say this?
      case x of { DEFAULT -&gt; blah)

  Reason (see Trac #5129): if we saw
    catch# (\s -&gt; case x of { DEFAULT -&gt; raiseIO# exn s }) handler

  then we'd drop the 'case x' because the body of the case is bottom
  anyway. But we don't want to do that; the whole /point/ of
  seq#/evaluate is to evaluate 'x' first in the IO monad.

  In short, we /always/ evaluate the first argument and never
  just discard it.

* Why return the value?  So that we can control sharing of seq'd
  values: in
     let x = e in x `seq` ... x ...
  We don't want to inline x, so better to represent it as
       let x = e in case seq# x RW of (# _, x' #) -&gt; ... x' ...
  also it matches the type of rseq in the Eval monad.

Implementing seq#.  The compiler has magic for SeqOp in

- PrelRules.seqRule: eliminate (seq# &lt;whnf&gt; s)

- StgCmmExpr.cgExpr, and cgCase: special case for seq#

- CoreUtils.exprOkForSpeculation;
  see Note [exprOkForSpeculation and SeqOp/DataToTagOp] in CoreUtils

- Simplify.addEvals records evaluated-ness for the result; see
  Note [Adding evaluatedness info to pattern-bound variables]
  in Simplify
-}</span><span>
</span><a name="line-1136"></a><span>
</span><a name="line-1137"></a><span class="hs-identifier">seqRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1138"></a><a name="seqRule"><a href="PrelRules.html#seqRule"><span class="hs-identifier">seqRule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1139"></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621684814426"><a href="#local-6989586621684814426"><span class="hs-identifier">ty_a</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621684814427"><a href="#local-6989586621684814427"><span class="hs-identifier">_ty_s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814428"><a href="#local-6989586621684814428"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814429"><a href="#local-6989586621684814429"><span class="hs-identifier">s</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-1140"></a><span>  </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreUtils.html#exprIsHNF"><span class="hs-identifier hs-var">exprIsHNF</span></a><span> </span><a href="#local-6989586621684814428"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-1141"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier hs-var">mkCoreUbxTup</span></a><span> </span><span class="hs-special">[</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621684814429"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814426"><span class="hs-identifier hs-var">ty_a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684814429"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814428"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-1142"></a><span>
</span><a name="line-1143"></a><span class="hs-comment">-- spark# :: forall a s . a -&gt; State# s -&gt; (# State# s, a #)</span><span>
</span><a name="line-1144"></a><span class="hs-identifier">sparkRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1145"></a><a name="sparkRule"><a href="PrelRules.html#sparkRule"><span class="hs-identifier">sparkRule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#seqRule"><span class="hs-identifier hs-var">seqRule</span></a><span> </span><span class="hs-comment">-- reduce on HNF, just the same</span><span>
</span><a name="line-1146"></a><span>  </span><span class="hs-comment">-- XXX perhaps we shouldn't do this, because a spark eliminated by</span><span>
</span><a name="line-1147"></a><span>  </span><span class="hs-comment">-- this rule won't be counted as a dud at runtime?</span><span>
</span><a name="line-1148"></a><span>
</span><a name="line-1149"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Built in rules}
*                                                                      *
************************************************************************

Note [Scoping for Builtin rules]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When compiling a (base-package) module that defines one of the
functions mentioned in the RHS of a built-in rule, there's a danger
that we'll see

        f = ...(eq String x)....

        ....and lower down...

        eqString = ...

Then a rewrite would give

        f = ...(eqString x)...
        ....and lower down...
        eqString = ...

and lo, eqString is not in scope.  This only really matters when we get to code
generation.  With -O we do a GlomBinds step that does a new SCC analysis on the whole
set of bindings, which sorts out the dependency.  Without -O we don't do any rule
rewriting so again we are fine.

(This whole thing doesn't show up for non-built-in rules because their dependencies
are explicit.)
-}</span><span>
</span><a name="line-1182"></a><span>
</span><a name="line-1183"></a><span class="hs-identifier">builtinRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span class="hs-special">]</span><span>
</span><a name="line-1184"></a><span class="hs-comment">-- Rules for non-primops that can't be expressed using a RULE pragma</span><span>
</span><a name="line-1185"></a><a name="builtinRules"><a href="PrelRules.html#builtinRules"><span class="hs-identifier">builtinRules</span></a></a><span>
</span><a name="line-1186"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;AppendLitString&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-1187"></a><span>                   </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelNames.html#unpackCStringFoldrName"><span class="hs-identifier hs-var">unpackCStringFoldrName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1188"></a><span>                   </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_append_lit"><span class="hs-identifier hs-var">match_append_lit</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-1189"></a><span>     </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;EqString&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelNames.html#eqStringName"><span class="hs-identifier hs-var">eqStringName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1190"></a><span>                   </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_eq_string"><span class="hs-identifier hs-var">match_eq_string</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-1191"></a><span>     </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;Inline&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelNames.html#inlineIdName"><span class="hs-identifier hs-var">inlineIdName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1192"></a><span>                   </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#match_inline"><span class="hs-identifier hs-var">match_inline</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-1193"></a><span>     </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;MagicDict&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="MkId.html#magicDictId"><span class="hs-identifier hs-var">magicDictId</span></a><span class="hs-special">,</span><span>
</span><a name="line-1194"></a><span>                   </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">4</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#match_magicDict"><span class="hs-identifier hs-var">match_magicDict</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-1195"></a><span>     </span><a href="PrelRules.html#mkBasicRule"><span class="hs-identifier hs-var">mkBasicRule</span></a><span> </span><a href="PrelNames.html#divIntName"><span class="hs-identifier hs-var">divIntName</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">msum</span><span>
</span><a name="line-1196"></a><span>        </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#nonZeroLit"><span class="hs-identifier hs-var">nonZeroLit</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOp2"><span class="hs-identifier hs-var">intOp2</span></a><span> </span><span class="hs-identifier hs-var">div</span><span class="hs-special">)</span><span>
</span><a name="line-1197"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#leftZero"><span class="hs-identifier hs-var">leftZero</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-1198"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1199"></a><span>          </span><span class="hs-special">[</span><a name="local-6989586621684814430"><a href="#local-6989586621684814430"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814431"><a href="#local-6989586621684814431"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-1200"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814432"><a href="#local-6989586621684814432"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Util.html#exactLog2"><span class="hs-identifier hs-var">exactLog2</span></a><span> </span><a href="#local-6989586621684814431"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-1201"></a><span>          </span><a name="local-6989586621684814433"><a href="#local-6989586621684814433"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-1202"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkPrimOpId"><span class="hs-identifier hs-var">mkPrimOpId</span></a><span> </span><a href="PrimOp.html#ISraOp"><span class="hs-identifier hs-var">ISraOp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814430"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="PrelRules.html#mkIntVal"><span class="hs-identifier hs-var">mkIntVal</span></a><span> </span><a href="#local-6989586621684814433"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814432"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1203"></a><span>        </span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1204"></a><span>     </span><a href="PrelRules.html#mkBasicRule"><span class="hs-identifier hs-var">mkBasicRule</span></a><span> </span><a href="PrelNames.html#modIntName"><span class="hs-identifier hs-var">modIntName</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">msum</span><span>
</span><a name="line-1205"></a><span>        </span><span class="hs-special">[</span><span> </span><a href="PrelRules.html#nonZeroLit"><span class="hs-identifier hs-var">nonZeroLit</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="PrelRules.html#binaryLit"><span class="hs-identifier hs-var">binaryLit</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#intOp2"><span class="hs-identifier hs-var">intOp2</span></a><span> </span><span class="hs-identifier hs-var">mod</span><span class="hs-special">)</span><span>
</span><a name="line-1206"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="PrelRules.html#leftZero"><span class="hs-identifier hs-var">leftZero</span></a><span> </span><a href="PrelRules.html#zeroi"><span class="hs-identifier hs-var">zeroi</span></a><span>
</span><a name="line-1207"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1208"></a><span>          </span><span class="hs-special">[</span><a name="local-6989586621684814434"><a href="#local-6989586621684814434"><span class="hs-identifier">arg</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814435"><a href="#local-6989586621684814435"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-1209"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Util.html#exactLog2"><span class="hs-identifier hs-var">exactLog2</span></a><span> </span><a href="#local-6989586621684814435"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-1210"></a><span>          </span><a name="local-6989586621684814436"><a href="#local-6989586621684814436"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-1211"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkPrimOpId"><span class="hs-identifier hs-var">mkPrimOpId</span></a><span> </span><a href="PrimOp.html#AndIOp"><span class="hs-identifier hs-var">AndIOp</span></a><span class="hs-special">)</span><span>
</span><a name="line-1212"></a><span>            </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814434"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="PrelRules.html#mkIntVal"><span class="hs-identifier hs-var">mkIntVal</span></a><span> </span><a href="#local-6989586621684814436"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814435"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1213"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-1214"></a><span>     </span><span class="hs-special">]</span><span>
</span><a name="line-1215"></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="PrelRules.html#builtinIntegerRules"><span class="hs-identifier hs-var">builtinIntegerRules</span></a><span>
</span><a name="line-1216"></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="PrelRules.html#builtinNaturalRules"><span class="hs-identifier hs-var">builtinNaturalRules</span></a><span>
</span><a name="line-1217"></a><span class="hs-pragma">{-# NOINLINE</span><span> </span><span class="hs-pragma">builtinRules</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1218"></a><span class="hs-comment">-- there is no benefit to inlining these yet, despite this, GHC produces</span><span>
</span><a name="line-1219"></a><span class="hs-comment">-- unfoldings for this regardless since the floated list entries look small.</span><span>
</span><a name="line-1220"></a><span>
</span><a name="line-1221"></a><span class="hs-identifier">builtinIntegerRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span class="hs-special">]</span><span>
</span><a name="line-1222"></a><a name="builtinIntegerRules"><a href="PrelRules.html#builtinIntegerRules"><span class="hs-identifier">builtinIntegerRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1223"></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684814438"><span class="hs-identifier hs-var">rule_IntToInteger</span></a><span>   </span><span class="hs-string">&quot;smallInteger&quot;</span><span>        </span><a href="PrelNames.html#smallIntegerName"><span class="hs-identifier hs-var">smallIntegerName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1224"></a><span>  </span><a href="#local-6989586621684814439"><span class="hs-identifier hs-var">rule_WordToInteger</span></a><span>  </span><span class="hs-string">&quot;wordToInteger&quot;</span><span>       </span><a href="PrelNames.html#wordToIntegerName"><span class="hs-identifier hs-var">wordToIntegerName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1225"></a><span>  </span><a href="#local-6989586621684814440"><span class="hs-identifier hs-var">rule_Int64ToInteger</span></a><span>  </span><span class="hs-string">&quot;int64ToInteger&quot;</span><span>     </span><a href="PrelNames.html#int64ToIntegerName"><span class="hs-identifier hs-var">int64ToIntegerName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1226"></a><span>  </span><a href="#local-6989586621684814441"><span class="hs-identifier hs-var">rule_Word64ToInteger</span></a><span> </span><span class="hs-string">&quot;word64ToInteger&quot;</span><span>    </span><a href="PrelNames.html#word64ToIntegerName"><span class="hs-identifier hs-var">word64ToIntegerName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1227"></a><span>  </span><a href="#local-6989586621684814437"><span class="hs-identifier hs-var">rule_convert</span></a><span>        </span><span class="hs-string">&quot;integerToWord&quot;</span><span>       </span><a href="PrelNames.html#integerToWordName"><span class="hs-identifier hs-var">integerToWordName</span></a><span>       </span><a href="CoreSyn.html#mkWordLitWord"><span class="hs-identifier hs-var">mkWordLitWord</span></a><span class="hs-special">,</span><span>
</span><a name="line-1228"></a><span>  </span><a href="#local-6989586621684814437"><span class="hs-identifier hs-var">rule_convert</span></a><span>        </span><span class="hs-string">&quot;integerToInt&quot;</span><span>        </span><a href="PrelNames.html#integerToIntName"><span class="hs-identifier hs-var">integerToIntName</span></a><span>        </span><a href="CoreSyn.html#mkIntLitInt"><span class="hs-identifier hs-var">mkIntLitInt</span></a><span class="hs-special">,</span><span>
</span><a name="line-1229"></a><span>  </span><a href="#local-6989586621684814437"><span class="hs-identifier hs-var">rule_convert</span></a><span>        </span><span class="hs-string">&quot;integerToWord64&quot;</span><span>     </span><a href="PrelNames.html#integerToWord64Name"><span class="hs-identifier hs-var">integerToWord64Name</span></a><span>     </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#mkWord64LitWord64"><span class="hs-identifier hs-var">mkWord64LitWord64</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1230"></a><span>  </span><a href="#local-6989586621684814437"><span class="hs-identifier hs-var">rule_convert</span></a><span>        </span><span class="hs-string">&quot;integerToInt64&quot;</span><span>      </span><a href="PrelNames.html#integerToInt64Name"><span class="hs-identifier hs-var">integerToInt64Name</span></a><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#mkInt64LitInt64"><span class="hs-identifier hs-var">mkInt64LitInt64</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1231"></a><span>  </span><a href="#local-6989586621684814444"><span class="hs-identifier hs-var">rule_binop</span></a><span>          </span><span class="hs-string">&quot;plusInteger&quot;</span><span>         </span><a href="PrelNames.html#plusIntegerName"><span class="hs-identifier hs-var">plusIntegerName</span></a><span>         </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1232"></a><span>  </span><a href="#local-6989586621684814444"><span class="hs-identifier hs-var">rule_binop</span></a><span>          </span><span class="hs-string">&quot;minusInteger&quot;</span><span>        </span><a href="PrelNames.html#minusIntegerName"><span class="hs-identifier hs-var">minusIntegerName</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1233"></a><span>  </span><a href="#local-6989586621684814444"><span class="hs-identifier hs-var">rule_binop</span></a><span>          </span><span class="hs-string">&quot;timesInteger&quot;</span><span>        </span><a href="PrelNames.html#timesIntegerName"><span class="hs-identifier hs-var">timesIntegerName</span></a><span>        </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1234"></a><span>  </span><a href="#local-6989586621684814442"><span class="hs-identifier hs-var">rule_unop</span></a><span>           </span><span class="hs-string">&quot;negateInteger&quot;</span><span>       </span><a href="PrelNames.html#negateIntegerName"><span class="hs-identifier hs-var">negateIntegerName</span></a><span>       </span><span class="hs-identifier hs-var">negate</span><span class="hs-special">,</span><span>
</span><a name="line-1235"></a><span>  </span><a href="#local-6989586621684814448"><span class="hs-identifier hs-var">rule_binop_Prim</span></a><span>     </span><span class="hs-string">&quot;eqInteger#&quot;</span><span>          </span><a href="PrelNames.html#eqIntegerPrimName"><span class="hs-identifier hs-var">eqIntegerPrimName</span></a><span>       </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1236"></a><span>  </span><a href="#local-6989586621684814448"><span class="hs-identifier hs-var">rule_binop_Prim</span></a><span>     </span><span class="hs-string">&quot;neqInteger#&quot;</span><span>         </span><a href="PrelNames.html#neqIntegerPrimName"><span class="hs-identifier hs-var">neqIntegerPrimName</span></a><span>      </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1237"></a><span>  </span><a href="#local-6989586621684814442"><span class="hs-identifier hs-var">rule_unop</span></a><span>           </span><span class="hs-string">&quot;absInteger&quot;</span><span>          </span><a href="PrelNames.html#absIntegerName"><span class="hs-identifier hs-var">absIntegerName</span></a><span>          </span><span class="hs-identifier hs-var">abs</span><span class="hs-special">,</span><span>
</span><a name="line-1238"></a><span>  </span><a href="#local-6989586621684814442"><span class="hs-identifier hs-var">rule_unop</span></a><span>           </span><span class="hs-string">&quot;signumInteger&quot;</span><span>       </span><a href="PrelNames.html#signumIntegerName"><span class="hs-identifier hs-var">signumIntegerName</span></a><span>       </span><span class="hs-identifier hs-var">signum</span><span class="hs-special">,</span><span>
</span><a name="line-1239"></a><span>  </span><a href="#local-6989586621684814448"><span class="hs-identifier hs-var">rule_binop_Prim</span></a><span>     </span><span class="hs-string">&quot;leInteger#&quot;</span><span>          </span><a href="PrelNames.html#leIntegerPrimName"><span class="hs-identifier hs-var">leIntegerPrimName</span></a><span>       </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1240"></a><span>  </span><a href="#local-6989586621684814448"><span class="hs-identifier hs-var">rule_binop_Prim</span></a><span>     </span><span class="hs-string">&quot;gtInteger#&quot;</span><span>          </span><a href="PrelNames.html#gtIntegerPrimName"><span class="hs-identifier hs-var">gtIntegerPrimName</span></a><span>       </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1241"></a><span>  </span><a href="#local-6989586621684814448"><span class="hs-identifier hs-var">rule_binop_Prim</span></a><span>     </span><span class="hs-string">&quot;ltInteger#&quot;</span><span>          </span><a href="PrelNames.html#ltIntegerPrimName"><span class="hs-identifier hs-var">ltIntegerPrimName</span></a><span>       </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1242"></a><span>  </span><a href="#local-6989586621684814448"><span class="hs-identifier hs-var">rule_binop_Prim</span></a><span>     </span><span class="hs-string">&quot;geInteger#&quot;</span><span>          </span><a href="PrelNames.html#geIntegerPrimName"><span class="hs-identifier hs-var">geIntegerPrimName</span></a><span>       </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1243"></a><span>  </span><a href="#local-6989586621684814449"><span class="hs-identifier hs-var">rule_binop_Ordering</span></a><span> </span><span class="hs-string">&quot;compareInteger&quot;</span><span>      </span><a href="PrelNames.html#compareIntegerName"><span class="hs-identifier hs-var">compareIntegerName</span></a><span>      </span><span class="hs-identifier hs-var">compare</span><span class="hs-special">,</span><span>
</span><a name="line-1244"></a><span>  </span><a href="#local-6989586621684814450"><span class="hs-identifier hs-var">rule_encodeFloat</span></a><span>    </span><span class="hs-string">&quot;encodeFloatInteger&quot;</span><span>  </span><a href="PrelNames.html#encodeFloatIntegerName"><span class="hs-identifier hs-var">encodeFloatIntegerName</span></a><span>  </span><a href="CoreSyn.html#mkFloatLitFloat"><span class="hs-identifier hs-var">mkFloatLitFloat</span></a><span class="hs-special">,</span><span>
</span><a name="line-1245"></a><span>  </span><a href="#local-6989586621684814437"><span class="hs-identifier hs-var">rule_convert</span></a><span>        </span><span class="hs-string">&quot;floatFromInteger&quot;</span><span>    </span><a href="PrelNames.html#floatFromIntegerName"><span class="hs-identifier hs-var">floatFromIntegerName</span></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#mkFloatLitFloat"><span class="hs-identifier hs-var">mkFloatLitFloat</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1246"></a><span>  </span><a href="#local-6989586621684814450"><span class="hs-identifier hs-var">rule_encodeFloat</span></a><span>    </span><span class="hs-string">&quot;encodeDoubleInteger&quot;</span><span> </span><a href="PrelNames.html#encodeDoubleIntegerName"><span class="hs-identifier hs-var">encodeDoubleIntegerName</span></a><span> </span><a href="CoreSyn.html#mkDoubleLitDouble"><span class="hs-identifier hs-var">mkDoubleLitDouble</span></a><span class="hs-special">,</span><span>
</span><a name="line-1247"></a><span>  </span><a href="#local-6989586621684814451"><span class="hs-identifier hs-var">rule_decodeDouble</span></a><span>   </span><span class="hs-string">&quot;decodeDoubleInteger&quot;</span><span> </span><a href="PrelNames.html#decodeDoubleIntegerName"><span class="hs-identifier hs-var">decodeDoubleIntegerName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1248"></a><span>  </span><a href="#local-6989586621684814437"><span class="hs-identifier hs-var">rule_convert</span></a><span>        </span><span class="hs-string">&quot;doubleFromInteger&quot;</span><span>   </span><a href="PrelNames.html#doubleFromIntegerName"><span class="hs-identifier hs-var">doubleFromIntegerName</span></a><span>   </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#mkDoubleLitDouble"><span class="hs-identifier hs-var">mkDoubleLitDouble</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1249"></a><span>  </span><a href="#local-6989586621684814454"><span class="hs-identifier hs-var">rule_rationalTo</span></a><span>     </span><span class="hs-string">&quot;rationalToFloat&quot;</span><span>     </span><a href="PrelNames.html#rationalToFloatName"><span class="hs-identifier hs-var">rationalToFloatName</span></a><span>     </span><a href="MkCore.html#mkFloatExpr"><span class="hs-identifier hs-var">mkFloatExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-1250"></a><span>  </span><a href="#local-6989586621684814454"><span class="hs-identifier hs-var">rule_rationalTo</span></a><span>     </span><span class="hs-string">&quot;rationalToDouble&quot;</span><span>    </span><a href="PrelNames.html#rationalToDoubleName"><span class="hs-identifier hs-var">rationalToDoubleName</span></a><span>    </span><a href="MkCore.html#mkDoubleExpr"><span class="hs-identifier hs-var">mkDoubleExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-1251"></a><span>  </span><a href="#local-6989586621684814444"><span class="hs-identifier hs-var">rule_binop</span></a><span>          </span><span class="hs-string">&quot;gcdInteger&quot;</span><span>          </span><a href="PrelNames.html#gcdIntegerName"><span class="hs-identifier hs-var">gcdIntegerName</span></a><span>          </span><span class="hs-identifier hs-var">gcd</span><span class="hs-special">,</span><span>
</span><a name="line-1252"></a><span>  </span><a href="#local-6989586621684814444"><span class="hs-identifier hs-var">rule_binop</span></a><span>          </span><span class="hs-string">&quot;lcmInteger&quot;</span><span>          </span><a href="PrelNames.html#lcmIntegerName"><span class="hs-identifier hs-var">lcmIntegerName</span></a><span>          </span><span class="hs-identifier hs-var">lcm</span><span class="hs-special">,</span><span>
</span><a name="line-1253"></a><span>  </span><a href="#local-6989586621684814444"><span class="hs-identifier hs-var">rule_binop</span></a><span>          </span><span class="hs-string">&quot;andInteger&quot;</span><span>          </span><a href="PrelNames.html#andIntegerName"><span class="hs-identifier hs-var">andIntegerName</span></a><span>          </span><span class="hs-special">(</span><span class="hs-operator hs-var">.&amp;.</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1254"></a><span>  </span><a href="#local-6989586621684814444"><span class="hs-identifier hs-var">rule_binop</span></a><span>          </span><span class="hs-string">&quot;orInteger&quot;</span><span>           </span><a href="PrelNames.html#orIntegerName"><span class="hs-identifier hs-var">orIntegerName</span></a><span>           </span><span class="hs-special">(</span><span class="hs-operator hs-var">.|.</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1255"></a><span>  </span><a href="#local-6989586621684814444"><span class="hs-identifier hs-var">rule_binop</span></a><span>          </span><span class="hs-string">&quot;xorInteger&quot;</span><span>          </span><a href="PrelNames.html#xorIntegerName"><span class="hs-identifier hs-var">xorIntegerName</span></a><span>          </span><span class="hs-identifier hs-var">xor</span><span class="hs-special">,</span><span>
</span><a name="line-1256"></a><span>  </span><a href="#local-6989586621684814442"><span class="hs-identifier hs-var">rule_unop</span></a><span>           </span><span class="hs-string">&quot;complementInteger&quot;</span><span>   </span><a href="PrelNames.html#complementIntegerName"><span class="hs-identifier hs-var">complementIntegerName</span></a><span>   </span><span class="hs-identifier hs-var">complement</span><span class="hs-special">,</span><span>
</span><a name="line-1257"></a><span>  </span><a href="#local-6989586621684814447"><span class="hs-identifier hs-var">rule_shift_op</span></a><span>       </span><span class="hs-string">&quot;shiftLInteger&quot;</span><span>       </span><a href="PrelNames.html#shiftLIntegerName"><span class="hs-identifier hs-var">shiftLIntegerName</span></a><span>       </span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">,</span><span>
</span><a name="line-1258"></a><span>  </span><a href="#local-6989586621684814447"><span class="hs-identifier hs-var">rule_shift_op</span></a><span>       </span><span class="hs-string">&quot;shiftRInteger&quot;</span><span>       </span><a href="PrelNames.html#shiftRIntegerName"><span class="hs-identifier hs-var">shiftRIntegerName</span></a><span>       </span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">,</span><span>
</span><a name="line-1259"></a><span>  </span><a href="#local-6989586621684814443"><span class="hs-identifier hs-var">rule_bitInteger</span></a><span>     </span><span class="hs-string">&quot;bitInteger&quot;</span><span>          </span><a href="PrelNames.html#bitIntegerName"><span class="hs-identifier hs-var">bitIntegerName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1260"></a><span>  </span><span class="hs-comment">-- See Note [Integer division constant folding] in libraries/base/GHC/Real.hs</span><span>
</span><a name="line-1261"></a><span>  </span><a href="#local-6989586621684814446"><span class="hs-identifier hs-var">rule_divop_one</span></a><span>      </span><span class="hs-string">&quot;quotInteger&quot;</span><span>         </span><a href="PrelNames.html#quotIntegerName"><span class="hs-identifier hs-var">quotIntegerName</span></a><span>         </span><span class="hs-identifier hs-var">quot</span><span class="hs-special">,</span><span>
</span><a name="line-1262"></a><span>  </span><a href="#local-6989586621684814446"><span class="hs-identifier hs-var">rule_divop_one</span></a><span>      </span><span class="hs-string">&quot;remInteger&quot;</span><span>          </span><a href="PrelNames.html#remIntegerName"><span class="hs-identifier hs-var">remIntegerName</span></a><span>          </span><span class="hs-identifier hs-var">rem</span><span class="hs-special">,</span><span>
</span><a name="line-1263"></a><span>  </span><a href="#local-6989586621684814446"><span class="hs-identifier hs-var">rule_divop_one</span></a><span>      </span><span class="hs-string">&quot;divInteger&quot;</span><span>          </span><a href="PrelNames.html#divIntegerName"><span class="hs-identifier hs-var">divIntegerName</span></a><span>          </span><span class="hs-identifier hs-var">div</span><span class="hs-special">,</span><span>
</span><a name="line-1264"></a><span>  </span><a href="#local-6989586621684814446"><span class="hs-identifier hs-var">rule_divop_one</span></a><span>      </span><span class="hs-string">&quot;modInteger&quot;</span><span>          </span><a href="PrelNames.html#modIntegerName"><span class="hs-identifier hs-var">modIntegerName</span></a><span>          </span><span class="hs-identifier hs-var">mod</span><span class="hs-special">,</span><span>
</span><a name="line-1265"></a><span>  </span><a href="#local-6989586621684814445"><span class="hs-identifier hs-var">rule_divop_both</span></a><span>     </span><span class="hs-string">&quot;divModInteger&quot;</span><span>       </span><a href="PrelNames.html#divModIntegerName"><span class="hs-identifier hs-var">divModIntegerName</span></a><span>       </span><span class="hs-identifier hs-var">divMod</span><span class="hs-special">,</span><span>
</span><a name="line-1266"></a><span>  </span><a href="#local-6989586621684814445"><span class="hs-identifier hs-var">rule_divop_both</span></a><span>     </span><span class="hs-string">&quot;quotRemInteger&quot;</span><span>      </span><a href="PrelNames.html#quotRemIntegerName"><span class="hs-identifier hs-var">quotRemIntegerName</span></a><span>      </span><span class="hs-identifier hs-var">quotRem</span><span class="hs-special">,</span><span>
</span><a name="line-1267"></a><span>  </span><span class="hs-comment">-- These rules below don't actually have to be built in, but if we</span><span>
</span><a name="line-1268"></a><span>  </span><span class="hs-comment">-- put them in the Haskell source then we'd have to duplicate them</span><span>
</span><a name="line-1269"></a><span>  </span><span class="hs-comment">-- between all Integer implementations</span><span>
</span><a name="line-1270"></a><span>  </span><a href="#local-6989586621684814452"><span class="hs-identifier hs-var">rule_XToIntegerToX</span></a><span> </span><span class="hs-string">&quot;smallIntegerToInt&quot;</span><span>       </span><a href="PrelNames.html#integerToIntName"><span class="hs-identifier hs-var">integerToIntName</span></a><span>    </span><a href="PrelNames.html#smallIntegerName"><span class="hs-identifier hs-var">smallIntegerName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1271"></a><span>  </span><a href="#local-6989586621684814452"><span class="hs-identifier hs-var">rule_XToIntegerToX</span></a><span> </span><span class="hs-string">&quot;wordToIntegerToWord&quot;</span><span>     </span><a href="PrelNames.html#integerToWordName"><span class="hs-identifier hs-var">integerToWordName</span></a><span>   </span><a href="PrelNames.html#wordToIntegerName"><span class="hs-identifier hs-var">wordToIntegerName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1272"></a><span>  </span><a href="#local-6989586621684814452"><span class="hs-identifier hs-var">rule_XToIntegerToX</span></a><span> </span><span class="hs-string">&quot;int64ToIntegerToInt64&quot;</span><span>   </span><a href="PrelNames.html#integerToInt64Name"><span class="hs-identifier hs-var">integerToInt64Name</span></a><span>  </span><a href="PrelNames.html#int64ToIntegerName"><span class="hs-identifier hs-var">int64ToIntegerName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1273"></a><span>  </span><a href="#local-6989586621684814452"><span class="hs-identifier hs-var">rule_XToIntegerToX</span></a><span> </span><span class="hs-string">&quot;word64ToIntegerToWord64&quot;</span><span> </span><a href="PrelNames.html#integerToWord64Name"><span class="hs-identifier hs-var">integerToWord64Name</span></a><span> </span><a href="PrelNames.html#word64ToIntegerName"><span class="hs-identifier hs-var">word64ToIntegerName</span></a><span class="hs-special">,</span><span>
</span><a name="line-1274"></a><span>  </span><a href="#local-6989586621684814453"><span class="hs-identifier hs-var">rule_smallIntegerTo</span></a><span> </span><span class="hs-string">&quot;smallIntegerToWord&quot;</span><span>   </span><a href="PrelNames.html#integerToWordName"><span class="hs-identifier hs-var">integerToWordName</span></a><span>     </span><a href="PrimOp.html#Int2WordOp"><span class="hs-identifier hs-var">Int2WordOp</span></a><span class="hs-special">,</span><span>
</span><a name="line-1275"></a><span>  </span><a href="#local-6989586621684814453"><span class="hs-identifier hs-var">rule_smallIntegerTo</span></a><span> </span><span class="hs-string">&quot;smallIntegerToFloat&quot;</span><span>  </span><a href="PrelNames.html#floatFromIntegerName"><span class="hs-identifier hs-var">floatFromIntegerName</span></a><span>  </span><a href="PrimOp.html#Int2FloatOp"><span class="hs-identifier hs-var">Int2FloatOp</span></a><span class="hs-special">,</span><span>
</span><a name="line-1276"></a><span>  </span><a href="#local-6989586621684814453"><span class="hs-identifier hs-var">rule_smallIntegerTo</span></a><span> </span><span class="hs-string">&quot;smallIntegerToDouble&quot;</span><span> </span><a href="PrelNames.html#doubleFromIntegerName"><span class="hs-identifier hs-var">doubleFromIntegerName</span></a><span> </span><a href="PrimOp.html#Int2DoubleOp"><span class="hs-identifier hs-var">Int2DoubleOp</span></a><span>
</span><a name="line-1277"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-1278"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684814437"><a href="#local-6989586621684814437"><span class="hs-identifier">rule_convert</span></a></a><span> </span><a name="local-6989586621684814455"><a href="#local-6989586621684814455"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814456"><a href="#local-6989586621684814456"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814457"><a href="#local-6989586621684814457"><span class="hs-identifier">convert</span></a></a><span>
</span><a name="line-1279"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814455"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814456"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1280"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Integer_convert"><span class="hs-identifier hs-var">match_Integer_convert</span></a><span> </span><a href="#local-6989586621684814457"><span class="hs-identifier hs-var">convert</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1281"></a><span>          </span><a name="local-6989586621684814438"><a href="#local-6989586621684814438"><span class="hs-identifier">rule_IntToInteger</span></a></a><span> </span><a name="local-6989586621684814458"><a href="#local-6989586621684814458"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814459"><a href="#local-6989586621684814459"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1282"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814458"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814459"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1283"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_IntToInteger"><span class="hs-identifier hs-var">match_IntToInteger</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1284"></a><span>          </span><a name="local-6989586621684814439"><a href="#local-6989586621684814439"><span class="hs-identifier">rule_WordToInteger</span></a></a><span> </span><a name="local-6989586621684814460"><a href="#local-6989586621684814460"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814461"><a href="#local-6989586621684814461"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1285"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814460"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814461"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1286"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_WordToInteger"><span class="hs-identifier hs-var">match_WordToInteger</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1287"></a><span>          </span><a name="local-6989586621684814440"><a href="#local-6989586621684814440"><span class="hs-identifier">rule_Int64ToInteger</span></a></a><span> </span><a name="local-6989586621684814462"><a href="#local-6989586621684814462"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814463"><a href="#local-6989586621684814463"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1288"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814462"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814463"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1289"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Int64ToInteger"><span class="hs-identifier hs-var">match_Int64ToInteger</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1290"></a><span>          </span><a name="local-6989586621684814441"><a href="#local-6989586621684814441"><span class="hs-identifier">rule_Word64ToInteger</span></a></a><span> </span><a name="local-6989586621684814464"><a href="#local-6989586621684814464"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814465"><a href="#local-6989586621684814465"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1291"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814464"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814465"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1292"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Word64ToInteger"><span class="hs-identifier hs-var">match_Word64ToInteger</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1293"></a><span>          </span><a name="local-6989586621684814442"><a href="#local-6989586621684814442"><span class="hs-identifier">rule_unop</span></a></a><span> </span><a name="local-6989586621684814466"><a href="#local-6989586621684814466"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814467"><a href="#local-6989586621684814467"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814468"><a href="#local-6989586621684814468"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1294"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814466"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814467"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1295"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Integer_unop"><span class="hs-identifier hs-var">match_Integer_unop</span></a><span> </span><a href="#local-6989586621684814468"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1296"></a><span>          </span><a name="local-6989586621684814443"><a href="#local-6989586621684814443"><span class="hs-identifier">rule_bitInteger</span></a></a><span> </span><a name="local-6989586621684814469"><a href="#local-6989586621684814469"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814470"><a href="#local-6989586621684814470"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1297"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814469"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814470"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1298"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_bitInteger"><span class="hs-identifier hs-var">match_bitInteger</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1299"></a><span>          </span><a name="local-6989586621684814444"><a href="#local-6989586621684814444"><span class="hs-identifier">rule_binop</span></a></a><span> </span><a name="local-6989586621684814471"><a href="#local-6989586621684814471"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814472"><a href="#local-6989586621684814472"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814473"><a href="#local-6989586621684814473"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1300"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814471"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814472"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span>
</span><a name="line-1301"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Integer_binop"><span class="hs-identifier hs-var">match_Integer_binop</span></a><span> </span><a href="#local-6989586621684814473"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1302"></a><span>          </span><a name="local-6989586621684814445"><a href="#local-6989586621684814445"><span class="hs-identifier">rule_divop_both</span></a></a><span> </span><a name="local-6989586621684814474"><a href="#local-6989586621684814474"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814475"><a href="#local-6989586621684814475"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814476"><a href="#local-6989586621684814476"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1303"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814474"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814475"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span>
</span><a name="line-1304"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Integer_divop_both"><span class="hs-identifier hs-var">match_Integer_divop_both</span></a><span> </span><a href="#local-6989586621684814476"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1305"></a><span>          </span><a name="local-6989586621684814446"><a href="#local-6989586621684814446"><span class="hs-identifier">rule_divop_one</span></a></a><span> </span><a name="local-6989586621684814477"><a href="#local-6989586621684814477"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814478"><a href="#local-6989586621684814478"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814479"><a href="#local-6989586621684814479"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1306"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814477"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814478"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span>
</span><a name="line-1307"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Integer_divop_one"><span class="hs-identifier hs-var">match_Integer_divop_one</span></a><span> </span><a href="#local-6989586621684814479"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1308"></a><span>          </span><a name="local-6989586621684814447"><a href="#local-6989586621684814447"><span class="hs-identifier">rule_shift_op</span></a></a><span> </span><a name="local-6989586621684814480"><a href="#local-6989586621684814480"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814481"><a href="#local-6989586621684814481"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814482"><a href="#local-6989586621684814482"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1309"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814480"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814481"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span>
</span><a name="line-1310"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Integer_shift_op"><span class="hs-identifier hs-var">match_Integer_shift_op</span></a><span> </span><a href="#local-6989586621684814482"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1311"></a><span>          </span><a name="local-6989586621684814448"><a href="#local-6989586621684814448"><span class="hs-identifier">rule_binop_Prim</span></a></a><span> </span><a name="local-6989586621684814483"><a href="#local-6989586621684814483"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814484"><a href="#local-6989586621684814484"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814485"><a href="#local-6989586621684814485"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1312"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814483"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814484"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span>
</span><a name="line-1313"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Integer_binop_Prim"><span class="hs-identifier hs-var">match_Integer_binop_Prim</span></a><span> </span><a href="#local-6989586621684814485"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1314"></a><span>          </span><a name="local-6989586621684814449"><a href="#local-6989586621684814449"><span class="hs-identifier">rule_binop_Ordering</span></a></a><span> </span><a name="local-6989586621684814486"><a href="#local-6989586621684814486"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814487"><a href="#local-6989586621684814487"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814488"><a href="#local-6989586621684814488"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1315"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814486"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814487"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span>
</span><a name="line-1316"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Integer_binop_Ordering"><span class="hs-identifier hs-var">match_Integer_binop_Ordering</span></a><span> </span><a href="#local-6989586621684814488"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1317"></a><span>          </span><a name="local-6989586621684814450"><a href="#local-6989586621684814450"><span class="hs-identifier">rule_encodeFloat</span></a></a><span> </span><a name="local-6989586621684814489"><a href="#local-6989586621684814489"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814490"><a href="#local-6989586621684814490"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814491"><a href="#local-6989586621684814491"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1318"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814489"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814490"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span>
</span><a name="line-1319"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Integer_Int_encodeFloat"><span class="hs-identifier hs-var">match_Integer_Int_encodeFloat</span></a><span> </span><a href="#local-6989586621684814491"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1320"></a><span>          </span><a name="local-6989586621684814451"><a href="#local-6989586621684814451"><span class="hs-identifier">rule_decodeDouble</span></a></a><span> </span><a name="local-6989586621684814492"><a href="#local-6989586621684814492"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814493"><a href="#local-6989586621684814493"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1321"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814492"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814493"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1322"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_decodeDouble"><span class="hs-identifier hs-var">match_decodeDouble</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1323"></a><span>          </span><a name="local-6989586621684814452"><a href="#local-6989586621684814452"><span class="hs-identifier">rule_XToIntegerToX</span></a></a><span> </span><a name="local-6989586621684814494"><a href="#local-6989586621684814494"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814495"><a href="#local-6989586621684814495"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814496"><a href="#local-6989586621684814496"><span class="hs-identifier">toIntegerName</span></a></a><span>
</span><a name="line-1324"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814494"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814495"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1325"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_XToIntegerToX"><span class="hs-identifier hs-var">match_XToIntegerToX</span></a><span> </span><a href="#local-6989586621684814496"><span class="hs-identifier hs-var">toIntegerName</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1326"></a><span>          </span><a name="local-6989586621684814453"><a href="#local-6989586621684814453"><span class="hs-identifier">rule_smallIntegerTo</span></a></a><span> </span><a name="local-6989586621684814497"><a href="#local-6989586621684814497"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814498"><a href="#local-6989586621684814498"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814499"><a href="#local-6989586621684814499"><span class="hs-identifier">primOp</span></a></a><span>
</span><a name="line-1327"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814497"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814498"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1328"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_smallIntegerTo"><span class="hs-identifier hs-var">match_smallIntegerTo</span></a><span> </span><a href="#local-6989586621684814499"><span class="hs-identifier hs-var">primOp</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1329"></a><span>          </span><a name="local-6989586621684814454"><a href="#local-6989586621684814454"><span class="hs-identifier">rule_rationalTo</span></a></a><span> </span><a name="local-6989586621684814500"><a href="#local-6989586621684814500"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814501"><a href="#local-6989586621684814501"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814502"><a href="#local-6989586621684814502"><span class="hs-identifier">mkLit</span></a></a><span>
</span><a name="line-1330"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814500"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814501"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span>
</span><a name="line-1331"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_rationalTo"><span class="hs-identifier hs-var">match_rationalTo</span></a><span> </span><a href="#local-6989586621684814502"><span class="hs-identifier hs-var">mkLit</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1332"></a><span>
</span><a name="line-1333"></a><span class="hs-identifier">builtinNaturalRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span class="hs-special">]</span><span>
</span><a name="line-1334"></a><a name="builtinNaturalRules"><a href="PrelRules.html#builtinNaturalRules"><span class="hs-identifier">builtinNaturalRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1335"></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684814503"><span class="hs-identifier hs-var">rule_binop</span></a><span>              </span><span class="hs-string">&quot;plusNatural&quot;</span><span>        </span><a href="PrelNames.html#plusNaturalName"><span class="hs-identifier hs-var">plusNaturalName</span></a><span>         </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span>
</span><a name="line-1336"></a><span> </span><span class="hs-special">,</span><a href="#local-6989586621684814504"><span class="hs-identifier hs-var">rule_partial_binop</span></a><span>      </span><span class="hs-string">&quot;minusNatural&quot;</span><span>       </span><a href="PrelNames.html#minusNaturalName"><span class="hs-identifier hs-var">minusNaturalName</span></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814520"><a href="#local-6989586621684814520"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621684814521"><a href="#local-6989586621684814521"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684814520"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621684814521"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814520"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684814521"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-1337"></a><span> </span><span class="hs-special">,</span><a href="#local-6989586621684814503"><span class="hs-identifier hs-var">rule_binop</span></a><span>              </span><span class="hs-string">&quot;timesNatural&quot;</span><span>       </span><a href="PrelNames.html#timesNaturalName"><span class="hs-identifier hs-var">timesNaturalName</span></a><span>        </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span>
</span><a name="line-1338"></a><span> </span><span class="hs-special">,</span><a href="#local-6989586621684814506"><span class="hs-identifier hs-var">rule_NaturalFromInteger</span></a><span> </span><span class="hs-string">&quot;naturalFromInteger&quot;</span><span> </span><a href="PrelNames.html#naturalFromIntegerName"><span class="hs-identifier hs-var">naturalFromIntegerName</span></a><span>
</span><a name="line-1339"></a><span> </span><span class="hs-special">,</span><a href="#local-6989586621684814505"><span class="hs-identifier hs-var">rule_NaturalToInteger</span></a><span>   </span><span class="hs-string">&quot;naturalToInteger&quot;</span><span>   </span><a href="PrelNames.html#naturalToIntegerName"><span class="hs-identifier hs-var">naturalToIntegerName</span></a><span>
</span><a name="line-1340"></a><span> </span><span class="hs-special">,</span><a href="#local-6989586621684814507"><span class="hs-identifier hs-var">rule_WordToNatural</span></a><span>      </span><span class="hs-string">&quot;wordToNatural&quot;</span><span>      </span><a href="PrelNames.html#wordToNaturalName"><span class="hs-identifier hs-var">wordToNaturalName</span></a><span>
</span><a name="line-1341"></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1342"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684814503"><a href="#local-6989586621684814503"><span class="hs-identifier">rule_binop</span></a></a><span> </span><a name="local-6989586621684814508"><a href="#local-6989586621684814508"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814509"><a href="#local-6989586621684814509"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814510"><a href="#local-6989586621684814510"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1343"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814508"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814509"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span>
</span><a name="line-1344"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Natural_binop"><span class="hs-identifier hs-var">match_Natural_binop</span></a><span> </span><a href="#local-6989586621684814510"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1345"></a><span>          </span><a name="local-6989586621684814504"><a href="#local-6989586621684814504"><span class="hs-identifier">rule_partial_binop</span></a></a><span> </span><a name="local-6989586621684814511"><a href="#local-6989586621684814511"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814512"><a href="#local-6989586621684814512"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684814513"><a href="#local-6989586621684814513"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1346"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814511"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814512"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-special">,</span><span>
</span><a name="line-1347"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_Natural_partial_binop"><span class="hs-identifier hs-var">match_Natural_partial_binop</span></a><span> </span><a href="#local-6989586621684814513"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1348"></a><span>          </span><a name="local-6989586621684814505"><a href="#local-6989586621684814505"><span class="hs-identifier">rule_NaturalToInteger</span></a></a><span> </span><a name="local-6989586621684814514"><a href="#local-6989586621684814514"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814515"><a href="#local-6989586621684814515"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1349"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814514"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814515"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1350"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_NaturalToInteger"><span class="hs-identifier hs-var">match_NaturalToInteger</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1351"></a><span>          </span><a name="local-6989586621684814506"><a href="#local-6989586621684814506"><span class="hs-identifier">rule_NaturalFromInteger</span></a></a><span> </span><a name="local-6989586621684814516"><a href="#local-6989586621684814516"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814517"><a href="#local-6989586621684814517"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1352"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814516"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814517"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1353"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_NaturalFromInteger"><span class="hs-identifier hs-var">match_NaturalFromInteger</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1354"></a><span>          </span><a name="local-6989586621684814507"><a href="#local-6989586621684814507"><span class="hs-identifier">rule_WordToNatural</span></a></a><span> </span><a name="local-6989586621684814518"><a href="#local-6989586621684814518"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684814519"><a href="#local-6989586621684814519"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1355"></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#BuiltinRule"><span class="hs-identifier hs-var">BuiltinRule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ru_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684814518"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814519"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ru_nargs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1356"></a><span>                           </span><span class="hs-identifier">ru_try</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_WordToNatural"><span class="hs-identifier hs-var">match_WordToNatural</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1357"></a><span>
</span><a name="line-1358"></a><span class="hs-comment">---------------------------------------------------</span><span>
</span><a name="line-1359"></a><span class="hs-comment">-- The rule is this:</span><span>
</span><a name="line-1360"></a><span class="hs-comment">--      unpackFoldrCString# &quot;foo&quot; c (unpackFoldrCString# &quot;baz&quot; c n)</span><span>
</span><a name="line-1361"></a><span class="hs-comment">--      =  unpackFoldrCString# &quot;foobaz&quot; c n</span><span>
</span><a name="line-1362"></a><span>
</span><a name="line-1363"></a><span class="hs-identifier">match_append_lit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1364"></a><a name="match_append_lit"><a href="PrelRules.html#match_append_lit"><span class="hs-identifier">match_append_lit</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814522"><a href="#local-6989586621684814522"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1365"></a><span>        </span><span class="hs-special">[</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621684814523"><a href="#local-6989586621684814523"><span class="hs-identifier">ty1</span></a></a><span>
</span><a name="line-1366"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814524"><a href="#local-6989586621684814524"><span class="hs-identifier">lit1</span></a></a><span>
</span><a name="line-1367"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814525"><a href="#local-6989586621684814525"><span class="hs-identifier">c1</span></a></a><span>
</span><a name="line-1368"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814526"><a href="#local-6989586621684814526"><span class="hs-identifier">unpk</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621684814527"><a href="#local-6989586621684814527"><span class="hs-identifier">ty2</span></a></a><span>
</span><a name="line-1369"></a><span>                   </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814528"><a href="#local-6989586621684814528"><span class="hs-identifier">lit2</span></a></a><span>
</span><a name="line-1370"></a><span>                   </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814529"><a href="#local-6989586621684814529"><span class="hs-identifier">c2</span></a></a><span>
</span><a name="line-1371"></a><span>                   </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814530"><a href="#local-6989586621684814530"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-1372"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-1373"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814526"><span class="hs-identifier hs-var">unpk</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#unpackCStringFoldrIdKey"><span class="hs-identifier hs-var">unpackCStringFoldrIdKey</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-1374"></a><span>    </span><a href="#local-6989586621684814525"><span class="hs-identifier hs-var">c1</span></a><span> </span><span class="hs-special">`</span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814529"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-1375"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitString"><span class="hs-identifier hs-var">LitString</span></a><span> </span><a name="local-6989586621684814531"><a href="#local-6989586621684814531"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814522"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814524"><span class="hs-identifier hs-var">lit1</span></a><span>
</span><a name="line-1376"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitString"><span class="hs-identifier hs-var">LitString</span></a><span> </span><a name="local-6989586621684814532"><a href="#local-6989586621684814532"><span class="hs-identifier">s2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814522"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814528"><span class="hs-identifier hs-var">lit2</span></a><span>
</span><a name="line-1377"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">eqType</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">ty2</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1378"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814526"><span class="hs-identifier hs-var">unpk</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684814523"><span class="hs-identifier hs-var">ty1</span></a><span>
</span><a name="line-1379"></a><span>                   </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitString"><span class="hs-identifier hs-var">LitString</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814531"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">BS.append</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814532"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1380"></a><span>                   </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814525"><span class="hs-identifier hs-var">c1</span></a><span>
</span><a name="line-1381"></a><span>                   </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814530"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1382"></a><span>
</span><a name="line-1383"></a><span class="hs-identifier">match_append_lit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1384"></a><span>
</span><a name="line-1385"></a><span class="hs-comment">---------------------------------------------------</span><span>
</span><a name="line-1386"></a><span class="hs-comment">-- The rule is this:</span><span>
</span><a name="line-1387"></a><span class="hs-comment">--      eqString (unpackCString# (Lit s1)) (unpackCString# (Lit s2)) = s1==s2</span><span>
</span><a name="line-1388"></a><span>
</span><a name="line-1389"></a><span class="hs-identifier">match_eq_string</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1390"></a><a name="match_eq_string"><a href="PrelRules.html#match_eq_string"><span class="hs-identifier">match_eq_string</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814533"><a href="#local-6989586621684814533"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1391"></a><span>        </span><span class="hs-special">[</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814534"><a href="#local-6989586621684814534"><span class="hs-identifier">unpk1</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814535"><a href="#local-6989586621684814535"><span class="hs-identifier">lit1</span></a></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814536"><a href="#local-6989586621684814536"><span class="hs-identifier">unpk2</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814537"><a href="#local-6989586621684814537"><span class="hs-identifier">lit2</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1392"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814534"><span class="hs-identifier hs-var">unpk1</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#unpackCStringIdKey"><span class="hs-identifier hs-var">unpackCStringIdKey</span></a><span>
</span><a name="line-1393"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814536"><span class="hs-identifier hs-var">unpk2</span></a><span> </span><span class="hs-special">`</span><a href="Unique.html#hasKey"><span class="hs-identifier hs-var">hasKey</span></a><span class="hs-special">`</span><span> </span><a href="PrelNames.html#unpackCStringIdKey"><span class="hs-identifier hs-var">unpackCStringIdKey</span></a><span>
</span><a name="line-1394"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitString"><span class="hs-identifier hs-var">LitString</span></a><span> </span><a name="local-6989586621684814538"><a href="#local-6989586621684814538"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814533"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814535"><span class="hs-identifier hs-var">lit1</span></a><span>
</span><a name="line-1395"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitString"><span class="hs-identifier hs-var">LitString</span></a><span> </span><a name="local-6989586621684814539"><a href="#local-6989586621684814539"><span class="hs-identifier">s2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814533"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814537"><span class="hs-identifier hs-var">lit2</span></a><span>
</span><a name="line-1396"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684814538"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814539"><span class="hs-identifier hs-var">s2</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PrelRules.html#trueValBool"><span class="hs-identifier hs-var">trueValBool</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PrelRules.html#falseValBool"><span class="hs-identifier hs-var">falseValBool</span></a><span class="hs-special">)</span><span>
</span><a name="line-1397"></a><span>
</span><a name="line-1398"></a><span class="hs-identifier">match_eq_string</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1399"></a><span>
</span><a name="line-1400"></a><span>
</span><a name="line-1401"></a><span class="hs-comment">---------------------------------------------------</span><span>
</span><a name="line-1402"></a><span class="hs-comment">-- The rule is this:</span><span>
</span><a name="line-1403"></a><span class="hs-comment">--      inline f_ty (f a b c) = &lt;f's unfolding&gt; a b c</span><span>
</span><a name="line-1404"></a><span class="hs-comment">-- (if f has an unfolding, EVEN if it's a loop breaker)</span><span>
</span><a name="line-1405"></a><span class="hs-comment">--</span><span>
</span><a name="line-1406"></a><span class="hs-comment">-- It's important to allow the argument to 'inline' to have args itself</span><span>
</span><a name="line-1407"></a><span class="hs-comment">-- (a) because its more forgiving to allow the programmer to write</span><span>
</span><a name="line-1408"></a><span class="hs-comment">--       inline f a b c</span><span>
</span><a name="line-1409"></a><span class="hs-comment">--   or  inline (f a b c)</span><span>
</span><a name="line-1410"></a><span class="hs-comment">-- (b) because a polymorphic f wll get a type argument that the</span><span>
</span><a name="line-1411"></a><span class="hs-comment">--     programmer can't avoid</span><span>
</span><a name="line-1412"></a><span class="hs-comment">--</span><span>
</span><a name="line-1413"></a><span class="hs-comment">-- Also, don't forget about 'inline's type argument!</span><span>
</span><a name="line-1414"></a><span class="hs-identifier">match_inline</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1415"></a><a name="match_inline"><a href="PrelRules.html#match_inline"><span class="hs-identifier">match_inline</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684814540"><a href="#local-6989586621684814540"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1416"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814541"><a href="#local-6989586621684814541"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814542"><a href="#local-6989586621684814542"><span class="hs-identifier">args1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreSyn.html#collectArgs"><span class="hs-identifier hs-var">collectArgs</span></a><span> </span><a href="#local-6989586621684814540"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span>
</span><a name="line-1417"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814543"><a href="#local-6989586621684814543"><span class="hs-identifier">unf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreSyn.html#maybeUnfoldingTemplate"><span class="hs-identifier hs-var">maybeUnfoldingTemplate</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#realIdUnfolding"><span class="hs-identifier hs-var">realIdUnfolding</span></a><span> </span><a href="#local-6989586621684814541"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-1418"></a><span>             </span><span class="hs-comment">-- Ignore the IdUnfoldingFun here!</span><span>
</span><a name="line-1419"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a><span> </span><a href="#local-6989586621684814543"><span class="hs-identifier hs-var">unf</span></a><span> </span><a href="#local-6989586621684814542"><span class="hs-identifier hs-var">args1</span></a><span class="hs-special">)</span><span>
</span><a name="line-1420"></a><span>
</span><a name="line-1421"></a><span class="hs-identifier">match_inline</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1422"></a><span>
</span><a name="line-1423"></a><span>
</span><a name="line-1424"></a><span class="hs-comment">-- See Note [magicDictId magic] in `basicTypes/MkId.hs`</span><span>
</span><a name="line-1425"></a><span class="hs-comment">-- for a description of what is going on here.</span><span>
</span><a name="line-1426"></a><span class="hs-identifier">match_magicDict</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1427"></a><a name="match_magicDict"><a href="PrelRules.html#match_magicDict"><span class="hs-identifier">match_magicDict</span></a></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814544"><a href="#local-6989586621684814544"><span class="hs-identifier">wrap</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621684814545"><a href="#local-6989586621684814545"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814546"><a href="#local-6989586621684814546"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814547"><a href="#local-6989586621684814547"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814548"><a href="#local-6989586621684814548"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1428"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684814549"><a href="#local-6989586621684814549"><span class="hs-identifier">fieldTy</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Type.html#dropForAlls"><span class="hs-identifier hs-var">dropForAlls</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814544"><span class="hs-identifier hs-var">wrap</span></a><span>
</span><a name="line-1429"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684814550"><a href="#local-6989586621684814550"><span class="hs-identifier">dictTy</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><a href="#local-6989586621684814549"><span class="hs-identifier hs-var">fieldTy</span></a><span>
</span><a name="line-1430"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814551"><a href="#local-6989586621684814551"><span class="hs-identifier">dictTc</span></a></a><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621684814550"><span class="hs-identifier hs-var">dictTy</span></a><span>
</span><a name="line-1431"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621684814552"><a href="#local-6989586621684814552"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#unwrapNewTyCon_maybe"><span class="hs-identifier hs-var">unwrapNewTyCon_maybe</span></a><span> </span><a href="#local-6989586621684814551"><span class="hs-identifier hs-var">dictTc</span></a><span>
</span><a name="line-1432"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span>
</span><a name="line-1433"></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814546"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Cast"><span class="hs-identifier hs-var">Cast</span></a><span> </span><a href="#local-6989586621684814547"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkSymCo"><span class="hs-identifier hs-var">mkSymCo</span></a><span> </span><span class="hs-special">(</span><a href="Coercion.html#mkUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkUnbranchedAxInstCo</span></a><span> </span><a href="CoAxiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a><span> </span><a href="#local-6989586621684814552"><span class="hs-identifier hs-var">co</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684814545"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1434"></a><span>      </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814548"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1435"></a><span>
</span><a name="line-1436"></a><span class="hs-identifier">match_magicDict</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1437"></a><span>
</span><a name="line-1438"></a><span class="hs-comment">-------------------------------------------------</span><span>
</span><a name="line-1439"></a><span class="hs-comment">-- Integer rules</span><span>
</span><a name="line-1440"></a><span class="hs-comment">--   smallInteger  (79::Int#)  = 79::Integer</span><span>
</span><a name="line-1441"></a><span class="hs-comment">--   wordToInteger (79::Word#) = 79::Integer</span><span>
</span><a name="line-1442"></a><span class="hs-comment">-- Similarly Int64, Word64</span><span>
</span><a name="line-1443"></a><span>
</span><a name="line-1444"></a><span class="hs-identifier">match_IntToInteger</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1445"></a><a name="match_IntToInteger"><a href="PrelRules.html#match_IntToInteger"><span class="hs-identifier">match_IntToInteger</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#match_IntToInteger_unop"><span class="hs-identifier hs-var">match_IntToInteger_unop</span></a><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-1446"></a><span>
</span><a name="line-1447"></a><span class="hs-identifier">match_WordToInteger</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1448"></a><a name="match_WordToInteger"><a href="PrelRules.html#match_WordToInteger"><span class="hs-identifier">match_WordToInteger</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814553"><a href="#local-6989586621684814553"><span class="hs-identifier">id_unf</span></a></a><span> </span><a name="local-6989586621684814554"><a href="#local-6989586621684814554"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684814555"><a href="#local-6989586621684814555"><span class="hs-identifier">xl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1449"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a><span> </span><a name="local-6989586621684814556"><a href="#local-6989586621684814556"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814553"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814555"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1450"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814554"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1451"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814557"><a href="#local-6989586621684814557"><span class="hs-identifier">integerTy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1452"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInteger"><span class="hs-identifier hs-var">mkLitInteger</span></a><span> </span><a href="#local-6989586621684814556"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684814557"><span class="hs-identifier hs-var">integerTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1453"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1454"></a><span>        </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;match_WordToInteger: Id has the wrong type&quot;</span><span>
</span><a name="line-1455"></a><span class="hs-identifier">match_WordToInteger</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1456"></a><span>
</span><a name="line-1457"></a><span class="hs-identifier">match_Int64ToInteger</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1458"></a><a name="match_Int64ToInteger"><a href="PrelRules.html#match_Int64ToInteger"><span class="hs-identifier">match_Int64ToInteger</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814558"><a href="#local-6989586621684814558"><span class="hs-identifier">id_unf</span></a></a><span> </span><a name="local-6989586621684814559"><a href="#local-6989586621684814559"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684814560"><a href="#local-6989586621684814560"><span class="hs-identifier">xl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1459"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt64"><span class="hs-identifier hs-var">LitNumInt64</span></a><span> </span><a name="local-6989586621684814561"><a href="#local-6989586621684814561"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814558"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814560"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1460"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814559"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1461"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814562"><a href="#local-6989586621684814562"><span class="hs-identifier">integerTy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1462"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInteger"><span class="hs-identifier hs-var">mkLitInteger</span></a><span> </span><a href="#local-6989586621684814561"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684814562"><span class="hs-identifier hs-var">integerTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1463"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1464"></a><span>        </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;match_Int64ToInteger: Id has the wrong type&quot;</span><span>
</span><a name="line-1465"></a><span class="hs-identifier">match_Int64ToInteger</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1466"></a><span>
</span><a name="line-1467"></a><span class="hs-identifier">match_Word64ToInteger</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1468"></a><a name="match_Word64ToInteger"><a href="PrelRules.html#match_Word64ToInteger"><span class="hs-identifier">match_Word64ToInteger</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814563"><a href="#local-6989586621684814563"><span class="hs-identifier">id_unf</span></a></a><span> </span><a name="local-6989586621684814564"><a href="#local-6989586621684814564"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684814565"><a href="#local-6989586621684814565"><span class="hs-identifier">xl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1469"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumWord64"><span class="hs-identifier hs-var">LitNumWord64</span></a><span> </span><a name="local-6989586621684814566"><a href="#local-6989586621684814566"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814563"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814565"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1470"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814564"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1471"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814567"><a href="#local-6989586621684814567"><span class="hs-identifier">integerTy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1472"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInteger"><span class="hs-identifier hs-var">mkLitInteger</span></a><span> </span><a href="#local-6989586621684814566"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684814567"><span class="hs-identifier hs-var">integerTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1473"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1474"></a><span>        </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;match_Word64ToInteger: Id has the wrong type&quot;</span><span>
</span><a name="line-1475"></a><span class="hs-identifier">match_Word64ToInteger</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1476"></a><span>
</span><a name="line-1477"></a><span class="hs-identifier">match_NaturalToInteger</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1478"></a><a name="match_NaturalToInteger"><a href="PrelRules.html#match_NaturalToInteger"><span class="hs-identifier">match_NaturalToInteger</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814568"><a href="#local-6989586621684814568"><span class="hs-identifier">id_unf</span></a></a><span> </span><a name="local-6989586621684814569"><a href="#local-6989586621684814569"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684814570"><a href="#local-6989586621684814570"><span class="hs-identifier">xl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1479"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumNatural"><span class="hs-identifier hs-var">LitNumNatural</span></a><span> </span><a name="local-6989586621684814571"><a href="#local-6989586621684814571"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814568"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814570"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1480"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814569"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1481"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814572"><a href="#local-6989586621684814572"><span class="hs-identifier">naturalTy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1482"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a href="#local-6989586621684814571"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684814572"><span class="hs-identifier hs-var">naturalTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1483"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1484"></a><span>        </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;match_NaturalToInteger: Id has the wrong type&quot;</span><span>
</span><a name="line-1485"></a><span class="hs-identifier">match_NaturalToInteger</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1486"></a><span>
</span><a name="line-1487"></a><span class="hs-identifier">match_NaturalFromInteger</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1488"></a><a name="match_NaturalFromInteger"><a href="PrelRules.html#match_NaturalFromInteger"><span class="hs-identifier">match_NaturalFromInteger</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814573"><a href="#local-6989586621684814573"><span class="hs-identifier">id_unf</span></a></a><span> </span><a name="local-6989586621684814574"><a href="#local-6989586621684814574"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684814575"><a href="#local-6989586621684814575"><span class="hs-identifier">xl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1489"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814576"><a href="#local-6989586621684814576"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814573"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814575"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1490"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814576"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1491"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814574"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1492"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814577"><a href="#local-6989586621684814577"><span class="hs-identifier">naturalTy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1493"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumNatural"><span class="hs-identifier hs-var">LitNumNatural</span></a><span> </span><a href="#local-6989586621684814576"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684814577"><span class="hs-identifier hs-var">naturalTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1494"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1495"></a><span>        </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;match_NaturalFromInteger: Id has the wrong type&quot;</span><span>
</span><a name="line-1496"></a><span class="hs-identifier">match_NaturalFromInteger</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1497"></a><span>
</span><a name="line-1498"></a><span class="hs-identifier">match_WordToNatural</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1499"></a><a name="match_WordToNatural"><a href="PrelRules.html#match_WordToNatural"><span class="hs-identifier">match_WordToNatural</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814578"><a href="#local-6989586621684814578"><span class="hs-identifier">id_unf</span></a></a><span> </span><a name="local-6989586621684814579"><a href="#local-6989586621684814579"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684814580"><a href="#local-6989586621684814580"><span class="hs-identifier">xl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1500"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumWord"><span class="hs-identifier hs-var">LitNumWord</span></a><span> </span><a name="local-6989586621684814581"><a href="#local-6989586621684814581"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814578"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814580"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1501"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814579"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1502"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814582"><a href="#local-6989586621684814582"><span class="hs-identifier">naturalTy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1503"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumNatural"><span class="hs-identifier hs-var">LitNumNatural</span></a><span> </span><a href="#local-6989586621684814581"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684814582"><span class="hs-identifier hs-var">naturalTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1504"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1505"></a><span>        </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;match_WordToNatural: Id has the wrong type&quot;</span><span>
</span><a name="line-1506"></a><span class="hs-identifier">match_WordToNatural</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1507"></a><span>
</span><a name="line-1508"></a><span class="hs-comment">-------------------------------------------------</span><span>
</span><a name="line-1509"></a><span class="hs-comment">{- Note [Rewriting bitInteger]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For most types the bitInteger operation can be implemented in terms of shifts.
The integer-gmp package, however, can do substantially better than this if
allowed to provide its own implementation. However, in so doing it previously lost
constant-folding (see Trac #8832). The bitInteger rule above provides constant folding
specifically for this function.

There is, however, a bit of trickiness here when it comes to ranges. While the
AST encodes all integers as Integers, `bit` expects the bit
index to be given as an Int. Hence we coerce to an Int in the rule definition.
This will behave a bit funny for constants larger than the word size, but the user
should expect some funniness given that they will have at very least ignored a
warning in this case.
-}</span><span>
</span><a name="line-1524"></a><span>
</span><a name="line-1525"></a><span class="hs-identifier">match_bitInteger</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1526"></a><span class="hs-comment">-- Just for GHC.Integer.Type.bitInteger :: Int# -&gt; Integer</span><span>
</span><a name="line-1527"></a><a name="match_bitInteger"><a href="PrelRules.html#match_bitInteger"><span class="hs-identifier">match_bitInteger</span></a></a><span> </span><a name="local-6989586621684814583"><a href="#local-6989586621684814583"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814584"><a href="#local-6989586621684814584"><span class="hs-identifier">id_unf</span></a></a><span> </span><a name="local-6989586621684814585"><a href="#local-6989586621684814585"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684814586"><a href="#local-6989586621684814586"><span class="hs-identifier">arg</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1528"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814587"><a href="#local-6989586621684814587"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814584"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814586"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1529"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814587"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1530"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814587"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-special">(</span><a href="PrelRules.html#wordSizeInBits"><span class="hs-identifier hs-var">wordSizeInBits</span></a><span> </span><a href="#local-6989586621684814583"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1531"></a><span>    </span><span class="hs-comment">-- Make sure x is small enough to yield a decently small iteger</span><span>
</span><a name="line-1532"></a><span>    </span><span class="hs-comment">-- Attempting to construct the Integer for</span><span>
</span><a name="line-1533"></a><span>    </span><span class="hs-comment">--    (bitInteger 9223372036854775807#)</span><span>
</span><a name="line-1534"></a><span>    </span><span class="hs-comment">-- would be a bad idea (Trac #14959)</span><span>
</span><a name="line-1535"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684814588"><a href="#local-6989586621684814588"><span class="hs-identifier">x_int</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684814587"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-1536"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814585"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1537"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814589"><a href="#local-6989586621684814589"><span class="hs-identifier">integerTy</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1538"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">bit</span><span> </span><a href="#local-6989586621684814588"><span class="hs-identifier hs-var">x_int</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814589"><span class="hs-identifier hs-var">integerTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1539"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;match_IntToInteger_unop: Id has the wrong type&quot;</span><span>
</span><a name="line-1540"></a><span>
</span><a name="line-1541"></a><span class="hs-identifier">match_bitInteger</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1542"></a><span>
</span><a name="line-1543"></a><span>
</span><a name="line-1544"></a><span class="hs-comment">-------------------------------------------------</span><span>
</span><a name="line-1545"></a><span class="hs-identifier">match_Integer_convert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621684814054"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1546"></a><span>                      </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814054"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1547"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1548"></a><a name="match_Integer_convert"><a href="PrelRules.html#match_Integer_convert"><span class="hs-identifier">match_Integer_convert</span></a></a><span> </span><a name="local-6989586621684814590"><a href="#local-6989586621684814590"><span class="hs-identifier">convert</span></a></a><span> </span><a name="local-6989586621684814591"><a href="#local-6989586621684814591"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814592"><a href="#local-6989586621684814592"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814593"><a href="#local-6989586621684814593"><span class="hs-identifier">xl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1549"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814594"><a href="#local-6989586621684814594"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814592"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814593"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1550"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814590"><span class="hs-identifier hs-var">convert</span></a><span> </span><a href="#local-6989586621684814591"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814594"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1551"></a><span class="hs-identifier">match_Integer_convert</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1552"></a><span>
</span><a name="line-1553"></a><span class="hs-identifier">match_Integer_unop</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1554"></a><a name="match_Integer_unop"><a href="PrelRules.html#match_Integer_unop"><span class="hs-identifier">match_Integer_unop</span></a></a><span> </span><a name="local-6989586621684814595"><a href="#local-6989586621684814595"><span class="hs-identifier">unop</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814596"><a href="#local-6989586621684814596"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814597"><a href="#local-6989586621684814597"><span class="hs-identifier">xl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1555"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814598"><a href="#local-6989586621684814598"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814599"><a href="#local-6989586621684814599"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814596"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814597"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1556"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814595"><span class="hs-identifier hs-var">unop</span></a><span> </span><a href="#local-6989586621684814598"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814599"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1557"></a><span class="hs-identifier">match_Integer_unop</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1558"></a><span>
</span><a name="line-1559"></a><span class="hs-identifier">match_IntToInteger_unop</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1560"></a><a name="match_IntToInteger_unop"><a href="PrelRules.html#match_IntToInteger_unop"><span class="hs-identifier">match_IntToInteger_unop</span></a></a><span> </span><a name="local-6989586621684814600"><a href="#local-6989586621684814600"><span class="hs-identifier">unop</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814601"><a href="#local-6989586621684814601"><span class="hs-identifier">id_unf</span></a></a><span> </span><a name="local-6989586621684814602"><a href="#local-6989586621684814602"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684814603"><a href="#local-6989586621684814603"><span class="hs-identifier">xl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1561"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814604"><a href="#local-6989586621684814604"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814601"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814603"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1562"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814602"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1563"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814605"><a href="#local-6989586621684814605"><span class="hs-identifier">integerTy</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1564"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814600"><span class="hs-identifier hs-var">unop</span></a><span> </span><a href="#local-6989586621684814604"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814605"><span class="hs-identifier hs-var">integerTy</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1565"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1566"></a><span>        </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;match_IntToInteger_unop: Id has the wrong type&quot;</span><span>
</span><a name="line-1567"></a><span class="hs-identifier">match_IntToInteger_unop</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1568"></a><span>
</span><a name="line-1569"></a><span class="hs-identifier">match_Integer_binop</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1570"></a><a name="match_Integer_binop"><a href="PrelRules.html#match_Integer_binop"><span class="hs-identifier">match_Integer_binop</span></a></a><span> </span><a name="local-6989586621684814606"><a href="#local-6989586621684814606"><span class="hs-identifier">binop</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814607"><a href="#local-6989586621684814607"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814608"><a href="#local-6989586621684814608"><span class="hs-identifier">xl</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814609"><a href="#local-6989586621684814609"><span class="hs-identifier">yl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1571"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814610"><a href="#local-6989586621684814610"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814611"><a href="#local-6989586621684814611"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814607"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814608"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1572"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814612"><a href="#local-6989586621684814612"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814607"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814609"><span class="hs-identifier hs-var">yl</span></a><span>
</span><a name="line-1573"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInteger"><span class="hs-identifier hs-var">mkLitInteger</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814610"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814606"><span class="hs-identifier hs-var">binop</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814612"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814611"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1574"></a><span class="hs-identifier">match_Integer_binop</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1575"></a><span>
</span><a name="line-1576"></a><span class="hs-identifier">match_Natural_binop</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1577"></a><a name="match_Natural_binop"><a href="PrelRules.html#match_Natural_binop"><span class="hs-identifier">match_Natural_binop</span></a></a><span> </span><a name="local-6989586621684814613"><a href="#local-6989586621684814613"><span class="hs-identifier">binop</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814614"><a href="#local-6989586621684814614"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814615"><a href="#local-6989586621684814615"><span class="hs-identifier">xl</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814616"><a href="#local-6989586621684814616"><span class="hs-identifier">yl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1578"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumNatural"><span class="hs-identifier hs-var">LitNumNatural</span></a><span> </span><a name="local-6989586621684814617"><a href="#local-6989586621684814617"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814618"><a href="#local-6989586621684814618"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814614"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814615"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1579"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumNatural"><span class="hs-identifier hs-var">LitNumNatural</span></a><span> </span><a name="local-6989586621684814619"><a href="#local-6989586621684814619"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814614"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814616"><span class="hs-identifier hs-var">yl</span></a><span>
</span><a name="line-1580"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitNatural"><span class="hs-identifier hs-var">mkLitNatural</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814617"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814613"><span class="hs-identifier hs-var">binop</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814619"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814618"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1581"></a><span class="hs-identifier">match_Natural_binop</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1582"></a><span>
</span><a name="line-1583"></a><span class="hs-identifier">match_Natural_partial_binop</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1584"></a><a name="match_Natural_partial_binop"><a href="PrelRules.html#match_Natural_partial_binop"><span class="hs-identifier">match_Natural_partial_binop</span></a></a><span> </span><a name="local-6989586621684814620"><a href="#local-6989586621684814620"><span class="hs-identifier">binop</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814621"><a href="#local-6989586621684814621"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814622"><a href="#local-6989586621684814622"><span class="hs-identifier">xl</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814623"><a href="#local-6989586621684814623"><span class="hs-identifier">yl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1585"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumNatural"><span class="hs-identifier hs-var">LitNumNatural</span></a><span> </span><a name="local-6989586621684814624"><a href="#local-6989586621684814624"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814625"><a href="#local-6989586621684814625"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814621"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814622"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1586"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumNatural"><span class="hs-identifier hs-var">LitNumNatural</span></a><span> </span><a name="local-6989586621684814626"><a href="#local-6989586621684814626"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814621"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814623"><span class="hs-identifier hs-var">yl</span></a><span>
</span><a name="line-1587"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814627"><a href="#local-6989586621684814627"><span class="hs-identifier">z</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684814624"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814620"><span class="hs-identifier hs-var">binop</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814626"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1588"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitNatural"><span class="hs-identifier hs-var">mkLitNatural</span></a><span> </span><a href="#local-6989586621684814627"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="#local-6989586621684814625"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1589"></a><span class="hs-identifier">match_Natural_partial_binop</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1590"></a><span>
</span><a name="line-1591"></a><span class="hs-comment">-- This helper is used for the quotRem and divMod functions</span><span>
</span><a name="line-1592"></a><span class="hs-identifier">match_Integer_divop_both</span><span>
</span><a name="line-1593"></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1594"></a><a name="match_Integer_divop_both"><a href="PrelRules.html#match_Integer_divop_both"><span class="hs-identifier">match_Integer_divop_both</span></a></a><span> </span><a name="local-6989586621684814628"><a href="#local-6989586621684814628"><span class="hs-identifier">divop</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814629"><a href="#local-6989586621684814629"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814630"><a href="#local-6989586621684814630"><span class="hs-identifier">xl</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814631"><a href="#local-6989586621684814631"><span class="hs-identifier">yl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1595"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814632"><a href="#local-6989586621684814632"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814633"><a href="#local-6989586621684814633"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814629"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814630"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1596"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814634"><a href="#local-6989586621684814634"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814629"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814631"><span class="hs-identifier hs-var">yl</span></a><span>
</span><a name="line-1597"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814634"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1598"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684814635"><a href="#local-6989586621684814635"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814636"><a href="#local-6989586621684814636"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684814632"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814628"><span class="hs-identifier hs-var">divop</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814634"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1599"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier hs-var">mkCoreUbxTup</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684814633"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">,</span><a href="#local-6989586621684814633"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInteger"><span class="hs-identifier hs-var">mkLitInteger</span></a><span> </span><a href="#local-6989586621684814635"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621684814633"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInteger"><span class="hs-identifier hs-var">mkLitInteger</span></a><span> </span><a href="#local-6989586621684814636"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621684814633"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1600"></a><span class="hs-identifier">match_Integer_divop_both</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1601"></a><span>
</span><a name="line-1602"></a><span class="hs-comment">-- This helper is used for the quot and rem functions</span><span>
</span><a name="line-1603"></a><span class="hs-identifier">match_Integer_divop_one</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1604"></a><a name="match_Integer_divop_one"><a href="PrelRules.html#match_Integer_divop_one"><span class="hs-identifier">match_Integer_divop_one</span></a></a><span> </span><a name="local-6989586621684814637"><a href="#local-6989586621684814637"><span class="hs-identifier">divop</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814638"><a href="#local-6989586621684814638"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814639"><a href="#local-6989586621684814639"><span class="hs-identifier">xl</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814640"><a href="#local-6989586621684814640"><span class="hs-identifier">yl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1605"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814641"><a href="#local-6989586621684814641"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814642"><a href="#local-6989586621684814642"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814638"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814639"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1606"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814643"><a href="#local-6989586621684814643"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814638"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814640"><span class="hs-identifier hs-var">yl</span></a><span>
</span><a name="line-1607"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814643"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1608"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInteger"><span class="hs-identifier hs-var">mkLitInteger</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814641"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814637"><span class="hs-identifier hs-var">divop</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814643"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814642"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1609"></a><span class="hs-identifier">match_Integer_divop_one</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1610"></a><span>
</span><a name="line-1611"></a><span class="hs-identifier">match_Integer_shift_op</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1612"></a><span class="hs-comment">-- Used for shiftLInteger, shiftRInteger :: Integer -&gt; Int# -&gt; Integer</span><span>
</span><a name="line-1613"></a><span class="hs-comment">-- See Note [Guarding against silly shifts]</span><span>
</span><a name="line-1614"></a><a name="match_Integer_shift_op"><a href="PrelRules.html#match_Integer_shift_op"><span class="hs-identifier">match_Integer_shift_op</span></a></a><span> </span><a name="local-6989586621684814644"><a href="#local-6989586621684814644"><span class="hs-identifier">binop</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814645"><a href="#local-6989586621684814645"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814646"><a href="#local-6989586621684814646"><span class="hs-identifier">xl</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814647"><a href="#local-6989586621684814647"><span class="hs-identifier">yl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1615"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814648"><a href="#local-6989586621684814648"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814649"><a href="#local-6989586621684814649"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814645"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814646"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1616"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814650"><a href="#local-6989586621684814650"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814645"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814647"><span class="hs-identifier hs-var">yl</span></a><span>
</span><a name="line-1617"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814650"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1618"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814650"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">4</span><span>   </span><span class="hs-comment">-- Restrict constant-folding of shifts on Integers, somewhat</span><span>
</span><a name="line-1619"></a><span>             </span><span class="hs-comment">-- arbitrary.  We can get huge shifts in inaccessible code</span><span>
</span><a name="line-1620"></a><span>             </span><span class="hs-comment">-- (Trac #15673)</span><span>
</span><a name="line-1621"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInteger"><span class="hs-identifier hs-var">mkLitInteger</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814648"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814644"><span class="hs-identifier hs-var">binop</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684814650"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814649"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1622"></a><span class="hs-identifier">match_Integer_shift_op</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1623"></a><span>
</span><a name="line-1624"></a><span class="hs-identifier">match_Integer_binop_Prim</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1625"></a><a name="match_Integer_binop_Prim"><a href="PrelRules.html#match_Integer_binop_Prim"><span class="hs-identifier">match_Integer_binop_Prim</span></a></a><span> </span><a name="local-6989586621684814651"><a href="#local-6989586621684814651"><span class="hs-identifier">binop</span></a></a><span> </span><a name="local-6989586621684814652"><a href="#local-6989586621684814652"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814653"><a href="#local-6989586621684814653"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814654"><a href="#local-6989586621684814654"><span class="hs-identifier">xl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814655"><a href="#local-6989586621684814655"><span class="hs-identifier">yl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1626"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814656"><a href="#local-6989586621684814656"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814653"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814654"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1627"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814657"><a href="#local-6989586621684814657"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814653"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814655"><span class="hs-identifier hs-var">yl</span></a><span>
</span><a name="line-1628"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684814656"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814651"><span class="hs-identifier hs-var">binop</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814657"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="PrelRules.html#trueValInt"><span class="hs-identifier hs-var">trueValInt</span></a><span> </span><a href="#local-6989586621684814652"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="PrelRules.html#falseValInt"><span class="hs-identifier hs-var">falseValInt</span></a><span> </span><a href="#local-6989586621684814652"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1629"></a><span class="hs-identifier">match_Integer_binop_Prim</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1630"></a><span>
</span><a name="line-1631"></a><span class="hs-identifier">match_Integer_binop_Ordering</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1632"></a><a name="match_Integer_binop_Ordering"><a href="PrelRules.html#match_Integer_binop_Ordering"><span class="hs-identifier">match_Integer_binop_Ordering</span></a></a><span> </span><a name="local-6989586621684814658"><a href="#local-6989586621684814658"><span class="hs-identifier">binop</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814659"><a href="#local-6989586621684814659"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814660"><a href="#local-6989586621684814660"><span class="hs-identifier">xl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814661"><a href="#local-6989586621684814661"><span class="hs-identifier">yl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1633"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814662"><a href="#local-6989586621684814662"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814659"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814660"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1634"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814663"><a href="#local-6989586621684814663"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814659"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814661"><span class="hs-identifier hs-var">yl</span></a><span>
</span><a name="line-1635"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684814662"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814658"><span class="hs-identifier hs-var">binop</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814663"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1636"></a><span>             </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#ltVal"><span class="hs-identifier hs-var">ltVal</span></a><span>
</span><a name="line-1637"></a><span>             </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#eqVal"><span class="hs-identifier hs-var">eqVal</span></a><span>
</span><a name="line-1638"></a><span>             </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#gtVal"><span class="hs-identifier hs-var">gtVal</span></a><span>
</span><a name="line-1639"></a><span class="hs-identifier">match_Integer_binop_Ordering</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1640"></a><span>
</span><a name="line-1641"></a><span class="hs-identifier">match_Integer_Int_encodeFloat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RealFloat</span><span> </span><a href="#local-6989586621684814053"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1642"></a><span>                              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814053"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1643"></a><span>                              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1644"></a><a name="match_Integer_Int_encodeFloat"><a href="PrelRules.html#match_Integer_Int_encodeFloat"><span class="hs-identifier">match_Integer_Int_encodeFloat</span></a></a><span> </span><a name="local-6989586621684814664"><a href="#local-6989586621684814664"><span class="hs-identifier">mkLit</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814665"><a href="#local-6989586621684814665"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814666"><a href="#local-6989586621684814666"><span class="hs-identifier">xl</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814667"><a href="#local-6989586621684814667"><span class="hs-identifier">yl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1645"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814668"><a href="#local-6989586621684814668"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814665"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814666"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1646"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814669"><a href="#local-6989586621684814669"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814665"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814667"><span class="hs-identifier hs-var">yl</span></a><span>
</span><a name="line-1647"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814664"><span class="hs-identifier hs-var">mkLit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">encodeFloat</span><span> </span><a href="#local-6989586621684814668"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814669"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1648"></a><span class="hs-identifier">match_Integer_Int_encodeFloat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1649"></a><span>
</span><a name="line-1650"></a><span class="hs-comment">---------------------------------------------------</span><span>
</span><a name="line-1651"></a><span class="hs-comment">-- constant folding for Float/Double</span><span>
</span><a name="line-1652"></a><span class="hs-comment">--</span><span>
</span><a name="line-1653"></a><span class="hs-comment">-- This turns</span><span>
</span><a name="line-1654"></a><span class="hs-comment">--      rationalToFloat n d</span><span>
</span><a name="line-1655"></a><span class="hs-comment">-- into a literal Float, and similarly for Doubles.</span><span>
</span><a name="line-1656"></a><span class="hs-comment">--</span><span>
</span><a name="line-1657"></a><span class="hs-comment">-- it's important to not match d == 0, because that may represent a</span><span>
</span><a name="line-1658"></a><span class="hs-comment">-- literal &quot;0/0&quot; or similar, and we can't produce a literal value for</span><span>
</span><a name="line-1659"></a><span class="hs-comment">-- NaN or +-Inf</span><span>
</span><a name="line-1660"></a><span class="hs-identifier">match_rationalTo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RealFloat</span><span> </span><a href="#local-6989586621684814052"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1661"></a><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814052"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1662"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1663"></a><a name="match_rationalTo"><a href="PrelRules.html#match_rationalTo"><span class="hs-identifier">match_rationalTo</span></a></a><span> </span><a name="local-6989586621684814670"><a href="#local-6989586621684814670"><span class="hs-identifier">mkLit</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814671"><a href="#local-6989586621684814671"><span class="hs-identifier">id_unf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814672"><a href="#local-6989586621684814672"><span class="hs-identifier">xl</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814673"><a href="#local-6989586621684814673"><span class="hs-identifier">yl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1664"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814674"><a href="#local-6989586621684814674"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814671"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814672"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1665"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInteger"><span class="hs-identifier hs-var">LitNumInteger</span></a><span> </span><a name="local-6989586621684814675"><a href="#local-6989586621684814675"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814671"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814673"><span class="hs-identifier hs-var">yl</span></a><span>
</span><a name="line-1666"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814675"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1667"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814670"><span class="hs-identifier hs-var">mkLit</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromRational</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814674"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">%</span><span> </span><a href="#local-6989586621684814675"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1668"></a><span class="hs-identifier">match_rationalTo</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1669"></a><span>
</span><a name="line-1670"></a><span class="hs-identifier">match_decodeDouble</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1671"></a><a name="match_decodeDouble"><a href="PrelRules.html#match_decodeDouble"><span class="hs-identifier">match_decodeDouble</span></a></a><span> </span><a name="local-6989586621684814676"><a href="#local-6989586621684814676"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814677"><a href="#local-6989586621684814677"><span class="hs-identifier">id_unf</span></a></a><span> </span><a name="local-6989586621684814678"><a href="#local-6989586621684814678"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684814679"><a href="#local-6989586621684814679"><span class="hs-identifier">xl</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1672"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Literal.html#LitDouble"><span class="hs-identifier hs-var">LitDouble</span></a><span> </span><a name="local-6989586621684814680"><a href="#local-6989586621684814680"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreOpt.html#exprIsLiteral_maybe"><span class="hs-identifier hs-var">exprIsLiteral_maybe</span></a><span> </span><a href="#local-6989586621684814677"><span class="hs-identifier hs-var">id_unf</span></a><span> </span><a href="#local-6989586621684814679"><span class="hs-identifier hs-var">xl</span></a><span>
</span><a name="line-1673"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitFunTy_maybe"><span class="hs-identifier hs-var">splitFunTy_maybe</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814678"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1674"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684814681"><a href="#local-6989586621684814681"><span class="hs-identifier">res</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1675"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684814682"><a href="#local-6989586621684814682"><span class="hs-identifier">_lev1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814683"><a href="#local-6989586621684814683"><span class="hs-identifier">_lev2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814684"><a href="#local-6989586621684814684"><span class="hs-identifier">integerTy</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814685"><a href="#local-6989586621684814685"><span class="hs-identifier">intHashTy</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tyConAppArgs_maybe"><span class="hs-identifier hs-var">tyConAppArgs_maybe</span></a><span> </span><a href="#local-6989586621684814681"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-1676"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">decodeFloat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromRational</span><span> </span><a href="#local-6989586621684814680"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1677"></a><span>           </span><span class="hs-special">(</span><a name="local-6989586621684814686"><a href="#local-6989586621684814686"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684814687"><a href="#local-6989586621684814687"><span class="hs-identifier">z</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1678"></a><span>             </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier hs-var">mkCoreUbxTup</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684814684"><span class="hs-identifier hs-var">integerTy</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814685"><span class="hs-identifier hs-var">intHashTy</span></a><span class="hs-special">]</span><span>
</span><a name="line-1679"></a><span>                                 </span><span class="hs-special">[</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInteger"><span class="hs-identifier hs-var">mkLitInteger</span></a><span> </span><a href="#local-6989586621684814686"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684814684"><span class="hs-identifier hs-var">integerTy</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1680"></a><span>                                  </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInt"><span class="hs-identifier hs-var">mkLitInt</span></a><span> </span><a href="#local-6989586621684814676"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toInteger</span><span> </span><a href="#local-6989586621684814687"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1681"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1682"></a><span>        </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;match_decodeDouble: Id has the wrong type&quot;</span><span>
</span><a name="line-1683"></a><span>          </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684814678"><span class="hs-identifier hs-var">fn</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684814678"><span class="hs-identifier hs-var">fn</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1684"></a><span class="hs-identifier">match_decodeDouble</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1685"></a><span>
</span><a name="line-1686"></a><span class="hs-identifier">match_XToIntegerToX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1687"></a><a name="match_XToIntegerToX"><a href="PrelRules.html#match_XToIntegerToX"><span class="hs-identifier">match_XToIntegerToX</span></a></a><span> </span><a name="local-6989586621684814688"><a href="#local-6989586621684814688"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814689"><a href="#local-6989586621684814689"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684814690"><a href="#local-6989586621684814690"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1688"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-6989586621684814689"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684814688"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1689"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684814690"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1690"></a><span class="hs-identifier">match_XToIntegerToX</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1691"></a><span>
</span><a name="line-1692"></a><span class="hs-identifier">match_smallIntegerTo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#RuleFun"><span class="hs-identifier hs-type">RuleFun</span></a><span>
</span><a name="line-1693"></a><a name="match_smallIntegerTo"><a href="PrelRules.html#match_smallIntegerTo"><span class="hs-identifier">match_smallIntegerTo</span></a></a><span> </span><a name="local-6989586621684814691"><a href="#local-6989586621684814691"><span class="hs-identifier">primOp</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814692"><a href="#local-6989586621684814692"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684814693"><a href="#local-6989586621684814693"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1694"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-6989586621684814692"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="PrelNames.html#smallIntegerName"><span class="hs-identifier hs-var">smallIntegerName</span></a><span>
</span><a name="line-1695"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkPrimOpId"><span class="hs-identifier hs-var">mkPrimOpId</span></a><span> </span><a href="#local-6989586621684814691"><span class="hs-identifier hs-var">primOp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814693"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1696"></a><span class="hs-identifier">match_smallIntegerTo</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1697"></a><span>
</span><a name="line-1698"></a><span>
</span><a name="line-1699"></a><span>
</span><a name="line-1700"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-1701"></a><span class="hs-comment">-- Note [Constant folding through nested expressions]</span><span>
</span><a name="line-1702"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-1703"></a><span class="hs-comment">--</span><span>
</span><a name="line-1704"></a><span class="hs-comment">-- We use rewrites rules to perform constant folding. It means that we don't</span><span>
</span><a name="line-1705"></a><span class="hs-comment">-- have a global view of the expression we are trying to optimise. As a</span><span>
</span><a name="line-1706"></a><span class="hs-comment">-- consequence we only perform local (small-step) transformations that either:</span><span>
</span><a name="line-1707"></a><span class="hs-comment">--    1) reduce the number of operations</span><span>
</span><a name="line-1708"></a><span class="hs-comment">--    2) rearrange the expression to increase the odds that other rules will</span><span>
</span><a name="line-1709"></a><span class="hs-comment">--    match</span><span>
</span><a name="line-1710"></a><span class="hs-comment">--</span><span>
</span><a name="line-1711"></a><span class="hs-comment">-- We don't try to handle more complex expression optimisation cases that would</span><span>
</span><a name="line-1712"></a><span class="hs-comment">-- require a global view. For example, rewriting expressions to increase</span><span>
</span><a name="line-1713"></a><span class="hs-comment">-- sharing (e.g., Horner's method); optimisations that require local</span><span>
</span><a name="line-1714"></a><span class="hs-comment">-- transformations increasing the number of operations; rearrangements to</span><span>
</span><a name="line-1715"></a><span class="hs-comment">-- cancel/factorize terms (e.g., (a+b-a-b) isn't rearranged to reduce to 0).</span><span>
</span><a name="line-1716"></a><span class="hs-comment">--</span><span>
</span><a name="line-1717"></a><span class="hs-comment">-- We already have rules to perform constant folding on expressions with the</span><span>
</span><a name="line-1718"></a><span class="hs-comment">-- following shape (where a and/or b are literals):</span><span>
</span><a name="line-1719"></a><span class="hs-comment">--</span><span>
</span><a name="line-1720"></a><span class="hs-comment">--          D)    op</span><span>
</span><a name="line-1721"></a><span class="hs-comment">--                /\</span><span>
</span><a name="line-1722"></a><span class="hs-comment">--               /  \</span><span>
</span><a name="line-1723"></a><span class="hs-comment">--              /    \</span><span>
</span><a name="line-1724"></a><span class="hs-comment">--             a      b</span><span>
</span><a name="line-1725"></a><span class="hs-comment">--</span><span>
</span><a name="line-1726"></a><span class="hs-comment">-- To support nested expressions, we match three other shapes of expression</span><span>
</span><a name="line-1727"></a><span class="hs-comment">-- trees:</span><span>
</span><a name="line-1728"></a><span class="hs-comment">--</span><span>
</span><a name="line-1729"></a><span class="hs-comment">-- A)   op1          B)       op1       C)       op1</span><span>
</span><a name="line-1730"></a><span class="hs-comment">--      /\                    /\                 /\</span><span>
</span><a name="line-1731"></a><span class="hs-comment">--     /  \                  /  \               /  \</span><span>
</span><a name="line-1732"></a><span class="hs-comment">--    /    \                /    \             /    \</span><span>
</span><a name="line-1733"></a><span class="hs-comment">--   a     op2            op2     c          op2    op3</span><span>
</span><a name="line-1734"></a><span class="hs-comment">--          /\            /\                 /\      /\</span><span>
</span><a name="line-1735"></a><span class="hs-comment">--         /  \          /  \               /  \    /  \</span><span>
</span><a name="line-1736"></a><span class="hs-comment">--        b    c        a    b             a    b  c    d</span><span>
</span><a name="line-1737"></a><span class="hs-comment">--</span><span>
</span><a name="line-1738"></a><span class="hs-comment">--</span><span>
</span><a name="line-1739"></a><span class="hs-comment">-- R1) +/- simplification:</span><span>
</span><a name="line-1740"></a><span class="hs-comment">--    ops = + or -, two literals (not siblings)</span><span>
</span><a name="line-1741"></a><span class="hs-comment">--</span><span>
</span><a name="line-1742"></a><span class="hs-comment">--    Examples:</span><span>
</span><a name="line-1743"></a><span class="hs-comment">--       A: 5 + (10-x)  ==&gt; 15-x</span><span>
</span><a name="line-1744"></a><span class="hs-comment">--       B: (10+x) + 5  ==&gt; 15+x</span><span>
</span><a name="line-1745"></a><span class="hs-comment">--       C: (5+a)-(5-b) ==&gt; 0+(a+b)</span><span>
</span><a name="line-1746"></a><span class="hs-comment">--</span><span>
</span><a name="line-1747"></a><span class="hs-comment">-- R2) * simplification</span><span>
</span><a name="line-1748"></a><span class="hs-comment">--    ops = *, two literals (not siblings)</span><span>
</span><a name="line-1749"></a><span class="hs-comment">--</span><span>
</span><a name="line-1750"></a><span class="hs-comment">--    Examples:</span><span>
</span><a name="line-1751"></a><span class="hs-comment">--       A: 5 * (10*x)  ==&gt; 50*x</span><span>
</span><a name="line-1752"></a><span class="hs-comment">--       B: (10*x) * 5  ==&gt; 50*x</span><span>
</span><a name="line-1753"></a><span class="hs-comment">--       C: (5*a)*(5*b) ==&gt; 25*(a*b)</span><span>
</span><a name="line-1754"></a><span class="hs-comment">--</span><span>
</span><a name="line-1755"></a><span class="hs-comment">-- R3) * distribution over +/-</span><span>
</span><a name="line-1756"></a><span class="hs-comment">--    op1 = *, op2 = + or -, two literals (not siblings)</span><span>
</span><a name="line-1757"></a><span class="hs-comment">--</span><span>
</span><a name="line-1758"></a><span class="hs-comment">--    This transformation doesn't reduce the number of operations but switches</span><span>
</span><a name="line-1759"></a><span class="hs-comment">--    the outer and the inner operations so that the outer is (+) or (-) instead</span><span>
</span><a name="line-1760"></a><span class="hs-comment">--    of (*). It increases the odds that other rules will match after this one.</span><span>
</span><a name="line-1761"></a><span class="hs-comment">--</span><span>
</span><a name="line-1762"></a><span class="hs-comment">--    Examples:</span><span>
</span><a name="line-1763"></a><span class="hs-comment">--       A: 5 * (10-x)  ==&gt; 50 - (5*x)</span><span>
</span><a name="line-1764"></a><span class="hs-comment">--       B: (10+x) * 5  ==&gt; 50 + (5*x)</span><span>
</span><a name="line-1765"></a><span class="hs-comment">--       C: Not supported as it would increase the number of operations:</span><span>
</span><a name="line-1766"></a><span class="hs-comment">--          (5+a)*(5-b) ==&gt; 25 - 5*b + 5*a - a*b</span><span>
</span><a name="line-1767"></a><span class="hs-comment">--</span><span>
</span><a name="line-1768"></a><span class="hs-comment">-- R4) Simple factorization</span><span>
</span><a name="line-1769"></a><span class="hs-comment">--</span><span>
</span><a name="line-1770"></a><span class="hs-comment">--    op1 = + or -, op2/op3 = *,</span><span>
</span><a name="line-1771"></a><span class="hs-comment">--    one literal for each innermost * operation (except in the D case),</span><span>
</span><a name="line-1772"></a><span class="hs-comment">--    the two other terms are equals</span><span>
</span><a name="line-1773"></a><span class="hs-comment">--</span><span>
</span><a name="line-1774"></a><span class="hs-comment">--    Examples:</span><span>
</span><a name="line-1775"></a><span class="hs-comment">--       A: x - (10*x)  ==&gt; (-9)*x</span><span>
</span><a name="line-1776"></a><span class="hs-comment">--       B: (10*x) + x  ==&gt; 11*x</span><span>
</span><a name="line-1777"></a><span class="hs-comment">--       C: (5*x)-(x*3) ==&gt; 2*x</span><span>
</span><a name="line-1778"></a><span class="hs-comment">--       D: x+x         ==&gt; 2*x</span><span>
</span><a name="line-1779"></a><span class="hs-comment">--</span><span>
</span><a name="line-1780"></a><span class="hs-comment">-- R5) +/- propagation</span><span>
</span><a name="line-1781"></a><span class="hs-comment">--</span><span>
</span><a name="line-1782"></a><span class="hs-comment">--    ops = + or -, one literal</span><span>
</span><a name="line-1783"></a><span class="hs-comment">--</span><span>
</span><a name="line-1784"></a><span class="hs-comment">--    This transformation doesn't reduce the number of operations but propagates</span><span>
</span><a name="line-1785"></a><span class="hs-comment">--    the constant to the outer level. It increases the odds that other rules</span><span>
</span><a name="line-1786"></a><span class="hs-comment">--    will match after this one.</span><span>
</span><a name="line-1787"></a><span class="hs-comment">--</span><span>
</span><a name="line-1788"></a><span class="hs-comment">--    Examples:</span><span>
</span><a name="line-1789"></a><span class="hs-comment">--       A: x - (10-y)  ==&gt; (x+y) - 10</span><span>
</span><a name="line-1790"></a><span class="hs-comment">--       B: (10+x) - y  ==&gt; 10 + (x-y)</span><span>
</span><a name="line-1791"></a><span class="hs-comment">--       C: N/A (caught by the A and B cases)</span><span>
</span><a name="line-1792"></a><span class="hs-comment">--</span><span>
</span><a name="line-1793"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-1794"></a><span>
</span><a name="line-1795"></a><span class="hs-comment">-- | Rules to perform constant folding into nested expressions</span><span>
</span><a name="line-1796"></a><span class="hs-comment">--</span><span>
</span><a name="line-1797"></a><span class="hs-comment">--See Note [Constant folding through nested expressions]</span><span>
</span><a name="line-1798"></a><span class="hs-identifier">numFoldingRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#PrimOps"><span class="hs-identifier hs-type">PrimOps</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#RuleM"><span class="hs-identifier hs-type">RuleM</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1799"></a><a name="numFoldingRules"><a href="PrelRules.html#numFoldingRules"><span class="hs-identifier">numFoldingRules</span></a></a><span> </span><a name="local-6989586621684814694"><a href="#local-6989586621684814694"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684814695"><a href="#local-6989586621684814695"><span class="hs-identifier">dict</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1800"></a><span>  </span><span class="hs-special">[</span><a name="local-6989586621684814696"><a href="#local-6989586621684814696"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814697"><a href="#local-6989586621684814697"><span class="hs-identifier">e2</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a><span>
</span><a name="line-1801"></a><span>  </span><a name="local-6989586621684814698"><a href="#local-6989586621684814698"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DynFlags.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a><span>
</span><a name="line-1802"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a href="PrelRules.html#PrimOps"><span class="hs-identifier hs-var">PrimOps</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684814695"><span class="hs-identifier hs-var">dict</span></a><span> </span><a href="#local-6989586621684814698"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1803"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_NumConstantFolding"><span class="hs-identifier hs-var">Opt_NumConstantFolding</span></a><span> </span><a href="#local-6989586621684814698"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1804"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">mzero</span><span>
</span><a name="line-1805"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="PrelRules.html#BinOpApp"><span class="hs-identifier hs-var">BinOpApp</span></a><span> </span><a href="#local-6989586621684814696"><span class="hs-identifier hs-var">e1</span></a><span> </span><a href="#local-6989586621684814694"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621684814697"><span class="hs-identifier hs-var">e2</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1806"></a><span>     </span><span class="hs-comment">-- R1) +/- simplification</span><span>
</span><a name="line-1807"></a><span>     </span><a name="local-6989586621684814703"><a href="#local-6989586621684814703"><span class="hs-identifier">x</span></a></a><span>    </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814704"><a href="#local-6989586621684814704"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814705"><a href="#local-6989586621684814705"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814703"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814704"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814705"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1808"></a><span>     </span><a name="local-6989586621684814706"><a href="#local-6989586621684814706"><span class="hs-identifier">x</span></a></a><span>    </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814707"><a href="#local-6989586621684814707"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814708"><a href="#local-6989586621684814708"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814706"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814707"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814708"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1809"></a><span>     </span><a name="local-6989586621684814709"><a href="#local-6989586621684814709"><span class="hs-identifier">x</span></a></a><span>    </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814710"><a href="#local-6989586621684814710"><span class="hs-identifier">v</span></a></a><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814711"><a href="#local-6989586621684814711"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814709"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814711"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814710"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1810"></a><span>     </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814712"><a href="#local-6989586621684814712"><span class="hs-identifier">x</span></a></a><span>  </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684814713"><a href="#local-6989586621684814713"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814714"><a href="#local-6989586621684814714"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814712"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814713"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814714"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1811"></a><span>     </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814715"><a href="#local-6989586621684814715"><span class="hs-identifier">x</span></a></a><span>  </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span>  </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814716"><a href="#local-6989586621684814716"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814717"><a href="#local-6989586621684814717"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814715"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814716"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814717"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1812"></a><span>     </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814718"><a href="#local-6989586621684814718"><span class="hs-identifier">x</span></a></a><span>  </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684814719"><a href="#local-6989586621684814719"><span class="hs-identifier">v</span></a></a><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814720"><a href="#local-6989586621684814720"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814718"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814720"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814719"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1813"></a><span>
</span><a name="line-1814"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814721"><a href="#local-6989586621684814721"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814722"><a href="#local-6989586621684814722"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>    </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814723"><a href="#local-6989586621684814723"><span class="hs-identifier">x</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814721"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814723"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814722"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1815"></a><span>     </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814724"><a href="#local-6989586621684814724"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814725"><a href="#local-6989586621684814725"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814726"><a href="#local-6989586621684814726"><span class="hs-identifier">x</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814724"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814726"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814725"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1816"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814727"><a href="#local-6989586621684814727"><span class="hs-identifier">v</span></a></a><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814728"><a href="#local-6989586621684814728"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814729"><a href="#local-6989586621684814729"><span class="hs-identifier">x</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">-</span><a href="#local-6989586621684814728"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814729"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814727"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1817"></a><span>
</span><a name="line-1818"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814730"><a href="#local-6989586621684814730"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814731"><a href="#local-6989586621684814731"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>  </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814732"><a href="#local-6989586621684814732"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814733"><a href="#local-6989586621684814733"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814730"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814732"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814731"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814733"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1819"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814734"><a href="#local-6989586621684814734"><span class="hs-identifier">w</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814735"><a href="#local-6989586621684814735"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814736"><a href="#local-6989586621684814736"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814737"><a href="#local-6989586621684814737"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814736"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814735"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814734"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814737"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1820"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814738"><a href="#local-6989586621684814738"><span class="hs-identifier">w</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814739"><a href="#local-6989586621684814739"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814740"><a href="#local-6989586621684814740"><span class="hs-identifier">v</span></a></a><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814741"><a href="#local-6989586621684814741"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">-</span><a href="#local-6989586621684814739"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814741"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814738"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814740"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1821"></a><span>     </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814742"><a href="#local-6989586621684814742"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814743"><a href="#local-6989586621684814743"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814744"><a href="#local-6989586621684814744"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814745"><a href="#local-6989586621684814745"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814742"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814744"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814743"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814745"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1822"></a><span>     </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814746"><a href="#local-6989586621684814746"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814747"><a href="#local-6989586621684814747"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814748"><a href="#local-6989586621684814748"><span class="hs-identifier">v</span></a></a><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814749"><a href="#local-6989586621684814749"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814746"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814749"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814748"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814747"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1823"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814750"><a href="#local-6989586621684814750"><span class="hs-identifier">w</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814751"><a href="#local-6989586621684814751"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814752"><a href="#local-6989586621684814752"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814753"><a href="#local-6989586621684814753"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814752"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814751"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814750"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814753"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1824"></a><span>     </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814754"><a href="#local-6989586621684814754"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814755"><a href="#local-6989586621684814755"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814756"><a href="#local-6989586621684814756"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814757"><a href="#local-6989586621684814757"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814754"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814756"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814757"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814755"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1825"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814758"><a href="#local-6989586621684814758"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814759"><a href="#local-6989586621684814759"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>  </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814760"><a href="#local-6989586621684814760"><span class="hs-identifier">w</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814761"><a href="#local-6989586621684814761"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814758"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814761"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814760"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814759"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1826"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814762"><a href="#local-6989586621684814762"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814763"><a href="#local-6989586621684814763"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>  </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814764"><a href="#local-6989586621684814764"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814765"><a href="#local-6989586621684814765"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814764"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814762"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814763"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814765"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1827"></a><span>
</span><a name="line-1828"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814766"><a href="#local-6989586621684814766"><span class="hs-identifier">v</span></a></a><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814767"><a href="#local-6989586621684814767"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814768"><a href="#local-6989586621684814768"><span class="hs-identifier">w</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814769"><a href="#local-6989586621684814769"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814769"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814767"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814766"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814768"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1829"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814770"><a href="#local-6989586621684814770"><span class="hs-identifier">v</span></a></a><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814771"><a href="#local-6989586621684814771"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814772"><a href="#local-6989586621684814772"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814773"><a href="#local-6989586621684814773"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">-</span><a href="#local-6989586621684814772"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814771"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814770"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814773"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1830"></a><span>     </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814774"><a href="#local-6989586621684814774"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span>   </span><a name="local-6989586621684814775"><a href="#local-6989586621684814775"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814776"><a href="#local-6989586621684814776"><span class="hs-identifier">w</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814777"><a href="#local-6989586621684814777"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814777"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814774"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814775"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814776"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1831"></a><span>     </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814778"><a href="#local-6989586621684814778"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span>   </span><a name="local-6989586621684814779"><a href="#local-6989586621684814779"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814780"><a href="#local-6989586621684814780"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814781"><a href="#local-6989586621684814781"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814778"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814780"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814781"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814779"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1832"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814782"><a href="#local-6989586621684814782"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814783"><a href="#local-6989586621684814783"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>    </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814784"><a href="#local-6989586621684814784"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814785"><a href="#local-6989586621684814785"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814782"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814784"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814783"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814785"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1833"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814786"><a href="#local-6989586621684814786"><span class="hs-identifier">w</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814787"><a href="#local-6989586621684814787"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814788"><a href="#local-6989586621684814788"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814789"><a href="#local-6989586621684814789"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">-</span><a href="#local-6989586621684814788"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814787"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814786"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814789"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1834"></a><span>     </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814790"><a href="#local-6989586621684814790"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814791"><a href="#local-6989586621684814791"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814792"><a href="#local-6989586621684814792"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814793"><a href="#local-6989586621684814793"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814790"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814792"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814793"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814791"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1835"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814794"><a href="#local-6989586621684814794"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814795"><a href="#local-6989586621684814795"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>    </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814796"><a href="#local-6989586621684814796"><span class="hs-identifier">w</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814797"><a href="#local-6989586621684814797"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814794"><span class="hs-identifier hs-var">y</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814797"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814795"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814796"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1836"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814798"><a href="#local-6989586621684814798"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814799"><a href="#local-6989586621684814799"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>    </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814800"><a href="#local-6989586621684814800"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814801"><a href="#local-6989586621684814801"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814798"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814800"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814799"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814801"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1837"></a><span>
</span><a name="line-1838"></a><span>     </span><span class="hs-comment">-- R2) * simplification</span><span>
</span><a name="line-1839"></a><span>     </span><a name="local-6989586621684814802"><a href="#local-6989586621684814802"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814803"><a href="#local-6989586621684814803"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814804"><a href="#local-6989586621684814804"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814802"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621684814803"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814804"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1840"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814805"><a href="#local-6989586621684814805"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814806"><a href="#local-6989586621684814806"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2A%3A"><span class="hs-operator hs-var">:*:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814807"><a href="#local-6989586621684814807"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814808"><a href="#local-6989586621684814808"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814805"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621684814807"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814806"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814808"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1841"></a><span>
</span><a name="line-1842"></a><span>     </span><span class="hs-comment">-- R3) * distribution over +/-</span><span>
</span><a name="line-1843"></a><span>     </span><a name="local-6989586621684814809"><a href="#local-6989586621684814809"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814810"><a href="#local-6989586621684814810"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814811"><a href="#local-6989586621684814811"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814809"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621684814810"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814809"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814811"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1844"></a><span>     </span><a name="local-6989586621684814812"><a href="#local-6989586621684814812"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814813"><a href="#local-6989586621684814813"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814814"><a href="#local-6989586621684814814"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814812"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621684814813"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814812"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814814"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1845"></a><span>     </span><a name="local-6989586621684814815"><a href="#local-6989586621684814815"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814816"><a href="#local-6989586621684814816"><span class="hs-identifier">v</span></a></a><span>   </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814817"><a href="#local-6989586621684814817"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814815"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814816"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814815"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">*</span><a href="#local-6989586621684814817"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-1846"></a><span>
</span><a name="line-1847"></a><span>     </span><span class="hs-comment">-- R4) Simple factorization</span><span>
</span><a name="line-1848"></a><span>     </span><a name="local-6989586621684814818"><a href="#local-6989586621684814818"><span class="hs-identifier">v</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><a name="local-6989586621684814819"><a href="#local-6989586621684814819"><span class="hs-identifier">w</span></a></a><span>
</span><a name="line-1849"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814819"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814818"><span class="hs-identifier hs-var">v</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-number">2</span><span>       </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814818"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1850"></a><span>     </span><a name="local-6989586621684814820"><a href="#local-6989586621684814820"><span class="hs-identifier">w</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814821"><a href="#local-6989586621684814821"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814822"><a href="#local-6989586621684814822"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1851"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814820"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814822"><span class="hs-identifier hs-var">v</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814821"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814822"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1852"></a><span>     </span><a name="local-6989586621684814823"><a href="#local-6989586621684814823"><span class="hs-identifier">w</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814824"><a href="#local-6989586621684814824"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814825"><a href="#local-6989586621684814825"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1853"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814823"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814825"><span class="hs-identifier hs-var">v</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-glyph">-</span><a href="#local-6989586621684814824"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814825"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1854"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814826"><a href="#local-6989586621684814826"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814827"><a href="#local-6989586621684814827"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><a name="local-6989586621684814828"><a href="#local-6989586621684814828"><span class="hs-identifier">w</span></a></a><span>
</span><a name="line-1855"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814828"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814827"><span class="hs-identifier hs-var">v</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814826"><span class="hs-identifier hs-var">y</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814827"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1856"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814829"><a href="#local-6989586621684814829"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814830"><a href="#local-6989586621684814830"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814831"><a href="#local-6989586621684814831"><span class="hs-identifier">w</span></a></a><span>
</span><a name="line-1857"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814831"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814830"><span class="hs-identifier hs-var">v</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814829"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814830"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1858"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814832"><a href="#local-6989586621684814832"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814833"><a href="#local-6989586621684814833"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814834"><a href="#local-6989586621684814834"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814835"><a href="#local-6989586621684814835"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1859"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814833"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814835"><span class="hs-identifier hs-var">v</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814832"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814834"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814835"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1860"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814836"><a href="#local-6989586621684814836"><span class="hs-identifier">x</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814837"><a href="#local-6989586621684814837"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814838"><a href="#local-6989586621684814838"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator hs-var">:**:</span></a><span> </span><a name="local-6989586621684814839"><a href="#local-6989586621684814839"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1861"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814837"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="CoreUtils.html#cheapEqExpr"><span class="hs-identifier hs-var">cheapEqExpr</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814839"><span class="hs-identifier hs-var">v</span></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814836"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814838"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>   </span><span class="hs-special">`</span><a href="#local-6989586621684814701"><span class="hs-identifier hs-var">mul</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814839"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1862"></a><span>
</span><a name="line-1863"></a><span>     </span><span class="hs-comment">-- R5) +/- propagation</span><span>
</span><a name="line-1864"></a><span>     </span><a name="local-6989586621684814840"><a href="#local-6989586621684814840"><span class="hs-identifier">w</span></a></a><span>  </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814841"><a href="#local-6989586621684814841"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814842"><a href="#local-6989586621684814842"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814841"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814840"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814842"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1865"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814843"><a href="#local-6989586621684814843"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814844"><a href="#local-6989586621684814844"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><a name="local-6989586621684814845"><a href="#local-6989586621684814845"><span class="hs-identifier">w</span></a></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814843"><span class="hs-identifier hs-var">y</span></a><span>       </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814845"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814844"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1866"></a><span>     </span><a name="local-6989586621684814846"><a href="#local-6989586621684814846"><span class="hs-identifier">w</span></a></a><span>  </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814847"><a href="#local-6989586621684814847"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814848"><a href="#local-6989586621684814848"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814846"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814848"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814847"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1867"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814849"><a href="#local-6989586621684814849"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator hs-var">:++:</span></a><span> </span><a name="local-6989586621684814850"><a href="#local-6989586621684814850"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814851"><a href="#local-6989586621684814851"><span class="hs-identifier">w</span></a></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814849"><span class="hs-identifier hs-var">y</span></a><span>       </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814850"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814851"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-1868"></a><span>     </span><a name="local-6989586621684814852"><a href="#local-6989586621684814852"><span class="hs-identifier">w</span></a></a><span>    </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814853"><a href="#local-6989586621684814853"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814854"><a href="#local-6989586621684814854"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814852"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814854"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814853"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1869"></a><span>     </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814855"><a href="#local-6989586621684814855"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814856"><a href="#local-6989586621684814856"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814857"><a href="#local-6989586621684814857"><span class="hs-identifier">w</span></a></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814855"><span class="hs-identifier hs-var">y</span></a><span>       </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814857"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814856"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1870"></a><span>     </span><a name="local-6989586621684814858"><a href="#local-6989586621684814858"><span class="hs-identifier">w</span></a></a><span>    </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814859"><a href="#local-6989586621684814859"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814860"><a href="#local-6989586621684814860"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814859"><span class="hs-identifier hs-var">y</span></a><span>       </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814858"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814860"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1871"></a><span>     </span><a name="local-6989586621684814861"><a href="#local-6989586621684814861"><span class="hs-identifier">w</span></a></a><span>    </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684814862"><a href="#local-6989586621684814862"><span class="hs-identifier">v</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814863"><a href="#local-6989586621684814863"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814861"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814862"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814863"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1872"></a><span>     </span><span class="hs-special">(</span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814864"><a href="#local-6989586621684814864"><span class="hs-identifier">y</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a name="local-6989586621684814865"><a href="#local-6989586621684814865"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><a name="local-6989586621684814866"><a href="#local-6989586621684814866"><span class="hs-identifier">w</span></a></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814864"><span class="hs-identifier hs-var">y</span></a><span>       </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814866"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814865"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1873"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684814867"><a href="#local-6989586621684814867"><span class="hs-identifier">v</span></a></a><span> </span><a href="PrelRules.html#%3A-%3A"><span class="hs-operator hs-var">:-:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814868"><a href="#local-6989586621684814868"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><a name="local-6989586621684814869"><a href="#local-6989586621684814869"><span class="hs-identifier">w</span></a></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814869"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814699"><span class="hs-identifier hs-var">add</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814867"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="#local-6989586621684814700"><span class="hs-identifier hs-var">sub</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814702"><span class="hs-identifier hs-var">mkL</span></a><span> </span><a href="#local-6989586621684814868"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1874"></a><span>
</span><a name="line-1875"></a><span>     </span><span class="hs-identifier">_</span><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mzero</span><span>
</span><a name="line-1876"></a><span>
</span><a name="line-1877"></a><span>
</span><a name="line-1878"></a><span>
</span><a name="line-1879"></a><span class="hs-comment">-- | Match the application of a binary primop</span><span>
</span><a name="line-1880"></a><span class="hs-keyword">pattern</span><span> </span><span class="hs-identifier">BinOpApp</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1881"></a><span class="hs-keyword">pattern</span><span> </span><a name="BinOpApp"><a href="PrelRules.html#BinOpApp"><span class="hs-identifier">BinOpApp</span></a></a><span>  </span><a href="#local-6989586621684814871"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684814870"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621684814872"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="PrelRules.html#OpVal"><span class="hs-identifier hs-var">OpVal</span></a><span> </span><a name="local-6989586621684814870"><a href="#local-6989586621684814870"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814871"><a href="#local-6989586621684814871"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a name="local-6989586621684814872"><a href="#local-6989586621684814872"><span class="hs-identifier">y</span></a></a><span>
</span><a name="line-1882"></a><span>
</span><a name="line-1883"></a><span class="hs-comment">-- | Match a primop</span><span>
</span><a name="line-1884"></a><span class="hs-keyword">pattern</span><span> </span><span class="hs-identifier">OpVal</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span>
</span><a name="line-1885"></a><span class="hs-keyword">pattern</span><span> </span><a name="OpVal"><a href="PrelRules.html#OpVal"><span class="hs-identifier">OpVal</span></a></a><span>   </span><a href="#local-6989586621684814873"><span class="hs-identifier hs-var">op</span></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814873"><a href="#local-6989586621684814873"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1886"></a><span>   </span><span class="hs-identifier">OpVal</span><span> </span><a name="local-6989586621684814874"><a href="#local-6989586621684814874"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-special">(</span><a href="MkId.html#mkPrimOpId"><span class="hs-identifier hs-var">mkPrimOpId</span></a><span> </span><a href="#local-6989586621684814874"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span>
</span><a name="line-1887"></a><span>
</span><a name="line-1888"></a><span>
</span><a name="line-1889"></a><span>
</span><a name="line-1890"></a><span class="hs-comment">-- | Match a literal</span><span>
</span><a name="line-1891"></a><span class="hs-keyword">pattern</span><span> </span><span class="hs-identifier">L</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span>
</span><a name="line-1892"></a><span class="hs-keyword">pattern</span><span> </span><a name="L"><a href="PrelRules.html#L"><span class="hs-identifier">L</span></a></a><span> </span><a href="#local-6989586621684814875"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#isLitValue_maybe"><span class="hs-identifier hs-var">isLitValue_maybe</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814875"><a href="#local-6989586621684814875"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1893"></a><span>
</span><a name="line-1894"></a><span class="hs-comment">-- | Match an addition</span><span>
</span><a name="line-1895"></a><span class="hs-keyword">pattern</span><span> </span><span class="hs-special">(</span><span class="hs-operator">:+:</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1896"></a><span class="hs-keyword">pattern</span><span> </span><a href="#local-6989586621684814876"><span class="hs-identifier hs-var">x</span></a><span> </span><a name="%3A%2B%3A"><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator">:+:</span></a></a><span> </span><a href="#local-6989586621684814877"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#BinOpApp"><span class="hs-identifier hs-var">BinOpApp</span></a><span> </span><a name="local-6989586621684814876"><a href="#local-6989586621684814876"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#isAddOp"><span class="hs-identifier hs-var">isAddOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684814877"><a href="#local-6989586621684814877"><span class="hs-identifier">y</span></a></a><span>
</span><a name="line-1897"></a><span>
</span><a name="line-1898"></a><span class="hs-comment">-- | Match an addition with a literal (handle commutativity)</span><span>
</span><a name="line-1899"></a><span class="hs-keyword">pattern</span><span> </span><span class="hs-special">(</span><span class="hs-operator">:++:</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1900"></a><span class="hs-keyword">pattern</span><span> </span><a href="#local-6989586621684814878"><span class="hs-identifier hs-var">l</span></a><span> </span><a name="%3A%2B%2B%3A"><a href="PrelRules.html#%3A%2B%2B%3A"><span class="hs-operator">:++:</span></a></a><span> </span><a href="#local-6989586621684814879"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><a href="PrelRules.html#isAdd"><span class="hs-identifier hs-var">isAdd</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684814878"><a href="#local-6989586621684814878"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814879"><a href="#local-6989586621684814879"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1901"></a><span>
</span><a name="line-1902"></a><span class="hs-identifier">isAdd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1903"></a><a name="isAdd"><a href="PrelRules.html#isAdd"><span class="hs-identifier">isAdd</span></a></a><span> </span><a name="local-6989586621684814880"><a href="#local-6989586621684814880"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684814880"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1904"></a><span>   </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814881"><a href="#local-6989586621684814881"><span class="hs-identifier">l</span></a></a><span> </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><a name="local-6989586621684814882"><a href="#local-6989586621684814882"><span class="hs-identifier">x</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814881"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621684814882"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1905"></a><span>   </span><a name="local-6989586621684814883"><a href="#local-6989586621684814883"><span class="hs-identifier">x</span></a></a><span>   </span><a href="PrelRules.html#%3A%2B%3A"><span class="hs-operator hs-var">:+:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814884"><a href="#local-6989586621684814884"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814884"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621684814883"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1906"></a><span>   </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1907"></a><span>
</span><a name="line-1908"></a><span class="hs-comment">-- | Match a multiplication</span><span>
</span><a name="line-1909"></a><span class="hs-keyword">pattern</span><span> </span><span class="hs-special">(</span><span class="hs-operator">:*:</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1910"></a><span class="hs-keyword">pattern</span><span> </span><a href="#local-6989586621684814885"><span class="hs-identifier hs-var">x</span></a><span> </span><a name="%3A%2A%3A"><a href="PrelRules.html#%3A%2A%3A"><span class="hs-operator">:*:</span></a></a><span> </span><a href="#local-6989586621684814886"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#BinOpApp"><span class="hs-identifier hs-var">BinOpApp</span></a><span> </span><a name="local-6989586621684814885"><a href="#local-6989586621684814885"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#isMulOp"><span class="hs-identifier hs-var">isMulOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684814886"><a href="#local-6989586621684814886"><span class="hs-identifier">y</span></a></a><span>
</span><a name="line-1911"></a><span>
</span><a name="line-1912"></a><span class="hs-comment">-- | Match a multiplication with a literal (handle commutativity)</span><span>
</span><a name="line-1913"></a><span class="hs-keyword">pattern</span><span> </span><span class="hs-special">(</span><span class="hs-operator">:**:</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1914"></a><span class="hs-keyword">pattern</span><span> </span><a href="#local-6989586621684814887"><span class="hs-identifier hs-var">l</span></a><span> </span><a name="%3A%2A%2A%3A"><a href="PrelRules.html#%3A%2A%2A%3A"><span class="hs-operator">:**:</span></a></a><span> </span><a href="#local-6989586621684814888"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><a href="PrelRules.html#isMul"><span class="hs-identifier hs-var">isMul</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684814887"><a href="#local-6989586621684814887"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621684814888"><a href="#local-6989586621684814888"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1915"></a><span>
</span><a name="line-1916"></a><span class="hs-identifier">isMul</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1917"></a><a name="isMul"><a href="PrelRules.html#isMul"><span class="hs-identifier">isMul</span></a></a><span> </span><a name="local-6989586621684814889"><a href="#local-6989586621684814889"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684814889"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1918"></a><span>   </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814890"><a href="#local-6989586621684814890"><span class="hs-identifier">l</span></a></a><span> </span><a href="PrelRules.html#%3A%2A%3A"><span class="hs-operator hs-var">:*:</span></a><span> </span><a name="local-6989586621684814891"><a href="#local-6989586621684814891"><span class="hs-identifier">x</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814890"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621684814891"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1919"></a><span>   </span><a name="local-6989586621684814892"><a href="#local-6989586621684814892"><span class="hs-identifier">x</span></a></a><span>   </span><a href="PrelRules.html#%3A%2A%3A"><span class="hs-operator hs-var">:*:</span></a><span> </span><a href="PrelRules.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684814893"><a href="#local-6989586621684814893"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814893"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">,</span><a href="#local-6989586621684814892"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1920"></a><span>   </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1921"></a><span>
</span><a name="line-1922"></a><span>
</span><a name="line-1923"></a><span class="hs-comment">-- | Match a subtraction</span><span>
</span><a name="line-1924"></a><span class="hs-keyword">pattern</span><span> </span><span class="hs-special">(</span><span class="hs-operator">:-:</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Arg"><span class="hs-identifier hs-type">Arg</span></a><span> </span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-1925"></a><span class="hs-keyword">pattern</span><span> </span><a href="#local-6989586621684814894"><span class="hs-identifier hs-var">x</span></a><span> </span><a name="%3A-%3A"><a href="PrelRules.html#%3A-%3A"><span class="hs-operator">:-:</span></a></a><span> </span><a href="#local-6989586621684814895"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#BinOpApp"><span class="hs-identifier hs-var">BinOpApp</span></a><span> </span><a name="local-6989586621684814894"><a href="#local-6989586621684814894"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="PrelRules.html#isSubOp"><span class="hs-identifier hs-var">isSubOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684814895"><a href="#local-6989586621684814895"><span class="hs-identifier">y</span></a></a><span>
</span><a name="line-1926"></a><span>
</span><a name="line-1927"></a><span class="hs-identifier">isSubOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1928"></a><a name="isSubOp"><a href="PrelRules.html#isSubOp"><span class="hs-identifier">isSubOp</span></a></a><span> </span><a href="PrimOp.html#IntSubOp"><span class="hs-identifier hs-var">IntSubOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1929"></a><span class="hs-identifier">isSubOp</span><span> </span><a href="PrimOp.html#WordSubOp"><span class="hs-identifier hs-var">WordSubOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1930"></a><span class="hs-identifier">isSubOp</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1931"></a><span>
</span><a name="line-1932"></a><span class="hs-identifier">isAddOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1933"></a><a name="isAddOp"><a href="PrelRules.html#isAddOp"><span class="hs-identifier">isAddOp</span></a></a><span> </span><a href="PrimOp.html#IntAddOp"><span class="hs-identifier hs-var">IntAddOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1934"></a><span class="hs-identifier">isAddOp</span><span> </span><a href="PrimOp.html#WordAddOp"><span class="hs-identifier hs-var">WordAddOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1935"></a><span class="hs-identifier">isAddOp</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1936"></a><span>
</span><a name="line-1937"></a><span class="hs-identifier">isMulOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1938"></a><a name="isMulOp"><a href="PrelRules.html#isMulOp"><span class="hs-identifier">isMulOp</span></a></a><span> </span><a href="PrimOp.html#IntMulOp"><span class="hs-identifier hs-var">IntMulOp</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1939"></a><span class="hs-identifier">isMulOp</span><span> </span><a href="PrimOp.html#WordMulOp"><span class="hs-identifier hs-var">WordMulOp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1940"></a><span class="hs-identifier">isMulOp</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1941"></a><span>
</span><a name="line-1942"></a><span class="hs-comment">-- | Explicit &quot;type-class&quot;-like dictionary for numeric primops</span><span>
</span><a name="line-1943"></a><span class="hs-comment">--</span><span>
</span><a name="line-1944"></a><span class="hs-comment">-- Depends on DynFlags because creating a literal value depends on DynFlags</span><span>
</span><a name="line-1945"></a><span class="hs-keyword">data</span><span> </span><a name="PrimOps"><a href="PrelRules.html#PrimOps"><span class="hs-identifier">PrimOps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PrimOps"><a href="PrelRules.html#PrimOps"><span class="hs-identifier">PrimOps</span></a></a><span>
</span><a name="line-1946"></a><span>   </span><span class="hs-special">{</span><span> </span><a name="add"><a href="PrelRules.html#add"><span class="hs-identifier">add</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-comment">-- ^ Add two numbers</span><span>
</span><a name="line-1947"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="sub"><a href="PrelRules.html#sub"><span class="hs-identifier">sub</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-comment">-- ^ Sub two numbers</span><span>
</span><a name="line-1948"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="mul"><a href="PrelRules.html#mul"><span class="hs-identifier">mul</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-comment">-- ^ Multiply two numbers</span><span>
</span><a name="line-1949"></a><span>   </span><span class="hs-special">,</span><span> </span><a name="mkL"><a href="PrelRules.html#mkL"><span class="hs-identifier">mkL</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>              </span><span class="hs-comment">-- ^ Create a literal value</span><span>
</span><a name="line-1950"></a><span>   </span><span class="hs-special">}</span><span>
</span><a name="line-1951"></a><span>
</span><a name="line-1952"></a><span class="hs-identifier">intPrimOps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#PrimOps"><span class="hs-identifier hs-type">PrimOps</span></a><span>
</span><a name="line-1953"></a><a name="intPrimOps"><a href="PrelRules.html#intPrimOps"><span class="hs-identifier">intPrimOps</span></a></a><span> </span><a name="local-6989586621684814896"><a href="#local-6989586621684814896"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#PrimOps"><span class="hs-identifier hs-var">PrimOps</span></a><span>
</span><a name="line-1954"></a><span>   </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">add</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814897"><a href="#local-6989586621684814897"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814898"><a href="#local-6989586621684814898"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#BinOpApp"><span class="hs-identifier hs-var">BinOpApp</span></a><span> </span><a href="#local-6989586621684814897"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="PrimOp.html#IntAddOp"><span class="hs-identifier hs-var">IntAddOp</span></a><span> </span><a href="#local-6989586621684814898"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1955"></a><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sub</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814899"><a href="#local-6989586621684814899"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814900"><a href="#local-6989586621684814900"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#BinOpApp"><span class="hs-identifier hs-var">BinOpApp</span></a><span> </span><a href="#local-6989586621684814899"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="PrimOp.html#IntSubOp"><span class="hs-identifier hs-var">IntSubOp</span></a><span> </span><a href="#local-6989586621684814900"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1956"></a><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mul</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814901"><a href="#local-6989586621684814901"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814902"><a href="#local-6989586621684814902"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#BinOpApp"><span class="hs-identifier hs-var">BinOpApp</span></a><span> </span><a href="#local-6989586621684814901"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="PrimOp.html#IntMulOp"><span class="hs-identifier hs-var">IntMulOp</span></a><span> </span><a href="#local-6989586621684814902"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1957"></a><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkL</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#intResult%27"><span class="hs-identifier hs-var">intResult'</span></a><span> </span><a href="#local-6989586621684814896"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1958"></a><span>   </span><span class="hs-special">}</span><span>
</span><a name="line-1959"></a><span>
</span><a name="line-1960"></a><span class="hs-identifier">wordPrimOps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#PrimOps"><span class="hs-identifier hs-type">PrimOps</span></a><span>
</span><a name="line-1961"></a><a name="wordPrimOps"><a href="PrelRules.html#wordPrimOps"><span class="hs-identifier">wordPrimOps</span></a></a><span> </span><a name="local-6989586621684814903"><a href="#local-6989586621684814903"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#PrimOps"><span class="hs-identifier hs-var">PrimOps</span></a><span>
</span><a name="line-1962"></a><span>   </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">add</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814904"><a href="#local-6989586621684814904"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814905"><a href="#local-6989586621684814905"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#BinOpApp"><span class="hs-identifier hs-var">BinOpApp</span></a><span> </span><a href="#local-6989586621684814904"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="PrimOp.html#WordAddOp"><span class="hs-identifier hs-var">WordAddOp</span></a><span> </span><a href="#local-6989586621684814905"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1963"></a><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sub</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814906"><a href="#local-6989586621684814906"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814907"><a href="#local-6989586621684814907"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#BinOpApp"><span class="hs-identifier hs-var">BinOpApp</span></a><span> </span><a href="#local-6989586621684814906"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="PrimOp.html#WordSubOp"><span class="hs-identifier hs-var">WordSubOp</span></a><span> </span><a href="#local-6989586621684814907"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1964"></a><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mul</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814908"><a href="#local-6989586621684814908"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684814909"><a href="#local-6989586621684814909"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrelRules.html#BinOpApp"><span class="hs-identifier hs-var">BinOpApp</span></a><span> </span><a href="#local-6989586621684814908"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="PrimOp.html#WordMulOp"><span class="hs-identifier hs-var">WordMulOp</span></a><span> </span><a href="#local-6989586621684814909"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1965"></a><span>   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkL</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="PrelRules.html#wordResult%27"><span class="hs-identifier hs-var">wordResult'</span></a><span> </span><a href="#local-6989586621684814903"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1966"></a><span>   </span><span class="hs-special">}</span><span>
</span><a name="line-1967"></a><span>
</span><a name="line-1968"></a><span>
</span><a name="line-1969"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-1970"></a><span class="hs-comment">-- Constant folding through case-expressions</span><span>
</span><a name="line-1971"></a><span class="hs-comment">--</span><span>
</span><a name="line-1972"></a><span class="hs-comment">-- cf Scrutinee Constant Folding in simplCore/SimplUtils</span><span>
</span><a name="line-1973"></a><span class="hs-comment">--------------------------------------------------------</span><span>
</span><a name="line-1974"></a><span>
</span><a name="line-1975"></a><span class="hs-comment">-- | Match the scrutinee of a case and potentially return a new scrutinee and a</span><span>
</span><a name="line-1976"></a><span class="hs-comment">-- function to apply to each literal alternative.</span><span>
</span><a name="line-1977"></a><span class="hs-identifier">caseRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-1978"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>                       </span><span class="hs-comment">-- Scrutinee</span><span>
</span><a name="line-1979"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>               </span><span class="hs-comment">-- New scrutinee</span><span>
</span><a name="line-1980"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span> </span><span class="hs-comment">-- How to fix up the alt pattern</span><span>
</span><a name="line-1981"></a><span>                                            </span><span class="hs-comment">--   Nothing &lt;=&gt; Unreachable</span><span>
</span><a name="line-1982"></a><span>                                            </span><span class="hs-comment">-- See Note [Unreachable caseRules alternatives]</span><span>
</span><a name="line-1983"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- How to reconstruct the original scrutinee</span><span>
</span><a name="line-1984"></a><span>                                            </span><span class="hs-comment">-- from the new case-binder</span><span>
</span><a name="line-1985"></a><span class="hs-comment">-- e.g  case e of b {</span><span>
</span><a name="line-1986"></a><span class="hs-comment">--         ...;</span><span>
</span><a name="line-1987"></a><span class="hs-comment">--         con bs -&gt; rhs;</span><span>
</span><a name="line-1988"></a><span class="hs-comment">--         ... }</span><span>
</span><a name="line-1989"></a><span class="hs-comment">--  ==&gt;</span><span>
</span><a name="line-1990"></a><span class="hs-comment">--      case e' of b' {</span><span>
</span><a name="line-1991"></a><span class="hs-comment">--         ...;</span><span>
</span><a name="line-1992"></a><span class="hs-comment">--         fixup_altcon[con] bs -&gt; let b = mk_orig[b] in rhs;</span><span>
</span><a name="line-1993"></a><span class="hs-comment">--         ... }</span><span>
</span><a name="line-1994"></a><span>
</span><a name="line-1995"></a><a name="caseRules"><a href="PrelRules.html#caseRules"><span class="hs-identifier">caseRules</span></a></a><span> </span><a name="local-6989586621684814910"><a href="#local-6989586621684814910"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814911"><a href="#local-6989586621684814911"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684814912"><a href="#local-6989586621684814912"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814913"><a href="#local-6989586621684814913"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- v `op` x#</span><span>
</span><a name="line-1996"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814914"><a href="#local-6989586621684814914"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a><span> </span><a href="#local-6989586621684814911"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-1997"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814915"><a href="#local-6989586621684814915"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Literal.html#isLitValue_maybe"><span class="hs-identifier hs-var">isLitValue_maybe</span></a><span> </span><a href="#local-6989586621684814913"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1998"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814916"><a href="#local-6989586621684814916"><span class="hs-identifier">adjust_lit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#adjustDyadicRight"><span class="hs-identifier hs-var">adjustDyadicRight</span></a><span> </span><a href="#local-6989586621684814914"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621684814915"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1999"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814912"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="PrelRules.html#tx_lit_con"><span class="hs-identifier hs-var">tx_lit_con</span></a><span> </span><a href="#local-6989586621684814910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814916"><span class="hs-identifier hs-var">adjust_lit</span></a><span>
</span><a name="line-2000"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814917"><a href="#local-6989586621684814917"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814911"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814917"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a href="#local-6989586621684814913"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2001"></a><span>
</span><a name="line-2002"></a><span class="hs-identifier">caseRules</span><span> </span><a name="local-6989586621684814918"><a href="#local-6989586621684814918"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814919"><a href="#local-6989586621684814919"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a name="local-6989586621684814920"><a href="#local-6989586621684814920"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684814921"><a href="#local-6989586621684814921"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- x# `op` v</span><span>
</span><a name="line-2003"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814922"><a href="#local-6989586621684814922"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a><span> </span><a href="#local-6989586621684814919"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-2004"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814923"><a href="#local-6989586621684814923"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Literal.html#isLitValue_maybe"><span class="hs-identifier hs-var">isLitValue_maybe</span></a><span> </span><a href="#local-6989586621684814920"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-2005"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814924"><a href="#local-6989586621684814924"><span class="hs-identifier">adjust_lit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#adjustDyadicLeft"><span class="hs-identifier hs-var">adjustDyadicLeft</span></a><span> </span><a href="#local-6989586621684814923"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684814922"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-2006"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814921"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="PrelRules.html#tx_lit_con"><span class="hs-identifier hs-var">tx_lit_con</span></a><span> </span><a href="#local-6989586621684814918"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814924"><span class="hs-identifier hs-var">adjust_lit</span></a><span>
</span><a name="line-2007"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814925"><a href="#local-6989586621684814925"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814919"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><a href="#local-6989586621684814920"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814925"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2008"></a><span>
</span><a name="line-2009"></a><span>
</span><a name="line-2010"></a><span class="hs-identifier">caseRules</span><span> </span><a name="local-6989586621684814926"><a href="#local-6989586621684814926"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814927"><a href="#local-6989586621684814927"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684814928"><a href="#local-6989586621684814928"><span class="hs-identifier">v</span></a></a><span>              </span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- op v</span><span>
</span><a name="line-2011"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814929"><a href="#local-6989586621684814929"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a><span> </span><a href="#local-6989586621684814927"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-2012"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684814930"><a href="#local-6989586621684814930"><span class="hs-identifier">adjust_lit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PrelRules.html#adjustUnary"><span class="hs-identifier hs-var">adjustUnary</span></a><span> </span><a href="#local-6989586621684814929"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-2013"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814928"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="PrelRules.html#tx_lit_con"><span class="hs-identifier hs-var">tx_lit_con</span></a><span> </span><a href="#local-6989586621684814926"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814930"><span class="hs-identifier hs-var">adjust_lit</span></a><span>
</span><a name="line-2014"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814931"><a href="#local-6989586621684814931"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814927"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814931"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2015"></a><span>
</span><a name="line-2016"></a><span class="hs-comment">-- See Note [caseRules for tagToEnum]</span><span>
</span><a name="line-2017"></a><span class="hs-identifier">caseRules</span><span> </span><a name="local-6989586621684814932"><a href="#local-6989586621684814932"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814933"><a href="#local-6989586621684814933"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684814934"><a href="#local-6989586621684814934"><span class="hs-identifier">type_arg</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684814935"><a href="#local-6989586621684814935"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2018"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="PrimOp.html#TagToEnumOp"><span class="hs-identifier hs-var">TagToEnumOp</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a><span> </span><a href="#local-6989586621684814933"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-2019"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814935"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="PrelRules.html#tx_con_tte"><span class="hs-identifier hs-var">tx_con_tte</span></a><span> </span><a href="#local-6989586621684814932"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2020"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814936"><a href="#local-6989586621684814936"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814933"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684814934"><span class="hs-identifier hs-var">type_arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814936"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2021"></a><span>
</span><a name="line-2022"></a><span class="hs-comment">-- See Note [caseRules for dataToTag]</span><span>
</span><a name="line-2023"></a><span class="hs-identifier">caseRules</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621684814937"><a href="#local-6989586621684814937"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621684814938"><a href="#local-6989586621684814938"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684814939"><a href="#local-6989586621684814939"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- dataToTag x</span><span>
</span><a name="line-2024"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="PrimOp.html#DataToTagOp"><span class="hs-identifier hs-var">DataToTagOp</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a><span> </span><a href="#local-6989586621684814937"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-2025"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684814940"><a href="#local-6989586621684814940"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621684814938"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2026"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a><span> </span><a href="#local-6989586621684814940"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2027"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814939"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><span> </span><a href="PrelRules.html#tx_con_dtt"><span class="hs-identifier hs-var">tx_con_dtt</span></a><span> </span><a href="#local-6989586621684814938"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2028"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684814941"><a href="#local-6989586621684814941"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814937"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684814938"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684814941"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2029"></a><span>
</span><a name="line-2030"></a><span class="hs-identifier">caseRules</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2031"></a><span>
</span><a name="line-2032"></a><span>
</span><a name="line-2033"></a><span class="hs-identifier">tx_lit_con</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span>
</span><a name="line-2034"></a><a name="tx_lit_con"><a href="PrelRules.html#tx_lit_con"><span class="hs-identifier">tx_lit_con</span></a></a><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>      </span><a href="CoreSyn.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="CoreSyn.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a><span>
</span><a name="line-2035"></a><span class="hs-identifier">tx_lit_con</span><span> </span><a name="local-6989586621684814942"><a href="#local-6989586621684814942"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684814943"><a href="#local-6989586621684814943"><span class="hs-identifier">adjust</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#LitAlt"><span class="hs-identifier hs-var">LitAlt</span></a><span> </span><a name="local-6989586621684814944"><a href="#local-6989586621684814944"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#LitAlt"><span class="hs-identifier hs-var">LitAlt</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mapLitValue"><span class="hs-identifier hs-var">mapLitValue</span></a><span> </span><a href="#local-6989586621684814942"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684814943"><span class="hs-identifier hs-var">adjust</span></a><span> </span><a href="#local-6989586621684814944"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-2036"></a><span class="hs-identifier">tx_lit_con</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-identifier">_</span><span>      </span><a name="local-6989586621684814945"><a href="#local-6989586621684814945"><span class="hs-identifier">alt</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;caseRules&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684814945"><span class="hs-identifier hs-var">alt</span></a><span class="hs-special">)</span><span>
</span><a name="line-2037"></a><span>   </span><span class="hs-comment">-- NB: mapLitValue uses mkLitIntWrap etc, to ensure that the</span><span>
</span><a name="line-2038"></a><span>   </span><span class="hs-comment">-- literal alternatives remain in Word/Int target ranges</span><span>
</span><a name="line-2039"></a><span>   </span><span class="hs-comment">-- (See Note [Word/Int underflow/overflow] in Literal and #13172).</span><span>
</span><a name="line-2040"></a><span>
</span><a name="line-2041"></a><span class="hs-identifier">adjustDyadicRight</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-2042"></a><span class="hs-comment">-- Given (x `op` lit) return a function 'f' s.t.  f (x `op` lit) = x</span><span>
</span><a name="line-2043"></a><a name="adjustDyadicRight"><a href="PrelRules.html#adjustDyadicRight"><span class="hs-identifier">adjustDyadicRight</span></a></a><span> </span><a name="local-6989586621684814946"><a href="#local-6989586621684814946"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684814947"><a href="#local-6989586621684814947"><span class="hs-identifier">lit</span></a></a><span>
</span><a name="line-2044"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684814946"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2045"></a><span>         </span><a href="PrimOp.html#WordAddOp"><span class="hs-identifier hs-var">WordAddOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814948"><a href="#local-6989586621684814948"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814948"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814947"><span class="hs-identifier hs-var">lit</span></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-2046"></a><span>         </span><a href="PrimOp.html#IntAddOp"><span class="hs-identifier hs-var">IntAddOp</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814949"><a href="#local-6989586621684814949"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814949"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814947"><span class="hs-identifier hs-var">lit</span></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-2047"></a><span>         </span><a href="PrimOp.html#WordSubOp"><span class="hs-identifier hs-var">WordSubOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814950"><a href="#local-6989586621684814950"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814950"><span class="hs-identifier hs-var">y</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814947"><span class="hs-identifier hs-var">lit</span></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-2048"></a><span>         </span><a href="PrimOp.html#IntSubOp"><span class="hs-identifier hs-var">IntSubOp</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814951"><a href="#local-6989586621684814951"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814951"><span class="hs-identifier hs-var">y</span></a><span class="hs-operator hs-var">+</span><a href="#local-6989586621684814947"><span class="hs-identifier hs-var">lit</span></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-2049"></a><span>         </span><a href="PrimOp.html#XorOp"><span class="hs-identifier hs-var">XorOp</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814952"><a href="#local-6989586621684814952"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814952"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814947"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-2050"></a><span>         </span><a href="PrimOp.html#XorIOp"><span class="hs-identifier hs-var">XorIOp</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814953"><a href="#local-6989586621684814953"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814953"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814947"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-2051"></a><span>         </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2052"></a><span>
</span><a name="line-2053"></a><span class="hs-identifier">adjustDyadicLeft</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-2054"></a><span class="hs-comment">-- Given (lit `op` x) return a function 'f' s.t.  f (lit `op` x) = x</span><span>
</span><a name="line-2055"></a><a name="adjustDyadicLeft"><a href="PrelRules.html#adjustDyadicLeft"><span class="hs-identifier">adjustDyadicLeft</span></a></a><span> </span><a name="local-6989586621684814954"><a href="#local-6989586621684814954"><span class="hs-identifier">lit</span></a></a><span> </span><a name="local-6989586621684814955"><a href="#local-6989586621684814955"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-2056"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684814955"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2057"></a><span>         </span><a href="PrimOp.html#WordAddOp"><span class="hs-identifier hs-var">WordAddOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814956"><a href="#local-6989586621684814956"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814956"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814954"><span class="hs-identifier hs-var">lit</span></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-2058"></a><span>         </span><a href="PrimOp.html#IntAddOp"><span class="hs-identifier hs-var">IntAddOp</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814957"><a href="#local-6989586621684814957"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814957"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814954"><span class="hs-identifier hs-var">lit</span></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-2059"></a><span>         </span><a href="PrimOp.html#WordSubOp"><span class="hs-identifier hs-var">WordSubOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814958"><a href="#local-6989586621684814958"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814954"><span class="hs-identifier hs-var">lit</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814958"><span class="hs-identifier hs-var">y</span></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-2060"></a><span>         </span><a href="PrimOp.html#IntSubOp"><span class="hs-identifier hs-var">IntSubOp</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814959"><a href="#local-6989586621684814959"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814954"><span class="hs-identifier hs-var">lit</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684814959"><span class="hs-identifier hs-var">y</span></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-2061"></a><span>         </span><a href="PrimOp.html#XorOp"><span class="hs-identifier hs-var">XorOp</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814960"><a href="#local-6989586621684814960"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814960"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814954"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-2062"></a><span>         </span><a href="PrimOp.html#XorIOp"><span class="hs-identifier hs-var">XorIOp</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814961"><a href="#local-6989586621684814961"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684814961"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684814954"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-2063"></a><span>         </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2064"></a><span>
</span><a name="line-2065"></a><span>
</span><a name="line-2066"></a><span class="hs-identifier">adjustUnary</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-2067"></a><span class="hs-comment">-- Given (op x) return a function 'f' s.t.  f (op x) = x</span><span>
</span><a name="line-2068"></a><a name="adjustUnary"><a href="PrelRules.html#adjustUnary"><span class="hs-identifier">adjustUnary</span></a></a><span> </span><a name="local-6989586621684814962"><a href="#local-6989586621684814962"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-2069"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684814962"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2070"></a><span>         </span><a href="PrimOp.html#NotOp"><span class="hs-identifier hs-var">NotOp</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814963"><a href="#local-6989586621684814963"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">complement</span><span> </span><a href="#local-6989586621684814963"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-2071"></a><span>         </span><a href="PrimOp.html#NotIOp"><span class="hs-identifier hs-var">NotIOp</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814964"><a href="#local-6989586621684814964"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">complement</span><span> </span><a href="#local-6989586621684814964"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-2072"></a><span>         </span><a href="PrimOp.html#IntNegOp"><span class="hs-identifier hs-var">IntNegOp</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684814965"><a href="#local-6989586621684814965"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="#local-6989586621684814965"><span class="hs-identifier hs-var">y</span></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-2073"></a><span>         </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2074"></a><span>
</span><a name="line-2075"></a><span class="hs-identifier">tx_con_tte</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span>
</span><a name="line-2076"></a><a name="tx_con_tte"><a href="PrelRules.html#tx_con_tte"><span class="hs-identifier">tx_con_tte</span></a></a><span> </span><span class="hs-identifier">_</span><span>      </span><a href="CoreSyn.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="CoreSyn.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a><span>
</span><a name="line-2077"></a><span class="hs-identifier">tx_con_tte</span><span> </span><span class="hs-identifier">_</span><span>      </span><a name="local-6989586621684814966"><a href="#local-6989586621684814966"><span class="hs-identifier">alt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CoreSyn.html#LitAlt"><span class="hs-identifier hs-var">LitAlt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;caseRules&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684814966"><span class="hs-identifier hs-var">alt</span></a><span class="hs-special">)</span><span>
</span><a name="line-2078"></a><span class="hs-identifier">tx_con_tte</span><span> </span><a name="local-6989586621684814967"><a href="#local-6989586621684814967"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a name="local-6989586621684814968"><a href="#local-6989586621684814968"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- See Note [caseRules for tagToEnum]</span><span>
</span><a name="line-2079"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#LitAlt"><span class="hs-identifier hs-var">LitAlt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Literal.html#mkLitInt"><span class="hs-identifier hs-var">mkLitInt</span></a><span> </span><a href="#local-6989586621684814967"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="DataCon.html#dataConTagZ"><span class="hs-identifier hs-var">dataConTagZ</span></a><span> </span><a href="#local-6989586621684814968"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-2080"></a><span>
</span><a name="line-2081"></a><span class="hs-identifier">tx_con_dtt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span>
</span><a name="line-2082"></a><a name="tx_con_dtt"><a href="PrelRules.html#tx_con_dtt"><span class="hs-identifier">tx_con_dtt</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><a href="CoreSyn.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="CoreSyn.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a><span>
</span><a name="line-2083"></a><span class="hs-identifier">tx_con_dtt</span><span> </span><a name="local-6989586621684814969"><a href="#local-6989586621684814969"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#LitAlt"><span class="hs-identifier hs-var">LitAlt</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitNumber"><span class="hs-identifier hs-var">LitNumber</span></a><span> </span><a href="Literal.html#LitNumInt"><span class="hs-identifier hs-var">LitNumInt</span></a><span> </span><a name="local-6989586621684814970"><a href="#local-6989586621684814970"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2084"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684814971"><span class="hs-identifier hs-var">tag</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2085"></a><span>   </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684814971"><span class="hs-identifier hs-var">tag</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621684814973"><span class="hs-identifier hs-var">n_data_cons</span></a><span>
</span><a name="line-2086"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684814974"><span class="hs-identifier hs-var">data_cons</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><a href="#local-6989586621684814971"><span class="hs-identifier hs-var">tag</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- tag is zero-indexed, as is (!!)</span><span>
</span><a name="line-2087"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2088"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2089"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-2090"></a><span>     </span><a name="local-6989586621684814971"><a href="#local-6989586621684814971"><span class="hs-identifier">tag</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684814970"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#ConTagZ"><span class="hs-identifier hs-type">ConTagZ</span></a><span>
</span><a name="line-2091"></a><span>     </span><a name="local-6989586621684814972"><a href="#local-6989586621684814972"><span class="hs-identifier">tc</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#tyConAppTyCon"><span class="hs-identifier hs-var">tyConAppTyCon</span></a><span> </span><a href="#local-6989586621684814969"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2092"></a><span>     </span><a name="local-6989586621684814973"><a href="#local-6989586621684814973"><span class="hs-identifier">n_data_cons</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConFamilySize"><span class="hs-identifier hs-var">tyConFamilySize</span></a><span> </span><a href="#local-6989586621684814972"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2093"></a><span>     </span><a name="local-6989586621684814974"><a href="#local-6989586621684814974"><span class="hs-identifier">data_cons</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-6989586621684814972"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2094"></a><span>
</span><a name="line-2095"></a><span class="hs-identifier">tx_con_dtt</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684814975"><a href="#local-6989586621684814975"><span class="hs-identifier">alt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;caseRules&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684814975"><span class="hs-identifier hs-var">alt</span></a><span class="hs-special">)</span><span>
</span><a name="line-2096"></a><span>
</span><a name="line-2097"></a><span>
</span><a name="line-2098"></a><span class="hs-comment">{- Note [caseRules for tagToEnum]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We want to transform
   case tagToEnum x of
     False -&gt; e1
     True  -&gt; e2
into
   case x of
     0# -&gt; e1
     1# -&gt; e2

This rule eliminates a lot of boilerplate. For
  if (x&gt;y) then e2 else e1
we generate
  case tagToEnum (x &gt;# y) of
    False -&gt; e1
    True  -&gt; e2
and it is nice to then get rid of the tagToEnum.

Beware (Trac #14768): avoid the temptation to map constructor 0 to
DEFAULT, in the hope of getting this
  case (x &gt;# y) of
    DEFAULT -&gt; e1
    1#      -&gt; e2
That fails utterly in the case of
   data Colour = Red | Green | Blue
   case tagToEnum x of
      DEFAULT -&gt; e1
      Red     -&gt; e2

We don't want to get this!
   case x of
      DEFAULT -&gt; e1
      DEFAULT -&gt; e2

Instead, we deal with turning one branch into DEFAULT in SimplUtils
(add_default in mkCase3).

Note [caseRules for dataToTag]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
See also Note [dataToTag#] in primpops.txt.pp

We want to transform
  case dataToTag x of
    DEFAULT -&gt; e1
    1# -&gt; e2
into
  case x of
    DEFAULT -&gt; e1
    (:) _ _ -&gt; e2

Note the need for some wildcard binders in
the 'cons' case.

For the time, we only apply this transformation when the type of `x` is a type
headed by a normal tycon. In particular, we do not apply this in the case of a
data family tycon, since that would require carefully applying coercion(s)
between the data family and the data family instance's representation type,
which caseRules isn't currently engineered to handle (#14680).

Note [Unreachable caseRules alternatives]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Take care if we see something like
  case dataToTag x of
    DEFAULT -&gt; e1
    -1# -&gt; e2
    100 -&gt; e3
because there isn't a data constructor with tag -1 or 100. In this case the
out-of-range alterantive is dead code -- we know the range of tags for x.

Hence caseRules returns (AltCon -&gt; Maybe AltCon), with Nothing indicating
an alternative that is unreachable.

You may wonder how this can happen: check out Trac #15436.
-}</span><span>
</span><a name="line-2173"></a></pre></body></html>