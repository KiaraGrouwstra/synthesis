<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[Id]{@Ids@: Value and constructor identifiers}
-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- #name_types#</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- GHC uses several kinds of name internally:</span><span>
</span><a name="line-13"></a><span class="hs-comment">--</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- * 'OccName.OccName': see &quot;OccName#name_types&quot;</span><span>
</span><a name="line-15"></a><span class="hs-comment">--</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- * 'RdrName.RdrName': see &quot;RdrName#name_types&quot;</span><span>
</span><a name="line-17"></a><span class="hs-comment">--</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- * 'Name.Name': see &quot;Name#name_types&quot;</span><span>
</span><a name="line-19"></a><span class="hs-comment">--</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- * 'Id.Id' represents names that not only have a 'Name.Name' but also a 'TyCoRep.Type' and some additional</span><span>
</span><a name="line-21"></a><span class="hs-comment">--   details (a 'IdInfo.IdInfo' and one of 'Var.LocalIdDetails' or 'IdInfo.GlobalIdDetails') that</span><span>
</span><a name="line-22"></a><span class="hs-comment">--   are added, modified and inspected by various compiler passes. These 'Var.Var' names may either</span><span>
</span><a name="line-23"></a><span class="hs-comment">--   be global or local, see &quot;Var#globalvslocal&quot;</span><span>
</span><a name="line-24"></a><span class="hs-comment">--</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- * 'Var.Var': see &quot;Var#name_types&quot;</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Id</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-28"></a><span>        </span><span class="hs-comment">-- * The main types</span><span>
</span><a name="line-29"></a><span>        </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isId"><span class="hs-identifier hs-var">isId</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>        </span><span class="hs-comment">-- * In and Out variants</span><span>
</span><a name="line-32"></a><span>        </span><a href="Var.html#InVar"><span class="hs-identifier hs-type">InVar</span></a><span class="hs-special">,</span><span>  </span><a href="Var.html#InId"><span class="hs-identifier hs-type">InId</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>        </span><a href="Var.html#OutVar"><span class="hs-identifier hs-type">OutVar</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#OutId"><span class="hs-identifier hs-type">OutId</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>        </span><span class="hs-comment">-- ** Simple construction</span><span>
</span><a name="line-36"></a><span>        </span><a href="Id.html#mkGlobalId"><span class="hs-identifier hs-var">mkGlobalId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkVanillaGlobal"><span class="hs-identifier hs-var">mkVanillaGlobal</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkVanillaGlobalWithInfo"><span class="hs-identifier hs-var">mkVanillaGlobalWithInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkLocalCoVar"><span class="hs-identifier hs-var">mkLocalCoVar</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="Id.html#mkLocalIdOrCoVarWithInfo"><span class="hs-identifier hs-var">mkLocalIdOrCoVarWithInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>        </span><a href="Id.html#mkLocalIdWithInfo"><span class="hs-identifier hs-var">mkLocalIdWithInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkExportedLocalId"><span class="hs-identifier hs-var">mkExportedLocalId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkExportedVanillaId"><span class="hs-identifier hs-var">mkExportedVanillaId</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="Id.html#mkSysLocal"><span class="hs-identifier hs-var">mkSysLocal</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkSysLocalM"><span class="hs-identifier hs-var">mkSysLocalM</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkSysLocalOrCoVar"><span class="hs-identifier hs-var">mkSysLocalOrCoVar</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkSysLocalOrCoVarM"><span class="hs-identifier hs-var">mkSysLocalOrCoVarM</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="Id.html#mkUserLocal"><span class="hs-identifier hs-var">mkUserLocal</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkUserLocalOrCoVar"><span class="hs-identifier hs-var">mkUserLocalOrCoVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>        </span><a href="Id.html#mkTemplateLocals"><span class="hs-identifier hs-var">mkTemplateLocals</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkTemplateLocalsNum"><span class="hs-identifier hs-var">mkTemplateLocalsNum</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkTemplateLocal"><span class="hs-identifier hs-var">mkTemplateLocal</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="Id.html#mkWorkerId"><span class="hs-identifier hs-var">mkWorkerId</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>        </span><span class="hs-comment">-- ** Taking an Id apart</span><span>
</span><a name="line-46"></a><span>        </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idUnique"><span class="hs-identifier hs-var">idUnique</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>        </span><a href="Id.html#recordSelectorTyCon"><span class="hs-identifier hs-var">recordSelectorTyCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span>        </span><span class="hs-comment">-- ** Modifying an Id</span><span>
</span><a name="line-50"></a><span>        </span><a href="Id.html#setIdName"><span class="hs-identifier hs-var">setIdName</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#setIdUnique"><span class="hs-identifier hs-var">setIdUnique</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#setIdType"><span class="hs-identifier hs-var">Id.setIdType</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>        </span><a href="Id.html#setIdExported"><span class="hs-identifier hs-var">setIdExported</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#setIdNotExported"><span class="hs-identifier hs-var">setIdNotExported</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="Var.html#globaliseId"><span class="hs-identifier hs-var">globaliseId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#localiseId"><span class="hs-identifier hs-var">localiseId</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="Id.html#setIdInfo"><span class="hs-identifier hs-var">setIdInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#lazySetIdInfo"><span class="hs-identifier hs-var">lazySetIdInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#maybeModifyIdInfo"><span class="hs-identifier hs-var">maybeModifyIdInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>        </span><a href="Id.html#zapLamIdInfo"><span class="hs-identifier hs-var">zapLamIdInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#zapIdDemandInfo"><span class="hs-identifier hs-var">zapIdDemandInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#zapIdUsageInfo"><span class="hs-identifier hs-var">zapIdUsageInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#zapIdUsageEnvInfo"><span class="hs-identifier hs-var">zapIdUsageEnvInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>        </span><a href="Id.html#zapIdUsedOnceInfo"><span class="hs-identifier hs-var">zapIdUsedOnceInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#zapIdTailCallInfo"><span class="hs-identifier hs-var">zapIdTailCallInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>        </span><a href="Id.html#zapFragileIdInfo"><span class="hs-identifier hs-var">zapFragileIdInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#zapIdStrictness"><span class="hs-identifier hs-var">zapIdStrictness</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#zapStableUnfolding"><span class="hs-identifier hs-var">zapStableUnfolding</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>        </span><a href="Id.html#transferPolyIdInfo"><span class="hs-identifier hs-var">transferPolyIdInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>        </span><span class="hs-comment">-- ** Predicates on Ids</span><span>
</span><a name="line-60"></a><span>        </span><a href="Id.html#isImplicitId"><span class="hs-identifier hs-var">isImplicitId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isDeadBinder"><span class="hs-identifier hs-var">isDeadBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>        </span><a href="Id.html#isStrictId"><span class="hs-identifier hs-var">isStrictId</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>        </span><a href="Var.html#isExportedId"><span class="hs-identifier hs-var">isExportedId</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isLocalId"><span class="hs-identifier hs-var">isLocalId</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isGlobalId"><span class="hs-identifier hs-var">isGlobalId</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>        </span><a href="Id.html#isRecordSelector"><span class="hs-identifier hs-var">isRecordSelector</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isNaughtyRecordSelector"><span class="hs-identifier hs-var">isNaughtyRecordSelector</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>        </span><a href="Id.html#isPatSynRecordSelector"><span class="hs-identifier hs-var">isPatSynRecordSelector</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>        </span><a href="Id.html#isDataConRecordSelector"><span class="hs-identifier hs-var">isDataConRecordSelector</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>        </span><a href="Id.html#isClassOpId_maybe"><span class="hs-identifier hs-var">isClassOpId_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isDFunId"><span class="hs-identifier hs-var">isDFunId</span></a><span class="hs-special">,</span><span>
</span><a name="line-67"></a><span>        </span><a href="Id.html#isPrimOpId"><span class="hs-identifier hs-var">isPrimOpId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isPrimOpId_maybe"><span class="hs-identifier hs-var">isPrimOpId_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>        </span><a href="Id.html#isFCallId"><span class="hs-identifier hs-var">isFCallId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isFCallId_maybe"><span class="hs-identifier hs-var">isFCallId_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>        </span><a href="Id.html#isDataConWorkId"><span class="hs-identifier hs-var">isDataConWorkId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isDataConWorkId_maybe"><span class="hs-identifier hs-var">isDataConWorkId_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isDataConId_maybe"><span class="hs-identifier hs-var">isDataConId_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idDataCon"><span class="hs-identifier hs-var">idDataCon</span></a><span class="hs-special">,</span><span>
</span><a name="line-70"></a><span>        </span><a href="Id.html#isConLikeId"><span class="hs-identifier hs-var">isConLikeId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isBottomingId"><span class="hs-identifier hs-var">isBottomingId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idIsFrom"><span class="hs-identifier hs-var">idIsFrom</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>        </span><a href="Id.html#hasNoBinding"><span class="hs-identifier hs-var">hasNoBinding</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span>        </span><span class="hs-comment">-- ** Evidence variables</span><span>
</span><a name="line-74"></a><span>        </span><a href="Var.html#DictId"><span class="hs-identifier hs-type">DictId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isDictId"><span class="hs-identifier hs-var">isDictId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isEvVar"><span class="hs-identifier hs-var">isEvVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span>        </span><span class="hs-comment">-- ** Join variables</span><span>
</span><a name="line-77"></a><span>        </span><a href="Var.html#JoinId"><span class="hs-identifier hs-type">JoinId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isJoinId_maybe"><span class="hs-identifier hs-var">isJoinId_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idJoinArity"><span class="hs-identifier hs-var">idJoinArity</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>        </span><a href="Id.html#asJoinId"><span class="hs-identifier hs-var">asJoinId</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#asJoinId_maybe"><span class="hs-identifier hs-var">asJoinId_maybe</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#zapJoinId"><span class="hs-identifier hs-var">zapJoinId</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span>        </span><span class="hs-comment">-- ** Inline pragma stuff</span><span>
</span><a name="line-81"></a><span>        </span><a href="Id.html#idInlinePragma"><span class="hs-identifier hs-var">idInlinePragma</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#setInlinePragma"><span class="hs-identifier hs-var">setInlinePragma</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#modifyInlinePragma"><span class="hs-identifier hs-var">modifyInlinePragma</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>        </span><a href="Id.html#idInlineActivation"><span class="hs-identifier hs-var">idInlineActivation</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#setInlineActivation"><span class="hs-identifier hs-var">setInlineActivation</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idRuleMatchInfo"><span class="hs-identifier hs-var">idRuleMatchInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span>        </span><span class="hs-comment">-- ** One-shot lambdas</span><span>
</span><a name="line-85"></a><span>        </span><a href="Id.html#isOneShotBndr"><span class="hs-identifier hs-var">isOneShotBndr</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#isProbablyOneShotLambda"><span class="hs-identifier hs-var">isProbablyOneShotLambda</span></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>        </span><a href="Id.html#setOneShotLambda"><span class="hs-identifier hs-var">setOneShotLambda</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#clearOneShotLambda"><span class="hs-identifier hs-var">clearOneShotLambda</span></a><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>        </span><a href="Id.html#updOneShotInfo"><span class="hs-identifier hs-var">updOneShotInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#setIdOneShotInfo"><span class="hs-identifier hs-var">setIdOneShotInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-88"></a><span>        </span><a href="Id.html#isStateHackType"><span class="hs-identifier hs-var">isStateHackType</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#stateHackOneShot"><span class="hs-identifier hs-var">stateHackOneShot</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#typeOneShot"><span class="hs-identifier hs-var">typeOneShot</span></a><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span>        </span><span class="hs-comment">-- ** Reading 'IdInfo' fields</span><span>
</span><a name="line-91"></a><span>        </span><a href="Id.html#idArity"><span class="hs-identifier hs-var">idArity</span></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>        </span><a href="Id.html#idCallArity"><span class="hs-identifier hs-var">idCallArity</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idFunRepArity"><span class="hs-identifier hs-var">idFunRepArity</span></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>        </span><a href="Id.html#idUnfolding"><span class="hs-identifier hs-var">idUnfolding</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#realIdUnfolding"><span class="hs-identifier hs-var">realIdUnfolding</span></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>        </span><a href="Id.html#idSpecialisation"><span class="hs-identifier hs-var">idSpecialisation</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idCoreRules"><span class="hs-identifier hs-var">idCoreRules</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idHasRules"><span class="hs-identifier hs-var">idHasRules</span></a><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>        </span><a href="Id.html#idCafInfo"><span class="hs-identifier hs-var">idCafInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-96"></a><span>        </span><a href="Id.html#idOneShotInfo"><span class="hs-identifier hs-var">idOneShotInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idStateHackOneShotInfo"><span class="hs-identifier hs-var">idStateHackOneShotInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-97"></a><span>        </span><a href="Id.html#idOccInfo"><span class="hs-identifier hs-var">idOccInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-98"></a><span>        </span><a href="Id.html#isNeverLevPolyId"><span class="hs-identifier hs-var">isNeverLevPolyId</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span>        </span><span class="hs-comment">-- ** Writing 'IdInfo' fields</span><span>
</span><a name="line-101"></a><span>        </span><a href="Id.html#setIdUnfolding"><span class="hs-identifier hs-var">setIdUnfolding</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#setCaseBndrEvald"><span class="hs-identifier hs-var">setCaseBndrEvald</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>        </span><a href="Id.html#setIdArity"><span class="hs-identifier hs-var">setIdArity</span></a><span class="hs-special">,</span><span>
</span><a name="line-103"></a><span>        </span><a href="Id.html#setIdCallArity"><span class="hs-identifier hs-var">setIdCallArity</span></a><span class="hs-special">,</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span>        </span><a href="Id.html#setIdSpecialisation"><span class="hs-identifier hs-var">setIdSpecialisation</span></a><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>        </span><a href="Id.html#setIdCafInfo"><span class="hs-identifier hs-var">setIdCafInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-107"></a><span>        </span><a href="Id.html#setIdOccInfo"><span class="hs-identifier hs-var">setIdOccInfo</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#zapIdOccInfo"><span class="hs-identifier hs-var">zapIdOccInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span>
</span><a name="line-109"></a><span>        </span><a href="Id.html#setIdDemandInfo"><span class="hs-identifier hs-var">setIdDemandInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>        </span><a href="Id.html#setIdStrictness"><span class="hs-identifier hs-var">setIdStrictness</span></a><span class="hs-special">,</span><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span>        </span><a href="Id.html#idDemandInfo"><span class="hs-identifier hs-var">idDemandInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-113"></a><span>        </span><a href="Id.html#idStrictness"><span class="hs-identifier hs-var">idStrictness</span></a><span class="hs-special">,</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-119"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-122"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#isStableUnfolding"><span class="hs-identifier hs-var">isStableUnfolding</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#evaldUnfolding"><span class="hs-identifier hs-var">evaldUnfolding</span></a><span class="hs-special">,</span><span>
</span><a name="line-123"></a><span>                 </span><a href="CoreSyn.html#isCompulsoryUnfolding"><span class="hs-identifier hs-var">isCompulsoryUnfolding</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a><span class="hs-special">(</span><span> </span><a href="CoreSyn.html#NoUnfolding"><span class="hs-identifier hs-var">NoUnfolding</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-keyword">import</span><span> </span><a href="IdInfo.html"><span class="hs-identifier">IdInfo</span></a><span>
</span><a name="line-126"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-comment">-- Imported and re-exported</span><span>
</span><a name="line-129"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span class="hs-special">(</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#DictId"><span class="hs-identifier hs-type">DictId</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#JoinId"><span class="hs-identifier hs-type">JoinId</span></a><span class="hs-special">,</span><span>
</span><a name="line-130"></a><span>            </span><a href="Var.html#InId"><span class="hs-identifier hs-type">InId</span></a><span class="hs-special">,</span><span>  </span><a href="Var.html#InVar"><span class="hs-identifier hs-type">InVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-131"></a><span>            </span><a href="Var.html#OutId"><span class="hs-identifier hs-type">OutId</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#OutVar"><span class="hs-identifier hs-type">OutVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-132"></a><span>            </span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#setIdDetails"><span class="hs-identifier hs-var">setIdDetails</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#globaliseId"><span class="hs-identifier hs-var">globaliseId</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#varType"><span class="hs-identifier hs-var">varType</span></a><span class="hs-special">,</span><span>
</span><a name="line-133"></a><span>            </span><a href="Var.html#isId"><span class="hs-identifier hs-var">isId</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isLocalId"><span class="hs-identifier hs-var">isLocalId</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isGlobalId"><span class="hs-identifier hs-var">isGlobalId</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#isExportedId"><span class="hs-identifier hs-var">isExportedId</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-137"></a><span class="hs-keyword">import</span><span> </span><a href="RepType.html"><span class="hs-identifier">RepType</span></a><span>
</span><a name="line-138"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span>
</span><a name="line-139"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-140"></a><span class="hs-keyword">import</span><span> </span><a href="Demand.html"><span class="hs-identifier">Demand</span></a><span>
</span><a name="line-141"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-142"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-143"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-144"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="PrimOp.html"><span class="hs-identifier">PrimOp</span></a><span> </span><span class="hs-special">(</span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span class="hs-keyword">import</span><span> </span><a href="ForeignCall.html"><span class="hs-identifier">ForeignCall</span></a><span>
</span><a name="line-146"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-147"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-148"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-149"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-150"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-151"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-152"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- infixl so you can say (id `set` a `set` b)</span><span>
</span><a name="line-155"></a><span class="hs-keyword">infixl</span><span>  </span><span class="hs-number">1</span><span> </span><span class="hs-special">`</span><a href="Id.html#setIdUnfolding"><span class="hs-identifier hs-var">setIdUnfolding</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-156"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#setIdArity"><span class="hs-identifier hs-var">setIdArity</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-157"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#setIdCallArity"><span class="hs-identifier hs-var">setIdCallArity</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-158"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#setIdOccInfo"><span class="hs-identifier hs-var">setIdOccInfo</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-159"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#setIdOneShotInfo"><span class="hs-identifier hs-var">setIdOneShotInfo</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#setIdSpecialisation"><span class="hs-identifier hs-var">setIdSpecialisation</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-162"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#setInlinePragma"><span class="hs-identifier hs-var">setInlinePragma</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-163"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#setInlineActivation"><span class="hs-identifier hs-var">setInlineActivation</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-164"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#idCafInfo"><span class="hs-identifier hs-var">idCafInfo</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#setIdDemandInfo"><span class="hs-identifier hs-var">setIdDemandInfo</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-167"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#setIdStrictness"><span class="hs-identifier hs-var">setIdStrictness</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#asJoinId"><span class="hs-identifier hs-var">asJoinId</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span>
</span><a name="line-170"></a><span>          </span><span class="hs-special">`</span><a href="Id.html#asJoinId_maybe"><span class="hs-identifier hs-var">asJoinId_maybe</span></a><span class="hs-special">`</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Basic Id manipulation}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-identifier">idName</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-181"></a><a name="idName"><a href="Id.html#idName"><span class="hs-identifier">idName</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Var.varName</span><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-identifier">idUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span>
</span><a name="line-184"></a><a name="idUnique"><a href="Id.html#idUnique"><span class="hs-identifier">idUnique</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#varUnique"><span class="hs-identifier hs-var">Var.varUnique</span></a><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-identifier">idType</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a><span>
</span><a name="line-187"></a><a name="idType"><a href="Id.html#idType"><span class="hs-identifier">idType</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Var.varType</span><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span class="hs-identifier">setIdName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-190"></a><a name="setIdName"><a href="Id.html#setIdName"><span class="hs-identifier">setIdName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setVarName"><span class="hs-identifier hs-var">Var.setVarName</span></a><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-identifier">setIdUnique</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-193"></a><a name="setIdUnique"><a href="Id.html#setIdUnique"><span class="hs-identifier">setIdUnique</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setVarUnique"><span class="hs-identifier hs-var">Var.setVarUnique</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-comment">-- | Not only does this set the 'Id' 'Type', it also evaluates the type to try and</span><span>
</span><a name="line-196"></a><span class="hs-comment">-- reduce space usage</span><span>
</span><a name="line-197"></a><span class="hs-identifier">setIdType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-198"></a><a name="setIdType"><a href="Id.html#setIdType"><span class="hs-identifier">setIdType</span></a></a><span> </span><a name="local-6989586621682319219"><a href="#local-6989586621682319219"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319220"><a href="#local-6989586621682319220"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#seqType"><span class="hs-identifier hs-var">seqType</span></a><span> </span><a href="#local-6989586621682319220"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><a href="Var.html#setVarType"><span class="hs-identifier hs-var">Var.setVarType</span></a><span> </span><a href="#local-6989586621682319219"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621682319220"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-identifier">setIdExported</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-201"></a><a name="setIdExported"><a href="Id.html#setIdExported"><span class="hs-identifier">setIdExported</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setIdExported"><span class="hs-identifier hs-var">Var.setIdExported</span></a><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-identifier">setIdNotExported</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-204"></a><a name="setIdNotExported"><a href="Id.html#setIdNotExported"><span class="hs-identifier">setIdNotExported</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#setIdNotExported"><span class="hs-identifier hs-var">Var.setIdNotExported</span></a><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-identifier">localiseId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-207"></a><span class="hs-comment">-- Make an Id with the same unique and type as the</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- incoming Id, but with an *Internal* Name and *LocalId* flavour</span><span>
</span><a name="line-209"></a><a name="localiseId"><a href="Id.html#localiseId"><span class="hs-identifier">localiseId</span></a></a><span> </span><a name="local-6989586621682319221"><a href="#local-6989586621682319221"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-210"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">isId</span></a><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">isLocalId</span><span> </span><span class="hs-identifier">id</span><span> </span><span class="hs-operator">&amp;&amp;</span><span> </span><span class="hs-identifier">isInternalName</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-211"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319221"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-212"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-213"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkLocalVar"><span class="hs-identifier hs-var">Var.mkLocalVar</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a><span> </span><a href="#local-6989586621682319221"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Name.html#localiseName"><span class="hs-identifier hs-var">localiseName</span></a><span> </span><a href="#local-6989586621682319222"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621682319221"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319221"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-215"></a><span>    </span><a name="local-6989586621682319222"><a href="#local-6989586621682319222"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-6989586621682319221"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-identifier">lazySetIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-218"></a><a name="lazySetIdInfo"><a href="Id.html#lazySetIdInfo"><span class="hs-identifier">lazySetIdInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#lazySetIdInfo"><span class="hs-identifier hs-var">Var.lazySetIdInfo</span></a><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span class="hs-identifier">setIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-221"></a><a name="setIdInfo"><a href="Id.html#setIdInfo"><span class="hs-identifier">setIdInfo</span></a></a><span> </span><a name="local-6989586621682319223"><a href="#local-6989586621682319223"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319224"><a href="#local-6989586621682319224"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319224"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Id.html#lazySetIdInfo"><span class="hs-identifier hs-var">lazySetIdInfo</span></a><span> </span><a href="#local-6989586621682319223"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621682319224"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>        </span><span class="hs-comment">-- Try to avoid space leaks by seq'ing</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span class="hs-identifier">modifyIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-225"></a><a name="modifyIdInfo"><a href="Id.html#modifyIdInfo"><span class="hs-identifier">modifyIdInfo</span></a></a><span> </span><a name="local-6989586621682319225"><a href="#local-6989586621682319225"><span class="hs-identifier">fn</span></a></a><span> </span><a name="local-6989586621682319226"><a href="#local-6989586621682319226"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#setIdInfo"><span class="hs-identifier hs-var">setIdInfo</span></a><span> </span><a href="#local-6989586621682319226"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682319225"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319226"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-comment">-- maybeModifyIdInfo tries to avoid unnecessary thrashing</span><span>
</span><a name="line-228"></a><span class="hs-identifier">maybeModifyIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-229"></a><a name="maybeModifyIdInfo"><a href="Id.html#maybeModifyIdInfo"><span class="hs-identifier">maybeModifyIdInfo</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682319227"><a href="#local-6989586621682319227"><span class="hs-identifier">new_info</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682319228"><a href="#local-6989586621682319228"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#lazySetIdInfo"><span class="hs-identifier hs-var">lazySetIdInfo</span></a><span> </span><a href="#local-6989586621682319228"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621682319227"><span class="hs-identifier hs-var">new_info</span></a><span>
</span><a name="line-230"></a><span class="hs-identifier">maybeModifyIdInfo</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>         </span><a name="local-6989586621682319229"><a href="#local-6989586621682319229"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319229"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Simple Id construction}
*                                                                      *
************************************************************************

Absolutely all Ids are made by mkId.  It is just like Var.mkId,
but in addition it pins free-tyvar-info onto the Id's type,
where it can easily be found.

Note [Free type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~
At one time we cached the free type variables of the type of an Id
at the root of the type in a TyNote.  The idea was to avoid repeating
the free-type-variable calculation.  But it turned out to slow down
the compiler overall. I don't quite know why; perhaps finding free
type variables of an Id isn't all that common whereas applying a
substitution (which changes the free type variables) is more common.
Anyway, we removed it in March 2008.
-}</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-comment">-- | For an explanation of global vs. local 'Id's, see &quot;Var#globalvslocal&quot;</span><span>
</span><a name="line-255"></a><span class="hs-identifier">mkGlobalId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdDetails"><span class="hs-identifier hs-type">IdDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-256"></a><a name="mkGlobalId"><a href="Id.html#mkGlobalId"><span class="hs-identifier">mkGlobalId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkGlobalVar"><span class="hs-identifier hs-var">Var.mkGlobalVar</span></a><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span class="hs-comment">-- | Make a global 'Id' without any extra information at all</span><span>
</span><a name="line-259"></a><span class="hs-identifier">mkVanillaGlobal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-260"></a><a name="mkVanillaGlobal"><a href="Id.html#mkVanillaGlobal"><span class="hs-identifier">mkVanillaGlobal</span></a></a><span> </span><a name="local-6989586621682319230"><a href="#local-6989586621682319230"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621682319231"><a href="#local-6989586621682319231"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkVanillaGlobalWithInfo"><span class="hs-identifier hs-var">mkVanillaGlobalWithInfo</span></a><span> </span><a href="#local-6989586621682319230"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621682319231"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span class="hs-comment">-- | Make a global 'Id' with no global information but some generic 'IdInfo'</span><span>
</span><a name="line-263"></a><span class="hs-identifier">mkVanillaGlobalWithInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-264"></a><a name="mkVanillaGlobalWithInfo"><a href="Id.html#mkVanillaGlobalWithInfo"><span class="hs-identifier">mkVanillaGlobalWithInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkGlobalId"><span class="hs-identifier hs-var">mkGlobalId</span></a><span> </span><a href="IdInfo.html#VanillaId"><span class="hs-identifier hs-var">VanillaId</span></a><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span class="hs-comment">-- | For an explanation of global vs. local 'Id's, see &quot;Var#globalvslocal&quot;</span><span>
</span><a name="line-268"></a><span class="hs-identifier">mkLocalId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-269"></a><a name="mkLocalId"><a href="Id.html#mkLocalId"><span class="hs-identifier">mkLocalId</span></a></a><span> </span><a name="local-6989586621682319232"><a href="#local-6989586621682319232"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621682319233"><a href="#local-6989586621682319233"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkLocalIdWithInfo"><span class="hs-identifier hs-var">mkLocalIdWithInfo</span></a><span> </span><a href="#local-6989586621682319232"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621682319233"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a><span>
</span><a name="line-270"></a><span> </span><span class="hs-comment">-- It's tempting to ASSERT( not (isCoVarType ty) ), but don't. Sometimes,</span><span>
</span><a name="line-271"></a><span> </span><span class="hs-comment">-- the type is a panic. (Search invented_id)</span><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span class="hs-comment">-- | Make a local CoVar</span><span>
</span><a name="line-274"></a><span class="hs-identifier">mkLocalCoVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#CoVar"><span class="hs-identifier hs-type">CoVar</span></a><span>
</span><a name="line-275"></a><a name="mkLocalCoVar"><a href="Id.html#mkLocalCoVar"><span class="hs-identifier">mkLocalCoVar</span></a></a><span> </span><a name="local-6989586621682319234"><a href="#local-6989586621682319234"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621682319235"><a href="#local-6989586621682319235"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-276"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isCoVarType</span><span> </span><span class="hs-identifier">ty</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span>    </span><a href="Var.html#mkLocalVar"><span class="hs-identifier hs-var">Var.mkLocalVar</span></a><span> </span><a href="IdInfo.html#CoVarId"><span class="hs-identifier hs-var">CoVarId</span></a><span> </span><a href="#local-6989586621682319234"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621682319235"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-comment">-- | Like 'mkLocalId', but checks the type to see if it should make a covar</span><span>
</span><a name="line-280"></a><span class="hs-identifier">mkLocalIdOrCoVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-281"></a><a name="mkLocalIdOrCoVar"><a href="Id.html#mkLocalIdOrCoVar"><span class="hs-identifier">mkLocalIdOrCoVar</span></a></a><span> </span><a name="local-6989586621682319236"><a href="#local-6989586621682319236"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621682319237"><a href="#local-6989586621682319237"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-282"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isCoVarType"><span class="hs-identifier hs-var">isCoVarType</span></a><span> </span><a href="#local-6989586621682319237"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkLocalCoVar"><span class="hs-identifier hs-var">mkLocalCoVar</span></a><span> </span><a href="#local-6989586621682319236"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621682319237"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-283"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a><span>    </span><a href="#local-6989586621682319236"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621682319237"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span class="hs-comment">-- | Make a local id, with the IdDetails set to CoVarId if the type indicates</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- so.</span><span>
</span><a name="line-287"></a><span class="hs-identifier">mkLocalIdOrCoVarWithInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-288"></a><a name="mkLocalIdOrCoVarWithInfo"><a href="Id.html#mkLocalIdOrCoVarWithInfo"><span class="hs-identifier">mkLocalIdOrCoVarWithInfo</span></a></a><span> </span><a name="local-6989586621682319238"><a href="#local-6989586621682319238"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621682319239"><a href="#local-6989586621682319239"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621682319240"><a href="#local-6989586621682319240"><span class="hs-identifier">info</span></a></a><span>
</span><a name="line-289"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkLocalVar"><span class="hs-identifier hs-var">Var.mkLocalVar</span></a><span> </span><a href="#local-6989586621682319241"><span class="hs-identifier hs-var">details</span></a><span> </span><a href="#local-6989586621682319238"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621682319239"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621682319240"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-290"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-291"></a><span>    </span><a name="local-6989586621682319241"><a href="#local-6989586621682319241"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Type.html#isCoVarType"><span class="hs-identifier hs-var">isCoVarType</span></a><span> </span><a href="#local-6989586621682319239"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#CoVarId"><span class="hs-identifier hs-var">CoVarId</span></a><span>
</span><a name="line-292"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#VanillaId"><span class="hs-identifier hs-var">VanillaId</span></a><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span>    </span><span class="hs-comment">-- proper ids only; no covars!</span><span>
</span><a name="line-295"></a><span class="hs-identifier">mkLocalIdWithInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-296"></a><a name="mkLocalIdWithInfo"><a href="Id.html#mkLocalIdWithInfo"><span class="hs-identifier">mkLocalIdWithInfo</span></a></a><span> </span><a name="local-6989586621682319242"><a href="#local-6989586621682319242"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621682319243"><a href="#local-6989586621682319243"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621682319244"><a href="#local-6989586621682319244"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkLocalVar"><span class="hs-identifier hs-var">Var.mkLocalVar</span></a><span> </span><a href="IdInfo.html#VanillaId"><span class="hs-identifier hs-var">VanillaId</span></a><span> </span><a href="#local-6989586621682319242"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621682319243"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621682319244"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-297"></a><span>        </span><span class="hs-comment">-- Note [Free type variables]</span><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span class="hs-comment">-- | Create a local 'Id' that is marked as exported.</span><span>
</span><a name="line-300"></a><span class="hs-comment">-- This prevents things attached to it from being removed as dead code.</span><span>
</span><a name="line-301"></a><span class="hs-comment">-- See Note [Exported LocalIds]</span><span>
</span><a name="line-302"></a><span class="hs-identifier">mkExportedLocalId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="IdInfo.html#IdDetails"><span class="hs-identifier hs-type">IdDetails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-303"></a><a name="mkExportedLocalId"><a href="Id.html#mkExportedLocalId"><span class="hs-identifier">mkExportedLocalId</span></a></a><span> </span><a name="local-6989586621682319245"><a href="#local-6989586621682319245"><span class="hs-identifier">details</span></a></a><span> </span><a name="local-6989586621682319246"><a href="#local-6989586621682319246"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621682319247"><a href="#local-6989586621682319247"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkExportedLocalVar"><span class="hs-identifier hs-var">Var.mkExportedLocalVar</span></a><span> </span><a href="#local-6989586621682319245"><span class="hs-identifier hs-var">details</span></a><span> </span><a href="#local-6989586621682319246"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621682319247"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a><span>
</span><a name="line-304"></a><span>        </span><span class="hs-comment">-- Note [Free type variables]</span><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-identifier">mkExportedVanillaId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-307"></a><a name="mkExportedVanillaId"><a href="Id.html#mkExportedVanillaId"><span class="hs-identifier">mkExportedVanillaId</span></a></a><span> </span><a name="local-6989586621682319248"><a href="#local-6989586621682319248"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621682319249"><a href="#local-6989586621682319249"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#mkExportedLocalVar"><span class="hs-identifier hs-var">Var.mkExportedLocalVar</span></a><span> </span><a href="IdInfo.html#VanillaId"><span class="hs-identifier hs-var">VanillaId</span></a><span> </span><a href="#local-6989586621682319248"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621682319249"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a><span>
</span><a name="line-308"></a><span>        </span><span class="hs-comment">-- Note [Free type variables]</span><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span class="hs-comment">-- | Create a system local 'Id'. These are local 'Id's (see &quot;Var#globalvslocal&quot;)</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- that are created by the compiler out of thin air</span><span>
</span><a name="line-313"></a><span class="hs-identifier">mkSysLocal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-314"></a><a name="mkSysLocal"><a href="Id.html#mkSysLocal"><span class="hs-identifier">mkSysLocal</span></a></a><span> </span><a name="local-6989586621682319250"><a href="#local-6989586621682319250"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621682319251"><a href="#local-6989586621682319251"><span class="hs-identifier">uniq</span></a></a><span> </span><a name="local-6989586621682319252"><a href="#local-6989586621682319252"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">isCoVarType</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>                        </span><a href="Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#mkSystemVarName"><span class="hs-identifier hs-var">mkSystemVarName</span></a><span> </span><a href="#local-6989586621682319251"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621682319250"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319252"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span class="hs-comment">-- | Like 'mkSysLocal', but checks to see if we have a covar type</span><span>
</span><a name="line-318"></a><span class="hs-identifier">mkSysLocalOrCoVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-319"></a><a name="mkSysLocalOrCoVar"><a href="Id.html#mkSysLocalOrCoVar"><span class="hs-identifier">mkSysLocalOrCoVar</span></a></a><span> </span><a name="local-6989586621682319253"><a href="#local-6989586621682319253"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621682319254"><a href="#local-6989586621682319254"><span class="hs-identifier">uniq</span></a></a><span> </span><a name="local-6989586621682319255"><a href="#local-6989586621682319255"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-320"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#mkSystemVarName"><span class="hs-identifier hs-var">mkSystemVarName</span></a><span> </span><a href="#local-6989586621682319254"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621682319253"><span class="hs-identifier hs-var">fs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319255"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-identifier">mkSysLocalM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="UniqSupply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a><span> </span><a href="#local-6989586621682319218"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682319218"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-323"></a><a name="mkSysLocalM"><a href="Id.html#mkSysLocalM"><span class="hs-identifier">mkSysLocalM</span></a></a><span> </span><a name="local-6989586621682319256"><a href="#local-6989586621682319256"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621682319257"><a href="#local-6989586621682319257"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#getUniqueM"><span class="hs-identifier hs-var">getUniqueM</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682319258"><a href="#local-6989586621682319258"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Id.html#mkSysLocal"><span class="hs-identifier hs-var">mkSysLocal</span></a><span> </span><a href="#local-6989586621682319256"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="#local-6989586621682319258"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621682319257"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span class="hs-identifier">mkSysLocalOrCoVarM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="UniqSupply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a><span> </span><a href="#local-6989586621682319217"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682319217"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-326"></a><a name="mkSysLocalOrCoVarM"><a href="Id.html#mkSysLocalOrCoVarM"><span class="hs-identifier">mkSysLocalOrCoVarM</span></a></a><span> </span><a name="local-6989586621682319259"><a href="#local-6989586621682319259"><span class="hs-identifier">fs</span></a></a><span> </span><a name="local-6989586621682319260"><a href="#local-6989586621682319260"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-327"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#getUniqueM"><span class="hs-identifier hs-var">getUniqueM</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682319261"><a href="#local-6989586621682319261"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Id.html#mkSysLocalOrCoVar"><span class="hs-identifier hs-var">mkSysLocalOrCoVar</span></a><span> </span><a href="#local-6989586621682319259"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="#local-6989586621682319261"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621682319260"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span class="hs-comment">-- | Create a user local 'Id'. These are local 'Id's (see &quot;Var#globalvslocal&quot;) with a name and location that the user might recognize</span><span>
</span><a name="line-330"></a><span class="hs-identifier">mkUserLocal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-331"></a><a name="mkUserLocal"><a href="Id.html#mkUserLocal"><span class="hs-identifier">mkUserLocal</span></a></a><span> </span><a name="local-6989586621682319262"><a href="#local-6989586621682319262"><span class="hs-identifier">occ</span></a></a><span> </span><a name="local-6989586621682319263"><a href="#local-6989586621682319263"><span class="hs-identifier">uniq</span></a></a><span> </span><a name="local-6989586621682319264"><a href="#local-6989586621682319264"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621682319265"><a href="#local-6989586621682319265"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">isCoVarType</span><span> </span><span class="hs-identifier">ty</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-332"></a><span>                              </span><a href="Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a><span> </span><a href="#local-6989586621682319263"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621682319262"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-6989586621682319265"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319264"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-333"></a><span>
</span><a name="line-334"></a><span class="hs-comment">-- | Like 'mkUserLocal', but checks if we have a coercion type</span><span>
</span><a name="line-335"></a><span class="hs-identifier">mkUserLocalOrCoVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-336"></a><a name="mkUserLocalOrCoVar"><a href="Id.html#mkUserLocalOrCoVar"><span class="hs-identifier">mkUserLocalOrCoVar</span></a></a><span> </span><a name="local-6989586621682319266"><a href="#local-6989586621682319266"><span class="hs-identifier">occ</span></a></a><span> </span><a name="local-6989586621682319267"><a href="#local-6989586621682319267"><span class="hs-identifier">uniq</span></a></a><span> </span><a name="local-6989586621682319268"><a href="#local-6989586621682319268"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621682319269"><a href="#local-6989586621682319269"><span class="hs-identifier">loc</span></a></a><span>
</span><a name="line-337"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a><span> </span><a href="#local-6989586621682319267"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621682319266"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="#local-6989586621682319269"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319268"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span class="hs-comment">{-
Make some local @Ids@ for a template @CoreExpr@.  These have bogus
@Uniques@, but that's OK because the templates are supposed to be
instantiated before use.
-}</span><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-comment">-- | Workers get local names. &quot;CoreTidy&quot; will externalise these if necessary</span><span>
</span><a name="line-346"></a><span class="hs-identifier">mkWorkerId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-347"></a><a name="mkWorkerId"><a href="Id.html#mkWorkerId"><span class="hs-identifier">mkWorkerId</span></a></a><span> </span><a name="local-6989586621682319270"><a href="#local-6989586621682319270"><span class="hs-identifier">uniq</span></a></a><span> </span><a name="local-6989586621682319271"><a href="#local-6989586621682319271"><span class="hs-identifier">unwrkr</span></a></a><span> </span><a name="local-6989586621682319272"><a href="#local-6989586621682319272"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-348"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#mkDerivedInternalName"><span class="hs-identifier hs-var">mkDerivedInternalName</span></a><span> </span><a href="OccName.html#mkWorkerOcc"><span class="hs-identifier hs-var">mkWorkerOcc</span></a><span> </span><a href="#local-6989586621682319270"><span class="hs-identifier hs-var">uniq</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-6989586621682319271"><span class="hs-identifier hs-var">unwrkr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319272"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span class="hs-comment">-- | Create a /template local/: a family of system local 'Id's in bijection with @Int@s, typically used in unfoldings</span><span>
</span><a name="line-351"></a><span class="hs-identifier">mkTemplateLocal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-352"></a><a name="mkTemplateLocal"><a href="Id.html#mkTemplateLocal"><span class="hs-identifier">mkTemplateLocal</span></a></a><span> </span><a name="local-6989586621682319273"><a href="#local-6989586621682319273"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621682319274"><a href="#local-6989586621682319274"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkSysLocalOrCoVar"><span class="hs-identifier hs-var">mkSysLocalOrCoVar</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;v&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Unique.html#mkBuiltinUnique"><span class="hs-identifier hs-var">mkBuiltinUnique</span></a><span> </span><a href="#local-6989586621682319273"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319274"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- | Create a template local for a series of types</span><span>
</span><a name="line-355"></a><span class="hs-identifier">mkTemplateLocals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>
</span><a name="line-356"></a><a name="mkTemplateLocals"><a href="Id.html#mkTemplateLocals"><span class="hs-identifier">mkTemplateLocals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkTemplateLocalsNum"><span class="hs-identifier hs-var">mkTemplateLocalsNum</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span class="hs-comment">-- | Create a template local for a series of type, but start from a specified template local</span><span>
</span><a name="line-359"></a><span class="hs-identifier">mkTemplateLocalsNum</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>
</span><a name="line-360"></a><a name="mkTemplateLocalsNum"><a href="Id.html#mkTemplateLocalsNum"><span class="hs-identifier">mkTemplateLocalsNum</span></a></a><span> </span><a name="local-6989586621682319275"><a href="#local-6989586621682319275"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621682319276"><a href="#local-6989586621682319276"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="Id.html#mkTemplateLocal"><span class="hs-identifier hs-var">mkTemplateLocal</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621682319275"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621682319276"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-comment">{- Note [Exported LocalIds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
We use mkExportedLocalId for things like
 - Dictionary functions (DFunId)
 - Wrapper and matcher Ids for pattern synonyms
 - Default methods for classes
 - Pattern-synonym matcher and builder Ids
 - etc

They marked as &quot;exported&quot; in the sense that they should be kept alive
even if apparently unused in other bindings, and not dropped as dead
code by the occurrence analyser.  (But &quot;exported&quot; here does not mean
&quot;brought into lexical scope by an import declaration&quot;. Indeed these
things are always internal Ids that the user never sees.)

It's very important that they are *LocalIds*, not GlobalIds, for lots
of reasons:

 * We want to treat them as free variables for the purpose of
   dependency analysis (e.g. CoreFVs.exprFreeVars).

 * Look them up in the current substitution when we come across
   occurrences of them (in Subst.lookupIdSubst). Lacking this we
   can get an out-of-date unfolding, which can in turn make the
   simplifier go into an infinite loop (Trac #9857)

 * Ensure that for dfuns that the specialiser does not float dict uses
   above their defns, which would prevent good simplifications happening.

 * The strictness analyser treats a occurrence of a GlobalId as
   imported and assumes it contains strictness in its IdInfo, which
   isn't true if the thing is bound in the same module as the
   occurrence.

In CoreTidy we must make all these LocalIds into GlobalIds, so that in
importing modules (in --make mode) we treat them as properly global.
That is what is happening in, say tidy_insts in TidyPgm.

************************************************************************
*                                                                      *
\subsection{Special Ids}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><span class="hs-comment">-- | If the 'Id' is that for a record selector, extract the 'sel_tycon'. Panic otherwise.</span><span>
</span><a name="line-408"></a><span class="hs-identifier">recordSelectorTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a><span>
</span><a name="line-409"></a><a name="recordSelectorTyCon"><a href="Id.html#recordSelectorTyCon"><span class="hs-identifier">recordSelectorTyCon</span></a></a><span> </span><a name="local-6989586621682319277"><a href="#local-6989586621682319277"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-410"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319277"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-411"></a><span>        </span><a href="IdInfo.html#RecSelId"><span class="hs-identifier hs-var">RecSelId</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sel_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682319278"><a href="#local-6989586621682319278"><span class="hs-identifier">parent</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682319278"><span class="hs-identifier hs-var">parent</span></a><span>
</span><a name="line-412"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;recordSelectorTyCon&quot;</span><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><span class="hs-identifier">isRecordSelector</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-416"></a><span class="hs-identifier">isNaughtyRecordSelector</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-417"></a><span class="hs-identifier">isPatSynRecordSelector</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-418"></a><span class="hs-identifier">isDataConRecordSelector</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-419"></a><span class="hs-identifier">isPrimOpId</span><span>              </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-420"></a><span class="hs-identifier">isFCallId</span><span>               </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-421"></a><span class="hs-identifier">isDataConWorkId</span><span>         </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-422"></a><span class="hs-identifier">isDFunId</span><span>                </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-identifier">isClassOpId_maybe</span><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>
</span><a name="line-425"></a><span class="hs-identifier">isPrimOpId_maybe</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="PrimOp.html#PrimOp"><span class="hs-identifier hs-type">PrimOp</span></a><span>
</span><a name="line-426"></a><span class="hs-identifier">isFCallId_maybe</span><span>         </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="ForeignCall.html#ForeignCall"><span class="hs-identifier hs-type">ForeignCall</span></a><span>
</span><a name="line-427"></a><span class="hs-identifier">isDataConWorkId_maybe</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>
</span><a name="line-428"></a><span>
</span><a name="line-429"></a><a name="isRecordSelector"><a href="Id.html#isRecordSelector"><span class="hs-identifier">isRecordSelector</span></a></a><span> </span><a name="local-6989586621682319279"><a href="#local-6989586621682319279"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319279"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-430"></a><span>                        </span><a href="IdInfo.html#RecSelId"><span class="hs-identifier hs-var">RecSelId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-431"></a><span>                        </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><a name="isDataConRecordSelector"><a href="Id.html#isDataConRecordSelector"><span class="hs-identifier">isDataConRecordSelector</span></a></a><span> </span><a name="local-6989586621682319280"><a href="#local-6989586621682319280"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319280"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-434"></a><span>                        </span><a href="IdInfo.html#RecSelId"><span class="hs-identifier hs-var">RecSelId</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">sel_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-435"></a><span>                        </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-436"></a><span>
</span><a name="line-437"></a><a name="isPatSynRecordSelector"><a href="Id.html#isPatSynRecordSelector"><span class="hs-identifier">isPatSynRecordSelector</span></a></a><span> </span><a name="local-6989586621682319281"><a href="#local-6989586621682319281"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319281"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-438"></a><span>                        </span><a href="IdInfo.html#RecSelId"><span class="hs-identifier hs-var">RecSelId</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">sel_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#RecSelPatSyn"><span class="hs-identifier hs-var">RecSelPatSyn</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-439"></a><span>                        </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><a name="isNaughtyRecordSelector"><a href="Id.html#isNaughtyRecordSelector"><span class="hs-identifier">isNaughtyRecordSelector</span></a></a><span> </span><a name="local-6989586621682319282"><a href="#local-6989586621682319282"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319282"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-442"></a><span>                        </span><a href="IdInfo.html#RecSelId"><span class="hs-identifier hs-var">RecSelId</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sel_naughty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682319283"><a href="#local-6989586621682319283"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682319283"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-443"></a><span>                        </span><span class="hs-identifier">_</span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><a name="isClassOpId_maybe"><a href="Id.html#isClassOpId_maybe"><span class="hs-identifier">isClassOpId_maybe</span></a></a><span> </span><a name="local-6989586621682319284"><a href="#local-6989586621682319284"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319284"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-446"></a><span>                        </span><a href="IdInfo.html#ClassOpId"><span class="hs-identifier hs-var">ClassOpId</span></a><span> </span><a name="local-6989586621682319285"><a href="#local-6989586621682319285"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682319285"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-447"></a><span>                        </span><a name="local-6989586621682319286"><a href="#local-6989586621682319286"><span class="hs-identifier">_other</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-448"></a><span>
</span><a name="line-449"></a><a name="isPrimOpId"><a href="Id.html#isPrimOpId"><span class="hs-identifier">isPrimOpId</span></a></a><span> </span><a name="local-6989586621682319287"><a href="#local-6989586621682319287"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319287"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-450"></a><span>                        </span><a href="IdInfo.html#PrimOpId"><span class="hs-identifier hs-var">PrimOpId</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-451"></a><span>                        </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><a name="isDFunId"><a href="Id.html#isDFunId"><span class="hs-identifier">isDFunId</span></a></a><span> </span><a name="local-6989586621682319288"><a href="#local-6989586621682319288"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319288"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-454"></a><span>                        </span><a href="IdInfo.html#DFunId"><span class="hs-identifier hs-var">DFunId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-455"></a><span>                        </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><a name="isPrimOpId_maybe"><a href="Id.html#isPrimOpId_maybe"><span class="hs-identifier">isPrimOpId_maybe</span></a></a><span> </span><a name="local-6989586621682319289"><a href="#local-6989586621682319289"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319289"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-458"></a><span>                        </span><a href="IdInfo.html#PrimOpId"><span class="hs-identifier hs-var">PrimOpId</span></a><span> </span><a name="local-6989586621682319290"><a href="#local-6989586621682319290"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682319290"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-459"></a><span>                        </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-460"></a><span>
</span><a name="line-461"></a><a name="isFCallId"><a href="Id.html#isFCallId"><span class="hs-identifier">isFCallId</span></a></a><span> </span><a name="local-6989586621682319291"><a href="#local-6989586621682319291"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319291"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-462"></a><span>                        </span><a href="IdInfo.html#FCallId"><span class="hs-identifier hs-var">FCallId</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-463"></a><span>                        </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-464"></a><span>
</span><a name="line-465"></a><a name="isFCallId_maybe"><a href="Id.html#isFCallId_maybe"><span class="hs-identifier">isFCallId_maybe</span></a></a><span> </span><a name="local-6989586621682319292"><a href="#local-6989586621682319292"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319292"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-466"></a><span>                        </span><a href="IdInfo.html#FCallId"><span class="hs-identifier hs-var">FCallId</span></a><span> </span><a name="local-6989586621682319293"><a href="#local-6989586621682319293"><span class="hs-identifier">call</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682319293"><span class="hs-identifier hs-var">call</span></a><span>
</span><a name="line-467"></a><span>                        </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><a name="isDataConWorkId"><a href="Id.html#isDataConWorkId"><span class="hs-identifier">isDataConWorkId</span></a></a><span> </span><a name="local-6989586621682319294"><a href="#local-6989586621682319294"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319294"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-470"></a><span>                        </span><a href="IdInfo.html#DataConWorkId"><span class="hs-identifier hs-var">DataConWorkId</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-471"></a><span>                        </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-472"></a><span>
</span><a name="line-473"></a><a name="isDataConWorkId_maybe"><a href="Id.html#isDataConWorkId_maybe"><span class="hs-identifier">isDataConWorkId_maybe</span></a></a><span> </span><a name="local-6989586621682319295"><a href="#local-6989586621682319295"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319295"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-474"></a><span>                        </span><a href="IdInfo.html#DataConWorkId"><span class="hs-identifier hs-var">DataConWorkId</span></a><span> </span><a name="local-6989586621682319296"><a href="#local-6989586621682319296"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682319296"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-475"></a><span>                        </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-476"></a><span>
</span><a name="line-477"></a><span class="hs-identifier">isDataConId_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>
</span><a name="line-478"></a><a name="isDataConId_maybe"><a href="Id.html#isDataConId_maybe"><span class="hs-identifier">isDataConId_maybe</span></a></a><span> </span><a name="local-6989586621682319297"><a href="#local-6989586621682319297"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319297"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-479"></a><span>                         </span><a href="IdInfo.html#DataConWorkId"><span class="hs-identifier hs-var">DataConWorkId</span></a><span> </span><a name="local-6989586621682319298"><a href="#local-6989586621682319298"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682319298"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-480"></a><span>                         </span><a href="IdInfo.html#DataConWrapId"><span class="hs-identifier hs-var">DataConWrapId</span></a><span> </span><a name="local-6989586621682319299"><a href="#local-6989586621682319299"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682319299"><span class="hs-identifier hs-var">con</span></a><span>
</span><a name="line-481"></a><span>                         </span><span class="hs-identifier">_</span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span class="hs-identifier">isJoinId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-484"></a><span class="hs-comment">-- It is convenient in SetLevels.lvlMFE to apply isJoinId</span><span>
</span><a name="line-485"></a><span class="hs-comment">-- to the free vars of an expression, so it's convenient</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- if it returns False for type variables</span><span>
</span><a name="line-487"></a><a name="isJoinId"><a href="Id.html#isJoinId"><span class="hs-identifier">isJoinId</span></a></a><span> </span><a name="local-6989586621682319300"><a href="#local-6989586621682319300"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-488"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isId"><span class="hs-identifier hs-var">isId</span></a><span> </span><a href="#local-6989586621682319300"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319300"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-489"></a><span>                </span><a href="IdInfo.html#JoinId"><span class="hs-identifier hs-var">JoinId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-490"></a><span>                </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-491"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-492"></a><span>
</span><a name="line-493"></a><span class="hs-identifier">isJoinId_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BasicTypes.html#JoinArity"><span class="hs-identifier hs-type">JoinArity</span></a><span>
</span><a name="line-494"></a><a name="isJoinId_maybe"><a href="Id.html#isJoinId_maybe"><span class="hs-identifier">isJoinId_maybe</span></a></a><span> </span><a name="local-6989586621682319301"><a href="#local-6989586621682319301"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-495"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isId"><span class="hs-identifier hs-var">isId</span></a><span> </span><a href="#local-6989586621682319301"><span class="hs-identifier hs-var">id</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isId</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><a href="Var.html#isId"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-496"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319301"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-497"></a><span>                </span><a href="IdInfo.html#JoinId"><span class="hs-identifier hs-var">JoinId</span></a><span> </span><a name="local-6989586621682319302"><a href="#local-6989586621682319302"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682319302"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-498"></a><span>                </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-499"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-500"></a><span>
</span><a name="line-501"></a><span class="hs-identifier">idDataCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>
</span><a name="line-502"></a><span class="hs-comment">-- ^ Get from either the worker or the wrapper 'Id' to the 'DataCon'. Currently used only in the desugarer.</span><span>
</span><a name="line-503"></a><span class="hs-comment">--</span><span>
</span><a name="line-504"></a><span class="hs-comment">-- INVARIANT: @idDataCon (dataConWrapId d) = d@: remember, 'dataConWrapId' can return either the wrapper or the worker</span><span>
</span><a name="line-505"></a><a name="idDataCon"><a href="Id.html#idDataCon"><span class="hs-identifier">idDataCon</span></a></a><span> </span><a name="local-6989586621682319303"><a href="#local-6989586621682319303"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#isDataConId_maybe"><span class="hs-identifier hs-var">isDataConId_maybe</span></a><span> </span><a href="#local-6989586621682319303"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;idDataCon&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621682319303"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span class="hs-identifier">hasNoBinding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-508"></a><span class="hs-comment">-- ^ Returns @True@ of an 'Id' which may not have a</span><span>
</span><a name="line-509"></a><span class="hs-comment">-- binding, even though it is defined in this module.</span><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span class="hs-comment">-- Data constructor workers used to be things of this kind, but</span><span>
</span><a name="line-512"></a><span class="hs-comment">-- they aren't any more.  Instead, we inject a binding for</span><span>
</span><a name="line-513"></a><span class="hs-comment">-- them at the CorePrep stage.</span><span>
</span><a name="line-514"></a><span class="hs-comment">-- EXCEPT: unboxed tuples, which definitely have no binding</span><span>
</span><a name="line-515"></a><a name="hasNoBinding"><a href="Id.html#hasNoBinding"><span class="hs-identifier">hasNoBinding</span></a></a><span> </span><a name="local-6989586621682319304"><a href="#local-6989586621682319304"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319304"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-516"></a><span>                        </span><a href="IdInfo.html#PrimOpId"><span class="hs-identifier hs-var">PrimOpId</span></a><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>        </span><span class="hs-comment">-- See Note [Primop wrappers]</span><span>
</span><a name="line-517"></a><span>                        </span><a href="IdInfo.html#FCallId"><span class="hs-identifier hs-var">FCallId</span></a><span> </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-518"></a><span>                        </span><a href="IdInfo.html#DataConWorkId"><span class="hs-identifier hs-var">DataConWorkId</span></a><span> </span><a name="local-6989586621682319305"><a href="#local-6989586621682319305"><span class="hs-identifier">dc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataCon.html#isUnboxedTupleCon"><span class="hs-identifier hs-var">isUnboxedTupleCon</span></a><span> </span><a href="#local-6989586621682319305"><span class="hs-identifier hs-var">dc</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="DataCon.html#isUnboxedSumCon"><span class="hs-identifier hs-var">isUnboxedSumCon</span></a><span> </span><a href="#local-6989586621682319305"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-519"></a><span>                        </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#isCompulsoryUnfolding"><span class="hs-identifier hs-var">isCompulsoryUnfolding</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idUnfolding"><span class="hs-identifier hs-var">idUnfolding</span></a><span> </span><a href="#local-6989586621682319304"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-520"></a><span>                                            </span><span class="hs-comment">-- See Note [Levity-polymorphic Ids]</span><span>
</span><a name="line-521"></a><span>
</span><a name="line-522"></a><span class="hs-identifier">isImplicitId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-523"></a><span class="hs-comment">-- ^ 'isImplicitId' tells whether an 'Id's info is implied by other</span><span>
</span><a name="line-524"></a><span class="hs-comment">-- declarations, so we don't need to put its signature in an interface</span><span>
</span><a name="line-525"></a><span class="hs-comment">-- file, even if it's mentioned in some other interface unfolding.</span><span>
</span><a name="line-526"></a><a name="isImplicitId"><a href="Id.html#isImplicitId"><span class="hs-identifier">isImplicitId</span></a></a><span> </span><a name="local-6989586621682319306"><a href="#local-6989586621682319306"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-527"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319306"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-528"></a><span>        </span><a href="IdInfo.html#FCallId"><span class="hs-identifier hs-var">FCallId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-529"></a><span>        </span><a href="IdInfo.html#ClassOpId"><span class="hs-identifier hs-var">ClassOpId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-530"></a><span>        </span><a href="IdInfo.html#PrimOpId"><span class="hs-identifier hs-var">PrimOpId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-531"></a><span>        </span><a href="IdInfo.html#DataConWorkId"><span class="hs-identifier hs-var">DataConWorkId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-532"></a><span>        </span><a href="IdInfo.html#DataConWrapId"><span class="hs-identifier hs-var">DataConWrapId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-533"></a><span>                </span><span class="hs-comment">-- These are implied by their type or class decl;</span><span>
</span><a name="line-534"></a><span>                </span><span class="hs-comment">-- remember that all type and class decls appear in the interface file.</span><span>
</span><a name="line-535"></a><span>                </span><span class="hs-comment">-- The dfun id is not an implicit Id; it must *not* be omitted, because</span><span>
</span><a name="line-536"></a><span>                </span><span class="hs-comment">-- it carries version info for the instance decl</span><span>
</span><a name="line-537"></a><span>        </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-538"></a><span>
</span><a name="line-539"></a><span class="hs-identifier">idIsFrom</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-540"></a><a name="idIsFrom"><a href="Id.html#idIsFrom"><span class="hs-identifier">idIsFrom</span></a></a><span> </span><a name="local-6989586621682319307"><a href="#local-6989586621682319307"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621682319308"><a href="#local-6989586621682319308"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a><span> </span><a href="#local-6989586621682319307"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-6989586621682319308"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>
</span><a name="line-542"></a><span class="hs-comment">{- Note [Levity-polymorphic Ids]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Some levity-polymorphic Ids must be applied and and inlined, not left
un-saturated.  Example:
  unsafeCoerceId :: forall r1 r2 (a::TYPE r1) (b::TYPE r2). a -&gt; b

This has a compulsory unfolding because we can't lambda-bind those
arguments.  But the compulsory unfolding may leave levity-polymorphic
lambdas if it is not applied to enough arguments; e.g. (Trac #14561)
  bad :: forall (a :: TYPE r). a -&gt; a
  bad = unsafeCoerce#

The desugar has special magic to detect such cases: DsExpr.badUseOfLevPolyPrimop.
And we want that magic to apply to levity-polymorphic compulsory-inline things.
The easiest way to do this is for hasNoBinding to return True of all things
that have compulsory unfolding.  A very Ids with a compulsory unfolding also
have a binding, but it does not harm to say they don't here, and its a very
simple way to fix Trac #14561.

Note [Primop wrappers]
~~~~~~~~~~~~~~~~~~~~~~
Currently hasNoBinding claims that PrimOpIds don't have a curried
function definition.  But actually they do, in GHC.PrimopWrappers,
which is auto-generated from prelude/primops.txt.pp.  So actually, hasNoBinding
could return 'False' for PrimOpIds.

But we'd need to add something in CoreToStg to swizzle any unsaturated
applications of GHC.Prim.plusInt# to GHC.PrimopWrappers.plusInt#.

Nota Bene: GHC.PrimopWrappers is needed *regardless*, because it's
used by GHCi, which does not implement primops direct at all.
-}</span><span>
</span><a name="line-574"></a><span>
</span><a name="line-575"></a><span class="hs-identifier">isDeadBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-576"></a><a name="isDeadBinder"><a href="Id.html#isDeadBinder"><span class="hs-identifier">isDeadBinder</span></a></a><span> </span><a name="local-6989586621682319309"><a href="#local-6989586621682319309"><span class="hs-identifier">bndr</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isId"><span class="hs-identifier hs-var">isId</span></a><span> </span><a href="#local-6989586621682319309"><span class="hs-identifier hs-var">bndr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#isDeadOcc"><span class="hs-identifier hs-var">isDeadOcc</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idOccInfo"><span class="hs-identifier hs-var">idOccInfo</span></a><span> </span><a href="#local-6989586621682319309"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-577"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>   </span><span class="hs-comment">-- TyVars count as not dead</span><span>
</span><a name="line-578"></a><span>
</span><a name="line-579"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Evidence variables
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-586"></a><span>
</span><a name="line-587"></a><span class="hs-identifier">isEvVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-588"></a><a name="isEvVar"><a href="Id.html#isEvVar"><span class="hs-identifier">isEvVar</span></a></a><span> </span><a name="local-6989586621682319310"><a href="#local-6989586621682319310"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isEvVarType"><span class="hs-identifier hs-var">isEvVarType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621682319310"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span>
</span><a name="line-589"></a><span>
</span><a name="line-590"></a><span class="hs-identifier">isDictId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-591"></a><a name="isDictId"><a href="Id.html#isDictId"><span class="hs-identifier">isDictId</span></a></a><span> </span><a name="local-6989586621682319311"><a href="#local-6989586621682319311"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isDictTy"><span class="hs-identifier hs-var">isDictTy</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621682319311"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-592"></a><span>
</span><a name="line-593"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Join variables
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-600"></a><span>
</span><a name="line-601"></a><span class="hs-identifier">idJoinArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#JoinId"><span class="hs-identifier hs-type">JoinId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#JoinArity"><span class="hs-identifier hs-type">JoinArity</span></a><span>
</span><a name="line-602"></a><a name="idJoinArity"><a href="Id.html#idJoinArity"><span class="hs-identifier">idJoinArity</span></a></a><span> </span><a name="local-6989586621682319312"><a href="#local-6989586621682319312"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#isJoinId_maybe"><span class="hs-identifier hs-var">isJoinId_maybe</span></a><span> </span><a href="#local-6989586621682319312"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;idJoinArity&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621682319312"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-603"></a><span>
</span><a name="line-604"></a><span class="hs-identifier">asJoinId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#JoinArity"><span class="hs-identifier hs-type">JoinArity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#JoinId"><span class="hs-identifier hs-type">JoinId</span></a><span>
</span><a name="line-605"></a><a name="asJoinId"><a href="Id.html#asJoinId"><span class="hs-identifier">asJoinId</span></a></a><span> </span><a name="local-6989586621682319313"><a href="#local-6989586621682319313"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319314"><a href="#local-6989586621682319314"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><a href="Outputable.html#warnPprTrace"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">isLocalId</span><span> </span><a href="Var.html#isLocalId"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-606"></a><span>                         </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;global id being marked as join var:&quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">)</span><span>
</span><a name="line-607"></a><span>                    </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><a href="Outputable.html#warnPprTrace"><span class="hs-identifier hs-var">not</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_vanilla_or_join</span><span> </span><a href="#local-6989586621682319315"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-608"></a><span>                         </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">id</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">pprIdDetails</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">idDetails</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-609"></a><span>                    </span><a href="#local-6989586621682319313"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">`</span><a href="Var.html#setIdDetails"><span class="hs-identifier hs-var">setIdDetails</span></a><span class="hs-special">`</span><span> </span><a href="IdInfo.html#JoinId"><span class="hs-identifier hs-var">JoinId</span></a><span> </span><a href="#local-6989586621682319314"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-610"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-611"></a><span>    </span><a name="local-6989586621682319315"><a href="#local-6989586621682319315"><span class="hs-identifier">is_vanilla_or_join</span></a></a><span> </span><a name="local-6989586621682319316"><a href="#local-6989586621682319316"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">Var.idDetails</span></a><span> </span><a href="#local-6989586621682319316"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-612"></a><span>                              </span><a href="IdInfo.html#VanillaId"><span class="hs-identifier hs-var">VanillaId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-613"></a><span>                              </span><a href="IdInfo.html#JoinId"><span class="hs-identifier hs-var">JoinId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-614"></a><span>                              </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-615"></a><span>
</span><a name="line-616"></a><span class="hs-identifier">zapJoinId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-617"></a><span class="hs-comment">-- May be a regular id already</span><span>
</span><a name="line-618"></a><a name="zapJoinId"><a href="Id.html#zapJoinId"><span class="hs-identifier">zapJoinId</span></a></a><span> </span><a name="local-6989586621682319317"><a href="#local-6989586621682319317"><span class="hs-identifier">jid</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a><span> </span><a href="#local-6989586621682319317"><span class="hs-identifier hs-var">jid</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#zapIdTailCallInfo"><span class="hs-identifier hs-var">zapIdTailCallInfo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682319317"><span class="hs-identifier hs-var">jid</span></a><span> </span><span class="hs-special">`</span><a href="Var.html#setIdDetails"><span class="hs-identifier hs-var">setIdDetails</span></a><span class="hs-special">`</span><span> </span><a href="IdInfo.html#VanillaId"><span class="hs-identifier hs-var">VanillaId</span></a><span class="hs-special">)</span><span>
</span><a name="line-619"></a><span>                                 </span><span class="hs-comment">-- Core Lint may complain if still marked</span><span>
</span><a name="line-620"></a><span>                                 </span><span class="hs-comment">-- as AlwaysTailCalled</span><span>
</span><a name="line-621"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319317"><span class="hs-identifier hs-var">jid</span></a><span>
</span><a name="line-622"></a><span>
</span><a name="line-623"></a><span class="hs-identifier">asJoinId_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BasicTypes.html#JoinArity"><span class="hs-identifier hs-type">JoinArity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-624"></a><a name="asJoinId_maybe"><a href="Id.html#asJoinId_maybe"><span class="hs-identifier">asJoinId_maybe</span></a></a><span> </span><a name="local-6989586621682319318"><a href="#local-6989586621682319318"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682319319"><a href="#local-6989586621682319319"><span class="hs-identifier">arity</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#asJoinId"><span class="hs-identifier hs-var">asJoinId</span></a><span> </span><a href="#local-6989586621682319318"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621682319319"><span class="hs-identifier hs-var">arity</span></a><span>
</span><a name="line-625"></a><span class="hs-identifier">asJoinId_maybe</span><span> </span><a name="local-6989586621682319320"><a href="#local-6989586621682319320"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#zapJoinId"><span class="hs-identifier hs-var">zapJoinId</span></a><span> </span><a href="#local-6989586621682319320"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-626"></a><span>
</span><a name="line-627"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{IdInfo stuff}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-634"></a><span>
</span><a name="line-635"></a><span>        </span><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-636"></a><span>        </span><span class="hs-comment">-- ARITY</span><span>
</span><a name="line-637"></a><span class="hs-identifier">idArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span>
</span><a name="line-638"></a><a name="idArity"><a href="Id.html#idArity"><span class="hs-identifier">idArity</span></a></a><span> </span><a name="local-6989586621682319321"><a href="#local-6989586621682319321"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arityInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319321"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-639"></a><span>
</span><a name="line-640"></a><span class="hs-identifier">setIdArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-641"></a><a name="setIdArity"><a href="Id.html#setIdArity"><span class="hs-identifier">setIdArity</span></a></a><span> </span><a name="local-6989586621682319322"><a href="#local-6989586621682319322"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319323"><a href="#local-6989586621682319323"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setArityInfo"><span class="hs-identifier hs-var">setArityInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319323"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319322"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-642"></a><span>
</span><a name="line-643"></a><span class="hs-identifier">idCallArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span>
</span><a name="line-644"></a><a name="idCallArity"><a href="Id.html#idCallArity"><span class="hs-identifier">idCallArity</span></a></a><span> </span><a name="local-6989586621682319324"><a href="#local-6989586621682319324"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">callArityInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319324"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-645"></a><span>
</span><a name="line-646"></a><span class="hs-identifier">setIdCallArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#Arity"><span class="hs-identifier hs-type">Arity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-647"></a><a name="setIdCallArity"><a href="Id.html#setIdCallArity"><span class="hs-identifier">setIdCallArity</span></a></a><span> </span><a name="local-6989586621682319325"><a href="#local-6989586621682319325"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319326"><a href="#local-6989586621682319326"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setCallArityInfo"><span class="hs-identifier hs-var">setCallArityInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319326"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319325"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-648"></a><span>
</span><a name="line-649"></a><span class="hs-identifier">idFunRepArity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#RepArity"><span class="hs-identifier hs-type">RepArity</span></a><span>
</span><a name="line-650"></a><a name="idFunRepArity"><a href="Id.html#idFunRepArity"><span class="hs-identifier">idFunRepArity</span></a></a><span> </span><a name="local-6989586621682319327"><a href="#local-6989586621682319327"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RepType.html#countFunRepArgs"><span class="hs-identifier hs-var">countFunRepArgs</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idArity"><span class="hs-identifier hs-var">idArity</span></a><span> </span><a href="#local-6989586621682319327"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621682319327"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>
</span><a name="line-652"></a><span class="hs-comment">-- | Returns true if an application to n args would diverge</span><span>
</span><a name="line-653"></a><span class="hs-identifier">isBottomingId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-654"></a><a name="isBottomingId"><a href="Id.html#isBottomingId"><span class="hs-identifier">isBottomingId</span></a></a><span> </span><a name="local-6989586621682319328"><a href="#local-6989586621682319328"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-655"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isId"><span class="hs-identifier hs-var">isId</span></a><span> </span><a href="#local-6989586621682319328"><span class="hs-identifier hs-var">v</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#isBottomingSig"><span class="hs-identifier hs-var">isBottomingSig</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idStrictness"><span class="hs-identifier hs-var">idStrictness</span></a><span> </span><a href="#local-6989586621682319328"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-656"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-657"></a><span>
</span><a name="line-658"></a><span class="hs-identifier">idStrictness</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a><span>
</span><a name="line-659"></a><a name="idStrictness"><a href="Id.html#idStrictness"><span class="hs-identifier">idStrictness</span></a></a><span> </span><a name="local-6989586621682319329"><a href="#local-6989586621682319329"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">strictnessInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319329"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-660"></a><span>
</span><a name="line-661"></a><span class="hs-identifier">setIdStrictness</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Demand.html#StrictSig"><span class="hs-identifier hs-type">StrictSig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-662"></a><a name="setIdStrictness"><a href="Id.html#setIdStrictness"><span class="hs-identifier">setIdStrictness</span></a></a><span> </span><a name="local-6989586621682319330"><a href="#local-6989586621682319330"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319331"><a href="#local-6989586621682319331"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setStrictnessInfo"><span class="hs-identifier hs-var">setStrictnessInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319331"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319330"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-identifier">zapIdStrictness</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-665"></a><a name="zapIdStrictness"><a href="Id.html#zapIdStrictness"><span class="hs-identifier">zapIdStrictness</span></a></a><span> </span><a name="local-6989586621682319332"><a href="#local-6989586621682319332"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setStrictnessInfo"><span class="hs-identifier hs-var">setStrictnessInfo</span></a><span class="hs-special">`</span><span> </span><a href="Demand.html#nopSig"><span class="hs-identifier hs-var">nopSig</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319332"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-comment">-- | This predicate says whether the 'Id' has a strict demand placed on it or</span><span>
</span><a name="line-668"></a><span class="hs-comment">-- has a type such that it can always be evaluated strictly (i.e an</span><span>
</span><a name="line-669"></a><span class="hs-comment">-- unlifted type, as of GHC 7.6).  We need to</span><span>
</span><a name="line-670"></a><span class="hs-comment">-- check separately whether the 'Id' has a so-called \&quot;strict type\&quot; because if</span><span>
</span><a name="line-671"></a><span class="hs-comment">-- the demand for the given @id@ hasn't been computed yet but @id@ has a strict</span><span>
</span><a name="line-672"></a><span class="hs-comment">-- type, we still want @isStrictId id@ to be @True@.</span><span>
</span><a name="line-673"></a><span class="hs-identifier">isStrictId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-674"></a><a name="isStrictId"><a href="Id.html#isStrictId"><span class="hs-identifier">isStrictId</span></a></a><span> </span><a name="local-6989586621682319333"><a href="#local-6989586621682319333"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-675"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isId</span><span> </span><span class="hs-identifier">id</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;isStrictId: not an id: &quot;</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">id</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-676"></a><span>         </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Id.html#isJoinId"><span class="hs-identifier hs-var">isJoinId</span></a><span> </span><a href="#local-6989586621682319333"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-677"></a><span>           </span><span class="hs-special">(</span><a href="Type.html#isStrictType"><span class="hs-identifier hs-var">isStrictType</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621682319333"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span>
</span><a name="line-678"></a><span>           </span><span class="hs-comment">-- Take the best of both strictnesses - old and new</span><span>
</span><a name="line-679"></a><span>           </span><span class="hs-special">(</span><a href="Demand.html#isStrictDmd"><span class="hs-identifier hs-var">isStrictDmd</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idDemandInfo"><span class="hs-identifier hs-var">idDemandInfo</span></a><span> </span><a href="#local-6989586621682319333"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-680"></a><span>         </span><span class="hs-special">)</span><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span>        </span><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-683"></a><span>        </span><span class="hs-comment">-- UNFOLDING</span><span>
</span><a name="line-684"></a><span class="hs-identifier">idUnfolding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a><span>
</span><a name="line-685"></a><span class="hs-comment">-- Do not expose the unfolding of a loop breaker!</span><span>
</span><a name="line-686"></a><a name="idUnfolding"><a href="Id.html#idUnfolding"><span class="hs-identifier">idUnfolding</span></a></a><span> </span><a name="local-6989586621682319334"><a href="#local-6989586621682319334"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-687"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="BasicTypes.html#isStrongLoopBreaker"><span class="hs-identifier hs-var">isStrongLoopBreaker</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">occInfo</span><span> </span><a href="#local-6989586621682319335"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#NoUnfolding"><span class="hs-identifier hs-var">NoUnfolding</span></a><span>
</span><a name="line-688"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unfoldingInfo</span><span> </span><a href="#local-6989586621682319335"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-689"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-690"></a><span>    </span><a name="local-6989586621682319335"><a href="#local-6989586621682319335"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319334"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-691"></a><span>
</span><a name="line-692"></a><span class="hs-identifier">realIdUnfolding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a><span>
</span><a name="line-693"></a><span class="hs-comment">-- Expose the unfolding if there is one, including for loop breakers</span><span>
</span><a name="line-694"></a><a name="realIdUnfolding"><a href="Id.html#realIdUnfolding"><span class="hs-identifier">realIdUnfolding</span></a></a><span> </span><a name="local-6989586621682319336"><a href="#local-6989586621682319336"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unfoldingInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319336"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-695"></a><span>
</span><a name="line-696"></a><span class="hs-identifier">setIdUnfolding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#Unfolding"><span class="hs-identifier hs-type">Unfolding</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-697"></a><a name="setIdUnfolding"><a href="Id.html#setIdUnfolding"><span class="hs-identifier">setIdUnfolding</span></a></a><span> </span><a name="local-6989586621682319337"><a href="#local-6989586621682319337"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319338"><a href="#local-6989586621682319338"><span class="hs-identifier">unfolding</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setUnfoldingInfo"><span class="hs-identifier hs-var">setUnfoldingInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319338"><span class="hs-identifier hs-var">unfolding</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319337"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-698"></a><span>
</span><a name="line-699"></a><span class="hs-identifier">idDemandInfo</span><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a><span>
</span><a name="line-700"></a><a name="idDemandInfo"><a href="Id.html#idDemandInfo"><span class="hs-identifier">idDemandInfo</span></a></a><span>       </span><a name="local-6989586621682319339"><a href="#local-6989586621682319339"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">demandInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319339"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-701"></a><span>
</span><a name="line-702"></a><span class="hs-identifier">setIdDemandInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Demand.html#Demand"><span class="hs-identifier hs-type">Demand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-703"></a><a name="setIdDemandInfo"><a href="Id.html#setIdDemandInfo"><span class="hs-identifier">setIdDemandInfo</span></a></a><span> </span><a name="local-6989586621682319340"><a href="#local-6989586621682319340"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319341"><a href="#local-6989586621682319341"><span class="hs-identifier">dmd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setDemandInfo"><span class="hs-identifier hs-var">setDemandInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319341"><span class="hs-identifier hs-var">dmd</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319340"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-704"></a><span>
</span><a name="line-705"></a><span class="hs-identifier">setCaseBndrEvald</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataCon.html#StrictnessMark"><span class="hs-identifier hs-type">StrictnessMark</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-706"></a><span class="hs-comment">-- Used for variables bound by a case expressions, both the case-binder</span><span>
</span><a name="line-707"></a><span class="hs-comment">-- itself, and any pattern-bound variables that are argument of a</span><span>
</span><a name="line-708"></a><span class="hs-comment">-- strict constructor.  It just marks the variable as already-evaluated,</span><span>
</span><a name="line-709"></a><span class="hs-comment">-- so that (for example) a subsequent 'seq' can be dropped</span><span>
</span><a name="line-710"></a><a name="setCaseBndrEvald"><a href="Id.html#setCaseBndrEvald"><span class="hs-identifier">setCaseBndrEvald</span></a></a><span> </span><a name="local-6989586621682319342"><a href="#local-6989586621682319342"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621682319343"><a href="#local-6989586621682319343"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-711"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DataCon.html#isMarkedStrict"><span class="hs-identifier hs-var">isMarkedStrict</span></a><span> </span><a href="#local-6989586621682319342"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319343"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">`</span><a href="Id.html#setIdUnfolding"><span class="hs-identifier hs-var">setIdUnfolding</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#evaldUnfolding"><span class="hs-identifier hs-var">evaldUnfolding</span></a><span>
</span><a name="line-712"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319343"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-713"></a><span>
</span><a name="line-714"></a><span>        </span><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-715"></a><span>        </span><span class="hs-comment">-- SPECIALISATION</span><span>
</span><a name="line-716"></a><span>
</span><a name="line-717"></a><span class="hs-comment">-- See Note [Specialisations and RULES in IdInfo] in IdInfo.hs</span><span>
</span><a name="line-718"></a><span>
</span><a name="line-719"></a><span class="hs-identifier">idSpecialisation</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span>
</span><a name="line-720"></a><a name="idSpecialisation"><a href="Id.html#idSpecialisation"><span class="hs-identifier">idSpecialisation</span></a></a><span> </span><a name="local-6989586621682319344"><a href="#local-6989586621682319344"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ruleInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319344"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-721"></a><span>
</span><a name="line-722"></a><span class="hs-identifier">idCoreRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span class="hs-special">]</span><span>
</span><a name="line-723"></a><a name="idCoreRules"><a href="Id.html#idCoreRules"><span class="hs-identifier">idCoreRules</span></a></a><span> </span><a name="local-6989586621682319345"><a href="#local-6989586621682319345"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#ruleInfoRules"><span class="hs-identifier hs-var">ruleInfoRules</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idSpecialisation"><span class="hs-identifier hs-var">idSpecialisation</span></a><span> </span><a href="#local-6989586621682319345"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>
</span><a name="line-725"></a><span class="hs-identifier">idHasRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-726"></a><a name="idHasRules"><a href="Id.html#idHasRules"><span class="hs-identifier">idHasRules</span></a></a><span> </span><a name="local-6989586621682319346"><a href="#local-6989586621682319346"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#isEmptyRuleInfo"><span class="hs-identifier hs-var">isEmptyRuleInfo</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idSpecialisation"><span class="hs-identifier hs-var">idSpecialisation</span></a><span> </span><a href="#local-6989586621682319346"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-727"></a><span>
</span><a name="line-728"></a><span class="hs-identifier">setIdSpecialisation</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#RuleInfo"><span class="hs-identifier hs-type">RuleInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-729"></a><a name="setIdSpecialisation"><a href="Id.html#setIdSpecialisation"><span class="hs-identifier">setIdSpecialisation</span></a></a><span> </span><a name="local-6989586621682319347"><a href="#local-6989586621682319347"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319348"><a href="#local-6989586621682319348"><span class="hs-identifier">spec_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setRuleInfo"><span class="hs-identifier hs-var">setRuleInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319348"><span class="hs-identifier hs-var">spec_info</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319347"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-730"></a><span>
</span><a name="line-731"></a><span>        </span><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-732"></a><span>        </span><span class="hs-comment">-- CAF INFO</span><span>
</span><a name="line-733"></a><span class="hs-identifier">idCafInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a><span>
</span><a name="line-734"></a><a name="idCafInfo"><a href="Id.html#idCafInfo"><span class="hs-identifier">idCafInfo</span></a></a><span> </span><a name="local-6989586621682319349"><a href="#local-6989586621682319349"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cafInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319349"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-735"></a><span>
</span><a name="line-736"></a><span class="hs-identifier">setIdCafInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="IdInfo.html#CafInfo"><span class="hs-identifier hs-type">CafInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-737"></a><a name="setIdCafInfo"><a href="Id.html#setIdCafInfo"><span class="hs-identifier">setIdCafInfo</span></a></a><span> </span><a name="local-6989586621682319350"><a href="#local-6989586621682319350"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319351"><a href="#local-6989586621682319351"><span class="hs-identifier">caf_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setCafInfo"><span class="hs-identifier hs-var">setCafInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319351"><span class="hs-identifier hs-var">caf_info</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319350"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-738"></a><span>
</span><a name="line-739"></a><span>        </span><span class="hs-comment">---------------------------------</span><span>
</span><a name="line-740"></a><span>        </span><span class="hs-comment">-- Occurrence INFO</span><span>
</span><a name="line-741"></a><span class="hs-identifier">idOccInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#OccInfo"><span class="hs-identifier hs-type">OccInfo</span></a><span>
</span><a name="line-742"></a><a name="idOccInfo"><a href="Id.html#idOccInfo"><span class="hs-identifier">idOccInfo</span></a></a><span> </span><a name="local-6989586621682319352"><a href="#local-6989586621682319352"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">occInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319352"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-743"></a><span>
</span><a name="line-744"></a><span class="hs-identifier">setIdOccInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#OccInfo"><span class="hs-identifier hs-type">OccInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-745"></a><a name="setIdOccInfo"><a href="Id.html#setIdOccInfo"><span class="hs-identifier">setIdOccInfo</span></a></a><span> </span><a name="local-6989586621682319353"><a href="#local-6989586621682319353"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319354"><a href="#local-6989586621682319354"><span class="hs-identifier">occ_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setOccInfo"><span class="hs-identifier hs-var">setOccInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319354"><span class="hs-identifier hs-var">occ_info</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319353"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-746"></a><span>
</span><a name="line-747"></a><span class="hs-identifier">zapIdOccInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-748"></a><a name="zapIdOccInfo"><a href="Id.html#zapIdOccInfo"><span class="hs-identifier">zapIdOccInfo</span></a></a><span> </span><a name="local-6989586621682319355"><a href="#local-6989586621682319355"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319355"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">`</span><a href="Id.html#setIdOccInfo"><span class="hs-identifier hs-var">setIdOccInfo</span></a><span class="hs-special">`</span><span> </span><a href="BasicTypes.html#noOccInfo"><span class="hs-identifier hs-var">noOccInfo</span></a><span>
</span><a name="line-749"></a><span>
</span><a name="line-750"></a><span class="hs-comment">{-
        ---------------------------------
        -- INLINING
The inline pragma tells us to be very keen to inline this Id, but it's still
OK not to if optimisation is switched off.
-}</span><span>
</span><a name="line-756"></a><span>
</span><a name="line-757"></a><span class="hs-identifier">idInlinePragma</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#InlinePragma"><span class="hs-identifier hs-type">InlinePragma</span></a><span>
</span><a name="line-758"></a><a name="idInlinePragma"><a href="Id.html#idInlinePragma"><span class="hs-identifier">idInlinePragma</span></a></a><span> </span><a name="local-6989586621682319356"><a href="#local-6989586621682319356"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">inlinePragInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319356"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-759"></a><span>
</span><a name="line-760"></a><span class="hs-identifier">setInlinePragma</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#InlinePragma"><span class="hs-identifier hs-type">InlinePragma</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-761"></a><a name="setInlinePragma"><a href="Id.html#setInlinePragma"><span class="hs-identifier">setInlinePragma</span></a></a><span> </span><a name="local-6989586621682319357"><a href="#local-6989586621682319357"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319358"><a href="#local-6989586621682319358"><span class="hs-identifier">prag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setInlinePragInfo"><span class="hs-identifier hs-var">setInlinePragInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319358"><span class="hs-identifier hs-var">prag</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319357"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-762"></a><span>
</span><a name="line-763"></a><span class="hs-identifier">modifyInlinePragma</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#InlinePragma"><span class="hs-identifier hs-type">InlinePragma</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#InlinePragma"><span class="hs-identifier hs-type">InlinePragma</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-764"></a><a name="modifyInlinePragma"><a href="Id.html#modifyInlinePragma"><span class="hs-identifier">modifyInlinePragma</span></a></a><span> </span><a name="local-6989586621682319359"><a href="#local-6989586621682319359"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319360"><a href="#local-6989586621682319360"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682319361"><a href="#local-6989586621682319361"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682319361"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">`</span><a href="IdInfo.html#setInlinePragInfo"><span class="hs-identifier hs-var">setInlinePragInfo</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682319360"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inlinePragInfo</span><span> </span><a href="#local-6989586621682319361"><span class="hs-identifier hs-var">info</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319359"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-765"></a><span>
</span><a name="line-766"></a><span class="hs-identifier">idInlineActivation</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#Activation"><span class="hs-identifier hs-type">Activation</span></a><span>
</span><a name="line-767"></a><a name="idInlineActivation"><a href="Id.html#idInlineActivation"><span class="hs-identifier">idInlineActivation</span></a></a><span> </span><a name="local-6989586621682319362"><a href="#local-6989586621682319362"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#inlinePragmaActivation"><span class="hs-identifier hs-var">inlinePragmaActivation</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idInlinePragma"><span class="hs-identifier hs-var">idInlinePragma</span></a><span> </span><a href="#local-6989586621682319362"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-768"></a><span>
</span><a name="line-769"></a><span class="hs-identifier">setInlineActivation</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#Activation"><span class="hs-identifier hs-type">Activation</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-770"></a><a name="setInlineActivation"><a href="Id.html#setInlineActivation"><span class="hs-identifier">setInlineActivation</span></a></a><span> </span><a name="local-6989586621682319363"><a href="#local-6989586621682319363"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319364"><a href="#local-6989586621682319364"><span class="hs-identifier">act</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyInlinePragma"><span class="hs-identifier hs-var">modifyInlinePragma</span></a><span> </span><a href="#local-6989586621682319363"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621682319365"><a href="#local-6989586621682319365"><span class="hs-identifier">prag</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#setInlinePragmaActivation"><span class="hs-identifier hs-var">setInlinePragmaActivation</span></a><span> </span><a href="#local-6989586621682319365"><span class="hs-identifier hs-var">prag</span></a><span> </span><a href="#local-6989586621682319364"><span class="hs-identifier hs-var">act</span></a><span class="hs-special">)</span><span>
</span><a name="line-771"></a><span>
</span><a name="line-772"></a><span class="hs-identifier">idRuleMatchInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#RuleMatchInfo"><span class="hs-identifier hs-type">RuleMatchInfo</span></a><span>
</span><a name="line-773"></a><a name="idRuleMatchInfo"><a href="Id.html#idRuleMatchInfo"><span class="hs-identifier">idRuleMatchInfo</span></a></a><span> </span><a name="local-6989586621682319366"><a href="#local-6989586621682319366"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#inlinePragmaRuleMatchInfo"><span class="hs-identifier hs-var">inlinePragmaRuleMatchInfo</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idInlinePragma"><span class="hs-identifier hs-var">idInlinePragma</span></a><span> </span><a href="#local-6989586621682319366"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-774"></a><span>
</span><a name="line-775"></a><span class="hs-identifier">isConLikeId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-776"></a><a name="isConLikeId"><a href="Id.html#isConLikeId"><span class="hs-identifier">isConLikeId</span></a></a><span> </span><a name="local-6989586621682319367"><a href="#local-6989586621682319367"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#isDataConWorkId"><span class="hs-identifier hs-var">isDataConWorkId</span></a><span> </span><a href="#local-6989586621682319367"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="BasicTypes.html#isConLike"><span class="hs-identifier hs-var">isConLike</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idRuleMatchInfo"><span class="hs-identifier hs-var">idRuleMatchInfo</span></a><span> </span><a href="#local-6989586621682319367"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>
</span><a name="line-778"></a><span class="hs-comment">{-
        ---------------------------------
        -- ONE-SHOT LAMBDAS
-}</span><span>
</span><a name="line-782"></a><span>
</span><a name="line-783"></a><span class="hs-identifier">idOneShotInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a><span>
</span><a name="line-784"></a><a name="idOneShotInfo"><a href="Id.html#idOneShotInfo"><span class="hs-identifier">idOneShotInfo</span></a></a><span> </span><a name="local-6989586621682319368"><a href="#local-6989586621682319368"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">oneShotInfo</span><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319368"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-785"></a><span>
</span><a name="line-786"></a><span class="hs-comment">-- | Like 'idOneShotInfo', but taking the Horrible State Hack in to account</span><span>
</span><a name="line-787"></a><span class="hs-comment">-- See Note [The state-transformer hack] in CoreArity</span><span>
</span><a name="line-788"></a><span class="hs-identifier">idStateHackOneShotInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a><span>
</span><a name="line-789"></a><a name="idStateHackOneShotInfo"><a href="Id.html#idStateHackOneShotInfo"><span class="hs-identifier">idStateHackOneShotInfo</span></a></a><span> </span><a name="local-6989586621682319369"><a href="#local-6989586621682319369"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-790"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="Id.html#isStateHackType"><span class="hs-identifier hs-var">isStateHackType</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621682319369"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#stateHackOneShot"><span class="hs-identifier hs-var">stateHackOneShot</span></a><span>
</span><a name="line-791"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#idOneShotInfo"><span class="hs-identifier hs-var">idOneShotInfo</span></a><span> </span><a href="#local-6989586621682319369"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-792"></a><span>
</span><a name="line-793"></a><span class="hs-comment">-- | Returns whether the lambda associated with the 'Id' is certainly applied at most once</span><span>
</span><a name="line-794"></a><span class="hs-comment">-- This one is the &quot;business end&quot;, called externally.</span><span>
</span><a name="line-795"></a><span class="hs-comment">-- It works on type variables as well as Ids, returning True</span><span>
</span><a name="line-796"></a><span class="hs-comment">-- Its main purpose is to encapsulate the Horrible State Hack</span><span>
</span><a name="line-797"></a><span class="hs-comment">-- See Note [The state-transformer hack] in CoreArity</span><span>
</span><a name="line-798"></a><span class="hs-identifier">isOneShotBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-799"></a><a name="isOneShotBndr"><a href="Id.html#isOneShotBndr"><span class="hs-identifier">isOneShotBndr</span></a></a><span> </span><a name="local-6989586621682319370"><a href="#local-6989586621682319370"><span class="hs-identifier">var</span></a></a><span>
</span><a name="line-800"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="#local-6989586621682319370"><span class="hs-identifier hs-var">var</span></a><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-801"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="BasicTypes.html#OneShotLam"><span class="hs-identifier hs-var">OneShotLam</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Id.html#idStateHackOneShotInfo"><span class="hs-identifier hs-var">idStateHackOneShotInfo</span></a><span> </span><a href="#local-6989586621682319370"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-802"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-803"></a><span>
</span><a name="line-804"></a><span class="hs-comment">-- | Should we apply the state hack to values of this 'Type'?</span><span>
</span><a name="line-805"></a><span class="hs-identifier">stateHackOneShot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a><span>
</span><a name="line-806"></a><a name="stateHackOneShot"><a href="Id.html#stateHackOneShot"><span class="hs-identifier">stateHackOneShot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#OneShotLam"><span class="hs-identifier hs-var">OneShotLam</span></a><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span class="hs-identifier">typeOneShot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a><span>
</span><a name="line-809"></a><a name="typeOneShot"><a href="Id.html#typeOneShot"><span class="hs-identifier">typeOneShot</span></a></a><span> </span><a name="local-6989586621682319371"><a href="#local-6989586621682319371"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-810"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="Id.html#isStateHackType"><span class="hs-identifier hs-var">isStateHackType</span></a><span> </span><a href="#local-6989586621682319371"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#stateHackOneShot"><span class="hs-identifier hs-var">stateHackOneShot</span></a><span>
</span><a name="line-811"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#NoOneShotInfo"><span class="hs-identifier hs-var">NoOneShotInfo</span></a><span>
</span><a name="line-812"></a><span>
</span><a name="line-813"></a><span class="hs-identifier">isStateHackType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-814"></a><a name="isStateHackType"><a href="Id.html#isStateHackType"><span class="hs-identifier">isStateHackType</span></a></a><span> </span><a name="local-6989586621682319372"><a href="#local-6989586621682319372"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-815"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#hasNoStateHack"><span class="hs-identifier hs-var">hasNoStateHack</span></a><span> </span><a href="DynFlags.html#unsafeGlobalDynFlags"><span class="hs-identifier hs-var">unsafeGlobalDynFlags</span></a><span>
</span><a name="line-816"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-817"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-818"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#tyConAppTyCon_maybe"><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></a><span> </span><a href="#local-6989586621682319372"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-819"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621682319373"><a href="#local-6989586621682319373"><span class="hs-identifier">tycon</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682319373"><span class="hs-identifier hs-var">tycon</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="TysPrim.html#statePrimTyCon"><span class="hs-identifier hs-var">statePrimTyCon</span></a><span>
</span><a name="line-820"></a><span>        </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-821"></a><span>        </span><span class="hs-comment">-- This is a gross hack.  It claims that</span><span>
</span><a name="line-822"></a><span>        </span><span class="hs-comment">-- every function over realWorldStatePrimTy is a one-shot</span><span>
</span><a name="line-823"></a><span>        </span><span class="hs-comment">-- function.  This is pretty true in practice, and makes a big</span><span>
</span><a name="line-824"></a><span>        </span><span class="hs-comment">-- difference.  For example, consider</span><span>
</span><a name="line-825"></a><span>        </span><span class="hs-comment">--      a `thenST` \ r -&gt; ...E...</span><span>
</span><a name="line-826"></a><span>        </span><span class="hs-comment">-- The early full laziness pass, if it doesn't know that r is one-shot</span><span>
</span><a name="line-827"></a><span>        </span><span class="hs-comment">-- will pull out E (let's say it doesn't mention r) to give</span><span>
</span><a name="line-828"></a><span>        </span><span class="hs-comment">--      let lvl = E in a `thenST` \ r -&gt; ...lvl...</span><span>
</span><a name="line-829"></a><span>        </span><span class="hs-comment">-- When `thenST` gets inlined, we end up with</span><span>
</span><a name="line-830"></a><span>        </span><span class="hs-comment">--      let lvl = E in \s -&gt; case a s of (r, s') -&gt; ...lvl...</span><span>
</span><a name="line-831"></a><span>        </span><span class="hs-comment">-- and we don't re-inline E.</span><span>
</span><a name="line-832"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-833"></a><span>        </span><span class="hs-comment">-- It would be better to spot that r was one-shot to start with, but</span><span>
</span><a name="line-834"></a><span>        </span><span class="hs-comment">-- I don't want to rely on that.</span><span>
</span><a name="line-835"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-836"></a><span>        </span><span class="hs-comment">-- Another good example is in fill_in in PrelPack.hs.  We should be able to</span><span>
</span><a name="line-837"></a><span>        </span><span class="hs-comment">-- spot that fill_in has arity 2 (and when Keith is done, we will) but we can't yet.</span><span>
</span><a name="line-838"></a><span>
</span><a name="line-839"></a><span class="hs-identifier">isProbablyOneShotLambda</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-840"></a><a name="isProbablyOneShotLambda"><a href="Id.html#isProbablyOneShotLambda"><span class="hs-identifier">isProbablyOneShotLambda</span></a></a><span> </span><a name="local-6989586621682319374"><a href="#local-6989586621682319374"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Id.html#idStateHackOneShotInfo"><span class="hs-identifier hs-var">idStateHackOneShotInfo</span></a><span> </span><a href="#local-6989586621682319374"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-841"></a><span>                               </span><a href="BasicTypes.html#OneShotLam"><span class="hs-identifier hs-var">OneShotLam</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-842"></a><span>                               </span><a href="BasicTypes.html#NoOneShotInfo"><span class="hs-identifier hs-var">NoOneShotInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-843"></a><span>
</span><a name="line-844"></a><span class="hs-identifier">setOneShotLambda</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-845"></a><a name="setOneShotLambda"><a href="Id.html#setOneShotLambda"><span class="hs-identifier">setOneShotLambda</span></a></a><span> </span><a name="local-6989586621682319375"><a href="#local-6989586621682319375"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setOneShotInfo"><span class="hs-identifier hs-var">setOneShotInfo</span></a><span class="hs-special">`</span><span> </span><a href="BasicTypes.html#OneShotLam"><span class="hs-identifier hs-var">OneShotLam</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319375"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-846"></a><span>
</span><a name="line-847"></a><span class="hs-identifier">clearOneShotLambda</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-848"></a><a name="clearOneShotLambda"><a href="Id.html#clearOneShotLambda"><span class="hs-identifier">clearOneShotLambda</span></a></a><span> </span><a name="local-6989586621682319376"><a href="#local-6989586621682319376"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setOneShotInfo"><span class="hs-identifier hs-var">setOneShotInfo</span></a><span class="hs-special">`</span><span> </span><a href="BasicTypes.html#NoOneShotInfo"><span class="hs-identifier hs-var">NoOneShotInfo</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319376"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-849"></a><span>
</span><a name="line-850"></a><span class="hs-identifier">setIdOneShotInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-851"></a><a name="setIdOneShotInfo"><a href="Id.html#setIdOneShotInfo"><span class="hs-identifier">setIdOneShotInfo</span></a></a><span> </span><a name="local-6989586621682319377"><a href="#local-6989586621682319377"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319378"><a href="#local-6989586621682319378"><span class="hs-identifier">one_shot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="IdInfo.html#setOneShotInfo"><span class="hs-identifier hs-var">setOneShotInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319378"><span class="hs-identifier hs-var">one_shot</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319377"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-852"></a><span>
</span><a name="line-853"></a><span class="hs-identifier">updOneShotInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#OneShotInfo"><span class="hs-identifier hs-type">OneShotInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-854"></a><span class="hs-comment">-- Combine the info in the Id with new info</span><span>
</span><a name="line-855"></a><a name="updOneShotInfo"><a href="Id.html#updOneShotInfo"><span class="hs-identifier">updOneShotInfo</span></a></a><span> </span><a name="local-6989586621682319379"><a href="#local-6989586621682319379"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621682319380"><a href="#local-6989586621682319380"><span class="hs-identifier">one_shot</span></a></a><span>
</span><a name="line-856"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682319381"><span class="hs-identifier hs-var">do_upd</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#setIdOneShotInfo"><span class="hs-identifier hs-var">setIdOneShotInfo</span></a><span> </span><a href="#local-6989586621682319379"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621682319380"><span class="hs-identifier hs-var">one_shot</span></a><span>
</span><a name="line-857"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319379"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-858"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-859"></a><span>    </span><a name="local-6989586621682319381"><a href="#local-6989586621682319381"><span class="hs-identifier">do_upd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="Id.html#idOneShotInfo"><span class="hs-identifier hs-var">idOneShotInfo</span></a><span> </span><a href="#local-6989586621682319379"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682319380"><span class="hs-identifier hs-var">one_shot</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-860"></a><span>                </span><span class="hs-special">(</span><a href="BasicTypes.html#NoOneShotInfo"><span class="hs-identifier hs-var">NoOneShotInfo</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-861"></a><span>                </span><span class="hs-special">(</span><a href="BasicTypes.html#OneShotLam"><span class="hs-identifier hs-var">OneShotLam</span></a><span class="hs-special">,</span><span>    </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-862"></a><span>
</span><a name="line-863"></a><span class="hs-comment">-- The OneShotLambda functions simply fiddle with the IdInfo flag</span><span>
</span><a name="line-864"></a><span class="hs-comment">-- But watch out: this may change the type of something else</span><span>
</span><a name="line-865"></a><span class="hs-comment">--      f = \x -&gt; e</span><span>
</span><a name="line-866"></a><span class="hs-comment">-- If we change the one-shot-ness of x, f's type changes</span><span>
</span><a name="line-867"></a><span>
</span><a name="line-868"></a><span class="hs-identifier">zapInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="IdInfo.html#IdInfo"><span class="hs-identifier hs-type">IdInfo</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-869"></a><a name="zapInfo"><a href="Id.html#zapInfo"><span class="hs-identifier">zapInfo</span></a></a><span> </span><a name="local-6989586621682319382"><a href="#local-6989586621682319382"><span class="hs-identifier">zapper</span></a></a><span> </span><a name="local-6989586621682319383"><a href="#local-6989586621682319383"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#maybeModifyIdInfo"><span class="hs-identifier hs-var">maybeModifyIdInfo</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682319382"><span class="hs-identifier hs-var">zapper</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319383"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682319383"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-870"></a><span>
</span><a name="line-871"></a><span class="hs-identifier">zapLamIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-872"></a><a name="zapLamIdInfo"><a href="Id.html#zapLamIdInfo"><span class="hs-identifier">zapLamIdInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#zapInfo"><span class="hs-identifier hs-var">zapInfo</span></a><span> </span><a href="IdInfo.html#zapLamInfo"><span class="hs-identifier hs-var">zapLamInfo</span></a><span>
</span><a name="line-873"></a><span>
</span><a name="line-874"></a><span class="hs-identifier">zapFragileIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-875"></a><a name="zapFragileIdInfo"><a href="Id.html#zapFragileIdInfo"><span class="hs-identifier">zapFragileIdInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#zapInfo"><span class="hs-identifier hs-var">zapInfo</span></a><span> </span><a href="IdInfo.html#zapFragileInfo"><span class="hs-identifier hs-var">zapFragileInfo</span></a><span>
</span><a name="line-876"></a><span>
</span><a name="line-877"></a><span class="hs-identifier">zapIdDemandInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-878"></a><a name="zapIdDemandInfo"><a href="Id.html#zapIdDemandInfo"><span class="hs-identifier">zapIdDemandInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#zapInfo"><span class="hs-identifier hs-var">zapInfo</span></a><span> </span><a href="IdInfo.html#zapDemandInfo"><span class="hs-identifier hs-var">zapDemandInfo</span></a><span>
</span><a name="line-879"></a><span>
</span><a name="line-880"></a><span class="hs-identifier">zapIdUsageInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-881"></a><a name="zapIdUsageInfo"><a href="Id.html#zapIdUsageInfo"><span class="hs-identifier">zapIdUsageInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#zapInfo"><span class="hs-identifier hs-var">zapInfo</span></a><span> </span><a href="IdInfo.html#zapUsageInfo"><span class="hs-identifier hs-var">zapUsageInfo</span></a><span>
</span><a name="line-882"></a><span>
</span><a name="line-883"></a><span class="hs-identifier">zapIdUsageEnvInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-884"></a><a name="zapIdUsageEnvInfo"><a href="Id.html#zapIdUsageEnvInfo"><span class="hs-identifier">zapIdUsageEnvInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#zapInfo"><span class="hs-identifier hs-var">zapInfo</span></a><span> </span><a href="IdInfo.html#zapUsageEnvInfo"><span class="hs-identifier hs-var">zapUsageEnvInfo</span></a><span>
</span><a name="line-885"></a><span>
</span><a name="line-886"></a><span class="hs-identifier">zapIdUsedOnceInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-887"></a><a name="zapIdUsedOnceInfo"><a href="Id.html#zapIdUsedOnceInfo"><span class="hs-identifier">zapIdUsedOnceInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#zapInfo"><span class="hs-identifier hs-var">zapInfo</span></a><span> </span><a href="IdInfo.html#zapUsedOnceInfo"><span class="hs-identifier hs-var">zapUsedOnceInfo</span></a><span>
</span><a name="line-888"></a><span>
</span><a name="line-889"></a><span class="hs-identifier">zapIdTailCallInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-890"></a><a name="zapIdTailCallInfo"><a href="Id.html#zapIdTailCallInfo"><span class="hs-identifier">zapIdTailCallInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#zapInfo"><span class="hs-identifier hs-var">zapInfo</span></a><span> </span><a href="IdInfo.html#zapTailCallInfo"><span class="hs-identifier hs-var">zapTailCallInfo</span></a><span>
</span><a name="line-891"></a><span>
</span><a name="line-892"></a><span class="hs-identifier">zapStableUnfolding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-893"></a><a name="zapStableUnfolding"><a href="Id.html#zapStableUnfolding"><span class="hs-identifier">zapStableUnfolding</span></a></a><span> </span><a name="local-6989586621682319384"><a href="#local-6989586621682319384"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-894"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="CoreSyn.html#isStableUnfolding"><span class="hs-identifier hs-var">isStableUnfolding</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#realIdUnfolding"><span class="hs-identifier hs-var">realIdUnfolding</span></a><span> </span><a href="#local-6989586621682319384"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#setIdUnfolding"><span class="hs-identifier hs-var">setIdUnfolding</span></a><span> </span><a href="#local-6989586621682319384"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="CoreSyn.html#NoUnfolding"><span class="hs-identifier hs-var">NoUnfolding</span></a><span>
</span><a name="line-895"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319384"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-896"></a><span>
</span><a name="line-897"></a><span class="hs-comment">{-
Note [transferPolyIdInfo]
~~~~~~~~~~~~~~~~~~~~~~~~~
This transfer is used in three places:
        FloatOut (long-distance let-floating)
        SimplUtils.abstractFloats (short-distance let-floating)
        StgLiftLams (selectively lambda-lift local functions to top-level)

Consider the short-distance let-floating:

   f = /\a. let g = rhs in ...

Then if we float thus

   g' = /\a. rhs
   f = /\a. ...[g' a/g]....

we *do not* want to lose g's
  * strictness information
  * arity
  * inline pragma (though that is bit more debatable)
  * occurrence info

Mostly this is just an optimisation, but it's *vital* to
transfer the occurrence info.  Consider

   NonRec { f = /\a. let Rec { g* = ..g.. } in ... }

where the '*' means 'LoopBreaker'.  Then if we float we must get

   Rec { g'* = /\a. ...(g' a)... }
   NonRec { f = /\a. ...[g' a/g]....}

where g' is also marked as LoopBreaker.  If not, terrible things
can happen if we re-simplify the binding (and the Simplifier does
sometimes simplify a term twice); see Trac #4345.

It's not so simple to retain
  * worker info
  * rules
so we simply discard those.  Sooner or later this may bite us.

If we abstract wrt one or more *value* binders, we must modify the
arity and strictness info before transferring it.  E.g.
      f = \x. e
--&gt;
      g' = \y. \x. e
      + substitute (g' y) for g
Notice that g' has an arity one more than the original g
-}</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span class="hs-identifier">transferPolyIdInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>        </span><span class="hs-comment">-- Original Id</span><span>
</span><a name="line-949"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Abstract wrt these variables</span><span>
</span><a name="line-950"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>        </span><span class="hs-comment">-- New Id</span><span>
</span><a name="line-951"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-952"></a><a name="transferPolyIdInfo"><a href="Id.html#transferPolyIdInfo"><span class="hs-identifier">transferPolyIdInfo</span></a></a><span> </span><a name="local-6989586621682319385"><a href="#local-6989586621682319385"><span class="hs-identifier">old_id</span></a></a><span> </span><a name="local-6989586621682319386"><a href="#local-6989586621682319386"><span class="hs-identifier">abstract_wrt</span></a></a><span> </span><a name="local-6989586621682319387"><a href="#local-6989586621682319387"><span class="hs-identifier">new_id</span></a></a><span>
</span><a name="line-953"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#modifyIdInfo"><span class="hs-identifier hs-var">modifyIdInfo</span></a><span> </span><a href="#local-6989586621682319397"><span class="hs-identifier hs-var">transfer</span></a><span> </span><a href="#local-6989586621682319387"><span class="hs-identifier hs-var">new_id</span></a><span>
</span><a name="line-954"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-955"></a><span>    </span><a name="local-6989586621682319388"><a href="#local-6989586621682319388"><span class="hs-identifier">arity_increase</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#count"><span class="hs-identifier hs-var">count</span></a><span> </span><a href="Var.html#isId"><span class="hs-identifier hs-var">isId</span></a><span> </span><a href="#local-6989586621682319386"><span class="hs-identifier hs-var">abstract_wrt</span></a><span>    </span><span class="hs-comment">-- Arity increases by the</span><span>
</span><a name="line-956"></a><span>                                                </span><span class="hs-comment">-- number of value binders</span><span>
</span><a name="line-957"></a><span>
</span><a name="line-958"></a><span>    </span><a name="local-6989586621682319389"><a href="#local-6989586621682319389"><span class="hs-identifier">old_info</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span> </span><a href="#local-6989586621682319385"><span class="hs-identifier hs-var">old_id</span></a><span>
</span><a name="line-959"></a><span>    </span><a name="local-6989586621682319390"><a href="#local-6989586621682319390"><span class="hs-identifier">old_arity</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">arityInfo</span><span> </span><a href="#local-6989586621682319389"><span class="hs-identifier hs-var">old_info</span></a><span>
</span><a name="line-960"></a><span>    </span><a name="local-6989586621682319391"><a href="#local-6989586621682319391"><span class="hs-identifier">old_inline_prag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">inlinePragInfo</span><span> </span><a href="#local-6989586621682319389"><span class="hs-identifier hs-var">old_info</span></a><span>
</span><a name="line-961"></a><span>    </span><a name="local-6989586621682319392"><a href="#local-6989586621682319392"><span class="hs-identifier">old_occ_info</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">occInfo</span><span> </span><a href="#local-6989586621682319389"><span class="hs-identifier hs-var">old_info</span></a><span>
</span><a name="line-962"></a><span>    </span><a name="local-6989586621682319393"><a href="#local-6989586621682319393"><span class="hs-identifier">new_arity</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319390"><span class="hs-identifier hs-var">old_arity</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621682319388"><span class="hs-identifier hs-var">arity_increase</span></a><span>
</span><a name="line-963"></a><span>    </span><a name="local-6989586621682319394"><a href="#local-6989586621682319394"><span class="hs-identifier">new_occ_info</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#zapOccTailCallInfo"><span class="hs-identifier hs-var">zapOccTailCallInfo</span></a><span> </span><a href="#local-6989586621682319392"><span class="hs-identifier hs-var">old_occ_info</span></a><span>
</span><a name="line-964"></a><span>
</span><a name="line-965"></a><span>    </span><a name="local-6989586621682319395"><a href="#local-6989586621682319395"><span class="hs-identifier">old_strictness</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">strictnessInfo</span><span> </span><a href="#local-6989586621682319389"><span class="hs-identifier hs-var">old_info</span></a><span>
</span><a name="line-966"></a><span>    </span><a name="local-6989586621682319396"><a href="#local-6989586621682319396"><span class="hs-identifier">new_strictness</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#increaseStrictSigArity"><span class="hs-identifier hs-var">increaseStrictSigArity</span></a><span> </span><a href="#local-6989586621682319388"><span class="hs-identifier hs-var">arity_increase</span></a><span> </span><a href="#local-6989586621682319395"><span class="hs-identifier hs-var">old_strictness</span></a><span>
</span><a name="line-967"></a><span>
</span><a name="line-968"></a><span>    </span><a name="local-6989586621682319397"><a href="#local-6989586621682319397"><span class="hs-identifier">transfer</span></a></a><span> </span><a name="local-6989586621682319398"><a href="#local-6989586621682319398"><span class="hs-identifier">new_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682319398"><span class="hs-identifier hs-var">new_info</span></a><span> </span><span class="hs-special">`</span><a href="IdInfo.html#setArityInfo"><span class="hs-identifier hs-var">setArityInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319393"><span class="hs-identifier hs-var">new_arity</span></a><span>
</span><a name="line-969"></a><span>                                 </span><span class="hs-special">`</span><a href="IdInfo.html#setInlinePragInfo"><span class="hs-identifier hs-var">setInlinePragInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319391"><span class="hs-identifier hs-var">old_inline_prag</span></a><span>
</span><a name="line-970"></a><span>                                 </span><span class="hs-special">`</span><a href="IdInfo.html#setOccInfo"><span class="hs-identifier hs-var">setOccInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319394"><span class="hs-identifier hs-var">new_occ_info</span></a><span>
</span><a name="line-971"></a><span>                                 </span><span class="hs-special">`</span><a href="IdInfo.html#setStrictnessInfo"><span class="hs-identifier hs-var">setStrictnessInfo</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621682319396"><span class="hs-identifier hs-var">new_strictness</span></a><span>
</span><a name="line-972"></a><span>
</span><a name="line-973"></a><span class="hs-identifier">isNeverLevPolyId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-974"></a><a name="isNeverLevPolyId"><a href="Id.html#isNeverLevPolyId"><span class="hs-identifier">isNeverLevPolyId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#isNeverLevPolyIdInfo"><span class="hs-identifier hs-var">isNeverLevPolyIdInfo</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Var.html#idInfo"><span class="hs-identifier hs-var">idInfo</span></a><span>
</span><a name="line-975"></a></pre></body></html>