<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE CPP, DeriveDataTypeable #-}</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- #name_types#</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- GHC uses several kinds of name internally:</span><span>
</span><a name="line-11"></a><span class="hs-comment">--</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- * 'OccName.OccName': see &quot;OccName#name_types&quot;</span><span>
</span><a name="line-13"></a><span class="hs-comment">--</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- * 'RdrName.RdrName' is the type of names that come directly from the parser. They</span><span>
</span><a name="line-15"></a><span class="hs-comment">--   have not yet had their scoping and binding resolved by the renamer and can be</span><span>
</span><a name="line-16"></a><span class="hs-comment">--   thought of to a first approximation as an 'OccName.OccName' with an optional module</span><span>
</span><a name="line-17"></a><span class="hs-comment">--   qualifier</span><span>
</span><a name="line-18"></a><span class="hs-comment">--</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- * 'Name.Name': see &quot;Name#name_types&quot;</span><span>
</span><a name="line-20"></a><span class="hs-comment">--</span><span>
</span><a name="line-21"></a><span class="hs-comment">-- * 'Id.Id': see &quot;Id#name_types&quot;</span><span>
</span><a name="line-22"></a><span class="hs-comment">--</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- * 'Var.Var': see &quot;Var#name_types&quot;</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">RdrName</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-26"></a><span>        </span><span class="hs-comment">-- * The main type</span><span>
</span><a name="line-27"></a><span>        </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Constructors exported only to BinIface</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>        </span><span class="hs-comment">-- ** Construction</span><span>
</span><a name="line-30"></a><span>        </span><a href="RdrName.html#mkRdrUnqual"><span class="hs-identifier hs-var">mkRdrUnqual</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#mkRdrQual"><span class="hs-identifier hs-var">mkRdrQual</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="RdrName.html#mkUnqual"><span class="hs-identifier hs-var">mkUnqual</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#mkVarUnqual"><span class="hs-identifier hs-var">mkVarUnqual</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#mkQual"><span class="hs-identifier hs-var">mkQual</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#mkOrig"><span class="hs-identifier hs-var">mkOrig</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="RdrName.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#getRdrName"><span class="hs-identifier hs-var">getRdrName</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>        </span><span class="hs-comment">-- ** Destruction</span><span>
</span><a name="line-35"></a><span>        </span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#rdrNameSpace"><span class="hs-identifier hs-var">rdrNameSpace</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#demoteRdrName"><span class="hs-identifier hs-var">demoteRdrName</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="RdrName.html#isRdrDataCon"><span class="hs-identifier hs-var">isRdrDataCon</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isRdrTyVar"><span class="hs-identifier hs-var">isRdrTyVar</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isRdrTc"><span class="hs-identifier hs-var">isRdrTc</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isQual"><span class="hs-identifier hs-var">isQual</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isQual_maybe"><span class="hs-identifier hs-var">isQual_maybe</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isUnqual"><span class="hs-identifier hs-var">isUnqual</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="RdrName.html#isOrig"><span class="hs-identifier hs-var">isOrig</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isOrig_maybe"><span class="hs-identifier hs-var">isOrig_maybe</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isExact"><span class="hs-identifier hs-var">isExact</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isExact_maybe"><span class="hs-identifier hs-var">isExact_maybe</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isSrcRdrName"><span class="hs-identifier hs-var">isSrcRdrName</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span>        </span><span class="hs-comment">-- * Local mapping of 'RdrName' to 'Name.Name'</span><span>
</span><a name="line-40"></a><span>        </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#emptyLocalRdrEnv"><span class="hs-identifier hs-var">emptyLocalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#extendLocalRdrEnv"><span class="hs-identifier hs-var">extendLocalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#extendLocalRdrEnvList"><span class="hs-identifier hs-var">extendLocalRdrEnvList</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="RdrName.html#lookupLocalRdrEnv"><span class="hs-identifier hs-var">lookupLocalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#lookupLocalRdrOcc"><span class="hs-identifier hs-var">lookupLocalRdrOcc</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>        </span><a href="RdrName.html#elemLocalRdrEnv"><span class="hs-identifier hs-var">elemLocalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#inLocalRdrEnvScope"><span class="hs-identifier hs-var">inLocalRdrEnvScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="RdrName.html#localRdrEnvElts"><span class="hs-identifier hs-var">localRdrEnvElts</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#delLocalRdrEnvList"><span class="hs-identifier hs-var">delLocalRdrEnvList</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>        </span><span class="hs-comment">-- * Global mapping of 'RdrName' to 'GlobalRdrElt's</span><span>
</span><a name="line-46"></a><span>        </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#mkGlobalRdrEnv"><span class="hs-identifier hs-var">mkGlobalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#plusGlobalRdrEnv"><span class="hs-identifier hs-var">plusGlobalRdrEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>        </span><a href="RdrName.html#lookupGlobalRdrEnv"><span class="hs-identifier hs-var">lookupGlobalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#extendGlobalRdrEnv"><span class="hs-identifier hs-var">extendGlobalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#greOccName"><span class="hs-identifier hs-var">greOccName</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#shadowNames"><span class="hs-identifier hs-var">shadowNames</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="RdrName.html#pprGlobalRdrEnv"><span class="hs-identifier hs-var">pprGlobalRdrEnv</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#globalRdrEnvElts"><span class="hs-identifier hs-var">globalRdrEnvElts</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="RdrName.html#lookupGRE_RdrName"><span class="hs-identifier hs-var">lookupGRE_RdrName</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#lookupGRE_FieldLabel"><span class="hs-identifier hs-var">lookupGRE_FieldLabel</span></a><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>        </span><a href="RdrName.html#lookupGRE_Name_OccName"><span class="hs-identifier hs-var">lookupGRE_Name_OccName</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>        </span><a href="RdrName.html#getGRE_NameQualifier_maybes"><span class="hs-identifier hs-var">getGRE_NameQualifier_maybes</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="RdrName.html#transformGREs"><span class="hs-identifier hs-var">transformGREs</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#pickGREs"><span class="hs-identifier hs-var">pickGREs</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#pickGREsModExp"><span class="hs-identifier hs-var">pickGREsModExp</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span>        </span><span class="hs-comment">-- * GlobalRdrElts</span><span>
</span><a name="line-55"></a><span>        </span><a href="RdrName.html#gresFromAvails"><span class="hs-identifier hs-var">gresFromAvails</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#gresFromAvail"><span class="hs-identifier hs-var">gresFromAvail</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#localGREsFromAvail"><span class="hs-identifier hs-var">localGREsFromAvail</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#availFromGRE"><span class="hs-identifier hs-var">availFromGRE</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>        </span><a href="RdrName.html#greRdrNames"><span class="hs-identifier hs-var">greRdrNames</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#greSrcSpan"><span class="hs-identifier hs-var">greSrcSpan</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#greQualModName"><span class="hs-identifier hs-var">greQualModName</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>        </span><a href="RdrName.html#gresToAvailInfo"><span class="hs-identifier hs-var">gresToAvailInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>        </span><span class="hs-comment">-- ** Global 'RdrName' mapping elements: 'GlobalRdrElt', 'Provenance', 'ImportSpec'</span><span>
</span><a name="line-60"></a><span>        </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="RdrName.html#isLocalGRE"><span class="hs-identifier hs-var">isLocalGRE</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isRecFldGRE"><span class="hs-identifier hs-var">isRecFldGRE</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#greLabel"><span class="hs-identifier hs-var">greLabel</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>        </span><a href="RdrName.html#unQualOK"><span class="hs-identifier hs-var">unQualOK</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#qualSpecOK"><span class="hs-identifier hs-var">qualSpecOK</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#unQualSpecOK"><span class="hs-identifier hs-var">unQualSpecOK</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>        </span><a href="RdrName.html#pprNameProvenance"><span class="hs-identifier hs-var">pprNameProvenance</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>        </span><a href="RdrName.html#Parent"><span class="hs-identifier hs-type">Parent</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="RdrName.html#greParent_maybe"><span class="hs-identifier hs-var">greParent_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>        </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="RdrName.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="RdrName.html#ImpItemSpec"><span class="hs-identifier hs-type">ImpItemSpec</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>        </span><a href="RdrName.html#importSpecLoc"><span class="hs-identifier hs-var">importSpecLoc</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#importSpecModule"><span class="hs-identifier hs-var">importSpecModule</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#isExplicitItem"><span class="hs-identifier hs-var">isExplicitItem</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#bestImport"><span class="hs-identifier hs-var">bestImport</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>        </span><span class="hs-comment">-- * Utils for StarIsType</span><span>
</span><a name="line-68"></a><span>        </span><a href="RdrName.html#starInfo"><span class="hs-identifier hs-var">starInfo</span></a><span>
</span><a name="line-69"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-70"></a><span>
</span><a name="line-71"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="Avail.html"><span class="hs-identifier">Avail</span></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><a href="FieldLabel.html"><span class="hs-identifier">FieldLabel</span></a><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSet.html"><span class="hs-identifier">UniqSet</span></a><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Data</span><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{The main data type}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-comment">-- | Reader Name</span><span>
</span><a name="line-102"></a><span class="hs-comment">--</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- Do not use the data constructors of RdrName directly: prefer the family</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- of functions that creates them, such as 'mkRdrUnqual'</span><span>
</span><a name="line-105"></a><span class="hs-comment">--</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- - Note: A Located RdrName will only have API Annotations if it is a</span><span>
</span><a name="line-107"></a><span class="hs-comment">--         compound one,</span><span>
</span><a name="line-108"></a><span class="hs-comment">--   e.g.</span><span>
</span><a name="line-109"></a><span class="hs-comment">--</span><span>
</span><a name="line-110"></a><span class="hs-comment">-- &gt; `bar`</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- &gt; ( ~ )</span><span>
</span><a name="line-112"></a><span class="hs-comment">--</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnType',</span><span>
</span><a name="line-114"></a><span class="hs-comment">--           'ApiAnnotation.AnnOpen'  @'('@ or @'['@ or @'[:'@,</span><span>
</span><a name="line-115"></a><span class="hs-comment">--           'ApiAnnotation.AnnClose' @')'@ or @']'@ or @':]'@,,</span><span>
</span><a name="line-116"></a><span class="hs-comment">--           'ApiAnnotation.AnnBackquote' @'`'@,</span><span>
</span><a name="line-117"></a><span class="hs-comment">--           'ApiAnnotation.AnnVal'</span><span>
</span><a name="line-118"></a><span class="hs-comment">--           'ApiAnnotation.AnnTilde',</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-comment">-- For details on above see note [Api annotations] in ApiAnnotation</span><span>
</span><a name="line-121"></a><span class="hs-keyword">data</span><span> </span><a name="RdrName"><a href="RdrName.html#RdrName"><span class="hs-identifier">RdrName</span></a></a><span>
</span><a name="line-122"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Unqual"><a href="RdrName.html#Unqual"><span class="hs-identifier">Unqual</span></a></a><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-123"></a><span>        </span><span class="hs-comment">-- ^ Unqualified  name</span><span>
</span><a name="line-124"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-125"></a><span>        </span><span class="hs-comment">-- Used for ordinary, unqualified occurrences, e.g. @x@, @y@ or @Foo@.</span><span>
</span><a name="line-126"></a><span>        </span><span class="hs-comment">-- Create such a 'RdrName' with 'mkRdrUnqual'</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Qual"><a href="RdrName.html#Qual"><span class="hs-identifier">Qual</span></a></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-129"></a><span>        </span><span class="hs-comment">-- ^ Qualified name</span><span>
</span><a name="line-130"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-131"></a><span>        </span><span class="hs-comment">-- A qualified name written by the user in</span><span>
</span><a name="line-132"></a><span>        </span><span class="hs-comment">-- /source/ code.  The module isn't necessarily</span><span>
</span><a name="line-133"></a><span>        </span><span class="hs-comment">-- the module where the thing is defined;</span><span>
</span><a name="line-134"></a><span>        </span><span class="hs-comment">-- just the one from which it is imported.</span><span>
</span><a name="line-135"></a><span>        </span><span class="hs-comment">-- Examples are @Bar.x@, @Bar.y@ or @Bar.Foo@.</span><span>
</span><a name="line-136"></a><span>        </span><span class="hs-comment">-- Create such a 'RdrName' with 'mkRdrQual'</span><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Orig"><a href="RdrName.html#Orig"><span class="hs-identifier">Orig</span></a></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-139"></a><span>        </span><span class="hs-comment">-- ^ Original name</span><span>
</span><a name="line-140"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-141"></a><span>        </span><span class="hs-comment">-- An original name; the module is the /defining/ module.</span><span>
</span><a name="line-142"></a><span>        </span><span class="hs-comment">-- This is used when GHC generates code that will be fed</span><span>
</span><a name="line-143"></a><span>        </span><span class="hs-comment">-- into the renamer (e.g. from deriving clauses), but where</span><span>
</span><a name="line-144"></a><span>        </span><span class="hs-comment">-- we want to say \&quot;Use Prelude.map dammit\&quot;. One of these</span><span>
</span><a name="line-145"></a><span>        </span><span class="hs-comment">-- can be created with 'mkOrig'</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Exact"><a href="RdrName.html#Exact"><span class="hs-identifier">Exact</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-148"></a><span>        </span><span class="hs-comment">-- ^ Exact name</span><span>
</span><a name="line-149"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-150"></a><span>        </span><span class="hs-comment">-- We know exactly the 'Name'. This is used:</span><span>
</span><a name="line-151"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-152"></a><span>        </span><span class="hs-comment">--  (1) When the parser parses built-in syntax like @[]@</span><span>
</span><a name="line-153"></a><span>        </span><span class="hs-comment">--      and @(,)@, but wants a 'RdrName' from it</span><span>
</span><a name="line-154"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-155"></a><span>        </span><span class="hs-comment">--  (2) By Template Haskell, when TH has generated a unique name</span><span>
</span><a name="line-156"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-157"></a><span>        </span><span class="hs-comment">-- Such a 'RdrName' can be created by using 'getRdrName' on a 'Name'</span><span>
</span><a name="line-158"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Data</span><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Simple functions}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span class="hs-keyword">instance</span><span> </span><a href="OccName.html#HasOccName"><span class="hs-identifier hs-type">HasOccName</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-169"></a><span>  </span><a name="local-8214565720325908782"><a href="OccName.html#occName"><span class="hs-identifier">occName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-identifier">rdrNameOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-172"></a><a name="rdrNameOcc"><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier">rdrNameOcc</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681307091"><a href="#local-6989586621681307091"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307091"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-173"></a><span class="hs-identifier">rdrNameOcc</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a name="local-6989586621681307092"><a href="#local-6989586621681307092"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307092"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-174"></a><span class="hs-identifier">rdrNameOcc</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681307093"><a href="#local-6989586621681307093"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307093"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-175"></a><span class="hs-identifier">rdrNameOcc</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307094"><a href="#local-6989586621681307094"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681307094"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-identifier">rdrNameSpace</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#NameSpace"><span class="hs-identifier hs-type">NameSpace</span></a><span>
</span><a name="line-178"></a><a name="rdrNameSpace"><a href="RdrName.html#rdrNameSpace"><span class="hs-identifier">rdrNameSpace</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">occNameSpace</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-comment">-- demoteRdrName lowers the NameSpace of RdrName.</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- see Note [Demotion] in OccName</span><span>
</span><a name="line-182"></a><span class="hs-identifier">demoteRdrName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-183"></a><a name="demoteRdrName"><a href="RdrName.html#demoteRdrName"><span class="hs-identifier">demoteRdrName</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a name="local-6989586621681307095"><a href="#local-6989586621681307095"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#demoteOccName"><span class="hs-identifier hs-var">demoteOccName</span></a><span> </span><a href="#local-6989586621681307095"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span class="hs-identifier">demoteRdrName</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><a name="local-6989586621681307096"><a href="#local-6989586621681307096"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621681307097"><a href="#local-6989586621681307097"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><a href="#local-6989586621681307096"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="OccName.html#demoteOccName"><span class="hs-identifier hs-var">demoteOccName</span></a><span> </span><a href="#local-6989586621681307097"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span class="hs-identifier">demoteRdrName</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;demoteRdrName&quot;</span><span>
</span><a name="line-186"></a><span class="hs-identifier">demoteRdrName</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;demoteRdrName&quot;</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span>        </span><span class="hs-comment">-- These two are the basic constructors</span><span>
</span><a name="line-189"></a><span class="hs-identifier">mkRdrUnqual</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-190"></a><a name="mkRdrUnqual"><a href="RdrName.html#mkRdrUnqual"><span class="hs-identifier">mkRdrUnqual</span></a></a><span> </span><a name="local-6989586621681307098"><a href="#local-6989586621681307098"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a href="#local-6989586621681307098"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-identifier">mkRdrQual</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-193"></a><a name="mkRdrQual"><a href="RdrName.html#mkRdrQual"><span class="hs-identifier">mkRdrQual</span></a></a><span> </span><a name="local-6989586621681307099"><a href="#local-6989586621681307099"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621681307100"><a href="#local-6989586621681307100"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><a href="#local-6989586621681307099"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621681307100"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-identifier">mkOrig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-196"></a><a name="mkOrig"><a href="RdrName.html#mkOrig"><span class="hs-identifier">mkOrig</span></a></a><span> </span><a name="local-6989586621681307101"><a href="#local-6989586621681307101"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621681307102"><a href="#local-6989586621681307102"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><a href="#local-6989586621681307101"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621681307102"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">---------------</span><span>
</span><a name="line-199"></a><span>        </span><span class="hs-comment">-- These two are used when parsing source files</span><span>
</span><a name="line-200"></a><span>        </span><span class="hs-comment">-- They do encode the module and occurrence names</span><span>
</span><a name="line-201"></a><span class="hs-identifier">mkUnqual</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#NameSpace"><span class="hs-identifier hs-type">NameSpace</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-202"></a><a name="mkUnqual"><a href="RdrName.html#mkUnqual"><span class="hs-identifier">mkUnqual</span></a></a><span> </span><a name="local-6989586621681307103"><a href="#local-6989586621681307103"><span class="hs-identifier">sp</span></a></a><span> </span><a name="local-6989586621681307104"><a href="#local-6989586621681307104"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkOccNameFS"><span class="hs-identifier hs-var">mkOccNameFS</span></a><span> </span><a href="#local-6989586621681307103"><span class="hs-identifier hs-var">sp</span></a><span> </span><a href="#local-6989586621681307104"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-identifier">mkVarUnqual</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-205"></a><a name="mkVarUnqual"><a href="RdrName.html#mkVarUnqual"><span class="hs-identifier">mkVarUnqual</span></a></a><span> </span><a name="local-6989586621681307105"><a href="#local-6989586621681307105"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a><span> </span><a href="#local-6989586621681307105"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-comment">-- | Make a qualified 'RdrName' in the given namespace and where the 'ModuleName' and</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- the 'OccName' are taken from the first and second elements of the tuple respectively</span><span>
</span><a name="line-209"></a><span class="hs-identifier">mkQual</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#NameSpace"><span class="hs-identifier hs-type">NameSpace</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span class="hs-special">,</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-210"></a><a name="mkQual"><a href="RdrName.html#mkQual"><span class="hs-identifier">mkQual</span></a></a><span> </span><a name="local-6989586621681307106"><a href="#local-6989586621681307106"><span class="hs-identifier">sp</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681307107"><a href="#local-6989586621681307107"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681307108"><a href="#local-6989586621681307108"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#mkModuleNameFS"><span class="hs-identifier hs-var">mkModuleNameFS</span></a><span> </span><a href="#local-6989586621681307107"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="OccName.html#mkOccNameFS"><span class="hs-identifier hs-var">mkOccNameFS</span></a><span> </span><a href="#local-6989586621681307106"><span class="hs-identifier hs-var">sp</span></a><span> </span><a href="#local-6989586621681307108"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-identifier">getRdrName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#NamedThing"><span class="hs-identifier hs-type">NamedThing</span></a><span> </span><a href="#local-6989586621681307090"><span class="hs-identifier hs-type">thing</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621681307090"><span class="hs-identifier hs-type">thing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-213"></a><a name="getRdrName"><a href="RdrName.html#getRdrName"><span class="hs-identifier">getRdrName</span></a></a><span> </span><a name="local-6989586621681307109"><a href="#local-6989586621681307109"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-6989586621681307109"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-identifier">nameRdrName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-216"></a><a name="nameRdrName"><a href="RdrName.html#nameRdrName"><span class="hs-identifier">nameRdrName</span></a></a><span> </span><a name="local-6989586621681307110"><a href="#local-6989586621681307110"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a href="#local-6989586621681307110"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-217"></a><span class="hs-comment">-- Keep the Name even for Internal names, so that the</span><span>
</span><a name="line-218"></a><span class="hs-comment">-- unique is still there for debug printing, particularly</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- of Types (which are converted to IfaceTypes before printing)</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-identifier">nukeExact</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>
</span><a name="line-222"></a><a name="nukeExact"><a href="RdrName.html#nukeExact"><span class="hs-identifier">nukeExact</span></a></a><span> </span><a name="local-6989586621681307111"><a href="#local-6989586621681307111"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-223"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a><span> </span><a href="#local-6989586621681307111"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a><span> </span><a href="#local-6989586621681307111"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681307111"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681307111"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span class="hs-identifier">isRdrDataCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-227"></a><span class="hs-identifier">isRdrTyVar</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-228"></a><span class="hs-identifier">isRdrTc</span><span>      </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><a name="isRdrDataCon"><a href="RdrName.html#isRdrDataCon"><span class="hs-identifier">isRdrDataCon</span></a></a><span> </span><a name="local-6989586621681307112"><a href="#local-6989586621681307112"><span class="hs-identifier">rn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#isDataOcc"><span class="hs-identifier hs-var">isDataOcc</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><a href="#local-6989586621681307112"><span class="hs-identifier hs-var">rn</span></a><span class="hs-special">)</span><span>
</span><a name="line-231"></a><a name="isRdrTyVar"><a href="RdrName.html#isRdrTyVar"><span class="hs-identifier">isRdrTyVar</span></a></a><span>   </span><a name="local-6989586621681307113"><a href="#local-6989586621681307113"><span class="hs-identifier">rn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#isTvOcc"><span class="hs-identifier hs-var">isTvOcc</span></a><span>   </span><span class="hs-special">(</span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><a href="#local-6989586621681307113"><span class="hs-identifier hs-var">rn</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><a name="isRdrTc"><a href="RdrName.html#isRdrTc"><span class="hs-identifier">isRdrTc</span></a></a><span>      </span><a name="local-6989586621681307114"><a href="#local-6989586621681307114"><span class="hs-identifier">rn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#isTcOcc"><span class="hs-identifier hs-var">isTcOcc</span></a><span>   </span><span class="hs-special">(</span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><a href="#local-6989586621681307114"><span class="hs-identifier hs-var">rn</span></a><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span class="hs-identifier">isSrcRdrName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-235"></a><a name="isSrcRdrName"><a href="RdrName.html#isSrcRdrName"><span class="hs-identifier">isSrcRdrName</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-236"></a><span class="hs-identifier">isSrcRdrName</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-237"></a><span class="hs-identifier">isSrcRdrName</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-identifier">isUnqual</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-240"></a><a name="isUnqual"><a href="RdrName.html#isUnqual"><span class="hs-identifier">isUnqual</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-241"></a><span class="hs-identifier">isUnqual</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-identifier">isQual</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-244"></a><a name="isQual"><a href="RdrName.html#isQual"><span class="hs-identifier">isQual</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-245"></a><span class="hs-identifier">isQual</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-identifier">isQual_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">)</span><span>
</span><a name="line-248"></a><a name="isQual_maybe"><a href="RdrName.html#isQual_maybe"><span class="hs-identifier">isQual_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><a name="local-6989586621681307115"><a href="#local-6989586621681307115"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621681307116"><a href="#local-6989586621681307116"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307115"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><a href="#local-6989586621681307116"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span class="hs-identifier">isQual_maybe</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span class="hs-identifier">isOrig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-252"></a><a name="isOrig"><a href="RdrName.html#isOrig"><span class="hs-identifier">isOrig</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-253"></a><span class="hs-identifier">isOrig</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-identifier">isOrig_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><a name="isOrig_maybe"><a href="RdrName.html#isOrig_maybe"><span class="hs-identifier">isOrig_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><a name="local-6989586621681307117"><a href="#local-6989586621681307117"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621681307118"><a href="#local-6989586621681307118"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307117"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">,</span><a href="#local-6989586621681307118"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span class="hs-identifier">isOrig_maybe</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-identifier">isExact</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-260"></a><a name="isExact"><a href="RdrName.html#isExact"><span class="hs-identifier">isExact</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-261"></a><span class="hs-identifier">isExact</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span class="hs-identifier">isExact_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-264"></a><a name="isExact_maybe"><a href="RdrName.html#isExact_maybe"><span class="hs-identifier">isExact_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307119"><a href="#local-6989586621681307119"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681307119"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-265"></a><span class="hs-identifier">isExact_maybe</span><span> </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Instances}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-276"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307083"><a href="#local-6989586621681307083"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307083"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-277"></a><span>    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a name="local-6989586621681307084"><a href="#local-6989586621681307084"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307084"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-278"></a><span>    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><a name="local-6989586621681307085"><a href="#local-6989586621681307085"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621681307086"><a href="#local-6989586621681307086"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307085"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#dot"><span class="hs-identifier hs-var">dot</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307086"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-279"></a><span>    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><a name="local-6989586621681307087"><a href="#local-6989586621681307087"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621681307088"><a href="#local-6989586621681307088"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#getPprStyle"><span class="hs-identifier hs-var">getPprStyle</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621681307089"><a href="#local-6989586621681307089"><span class="hs-identifier">sty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#pprModulePrefix"><span class="hs-identifier hs-var">pprModulePrefix</span></a><span> </span><a href="#local-6989586621681307089"><span class="hs-identifier hs-var">sty</span></a><span> </span><a href="#local-6989586621681307087"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621681307088"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307088"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#OutputableBndr"><span class="hs-identifier hs-type">OutputableBndr</span></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-282"></a><span>    </span><a name="local-8214565720324887690"><a href="Outputable.html#pprBndr"><span class="hs-identifier">pprBndr</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681307079"><a href="#local-6989586621681307079"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-283"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="OccName.html#isTvOcc"><span class="hs-identifier hs-var">isTvOcc</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><a href="#local-6989586621681307079"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'@'</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307079"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-284"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307079"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span>    </span><a name="local-8214565720324887692"><a href="Outputable.html#pprInfixOcc"><span class="hs-identifier">pprInfixOcc</span></a></a><span>  </span><a name="local-6989586621681307080"><a href="#local-6989586621681307080"><span class="hs-identifier">rdr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprInfixVar"><span class="hs-identifier hs-var">pprInfixVar</span></a><span>  </span><span class="hs-special">(</span><a href="OccName.html#isSymOcc"><span class="hs-identifier hs-var">isSymOcc</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><a href="#local-6989586621681307080"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307080"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span>    </span><a name="local-8214565720324887691"><a href="Outputable.html#pprPrefixOcc"><span class="hs-identifier">pprPrefixOcc</span></a></a><span> </span><a name="local-6989586621681307081"><a href="#local-6989586621681307081"><span class="hs-identifier">rdr</span></a></a><span>
</span><a name="line-288"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307082"><a href="#local-6989586621681307082"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RdrName.html#isExact_maybe"><span class="hs-identifier hs-var">isExact_maybe</span></a><span> </span><a href="#local-6989586621681307081"><span class="hs-identifier hs-var">rdr</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#pprPrefixName"><span class="hs-identifier hs-var">pprPrefixName</span></a><span> </span><a href="#local-6989586621681307082"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-289"></a><span>             </span><span class="hs-comment">-- pprPrefixName has some special cases, so</span><span>
</span><a name="line-290"></a><span>             </span><span class="hs-comment">-- we delegate to them rather than reproduce them</span><span>
</span><a name="line-291"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPrefixVar"><span class="hs-identifier hs-var">pprPrefixVar</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#isSymOcc"><span class="hs-identifier hs-var">isSymOcc</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><a href="#local-6989586621681307081"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307081"><span class="hs-identifier hs-var">rdr</span></a><span class="hs-special">)</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-294"></a><span>    </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307063"><a href="#local-6989586621681307063"><span class="hs-identifier">n1</span></a></a><span class="hs-special">)</span><span>    </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307064"><a href="#local-6989586621681307064"><span class="hs-identifier">n2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307063"><span class="hs-identifier hs-var">n1</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681307064"><span class="hs-identifier hs-var">n2</span></a><span>
</span><a name="line-295"></a><span>        </span><span class="hs-comment">-- Convert exact to orig</span><span>
</span><a name="line-296"></a><span>    </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307065"><a href="#local-6989586621681307065"><span class="hs-identifier">n1</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-operator">==</span><span> </span><a name="local-6989586621681307066"><a href="#local-6989586621681307066"><span class="hs-identifier">r2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#nukeExact"><span class="hs-identifier hs-var">nukeExact</span></a><span> </span><a href="#local-6989586621681307065"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621681307066"><span class="hs-identifier hs-var">r2</span></a><span>
</span><a name="line-297"></a><span>    </span><a name="local-6989586621681307067"><a href="#local-6989586621681307067"><span class="hs-identifier">r1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307068"><a href="#local-6989586621681307068"><span class="hs-identifier">n2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307067"><span class="hs-identifier hs-var">r1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="RdrName.html#nukeExact"><span class="hs-identifier hs-var">nukeExact</span></a><span> </span><a href="#local-6989586621681307068"><span class="hs-identifier hs-var">n2</span></a><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span>    </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><a name="local-6989586621681307069"><a href="#local-6989586621681307069"><span class="hs-identifier">m1</span></a></a><span> </span><a name="local-6989586621681307070"><a href="#local-6989586621681307070"><span class="hs-identifier">o1</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-operator">==</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><a name="local-6989586621681307071"><a href="#local-6989586621681307071"><span class="hs-identifier">m2</span></a></a><span> </span><a name="local-6989586621681307072"><a href="#local-6989586621681307072"><span class="hs-identifier">o2</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307069"><span class="hs-identifier hs-var">m1</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681307071"><span class="hs-identifier hs-var">m2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621681307070"><span class="hs-identifier hs-var">o1</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681307072"><span class="hs-identifier hs-var">o2</span></a><span>
</span><a name="line-300"></a><span>    </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><a name="local-6989586621681307073"><a href="#local-6989586621681307073"><span class="hs-identifier">m1</span></a></a><span> </span><a name="local-6989586621681307074"><a href="#local-6989586621681307074"><span class="hs-identifier">o1</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-operator">==</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><a name="local-6989586621681307075"><a href="#local-6989586621681307075"><span class="hs-identifier">m2</span></a></a><span> </span><a name="local-6989586621681307076"><a href="#local-6989586621681307076"><span class="hs-identifier">o2</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307073"><span class="hs-identifier hs-var">m1</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681307075"><span class="hs-identifier hs-var">m2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621681307074"><span class="hs-identifier hs-var">o1</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681307076"><span class="hs-identifier hs-var">o2</span></a><span>
</span><a name="line-301"></a><span>    </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a name="local-6989586621681307077"><a href="#local-6989586621681307077"><span class="hs-identifier">o1</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-operator">==</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a name="local-6989586621681307078"><a href="#local-6989586621681307078"><span class="hs-identifier">o2</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307077"><span class="hs-identifier hs-var">o1</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621681307078"><span class="hs-identifier hs-var">o2</span></a><span>
</span><a name="line-302"></a><span>    </span><span class="hs-identifier">_</span><span>             </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-305"></a><span>    </span><a name="local-6989586621681307043"><a href="#local-6989586621681307043"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-8214565720323790495"><span class="hs-operator">&lt;=</span></a><span> </span><a name="local-6989586621681307044"><a href="#local-6989586621681307044"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307043"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307044"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">;</span><span>  </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">;</span><span>  </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-306"></a><span>    </span><a name="local-6989586621681307045"><a href="#local-6989586621681307045"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-8214565720323790500"><span class="hs-operator">&lt;</span></a><span>  </span><a name="local-6989586621681307046"><a href="#local-6989586621681307046"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307045"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307046"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">;</span><span>  </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-307"></a><span>    </span><a name="local-6989586621681307047"><a href="#local-6989586621681307047"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-3458764513820541096"><span class="hs-operator">&gt;=</span></a><span> </span><a name="local-6989586621681307048"><a href="#local-6989586621681307048"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307047"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307048"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">;</span><span>  </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-308"></a><span>    </span><a name="local-6989586621681307049"><a href="#local-6989586621681307049"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-8214565720323790501"><span class="hs-operator">&gt;</span></a><span>  </span><a name="local-6989586621681307050"><a href="#local-6989586621681307050"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307049"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307050"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span>        </span><span class="hs-comment">-- Exact &lt; Unqual &lt; Qual &lt; Orig</span><span>
</span><a name="line-311"></a><span>        </span><span class="hs-comment">-- [Note: Apr 2004] We used to use nukeExact to convert Exact to Orig</span><span>
</span><a name="line-312"></a><span>        </span><span class="hs-comment">--      before comparing so that Prelude.map == the exact Prelude.map, but</span><span>
</span><a name="line-313"></a><span>        </span><span class="hs-comment">--      that meant that we reported duplicates when renaming bindings</span><span>
</span><a name="line-314"></a><span>        </span><span class="hs-comment">--      generated by Template Haskell; e.g</span><span>
</span><a name="line-315"></a><span>        </span><span class="hs-comment">--      do { n1 &lt;- newName &quot;foo&quot;; n2 &lt;- newName &quot;foo&quot;;</span><span>
</span><a name="line-316"></a><span>        </span><span class="hs-comment">--           &lt;decl involving n1,n2&gt; }</span><span>
</span><a name="line-317"></a><span>        </span><span class="hs-comment">--      I think we can do without this conversion</span><span>
</span><a name="line-318"></a><span>    </span><a name="local-8214565720323790496"><span class="hs-identifier">compare</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307051"><a href="#local-6989586621681307051"><span class="hs-identifier">n1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307052"><a href="#local-6989586621681307052"><span class="hs-identifier">n2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307051"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307052"><span class="hs-identifier hs-var">n2</span></a><span>
</span><a name="line-319"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-322"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a name="local-6989586621681307053"><a href="#local-6989586621681307053"><span class="hs-identifier">o1</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span>  </span><a name="local-6989586621681307054"><a href="#local-6989586621681307054"><span class="hs-identifier">o2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307053"><span class="hs-identifier hs-var">o1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307054"><span class="hs-identifier hs-var">o2</span></a><span>
</span><a name="line-323"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-326"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-327"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><a name="local-6989586621681307055"><a href="#local-6989586621681307055"><span class="hs-identifier">m1</span></a></a><span> </span><a name="local-6989586621681307056"><a href="#local-6989586621681307056"><span class="hs-identifier">o1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><a name="local-6989586621681307057"><a href="#local-6989586621681307057"><span class="hs-identifier">m2</span></a></a><span> </span><a name="local-6989586621681307058"><a href="#local-6989586621681307058"><span class="hs-identifier">o2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307056"><span class="hs-identifier hs-var">o1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307058"><span class="hs-identifier hs-var">o2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307055"><span class="hs-identifier hs-var">m1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307057"><span class="hs-identifier hs-var">m2</span></a><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-329"></a><span>
</span><a name="line-330"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><a name="local-6989586621681307059"><a href="#local-6989586621681307059"><span class="hs-identifier">m1</span></a></a><span> </span><a name="local-6989586621681307060"><a href="#local-6989586621681307060"><span class="hs-identifier">o1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><a name="local-6989586621681307061"><a href="#local-6989586621681307061"><span class="hs-identifier">m2</span></a></a><span> </span><a name="local-6989586621681307062"><a href="#local-6989586621681307062"><span class="hs-identifier">o2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307060"><span class="hs-identifier hs-var">o1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307062"><span class="hs-identifier hs-var">o2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307059"><span class="hs-identifier hs-var">m1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307061"><span class="hs-identifier hs-var">m2</span></a><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>    </span><span class="hs-identifier">compare</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        LocalRdrEnv
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span class="hs-comment">-- | Local Reader Environment</span><span>
</span><a name="line-342"></a><span class="hs-comment">--</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- This environment is used to store local bindings</span><span>
</span><a name="line-344"></a><span class="hs-comment">-- (@let@, @where@, lambda, @case@).</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- It is keyed by OccName, because we never use it for qualified names</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- We keep the current mapping, *and* the set of all Names in scope</span><span>
</span><a name="line-347"></a><span class="hs-comment">-- Reason: see Note [Splicing Exact names] in RnEnv</span><span>
</span><a name="line-348"></a><span class="hs-keyword">data</span><span> </span><a name="LocalRdrEnv"><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier">LocalRdrEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="LRE"><a href="RdrName.html#LRE"><span class="hs-identifier">LRE</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="lre_env"><a href="RdrName.html#lre_env"><span class="hs-identifier">lre_env</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-349"></a><span>                       </span><span class="hs-special">,</span><span> </span><a name="lre_in_scope"><a href="RdrName.html#lre_in_scope"><span class="hs-identifier">lre_in_scope</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-350"></a><span>
</span><a name="line-351"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-352"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#LRE"><span class="hs-identifier hs-var">LRE</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307039"><a href="#local-6989586621681307039"><span class="hs-identifier">env</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">lre_in_scope</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307040"><a href="#local-6989586621681307040"><span class="hs-identifier">ns</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-353"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;LocalRdrEnv {&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-354"></a><span>         </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;env =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="OccName.html#pprOccEnv"><span class="hs-identifier hs-var">pprOccEnv</span></a><span> </span><a href="#local-6989586621681307041"><span class="hs-identifier hs-var">ppr_elt</span></a><span> </span><a href="#local-6989586621681307039"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-355"></a><span>                 </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in_scope =&quot;</span><span>
</span><a name="line-356"></a><span>                    </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="UniqFM.html#pprUFM"><span class="hs-identifier hs-var">pprUFM</span></a><span> </span><span class="hs-special">(</span><a href="UniqSet.html#getUniqSet"><span class="hs-identifier hs-var">getUniqSet</span></a><span> </span><a href="#local-6989586621681307040"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>                 </span><span class="hs-special">]</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'}'</span><span class="hs-special">)</span><span>
</span><a name="line-358"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-359"></a><span>      </span><a name="local-6989586621681307041"><a href="#local-6989586621681307041"><span class="hs-identifier">ppr_elt</span></a></a><span> </span><a name="local-6989586621681307042"><a href="#local-6989586621681307042"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681307042"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307042"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-360"></a><span>                     </span><span class="hs-comment">-- So we can see if the keys line up correctly</span><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-identifier">emptyLocalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span>
</span><a name="line-363"></a><a name="emptyLocalRdrEnv"><a href="RdrName.html#emptyLocalRdrEnv"><span class="hs-identifier">emptyLocalRdrEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#LRE"><span class="hs-identifier hs-var">LRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#emptyOccEnv"><span class="hs-identifier hs-var">emptyOccEnv</span></a><span>
</span><a name="line-364"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lre_in_scope</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-identifier">extendLocalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span>
</span><a name="line-367"></a><span class="hs-comment">-- The Name should be a non-top-level thing</span><span>
</span><a name="line-368"></a><a name="extendLocalRdrEnv"><a href="RdrName.html#extendLocalRdrEnv"><span class="hs-identifier">extendLocalRdrEnv</span></a></a><span> </span><a name="local-6989586621681307120"><a href="#local-6989586621681307120"><span class="hs-identifier">lre</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#LRE"><span class="hs-identifier hs-var">LRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307121"><a href="#local-6989586621681307121"><span class="hs-identifier">env</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">lre_in_scope</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307122"><a href="#local-6989586621681307122"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681307123"><a href="#local-6989586621681307123"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-369"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307123"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-370"></a><span>    </span><a href="#local-6989586621681307120"><span class="hs-identifier hs-var">lre</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#extendOccEnv"><span class="hs-identifier hs-var">extendOccEnv</span></a><span> </span><a href="#local-6989586621681307121"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681307123"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307123"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-371"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lre_in_scope</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a><span> </span><a href="#local-6989586621681307122"><span class="hs-identifier hs-var">ns</span></a><span> </span><a href="#local-6989586621681307123"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span class="hs-identifier">extendLocalRdrEnvList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span>
</span><a name="line-374"></a><a name="extendLocalRdrEnvList"><a href="RdrName.html#extendLocalRdrEnvList"><span class="hs-identifier">extendLocalRdrEnvList</span></a></a><span> </span><a name="local-6989586621681307124"><a href="#local-6989586621681307124"><span class="hs-identifier">lre</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#LRE"><span class="hs-identifier hs-var">LRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307125"><a href="#local-6989586621681307125"><span class="hs-identifier">env</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">lre_in_scope</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307126"><a href="#local-6989586621681307126"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681307127"><a href="#local-6989586621681307127"><span class="hs-identifier">names</span></a></a><span>
</span><a name="line-375"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><a href="Outputable.html#warnPprTrace"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-identifier">isExternalName</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">names</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>    </span><a href="#local-6989586621681307124"><span class="hs-identifier hs-var">lre</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#extendOccEnvList"><span class="hs-identifier hs-var">extendOccEnvList</span></a><span> </span><a href="#local-6989586621681307125"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681307128"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681307128"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681307128"><a href="#local-6989586621681307128"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681307127"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">]</span><span>
</span><a name="line-377"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lre_in_scope</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#extendNameSetList"><span class="hs-identifier hs-var">extendNameSetList</span></a><span> </span><a href="#local-6989586621681307126"><span class="hs-identifier hs-var">ns</span></a><span> </span><a href="#local-6989586621681307127"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-identifier">lookupLocalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-380"></a><a name="lookupLocalRdrEnv"><a href="RdrName.html#lookupLocalRdrEnv"><span class="hs-identifier">lookupLocalRdrEnv</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#LRE"><span class="hs-identifier hs-var">LRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307129"><a href="#local-6989586621681307129"><span class="hs-identifier">env</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">lre_in_scope</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307130"><a href="#local-6989586621681307130"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681307131"><a href="#local-6989586621681307131"><span class="hs-identifier">rdr</span></a></a><span>
</span><a name="line-381"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a name="local-6989586621681307132"><a href="#local-6989586621681307132"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681307131"><span class="hs-identifier hs-var">rdr</span></a><span>
</span><a name="line-382"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-6989586621681307129"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681307132"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span>  </span><span class="hs-comment">-- See Note [Local bindings with Exact Names]</span><span>
</span><a name="line-385"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307133"><a href="#local-6989586621681307133"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681307131"><span class="hs-identifier hs-var">rdr</span></a><span>
</span><a name="line-386"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681307133"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307130"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-387"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681307133"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-390"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-identifier">lookupLocalRdrOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-393"></a><a name="lookupLocalRdrOcc"><a href="RdrName.html#lookupLocalRdrOcc"><span class="hs-identifier">lookupLocalRdrOcc</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#LRE"><span class="hs-identifier hs-var">LRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307134"><a href="#local-6989586621681307134"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681307135"><a href="#local-6989586621681307135"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-6989586621681307134"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681307135"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-394"></a><span>
</span><a name="line-395"></a><span class="hs-identifier">elemLocalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-396"></a><a name="elemLocalRdrEnv"><a href="RdrName.html#elemLocalRdrEnv"><span class="hs-identifier">elemLocalRdrEnv</span></a></a><span> </span><a name="local-6989586621681307136"><a href="#local-6989586621681307136"><span class="hs-identifier">rdr_name</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#LRE"><span class="hs-identifier hs-var">LRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307137"><a href="#local-6989586621681307137"><span class="hs-identifier">env</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">lre_in_scope</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307138"><a href="#local-6989586621681307138"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-397"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681307136"><span class="hs-identifier hs-var">rdr_name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-398"></a><span>      </span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a name="local-6989586621681307139"><a href="#local-6989586621681307139"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681307139"><span class="hs-identifier hs-var">occ</span></a><span>  </span><span class="hs-special">`</span><a href="OccName.html#elemOccEnv"><span class="hs-identifier hs-var">elemOccEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307137"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-399"></a><span>      </span><a href="RdrName.html#Exact"><span class="hs-identifier hs-var">Exact</span></a><span> </span><a name="local-6989586621681307140"><a href="#local-6989586621681307140"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681307140"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307138"><span class="hs-identifier hs-var">ns</span></a><span>  </span><span class="hs-comment">-- See Note [Local bindings with Exact Names]</span><span>
</span><a name="line-400"></a><span>      </span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-401"></a><span>      </span><a href="RdrName.html#Orig"><span class="hs-identifier hs-var">Orig</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span class="hs-identifier">localRdrEnvElts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-404"></a><a name="localRdrEnvElts"><a href="RdrName.html#localRdrEnvElts"><span class="hs-identifier">localRdrEnvElts</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#LRE"><span class="hs-identifier hs-var">LRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307141"><a href="#local-6989586621681307141"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#occEnvElts"><span class="hs-identifier hs-var">occEnvElts</span></a><span> </span><a href="#local-6989586621681307141"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span class="hs-identifier">inLocalRdrEnvScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-407"></a><span class="hs-comment">-- This is the point of the NameSet</span><span>
</span><a name="line-408"></a><a name="inLocalRdrEnvScope"><a href="RdrName.html#inLocalRdrEnvScope"><span class="hs-identifier">inLocalRdrEnvScope</span></a></a><span> </span><a name="local-6989586621681307142"><a href="#local-6989586621681307142"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#LRE"><span class="hs-identifier hs-var">LRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_in_scope</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307143"><a href="#local-6989586621681307143"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307142"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307143"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-409"></a><span>
</span><a name="line-410"></a><span class="hs-identifier">delLocalRdrEnvList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span>
</span><a name="line-411"></a><a name="delLocalRdrEnvList"><a href="RdrName.html#delLocalRdrEnvList"><span class="hs-identifier">delLocalRdrEnvList</span></a></a><span> </span><a name="local-6989586621681307144"><a href="#local-6989586621681307144"><span class="hs-identifier">lre</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#LRE"><span class="hs-identifier hs-var">LRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307145"><a href="#local-6989586621681307145"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681307146"><a href="#local-6989586621681307146"><span class="hs-identifier">occs</span></a></a><span>
</span><a name="line-412"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307144"><span class="hs-identifier hs-var">lre</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">lre_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#delListFromOccEnv"><span class="hs-identifier hs-var">delListFromOccEnv</span></a><span> </span><a href="#local-6989586621681307145"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681307146"><span class="hs-identifier hs-var">occs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span class="hs-comment">{-
Note [Local bindings with Exact Names]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
With Template Haskell we can make local bindings that have Exact Names.
Computing shadowing etc may use elemLocalRdrEnv (at least it certainly
does so in RnTpes.bindHsQTyVars), so for an Exact Name we must consult
the in-scope-name-set.


************************************************************************
*                                                                      *
                        GlobalRdrEnv
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-429"></a><span>
</span><a name="line-430"></a><span class="hs-comment">-- | Global Reader Environment</span><span>
</span><a name="line-431"></a><span class="hs-keyword">type</span><span> </span><a name="GlobalRdrEnv"><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier">GlobalRdrEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-432"></a><span class="hs-comment">-- ^ Keyed by 'OccName'; when looking up a qualified name</span><span>
</span><a name="line-433"></a><span class="hs-comment">-- we look up the 'OccName' part, and then check the 'Provenance'</span><span>
</span><a name="line-434"></a><span class="hs-comment">-- to see if the appropriate qualification is valid.  This</span><span>
</span><a name="line-435"></a><span class="hs-comment">-- saves routinely doubling the size of the env by adding both</span><span>
</span><a name="line-436"></a><span class="hs-comment">-- qualified and unqualified names to the domain.</span><span>
</span><a name="line-437"></a><span class="hs-comment">--</span><span>
</span><a name="line-438"></a><span class="hs-comment">-- The list in the codomain is required because there may be name clashes</span><span>
</span><a name="line-439"></a><span class="hs-comment">-- These only get reported on lookup, not on construction</span><span>
</span><a name="line-440"></a><span class="hs-comment">--</span><span>
</span><a name="line-441"></a><span class="hs-comment">-- INVARIANT 1: All the members of the list have distinct</span><span>
</span><a name="line-442"></a><span class="hs-comment">--              'gre_name' fields; that is, no duplicate Names</span><span>
</span><a name="line-443"></a><span class="hs-comment">--</span><span>
</span><a name="line-444"></a><span class="hs-comment">-- INVARIANT 2: Imported provenance =&gt; Name is an ExternalName</span><span>
</span><a name="line-445"></a><span class="hs-comment">--              However LocalDefs can have an InternalName.  This</span><span>
</span><a name="line-446"></a><span class="hs-comment">--              happens only when type-checking a [d| ... |] Template</span><span>
</span><a name="line-447"></a><span class="hs-comment">--              Haskell quotation; see this note in RnNames</span><span>
</span><a name="line-448"></a><span class="hs-comment">--              Note [Top-level Names in Template Haskell decl quotes]</span><span>
</span><a name="line-449"></a><span class="hs-comment">--</span><span>
</span><a name="line-450"></a><span class="hs-comment">-- INVARIANT 3: If the GlobalRdrEnv maps [occ -&gt; gre], then</span><span>
</span><a name="line-451"></a><span class="hs-comment">--                 greOccName gre = occ</span><span>
</span><a name="line-452"></a><span class="hs-comment">--</span><span>
</span><a name="line-453"></a><span class="hs-comment">--              NB: greOccName gre is usually the same as</span><span>
</span><a name="line-454"></a><span class="hs-comment">--                  nameOccName (gre_name gre), but not always in the</span><span>
</span><a name="line-455"></a><span class="hs-comment">--                  case of record seectors; see greOccName</span><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><span class="hs-comment">-- | Global Reader Element</span><span>
</span><a name="line-458"></a><span class="hs-comment">--</span><span>
</span><a name="line-459"></a><span class="hs-comment">-- An element of the 'GlobalRdrEnv'</span><span>
</span><a name="line-460"></a><span class="hs-keyword">data</span><span> </span><a name="GlobalRdrElt"><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier">GlobalRdrElt</span></a></a><span>
</span><a name="line-461"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="GRE"><a href="RdrName.html#GRE"><span class="hs-identifier">GRE</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="gre_name"><a href="RdrName.html#gre_name"><span class="hs-identifier">gre_name</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-462"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="gre_par"><a href="RdrName.html#gre_par"><span class="hs-identifier">gre_par</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#Parent"><span class="hs-identifier hs-type">Parent</span></a><span>
</span><a name="line-463"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="gre_lcl"><a href="RdrName.html#gre_lcl"><span class="hs-identifier">gre_lcl</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>          </span><span class="hs-comment">-- ^ True &lt;=&gt; the thing was defined locally</span><span>
</span><a name="line-464"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="gre_imp"><a href="RdrName.html#gre_imp"><span class="hs-identifier">gre_imp</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ In scope through these imports</span><span>
</span><a name="line-465"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Data</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-466"></a><span>         </span><span class="hs-comment">-- INVARIANT: either gre_lcl = True or gre_imp is non-empty</span><span>
</span><a name="line-467"></a><span>         </span><span class="hs-comment">-- See Note [GlobalRdrElt provenance]</span><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span class="hs-comment">-- | The children of a Name are the things that are abbreviated by the &quot;..&quot;</span><span>
</span><a name="line-470"></a><span class="hs-comment">--   notation in export lists.  See Note [Parents]</span><span>
</span><a name="line-471"></a><span class="hs-keyword">data</span><span> </span><a name="Parent"><a href="RdrName.html#Parent"><span class="hs-identifier">Parent</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="NoParent"><a href="RdrName.html#NoParent"><span class="hs-identifier">NoParent</span></a></a><span>
</span><a name="line-472"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="ParentIs"><a href="RdrName.html#ParentIs"><span class="hs-identifier">ParentIs</span></a></a><span>  </span><span class="hs-special">{</span><span> </span><a name="par_is"><a href="RdrName.html#par_is"><span class="hs-identifier">par_is</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-473"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="FldParent"><a href="RdrName.html#FldParent"><span class="hs-identifier">FldParent</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="par_is"><a href="RdrName.html#par_is"><span class="hs-identifier">par_is</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a name="par_lbl"><a href="RdrName.html#par_lbl"><span class="hs-identifier">par_lbl</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-474"></a><span>              </span><span class="hs-comment">-- ^ See Note [Parents for record fields]</span><span>
</span><a name="line-475"></a><span>            </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Data</span><span class="hs-special">)</span><span>
</span><a name="line-476"></a><span>
</span><a name="line-477"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="RdrName.html#Parent"><span class="hs-identifier hs-type">Parent</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-478"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="RdrName.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-479"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a><span> </span><a name="local-6989586621681307036"><a href="#local-6989586621681307036"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;parent:&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307036"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-480"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span> </span><a name="local-6989586621681307037"><a href="#local-6989586621681307037"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681307038"><a href="#local-6989586621681307038"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;fldparent:&quot;</span><span>
</span><a name="line-481"></a><span>                             </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307037"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307038"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-482"></a><span>
</span><a name="line-483"></a><span class="hs-identifier">plusParent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#Parent"><span class="hs-identifier hs-type">Parent</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#Parent"><span class="hs-identifier hs-type">Parent</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#Parent"><span class="hs-identifier hs-type">Parent</span></a><span>
</span><a name="line-484"></a><span class="hs-comment">-- See Note [Combining parents]</span><span>
</span><a name="line-485"></a><a name="plusParent"><a href="RdrName.html#plusParent"><span class="hs-identifier">plusParent</span></a></a><span> </span><a name="local-6989586621681307147"><a href="#local-6989586621681307147"><span class="hs-identifier">p1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><a name="local-6989586621681307148"><a href="#local-6989586621681307148"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#hasParent"><span class="hs-identifier hs-var">hasParent</span></a><span> </span><a href="#local-6989586621681307147"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621681307148"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-486"></a><span class="hs-identifier">plusParent</span><span> </span><a name="local-6989586621681307149"><a href="#local-6989586621681307149"><span class="hs-identifier">p1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681307150"><a href="#local-6989586621681307150"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#hasParent"><span class="hs-identifier hs-var">hasParent</span></a><span> </span><a href="#local-6989586621681307149"><span class="hs-identifier hs-var">p1</span></a><span> </span><a href="#local-6989586621681307150"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-487"></a><span class="hs-identifier">plusParent</span><span> </span><a name="local-6989586621681307151"><a href="#local-6989586621681307151"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621681307152"><a href="#local-6989586621681307152"><span class="hs-identifier">p2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#hasParent"><span class="hs-identifier hs-var">hasParent</span></a><span> </span><a href="#local-6989586621681307152"><span class="hs-identifier hs-var">p2</span></a><span> </span><a href="#local-6989586621681307151"><span class="hs-identifier hs-var">p1</span></a><span>
</span><a name="line-488"></a><span class="hs-identifier">plusParent</span><span> </span><a name="local-6989586621681307153"><a href="#local-6989586621681307153"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621681307154"><a href="#local-6989586621681307154"><span class="hs-identifier">p2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#hasParent"><span class="hs-identifier hs-var">hasParent</span></a><span> </span><a href="#local-6989586621681307154"><span class="hs-identifier hs-var">p2</span></a><span> </span><a href="#local-6989586621681307153"><span class="hs-identifier hs-var">p1</span></a><span>
</span><a name="line-489"></a><span class="hs-identifier">plusParent</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span class="hs-identifier">hasParent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#Parent"><span class="hs-identifier hs-type">Parent</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#Parent"><span class="hs-identifier hs-type">Parent</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#Parent"><span class="hs-identifier hs-type">Parent</span></a><span>
</span><a name="line-492"></a><span class="hs-cpp">#if defined(DEBUG)
</span><span class="hs-identifier">hasParent</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">NoParent</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-494"></a><span class="hs-identifier">hasParent</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">p'</span><span>
</span><a name="line-495"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-operator">/=</span><span> </span><span class="hs-identifier">p'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pprPanic</span><span> </span><span class="hs-string">&quot;hasParent&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">p'</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Parents should agree</span><span>
</span><a name="line-496"></a><span class="hs-cpp">#endif
</span><a name="hasParent"><a href="RdrName.html#hasParent"><span class="hs-identifier">hasParent</span></a></a><span> </span><a name="local-6989586621681307155"><a href="#local-6989586621681307155"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307155"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-498"></a><span>
</span><a name="line-499"></a><span>
</span><a name="line-500"></a><span class="hs-comment">{- Note [GlobalRdrElt provenance]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The gre_lcl and gre_imp fields of a GlobalRdrElt describe its &quot;provenance&quot;,
i.e. how the Name came to be in scope.  It can be in scope two ways:
  - gre_lcl = True: it is bound in this module
  - gre_imp: a list of all the imports that brought it into scope

It's an INVARIANT that you have one or the other; that is, either
gre_lcl is True, or gre_imp is non-empty.

It is just possible to have *both* if there is a module loop: a Name
is defined locally in A, and also brought into scope by importing a
module that SOURCE-imported A.  Exapmle (Trac #7672):

 A.hs-boot   module A where
               data T

 B.hs        module B(Decl.T) where
               import {-# SOURCE #-} qualified A as Decl

 A.hs        module A where
               import qualified B
               data T = Z | S B.T

In A.hs, 'T' is locally bound, *and* imported as B.T.

Note [Parents]
~~~~~~~~~~~~~~~~~
  Parent           Children
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  data T           Data constructors
                   Record-field ids

  data family T    Data constructors and record-field ids
                   of all visible data instances of T

  class C          Class operations
                   Associated type constructors

~~~~~~~~~~~~~~~~~~~~~~~~~
 Constructor      Meaning
 ~~~~~~~~~~~~~~~~~~~~~~~~
  NoParent        Can not be bundled with a type constructor.
  ParentIs n      Can be bundled with the type constructor corresponding to
                  n.
  FldParent       See Note [Parents for record fields]




Note [Parents for record fields]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For record fields, in addition to the Name of the type constructor
(stored in par_is), we use FldParent to store the field label.  This
extra information is used for identifying overloaded record fields
during renaming.

In a definition arising from a normal module (without
-XDuplicateRecordFields), par_lbl will be Nothing, meaning that the
field's label is the same as the OccName of the selector's Name.  The
GlobalRdrEnv will contain an entry like this:

    &quot;x&quot; |-&gt;  GRE x (FldParent T Nothing) LocalDef

When -XDuplicateRecordFields is enabled for the module that contains
T, the selector's Name will be mangled (see comments in FieldLabel).
Thus we store the actual field label in par_lbl, and the GlobalRdrEnv
entry looks like this:

    &quot;x&quot; |-&gt;  GRE $sel:x:MkT (FldParent T (Just &quot;x&quot;)) LocalDef

Note that the OccName used when adding a GRE to the environment
(greOccName) now depends on the parent field: for FldParent it is the
field label, if present, rather than the selector name.

~~

Record pattern synonym selectors are treated differently. Their parent
information is `NoParent` in the module in which they are defined. This is because
a pattern synonym `P` has no parent constructor either.

However, if `f` is bundled with a type constructor `T` then whenever `f` is
imported the parent will use the `Parent` constructor so the parent of `f` is
now `T`.


Note [Combining parents]
~~~~~~~~~~~~~~~~~~~~~~~~
With an associated type we might have
   module M where
     class C a where
       data T a
       op :: T a -&gt; a
     instance C Int where
       data T Int = TInt
     instance C Bool where
       data T Bool = TBool

Then:   C is the parent of T
        T is the parent of TInt and TBool
So: in an export list
    C(..) is short for C( op, T )
    T(..) is short for T( TInt, TBool )

Module M exports everything, so its exports will be
   AvailTC C [C,T,op]
   AvailTC T [T,TInt,TBool]
On import we convert to GlobalRdrElt and then combine
those.  For T that will mean we have
  one GRE with Parent C
  one GRE with NoParent
That's why plusParent picks the &quot;best&quot; case.
-}</span><span>
</span><a name="line-613"></a><span>
</span><a name="line-614"></a><span class="hs-comment">-- | make a 'GlobalRdrEnv' where all the elements point to the same</span><span>
</span><a name="line-615"></a><span class="hs-comment">-- Provenance (useful for &quot;hiding&quot; imports, or imports with no details).</span><span>
</span><a name="line-616"></a><span class="hs-identifier">gresFromAvails</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-617"></a><span class="hs-comment">-- prov = Nothing   =&gt; locally bound</span><span>
</span><a name="line-618"></a><span class="hs-comment">--        Just spec =&gt; imported as described by spec</span><span>
</span><a name="line-619"></a><a name="gresFromAvails"><a href="RdrName.html#gresFromAvails"><span class="hs-identifier">gresFromAvails</span></a></a><span> </span><a name="local-6989586621681307156"><a href="#local-6989586621681307156"><span class="hs-identifier">prov</span></a></a><span> </span><a name="local-6989586621681307157"><a href="#local-6989586621681307157"><span class="hs-identifier">avails</span></a></a><span>
</span><a name="line-620"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#gresFromAvail"><span class="hs-identifier hs-var">gresFromAvail</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621681307156"><span class="hs-identifier hs-var">prov</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307157"><span class="hs-identifier hs-var">avails</span></a><span>
</span><a name="line-621"></a><span>
</span><a name="line-622"></a><span class="hs-identifier">localGREsFromAvail</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-623"></a><span class="hs-comment">-- Turn an Avail into a list of LocalDef GlobalRdrElts</span><span>
</span><a name="line-624"></a><a name="localGREsFromAvail"><a href="RdrName.html#localGREsFromAvail"><span class="hs-identifier">localGREsFromAvail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#gresFromAvail"><span class="hs-identifier hs-var">gresFromAvail</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-625"></a><span>
</span><a name="line-626"></a><span class="hs-identifier">gresFromAvail</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-627"></a><a name="gresFromAvail"><a href="RdrName.html#gresFromAvail"><span class="hs-identifier">gresFromAvail</span></a></a><span> </span><a name="local-6989586621681307158"><a href="#local-6989586621681307158"><span class="hs-identifier">prov_fn</span></a></a><span> </span><a name="local-6989586621681307159"><a href="#local-6989586621681307159"><span class="hs-identifier">avail</span></a></a><span>
</span><a name="line-628"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621681307160"><span class="hs-identifier hs-var">mk_gre</span></a><span> </span><span class="hs-special">(</span><a href="Avail.html#availNonFldNames"><span class="hs-identifier hs-var">availNonFldNames</span></a><span> </span><a href="#local-6989586621681307159"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621681307161"><span class="hs-identifier hs-var">mk_fld_gre</span></a><span> </span><span class="hs-special">(</span><a href="Avail.html#availFlds"><span class="hs-identifier hs-var">availFlds</span></a><span> </span><a href="#local-6989586621681307159"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span>
</span><a name="line-629"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-630"></a><span>    </span><a name="local-6989586621681307160"><a href="#local-6989586621681307160"><span class="hs-identifier">mk_gre</span></a></a><span> </span><a name="local-6989586621681307162"><a href="#local-6989586621681307162"><span class="hs-identifier">n</span></a></a><span>
</span><a name="line-631"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681307158"><span class="hs-identifier hs-var">prov_fn</span></a><span> </span><a href="#local-6989586621681307162"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- Nothing =&gt; bound locally</span><span>
</span><a name="line-632"></a><span>                           </span><span class="hs-comment">-- Just is =&gt; imported from 'is'</span><span>
</span><a name="line-633"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307162"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_par</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#mkParent"><span class="hs-identifier hs-var">mkParent</span></a><span> </span><a href="#local-6989586621681307162"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621681307159"><span class="hs-identifier hs-var">avail</span></a><span>
</span><a name="line-634"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-635"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307163"><a href="#local-6989586621681307163"><span class="hs-identifier">is</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307162"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_par</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#mkParent"><span class="hs-identifier hs-var">mkParent</span></a><span> </span><a href="#local-6989586621681307162"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621681307159"><span class="hs-identifier hs-var">avail</span></a><span>
</span><a name="line-636"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307163"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-637"></a><span>
</span><a name="line-638"></a><span>    </span><a name="local-6989586621681307161"><a href="#local-6989586621681307161"><span class="hs-identifier">mk_fld_gre</span></a></a><span> </span><span class="hs-special">(</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-var">FieldLabel</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">flLabel</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307164"><a href="#local-6989586621681307164"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">flIsOverloaded</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307165"><a href="#local-6989586621681307165"><span class="hs-identifier">is_overloaded</span></a></a><span>
</span><a name="line-639"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">flSelector</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307166"><a href="#local-6989586621681307166"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-640"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681307158"><span class="hs-identifier hs-var">prov_fn</span></a><span> </span><a href="#local-6989586621681307166"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>  </span><span class="hs-comment">-- Nothing =&gt; bound locally</span><span>
</span><a name="line-641"></a><span>                           </span><span class="hs-comment">-- Just is =&gt; imported from 'is'</span><span>
</span><a name="line-642"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307166"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_par</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span> </span><span class="hs-special">(</span><a href="Avail.html#availName"><span class="hs-identifier hs-var">availName</span></a><span> </span><a href="#local-6989586621681307159"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307167"><span class="hs-identifier hs-var">mb_lbl</span></a><span>
</span><a name="line-643"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-644"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307168"><a href="#local-6989586621681307168"><span class="hs-identifier">is</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307166"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_par</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span> </span><span class="hs-special">(</span><a href="Avail.html#availName"><span class="hs-identifier hs-var">availName</span></a><span> </span><a href="#local-6989586621681307159"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307167"><span class="hs-identifier hs-var">mb_lbl</span></a><span>
</span><a name="line-645"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307168"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-646"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-647"></a><span>        </span><a name="local-6989586621681307167"><a href="#local-6989586621681307167"><span class="hs-identifier">mb_lbl</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307165"><span class="hs-identifier hs-var">is_overloaded</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681307164"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-648"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span>
</span><a name="line-651"></a><span class="hs-identifier">greQualModName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-652"></a><span class="hs-comment">-- Get a suitable module qualifier for the GRE</span><span>
</span><a name="line-653"></a><span class="hs-comment">-- (used in mkPrintUnqualified)</span><span>
</span><a name="line-654"></a><span class="hs-comment">-- Prerecondition: the gre_name is always External</span><span>
</span><a name="line-655"></a><a name="greQualModName"><a href="RdrName.html#greQualModName"><span class="hs-identifier">greQualModName</span></a></a><span> </span><a name="local-6989586621681307169"><a href="#local-6989586621681307169"><span class="hs-identifier">gre</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307170"><a href="#local-6989586621681307170"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307171"><a href="#local-6989586621681307171"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307172"><a href="#local-6989586621681307172"><span class="hs-identifier">iss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-656"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307171"><span class="hs-identifier hs-var">lcl</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307173"><a href="#local-6989586621681307173"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-6989586621681307170"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621681307173"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-657"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681307174"><a href="#local-6989586621681307174"><span class="hs-identifier">is</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681307172"><span class="hs-identifier hs-var">iss</span></a><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">is_as</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_decl</span><span> </span><a href="#local-6989586621681307174"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-658"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;greQualModName&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307169"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span>
</span><a name="line-659"></a><span>
</span><a name="line-660"></a><span class="hs-identifier">greRdrNames</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span class="hs-special">]</span><span>
</span><a name="line-661"></a><a name="greRdrNames"><a href="RdrName.html#greRdrNames"><span class="hs-identifier">greRdrNames</span></a></a><span> </span><a name="local-6989586621681307175"><a href="#local-6989586621681307175"><span class="hs-identifier">gre</span></a></a><span class="hs-glyph">@</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307176"><a href="#local-6989586621681307176"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307177"><a href="#local-6989586621681307177"><span class="hs-identifier">iss</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-662"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681307176"><span class="hs-identifier hs-var">lcl</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307179"><span class="hs-identifier hs-var">unqual</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="#local-6989586621681307180"><span class="hs-identifier hs-var">do_spec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">is_decl</span><span> </span><a href="#local-6989586621681307177"><span class="hs-identifier hs-var">iss</span></a><span class="hs-special">)</span><span>
</span><a name="line-663"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-664"></a><span>    </span><a name="local-6989586621681307178"><a href="#local-6989586621681307178"><span class="hs-identifier">occ</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#greOccName"><span class="hs-identifier hs-var">greOccName</span></a><span> </span><a href="#local-6989586621681307175"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-665"></a><span>    </span><a name="local-6989586621681307179"><a href="#local-6989586621681307179"><span class="hs-identifier">unqual</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a href="#local-6989586621681307178"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-666"></a><span>    </span><a name="local-6989586621681307180"><a href="#local-6989586621681307180"><span class="hs-identifier">do_spec</span></a></a><span> </span><a name="local-6989586621681307181"><a href="#local-6989586621681307181"><span class="hs-identifier">decl_spec</span></a></a><span>
</span><a name="line-667"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">is_qual</span><span> </span><a href="#local-6989586621681307181"><span class="hs-identifier hs-var">decl_spec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307182"><span class="hs-identifier hs-var">qual</span></a><span class="hs-special">]</span><span>
</span><a name="line-668"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307179"><span class="hs-identifier hs-var">unqual</span></a><span class="hs-special">,</span><a href="#local-6989586621681307182"><span class="hs-identifier hs-var">qual</span></a><span class="hs-special">]</span><span>
</span><a name="line-669"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681307182"><a href="#local-6989586621681307182"><span class="hs-identifier">qual</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_as</span><span> </span><a href="#local-6989586621681307181"><span class="hs-identifier hs-var">decl_spec</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307178"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-670"></a><span>
</span><a name="line-671"></a><span class="hs-comment">-- the SrcSpan that pprNameProvenance prints out depends on whether</span><span>
</span><a name="line-672"></a><span class="hs-comment">-- the Name is defined locally or not: for a local definition the</span><span>
</span><a name="line-673"></a><span class="hs-comment">-- definition site is used, otherwise the location of the import</span><span>
</span><a name="line-674"></a><span class="hs-comment">-- declaration.  We want to sort the export locations in</span><span>
</span><a name="line-675"></a><span class="hs-comment">-- exportClashErr by this SrcSpan, we need to extract it:</span><span>
</span><a name="line-676"></a><span class="hs-identifier">greSrcSpan</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-677"></a><a name="greSrcSpan"><a href="RdrName.html#greSrcSpan"><span class="hs-identifier">greSrcSpan</span></a></a><span> </span><a name="local-6989586621681307183"><a href="#local-6989586621681307183"><span class="hs-identifier">gre</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307184"><a href="#local-6989586621681307184"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307185"><a href="#local-6989586621681307185"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307186"><a href="#local-6989586621681307186"><span class="hs-identifier">iss</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-678"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307185"><span class="hs-identifier hs-var">lcl</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span> </span><a href="#local-6989586621681307184"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-679"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681307187"><a href="#local-6989586621681307187"><span class="hs-identifier">is</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681307186"><span class="hs-identifier hs-var">iss</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">is_dloc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_decl</span><span> </span><a href="#local-6989586621681307187"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-680"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;greSrcSpan&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307183"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span class="hs-identifier">mkParent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#Parent"><span class="hs-identifier hs-type">Parent</span></a><span>
</span><a name="line-683"></a><a name="mkParent"><a href="RdrName.html#mkParent"><span class="hs-identifier">mkParent</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a><span>
</span><a name="line-684"></a><span class="hs-identifier">mkParent</span><span> </span><a name="local-6989586621681307188"><a href="#local-6989586621681307188"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681307189"><a href="#local-6989586621681307189"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621681307189"><span class="hs-identifier hs-var">m</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a><span>
</span><a name="line-685"></a><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a><span> </span><a href="#local-6989586621681307189"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-686"></a><span>
</span><a name="line-687"></a><span class="hs-identifier">greParent_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-688"></a><a name="greParent_maybe"><a href="RdrName.html#greParent_maybe"><span class="hs-identifier">greParent_maybe</span></a></a><span> </span><a name="local-6989586621681307190"><a href="#local-6989586621681307190"><span class="hs-identifier">gre</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">gre_par</span><span> </span><a href="#local-6989586621681307190"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-689"></a><span>                        </span><a href="RdrName.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-690"></a><span>                        </span><a href="RdrName.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a><span> </span><a name="local-6989586621681307191"><a href="#local-6989586621681307191"><span class="hs-identifier">n</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681307191"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-691"></a><span>                        </span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span> </span><a name="local-6989586621681307192"><a href="#local-6989586621681307192"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681307192"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-692"></a><span>
</span><a name="line-693"></a><span class="hs-comment">-- | Takes a list of distinct GREs and folds them</span><span>
</span><a name="line-694"></a><span class="hs-comment">-- into AvailInfos. This is more efficient than mapping each individual</span><span>
</span><a name="line-695"></a><span class="hs-comment">-- GRE to an AvailInfo and the folding using `plusAvail` but needs the</span><span>
</span><a name="line-696"></a><span class="hs-comment">-- uniqueness assumption.</span><span>
</span><a name="line-697"></a><span class="hs-identifier">gresToAvailInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-698"></a><a name="gresToAvailInfo"><a href="RdrName.html#gresToAvailInfo"><span class="hs-identifier">gresToAvailInfo</span></a></a><span> </span><a name="local-6989586621681307193"><a href="#local-6989586621681307193"><span class="hs-identifier">gres</span></a></a><span>
</span><a name="line-699"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#nameEnvElts"><span class="hs-identifier hs-var">nameEnvElts</span></a><span> </span><a href="#local-6989586621681307194"><span class="hs-identifier hs-var">avail_env</span></a><span>
</span><a name="line-700"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-701"></a><span>    </span><span class="hs-identifier">avail_env</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-comment">-- Keyed by the parent</span><span>
</span><a name="line-702"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621681307194"><a href="#local-6989586621681307194"><span class="hs-identifier">avail_env</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621681307195"><span class="hs-identifier hs-var">add</span></a><span> </span><span class="hs-special">(</span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307193"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-703"></a><span>
</span><a name="line-704"></a><span>    </span><span class="hs-identifier">add</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span class="hs-special">)</span><span>
</span><a name="line-705"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span>
</span><a name="line-706"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">,</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span class="hs-special">)</span><span>
</span><a name="line-707"></a><span>    </span><a name="local-6989586621681307195"><a href="#local-6989586621681307195"><span class="hs-identifier">add</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681307196"><a href="#local-6989586621681307196"><span class="hs-identifier">env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681307197"><a href="#local-6989586621681307197"><span class="hs-identifier">done</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681307198"><a href="#local-6989586621681307198"><span class="hs-identifier">gre</span></a></a><span>
</span><a name="line-708"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307199"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307197"><span class="hs-identifier hs-var">done</span></a><span>
</span><a name="line-709"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307196"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681307197"><span class="hs-identifier hs-var">done</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Don't insert twice into the AvailInfo</span><span>
</span><a name="line-710"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-711"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="NameEnv.html#extendNameEnv_Acc"><span class="hs-identifier hs-var">extendNameEnv_Acc</span></a><span> </span><a href="#local-6989586621681307202"><span class="hs-identifier hs-var">comb</span></a><span> </span><a href="RdrName.html#availFromGRE"><span class="hs-identifier hs-var">availFromGRE</span></a><span> </span><a href="#local-6989586621681307196"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681307200"><span class="hs-identifier hs-var">key</span></a><span> </span><a href="#local-6989586621681307198"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-712"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681307197"><span class="hs-identifier hs-var">done</span></a><span> </span><span class="hs-special">`</span><a href="NameSet.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307199"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-713"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-714"></a><span>        </span><a name="local-6989586621681307199"><a href="#local-6989586621681307199"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-6989586621681307198"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-715"></a><span>        </span><a name="local-6989586621681307200"><a href="#local-6989586621681307200"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="RdrName.html#greParent_maybe"><span class="hs-identifier hs-var">greParent_maybe</span></a><span> </span><a href="#local-6989586621681307198"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-716"></a><span>                 </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307203"><a href="#local-6989586621681307203"><span class="hs-identifier">parent</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681307203"><span class="hs-identifier hs-var">parent</span></a><span>
</span><a name="line-717"></a><span>                 </span><span class="hs-identifier hs-var">Nothing</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-6989586621681307198"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-718"></a><span>
</span><a name="line-719"></a><span>        </span><span class="hs-comment">-- We want to insert the child `k` into a list of children but</span><span>
</span><a name="line-720"></a><span>        </span><span class="hs-comment">-- need to maintain the invariant that the parent is first.</span><span>
</span><a name="line-721"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-722"></a><span>        </span><span class="hs-comment">-- We also use the invariant that `k` is not already in `ns`.</span><span>
</span><a name="line-723"></a><span>        </span><span class="hs-identifier">insertChildIntoChildren</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-724"></a><span>        </span><a name="local-6989586621681307201"><a href="#local-6989586621681307201"><span class="hs-identifier">insertChildIntoChildren</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621681307204"><a href="#local-6989586621681307204"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307204"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">]</span><span>
</span><a name="line-725"></a><span>        </span><span class="hs-identifier">insertChildIntoChildren</span><span> </span><a name="local-6989586621681307205"><a href="#local-6989586621681307205"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681307206"><a href="#local-6989586621681307206"><span class="hs-identifier">n</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681307207"><a href="#local-6989586621681307207"><span class="hs-identifier">ns</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681307208"><a href="#local-6989586621681307208"><span class="hs-identifier">k</span></a></a><span>
</span><a name="line-726"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307205"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621681307208"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307208"><span class="hs-identifier hs-var">k</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681307206"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681307207"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-727"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307206"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681307208"><span class="hs-identifier hs-var">k</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681307207"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-728"></a><span>
</span><a name="line-729"></a><span>        </span><span class="hs-identifier">comb</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span>
</span><a name="line-730"></a><span>        </span><a name="local-6989586621681307202"><a href="#local-6989586621681307202"><span class="hs-identifier">comb</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a name="local-6989586621681307209"><a href="#local-6989586621681307209"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#Avail"><span class="hs-identifier hs-var">Avail</span></a><span> </span><a href="#local-6989586621681307209"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-comment">-- Duplicated name, should not happen</span><span>
</span><a name="line-731"></a><span>        </span><span class="hs-identifier">comb</span><span> </span><a name="local-6989586621681307210"><a href="#local-6989586621681307210"><span class="hs-identifier">gre</span></a></a><span> </span><span class="hs-special">(</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a name="local-6989586621681307211"><a href="#local-6989586621681307211"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621681307212"><a href="#local-6989586621681307212"><span class="hs-identifier">ns</span></a></a><span> </span><a name="local-6989586621681307213"><a href="#local-6989586621681307213"><span class="hs-identifier">fls</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-732"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">gre_par</span><span> </span><a href="#local-6989586621681307210"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-733"></a><span>              </span><a href="RdrName.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681307211"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307199"><span class="hs-identifier hs-var">name</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681307212"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307213"><span class="hs-identifier hs-var">fls</span></a><span> </span><span class="hs-comment">-- Not sure this ever happens</span><span>
</span><a name="line-734"></a><span>              </span><a href="RdrName.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681307211"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307201"><span class="hs-identifier hs-var">insertChildIntoChildren</span></a><span> </span><a href="#local-6989586621681307211"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621681307212"><span class="hs-identifier hs-var">ns</span></a><span> </span><a href="#local-6989586621681307199"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307213"><span class="hs-identifier hs-var">fls</span></a><span>
</span><a name="line-735"></a><span>              </span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681307214"><a href="#local-6989586621681307214"><span class="hs-identifier">mb_lbl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681307211"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621681307212"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#mkFieldLabel"><span class="hs-identifier hs-var">mkFieldLabel</span></a><span> </span><a href="#local-6989586621681307199"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681307214"><span class="hs-identifier hs-var">mb_lbl</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681307213"><span class="hs-identifier hs-var">fls</span></a><span class="hs-special">)</span><span>
</span><a name="line-736"></a><span>
</span><a name="line-737"></a><span class="hs-identifier">availFromGRE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span>
</span><a name="line-738"></a><a name="availFromGRE"><a href="RdrName.html#availFromGRE"><span class="hs-identifier">availFromGRE</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307215"><a href="#local-6989586621681307215"><span class="hs-identifier">me</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_par</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307216"><a href="#local-6989586621681307216"><span class="hs-identifier">parent</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-739"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681307216"><span class="hs-identifier hs-var">parent</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-740"></a><span>      </span><a href="RdrName.html#ParentIs"><span class="hs-identifier hs-var">ParentIs</span></a><span> </span><a name="local-6989586621681307217"><a href="#local-6989586621681307217"><span class="hs-identifier">p</span></a></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681307217"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307215"><span class="hs-identifier hs-var">me</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-741"></a><span>      </span><a href="RdrName.html#NoParent"><span class="hs-identifier hs-var">NoParent</span></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="Name.html#isTyConName"><span class="hs-identifier hs-var">isTyConName</span></a><span> </span><a href="#local-6989586621681307215"><span class="hs-identifier hs-var">me</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681307215"><span class="hs-identifier hs-var">me</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307215"><span class="hs-identifier hs-var">me</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-742"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#avail"><span class="hs-identifier hs-var">avail</span></a><span>   </span><a href="#local-6989586621681307215"><span class="hs-identifier hs-var">me</span></a><span>
</span><a name="line-743"></a><span>      </span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span> </span><a name="local-6989586621681307218"><a href="#local-6989586621681307218"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621681307219"><a href="#local-6989586621681307219"><span class="hs-identifier">mb_lbl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621681307218"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#mkFieldLabel"><span class="hs-identifier hs-var">mkFieldLabel</span></a><span> </span><a href="#local-6989586621681307215"><span class="hs-identifier hs-var">me</span></a><span> </span><a href="#local-6989586621681307219"><span class="hs-identifier hs-var">mb_lbl</span></a><span class="hs-special">]</span><span>
</span><a name="line-744"></a><span>
</span><a name="line-745"></a><span class="hs-identifier">mkFieldLabel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span>
</span><a name="line-746"></a><a name="mkFieldLabel"><a href="RdrName.html#mkFieldLabel"><span class="hs-identifier">mkFieldLabel</span></a></a><span> </span><a name="local-6989586621681307220"><a href="#local-6989586621681307220"><span class="hs-identifier">me</span></a></a><span> </span><a name="local-6989586621681307221"><a href="#local-6989586621681307221"><span class="hs-identifier">mb_lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-747"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681307221"><span class="hs-identifier hs-var">mb_lbl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-748"></a><span>                 </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-var">FieldLabel</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">flLabel</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">occNameFS</span><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681307220"><span class="hs-identifier hs-var">me</span></a><span class="hs-special">)</span><span>
</span><a name="line-749"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">flIsOverloaded</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-750"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">flSelector</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307220"><span class="hs-identifier hs-var">me</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-751"></a><span>                 </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307222"><a href="#local-6989586621681307222"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-var">FieldLabel</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">flLabel</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307222"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-752"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">flIsOverloaded</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-753"></a><span>                                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">flSelector</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307220"><span class="hs-identifier hs-var">me</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-754"></a><span>
</span><a name="line-755"></a><span class="hs-identifier">emptyGlobalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-756"></a><a name="emptyGlobalRdrEnv"><a href="RdrName.html#emptyGlobalRdrEnv"><span class="hs-identifier">emptyGlobalRdrEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#emptyOccEnv"><span class="hs-identifier hs-var">emptyOccEnv</span></a><span>
</span><a name="line-757"></a><span>
</span><a name="line-758"></a><span class="hs-identifier">globalRdrEnvElts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-759"></a><a name="globalRdrEnvElts"><a href="RdrName.html#globalRdrEnvElts"><span class="hs-identifier">globalRdrEnvElts</span></a></a><span> </span><a name="local-6989586621681307223"><a href="#local-6989586621681307223"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#foldOccEnv"><span class="hs-identifier hs-var">foldOccEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621681307223"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-760"></a><span>
</span><a name="line-761"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-762"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621681307035"><a href="#local-6989586621681307035"><span class="hs-identifier">gre</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-6989586621681307035"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gre_par</span><span> </span><a href="#local-6989586621681307035"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-763"></a><span>               </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#pprNameProvenance"><span class="hs-identifier hs-var">pprNameProvenance</span></a><span> </span><a href="#local-6989586621681307035"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span>
</span><a name="line-764"></a><span>
</span><a name="line-765"></a><span class="hs-identifier">pprGlobalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-766"></a><a name="pprGlobalRdrEnv"><a href="RdrName.html#pprGlobalRdrEnv"><span class="hs-identifier">pprGlobalRdrEnv</span></a></a><span> </span><a name="local-6989586621681307224"><a href="#local-6989586621681307224"><span class="hs-identifier">locals_only</span></a></a><span> </span><a name="local-6989586621681307225"><a href="#local-6989586621681307225"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-767"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;GlobalRdrEnv&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppWhen"><span class="hs-identifier hs-var">ppWhen</span></a><span> </span><a href="#local-6989586621681307224"><span class="hs-identifier hs-var">locals_only</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;(locals only)&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-768"></a><span>             </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#lbrace"><span class="hs-identifier hs-var">lbrace</span></a><span>
</span><a name="line-769"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621681307227"><span class="hs-identifier hs-var">pp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307226"><span class="hs-identifier hs-var">remove_locals</span></a><span> </span><a href="#local-6989586621681307231"><span class="hs-identifier hs-var">gre_list</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681307231"><a href="#local-6989586621681307231"><span class="hs-identifier">gre_list</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="OccName.html#occEnvElts"><span class="hs-identifier hs-var">occEnvElts</span></a><span> </span><a href="#local-6989586621681307225"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-770"></a><span>             </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#rbrace"><span class="hs-identifier hs-var">rbrace</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-771"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-772"></a><span>    </span><a name="local-6989586621681307226"><a href="#local-6989586621681307226"><span class="hs-identifier">remove_locals</span></a></a><span> </span><a name="local-6989586621681307228"><a href="#local-6989586621681307228"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307224"><span class="hs-identifier hs-var">locals_only</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="RdrName.html#isLocalGRE"><span class="hs-identifier hs-var">isLocalGRE</span></a><span> </span><a href="#local-6989586621681307228"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-773"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307228"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-774"></a><span>    </span><a name="local-6989586621681307227"><a href="#local-6989586621681307227"><span class="hs-identifier">pp</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-775"></a><span>    </span><span class="hs-identifier">pp</span><span> </span><a name="local-6989586621681307229"><a href="#local-6989586621681307229"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307230"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-776"></a><span>                     </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;unique&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a><span> </span><a href="#local-6989586621681307230"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>                     </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span class="hs-special">)</span><span>
</span><a name="line-778"></a><span>                 </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307229"><span class="hs-identifier hs-var">gres</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-780"></a><span>        </span><a name="local-6989586621681307230"><a href="#local-6989586621681307230"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621681307229"><span class="hs-identifier hs-var">gres</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-781"></a><span>
</span><a name="line-782"></a><span class="hs-identifier">lookupGlobalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-783"></a><a name="lookupGlobalRdrEnv"><a href="RdrName.html#lookupGlobalRdrEnv"><span class="hs-identifier">lookupGlobalRdrEnv</span></a></a><span> </span><a name="local-6989586621681307232"><a href="#local-6989586621681307232"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681307233"><a href="#local-6989586621681307233"><span class="hs-identifier">occ_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-6989586621681307232"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681307233"><span class="hs-identifier hs-var">occ_name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-784"></a><span>                                  </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-785"></a><span>                                  </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307234"><a href="#local-6989586621681307234"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681307234"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-786"></a><span>
</span><a name="line-787"></a><span class="hs-identifier">greOccName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-788"></a><a name="greOccName"><a href="RdrName.html#greOccName"><span class="hs-identifier">greOccName</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span class="hs-special">{</span><span class="hs-identifier">gre_par</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span class="hs-special">{</span><span class="hs-identifier">par_lbl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307235"><a href="#local-6989586621681307235"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a><span> </span><a href="#local-6989586621681307235"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-789"></a><span class="hs-identifier">greOccName</span><span> </span><a name="local-6989586621681307236"><a href="#local-6989586621681307236"><span class="hs-identifier">gre</span></a></a><span>                                            </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-6989586621681307236"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span>
</span><a name="line-790"></a><span>
</span><a name="line-791"></a><span class="hs-identifier">lookupGRE_RdrName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-792"></a><a name="lookupGRE_RdrName"><a href="RdrName.html#lookupGRE_RdrName"><span class="hs-identifier">lookupGRE_RdrName</span></a></a><span> </span><a name="local-6989586621681307237"><a href="#local-6989586621681307237"><span class="hs-identifier">rdr_name</span></a></a><span> </span><a name="local-6989586621681307238"><a href="#local-6989586621681307238"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-793"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-6989586621681307238"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a><span> </span><a href="#local-6989586621681307237"><span class="hs-identifier hs-var">rdr_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-794"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-795"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307239"><a href="#local-6989586621681307239"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#pickGREs"><span class="hs-identifier hs-var">pickGREs</span></a><span> </span><a href="#local-6989586621681307237"><span class="hs-identifier hs-var">rdr_name</span></a><span> </span><a href="#local-6989586621681307239"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-796"></a><span>
</span><a name="line-797"></a><span class="hs-identifier">lookupGRE_Name</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span>
</span><a name="line-798"></a><span class="hs-comment">-- ^ Look for precisely this 'Name' in the environment.  This tests</span><span>
</span><a name="line-799"></a><span class="hs-comment">-- whether it is in scope, ignoring anything else that might be in</span><span>
</span><a name="line-800"></a><span class="hs-comment">-- scope with the same 'OccName'.</span><span>
</span><a name="line-801"></a><a name="lookupGRE_Name"><a href="RdrName.html#lookupGRE_Name"><span class="hs-identifier">lookupGRE_Name</span></a></a><span> </span><a name="local-6989586621681307240"><a href="#local-6989586621681307240"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681307241"><a href="#local-6989586621681307241"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-802"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#lookupGRE_Name_OccName"><span class="hs-identifier hs-var">lookupGRE_Name_OccName</span></a><span> </span><a href="#local-6989586621681307240"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681307241"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681307241"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-803"></a><span>
</span><a name="line-804"></a><span class="hs-identifier">lookupGRE_FieldLabel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span>
</span><a name="line-805"></a><span class="hs-comment">-- ^ Look for a particular record field selector in the environment, where the</span><span>
</span><a name="line-806"></a><span class="hs-comment">-- selector name and field label may be different: the GlobalRdrEnv is keyed on</span><span>
</span><a name="line-807"></a><span class="hs-comment">-- the label.  See Note [Parents for record fields] for why this happens.</span><span>
</span><a name="line-808"></a><a name="lookupGRE_FieldLabel"><a href="RdrName.html#lookupGRE_FieldLabel"><span class="hs-identifier">lookupGRE_FieldLabel</span></a></a><span> </span><a name="local-6989586621681307242"><a href="#local-6989586621681307242"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681307243"><a href="#local-6989586621681307243"><span class="hs-identifier">fl</span></a></a><span>
</span><a name="line-809"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#lookupGRE_Name_OccName"><span class="hs-identifier hs-var">lookupGRE_Name_OccName</span></a><span> </span><a href="#local-6989586621681307242"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">flSelector</span><span> </span><a href="#local-6989586621681307243"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="OccName.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">flLabel</span><span> </span><a href="#local-6989586621681307243"><span class="hs-identifier hs-var">fl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-810"></a><span>
</span><a name="line-811"></a><span class="hs-identifier">lookupGRE_Name_OccName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span>
</span><a name="line-812"></a><span class="hs-comment">-- ^ Look for precisely this 'Name' in the environment, but with an 'OccName'</span><span>
</span><a name="line-813"></a><span class="hs-comment">-- that might differ from that of the 'Name'.  See 'lookupGRE_FieldLabel' and</span><span>
</span><a name="line-814"></a><span class="hs-comment">-- Note [Parents for record fields].</span><span>
</span><a name="line-815"></a><a name="lookupGRE_Name_OccName"><a href="RdrName.html#lookupGRE_Name_OccName"><span class="hs-identifier">lookupGRE_Name_OccName</span></a></a><span> </span><a name="local-6989586621681307244"><a href="#local-6989586621681307244"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681307245"><a href="#local-6989586621681307245"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621681307246"><a href="#local-6989586621681307246"><span class="hs-identifier">occ</span></a></a><span>
</span><a name="line-816"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621681307247"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681307247"><a href="#local-6989586621681307247"><span class="hs-identifier">gre</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RdrName.html#lookupGlobalRdrEnv"><span class="hs-identifier hs-var">lookupGlobalRdrEnv</span></a><span> </span><a href="#local-6989586621681307244"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681307246"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-817"></a><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-6989586621681307247"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621681307245"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-818"></a><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-819"></a><span>      </span><span class="hs-special">[</span><a name="local-6989586621681307248"><a href="#local-6989586621681307248"><span class="hs-identifier">gre</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681307248"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-820"></a><span>      </span><a name="local-6989586621681307249"><a href="#local-6989586621681307249"><span class="hs-identifier">gres</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;lookupGRE_Name_OccName&quot;</span><span>
</span><a name="line-821"></a><span>                        </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307245"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307246"><span class="hs-identifier hs-var">occ</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307249"><span class="hs-identifier hs-var">gres</span></a><span class="hs-special">)</span><span>
</span><a name="line-822"></a><span>               </span><span class="hs-comment">-- See INVARIANT 1 on GlobalRdrEnv</span><span>
</span><a name="line-823"></a><span>
</span><a name="line-824"></a><span>
</span><a name="line-825"></a><span class="hs-identifier">getGRE_NameQualifier_maybes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-826"></a><span class="hs-comment">-- Returns all the qualifiers by which 'x' is in scope</span><span>
</span><a name="line-827"></a><span class="hs-comment">-- Nothing means &quot;the unqualified version is in scope&quot;</span><span>
</span><a name="line-828"></a><span class="hs-comment">-- [] means the thing is not in scope at all</span><span>
</span><a name="line-829"></a><a name="getGRE_NameQualifier_maybes"><a href="RdrName.html#getGRE_NameQualifier_maybes"><span class="hs-identifier">getGRE_NameQualifier_maybes</span></a></a><span> </span><a name="local-6989586621681307250"><a href="#local-6989586621681307250"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681307251"><a href="#local-6989586621681307251"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-830"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="RdrName.html#lookupGRE_Name"><span class="hs-identifier hs-var">lookupGRE_Name</span></a><span> </span><a href="#local-6989586621681307250"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681307251"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-831"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307255"><a href="#local-6989586621681307255"><span class="hs-identifier">gre</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307252"><span class="hs-identifier hs-var">qualifier_maybe</span></a><span> </span><a href="#local-6989586621681307255"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">]</span><span>
</span><a name="line-832"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-833"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-834"></a><span>    </span><a name="local-6989586621681307252"><a href="#local-6989586621681307252"><span class="hs-identifier">qualifier_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307253"><a href="#local-6989586621681307253"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307254"><a href="#local-6989586621681307254"><span class="hs-identifier">iss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-835"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307253"><span class="hs-identifier hs-var">lcl</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-836"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_as</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">is_decl</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307254"><span class="hs-identifier hs-var">iss</span></a><span>
</span><a name="line-837"></a><span>
</span><a name="line-838"></a><span class="hs-identifier">isLocalGRE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-839"></a><a name="isLocalGRE"><a href="RdrName.html#isLocalGRE"><span class="hs-identifier">isLocalGRE</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307256"><a href="#local-6989586621681307256"><span class="hs-identifier">lcl</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307256"><span class="hs-identifier hs-var">lcl</span></a><span>
</span><a name="line-840"></a><span>
</span><a name="line-841"></a><span class="hs-identifier">isRecFldGRE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-842"></a><a name="isRecFldGRE"><a href="RdrName.html#isRecFldGRE"><span class="hs-identifier">isRecFldGRE</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">gre_par</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-843"></a><span class="hs-identifier">isRecFldGRE</span><span> </span><span class="hs-identifier">_</span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-844"></a><span>
</span><a name="line-845"></a><span class="hs-comment">-- Returns the field label of this GRE, if it has one</span><span>
</span><a name="line-846"></a><span class="hs-identifier">greLabel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a><span>
</span><a name="line-847"></a><a name="greLabel"><a href="RdrName.html#greLabel"><span class="hs-identifier">greLabel</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span class="hs-special">{</span><span class="hs-identifier">gre_par</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span class="hs-special">{</span><span class="hs-identifier">par_lbl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307257"><a href="#local-6989586621681307257"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681307257"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-848"></a><span class="hs-identifier">greLabel</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span class="hs-special">{</span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307258"><a href="#local-6989586621681307258"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_par</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#FldParent"><span class="hs-identifier hs-var">FldParent</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">occNameFS</span><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681307258"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-849"></a><span class="hs-identifier">greLabel</span><span> </span><span class="hs-identifier">_</span><span>                                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-850"></a><span>
</span><a name="line-851"></a><span class="hs-identifier">unQualOK</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-852"></a><span class="hs-comment">-- ^ Test if an unqualified version of this thing would be in scope</span><span>
</span><a name="line-853"></a><a name="unQualOK"><a href="RdrName.html#unQualOK"><span class="hs-identifier">unQualOK</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307259"><a href="#local-6989586621681307259"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307260"><a href="#local-6989586621681307260"><span class="hs-identifier">iss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-854"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307259"><span class="hs-identifier hs-var">lcl</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-855"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="RdrName.html#unQualSpecOK"><span class="hs-identifier hs-var">unQualSpecOK</span></a><span> </span><a href="#local-6989586621681307260"><span class="hs-identifier hs-var">iss</span></a><span>
</span><a name="line-856"></a><span>
</span><a name="line-857"></a><span class="hs-comment">{- Note [GRE filtering]
~~~~~~~~~~~~~~~~~~~~~~~
(pickGREs rdr gres) takes a list of GREs which have the same OccName
as 'rdr', say &quot;x&quot;.  It does two things:

(a) filters the GREs to a subset that are in scope
    * Qualified,   as 'M.x'  if want_qual    is Qual M _
    * Unqualified, as 'x'    if want_unqual  is Unqual _

(b) for that subset, filter the provenance field (gre_lcl and gre_imp)
    to ones that brought it into scope qualified or unqualified resp.

Example:
      module A ( f ) where
      import qualified Foo( f )
      import Baz( f )
      f = undefined

Let's suppose that Foo.f and Baz.f are the same entity really, but the local
'f' is different, so there will be two GREs matching &quot;f&quot;:
   gre1:  gre_lcl = True,  gre_imp = []
   gre2:  gre_lcl = False, gre_imp = [ imported from Foo, imported from Bar ]

The use of &quot;f&quot; in the export list is ambiguous because it's in scope
from the local def and the import Baz(f); but *not* the import qualified Foo.
pickGREs returns two GRE
   gre1:   gre_lcl = True,  gre_imp = []
   gre2:   gre_lcl = False, gre_imp = [ imported from Bar ]

Now the &quot;ambiguous occurrence&quot; message can correctly report how the
ambiguity arises.
-}</span><span>
</span><a name="line-889"></a><span>
</span><a name="line-890"></a><span class="hs-identifier">pickGREs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-891"></a><span class="hs-comment">-- ^ Takes a list of GREs which have the right OccName 'x'</span><span>
</span><a name="line-892"></a><span class="hs-comment">-- Pick those GREs that are in scope</span><span>
</span><a name="line-893"></a><span class="hs-comment">--    * Qualified,   as 'M.x'  if want_qual    is Qual M _</span><span>
</span><a name="line-894"></a><span class="hs-comment">--    * Unqualified, as 'x'    if want_unqual  is Unqual _</span><span>
</span><a name="line-895"></a><span class="hs-comment">--</span><span>
</span><a name="line-896"></a><span class="hs-comment">-- Return each such GRE, with its ImportSpecs filtered, to reflect</span><span>
</span><a name="line-897"></a><span class="hs-comment">-- how it is in scope qualified or unqualified respectively.</span><span>
</span><a name="line-898"></a><span class="hs-comment">-- See Note [GRE filtering]</span><span>
</span><a name="line-899"></a><a name="pickGREs"><a href="RdrName.html#pickGREs"><span class="hs-identifier">pickGREs</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><a name="local-6989586621681307261"><a href="#local-6989586621681307261"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><a href="RdrName.html#pickUnqualGRE"><span class="hs-identifier hs-var">pickUnqualGRE</span></a><span>     </span><a href="#local-6989586621681307261"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-900"></a><span class="hs-identifier">pickGREs</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#Qual"><span class="hs-identifier hs-var">Qual</span></a><span> </span><a name="local-6989586621681307262"><a href="#local-6989586621681307262"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681307263"><a href="#local-6989586621681307263"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#pickQualGRE"><span class="hs-identifier hs-var">pickQualGRE</span></a><span> </span><a href="#local-6989586621681307262"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307263"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-901"></a><span class="hs-identifier">pickGREs</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-identifier">_</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- I don't think this actually happens</span><span>
</span><a name="line-902"></a><span>
</span><a name="line-903"></a><span class="hs-identifier">pickUnqualGRE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span>
</span><a name="line-904"></a><a name="pickUnqualGRE"><a href="RdrName.html#pickUnqualGRE"><span class="hs-identifier">pickUnqualGRE</span></a></a><span> </span><a name="local-6989586621681307264"><a href="#local-6989586621681307264"><span class="hs-identifier">gre</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307265"><a href="#local-6989586621681307265"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307266"><a href="#local-6989586621681307266"><span class="hs-identifier">iss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-905"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621681307265"><span class="hs-identifier hs-var">lcl</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621681307267"><span class="hs-identifier hs-var">iss'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-906"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307264"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307267"><span class="hs-identifier hs-var">iss'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-907"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-908"></a><span>    </span><a name="local-6989586621681307267"><a href="#local-6989586621681307267"><span class="hs-identifier">iss'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="RdrName.html#unQualSpecOK"><span class="hs-identifier hs-var">unQualSpecOK</span></a><span> </span><a href="#local-6989586621681307266"><span class="hs-identifier hs-var">iss</span></a><span>
</span><a name="line-909"></a><span>
</span><a name="line-910"></a><span class="hs-identifier">pickQualGRE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span>
</span><a name="line-911"></a><a name="pickQualGRE"><a href="RdrName.html#pickQualGRE"><span class="hs-identifier">pickQualGRE</span></a></a><span> </span><a name="local-6989586621681307268"><a href="#local-6989586621681307268"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621681307269"><a href="#local-6989586621681307269"><span class="hs-identifier">gre</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307270"><a href="#local-6989586621681307270"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307271"><a href="#local-6989586621681307271"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307272"><a href="#local-6989586621681307272"><span class="hs-identifier">iss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-912"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621681307274"><span class="hs-identifier hs-var">lcl'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621681307273"><span class="hs-identifier hs-var">iss'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-913"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307269"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307274"><span class="hs-identifier hs-var">lcl'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307273"><span class="hs-identifier hs-var">iss'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-914"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-915"></a><span>    </span><a name="local-6989586621681307273"><a href="#local-6989586621681307273"><span class="hs-identifier">iss'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#qualSpecOK"><span class="hs-identifier hs-var">qualSpecOK</span></a><span> </span><a href="#local-6989586621681307268"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307272"><span class="hs-identifier hs-var">iss</span></a><span>
</span><a name="line-916"></a><span>    </span><a name="local-6989586621681307274"><a href="#local-6989586621681307274"><span class="hs-identifier">lcl'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307271"><span class="hs-identifier hs-var">lcl</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621681307275"><span class="hs-identifier hs-var">name_is_from</span></a><span> </span><a href="#local-6989586621681307268"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621681307270"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-917"></a><span>
</span><a name="line-918"></a><span>    </span><span class="hs-identifier">name_is_from</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-919"></a><span>    </span><a name="local-6989586621681307275"><a href="#local-6989586621681307275"><span class="hs-identifier">name_is_from</span></a></a><span> </span><a name="local-6989586621681307276"><a href="#local-6989586621681307276"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621681307277"><a href="#local-6989586621681307277"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-6989586621681307277"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-920"></a><span>                              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307278"><a href="#local-6989586621681307278"><span class="hs-identifier">n_mod</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621681307278"><span class="hs-identifier hs-var">n_mod</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621681307276"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-921"></a><span>                              </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-922"></a><span>
</span><a name="line-923"></a><span class="hs-identifier">pickGREsModExp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">,</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-924"></a><span class="hs-comment">-- ^ Pick GREs that are in scope *both* qualified *and* unqualified</span><span>
</span><a name="line-925"></a><span class="hs-comment">-- Return each GRE that is, as a pair</span><span>
</span><a name="line-926"></a><span class="hs-comment">--    (qual_gre, unqual_gre)</span><span>
</span><a name="line-927"></a><span class="hs-comment">-- These two GREs are the original GRE with imports filtered to express how</span><span>
</span><a name="line-928"></a><span class="hs-comment">-- it is in scope qualified an unqualified respectively</span><span>
</span><a name="line-929"></a><span class="hs-comment">--</span><span>
</span><a name="line-930"></a><span class="hs-comment">-- Used only for the 'module M' item in export list;</span><span>
</span><a name="line-931"></a><span class="hs-comment">--   see RnNames.exports_from_avail</span><span>
</span><a name="line-932"></a><a name="pickGREsModExp"><a href="RdrName.html#pickGREsModExp"><span class="hs-identifier">pickGREsModExp</span></a></a><span> </span><a name="local-6989586621681307279"><a href="#local-6989586621681307279"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621681307280"><a href="#local-6989586621681307280"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#pickBothGRE"><span class="hs-identifier hs-var">pickBothGRE</span></a><span> </span><a href="#local-6989586621681307279"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307280"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-933"></a><span>
</span><a name="line-934"></a><span class="hs-identifier">pickBothGRE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">)</span><span>
</span><a name="line-935"></a><a name="pickBothGRE"><a href="RdrName.html#pickBothGRE"><span class="hs-identifier">pickBothGRE</span></a></a><span> </span><a name="local-6989586621681307281"><a href="#local-6989586621681307281"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621681307282"><a href="#local-6989586621681307282"><span class="hs-identifier">gre</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307283"><a href="#local-6989586621681307283"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-936"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="Name.html#isBuiltInSyntax"><span class="hs-identifier hs-var">isBuiltInSyntax</span></a><span> </span><a href="#local-6989586621681307283"><span class="hs-identifier hs-var">n</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-937"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307284"><a href="#local-6989586621681307284"><span class="hs-identifier">gre1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RdrName.html#pickQualGRE"><span class="hs-identifier hs-var">pickQualGRE</span></a><span> </span><a href="#local-6989586621681307281"><span class="hs-identifier hs-var">mod</span></a><span> </span><a href="#local-6989586621681307282"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-938"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307285"><a href="#local-6989586621681307285"><span class="hs-identifier">gre2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RdrName.html#pickUnqualGRE"><span class="hs-identifier hs-var">pickUnqualGRE</span></a><span>   </span><a href="#local-6989586621681307282"><span class="hs-identifier hs-var">gre</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307284"><span class="hs-identifier hs-var">gre1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681307285"><span class="hs-identifier hs-var">gre2</span></a><span class="hs-special">)</span><span>
</span><a name="line-939"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-940"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-941"></a><span>        </span><span class="hs-comment">-- isBuiltInSyntax filter out names for built-in syntax They</span><span>
</span><a name="line-942"></a><span>        </span><span class="hs-comment">-- just clutter up the environment (esp tuples), and the</span><span>
</span><a name="line-943"></a><span>        </span><span class="hs-comment">-- parser will generate Exact RdrNames for them, so the</span><span>
</span><a name="line-944"></a><span>        </span><span class="hs-comment">-- cluttered envt is no use.  Really, it's only useful for</span><span>
</span><a name="line-945"></a><span>        </span><span class="hs-comment">-- GHC.Base and GHC.Tuple.</span><span>
</span><a name="line-946"></a><span>
</span><a name="line-947"></a><span class="hs-comment">-- Building GlobalRdrEnvs</span><span>
</span><a name="line-948"></a><span>
</span><a name="line-949"></a><span class="hs-identifier">plusGlobalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-950"></a><a name="plusGlobalRdrEnv"><a href="RdrName.html#plusGlobalRdrEnv"><span class="hs-identifier">plusGlobalRdrEnv</span></a></a><span> </span><a name="local-6989586621681307286"><a href="#local-6989586621681307286"><span class="hs-identifier">env1</span></a></a><span> </span><a name="local-6989586621681307287"><a href="#local-6989586621681307287"><span class="hs-identifier">env2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#plusOccEnv_C"><span class="hs-identifier hs-var">plusOccEnv_C</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="RdrName.html#insertGRE"><span class="hs-identifier hs-var">insertGRE</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307286"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681307287"><span class="hs-identifier hs-var">env2</span></a><span>
</span><a name="line-951"></a><span>
</span><a name="line-952"></a><span class="hs-identifier">mkGlobalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-953"></a><a name="mkGlobalRdrEnv"><a href="RdrName.html#mkGlobalRdrEnv"><span class="hs-identifier">mkGlobalRdrEnv</span></a></a><span> </span><a name="local-6989586621681307288"><a href="#local-6989586621681307288"><span class="hs-identifier">gres</span></a></a><span>
</span><a name="line-954"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621681307289"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="RdrName.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a><span> </span><a href="#local-6989586621681307288"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-955"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-956"></a><span>    </span><a name="local-6989586621681307289"><a href="#local-6989586621681307289"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621681307290"><a href="#local-6989586621681307290"><span class="hs-identifier">gre</span></a></a><span> </span><a name="local-6989586621681307291"><a href="#local-6989586621681307291"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#extendOccEnv_Acc"><span class="hs-identifier hs-var">extendOccEnv_Acc</span></a><span> </span><a href="RdrName.html#insertGRE"><span class="hs-identifier hs-var">insertGRE</span></a><span> </span><a href="Util.html#singleton"><span class="hs-identifier hs-var">singleton</span></a><span> </span><a href="#local-6989586621681307291"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-957"></a><span>                                   </span><span class="hs-special">(</span><a href="RdrName.html#greOccName"><span class="hs-identifier hs-var">greOccName</span></a><span> </span><a href="#local-6989586621681307290"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span>
</span><a name="line-958"></a><span>                                   </span><a href="#local-6989586621681307290"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-959"></a><span>
</span><a name="line-960"></a><span class="hs-identifier">insertGRE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-961"></a><a name="insertGRE"><a href="RdrName.html#insertGRE"><span class="hs-identifier">insertGRE</span></a></a><span> </span><a name="local-6989586621681307292"><a href="#local-6989586621681307292"><span class="hs-identifier">new_g</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307292"><span class="hs-identifier hs-var">new_g</span></a><span class="hs-special">]</span><span>
</span><a name="line-962"></a><span class="hs-identifier">insertGRE</span><span> </span><a name="local-6989586621681307293"><a href="#local-6989586621681307293"><span class="hs-identifier">new_g</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681307294"><a href="#local-6989586621681307294"><span class="hs-identifier">old_g</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621681307295"><a href="#local-6989586621681307295"><span class="hs-identifier">old_gs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-963"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-6989586621681307293"><span class="hs-identifier hs-var">new_g</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-6989586621681307294"><span class="hs-identifier hs-var">old_g</span></a><span>
</span><a name="line-964"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307293"><span class="hs-identifier hs-var">new_g</span></a><span> </span><span class="hs-special">`</span><a href="RdrName.html#plusGRE"><span class="hs-identifier hs-var">plusGRE</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307294"><span class="hs-identifier hs-var">old_g</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681307295"><span class="hs-identifier hs-var">old_gs</span></a><span>
</span><a name="line-965"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-966"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307294"><span class="hs-identifier hs-var">old_g</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="RdrName.html#insertGRE"><span class="hs-identifier hs-var">insertGRE</span></a><span> </span><a href="#local-6989586621681307293"><span class="hs-identifier hs-var">new_g</span></a><span> </span><a href="#local-6989586621681307295"><span class="hs-identifier hs-var">old_gs</span></a><span>
</span><a name="line-967"></a><span>
</span><a name="line-968"></a><span class="hs-identifier">plusGRE</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span>
</span><a name="line-969"></a><span class="hs-comment">-- Used when the gre_name fields match</span><span>
</span><a name="line-970"></a><a name="plusGRE"><a href="RdrName.html#plusGRE"><span class="hs-identifier">plusGRE</span></a></a><span> </span><a name="local-6989586621681307296"><a href="#local-6989586621681307296"><span class="hs-identifier">g1</span></a></a><span> </span><a name="local-6989586621681307297"><a href="#local-6989586621681307297"><span class="hs-identifier">g2</span></a></a><span>
</span><a name="line-971"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-6989586621681307296"><span class="hs-identifier hs-var">g1</span></a><span>
</span><a name="line-972"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_lcl</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><a href="#local-6989586621681307296"><span class="hs-identifier hs-var">g1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><a href="#local-6989586621681307297"><span class="hs-identifier hs-var">g2</span></a><span>
</span><a name="line-973"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><a href="#local-6989586621681307296"><span class="hs-identifier hs-var">g1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><a href="#local-6989586621681307297"><span class="hs-identifier hs-var">g2</span></a><span>
</span><a name="line-974"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_par</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">gre_par</span><span>  </span><a href="#local-6989586621681307296"><span class="hs-identifier hs-var">g1</span></a><span> </span><span class="hs-special">`</span><a href="RdrName.html#plusParent"><span class="hs-identifier hs-var">plusParent</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">gre_par</span><span>  </span><a href="#local-6989586621681307297"><span class="hs-identifier hs-var">g2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-975"></a><span>
</span><a name="line-976"></a><span class="hs-identifier">transformGREs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">]</span><span>
</span><a name="line-978"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-979"></a><span class="hs-comment">-- ^ Apply a transformation function to the GREs for these OccNames</span><span>
</span><a name="line-980"></a><a name="transformGREs"><a href="RdrName.html#transformGREs"><span class="hs-identifier">transformGREs</span></a></a><span> </span><a name="local-6989586621681307298"><a href="#local-6989586621681307298"><span class="hs-identifier">trans_gre</span></a></a><span> </span><a name="local-6989586621681307299"><a href="#local-6989586621681307299"><span class="hs-identifier">occs</span></a></a><span> </span><a name="local-6989586621681307300"><a href="#local-6989586621681307300"><span class="hs-identifier">rdr_env</span></a></a><span>
</span><a name="line-981"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621681307301"><span class="hs-identifier hs-var">trans</span></a><span> </span><a href="#local-6989586621681307300"><span class="hs-identifier hs-var">rdr_env</span></a><span> </span><a href="#local-6989586621681307299"><span class="hs-identifier hs-var">occs</span></a><span>
</span><a name="line-982"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-983"></a><span>    </span><a name="local-6989586621681307301"><a href="#local-6989586621681307301"><span class="hs-identifier">trans</span></a></a><span> </span><a name="local-6989586621681307302"><a href="#local-6989586621681307302"><span class="hs-identifier">occ</span></a></a><span> </span><a name="local-6989586621681307303"><a href="#local-6989586621681307303"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-984"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-6989586621681307303"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681307302"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-985"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307304"><a href="#local-6989586621681307304"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#extendOccEnv"><span class="hs-identifier hs-var">extendOccEnv</span></a><span> </span><a href="#local-6989586621681307303"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681307302"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621681307298"><span class="hs-identifier hs-var">trans_gre</span></a><span> </span><a href="#local-6989586621681307304"><span class="hs-identifier hs-var">gres</span></a><span class="hs-special">)</span><span>
</span><a name="line-986"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681307303"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-987"></a><span>
</span><a name="line-988"></a><span class="hs-identifier">extendGlobalRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-989"></a><a name="extendGlobalRdrEnv"><a href="RdrName.html#extendGlobalRdrEnv"><span class="hs-identifier">extendGlobalRdrEnv</span></a></a><span> </span><a name="local-6989586621681307305"><a href="#local-6989586621681307305"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681307306"><a href="#local-6989586621681307306"><span class="hs-identifier">gre</span></a></a><span>
</span><a name="line-990"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#extendOccEnv_Acc"><span class="hs-identifier hs-var">extendOccEnv_Acc</span></a><span> </span><a href="RdrName.html#insertGRE"><span class="hs-identifier hs-var">insertGRE</span></a><span> </span><a href="Util.html#singleton"><span class="hs-identifier hs-var">singleton</span></a><span> </span><a href="#local-6989586621681307305"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-991"></a><span>                     </span><span class="hs-special">(</span><a href="RdrName.html#greOccName"><span class="hs-identifier hs-var">greOccName</span></a><span> </span><a href="#local-6989586621681307306"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307306"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-992"></a><span>
</span><a name="line-993"></a><span class="hs-identifier">shadowNames</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-994"></a><a name="shadowNames"><a href="RdrName.html#shadowNames"><span class="hs-identifier">shadowNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="RdrName.html#shadowName"><span class="hs-identifier hs-var">shadowName</span></a><span>
</span><a name="line-995"></a><span>
</span><a name="line-996"></a><span class="hs-comment">{- Note [GlobalRdrEnv shadowing]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Before adding new names to the GlobalRdrEnv we nuke some existing entries;
this is &quot;shadowing&quot;.  The actual work is done by RdrEnv.shadowName.
Suppose
   env' = shadowName env M.f

Then:
   * Looking up (Unqual f) in env' should succeed, returning M.f,
     even if env contains existing unqualified bindings for f.
     They are shadowed

   * Looking up (Qual M.f) in env' should succeed, returning M.f

   * Looking up (Qual X.f) in env', where X /= M, should be the same as
     looking up (Qual X.f) in env.
     That is, shadowName does /not/ delete earlier qualified bindings

There are two reasons for shadowing:

* The GHCi REPL

  - Ids bought into scope on the command line (eg let x = True) have
    External Names, like Ghci4.x.  We want a new binding for 'x' (say)
    to override the existing binding for 'x'.  Example:

           ghci&gt; :load M    -- Brings `x` and `M.x` into scope
           ghci&gt; x
           ghci&gt; &quot;Hello&quot;
           ghci&gt; M.x
           ghci&gt; &quot;hello&quot;
           ghci&gt; let x = True  -- Shadows `x`
           ghci&gt; x             -- The locally bound `x`
                               -- NOT an ambiguous reference
           ghci&gt; True
           ghci&gt; M.x           -- M.x is still in scope!
           ghci&gt; &quot;Hello&quot;
    So when we add `x = True` we must not delete the `M.x` from the
    `GlobalRdrEnv`; rather we just want to make it &quot;qualified only&quot;;
    hence the `mk_fake-imp_spec` in `shadowName`.  See also Note
    [Interactively-bound Ids in GHCi] in HscTypes

  - Data types also have External Names, like Ghci4.T; but we still want
    'T' to mean the newly-declared 'T', not an old one.

* Nested Template Haskell declaration brackets
  See Note [Top-level Names in Template Haskell decl quotes] in RnNames

  Consider a TH decl quote:
      module M where
        f x = h [d| f = ...f...M.f... |]
  We must shadow the outer unqualified binding of 'f', else we'll get
  a complaint when extending the GlobalRdrEnv, saying that there are
  two bindings for 'f'.  There are several tricky points:

    - This shadowing applies even if the binding for 'f' is in a
      where-clause, and hence is in the *local* RdrEnv not the *global*
      RdrEnv.  This is done in lcl_env_TH in extendGlobalRdrEnvRn.

    - The External Name M.f from the enclosing module must certainly
      still be available.  So we don't nuke it entirely; we just make
      it seem like qualified import.

    - We only shadow *External* names (which come from the main module),
      or from earlier GHCi commands. Do not shadow *Internal* names
      because in the bracket
          [d| class C a where f :: a
              f = 4 |]
      rnSrcDecls will first call extendGlobalRdrEnvRn with C[f] from the
      class decl, and *separately* extend the envt with the value binding.
      At that stage, the class op 'f' will have an Internal name.
-}</span><span>
</span><a name="line-1068"></a><span>
</span><a name="line-1069"></a><span class="hs-identifier">shadowName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-1070"></a><span class="hs-comment">-- Remove certain old GREs that share the same OccName as this new Name.</span><span>
</span><a name="line-1071"></a><span class="hs-comment">-- See Note [GlobalRdrEnv shadowing] for details</span><span>
</span><a name="line-1072"></a><a name="shadowName"><a href="RdrName.html#shadowName"><span class="hs-identifier">shadowName</span></a></a><span> </span><a name="local-6989586621681307307"><a href="#local-6989586621681307307"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681307308"><a href="#local-6989586621681307308"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1073"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#alterOccEnv"><span class="hs-identifier hs-var">alterOccEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621681307309"><span class="hs-identifier hs-var">alter_fn</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307307"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621681307308"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1074"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1075"></a><span>    </span><span class="hs-identifier">alter_fn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span>
</span><a name="line-1076"></a><span>    </span><a name="local-6989586621681307309"><a href="#local-6989586621681307309"><span class="hs-identifier">alter_fn</span></a></a><span> </span><a name="local-6989586621681307313"><a href="#local-6989586621681307313"><span class="hs-identifier">gres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307310"><span class="hs-identifier hs-var">shadow_with</span></a><span> </span><a href="#local-6989586621681307308"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307313"><span class="hs-identifier hs-var">gres</span></a><span>
</span><a name="line-1077"></a><span>
</span><a name="line-1078"></a><span>    </span><span class="hs-identifier">shadow_with</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span>
</span><a name="line-1079"></a><span>    </span><a name="local-6989586621681307310"><a href="#local-6989586621681307310"><span class="hs-identifier">shadow_with</span></a></a><span> </span><a name="local-6989586621681307314"><a href="#local-6989586621681307314"><span class="hs-identifier">new_name</span></a></a><span>
</span><a name="line-1080"></a><span>       </span><a name="local-6989586621681307315"><a href="#local-6989586621681307315"><span class="hs-identifier">old_gre</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307316"><a href="#local-6989586621681307316"><span class="hs-identifier">old_name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307317"><a href="#local-6989586621681307317"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307318"><a href="#local-6989586621681307318"><span class="hs-identifier">iss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1081"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-6989586621681307316"><span class="hs-identifier hs-var">old_name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1082"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681307315"><span class="hs-identifier hs-var">old_gre</span></a><span>   </span><span class="hs-comment">-- Old name is Internal; do not shadow</span><span>
</span><a name="line-1083"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307319"><a href="#local-6989586621681307319"><span class="hs-identifier">old_mod</span></a></a><span>
</span><a name="line-1084"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307322"><a href="#local-6989586621681307322"><span class="hs-identifier">new_mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-6989586621681307314"><span class="hs-identifier hs-var">new_name</span></a><span>
</span><a name="line-1085"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681307322"><span class="hs-identifier hs-var">new_mod</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621681307319"><span class="hs-identifier hs-var">old_mod</span></a><span>   </span><span class="hs-comment">-- Old name same as new name; shadow completely</span><span>
</span><a name="line-1086"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1087"></a><span>
</span><a name="line-1088"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621681307320"><span class="hs-identifier hs-var">iss'</span></a><span>            </span><span class="hs-comment">-- Nothing remains</span><span>
</span><a name="line-1089"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1090"></a><span>
</span><a name="line-1091"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1092"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307315"><span class="hs-identifier hs-var">old_gre</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307320"><span class="hs-identifier hs-var">iss'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1093"></a><span>
</span><a name="line-1094"></a><span>              </span><span class="hs-keyword">where</span><span>
</span><a name="line-1095"></a><span>                </span><a name="local-6989586621681307320"><a href="#local-6989586621681307320"><span class="hs-identifier">iss'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307321"><span class="hs-identifier hs-var">lcl_imp</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307312"><span class="hs-identifier hs-var">shadow_is</span></a><span> </span><a href="#local-6989586621681307314"><span class="hs-identifier hs-var">new_name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681307318"><span class="hs-identifier hs-var">iss</span></a><span>
</span><a name="line-1096"></a><span>                </span><a name="local-6989586621681307321"><a href="#local-6989586621681307321"><span class="hs-identifier">lcl_imp</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307317"><span class="hs-identifier hs-var">lcl</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681307311"><span class="hs-identifier hs-var">mk_fake_imp_spec</span></a><span> </span><a href="#local-6989586621681307316"><span class="hs-identifier hs-var">old_name</span></a><span> </span><a href="#local-6989586621681307319"><span class="hs-identifier hs-var">old_mod</span></a><span class="hs-special">]</span><span>
</span><a name="line-1097"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1098"></a><span>
</span><a name="line-1099"></a><span>    </span><a name="local-6989586621681307311"><a href="#local-6989586621681307311"><span class="hs-identifier">mk_fake_imp_spec</span></a></a><span> </span><a name="local-6989586621681307323"><a href="#local-6989586621681307323"><span class="hs-identifier">old_name</span></a></a><span> </span><a name="local-6989586621681307324"><a href="#local-6989586621681307324"><span class="hs-identifier">old_mod</span></a></a><span>    </span><span class="hs-comment">-- Urgh!</span><span>
</span><a name="line-1100"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#ImpSpec"><span class="hs-identifier hs-var">ImpSpec</span></a><span> </span><a href="#local-6989586621681307326"><span class="hs-identifier hs-var">id_spec</span></a><span> </span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span>
</span><a name="line-1101"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1102"></a><span>        </span><a name="local-6989586621681307325"><a href="#local-6989586621681307325"><span class="hs-identifier">old_mod_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621681307324"><span class="hs-identifier hs-var">old_mod</span></a><span>
</span><a name="line-1103"></a><span>        </span><a name="local-6989586621681307326"><a href="#local-6989586621681307326"><span class="hs-identifier">id_spec</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#ImpDeclSpec"><span class="hs-identifier hs-var">ImpDeclSpec</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_mod</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307325"><span class="hs-identifier hs-var">old_mod_name</span></a><span>
</span><a name="line-1104"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_as</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307325"><span class="hs-identifier hs-var">old_mod_name</span></a><span>
</span><a name="line-1105"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_qual</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1106"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_dloc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span> </span><a href="#local-6989586621681307323"><span class="hs-identifier hs-var">old_name</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1107"></a><span>
</span><a name="line-1108"></a><span>    </span><span class="hs-identifier">shadow_is</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span>
</span><a name="line-1109"></a><span>    </span><a name="local-6989586621681307312"><a href="#local-6989586621681307312"><span class="hs-identifier">shadow_is</span></a></a><span> </span><a name="local-6989586621681307327"><a href="#local-6989586621681307327"><span class="hs-identifier">new_name</span></a></a><span> </span><a name="local-6989586621681307328"><a href="#local-6989586621681307328"><span class="hs-identifier">is</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="RdrName.html#ImpSpec"><span class="hs-identifier hs-var">ImpSpec</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_decl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307329"><a href="#local-6989586621681307329"><span class="hs-identifier">id_spec</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1110"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681307330"><a href="#local-6989586621681307330"><span class="hs-identifier">new_mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><a href="#local-6989586621681307327"><span class="hs-identifier hs-var">new_name</span></a><span>
</span><a name="line-1111"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_as</span><span> </span><a href="#local-6989586621681307329"><span class="hs-identifier hs-var">id_spec</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621681307330"><span class="hs-identifier hs-var">new_mod</span></a><span>
</span><a name="line-1112"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>   </span><span class="hs-comment">-- Shadow both qualified and unqualified</span><span>
</span><a name="line-1113"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-comment">-- Shadow unqualified only</span><span>
</span><a name="line-1114"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307328"><span class="hs-identifier hs-var">is</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_decl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307329"><span class="hs-identifier hs-var">id_spec</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_qual</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1115"></a><span>
</span><a name="line-1116"></a><span>
</span><a name="line-1117"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        ImportSpec
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1124"></a><span>
</span><a name="line-1125"></a><span class="hs-comment">-- | Import Specification</span><span>
</span><a name="line-1126"></a><span class="hs-comment">--</span><span>
</span><a name="line-1127"></a><span class="hs-comment">-- The 'ImportSpec' of something says how it came to be imported</span><span>
</span><a name="line-1128"></a><span class="hs-comment">-- It's quite elaborate so that we can give accurate unused-name warnings.</span><span>
</span><a name="line-1129"></a><span class="hs-keyword">data</span><span> </span><a name="ImportSpec"><a href="RdrName.html#ImportSpec"><span class="hs-identifier">ImportSpec</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ImpSpec"><a href="RdrName.html#ImpSpec"><span class="hs-identifier">ImpSpec</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="is_decl"><a href="RdrName.html#is_decl"><span class="hs-identifier">is_decl</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a><span class="hs-special">,</span><span>
</span><a name="line-1130"></a><span>                            </span><a name="is_item"><a href="RdrName.html#is_item"><span class="hs-identifier">is_item</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#ImpItemSpec"><span class="hs-identifier hs-type">ImpItemSpec</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1131"></a><span>                </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Data</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1132"></a><span>
</span><a name="line-1133"></a><span class="hs-comment">-- | Import Declaration Specification</span><span>
</span><a name="line-1134"></a><span class="hs-comment">--</span><span>
</span><a name="line-1135"></a><span class="hs-comment">-- Describes a particular import declaration and is</span><span>
</span><a name="line-1136"></a><span class="hs-comment">-- shared among all the 'Provenance's for that decl</span><span>
</span><a name="line-1137"></a><span class="hs-keyword">data</span><span> </span><a name="ImpDeclSpec"><a href="RdrName.html#ImpDeclSpec"><span class="hs-identifier">ImpDeclSpec</span></a></a><span>
</span><a name="line-1138"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ImpDeclSpec"><a href="RdrName.html#ImpDeclSpec"><span class="hs-identifier">ImpDeclSpec</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1139"></a><span>        </span><a name="is_mod"><a href="RdrName.html#is_mod"><span class="hs-identifier">is_mod</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Module imported, e.g. @import Muggle@</span><span>
</span><a name="line-1140"></a><span>                                   </span><span class="hs-comment">-- Note the @Muggle@ may well not be</span><span>
</span><a name="line-1141"></a><span>                                   </span><span class="hs-comment">-- the defining module for this thing!</span><span>
</span><a name="line-1142"></a><span>
</span><a name="line-1143"></a><span>                                   </span><span class="hs-comment">-- TODO: either should be Module, or there</span><span>
</span><a name="line-1144"></a><span>                                   </span><span class="hs-comment">-- should be a Maybe UnitId here too.</span><span>
</span><a name="line-1145"></a><span>        </span><a name="is_as"><a href="RdrName.html#is_as"><span class="hs-identifier">is_as</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Import alias, e.g. from @as M@ (or @Muggle@ if there is no @as@ clause)</span><span>
</span><a name="line-1146"></a><span>        </span><a name="is_qual"><a href="RdrName.html#is_qual"><span class="hs-identifier">is_qual</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ Was this import qualified?</span><span>
</span><a name="line-1147"></a><span>        </span><a name="is_dloc"><a href="RdrName.html#is_dloc"><span class="hs-identifier">is_dloc</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>     </span><span class="hs-comment">-- ^ The location of the entire import declaration</span><span>
</span><a name="line-1148"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Data</span><span>
</span><a name="line-1149"></a><span>
</span><a name="line-1150"></a><span class="hs-comment">-- | Import Item Specification</span><span>
</span><a name="line-1151"></a><span class="hs-comment">--</span><span>
</span><a name="line-1152"></a><span class="hs-comment">-- Describes import info a particular Name</span><span>
</span><a name="line-1153"></a><span class="hs-keyword">data</span><span> </span><a name="ImpItemSpec"><a href="RdrName.html#ImpItemSpec"><span class="hs-identifier">ImpItemSpec</span></a></a><span>
</span><a name="line-1154"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ImpAll"><a href="RdrName.html#ImpAll"><span class="hs-identifier">ImpAll</span></a></a><span>              </span><span class="hs-comment">-- ^ The import had no import list,</span><span>
</span><a name="line-1155"></a><span>                        </span><span class="hs-comment">-- or had a hiding list</span><span>
</span><a name="line-1156"></a><span>
</span><a name="line-1157"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImpSome"><a href="RdrName.html#ImpSome"><span class="hs-identifier">ImpSome</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1158"></a><span>        </span><a name="is_explicit"><a href="RdrName.html#is_explicit"><span class="hs-identifier">is_explicit</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>
</span><a name="line-1159"></a><span>        </span><a name="is_iloc"><a href="RdrName.html#is_iloc"><span class="hs-identifier">is_iloc</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>  </span><span class="hs-comment">-- Location of the import item</span><span>
</span><a name="line-1160"></a><span>    </span><span class="hs-special">}</span><span>   </span><span class="hs-comment">-- ^ The import had an import list.</span><span>
</span><a name="line-1161"></a><span>        </span><span class="hs-comment">-- The 'is_explicit' field is @True@ iff the thing was named</span><span>
</span><a name="line-1162"></a><span>        </span><span class="hs-comment">-- /explicitly/ in the import specs rather</span><span>
</span><a name="line-1163"></a><span>        </span><span class="hs-comment">-- than being imported as part of a &quot;...&quot; group. Consider:</span><span>
</span><a name="line-1164"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-1165"></a><span>        </span><span class="hs-comment">-- &gt; import C( T(..) )</span><span>
</span><a name="line-1166"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-1167"></a><span>        </span><span class="hs-comment">-- Here the constructors of @T@ are not named explicitly;</span><span>
</span><a name="line-1168"></a><span>        </span><span class="hs-comment">-- only @T@ is named explicitly.</span><span>
</span><a name="line-1169"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Data</span><span>
</span><a name="line-1170"></a><span>
</span><a name="line-1171"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="RdrName.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1172"></a><span>  </span><a name="local-6989586621681307033"><a href="#local-6989586621681307033"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a name="local-6989586621681307034"><a href="#local-6989586621681307034"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681307033"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307034"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1173"></a><span>
</span><a name="line-1174"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="RdrName.html#ImpDeclSpec"><span class="hs-identifier hs-type">ImpDeclSpec</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1175"></a><span>   </span><a name="local-8214565720323790496"><span class="hs-identifier">compare</span></a><span> </span><a name="local-6989586621681307031"><a href="#local-6989586621681307031"><span class="hs-identifier">is1</span></a></a><span> </span><a name="local-6989586621681307032"><a href="#local-6989586621681307032"><span class="hs-identifier">is2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_mod</span><span> </span><a href="#local-6989586621681307031"><span class="hs-identifier hs-var">is1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is_mod</span><span> </span><a href="#local-6989586621681307032"><span class="hs-identifier hs-var">is2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span>
</span><a name="line-1176"></a><span>                     </span><span class="hs-special">(</span><span class="hs-identifier">is_dloc</span><span> </span><a href="#local-6989586621681307031"><span class="hs-identifier hs-var">is1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is_dloc</span><span> </span><a href="#local-6989586621681307032"><span class="hs-identifier hs-var">is2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1177"></a><span>
</span><a name="line-1178"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="RdrName.html#ImpItemSpec"><span class="hs-identifier hs-type">ImpItemSpec</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1179"></a><span>  </span><a name="local-6989586621681307029"><a href="#local-6989586621681307029"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-3458764513820541095"><span class="hs-operator">==</span></a><span> </span><a name="local-6989586621681307030"><a href="#local-6989586621681307030"><span class="hs-identifier">p2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681307029"><span class="hs-identifier hs-var">p1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307030"><span class="hs-identifier hs-var">p2</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier hs-var">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1180"></a><span>
</span><a name="line-1181"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="RdrName.html#ImpItemSpec"><span class="hs-identifier hs-type">ImpItemSpec</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1182"></a><span>   </span><a name="local-8214565720323790496"><span class="hs-identifier">compare</span></a><span> </span><a name="local-6989586621681307025"><a href="#local-6989586621681307025"><span class="hs-identifier">is1</span></a></a><span> </span><a name="local-6989586621681307026"><a href="#local-6989586621681307026"><span class="hs-identifier">is2</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1183"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681307025"><span class="hs-identifier hs-var">is1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681307026"><span class="hs-identifier hs-var">is2</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1184"></a><span>      </span><span class="hs-special">(</span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-1185"></a><span>      </span><span class="hs-special">(</span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-1186"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-1187"></a><span>      </span><span class="hs-special">(</span><a href="RdrName.html#ImpSome"><span class="hs-identifier hs-var">ImpSome</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681307027"><a href="#local-6989586621681307027"><span class="hs-identifier">l1</span></a></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#ImpSome"><span class="hs-identifier hs-var">ImpSome</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681307028"><a href="#local-6989586621681307028"><span class="hs-identifier">l2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681307027"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307028"><span class="hs-identifier hs-var">l2</span></a><span>
</span><a name="line-1188"></a><span>
</span><a name="line-1189"></a><span>
</span><a name="line-1190"></a><span class="hs-identifier">bestImport</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span>
</span><a name="line-1191"></a><span class="hs-comment">-- See Note [Choosing the best import declaration]</span><span>
</span><a name="line-1192"></a><a name="bestImport"><a href="RdrName.html#bestImport"><span class="hs-identifier">bestImport</span></a></a><span> </span><a name="local-6989586621681307331"><a href="#local-6989586621681307331"><span class="hs-identifier">iss</span></a></a><span>
</span><a name="line-1193"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><a href="#local-6989586621681307332"><span class="hs-identifier hs-var">best</span></a><span> </span><a href="#local-6989586621681307331"><span class="hs-identifier hs-var">iss</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1194"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621681307340"><a href="#local-6989586621681307340"><span class="hs-identifier">is</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681307340"><span class="hs-identifier hs-var">is</span></a><span>
</span><a name="line-1195"></a><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;bestImport&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307331"><span class="hs-identifier hs-var">iss</span></a><span class="hs-special">)</span><span>
</span><a name="line-1196"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1197"></a><span>    </span><span class="hs-identifier">best</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-1198"></a><span>    </span><span class="hs-comment">-- Less means better</span><span>
</span><a name="line-1199"></a><span>    </span><span class="hs-comment">-- Unqualified always wins over qualified; then</span><span>
</span><a name="line-1200"></a><span>    </span><span class="hs-comment">-- import-all wins over import-some; then</span><span>
</span><a name="line-1201"></a><span>    </span><span class="hs-comment">-- earlier declaration wins over later</span><span>
</span><a name="line-1202"></a><span>    </span><a name="local-6989586621681307332"><a href="#local-6989586621681307332"><span class="hs-identifier">best</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#ImpSpec"><span class="hs-identifier hs-var">ImpSpec</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_item</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307334"><a href="#local-6989586621681307334"><span class="hs-identifier">item1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_decl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307335"><a href="#local-6989586621681307335"><span class="hs-identifier">d1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1203"></a><span>         </span><span class="hs-special">(</span><a href="RdrName.html#ImpSpec"><span class="hs-identifier hs-var">ImpSpec</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_item</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307336"><a href="#local-6989586621681307336"><span class="hs-identifier">item2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">is_decl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307337"><a href="#local-6989586621681307337"><span class="hs-identifier">d2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1204"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_qual</span><span> </span><a href="#local-6989586621681307335"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is_qual</span><span> </span><a href="#local-6989586621681307337"><span class="hs-identifier hs-var">d2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span>
</span><a name="line-1205"></a><span>        </span><span class="hs-special">(</span><a href="#local-6989586621681307333"><span class="hs-identifier hs-var">best_item</span></a><span> </span><a href="#local-6989586621681307334"><span class="hs-identifier hs-var">item1</span></a><span> </span><a href="#local-6989586621681307336"><span class="hs-identifier hs-var">item2</span></a><span class="hs-special">)</span><span>           </span><span class="hs-special">`</span><a href="Util.html#thenCmp"><span class="hs-identifier hs-var">thenCmp</span></a><span class="hs-special">`</span><span>
</span><a name="line-1206"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">is_dloc</span><span> </span><a href="#local-6989586621681307335"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">is_dloc</span><span> </span><a href="#local-6989586621681307337"><span class="hs-identifier hs-var">d2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1207"></a><span>
</span><a name="line-1208"></a><span>    </span><span class="hs-identifier">best_item</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#ImpItemSpec"><span class="hs-identifier hs-type">ImpItemSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#ImpItemSpec"><span class="hs-identifier hs-type">ImpItemSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Ordering</span><span>
</span><a name="line-1209"></a><span>    </span><a name="local-6989586621681307333"><a href="#local-6989586621681307333"><span class="hs-identifier">best_item</span></a></a><span> </span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span> </span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EQ</span><span>
</span><a name="line-1210"></a><span>    </span><span class="hs-identifier">best_item</span><span> </span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#ImpSome"><span class="hs-identifier hs-var">ImpSome</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LT</span><span>
</span><a name="line-1211"></a><span>    </span><span class="hs-identifier">best_item</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#ImpSome"><span class="hs-identifier hs-var">ImpSome</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GT</span><span>
</span><a name="line-1212"></a><span>    </span><span class="hs-identifier">best_item</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#ImpSome"><span class="hs-identifier hs-var">ImpSome</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_explicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307338"><a href="#local-6989586621681307338"><span class="hs-identifier">e1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1213"></a><span>              </span><span class="hs-special">(</span><a href="RdrName.html#ImpSome"><span class="hs-identifier hs-var">ImpSome</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">is_explicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307339"><a href="#local-6989586621681307339"><span class="hs-identifier">e2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307338"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">compare</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681307339"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1214"></a><span>     </span><span class="hs-comment">-- False &lt; True, so if e1 is explicit and e2 is not, we get GT</span><span>
</span><a name="line-1215"></a><span>
</span><a name="line-1216"></a><span class="hs-comment">{- Note [Choosing the best import declaration]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When reporting unused import declarations we use the following rules.
   (see [wiki:Commentary/Compiler/UnusedImports])

Say that an import-item is either
  * an entire import-all decl (eg import Foo), or
  * a particular item in an import list (eg import Foo( ..., x, ...)).
The general idea is that for each /occurrence/ of an imported name, we will
attribute that use to one import-item. Once we have processed all the
occurrences, any import items with no uses attributed to them are unused,
and are warned about. More precisely:

1. For every RdrName in the program text, find its GlobalRdrElt.

2. Then, from the [ImportSpec] (gre_imp) of that GRE, choose one
   the &quot;chosen import-item&quot;, and mark it &quot;used&quot;. This is done
   by 'bestImport'

3. After processing all the RdrNames, bleat about any
   import-items that are unused.
   This is done in RnNames.warnUnusedImportDecls.

The function 'bestImport' returns the dominant import among the
ImportSpecs it is given, implementing Step 2.  We say import-item A
dominates import-item B if we choose A over B. In general, we try to
choose the import that is most likely to render other imports
unnecessary.  Here is the dominance relationship we choose:

    a) import Foo dominates import qualified Foo.

    b) import Foo dominates import Foo(x).

    c) Otherwise choose the textually first one.

Rationale for (a).  Consider
   import qualified M  -- Import #1
   import M( x )       -- Import #2
   foo = M.x + x

The unqualified 'x' can only come from import #2.  The qualified 'M.x'
could come from either, but bestImport picks import #2, because it is
more likely to be useful in other imports, as indeed it is in this
case (see Trac #5211 for a concrete example).

But the rules are not perfect; consider
   import qualified M  -- Import #1
   import M( x )       -- Import #2
   foo = M.x + M.y

The M.x will use import #2, but M.y can only use import #1.
-}</span><span>
</span><a name="line-1268"></a><span>
</span><a name="line-1269"></a><span>
</span><a name="line-1270"></a><span class="hs-identifier">unQualSpecOK</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1271"></a><span class="hs-comment">-- ^ Is in scope unqualified?</span><span>
</span><a name="line-1272"></a><a name="unQualSpecOK"><a href="RdrName.html#unQualSpecOK"><span class="hs-identifier">unQualSpecOK</span></a></a><span> </span><a name="local-6989586621681307341"><a href="#local-6989586621681307341"><span class="hs-identifier">is</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_qual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_decl</span><span> </span><a href="#local-6989586621681307341"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1273"></a><span>
</span><a name="line-1274"></a><span class="hs-identifier">qualSpecOK</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1275"></a><span class="hs-comment">-- ^ Is in scope qualified with the given module?</span><span>
</span><a name="line-1276"></a><a name="qualSpecOK"><a href="RdrName.html#qualSpecOK"><span class="hs-identifier">qualSpecOK</span></a></a><span> </span><a name="local-6989586621681307342"><a href="#local-6989586621681307342"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621681307343"><a href="#local-6989586621681307343"><span class="hs-identifier">is</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307342"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">is_as</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_decl</span><span> </span><a href="#local-6989586621681307343"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-1277"></a><span>
</span><a name="line-1278"></a><span class="hs-identifier">importSpecLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>
</span><a name="line-1279"></a><a name="importSpecLoc"><a href="RdrName.html#importSpecLoc"><span class="hs-identifier">importSpecLoc</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#ImpSpec"><span class="hs-identifier hs-var">ImpSpec</span></a><span> </span><a name="local-6989586621681307344"><a href="#local-6989586621681307344"><span class="hs-identifier">decl</span></a></a><span> </span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">is_dloc</span><span> </span><a href="#local-6989586621681307344"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-1280"></a><span class="hs-identifier">importSpecLoc</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#ImpSpec"><span class="hs-identifier hs-var">ImpSpec</span></a><span> </span><span class="hs-identifier">_</span><span>    </span><a name="local-6989586621681307345"><a href="#local-6989586621681307345"><span class="hs-identifier">item</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">is_iloc</span><span> </span><a href="#local-6989586621681307345"><span class="hs-identifier hs-var">item</span></a><span>
</span><a name="line-1281"></a><span>
</span><a name="line-1282"></a><span class="hs-identifier">importSpecModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-1283"></a><a name="importSpecModule"><a href="RdrName.html#importSpecModule"><span class="hs-identifier">importSpecModule</span></a></a><span> </span><a name="local-6989586621681307346"><a href="#local-6989586621681307346"><span class="hs-identifier">is</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">is_mod</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_decl</span><span> </span><a href="#local-6989586621681307346"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-1284"></a><span>
</span><a name="line-1285"></a><span class="hs-identifier">isExplicitItem</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#ImpItemSpec"><span class="hs-identifier hs-type">ImpItemSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1286"></a><a name="isExplicitItem"><a href="RdrName.html#isExplicitItem"><span class="hs-identifier">isExplicitItem</span></a></a><span> </span><a href="RdrName.html#ImpAll"><span class="hs-identifier hs-var">ImpAll</span></a><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1287"></a><span class="hs-identifier">isExplicitItem</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#ImpSome"><span class="hs-identifier hs-var">ImpSome</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">is_explicit</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307347"><a href="#local-6989586621681307347"><span class="hs-identifier">exp</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307347"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-1288"></a><span>
</span><a name="line-1289"></a><span class="hs-identifier">pprNameProvenance</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1290"></a><span class="hs-comment">-- ^ Print out one place where the name was define/imported</span><span>
</span><a name="line-1291"></a><span class="hs-comment">-- (With -dppr-debug, print them all)</span><span>
</span><a name="line-1292"></a><a name="pprNameProvenance"><a href="RdrName.html#pprNameProvenance"><span class="hs-identifier">pprNameProvenance</span></a></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#GRE"><span class="hs-identifier hs-var">GRE</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gre_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307348"><a href="#local-6989586621681307348"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_lcl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307349"><a href="#local-6989586621681307349"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">gre_imp</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681307350"><a href="#local-6989586621681307350"><span class="hs-identifier">iss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1293"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ifPprDebug"><span class="hs-identifier hs-var">ifPprDebug</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><a href="#local-6989586621681307351"><span class="hs-identifier hs-var">pp_provs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1294"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621681307351"><span class="hs-identifier hs-var">pp_provs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1295"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1296"></a><span>    </span><a name="local-6989586621681307351"><a href="#local-6989586621681307351"><span class="hs-identifier">pp_provs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681307352"><span class="hs-identifier hs-var">pp_lcl</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621681307353"><span class="hs-identifier hs-var">pp_is</span></a><span> </span><a href="#local-6989586621681307350"><span class="hs-identifier hs-var">iss</span></a><span>
</span><a name="line-1297"></a><span>    </span><a name="local-6989586621681307352"><a href="#local-6989586621681307352"><span class="hs-identifier">pp_lcl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681307349"><span class="hs-identifier hs-var">lcl</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;defined at&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#nameSrcLoc"><span class="hs-identifier hs-var">nameSrcLoc</span></a><span> </span><a href="#local-6989586621681307348"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1298"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1299"></a><span>    </span><a name="local-6989586621681307353"><a href="#local-6989586621681307353"><span class="hs-identifier">pp_is</span></a></a><span> </span><a name="local-6989586621681307354"><a href="#local-6989586621681307354"><span class="hs-identifier">is</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307354"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">,</span><span> </span><a href="RdrName.html#ppr_defn_site"><span class="hs-identifier hs-var">ppr_defn_site</span></a><span> </span><a href="#local-6989586621681307354"><span class="hs-identifier hs-var">is</span></a><span> </span><a href="#local-6989586621681307348"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1300"></a><span>
</span><a name="line-1301"></a><span class="hs-comment">-- If we know the exact definition point (which we may do with GHCi)</span><span>
</span><a name="line-1302"></a><span class="hs-comment">-- then show that too.  But not if it's just &quot;imported from X&quot;.</span><span>
</span><a name="line-1303"></a><span class="hs-identifier">ppr_defn_site</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1304"></a><a name="ppr_defn_site"><a href="RdrName.html#ppr_defn_site"><span class="hs-identifier">ppr_defn_site</span></a></a><span> </span><a name="local-6989586621681307355"><a href="#local-6989586621681307355"><span class="hs-identifier">imp_spec</span></a></a><span> </span><a name="local-6989586621681307356"><a href="#local-6989586621681307356"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1305"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307359"><span class="hs-identifier hs-var">same_module</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#isGoodSrcSpan"><span class="hs-identifier hs-var">isGoodSrcSpan</span></a><span> </span><a href="#local-6989586621681307357"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1306"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>              </span><span class="hs-comment">-- Nothing interesting to say</span><span>
</span><a name="line-1307"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1308"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;and originally defined&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-6989586621681307360"><span class="hs-identifier hs-var">pp_mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-1309"></a><span>                </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#pprLoc"><span class="hs-identifier hs-var">pprLoc</span></a><span> </span><a href="#local-6989586621681307357"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1310"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1311"></a><span>    </span><a name="local-6989586621681307357"><a href="#local-6989586621681307357"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a><span> </span><a href="#local-6989586621681307356"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1312"></a><span>    </span><a name="local-6989586621681307358"><a href="#local-6989586621681307358"><span class="hs-identifier">defining_mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">nameModule</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1313"></a><span>    </span><a name="local-6989586621681307359"><a href="#local-6989586621681307359"><span class="hs-identifier">same_module</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#importSpecModule"><span class="hs-identifier hs-var">importSpecModule</span></a><span> </span><a href="#local-6989586621681307355"><span class="hs-identifier hs-var">imp_spec</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621681307358"><span class="hs-identifier hs-var">defining_mod</span></a><span>
</span><a name="line-1314"></a><span>    </span><a name="local-6989586621681307360"><a href="#local-6989586621681307360"><span class="hs-identifier">pp_mod</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681307359"><span class="hs-identifier hs-var">same_module</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1315"></a><span>           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307358"><span class="hs-identifier hs-var">defining_mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-1316"></a><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="RdrName.html#ImportSpec"><span class="hs-identifier hs-type">ImportSpec</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1319"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621681307023"><a href="#local-6989586621681307023"><span class="hs-identifier">imp_spec</span></a></a><span>
</span><a name="line-1320"></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;imported&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-6989586621681307024"><span class="hs-identifier hs-var">qual</span></a><span>
</span><a name="line-1321"></a><span>        </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;from&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#importSpecModule"><span class="hs-identifier hs-var">importSpecModule</span></a><span> </span><a href="#local-6989586621681307023"><span class="hs-identifier hs-var">imp_spec</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1322"></a><span>        </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="RdrName.html#pprLoc"><span class="hs-identifier hs-var">pprLoc</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#importSpecLoc"><span class="hs-identifier hs-var">importSpecLoc</span></a><span> </span><a href="#local-6989586621681307023"><span class="hs-identifier hs-var">imp_spec</span></a><span class="hs-special">)</span><span>
</span><a name="line-1323"></a><span>     </span><span class="hs-keyword">where</span><span>
</span><a name="line-1324"></a><span>       </span><a name="local-6989586621681307024"><a href="#local-6989586621681307024"><span class="hs-identifier">qual</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">is_qual</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">is_decl</span><span> </span><a href="#local-6989586621681307023"><span class="hs-identifier hs-var">imp_spec</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;qualified&quot;</span><span>
</span><a name="line-1325"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1326"></a><span>
</span><a name="line-1327"></a><span class="hs-identifier">pprLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1328"></a><a name="pprLoc"><a href="RdrName.html#pprLoc"><span class="hs-identifier">pprLoc</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-var">RealSrcSpan</span></a><span> </span><a name="local-6989586621681307361"><a href="#local-6989586621681307361"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;at&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307361"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1329"></a><span class="hs-identifier">pprLoc</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#UnhelpfulSpan"><span class="hs-identifier hs-var">UnhelpfulSpan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1330"></a><span>
</span><a name="line-1331"></a><span class="hs-comment">-- | Display info about the treatment of '*' under NoStarIsType.</span><span>
</span><a name="line-1332"></a><span class="hs-comment">--</span><span>
</span><a name="line-1333"></a><span class="hs-comment">-- With StarIsType, three properties of '*' hold:</span><span>
</span><a name="line-1334"></a><span class="hs-comment">--</span><span>
</span><a name="line-1335"></a><span class="hs-comment">--   (a) it is not an infix operator</span><span>
</span><a name="line-1336"></a><span class="hs-comment">--   (b) it is always in scope</span><span>
</span><a name="line-1337"></a><span class="hs-comment">--   (c) it is a synonym for Data.Kind.Type</span><span>
</span><a name="line-1338"></a><span class="hs-comment">--</span><span>
</span><a name="line-1339"></a><span class="hs-comment">-- However, the user might not know that he's working on a module with</span><span>
</span><a name="line-1340"></a><span class="hs-comment">-- NoStarIsType and write code that still assumes (a), (b), and (c), which</span><span>
</span><a name="line-1341"></a><span class="hs-comment">-- actually do not hold in that module.</span><span>
</span><a name="line-1342"></a><span class="hs-comment">--</span><span>
</span><a name="line-1343"></a><span class="hs-comment">-- Violation of (a) shows up in the parser. For instance, in the following</span><span>
</span><a name="line-1344"></a><span class="hs-comment">-- examples, we have '*' not applied to enough arguments:</span><span>
</span><a name="line-1345"></a><span class="hs-comment">--</span><span>
</span><a name="line-1346"></a><span class="hs-comment">--   data A :: *</span><span>
</span><a name="line-1347"></a><span class="hs-comment">--   data F :: * -&gt; *</span><span>
</span><a name="line-1348"></a><span class="hs-comment">--</span><span>
</span><a name="line-1349"></a><span class="hs-comment">-- Violation of (b) or (c) show up in the renamer and the typechecker</span><span>
</span><a name="line-1350"></a><span class="hs-comment">-- respectively. For instance:</span><span>
</span><a name="line-1351"></a><span class="hs-comment">--</span><span>
</span><a name="line-1352"></a><span class="hs-comment">--   type K = Either * Bool</span><span>
</span><a name="line-1353"></a><span class="hs-comment">--</span><span>
</span><a name="line-1354"></a><span class="hs-comment">-- This will parse differently depending on whether StarIsType is enabled,</span><span>
</span><a name="line-1355"></a><span class="hs-comment">-- but it will parse nonetheless. With NoStarIsType it is parsed as a type</span><span>
</span><a name="line-1356"></a><span class="hs-comment">-- operator, thus we have ((*) Either Bool). Now there are two cases to</span><span>
</span><a name="line-1357"></a><span class="hs-comment">-- consider:</span><span>
</span><a name="line-1358"></a><span class="hs-comment">--</span><span>
</span><a name="line-1359"></a><span class="hs-comment">--   1. There is no definition of (*) in scope. In this case the renamer will</span><span>
</span><a name="line-1360"></a><span class="hs-comment">--      fail to look it up. This is a violation of assumption (b).</span><span>
</span><a name="line-1361"></a><span class="hs-comment">--</span><span>
</span><a name="line-1362"></a><span class="hs-comment">--   2. There is a definition of the (*) type operator in scope (for example</span><span>
</span><a name="line-1363"></a><span class="hs-comment">--      coming from GHC.TypeNats). In this case the user will get a kind</span><span>
</span><a name="line-1364"></a><span class="hs-comment">--      mismatch error. This is a violation of assumption (c).</span><span>
</span><a name="line-1365"></a><span class="hs-comment">--</span><span>
</span><a name="line-1366"></a><span class="hs-comment">-- The user might unknowingly be working on a module with NoStarIsType</span><span>
</span><a name="line-1367"></a><span class="hs-comment">-- or use '*' as 'Data.Kind.Type' out of habit. So it is important to give a</span><span>
</span><a name="line-1368"></a><span class="hs-comment">-- hint whenever an assumption about '*' is violated. Unfortunately, it is</span><span>
</span><a name="line-1369"></a><span class="hs-comment">-- somewhat difficult to deal with (c), so we limit ourselves to (a) and (b).</span><span>
</span><a name="line-1370"></a><span class="hs-comment">--</span><span>
</span><a name="line-1371"></a><span class="hs-comment">-- 'starInfo' generates an appropriate hint to the user depending on the</span><span>
</span><a name="line-1372"></a><span class="hs-comment">-- extensions enabled in the module and the name that triggered the error.</span><span>
</span><a name="line-1373"></a><span class="hs-comment">-- That is, if we have NoStarIsType and the error is related to '*' or its</span><span>
</span><a name="line-1374"></a><span class="hs-comment">-- Unicode variant, the resulting SDoc will contain a helpful suggestion.</span><span>
</span><a name="line-1375"></a><span class="hs-comment">-- Otherwise it is empty.</span><span>
</span><a name="line-1376"></a><span class="hs-comment">--</span><span>
</span><a name="line-1377"></a><span class="hs-identifier">starInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1378"></a><a name="starInfo"><a href="RdrName.html#starInfo"><span class="hs-identifier">starInfo</span></a></a><span> </span><a name="local-6989586621681307362"><a href="#local-6989586621681307362"><span class="hs-identifier">star_is_type</span></a></a><span> </span><a name="local-6989586621681307363"><a href="#local-6989586621681307363"><span class="hs-identifier">rdr_name</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1379"></a><span>  </span><span class="hs-comment">-- One might ask: if can use sdocWithDynFlags here, why bother to take</span><span>
</span><a name="line-1380"></a><span>  </span><span class="hs-comment">-- star_is_type as input? Why not refactor?</span><span>
</span><a name="line-1381"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1382"></a><span>  </span><span class="hs-comment">-- The reason is that sdocWithDynFlags would provide DynFlags that are active</span><span>
</span><a name="line-1383"></a><span>  </span><span class="hs-comment">-- in the module that tries to load the problematic definition, not</span><span>
</span><a name="line-1384"></a><span>  </span><span class="hs-comment">-- in the module that is being loaded.</span><span>
</span><a name="line-1385"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1386"></a><span>  </span><span class="hs-comment">-- So if we have 'data T :: *' in a module with NoStarIsType, then the hint</span><span>
</span><a name="line-1387"></a><span>  </span><span class="hs-comment">-- must be displayed even if we load this definition from a module (or GHCi)</span><span>
</span><a name="line-1388"></a><span>  </span><span class="hs-comment">-- with StarIsType enabled!</span><span>
</span><a name="line-1389"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-1390"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681307364"><span class="hs-identifier hs-var">isUnqualStar</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621681307362"><span class="hs-identifier hs-var">star_is_type</span></a><span>
</span><a name="line-1391"></a><span>     </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;With NoStarIsType, &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-1392"></a><span>          </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621681307363"><span class="hs-identifier hs-var">rdr_name</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-1393"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot; is treated as a regular type operator. &quot;</span><span>
</span><a name="line-1394"></a><span>        </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-1395"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Did you mean to use &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-1396"></a><span>          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot; from Data.Kind instead?&quot;</span><span>
</span><a name="line-1397"></a><span>      </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1398"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1399"></a><span>    </span><span class="hs-comment">-- Does rdr_name look like the user might have meant the '*' kind by it?</span><span>
</span><a name="line-1400"></a><span>    </span><span class="hs-comment">-- We focus on unqualified stars specifically, because qualified stars are</span><span>
</span><a name="line-1401"></a><span>    </span><span class="hs-comment">-- treated as type operators even under StarIsType.</span><span>
</span><a name="line-1402"></a><span>    </span><a name="local-6989586621681307364"><a href="#local-6989586621681307364"><span class="hs-identifier">isUnqualStar</span></a></a><span>
</span><a name="line-1403"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="RdrName.html#Unqual"><span class="hs-identifier hs-var">Unqual</span></a><span> </span><a name="local-6989586621681307365"><a href="#local-6989586621681307365"><span class="hs-identifier">occName</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681307363"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-1404"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681307366"><a href="#local-6989586621681307366"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">occNameFS</span><span> </span><a href="#local-6989586621681307365"><span class="hs-identifier hs-var">occName</span></a><span>
</span><a name="line-1405"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621681307366"><span class="hs-identifier hs-var">fs</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;*&quot;</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621681307366"><span class="hs-identifier hs-var">fs</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;&#9733;&quot;</span><span>
</span><a name="line-1406"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1407"></a></pre></body></html>