<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- | Handy functions for creating much Core syntax</span><span>
</span><a name="line-4"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">MkCore</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-5"></a><span>        </span><span class="hs-comment">-- * Constructing normal syntax</span><span>
</span><a name="line-6"></a><span>        </span><a href="MkCore.html#mkCoreLet"><span class="hs-identifier hs-var">mkCoreLet</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkCoreLets"><span class="hs-identifier hs-var">mkCoreLets</span></a><span class="hs-special">,</span><span>
</span><a name="line-7"></a><span>        </span><a href="MkCore.html#mkCoreApp"><span class="hs-identifier hs-var">mkCoreApp</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkCoreApps"><span class="hs-identifier hs-var">mkCoreApps</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span class="hs-special">,</span><span>
</span><a name="line-8"></a><span>        </span><a href="MkCore.html#mkCoreLams"><span class="hs-identifier hs-var">mkCoreLams</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkIfThenElse"><span class="hs-identifier hs-var">mkIfThenElse</span></a><span class="hs-special">,</span><span>
</span><a name="line-9"></a><span>        </span><a href="MkCore.html#mkWildValBinder"><span class="hs-identifier hs-var">mkWildValBinder</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkWildEvBinder"><span class="hs-identifier hs-var">mkWildEvBinder</span></a><span class="hs-special">,</span><span>
</span><a name="line-10"></a><span>        </span><a href="MkCore.html#sortQuantVars"><span class="hs-identifier hs-var">sortQuantVars</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#castBottomExpr"><span class="hs-identifier hs-var">castBottomExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span>        </span><span class="hs-comment">-- * Constructing boxed literals</span><span>
</span><a name="line-13"></a><span>        </span><a href="MkCore.html#mkWordExpr"><span class="hs-identifier hs-var">mkWordExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkWordExprWord"><span class="hs-identifier hs-var">mkWordExprWord</span></a><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>        </span><a href="MkCore.html#mkIntExpr"><span class="hs-identifier hs-var">mkIntExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkIntExprInt"><span class="hs-identifier hs-var">mkIntExprInt</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="MkCore.html#mkIntegerExpr"><span class="hs-identifier hs-var">mkIntegerExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkNaturalExpr"><span class="hs-identifier hs-var">mkNaturalExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="MkCore.html#mkFloatExpr"><span class="hs-identifier hs-var">mkFloatExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkDoubleExpr"><span class="hs-identifier hs-var">mkDoubleExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="MkCore.html#mkCharExpr"><span class="hs-identifier hs-var">mkCharExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkStringExpr"><span class="hs-identifier hs-var">mkStringExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkStringExprFS"><span class="hs-identifier hs-var">mkStringExprFS</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkStringExprFSWith"><span class="hs-identifier hs-var">mkStringExprFSWith</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span>        </span><span class="hs-comment">-- * Floats</span><span>
</span><a name="line-20"></a><span>        </span><a href="MkCore.html#FloatBind"><span class="hs-identifier hs-type">FloatBind</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="MkCore.html#wrapFloat"><span class="hs-identifier hs-var">wrapFloat</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>        </span><span class="hs-comment">-- * Constructing small tuples</span><span>
</span><a name="line-23"></a><span>        </span><a href="MkCore.html#mkCoreVarTup"><span class="hs-identifier hs-var">mkCoreVarTup</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkCoreVarTupTy"><span class="hs-identifier hs-var">mkCoreVarTupTy</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkCoreTup"><span class="hs-identifier hs-var">mkCoreTup</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier hs-var">mkCoreUbxTup</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="MkCore.html#mkCoreTupBoxity"><span class="hs-identifier hs-var">mkCoreTupBoxity</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#unitExpr"><span class="hs-identifier hs-var">unitExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>        </span><span class="hs-comment">-- * Constructing big tuples</span><span>
</span><a name="line-27"></a><span>        </span><a href="MkCore.html#mkBigCoreVarTup"><span class="hs-identifier hs-var">mkBigCoreVarTup</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkBigCoreVarTup1"><span class="hs-identifier hs-var">mkBigCoreVarTup1</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="MkCore.html#mkBigCoreVarTupTy"><span class="hs-identifier hs-var">mkBigCoreVarTupTy</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkBigCoreTupTy"><span class="hs-identifier hs-var">mkBigCoreTupTy</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="MkCore.html#mkBigCoreTup"><span class="hs-identifier hs-var">mkBigCoreTup</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span>        </span><span class="hs-comment">-- * Deconstructing small tuples</span><span>
</span><a name="line-32"></a><span>        </span><a href="MkCore.html#mkSmallTupleSelector"><span class="hs-identifier hs-var">mkSmallTupleSelector</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkSmallTupleCase"><span class="hs-identifier hs-var">mkSmallTupleCase</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>        </span><span class="hs-comment">-- * Deconstructing big tuples</span><span>
</span><a name="line-35"></a><span>        </span><a href="MkCore.html#mkTupleSelector"><span class="hs-identifier hs-var">mkTupleSelector</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkTupleSelector1"><span class="hs-identifier hs-var">mkTupleSelector1</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkTupleCase"><span class="hs-identifier hs-var">mkTupleCase</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span>        </span><span class="hs-comment">-- * Constructing list expressions</span><span>
</span><a name="line-38"></a><span>        </span><a href="MkCore.html#mkNilExpr"><span class="hs-identifier hs-var">mkNilExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkConsExpr"><span class="hs-identifier hs-var">mkConsExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkListExpr"><span class="hs-identifier hs-var">mkListExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>        </span><a href="MkCore.html#mkFoldrExpr"><span class="hs-identifier hs-var">mkFoldrExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkBuildExpr"><span class="hs-identifier hs-var">mkBuildExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span>        </span><span class="hs-comment">-- * Constructing Maybe expressions</span><span>
</span><a name="line-42"></a><span>        </span><a href="MkCore.html#mkNothingExpr"><span class="hs-identifier hs-var">mkNothingExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkJustExpr"><span class="hs-identifier hs-var">mkJustExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span>        </span><span class="hs-comment">-- * Error Ids</span><span>
</span><a name="line-45"></a><span>        </span><a href="MkCore.html#mkRuntimeErrorApp"><span class="hs-identifier hs-var">mkRuntimeErrorApp</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkImpossibleExpr"><span class="hs-identifier hs-var">mkImpossibleExpr</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#mkAbsentErrorApp"><span class="hs-identifier hs-var">mkAbsentErrorApp</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#errorIds"><span class="hs-identifier hs-var">errorIds</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>        </span><a href="MkCore.html#rEC_CON_ERROR_ID"><span class="hs-identifier hs-var">rEC_CON_ERROR_ID</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#rUNTIME_ERROR_ID"><span class="hs-identifier hs-var">rUNTIME_ERROR_ID</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>        </span><a href="MkCore.html#nON_EXHAUSTIVE_GUARDS_ERROR_ID"><span class="hs-identifier hs-var">nON_EXHAUSTIVE_GUARDS_ERROR_ID</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#nO_METHOD_BINDING_ERROR_ID"><span class="hs-identifier hs-var">nO_METHOD_BINDING_ERROR_ID</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="MkCore.html#pAT_ERROR_ID"><span class="hs-identifier hs-var">pAT_ERROR_ID</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#rEC_SEL_ERROR_ID"><span class="hs-identifier hs-var">rEC_SEL_ERROR_ID</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#aBSENT_ERROR_ID"><span class="hs-identifier hs-var">aBSENT_ERROR_ID</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>        </span><a href="MkCore.html#tYPE_ERROR_ID"><span class="hs-identifier hs-var">tYPE_ERROR_ID</span></a><span class="hs-special">,</span><span> </span><a href="MkCore.html#aBSENT_SUM_FIELD_ERROR_ID"><span class="hs-identifier hs-var">aBSENT_SUM_FIELD_ERROR_ID</span></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>      </span><span class="hs-special">(</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#setTyVarUnique"><span class="hs-identifier hs-var">setTyVarUnique</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="CoreUtils.html"><span class="hs-identifier">CoreUtils</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span class="hs-special">,</span><span> </span><a href="CoreUtils.html#needsCaseBinding"><span class="hs-identifier hs-var">needsCaseBinding</span></a><span class="hs-special">,</span><span> </span><a href="CoreUtils.html#bindNonRec"><span class="hs-identifier hs-var">bindNonRec</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="Literal.html"><span class="hs-identifier">Literal</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="HsUtils.html"><span class="hs-identifier">HsUtils</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="HsUtils.html#mkChunkified"><span class="hs-identifier hs-var">mkChunkified</span></a><span class="hs-special">,</span><span> </span><a href="HsUtils.html#chunkify"><span class="hs-identifier hs-var">chunkify</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span>         </span><span class="hs-special">(</span><span> </span><a href="Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="TysPrim.html"><span class="hs-identifier">TysPrim</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConWorkId"><span class="hs-identifier hs-var">dataConWorkId</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="IdInfo.html"><span class="hs-identifier">IdInfo</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="Demand.html"><span class="hs-identifier">Demand</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>      </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><a href="OccName.html#varName"><span class="hs-identifier hs-var">varName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Fail</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MonadFail</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">MonadFail</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-special">`</span><a href="MkCore.html#mkCoreApp"><span class="hs-identifier hs-var">mkCoreApp</span></a><span class="hs-special">`</span><span class="hs-special">,</span><span> </span><span class="hs-special">`</span><a href="MkCore.html#mkCoreApps"><span class="hs-identifier hs-var">mkCoreApps</span></a><span class="hs-special">`</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Basic CoreSyn construction}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-95"></a><span class="hs-identifier">sortQuantVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- Sort the variables, putting type and covars first, in scoped order,</span><span>
</span><a name="line-97"></a><span class="hs-comment">-- and then other Ids</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- It is a deterministic sort, meaining it doesn't look at the values of</span><span>
</span><a name="line-99"></a><span class="hs-comment">-- Uniques. For explanation why it's important See Note [Unique Determinism]</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- in Unique.</span><span>
</span><a name="line-101"></a><a name="sortQuantVars"><a href="MkCore.html#sortQuantVars"><span class="hs-identifier">sortQuantVars</span></a></a><span> </span><a name="local-6989586621684659770"><a href="#local-6989586621684659770"><span class="hs-identifier">vs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659773"><span class="hs-identifier hs-var">sorted_tcvs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684659772"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-102"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659771"><a href="#local-6989586621684659771"><span class="hs-identifier">tcvs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659772"><a href="#local-6989586621684659772"><span class="hs-identifier">ids</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-special">(</span><a href="Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a><span> </span><a href="Util.html#%3C%7C%7C%3E"><span class="hs-operator hs-var">&lt;||&gt;</span></a><span> </span><a href="Var.html#isCoVar"><span class="hs-identifier hs-var">isCoVar</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659770"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-104"></a><span>    </span><a name="local-6989586621684659773"><a href="#local-6989586621684659773"><span class="hs-identifier">sorted_tcvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#scopedSort"><span class="hs-identifier hs-var">scopedSort</span></a><span> </span><a href="#local-6989586621684659771"><span class="hs-identifier hs-var">tcvs</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-comment">-- | Bind a binding group over an expression, using a @let@ or @case@ as</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- appropriate (see &quot;CoreSyn#let_app_invariant&quot;)</span><span>
</span><a name="line-108"></a><span class="hs-identifier">mkCoreLet</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-109"></a><a name="mkCoreLet"><a href="MkCore.html#mkCoreLet"><span class="hs-identifier">mkCoreLet</span></a></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a><span> </span><a name="local-6989586621684659774"><a href="#local-6989586621684659774"><span class="hs-identifier">bndr</span></a></a><span> </span><a name="local-6989586621684659775"><a href="#local-6989586621684659775"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684659776"><a href="#local-6989586621684659776"><span class="hs-identifier">body</span></a></a><span>        </span><span class="hs-comment">-- See Note [CoreSyn let/app invariant]</span><span>
</span><a name="line-110"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreUtils.html#bindNonRec"><span class="hs-identifier hs-var">bindNonRec</span></a><span> </span><a href="#local-6989586621684659774"><span class="hs-identifier hs-var">bndr</span></a><span> </span><a href="#local-6989586621684659775"><span class="hs-identifier hs-var">rhs</span></a><span> </span><a href="#local-6989586621684659776"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-111"></a><span class="hs-identifier">mkCoreLet</span><span> </span><a name="local-6989586621684659777"><a href="#local-6989586621684659777"><span class="hs-identifier">bind</span></a></a><span> </span><a name="local-6989586621684659778"><a href="#local-6989586621684659778"><span class="hs-identifier">body</span></a></a><span>
</span><a name="line-112"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Let"><span class="hs-identifier hs-var">Let</span></a><span> </span><a href="#local-6989586621684659777"><span class="hs-identifier hs-var">bind</span></a><span> </span><a href="#local-6989586621684659778"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-comment">-- | Bind a list of binding groups over an expression. The leftmost binding</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- group becomes the outermost group in the resulting expression</span><span>
</span><a name="line-116"></a><span class="hs-identifier">mkCoreLets</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-117"></a><a name="mkCoreLets"><a href="MkCore.html#mkCoreLets"><span class="hs-identifier">mkCoreLets</span></a></a><span> </span><a name="local-6989586621684659779"><a href="#local-6989586621684659779"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-6989586621684659780"><a href="#local-6989586621684659780"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="MkCore.html#mkCoreLet"><span class="hs-identifier hs-var">mkCoreLet</span></a><span> </span><a href="#local-6989586621684659780"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="#local-6989586621684659779"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-comment">-- | Construct an expression which represents the application of one expression</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- paired with its type to an argument. The result is paired with its type. This</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- function is not exported and used in the definition of 'mkCoreApp' and</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- 'mkCoreApps'.</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- Respects the let/app invariant by building a case expression where necessary</span><span>
</span><a name="line-124"></a><span class="hs-comment">--   See CoreSyn Note [CoreSyn let/app invariant]</span><span>
</span><a name="line-125"></a><span class="hs-identifier">mkCoreAppTyped</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><a name="mkCoreAppTyped"><a href="MkCore.html#mkCoreAppTyped"><span class="hs-identifier">mkCoreAppTyped</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659781"><a href="#local-6989586621684659781"><span class="hs-identifier">fun</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659782"><a href="#local-6989586621684659782"><span class="hs-identifier">fun_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a name="local-6989586621684659783"><a href="#local-6989586621684659783"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-127"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><a href="#local-6989586621684659781"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659783"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Type.html#piResultTy"><span class="hs-identifier hs-var">piResultTy</span></a><span> </span><a href="#local-6989586621684659782"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="#local-6989586621684659783"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-128"></a><span class="hs-identifier">mkCoreAppTyped</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659784"><a href="#local-6989586621684659784"><span class="hs-identifier">fun</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659785"><a href="#local-6989586621684659785"><span class="hs-identifier">fun_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Coercion"><span class="hs-identifier hs-var">Coercion</span></a><span> </span><a name="local-6989586621684659786"><a href="#local-6989586621684659786"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><a href="#local-6989586621684659784"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Coercion"><span class="hs-identifier hs-var">Coercion</span></a><span> </span><a href="#local-6989586621684659786"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659787"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-131"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684659787"><a href="#local-6989586621684659787"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitFunTy"><span class="hs-identifier hs-var">splitFunTy</span></a><span> </span><a href="#local-6989586621684659785"><span class="hs-identifier hs-var">fun_ty</span></a><span>
</span><a name="line-132"></a><span class="hs-identifier">mkCoreAppTyped</span><span> </span><a name="local-6989586621684659788"><a href="#local-6989586621684659788"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684659789"><a href="#local-6989586621684659789"><span class="hs-identifier">fun</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659790"><a href="#local-6989586621684659790"><span class="hs-identifier">fun_ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684659791"><a href="#local-6989586621684659791"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-133"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isFunTy</span><span> </span><span class="hs-identifier">fun_ty</span><span class="hs-special">,</span><span> </span><a href="Type.html#isFunTy"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">fun</span><span> </span><a href="#local-6989586621684659790"><span class="hs-operator hs-var">$$</span></a><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">arg</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-special">(</span><a href="MkCore.html#mk_val_app"><span class="hs-identifier hs-var">mk_val_app</span></a><span> </span><a href="#local-6989586621684659789"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621684659791"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621684659792"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="#local-6989586621684659793"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659793"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-135"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659792"><a href="#local-6989586621684659792"><span class="hs-identifier">arg_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659793"><a href="#local-6989586621684659793"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#splitFunTy"><span class="hs-identifier hs-var">splitFunTy</span></a><span> </span><a href="#local-6989586621684659790"><span class="hs-identifier hs-var">fun_ty</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- | Construct an expression which represents the application of one expression</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- to the other</span><span>
</span><a name="line-140"></a><span class="hs-comment">-- Respects the let/app invariant by building a case expression where necessary</span><span>
</span><a name="line-141"></a><span class="hs-comment">--   See CoreSyn Note [CoreSyn let/app invariant]</span><span>
</span><a name="line-142"></a><span class="hs-identifier">mkCoreApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-143"></a><a name="mkCoreApp"><a href="MkCore.html#mkCoreApp"><span class="hs-identifier">mkCoreApp</span></a></a><span> </span><a name="local-6989586621684659794"><a href="#local-6989586621684659794"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621684659795"><a href="#local-6989586621684659795"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621684659796"><a href="#local-6989586621684659796"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-144"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MkCore.html#mkCoreAppTyped"><span class="hs-identifier hs-var">mkCoreAppTyped</span></a><span> </span><a href="#local-6989586621684659794"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659795"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">,</span><span> </span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621684659795"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659796"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- | Construct an expression which represents the application of a number of</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- expressions to another. The leftmost expression in the list is applied first</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- Respects the let/app invariant by building a case expression where necessary</span><span>
</span><a name="line-149"></a><span class="hs-comment">--   See CoreSyn Note [CoreSyn let/app invariant]</span><span>
</span><a name="line-150"></a><span class="hs-identifier">mkCoreApps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-151"></a><a name="mkCoreApps"><a href="MkCore.html#mkCoreApps"><span class="hs-identifier">mkCoreApps</span></a></a><span> </span><a name="local-6989586621684659797"><a href="#local-6989586621684659797"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621684659798"><a href="#local-6989586621684659798"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-152"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-153"></a><span>    </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="MkCore.html#mkCoreAppTyped"><span class="hs-identifier hs-var">mkCoreAppTyped</span></a><span> </span><a href="#local-6989586621684659799"><span class="hs-identifier hs-var">doc_string</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659797"><span class="hs-identifier hs-var">fun</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659800"><span class="hs-identifier hs-var">fun_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659798"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-154"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-155"></a><span>    </span><a name="local-6989586621684659799"><a href="#local-6989586621684659799"><span class="hs-identifier">doc_string</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684659800"><span class="hs-identifier hs-var">fun_ty</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684659797"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684659798"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-156"></a><span>    </span><a name="local-6989586621684659800"><a href="#local-6989586621684659800"><span class="hs-identifier">fun_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621684659797"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-comment">-- | Construct an expression which represents the application of a number of</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- expressions to that of a data constructor expression. The leftmost expression</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- in the list is applied first</span><span>
</span><a name="line-161"></a><span class="hs-identifier">mkCoreConApps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-162"></a><a name="mkCoreConApps"><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier">mkCoreConApps</span></a></a><span> </span><a name="local-6989586621684659801"><a href="#local-6989586621684659801"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621684659802"><a href="#local-6989586621684659802"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreApps"><span class="hs-identifier hs-var">mkCoreApps</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConWorkId"><span class="hs-identifier hs-var">dataConWorkId</span></a><span> </span><a href="#local-6989586621684659801"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659802"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-identifier">mk_val_app</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-165"></a><span class="hs-comment">-- Build an application (e1 e2),</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- or a strict binding  (case e2 of x -&gt; e1 x)</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- using the latter when necessary to respect the let/app invariant</span><span>
</span><a name="line-168"></a><span class="hs-comment">--   See Note [CoreSyn let/app invariant]</span><span>
</span><a name="line-169"></a><a name="mk_val_app"><a href="MkCore.html#mk_val_app"><span class="hs-identifier">mk_val_app</span></a></a><span> </span><a name="local-6989586621684659803"><a href="#local-6989586621684659803"><span class="hs-identifier">fun</span></a></a><span> </span><a name="local-6989586621684659804"><a href="#local-6989586621684659804"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621684659805"><a href="#local-6989586621684659805"><span class="hs-identifier">arg_ty</span></a></a><span> </span><a name="local-6989586621684659806"><a href="#local-6989586621684659806"><span class="hs-identifier">res_ty</span></a></a><span>
</span><a name="line-170"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#needsCaseBinding"><span class="hs-identifier hs-var">needsCaseBinding</span></a><span> </span><a href="#local-6989586621684659805"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><a href="#local-6989586621684659804"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><a href="#local-6989586621684659803"><span class="hs-identifier hs-var">fun</span></a><span> </span><a href="#local-6989586621684659804"><span class="hs-identifier hs-var">arg</span></a><span>                </span><span class="hs-comment">-- The vastly common case</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-174"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Case"><span class="hs-identifier hs-var">Case</span></a><span> </span><a href="#local-6989586621684659804"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621684659807"><span class="hs-identifier hs-var">arg_id</span></a><span> </span><a href="#local-6989586621684659806"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DEFAULT"><span class="hs-identifier hs-var">DEFAULT</span></a><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><a href="#local-6989586621684659803"><span class="hs-identifier hs-var">fun</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659807"><span class="hs-identifier hs-var">arg_id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-175"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-176"></a><span>    </span><a name="local-6989586621684659807"><a href="#local-6989586621684659807"><span class="hs-identifier">arg_id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkWildValBinder"><span class="hs-identifier hs-var">mkWildValBinder</span></a><span> </span><a href="#local-6989586621684659805"><span class="hs-identifier hs-var">arg_ty</span></a><span>
</span><a name="line-177"></a><span>        </span><span class="hs-comment">-- Lots of shadowing, but it doesn't matter,</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-comment">-- because 'fun ' should not have a free wild-id</span><span>
</span><a name="line-179"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-180"></a><span>        </span><span class="hs-comment">-- This is Dangerous.  But this is the only place we play this</span><span>
</span><a name="line-181"></a><span>        </span><span class="hs-comment">-- game, mk_val_app returns an expression that does not have</span><span>
</span><a name="line-182"></a><span>        </span><span class="hs-comment">-- a free wild-id.  So the only thing that can go wrong</span><span>
</span><a name="line-183"></a><span>        </span><span class="hs-comment">-- is if you take apart this case expression, and pass a</span><span>
</span><a name="line-184"></a><span>        </span><span class="hs-comment">-- fragment of it as the fun part of a 'mk_val_app'.</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-comment">-----------</span><span>
</span><a name="line-187"></a><span class="hs-identifier">mkWildEvBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>
</span><a name="line-188"></a><a name="mkWildEvBinder"><a href="MkCore.html#mkWildEvBinder"><span class="hs-identifier">mkWildEvBinder</span></a></a><span> </span><a name="local-6989586621684659808"><a href="#local-6989586621684659808"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkWildValBinder"><span class="hs-identifier hs-var">mkWildValBinder</span></a><span> </span><a href="#local-6989586621684659808"><span class="hs-identifier hs-var">pred</span></a><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-comment">-- | Make a /wildcard binder/. This is typically used when you need a binder</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- that you expect to use only at a *binding* site.  Do not use it at</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- occurrence sites because it has a single, fixed unique, and it's very</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- easy to get into difficulties with shadowing.  That's why it is used so little.</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- See Note [WildCard binders] in SimplEnv</span><span>
</span><a name="line-195"></a><span class="hs-identifier">mkWildValBinder</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-196"></a><a name="mkWildValBinder"><a href="MkCore.html#mkWildValBinder"><span class="hs-identifier">mkWildValBinder</span></a></a><span> </span><a name="local-6989586621684659809"><a href="#local-6989586621684659809"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkLocalIdOrCoVar"><span class="hs-identifier hs-var">mkLocalIdOrCoVar</span></a><span> </span><a href="PrelNames.html#wildCardName"><span class="hs-identifier hs-var">wildCardName</span></a><span> </span><a href="#local-6989586621684659809"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-identifier">mkWildCase</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreAlt"><span class="hs-identifier hs-type">CoreAlt</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-199"></a><span class="hs-comment">-- Make a case expression whose case binder is unused</span><span>
</span><a name="line-200"></a><span class="hs-comment">-- The alts should not have any occurrences of WildId</span><span>
</span><a name="line-201"></a><a name="mkWildCase"><a href="MkCore.html#mkWildCase"><span class="hs-identifier">mkWildCase</span></a></a><span> </span><a name="local-6989586621684659810"><a href="#local-6989586621684659810"><span class="hs-identifier">scrut</span></a></a><span> </span><a name="local-6989586621684659811"><a href="#local-6989586621684659811"><span class="hs-identifier">scrut_ty</span></a></a><span> </span><a name="local-6989586621684659812"><a href="#local-6989586621684659812"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-6989586621684659813"><a href="#local-6989586621684659813"><span class="hs-identifier">alts</span></a></a><span>
</span><a name="line-202"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Case"><span class="hs-identifier hs-var">Case</span></a><span> </span><a href="#local-6989586621684659810"><span class="hs-identifier hs-var">scrut</span></a><span> </span><span class="hs-special">(</span><a href="MkCore.html#mkWildValBinder"><span class="hs-identifier hs-var">mkWildValBinder</span></a><span> </span><a href="#local-6989586621684659811"><span class="hs-identifier hs-var">scrut_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659812"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><a href="#local-6989586621684659813"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-identifier">mkIfThenElse</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-205"></a><a name="mkIfThenElse"><a href="MkCore.html#mkIfThenElse"><span class="hs-identifier">mkIfThenElse</span></a></a><span> </span><a name="local-6989586621684659814"><a href="#local-6989586621684659814"><span class="hs-identifier">guard</span></a></a><span> </span><a name="local-6989586621684659815"><a href="#local-6989586621684659815"><span class="hs-identifier">then_expr</span></a></a><span> </span><a name="local-6989586621684659816"><a href="#local-6989586621684659816"><span class="hs-identifier">else_expr</span></a></a><span>
</span><a name="line-206"></a><span class="hs-comment">-- Not going to be refining, so okay to take the type of the &quot;then&quot; clause</span><span>
</span><a name="line-207"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkWildCase"><span class="hs-identifier hs-var">mkWildCase</span></a><span> </span><a href="#local-6989586621684659814"><span class="hs-identifier hs-var">guard</span></a><span> </span><a href="TysWiredIn.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621684659815"><span class="hs-identifier hs-var">then_expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>         </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="TysWiredIn.html#falseDataCon"><span class="hs-identifier hs-var">falseDataCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659816"><span class="hs-identifier hs-var">else_expr</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- Increasing order of tag!</span><span>
</span><a name="line-209"></a><span>           </span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><a href="TysWiredIn.html#trueDataCon"><span class="hs-identifier hs-var">trueDataCon</span></a><span class="hs-special">,</span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659815"><span class="hs-identifier hs-var">then_expr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-identifier">castBottomExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-212"></a><span class="hs-comment">-- (castBottomExpr e ty), assuming that 'e' diverges,</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- return an expression of type 'ty'</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- See Note [Empty case alternatives] in CoreSyn</span><span>
</span><a name="line-215"></a><a name="castBottomExpr"><a href="MkCore.html#castBottomExpr"><span class="hs-identifier">castBottomExpr</span></a></a><span> </span><a name="local-6989586621684659817"><a href="#local-6989586621684659817"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621684659818"><a href="#local-6989586621684659818"><span class="hs-identifier">res_ty</span></a></a><span>
</span><a name="line-216"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659819"><span class="hs-identifier hs-var">e_ty</span></a><span> </span><span class="hs-special">`</span><a href="Type.html#eqType"><span class="hs-identifier hs-var">eqType</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659818"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659817"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-217"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Case"><span class="hs-identifier hs-var">Case</span></a><span> </span><a href="#local-6989586621684659817"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">(</span><a href="MkCore.html#mkWildValBinder"><span class="hs-identifier hs-var">mkWildValBinder</span></a><span> </span><a href="#local-6989586621684659819"><span class="hs-identifier hs-var">e_ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659818"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-218"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-219"></a><span>    </span><a name="local-6989586621684659819"><a href="#local-6989586621684659819"><span class="hs-identifier">e_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621684659817"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-comment">{-
The functions from this point don't really do anything cleverer than
their counterparts in CoreSyn, but they are here for consistency
-}</span><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span class="hs-comment">-- | Create a lambda where the given expression has a number of variables</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- bound over it. The leftmost binder is that bound by the outermost</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- lambda in the result</span><span>
</span><a name="line-229"></a><span class="hs-identifier">mkCoreLams</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreBndr"><span class="hs-identifier hs-type">CoreBndr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-230"></a><a name="mkCoreLams"><a href="MkCore.html#mkCoreLams"><span class="hs-identifier">mkCoreLams</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Making literals}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to the given @Int@</span><span>
</span><a name="line-241"></a><span class="hs-identifier">mkIntExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>        </span><span class="hs-comment">-- Result = I# i :: Int</span><span>
</span><a name="line-242"></a><a name="mkIntExpr"><a href="MkCore.html#mkIntExpr"><span class="hs-identifier">mkIntExpr</span></a></a><span> </span><a name="local-6989586621684659820"><a href="#local-6989586621684659820"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659821"><a href="#local-6989586621684659821"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><a href="TysWiredIn.html#intDataCon"><span class="hs-identifier hs-var">intDataCon</span></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#mkIntLit"><span class="hs-identifier hs-var">mkIntLit</span></a><span> </span><a href="#local-6989586621684659820"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659821"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">]</span><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to the given @Int@</span><span>
</span><a name="line-245"></a><span class="hs-identifier">mkIntExprInt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>         </span><span class="hs-comment">-- Result = I# i :: Int</span><span>
</span><a name="line-246"></a><a name="mkIntExprInt"><a href="MkCore.html#mkIntExprInt"><span class="hs-identifier">mkIntExprInt</span></a></a><span> </span><a name="local-6989586621684659822"><a href="#local-6989586621684659822"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659823"><a href="#local-6989586621684659823"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><a href="TysWiredIn.html#intDataCon"><span class="hs-identifier hs-var">intDataCon</span></a><span>  </span><span class="hs-special">[</span><a href="CoreSyn.html#mkIntLitInt"><span class="hs-identifier hs-var">mkIntLitInt</span></a><span> </span><a href="#local-6989586621684659822"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659823"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">]</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to the a @Word@ with the given value</span><span>
</span><a name="line-249"></a><span class="hs-identifier">mkWordExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-250"></a><a name="mkWordExpr"><a href="MkCore.html#mkWordExpr"><span class="hs-identifier">mkWordExpr</span></a></a><span> </span><a name="local-6989586621684659824"><a href="#local-6989586621684659824"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659825"><a href="#local-6989586621684659825"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><a href="TysWiredIn.html#wordDataCon"><span class="hs-identifier hs-var">wordDataCon</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#mkWordLit"><span class="hs-identifier hs-var">mkWordLit</span></a><span> </span><a href="#local-6989586621684659824"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659825"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">]</span><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to the given @Word@</span><span>
</span><a name="line-253"></a><span class="hs-identifier">mkWordExprWord</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-254"></a><a name="mkWordExprWord"><a href="MkCore.html#mkWordExprWord"><span class="hs-identifier">mkWordExprWord</span></a></a><span> </span><a name="local-6989586621684659826"><a href="#local-6989586621684659826"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659827"><a href="#local-6989586621684659827"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><a href="TysWiredIn.html#wordDataCon"><span class="hs-identifier hs-var">wordDataCon</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#mkWordLitWord"><span class="hs-identifier hs-var">mkWordLitWord</span></a><span> </span><a href="#local-6989586621684659826"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659827"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">]</span><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to the given @Integer@</span><span>
</span><a name="line-257"></a><span class="hs-identifier">mkIntegerExpr</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a><span> </span><a href="#local-6989586621684659769"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659769"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>  </span><span class="hs-comment">-- Result :: Integer</span><span>
</span><a name="line-258"></a><a name="mkIntegerExpr"><a href="MkCore.html#mkIntegerExpr"><span class="hs-identifier">mkIntegerExpr</span></a></a><span> </span><a name="local-6989586621684659828"><a href="#local-6989586621684659828"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659829"><a href="#local-6989586621684659829"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#lookupTyCon"><span class="hs-identifier hs-var">lookupTyCon</span></a><span> </span><a href="PrelNames.html#integerTyConName"><span class="hs-identifier hs-var">integerTyConName</span></a><span>
</span><a name="line-259"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitInteger"><span class="hs-identifier hs-var">mkLitInteger</span></a><span> </span><a href="#local-6989586621684659828"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to the given @Natural@</span><span>
</span><a name="line-262"></a><span class="hs-identifier">mkNaturalExpr</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a><span> </span><a href="#local-6989586621684659768"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659768"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-263"></a><a name="mkNaturalExpr"><a href="MkCore.html#mkNaturalExpr"><span class="hs-identifier">mkNaturalExpr</span></a></a><span> </span><a name="local-6989586621684659830"><a href="#local-6989586621684659830"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659831"><a href="#local-6989586621684659831"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#lookupTyCon"><span class="hs-identifier hs-var">lookupTyCon</span></a><span> </span><a href="PrelNames.html#naturalTyConName"><span class="hs-identifier hs-var">naturalTyConName</span></a><span>
</span><a name="line-264"></a><span>                     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitNatural"><span class="hs-identifier hs-var">mkLitNatural</span></a><span> </span><a href="#local-6989586621684659830"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyConTy"><span class="hs-identifier hs-var">mkTyConTy</span></a><span> </span><a href="#local-6989586621684659831"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to the given @Float@</span><span>
</span><a name="line-267"></a><span class="hs-identifier">mkFloatExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Float</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-268"></a><a name="mkFloatExpr"><a href="MkCore.html#mkFloatExpr"><span class="hs-identifier">mkFloatExpr</span></a></a><span> </span><a name="local-6989586621684659832"><a href="#local-6989586621684659832"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><a href="TysWiredIn.html#floatDataCon"><span class="hs-identifier hs-var">floatDataCon</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#mkFloatLitFloat"><span class="hs-identifier hs-var">mkFloatLitFloat</span></a><span> </span><a href="#local-6989586621684659832"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">]</span><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to the given @Double@</span><span>
</span><a name="line-271"></a><span class="hs-identifier">mkDoubleExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-272"></a><a name="mkDoubleExpr"><a href="MkCore.html#mkDoubleExpr"><span class="hs-identifier">mkDoubleExpr</span></a></a><span> </span><a name="local-6989586621684659833"><a href="#local-6989586621684659833"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><a href="TysWiredIn.html#doubleDataCon"><span class="hs-identifier hs-var">doubleDataCon</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#mkDoubleLitDouble"><span class="hs-identifier hs-var">mkDoubleLitDouble</span></a><span> </span><a href="#local-6989586621684659833"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">]</span><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to the given @Char@</span><span>
</span><a name="line-276"></a><span class="hs-identifier">mkCharExpr</span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Char</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>      </span><span class="hs-comment">-- Result = C# c :: Int</span><span>
</span><a name="line-277"></a><a name="mkCharExpr"><a href="MkCore.html#mkCharExpr"><span class="hs-identifier">mkCharExpr</span></a></a><span> </span><a name="local-6989586621684659834"><a href="#local-6989586621684659834"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><a href="TysWiredIn.html#charDataCon"><span class="hs-identifier hs-var">charDataCon</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#mkCharLit"><span class="hs-identifier hs-var">mkCharLit</span></a><span> </span><a href="#local-6989586621684659834"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to the given @String@</span><span>
</span><a name="line-280"></a><span class="hs-identifier">mkStringExpr</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a><span> </span><a href="#local-6989586621684659767"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659767"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>  </span><span class="hs-comment">-- Result :: String</span><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-comment">-- | Create a 'CoreExpr' which will evaluate to a string morally equivalent to the given @FastString@</span><span>
</span><a name="line-283"></a><span class="hs-identifier">mkStringExprFS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a><span> </span><a href="#local-6989586621684659766"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659766"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>  </span><span class="hs-comment">-- Result :: String</span><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><a name="mkStringExpr"><a href="MkCore.html#mkStringExpr"><span class="hs-identifier">mkStringExpr</span></a></a><span> </span><a name="local-6989586621684659835"><a href="#local-6989586621684659835"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkStringExprFS"><span class="hs-identifier hs-var">mkStringExprFS</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a><span> </span><a href="#local-6989586621684659835"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><a name="mkStringExprFS"><a href="MkCore.html#mkStringExprFS"><span class="hs-identifier">mkStringExprFS</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkStringExprFSWith"><span class="hs-identifier hs-var">mkStringExprFSWith</span></a><span> </span><a href="HscTypes.html#lookupId"><span class="hs-identifier hs-var">lookupId</span></a><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span class="hs-identifier">mkStringExprFSWith</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621684659765"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659765"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659765"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-290"></a><a name="mkStringExprFSWith"><a href="MkCore.html#mkStringExprFSWith"><span class="hs-identifier">mkStringExprFSWith</span></a></a><span> </span><a name="local-6989586621684659836"><a href="#local-6989586621684659836"><span class="hs-identifier">lookupM</span></a></a><span> </span><a name="local-6989586621684659837"><a href="#local-6989586621684659837"><span class="hs-identifier">str</span></a></a><span>
</span><a name="line-291"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="FastString.html#nullFS"><span class="hs-identifier hs-var">nullFS</span></a><span> </span><a href="#local-6989586621684659837"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-292"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="MkCore.html#mkNilExpr"><span class="hs-identifier hs-var">mkNilExpr</span></a><span> </span><a href="TysWiredIn.html#charTy"><span class="hs-identifier hs-var">charTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="#local-6989586621684659839"><span class="hs-identifier hs-var">safeChar</span></a><span> </span><a href="#local-6989586621684659838"><span class="hs-identifier hs-var">chars</span></a><span>
</span><a name="line-295"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659842"><a href="#local-6989586621684659842"><span class="hs-identifier">unpack_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659836"><span class="hs-identifier hs-var">lookupM</span></a><span> </span><a href="PrelNames.html#unpackCStringName"><span class="hs-identifier hs-var">unpackCStringName</span></a><span>
</span><a name="line-296"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659842"><span class="hs-identifier hs-var">unpack_id</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659840"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-299"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659843"><a href="#local-6989586621684659843"><span class="hs-identifier">unpack_utf8_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659836"><span class="hs-identifier hs-var">lookupM</span></a><span> </span><a href="PrelNames.html#unpackCStringUtf8Name"><span class="hs-identifier hs-var">unpackCStringUtf8Name</span></a><span>
</span><a name="line-300"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659843"><span class="hs-identifier hs-var">unpack_utf8_id</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659840"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-303"></a><span>    </span><a name="local-6989586621684659838"><a href="#local-6989586621684659838"><span class="hs-identifier">chars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a><span> </span><a href="#local-6989586621684659837"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-304"></a><span>    </span><a name="local-6989586621684659839"><a href="#local-6989586621684659839"><span class="hs-identifier">safeChar</span></a></a><span> </span><a name="local-6989586621684659841"><a href="#local-6989586621684659841"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621684659841"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">ord</span><span> </span><a href="#local-6989586621684659841"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x7F</span><span>
</span><a name="line-305"></a><span>    </span><a name="local-6989586621684659840"><a href="#local-6989586621684659840"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#LitString"><span class="hs-identifier hs-var">LitString</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fastStringToByteString"><span class="hs-identifier hs-var">fastStringToByteString</span></a><span> </span><a href="#local-6989586621684659837"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Tuple constructors}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-314"></a><span>
</span><a name="line-315"></a><span class="hs-comment">{-
Creating tuples and their types for Core expressions

@mkBigCoreVarTup@ builds a tuple; the inverse to @mkTupleSelector@.

* If it has only one element, it is the identity function.

* If there are more elements than a big tuple can have, it nests
  the tuples.

Note [Flattening one-tuples]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This family of functions creates a tuple of variables/expressions/types.
  mkCoreTup [e1,e2,e3] = (e1,e2,e3)
What if there is just one variable/expression/type in the argument?
We could do one of two things:

* Flatten it out, so that
    mkCoreTup [e1] = e1

* Build a one-tuple (see Note [One-tuples] in TysWiredIn)
    mkCoreTup1 [e1] = Unit e1
  We use a suffix &quot;1&quot; to indicate this.

Usually we want the former, but occasionally the latter.
-}</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-comment">-- | Build a small tuple holding the specified variables</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- One-tuples are flattened; see Note [Flattening one-tuples]</span><span>
</span><a name="line-344"></a><span class="hs-identifier">mkCoreVarTup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-345"></a><a name="mkCoreVarTup"><a href="MkCore.html#mkCoreVarTup"><span class="hs-identifier">mkCoreVarTup</span></a></a><span> </span><a name="local-6989586621684659844"><a href="#local-6989586621684659844"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreTup"><span class="hs-identifier hs-var">mkCoreTup</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659844"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">)</span><span>
</span><a name="line-346"></a><span>
</span><a name="line-347"></a><span class="hs-comment">-- | Build the type of a small tuple that holds the specified variables</span><span>
</span><a name="line-348"></a><span class="hs-comment">-- One-tuples are flattened; see Note [Flattening one-tuples]</span><span>
</span><a name="line-349"></a><span class="hs-identifier">mkCoreVarTupTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-350"></a><a name="mkCoreVarTupTy"><a href="MkCore.html#mkCoreVarTupTy"><span class="hs-identifier">mkCoreVarTupTy</span></a></a><span> </span><a name="local-6989586621684659845"><a href="#local-6989586621684659845"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#mkBoxedTupleTy"><span class="hs-identifier hs-var">mkBoxedTupleTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684659845"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">)</span><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span class="hs-comment">-- | Build a small tuple holding the specified expressions</span><span>
</span><a name="line-353"></a><span class="hs-comment">-- One-tuples are flattened; see Note [Flattening one-tuples]</span><span>
</span><a name="line-354"></a><span class="hs-identifier">mkCoreTup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-355"></a><a name="mkCoreTup"><a href="MkCore.html#mkCoreTup"><span class="hs-identifier">mkCoreTup</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="TysWiredIn.html#unitDataConId"><span class="hs-identifier hs-var">unitDataConId</span></a><span>
</span><a name="line-356"></a><span class="hs-identifier">mkCoreTup</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659846"><a href="#local-6989586621684659846"><span class="hs-identifier">c</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659846"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-357"></a><span class="hs-identifier">mkCoreTup</span><span> </span><a name="local-6989586621684659847"><a href="#local-6989586621684659847"><span class="hs-identifier">cs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a><span> </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684659847"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-358"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659847"><span class="hs-identifier hs-var">cs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684659847"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>
</span><a name="line-360"></a><span class="hs-comment">-- | Build a small unboxed tuple holding the specified expressions,</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- with the given types. The types must be the types of the expressions.</span><span>
</span><a name="line-362"></a><span class="hs-comment">-- Do not include the RuntimeRep specifiers; this function calculates them</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- for you.</span><span>
</span><a name="line-364"></a><span class="hs-comment">-- Does /not/ flatten one-tuples; see Note [Flattening one-tuples]</span><span>
</span><a name="line-365"></a><span class="hs-identifier">mkCoreUbxTup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-366"></a><a name="mkCoreUbxTup"><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier">mkCoreUbxTup</span></a></a><span> </span><a name="local-6989586621684659848"><a href="#local-6989586621684659848"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621684659849"><a href="#local-6989586621684659849"><span class="hs-identifier">exps</span></a></a><span>
</span><a name="line-367"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><a href="Util.html#equalLength"><span class="hs-identifier hs-var">exps</span></a><span class="hs-special">)</span><span>
</span><a name="line-368"></a><span>    </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a><span> </span><a href="BasicTypes.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684659848"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-369"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659848"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659848"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684659849"><span class="hs-identifier hs-var">exps</span></a><span class="hs-special">)</span><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">-- | Make a core tuple of the given boxity</span><span>
</span><a name="line-372"></a><span class="hs-identifier">mkCoreTupBoxity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BasicTypes.html#Boxity"><span class="hs-identifier hs-type">Boxity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-373"></a><a name="mkCoreTupBoxity"><a href="MkCore.html#mkCoreTupBoxity"><span class="hs-identifier">mkCoreTupBoxity</span></a></a><span> </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span>   </span><a name="local-6989586621684659850"><a href="#local-6989586621684659850"><span class="hs-identifier">exps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreTup"><span class="hs-identifier hs-var">mkCoreTup</span></a><span> </span><a href="#local-6989586621684659850"><span class="hs-identifier hs-var">exps</span></a><span>
</span><a name="line-374"></a><span class="hs-identifier">mkCoreTupBoxity</span><span> </span><a href="BasicTypes.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a><span> </span><a name="local-6989586621684659851"><a href="#local-6989586621684659851"><span class="hs-identifier">exps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreUbxTup"><span class="hs-identifier hs-var">mkCoreUbxTup</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621684659851"><span class="hs-identifier hs-var">exps</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659851"><span class="hs-identifier hs-var">exps</span></a><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-comment">-- | Build a big tuple holding the specified variables</span><span>
</span><a name="line-377"></a><span class="hs-comment">-- One-tuples are flattened; see Note [Flattening one-tuples]</span><span>
</span><a name="line-378"></a><span class="hs-identifier">mkBigCoreVarTup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-379"></a><a name="mkBigCoreVarTup"><a href="MkCore.html#mkBigCoreVarTup"><span class="hs-identifier">mkBigCoreVarTup</span></a></a><span> </span><a name="local-6989586621684659852"><a href="#local-6989586621684659852"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkBigCoreTup"><span class="hs-identifier hs-var">mkBigCoreTup</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659852"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span class="hs-identifier">mkBigCoreVarTup1</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-382"></a><span class="hs-comment">-- Same as mkBigCoreVarTup, but one-tuples are NOT flattened</span><span>
</span><a name="line-383"></a><span class="hs-comment">--                          see Note [Flattening one-tuples]</span><span>
</span><a name="line-384"></a><a name="mkBigCoreVarTup1"><a href="MkCore.html#mkBigCoreVarTup1"><span class="hs-identifier">mkBigCoreVarTup1</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659853"><a href="#local-6989586621684659853"><span class="hs-identifier">id</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a><span> </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-385"></a><span>                                      </span><span class="hs-special">[</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684659853"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659853"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">]</span><span>
</span><a name="line-386"></a><span class="hs-identifier">mkBigCoreVarTup1</span><span> </span><a name="local-6989586621684659854"><a href="#local-6989586621684659854"><span class="hs-identifier">ids</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkBigCoreTup"><span class="hs-identifier hs-var">mkBigCoreTup</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659854"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span class="hs-comment">-- | Build the type of a big tuple that holds the specified variables</span><span>
</span><a name="line-389"></a><span class="hs-comment">-- One-tuples are flattened; see Note [Flattening one-tuples]</span><span>
</span><a name="line-390"></a><span class="hs-identifier">mkBigCoreVarTupTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-391"></a><a name="mkBigCoreVarTupTy"><a href="MkCore.html#mkBigCoreVarTupTy"><span class="hs-identifier">mkBigCoreVarTupTy</span></a></a><span> </span><a name="local-6989586621684659855"><a href="#local-6989586621684659855"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkBigCoreTupTy"><span class="hs-identifier hs-var">mkBigCoreTupTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684659855"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">)</span><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span class="hs-comment">-- | Build a big tuple holding the specified expressions</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- One-tuples are flattened; see Note [Flattening one-tuples]</span><span>
</span><a name="line-395"></a><span class="hs-identifier">mkBigCoreTup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-396"></a><a name="mkBigCoreTup"><a href="MkCore.html#mkBigCoreTup"><span class="hs-identifier">mkBigCoreTup</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#mkChunkified"><span class="hs-identifier hs-var">mkChunkified</span></a><span> </span><a href="MkCore.html#mkCoreTup"><span class="hs-identifier hs-var">mkCoreTup</span></a><span>
</span><a name="line-397"></a><span>
</span><a name="line-398"></a><span class="hs-comment">-- | Build the type of a big tuple that holds the specified type of thing</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- One-tuples are flattened; see Note [Flattening one-tuples]</span><span>
</span><a name="line-400"></a><span class="hs-identifier">mkBigCoreTupTy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-401"></a><a name="mkBigCoreTupTy"><a href="MkCore.html#mkBigCoreTupTy"><span class="hs-identifier">mkBigCoreTupTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsUtils.html#mkChunkified"><span class="hs-identifier hs-var">mkChunkified</span></a><span> </span><a href="TysWiredIn.html#mkBoxedTupleTy"><span class="hs-identifier hs-var">mkBoxedTupleTy</span></a><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span class="hs-comment">-- | The unit expression</span><span>
</span><a name="line-404"></a><span class="hs-identifier">unitExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-405"></a><a name="unitExpr"><a href="MkCore.html#unitExpr"><span class="hs-identifier">unitExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="TysWiredIn.html#unitDataConId"><span class="hs-identifier hs-var">unitDataConId</span></a><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Tuple destructors}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><span class="hs-comment">-- | Builds a selector which scrutises the given</span><span>
</span><a name="line-416"></a><span class="hs-comment">-- expression and extracts the one name from the list given.</span><span>
</span><a name="line-417"></a><span class="hs-comment">-- If you want the no-shadowing rule to apply, the caller</span><span>
</span><a name="line-418"></a><span class="hs-comment">-- is responsible for making sure that none of these names</span><span>
</span><a name="line-419"></a><span class="hs-comment">-- are in scope.</span><span>
</span><a name="line-420"></a><span class="hs-comment">--</span><span>
</span><a name="line-421"></a><span class="hs-comment">-- If there is just one 'Id' in the tuple, then the selector is</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- just the identity.</span><span>
</span><a name="line-423"></a><span class="hs-comment">--</span><span>
</span><a name="line-424"></a><span class="hs-comment">-- If necessary, we pattern match on a \&quot;big\&quot; tuple.</span><span>
</span><a name="line-425"></a><span class="hs-identifier">mkTupleSelector</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkTupleSelector1</span><span>
</span><a name="line-426"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- ^ The 'Id's to pattern match the tuple against</span><span>
</span><a name="line-427"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>           </span><span class="hs-comment">-- ^ The 'Id' to select</span><span>
</span><a name="line-428"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>           </span><span class="hs-comment">-- ^ A variable of the same type as the scrutinee</span><span>
</span><a name="line-429"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>     </span><span class="hs-comment">-- ^ Scrutinee</span><span>
</span><a name="line-430"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>     </span><span class="hs-comment">-- ^ Selector expression</span><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">-- mkTupleSelector [a,b,c,d] b v e</span><span>
</span><a name="line-433"></a><span class="hs-comment">--          = case e of v {</span><span>
</span><a name="line-434"></a><span class="hs-comment">--                (p,q) -&gt; case p of p {</span><span>
</span><a name="line-435"></a><span class="hs-comment">--                           (a,b) -&gt; b }}</span><span>
</span><a name="line-436"></a><span class="hs-comment">-- We use 'tpl' vars for the p,q, since shadowing does not matter.</span><span>
</span><a name="line-437"></a><span class="hs-comment">--</span><span>
</span><a name="line-438"></a><span class="hs-comment">-- In fact, it's more convenient to generate it innermost first, getting</span><span>
</span><a name="line-439"></a><span class="hs-comment">--</span><span>
</span><a name="line-440"></a><span class="hs-comment">--        case (case e of v</span><span>
</span><a name="line-441"></a><span class="hs-comment">--                (p,q) -&gt; p) of p</span><span>
</span><a name="line-442"></a><span class="hs-comment">--          (a,b) -&gt; b</span><span>
</span><a name="line-443"></a><a name="mkTupleSelector"><a href="MkCore.html#mkTupleSelector"><span class="hs-identifier">mkTupleSelector</span></a></a><span> </span><a name="local-6989586621684659856"><a href="#local-6989586621684659856"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621684659857"><a href="#local-6989586621684659857"><span class="hs-identifier">the_var</span></a></a><span> </span><a name="local-6989586621684659858"><a href="#local-6989586621684659858"><span class="hs-identifier">scrut_var</span></a></a><span> </span><a name="local-6989586621684659859"><a href="#local-6989586621684659859"><span class="hs-identifier">scrut</span></a></a><span>
</span><a name="line-444"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659860"><span class="hs-identifier hs-var">mk_tup_sel</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#chunkify"><span class="hs-identifier hs-var">chunkify</span></a><span> </span><a href="#local-6989586621684659856"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659857"><span class="hs-identifier hs-var">the_var</span></a><span>
</span><a name="line-445"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-446"></a><span>    </span><a name="local-6989586621684659860"><a href="#local-6989586621684659860"><span class="hs-identifier">mk_tup_sel</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659861"><a href="#local-6989586621684659861"><span class="hs-identifier">vars</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659862"><a href="#local-6989586621684659862"><span class="hs-identifier">the_var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkSmallTupleSelector"><span class="hs-identifier hs-var">mkSmallTupleSelector</span></a><span> </span><a href="#local-6989586621684659861"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621684659862"><span class="hs-identifier hs-var">the_var</span></a><span> </span><a href="#local-6989586621684659858"><span class="hs-identifier hs-var">scrut_var</span></a><span> </span><a href="#local-6989586621684659859"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-447"></a><span>    </span><span class="hs-identifier">mk_tup_sel</span><span> </span><a name="local-6989586621684659863"><a href="#local-6989586621684659863"><span class="hs-identifier">vars_s</span></a></a><span> </span><a name="local-6989586621684659864"><a href="#local-6989586621684659864"><span class="hs-identifier">the_var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkSmallTupleSelector"><span class="hs-identifier hs-var">mkSmallTupleSelector</span></a><span> </span><a href="#local-6989586621684659868"><span class="hs-identifier hs-var">group</span></a><span> </span><a href="#local-6989586621684659864"><span class="hs-identifier hs-var">the_var</span></a><span> </span><a href="#local-6989586621684659867"><span class="hs-identifier hs-var">tpl_v</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-448"></a><span>                                </span><a href="#local-6989586621684659860"><span class="hs-identifier hs-var">mk_tup_sel</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#chunkify"><span class="hs-identifier hs-var">chunkify</span></a><span> </span><a href="#local-6989586621684659866"><span class="hs-identifier hs-var">tpl_vs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659867"><span class="hs-identifier hs-var">tpl_v</span></a><span>
</span><a name="line-449"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-450"></a><span>          </span><a name="local-6989586621684659865"><a href="#local-6989586621684659865"><span class="hs-identifier">tpl_tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="TysWiredIn.html#mkBoxedTupleTy"><span class="hs-identifier hs-var">mkBoxedTupleTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684659869"><span class="hs-identifier hs-var">gp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621684659869"><a href="#local-6989586621684659869"><span class="hs-identifier">gp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659863"><span class="hs-identifier hs-var">vars_s</span></a><span class="hs-special">]</span><span>
</span><a name="line-451"></a><span>          </span><a name="local-6989586621684659866"><a href="#local-6989586621684659866"><span class="hs-identifier">tpl_vs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkTemplateLocals"><span class="hs-identifier hs-var">mkTemplateLocals</span></a><span> </span><a href="#local-6989586621684659865"><span class="hs-identifier hs-var">tpl_tys</span></a><span>
</span><a name="line-452"></a><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><a name="local-6989586621684659867"><a href="#local-6989586621684659867"><span class="hs-identifier">tpl_v</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659868"><a href="#local-6989586621684659868"><span class="hs-identifier">group</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621684659870"><span class="hs-identifier hs-var">tpl</span></a><span class="hs-special">,</span><a href="#local-6989586621684659871"><span class="hs-identifier hs-var">gp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659870"><a href="#local-6989586621684659870"><span class="hs-identifier">tpl</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659871"><a href="#local-6989586621684659871"><span class="hs-identifier">gp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Util.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a><span> </span><span class="hs-string">&quot;mkTupleSelector&quot;</span><span> </span><a href="#local-6989586621684659866"><span class="hs-identifier hs-var">tpl_vs</span></a><span> </span><a href="#local-6989586621684659863"><span class="hs-identifier hs-var">vars_s</span></a><span class="hs-special">,</span><span>
</span><a name="line-453"></a><span>                                         </span><a href="#local-6989586621684659864"><span class="hs-identifier hs-var">the_var</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659871"><span class="hs-identifier hs-var">gp</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-454"></a><span class="hs-comment">-- ^ 'mkTupleSelector1' is like 'mkTupleSelector'</span><span>
</span><a name="line-455"></a><span class="hs-comment">-- but one-tuples are NOT flattened (see Note [Flattening one-tuples])</span><span>
</span><a name="line-456"></a><a name="mkTupleSelector1"><a href="MkCore.html#mkTupleSelector1"><span class="hs-identifier">mkTupleSelector1</span></a></a><span> </span><a name="local-6989586621684659872"><a href="#local-6989586621684659872"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621684659873"><a href="#local-6989586621684659873"><span class="hs-identifier">the_var</span></a></a><span> </span><a name="local-6989586621684659874"><a href="#local-6989586621684659874"><span class="hs-identifier">scrut_var</span></a></a><span> </span><a name="local-6989586621684659875"><a href="#local-6989586621684659875"><span class="hs-identifier">scrut</span></a></a><span>
</span><a name="line-457"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">_</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659872"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-458"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkSmallTupleSelector1"><span class="hs-identifier hs-var">mkSmallTupleSelector1</span></a><span> </span><a href="#local-6989586621684659872"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621684659873"><span class="hs-identifier hs-var">the_var</span></a><span> </span><a href="#local-6989586621684659874"><span class="hs-identifier hs-var">scrut_var</span></a><span> </span><a href="#local-6989586621684659875"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-459"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-460"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkTupleSelector"><span class="hs-identifier hs-var">mkTupleSelector</span></a><span> </span><a href="#local-6989586621684659872"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621684659873"><span class="hs-identifier hs-var">the_var</span></a><span> </span><a href="#local-6989586621684659874"><span class="hs-identifier hs-var">scrut_var</span></a><span> </span><a href="#local-6989586621684659875"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-461"></a><span>
</span><a name="line-462"></a><span class="hs-comment">-- | Like 'mkTupleSelector' but for tuples that are guaranteed</span><span>
</span><a name="line-463"></a><span class="hs-comment">-- never to be \&quot;big\&quot;.</span><span>
</span><a name="line-464"></a><span class="hs-comment">--</span><span>
</span><a name="line-465"></a><span class="hs-comment">-- &gt; mkSmallTupleSelector [x] x v e = [| e |]</span><span>
</span><a name="line-466"></a><span class="hs-comment">-- &gt; mkSmallTupleSelector [x,y,z] x v e = [| case e of v { (x,y,z) -&gt; x } |]</span><span>
</span><a name="line-467"></a><span class="hs-identifier">mkSmallTupleSelector</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkSmallTupleSelector1</span><span>
</span><a name="line-468"></a><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- The tuple args</span><span>
</span><a name="line-469"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>          </span><span class="hs-comment">-- The selected one</span><span>
</span><a name="line-470"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>          </span><span class="hs-comment">-- A variable of the same type as the scrutinee</span><span>
</span><a name="line-471"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>    </span><span class="hs-comment">-- Scrutinee</span><span>
</span><a name="line-472"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-473"></a><a name="mkSmallTupleSelector"><a href="MkCore.html#mkSmallTupleSelector"><span class="hs-identifier">mkSmallTupleSelector</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659876"><a href="#local-6989586621684659876"><span class="hs-identifier">var</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659877"><a href="#local-6989586621684659877"><span class="hs-identifier">should_be_the_same_var</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659878"><a href="#local-6989586621684659878"><span class="hs-identifier">scrut</span></a></a><span>
</span><a name="line-474"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">should_be_the_same_var</span><span class="hs-special">)</span><span>
</span><a name="line-475"></a><span>    </span><a href="#local-6989586621684659878"><span class="hs-identifier hs-var">scrut</span></a><span>  </span><span class="hs-comment">-- Special case for 1-tuples</span><span>
</span><a name="line-476"></a><span class="hs-identifier">mkSmallTupleSelector</span><span> </span><a name="local-6989586621684659879"><a href="#local-6989586621684659879"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621684659880"><a href="#local-6989586621684659880"><span class="hs-identifier">the_var</span></a></a><span> </span><a name="local-6989586621684659881"><a href="#local-6989586621684659881"><span class="hs-identifier">scrut_var</span></a></a><span> </span><a name="local-6989586621684659882"><a href="#local-6989586621684659882"><span class="hs-identifier">scrut</span></a></a><span>
</span><a name="line-477"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkSmallTupleSelector1"><span class="hs-identifier hs-var">mkSmallTupleSelector1</span></a><span> </span><a href="#local-6989586621684659879"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621684659880"><span class="hs-identifier hs-var">the_var</span></a><span> </span><a href="#local-6989586621684659881"><span class="hs-identifier hs-var">scrut_var</span></a><span> </span><a href="#local-6989586621684659882"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><span class="hs-comment">-- ^ 'mkSmallTupleSelector1' is like 'mkSmallTupleSelector'</span><span>
</span><a name="line-480"></a><span class="hs-comment">-- but one-tuples are NOT flattened (see Note [Flattening one-tuples])</span><span>
</span><a name="line-481"></a><a name="mkSmallTupleSelector1"><a href="MkCore.html#mkSmallTupleSelector1"><span class="hs-identifier">mkSmallTupleSelector1</span></a></a><span> </span><a name="local-6989586621684659883"><a href="#local-6989586621684659883"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621684659884"><a href="#local-6989586621684659884"><span class="hs-identifier">the_var</span></a></a><span> </span><a name="local-6989586621684659885"><a href="#local-6989586621684659885"><span class="hs-identifier">scrut_var</span></a></a><span> </span><a name="local-6989586621684659886"><a href="#local-6989586621684659886"><span class="hs-identifier">scrut</span></a></a><span>
</span><a name="line-482"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">notNull</span><span> </span><span class="hs-identifier">vars</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-483"></a><span>    </span><a href="CoreSyn.html#Case"><span class="hs-identifier hs-var">Case</span></a><span> </span><a href="#local-6989586621684659886"><span class="hs-identifier hs-var">scrut</span></a><span> </span><a href="#local-6989586621684659885"><span class="hs-identifier hs-var">scrut_var</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684659884"><span class="hs-identifier hs-var">the_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-484"></a><span>         </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a><span> </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684659883"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659883"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659884"><span class="hs-identifier hs-var">the_var</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-485"></a><span>
</span><a name="line-486"></a><span class="hs-comment">-- | A generalization of 'mkTupleSelector', allowing the body</span><span>
</span><a name="line-487"></a><span class="hs-comment">-- of the case to be an arbitrary expression.</span><span>
</span><a name="line-488"></a><span class="hs-comment">--</span><span>
</span><a name="line-489"></a><span class="hs-comment">-- To avoid shadowing, we use uniques to invent new variables.</span><span>
</span><a name="line-490"></a><span class="hs-comment">--</span><span>
</span><a name="line-491"></a><span class="hs-comment">-- If necessary we pattern match on a \&quot;big\&quot; tuple.</span><span>
</span><a name="line-492"></a><span class="hs-identifier">mkTupleCase</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="UniqSupply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a><span>       </span><span class="hs-comment">-- ^ For inventing names of intermediate variables</span><span>
</span><a name="line-493"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>             </span><span class="hs-comment">-- ^ The tuple identifiers to pattern match on</span><span>
</span><a name="line-494"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>         </span><span class="hs-comment">-- ^ Body of the case</span><span>
</span><a name="line-495"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>               </span><span class="hs-comment">-- ^ A variable of the same type as the scrutinee</span><span>
</span><a name="line-496"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>         </span><span class="hs-comment">-- ^ Scrutinee</span><span>
</span><a name="line-497"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-498"></a><span class="hs-comment">-- ToDo: eliminate cases where none of the variables are needed.</span><span>
</span><a name="line-499"></a><span class="hs-comment">--</span><span>
</span><a name="line-500"></a><span class="hs-comment">--         mkTupleCase uniqs [a,b,c,d] body v e</span><span>
</span><a name="line-501"></a><span class="hs-comment">--           = case e of v { (p,q) -&gt;</span><span>
</span><a name="line-502"></a><span class="hs-comment">--             case p of p { (a,b) -&gt;</span><span>
</span><a name="line-503"></a><span class="hs-comment">--             case q of q { (c,d) -&gt;</span><span>
</span><a name="line-504"></a><span class="hs-comment">--             body }}}</span><span>
</span><a name="line-505"></a><a name="mkTupleCase"><a href="MkCore.html#mkTupleCase"><span class="hs-identifier">mkTupleCase</span></a></a><span> </span><a name="local-6989586621684659887"><a href="#local-6989586621684659887"><span class="hs-identifier">uniqs</span></a></a><span> </span><a name="local-6989586621684659888"><a href="#local-6989586621684659888"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621684659889"><a href="#local-6989586621684659889"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621684659890"><a href="#local-6989586621684659890"><span class="hs-identifier">scrut_var</span></a></a><span> </span><a name="local-6989586621684659891"><a href="#local-6989586621684659891"><span class="hs-identifier">scrut</span></a></a><span>
</span><a name="line-506"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659892"><span class="hs-identifier hs-var">mk_tuple_case</span></a><span> </span><a href="#local-6989586621684659887"><span class="hs-identifier hs-var">uniqs</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#chunkify"><span class="hs-identifier hs-var">chunkify</span></a><span> </span><a href="#local-6989586621684659888"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659889"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-507"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-508"></a><span>    </span><span class="hs-comment">-- This is the case where don't need any nesting</span><span>
</span><a name="line-509"></a><span>    </span><a name="local-6989586621684659892"><a href="#local-6989586621684659892"><span class="hs-identifier">mk_tuple_case</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659894"><a href="#local-6989586621684659894"><span class="hs-identifier">vars</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659895"><a href="#local-6989586621684659895"><span class="hs-identifier">body</span></a></a><span>
</span><a name="line-510"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkSmallTupleCase"><span class="hs-identifier hs-var">mkSmallTupleCase</span></a><span> </span><a href="#local-6989586621684659894"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621684659895"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="#local-6989586621684659890"><span class="hs-identifier hs-var">scrut_var</span></a><span> </span><a href="#local-6989586621684659891"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span>    </span><span class="hs-comment">-- This is the case where we must make nest tuples at least once</span><span>
</span><a name="line-513"></a><span>    </span><span class="hs-identifier">mk_tuple_case</span><span> </span><a name="local-6989586621684659896"><a href="#local-6989586621684659896"><span class="hs-identifier">us</span></a></a><span> </span><a name="local-6989586621684659897"><a href="#local-6989586621684659897"><span class="hs-identifier">vars_s</span></a></a><span> </span><a name="local-6989586621684659898"><a href="#local-6989586621684659898"><span class="hs-identifier">body</span></a></a><span>
</span><a name="line-514"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659899"><a href="#local-6989586621684659899"><span class="hs-identifier">us'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659900"><a href="#local-6989586621684659900"><span class="hs-identifier">vars'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659901"><a href="#local-6989586621684659901"><span class="hs-identifier">body'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621684659893"><span class="hs-identifier hs-var">one_tuple_case</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659896"><span class="hs-identifier hs-var">us</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659898"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659897"><span class="hs-identifier hs-var">vars_s</span></a><span>
</span><a name="line-515"></a><span>            </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621684659892"><span class="hs-identifier hs-var">mk_tuple_case</span></a><span> </span><a href="#local-6989586621684659899"><span class="hs-identifier hs-var">us'</span></a><span> </span><span class="hs-special">(</span><a href="HsUtils.html#chunkify"><span class="hs-identifier hs-var">chunkify</span></a><span> </span><a href="#local-6989586621684659900"><span class="hs-identifier hs-var">vars'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659901"><span class="hs-identifier hs-var">body'</span></a><span>
</span><a name="line-516"></a><span>
</span><a name="line-517"></a><span>    </span><a name="local-6989586621684659893"><a href="#local-6989586621684659893"><span class="hs-identifier">one_tuple_case</span></a></a><span> </span><a name="local-6989586621684659902"><a href="#local-6989586621684659902"><span class="hs-identifier">chunk_vars</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684659903"><a href="#local-6989586621684659903"><span class="hs-identifier">us</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659904"><a href="#local-6989586621684659904"><span class="hs-identifier">vs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659905"><a href="#local-6989586621684659905"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-518"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659906"><a href="#local-6989586621684659906"><span class="hs-identifier">uniq</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659907"><a href="#local-6989586621684659907"><span class="hs-identifier">us'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqSupply.html#takeUniqFromSupply"><span class="hs-identifier hs-var">takeUniqFromSupply</span></a><span> </span><a href="#local-6989586621684659903"><span class="hs-identifier hs-var">us</span></a><span>
</span><a name="line-519"></a><span>            </span><a name="local-6989586621684659908"><a href="#local-6989586621684659908"><span class="hs-identifier">scrut_var</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkSysLocal"><span class="hs-identifier hs-var">mkSysLocal</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;ds&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659906"><span class="hs-identifier hs-var">uniq</span></a><span>
</span><a name="line-520"></a><span>              </span><span class="hs-special">(</span><a href="TysWiredIn.html#mkBoxedTupleTy"><span class="hs-identifier hs-var">mkBoxedTupleTy</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684659902"><span class="hs-identifier hs-var">chunk_vars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-521"></a><span>            </span><a name="local-6989586621684659909"><a href="#local-6989586621684659909"><span class="hs-identifier">body'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkSmallTupleCase"><span class="hs-identifier hs-var">mkSmallTupleCase</span></a><span> </span><a href="#local-6989586621684659902"><span class="hs-identifier hs-var">chunk_vars</span></a><span> </span><a href="#local-6989586621684659905"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="#local-6989586621684659908"><span class="hs-identifier hs-var">scrut_var</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659908"><span class="hs-identifier hs-var">scrut_var</span></a><span class="hs-special">)</span><span>
</span><a name="line-522"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659907"><span class="hs-identifier hs-var">us'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659908"><span class="hs-identifier hs-var">scrut_var</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684659904"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659909"><span class="hs-identifier hs-var">body'</span></a><span class="hs-special">)</span><span>
</span><a name="line-523"></a><span>
</span><a name="line-524"></a><span class="hs-comment">-- | As 'mkTupleCase', but for a tuple that is small enough to be guaranteed</span><span>
</span><a name="line-525"></a><span class="hs-comment">-- not to need nesting.</span><span>
</span><a name="line-526"></a><span class="hs-identifier">mkSmallTupleCase</span><span>
</span><a name="line-527"></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- ^ The tuple args</span><span>
</span><a name="line-528"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>     </span><span class="hs-comment">-- ^ Body of the case</span><span>
</span><a name="line-529"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>           </span><span class="hs-comment">-- ^ A variable of the same type as the scrutinee</span><span>
</span><a name="line-530"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>     </span><span class="hs-comment">-- ^ Scrutinee</span><span>
</span><a name="line-531"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><a name="mkSmallTupleCase"><a href="MkCore.html#mkSmallTupleCase"><span class="hs-identifier">mkSmallTupleCase</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659910"><a href="#local-6989586621684659910"><span class="hs-identifier">var</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659911"><a href="#local-6989586621684659911"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621684659912"><a href="#local-6989586621684659912"><span class="hs-identifier">_scrut_var</span></a></a><span> </span><a name="local-6989586621684659913"><a href="#local-6989586621684659913"><span class="hs-identifier">scrut</span></a></a><span>
</span><a name="line-534"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreUtils.html#bindNonRec"><span class="hs-identifier hs-var">bindNonRec</span></a><span> </span><a href="#local-6989586621684659910"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621684659913"><span class="hs-identifier hs-var">scrut</span></a><span> </span><a href="#local-6989586621684659911"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-535"></a><span class="hs-identifier">mkSmallTupleCase</span><span> </span><a name="local-6989586621684659914"><a href="#local-6989586621684659914"><span class="hs-identifier">vars</span></a></a><span> </span><a name="local-6989586621684659915"><a href="#local-6989586621684659915"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621684659916"><a href="#local-6989586621684659916"><span class="hs-identifier">scrut_var</span></a></a><span> </span><a name="local-6989586621684659917"><a href="#local-6989586621684659917"><span class="hs-identifier">scrut</span></a></a><span>
</span><a name="line-536"></a><span class="hs-comment">-- One branch no refinement?</span><span>
</span><a name="line-537"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Case"><span class="hs-identifier hs-var">Case</span></a><span> </span><a href="#local-6989586621684659917"><span class="hs-identifier hs-var">scrut</span></a><span> </span><a href="#local-6989586621684659916"><span class="hs-identifier hs-var">scrut_var</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621684659915"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span>
</span><a name="line-538"></a><span>         </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="CoreSyn.html#DataAlt"><span class="hs-identifier hs-var">DataAlt</span></a><span> </span><span class="hs-special">(</span><a href="TysWiredIn.html#tupleDataCon"><span class="hs-identifier hs-var">tupleDataCon</span></a><span> </span><a href="BasicTypes.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684659914"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659914"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659915"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-539"></a><span>
</span><a name="line-540"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Floats
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span class="hs-keyword">data</span><span> </span><a name="FloatBind"><a href="MkCore.html#FloatBind"><span class="hs-identifier">FloatBind</span></a></a><span>
</span><a name="line-549"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="FloatLet"><a href="MkCore.html#FloatLet"><span class="hs-identifier">FloatLet</span></a></a><span>  </span><a href="CoreSyn.html#CoreBind"><span class="hs-identifier hs-type">CoreBind</span></a><span>
</span><a name="line-550"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FloatCase"><a href="MkCore.html#FloatCase"><span class="hs-identifier">FloatCase</span></a></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="CoreSyn.html#AltCon"><span class="hs-identifier hs-type">AltCon</span></a><span> </span><span class="hs-special">[</span><a href="Var.html#Var"><span class="hs-identifier hs-type">Var</span></a><span class="hs-special">]</span><span>
</span><a name="line-551"></a><span>      </span><span class="hs-comment">-- case e of y { C ys -&gt; ... }</span><span>
</span><a name="line-552"></a><span>      </span><span class="hs-comment">-- See Note [Floating single-alternative cases] in SetLevels</span><span>
</span><a name="line-553"></a><span>
</span><a name="line-554"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="MkCore.html#FloatBind"><span class="hs-identifier hs-type">FloatBind</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-555"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="MkCore.html#FloatLet"><span class="hs-identifier hs-var">FloatLet</span></a><span> </span><a name="local-6989586621684659758"><a href="#local-6989586621684659758"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;LET&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684659758"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-556"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="MkCore.html#FloatCase"><span class="hs-identifier hs-var">FloatCase</span></a><span> </span><a name="local-6989586621684659759"><a href="#local-6989586621684659759"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621684659760"><a href="#local-6989586621684659760"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621684659761"><a href="#local-6989586621684659761"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621684659762"><a href="#local-6989586621684659762"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CASE&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684659759"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a><span> </span><span class="hs-string">&quot;of&quot;</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684659760"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-557"></a><span>                                </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684659761"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684659762"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span class="hs-identifier">wrapFloat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MkCore.html#FloatBind"><span class="hs-identifier hs-type">FloatBind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-560"></a><a name="wrapFloat"><a href="MkCore.html#wrapFloat"><span class="hs-identifier">wrapFloat</span></a></a><span> </span><span class="hs-special">(</span><a href="MkCore.html#FloatLet"><span class="hs-identifier hs-var">FloatLet</span></a><span> </span><a name="local-6989586621684659918"><a href="#local-6989586621684659918"><span class="hs-identifier">defns</span></a></a><span class="hs-special">)</span><span>       </span><a name="local-6989586621684659919"><a href="#local-6989586621684659919"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Let"><span class="hs-identifier hs-var">Let</span></a><span> </span><a href="#local-6989586621684659918"><span class="hs-identifier hs-var">defns</span></a><span> </span><a href="#local-6989586621684659919"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-561"></a><span class="hs-identifier">wrapFloat</span><span> </span><span class="hs-special">(</span><a href="MkCore.html#FloatCase"><span class="hs-identifier hs-var">FloatCase</span></a><span> </span><a name="local-6989586621684659920"><a href="#local-6989586621684659920"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621684659921"><a href="#local-6989586621684659921"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621684659922"><a href="#local-6989586621684659922"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621684659923"><a href="#local-6989586621684659923"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684659924"><a href="#local-6989586621684659924"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Case"><span class="hs-identifier hs-var">Case</span></a><span> </span><a href="#local-6989586621684659920"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621684659921"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-special">(</span><a href="CoreUtils.html#exprType"><span class="hs-identifier hs-var">exprType</span></a><span> </span><a href="#local-6989586621684659924"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621684659922"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659923"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659924"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Common list manipulation expressions}
*                                                                      *
************************************************************************

Call the constructor Ids when building explicit lists, so that they
interact well with rules.
-}</span><span>
</span><a name="line-573"></a><span>
</span><a name="line-574"></a><span class="hs-comment">-- | Makes a list @[]@ for lists of the specified type</span><span>
</span><a name="line-575"></a><span class="hs-identifier">mkNilExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-576"></a><a name="mkNilExpr"><a href="MkCore.html#mkNilExpr"><span class="hs-identifier">mkNilExpr</span></a></a><span> </span><a name="local-6989586621684659925"><a href="#local-6989586621684659925"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><a href="TysWiredIn.html#nilDataCon"><span class="hs-identifier hs-var">nilDataCon</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659925"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-577"></a><span>
</span><a name="line-578"></a><span class="hs-comment">-- | Makes a list @(:)@ for lists of the specified type</span><span>
</span><a name="line-579"></a><span class="hs-identifier">mkConsExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-580"></a><a name="mkConsExpr"><a href="MkCore.html#mkConsExpr"><span class="hs-identifier">mkConsExpr</span></a></a><span> </span><a name="local-6989586621684659926"><a href="#local-6989586621684659926"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621684659927"><a href="#local-6989586621684659927"><span class="hs-identifier">hd</span></a></a><span> </span><a name="local-6989586621684659928"><a href="#local-6989586621684659928"><span class="hs-identifier">tl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkCoreConApps"><span class="hs-identifier hs-var">mkCoreConApps</span></a><span> </span><a href="TysWiredIn.html#consDataCon"><span class="hs-identifier hs-var">consDataCon</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659926"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659927"><span class="hs-identifier hs-var">hd</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659928"><span class="hs-identifier hs-var">tl</span></a><span class="hs-special">]</span><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span class="hs-comment">-- | Make a list containing the given expressions, where the list has the given type</span><span>
</span><a name="line-583"></a><span class="hs-identifier">mkListExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-584"></a><a name="mkListExpr"><a href="MkCore.html#mkListExpr"><span class="hs-identifier">mkListExpr</span></a></a><span> </span><a name="local-6989586621684659929"><a href="#local-6989586621684659929"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621684659930"><a href="#local-6989586621684659930"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><a href="MkCore.html#mkConsExpr"><span class="hs-identifier hs-var">mkConsExpr</span></a><span> </span><a href="#local-6989586621684659929"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="MkCore.html#mkNilExpr"><span class="hs-identifier hs-var">mkNilExpr</span></a><span> </span><a href="#local-6989586621684659929"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659930"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span class="hs-comment">-- | Make a fully applied 'foldr' expression</span><span>
</span><a name="line-587"></a><span class="hs-identifier">mkFoldrExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-588"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>             </span><span class="hs-comment">-- ^ Element type of the list</span><span>
</span><a name="line-589"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>             </span><span class="hs-comment">-- ^ Fold result type</span><span>
</span><a name="line-590"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>         </span><span class="hs-comment">-- ^ &quot;Cons&quot; function expression for the fold</span><span>
</span><a name="line-591"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>         </span><span class="hs-comment">-- ^ &quot;Nil&quot; expression for the fold</span><span>
</span><a name="line-592"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>         </span><span class="hs-comment">-- ^ List expression being folded acress</span><span>
</span><a name="line-593"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-594"></a><a name="mkFoldrExpr"><a href="MkCore.html#mkFoldrExpr"><span class="hs-identifier">mkFoldrExpr</span></a></a><span> </span><a name="local-6989586621684659931"><a href="#local-6989586621684659931"><span class="hs-identifier">elt_ty</span></a></a><span> </span><a name="local-6989586621684659932"><a href="#local-6989586621684659932"><span class="hs-identifier">result_ty</span></a></a><span> </span><a name="local-6989586621684659933"><a href="#local-6989586621684659933"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621684659934"><a href="#local-6989586621684659934"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621684659935"><a href="#local-6989586621684659935"><span class="hs-identifier">list</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-595"></a><span>    </span><a name="local-6989586621684659936"><a href="#local-6989586621684659936"><span class="hs-identifier">foldr_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#lookupId"><span class="hs-identifier hs-var">lookupId</span></a><span> </span><a href="PrelNames.html#foldrName"><span class="hs-identifier hs-var">foldrName</span></a><span>
</span><a name="line-596"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659936"><span class="hs-identifier hs-var">foldr_id</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659931"><span class="hs-identifier hs-var">elt_ty</span></a><span>
</span><a name="line-597"></a><span>           </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659932"><span class="hs-identifier hs-var">result_ty</span></a><span>
</span><a name="line-598"></a><span>           </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659933"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-599"></a><span>           </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659934"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-600"></a><span>           </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659935"><span class="hs-identifier hs-var">list</span></a><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>
</span><a name="line-602"></a><span class="hs-comment">-- | Make a 'build' expression applied to a locally-bound worker function</span><span>
</span><a name="line-603"></a><span class="hs-identifier">mkBuildExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadFail.MonadFail</span><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="UniqSupply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-604"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>                                     </span><span class="hs-comment">-- ^ Type of list elements to be built</span><span>
</span><a name="line-605"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Function that, given information about the 'Id's</span><span>
</span><a name="line-606"></a><span>                                                        </span><span class="hs-comment">-- of the binders for the build worker function, returns</span><span>
</span><a name="line-607"></a><span>                                                        </span><span class="hs-comment">-- the body of that worker</span><span>
</span><a name="line-608"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-609"></a><a name="mkBuildExpr"><a href="MkCore.html#mkBuildExpr"><span class="hs-identifier">mkBuildExpr</span></a></a><span> </span><a name="local-6989586621684659937"><a href="#local-6989586621684659937"><span class="hs-identifier">elt_ty</span></a></a><span> </span><a name="local-6989586621684659938"><a href="#local-6989586621684659938"><span class="hs-identifier">mk_build_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-610"></a><span>    </span><span class="hs-special">[</span><a name="local-6989586621684659942"><a href="#local-6989586621684659942"><span class="hs-identifier">n_tyvar</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659939"><span class="hs-identifier hs-var">newTyVars</span></a><span> </span><span class="hs-special">[</span><a href="TysPrim.html#alphaTyVar"><span class="hs-identifier hs-var">alphaTyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-611"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659943"><a href="#local-6989586621684659943"><span class="hs-identifier">n_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="#local-6989586621684659942"><span class="hs-identifier hs-var">n_tyvar</span></a><span>
</span><a name="line-612"></a><span>        </span><a name="local-6989586621684659944"><a href="#local-6989586621684659944"><span class="hs-identifier">c_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#mkFunTys"><span class="hs-identifier hs-var">mkFunTys</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659937"><span class="hs-identifier hs-var">elt_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659943"><span class="hs-identifier hs-var">n_ty</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621684659943"><span class="hs-identifier hs-var">n_ty</span></a><span>
</span><a name="line-613"></a><span>    </span><span class="hs-special">[</span><a name="local-6989586621684659945"><a href="#local-6989586621684659945"><span class="hs-identifier">c</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659946"><a href="#local-6989586621684659946"><span class="hs-identifier">n</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">sequence</span><span> </span><span class="hs-special">[</span><a href="Id.html#mkSysLocalM"><span class="hs-identifier hs-var">mkSysLocalM</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;c&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659944"><span class="hs-identifier hs-var">c_ty</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#mkSysLocalM"><span class="hs-identifier hs-var">mkSysLocalM</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><span class="hs-string">&quot;n&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659943"><span class="hs-identifier hs-var">n_ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-614"></a><span>
</span><a name="line-615"></a><span>    </span><a name="local-6989586621684659947"><a href="#local-6989586621684659947"><span class="hs-identifier">build_inside</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659938"><span class="hs-identifier hs-var">mk_build_inside</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659945"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659944"><span class="hs-identifier hs-var">c_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659946"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659943"><span class="hs-identifier hs-var">n_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-616"></a><span>
</span><a name="line-617"></a><span>    </span><a name="local-6989586621684659948"><a href="#local-6989586621684659948"><span class="hs-identifier">build_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#lookupId"><span class="hs-identifier hs-var">lookupId</span></a><span> </span><a href="PrelNames.html#buildName"><span class="hs-identifier hs-var">buildName</span></a><span>
</span><a name="line-618"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659948"><span class="hs-identifier hs-var">build_id</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659937"><span class="hs-identifier hs-var">elt_ty</span></a><span> </span><span class="hs-special">`</span><a href="CoreSyn.html#App"><span class="hs-identifier hs-var">App</span></a><span class="hs-special">`</span><span> </span><a href="CoreSyn.html#mkLams"><span class="hs-identifier hs-var">mkLams</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659942"><span class="hs-identifier hs-var">n_tyvar</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659945"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659946"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621684659947"><span class="hs-identifier hs-var">build_inside</span></a><span>
</span><a name="line-619"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-620"></a><span>    </span><a name="local-6989586621684659939"><a href="#local-6989586621684659939"><span class="hs-identifier">newTyVars</span></a></a><span> </span><a name="local-6989586621684659940"><a href="#local-6989586621684659940"><span class="hs-identifier">tyvar_tmpls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-621"></a><span>      </span><a name="local-6989586621684659941"><a href="#local-6989586621684659941"><span class="hs-identifier">uniqs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="UniqSupply.html#getUniquesM"><span class="hs-identifier hs-var">getUniquesM</span></a><span>
</span><a name="line-622"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="Var.html#setTyVarUnique"><span class="hs-identifier hs-var">setTyVarUnique</span></a><span> </span><a href="#local-6989586621684659940"><span class="hs-identifier hs-var">tyvar_tmpls</span></a><span> </span><a href="#local-6989586621684659941"><span class="hs-identifier hs-var">uniqs</span></a><span class="hs-special">)</span><span>
</span><a name="line-623"></a><span>
</span><a name="line-624"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Manipulating Maybe data type
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span>
</span><a name="line-633"></a><span class="hs-comment">-- | Makes a Nothing for the specified type</span><span>
</span><a name="line-634"></a><span class="hs-identifier">mkNothingExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-635"></a><a name="mkNothingExpr"><a href="MkCore.html#mkNothingExpr"><span class="hs-identifier">mkNothingExpr</span></a></a><span> </span><a name="local-6989586621684659949"><a href="#local-6989586621684659949"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="TysWiredIn.html#nothingDataCon"><span class="hs-identifier hs-var">nothingDataCon</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659949"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">]</span><span>
</span><a name="line-636"></a><span>
</span><a name="line-637"></a><span class="hs-comment">-- | Makes a Just from a value of the specified type</span><span>
</span><a name="line-638"></a><span class="hs-identifier">mkJustExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-639"></a><a name="mkJustExpr"><a href="MkCore.html#mkJustExpr"><span class="hs-identifier">mkJustExpr</span></a></a><span> </span><a name="local-6989586621684659950"><a href="#local-6989586621684659950"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621684659951"><a href="#local-6989586621684659951"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#mkConApp"><span class="hs-identifier hs-var">mkConApp</span></a><span> </span><a href="TysWiredIn.html#justDataCon"><span class="hs-identifier hs-var">justDataCon</span></a><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659950"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659951"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">]</span><span>
</span><a name="line-640"></a><span>
</span><a name="line-641"></a><span>
</span><a name="line-642"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                      Error expressions
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span class="hs-identifier">mkRuntimeErrorApp</span><span>
</span><a name="line-651"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>           </span><span class="hs-comment">-- Should be of type (forall a. Addr# -&gt; a)</span><span>
</span><a name="line-652"></a><span>                        </span><span class="hs-comment">--      where Addr# points to a UTF8 encoded string</span><span>
</span><a name="line-653"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>         </span><span class="hs-comment">-- The type to instantiate 'a'</span><span>
</span><a name="line-654"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>       </span><span class="hs-comment">-- The string to print</span><span>
</span><a name="line-655"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-656"></a><span>
</span><a name="line-657"></a><a name="mkRuntimeErrorApp"><a href="MkCore.html#mkRuntimeErrorApp"><span class="hs-identifier">mkRuntimeErrorApp</span></a></a><span> </span><a name="local-6989586621684659952"><a href="#local-6989586621684659952"><span class="hs-identifier">err_id</span></a></a><span> </span><a name="local-6989586621684659953"><a href="#local-6989586621684659953"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-6989586621684659954"><a href="#local-6989586621684659954"><span class="hs-identifier">err_msg</span></a></a><span>
</span><a name="line-658"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621684659952"><span class="hs-identifier hs-var">err_id</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><span class="hs-special">(</span><a href="Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a><span> </span><a href="#local-6989586621684659953"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-659"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659953"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659955"><span class="hs-identifier hs-var">err_string</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-660"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-661"></a><span>    </span><a name="local-6989586621684659955"><a href="#local-6989586621684659955"><span class="hs-identifier">err_string</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitString"><span class="hs-identifier hs-var">mkLitString</span></a><span> </span><a href="#local-6989586621684659954"><span class="hs-identifier hs-var">err_msg</span></a><span class="hs-special">)</span><span>
</span><a name="line-662"></a><span>
</span><a name="line-663"></a><span class="hs-identifier">mkImpossibleExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-664"></a><a name="mkImpossibleExpr"><a href="MkCore.html#mkImpossibleExpr"><span class="hs-identifier">mkImpossibleExpr</span></a></a><span> </span><a name="local-6989586621684659956"><a href="#local-6989586621684659956"><span class="hs-identifier">res_ty</span></a></a><span>
</span><a name="line-665"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkRuntimeErrorApp"><span class="hs-identifier hs-var">mkRuntimeErrorApp</span></a><span> </span><a href="MkCore.html#rUNTIME_ERROR_ID"><span class="hs-identifier hs-var">rUNTIME_ERROR_ID</span></a><span> </span><a href="#local-6989586621684659956"><span class="hs-identifier hs-var">res_ty</span></a><span> </span><span class="hs-string">&quot;Impossible case alternative&quot;</span><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                     Error Ids
*                                                                      *
************************************************************************

GHC randomly injects these into the code.

@patError@ is just a version of @error@ for pattern-matching
failures.  It knows various ``codes'' which expand to longer
strings---this saves space!

@absentErr@ is a thing we put in for ``absent'' arguments.  They jolly
well shouldn't be yanked on, but if one is, then you will get a
friendly message from @absentErr@ (rather than a totally random
crash).

@parError@ is a special version of @error@ which the compiler does
not know to be a bottoming Id.  It is used in the @_par_@ and @_seq_@
templates, but we don't ever expect to generate code for it.
-}</span><span>
</span><a name="line-689"></a><span>
</span><a name="line-690"></a><span class="hs-identifier">errorIds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>
</span><a name="line-691"></a><a name="errorIds"><a href="MkCore.html#errorIds"><span class="hs-identifier">errorIds</span></a></a><span>
</span><a name="line-692"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="MkCore.html#rUNTIME_ERROR_ID"><span class="hs-identifier hs-var">rUNTIME_ERROR_ID</span></a><span class="hs-special">,</span><span>
</span><a name="line-693"></a><span>      </span><a href="MkCore.html#nON_EXHAUSTIVE_GUARDS_ERROR_ID"><span class="hs-identifier hs-var">nON_EXHAUSTIVE_GUARDS_ERROR_ID</span></a><span class="hs-special">,</span><span>
</span><a name="line-694"></a><span>      </span><a href="MkCore.html#nO_METHOD_BINDING_ERROR_ID"><span class="hs-identifier hs-var">nO_METHOD_BINDING_ERROR_ID</span></a><span class="hs-special">,</span><span>
</span><a name="line-695"></a><span>      </span><a href="MkCore.html#pAT_ERROR_ID"><span class="hs-identifier hs-var">pAT_ERROR_ID</span></a><span class="hs-special">,</span><span>
</span><a name="line-696"></a><span>      </span><a href="MkCore.html#rEC_CON_ERROR_ID"><span class="hs-identifier hs-var">rEC_CON_ERROR_ID</span></a><span class="hs-special">,</span><span>
</span><a name="line-697"></a><span>      </span><a href="MkCore.html#rEC_SEL_ERROR_ID"><span class="hs-identifier hs-var">rEC_SEL_ERROR_ID</span></a><span class="hs-special">,</span><span>
</span><a name="line-698"></a><span>      </span><a href="MkCore.html#aBSENT_ERROR_ID"><span class="hs-identifier hs-var">aBSENT_ERROR_ID</span></a><span class="hs-special">,</span><span>
</span><a name="line-699"></a><span>      </span><a href="MkCore.html#tYPE_ERROR_ID"><span class="hs-identifier hs-var">tYPE_ERROR_ID</span></a><span>   </span><span class="hs-comment">-- Used with Opt_DeferTypeErrors, see #10284</span><span>
</span><a name="line-700"></a><span>      </span><span class="hs-special">]</span><span>
</span><a name="line-701"></a><span>
</span><a name="line-702"></a><span class="hs-identifier">recSelErrorName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">runtimeErrorName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">absentErrorName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-703"></a><span class="hs-identifier">recConErrorName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">patErrorName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-704"></a><span class="hs-identifier">nonExhaustiveGuardsErrorName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">noMethodBindingErrorName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-705"></a><span class="hs-identifier">typeErrorName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-706"></a><span class="hs-identifier">absentSumFieldErrorName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-707"></a><span>
</span><a name="line-708"></a><a name="recSelErrorName"><a href="MkCore.html#recSelErrorName"><span class="hs-identifier">recSelErrorName</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#err_nm"><span class="hs-identifier hs-var">err_nm</span></a><span> </span><span class="hs-string">&quot;recSelError&quot;</span><span>     </span><a href="PrelNames.html#recSelErrorIdKey"><span class="hs-identifier hs-var">recSelErrorIdKey</span></a><span>     </span><a href="MkCore.html#rEC_SEL_ERROR_ID"><span class="hs-identifier hs-var">rEC_SEL_ERROR_ID</span></a><span>
</span><a name="line-709"></a><a name="absentErrorName"><a href="MkCore.html#absentErrorName"><span class="hs-identifier">absentErrorName</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#err_nm"><span class="hs-identifier hs-var">err_nm</span></a><span> </span><span class="hs-string">&quot;absentError&quot;</span><span>     </span><a href="PrelNames.html#absentErrorIdKey"><span class="hs-identifier hs-var">absentErrorIdKey</span></a><span>     </span><a href="MkCore.html#aBSENT_ERROR_ID"><span class="hs-identifier hs-var">aBSENT_ERROR_ID</span></a><span>
</span><a name="line-710"></a><a name="absentSumFieldErrorName"><a href="MkCore.html#absentSumFieldErrorName"><span class="hs-identifier">absentSumFieldErrorName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#err_nm"><span class="hs-identifier hs-var">err_nm</span></a><span> </span><span class="hs-string">&quot;absentSumFieldError&quot;</span><span>  </span><a href="PrelNames.html#absentSumFieldErrorIdKey"><span class="hs-identifier hs-var">absentSumFieldErrorIdKey</span></a><span>
</span><a name="line-711"></a><span>                            </span><a href="MkCore.html#aBSENT_SUM_FIELD_ERROR_ID"><span class="hs-identifier hs-var">aBSENT_SUM_FIELD_ERROR_ID</span></a><span>
</span><a name="line-712"></a><a name="runtimeErrorName"><a href="MkCore.html#runtimeErrorName"><span class="hs-identifier">runtimeErrorName</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#err_nm"><span class="hs-identifier hs-var">err_nm</span></a><span> </span><span class="hs-string">&quot;runtimeError&quot;</span><span>    </span><a href="PrelNames.html#runtimeErrorIdKey"><span class="hs-identifier hs-var">runtimeErrorIdKey</span></a><span>    </span><a href="MkCore.html#rUNTIME_ERROR_ID"><span class="hs-identifier hs-var">rUNTIME_ERROR_ID</span></a><span>
</span><a name="line-713"></a><a name="recConErrorName"><a href="MkCore.html#recConErrorName"><span class="hs-identifier">recConErrorName</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#err_nm"><span class="hs-identifier hs-var">err_nm</span></a><span> </span><span class="hs-string">&quot;recConError&quot;</span><span>     </span><a href="PrelNames.html#recConErrorIdKey"><span class="hs-identifier hs-var">recConErrorIdKey</span></a><span>     </span><a href="MkCore.html#rEC_CON_ERROR_ID"><span class="hs-identifier hs-var">rEC_CON_ERROR_ID</span></a><span>
</span><a name="line-714"></a><a name="patErrorName"><a href="MkCore.html#patErrorName"><span class="hs-identifier">patErrorName</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#err_nm"><span class="hs-identifier hs-var">err_nm</span></a><span> </span><span class="hs-string">&quot;patError&quot;</span><span>        </span><a href="PrelNames.html#patErrorIdKey"><span class="hs-identifier hs-var">patErrorIdKey</span></a><span>        </span><a href="MkCore.html#pAT_ERROR_ID"><span class="hs-identifier hs-var">pAT_ERROR_ID</span></a><span>
</span><a name="line-715"></a><a name="typeErrorName"><a href="MkCore.html#typeErrorName"><span class="hs-identifier">typeErrorName</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#err_nm"><span class="hs-identifier hs-var">err_nm</span></a><span> </span><span class="hs-string">&quot;typeError&quot;</span><span>       </span><a href="PrelNames.html#typeErrorIdKey"><span class="hs-identifier hs-var">typeErrorIdKey</span></a><span>       </span><a href="MkCore.html#tYPE_ERROR_ID"><span class="hs-identifier hs-var">tYPE_ERROR_ID</span></a><span>
</span><a name="line-716"></a><span>
</span><a name="line-717"></a><a name="noMethodBindingErrorName"><a href="MkCore.html#noMethodBindingErrorName"><span class="hs-identifier">noMethodBindingErrorName</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#err_nm"><span class="hs-identifier hs-var">err_nm</span></a><span> </span><span class="hs-string">&quot;noMethodBindingError&quot;</span><span>
</span><a name="line-718"></a><span>                                  </span><a href="PrelNames.html#noMethodBindingErrorIdKey"><span class="hs-identifier hs-var">noMethodBindingErrorIdKey</span></a><span> </span><a href="MkCore.html#nO_METHOD_BINDING_ERROR_ID"><span class="hs-identifier hs-var">nO_METHOD_BINDING_ERROR_ID</span></a><span>
</span><a name="line-719"></a><a name="nonExhaustiveGuardsErrorName"><a href="MkCore.html#nonExhaustiveGuardsErrorName"><span class="hs-identifier">nonExhaustiveGuardsErrorName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#err_nm"><span class="hs-identifier hs-var">err_nm</span></a><span> </span><span class="hs-string">&quot;nonExhaustiveGuardsError&quot;</span><span>
</span><a name="line-720"></a><span>                                  </span><a href="PrelNames.html#nonExhaustiveGuardsErrorIdKey"><span class="hs-identifier hs-var">nonExhaustiveGuardsErrorIdKey</span></a><span> </span><a href="MkCore.html#nON_EXHAUSTIVE_GUARDS_ERROR_ID"><span class="hs-identifier hs-var">nON_EXHAUSTIVE_GUARDS_ERROR_ID</span></a><span>
</span><a name="line-721"></a><span>
</span><a name="line-722"></a><span class="hs-identifier">err_nm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-723"></a><a name="err_nm"><a href="MkCore.html#err_nm"><span class="hs-identifier">err_nm</span></a></a><span> </span><a name="local-6989586621684659957"><a href="#local-6989586621684659957"><span class="hs-identifier">str</span></a></a><span> </span><a name="local-6989586621684659958"><a href="#local-6989586621684659958"><span class="hs-identifier">uniq</span></a></a><span> </span><a name="local-6989586621684659959"><a href="#local-6989586621684659959"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TysWiredIn.html#mkWiredInIdName"><span class="hs-identifier hs-var">mkWiredInIdName</span></a><span> </span><a href="PrelNames.html#cONTROL_EXCEPTION_BASE"><span class="hs-identifier hs-var">cONTROL_EXCEPTION_BASE</span></a><span> </span><span class="hs-special">(</span><a href="FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a><span> </span><a href="#local-6989586621684659957"><span class="hs-identifier hs-var">str</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659958"><span class="hs-identifier hs-var">uniq</span></a><span> </span><a href="#local-6989586621684659959"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-724"></a><span>
</span><a name="line-725"></a><span class="hs-identifier">rEC_SEL_ERROR_ID</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rUNTIME_ERROR_ID</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rEC_CON_ERROR_ID</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-726"></a><span class="hs-identifier">pAT_ERROR_ID</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nO_METHOD_BINDING_ERROR_ID</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nON_EXHAUSTIVE_GUARDS_ERROR_ID</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-727"></a><span class="hs-identifier">tYPE_ERROR_ID</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">aBSENT_ERROR_ID</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">aBSENT_SUM_FIELD_ERROR_ID</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-728"></a><a name="rEC_SEL_ERROR_ID"><a href="MkCore.html#rEC_SEL_ERROR_ID"><span class="hs-identifier">rEC_SEL_ERROR_ID</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkRuntimeErrorId"><span class="hs-identifier hs-var">mkRuntimeErrorId</span></a><span> </span><a href="MkCore.html#recSelErrorName"><span class="hs-identifier hs-var">recSelErrorName</span></a><span>
</span><a name="line-729"></a><a name="rUNTIME_ERROR_ID"><a href="MkCore.html#rUNTIME_ERROR_ID"><span class="hs-identifier">rUNTIME_ERROR_ID</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkRuntimeErrorId"><span class="hs-identifier hs-var">mkRuntimeErrorId</span></a><span> </span><a href="MkCore.html#runtimeErrorName"><span class="hs-identifier hs-var">runtimeErrorName</span></a><span>
</span><a name="line-730"></a><a name="rEC_CON_ERROR_ID"><a href="MkCore.html#rEC_CON_ERROR_ID"><span class="hs-identifier">rEC_CON_ERROR_ID</span></a></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkRuntimeErrorId"><span class="hs-identifier hs-var">mkRuntimeErrorId</span></a><span> </span><a href="MkCore.html#recConErrorName"><span class="hs-identifier hs-var">recConErrorName</span></a><span>
</span><a name="line-731"></a><a name="pAT_ERROR_ID"><a href="MkCore.html#pAT_ERROR_ID"><span class="hs-identifier">pAT_ERROR_ID</span></a></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkRuntimeErrorId"><span class="hs-identifier hs-var">mkRuntimeErrorId</span></a><span> </span><a href="MkCore.html#patErrorName"><span class="hs-identifier hs-var">patErrorName</span></a><span>
</span><a name="line-732"></a><a name="nO_METHOD_BINDING_ERROR_ID"><a href="MkCore.html#nO_METHOD_BINDING_ERROR_ID"><span class="hs-identifier">nO_METHOD_BINDING_ERROR_ID</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkRuntimeErrorId"><span class="hs-identifier hs-var">mkRuntimeErrorId</span></a><span> </span><a href="MkCore.html#noMethodBindingErrorName"><span class="hs-identifier hs-var">noMethodBindingErrorName</span></a><span>
</span><a name="line-733"></a><a name="nON_EXHAUSTIVE_GUARDS_ERROR_ID"><a href="MkCore.html#nON_EXHAUSTIVE_GUARDS_ERROR_ID"><span class="hs-identifier">nON_EXHAUSTIVE_GUARDS_ERROR_ID</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkRuntimeErrorId"><span class="hs-identifier hs-var">mkRuntimeErrorId</span></a><span> </span><a href="MkCore.html#nonExhaustiveGuardsErrorName"><span class="hs-identifier hs-var">nonExhaustiveGuardsErrorName</span></a><span>
</span><a name="line-734"></a><a name="tYPE_ERROR_ID"><a href="MkCore.html#tYPE_ERROR_ID"><span class="hs-identifier">tYPE_ERROR_ID</span></a></a><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="MkCore.html#mkRuntimeErrorId"><span class="hs-identifier hs-var">mkRuntimeErrorId</span></a><span> </span><a href="MkCore.html#typeErrorName"><span class="hs-identifier hs-var">typeErrorName</span></a><span>
</span><a name="line-735"></a><span>
</span><a name="line-736"></a><span class="hs-comment">-- Note [aBSENT_SUM_FIELD_ERROR_ID]</span><span>
</span><a name="line-737"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-738"></a><span class="hs-comment">-- Absent argument error for unused unboxed sum fields are different than absent</span><span>
</span><a name="line-739"></a><span class="hs-comment">-- error used in dummy worker functions (see `mkAbsentErrorApp`):</span><span>
</span><a name="line-740"></a><span class="hs-comment">--</span><span>
</span><a name="line-741"></a><span class="hs-comment">-- - `absentSumFieldError` can't take arguments because it's used in unarise for</span><span>
</span><a name="line-742"></a><span class="hs-comment">--   unused pointer fields in unboxed sums, and applying an argument would</span><span>
</span><a name="line-743"></a><span class="hs-comment">--   require allocating a thunk.</span><span>
</span><a name="line-744"></a><span class="hs-comment">--</span><span>
</span><a name="line-745"></a><span class="hs-comment">-- - `absentSumFieldError` can't be CAFFY because that would mean making some</span><span>
</span><a name="line-746"></a><span class="hs-comment">--   non-CAFFY definitions that use unboxed sums CAFFY in unarise.</span><span>
</span><a name="line-747"></a><span class="hs-comment">--</span><span>
</span><a name="line-748"></a><span class="hs-comment">--   To make `absentSumFieldError` non-CAFFY we get a stable pointer to it in</span><span>
</span><a name="line-749"></a><span class="hs-comment">--   RtsStartup.c and mark it as non-CAFFY here.</span><span>
</span><a name="line-750"></a><span class="hs-comment">--</span><span>
</span><a name="line-751"></a><span class="hs-comment">-- Getting this wrong causes hard-to-debug runtime issues, see #15038.</span><span>
</span><a name="line-752"></a><span class="hs-comment">--</span><span>
</span><a name="line-753"></a><span class="hs-comment">-- TODO: Remove stable pointer hack after fixing #9718.</span><span>
</span><a name="line-754"></a><span class="hs-comment">--       However, we should still be careful about not making things CAFFY just</span><span>
</span><a name="line-755"></a><span class="hs-comment">--       because they use unboxed sums. Unboxed objects are supposed to be</span><span>
</span><a name="line-756"></a><span class="hs-comment">--       efficient, and none of the other unboxed literals make things CAFFY.</span><span>
</span><a name="line-757"></a><span>
</span><a name="line-758"></a><a name="aBSENT_SUM_FIELD_ERROR_ID"><a href="MkCore.html#aBSENT_SUM_FIELD_ERROR_ID"><span class="hs-identifier">aBSENT_SUM_FIELD_ERROR_ID</span></a></a><span>
</span><a name="line-759"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkVanillaGlobalWithInfo"><span class="hs-identifier hs-var">mkVanillaGlobalWithInfo</span></a><span> </span><a href="MkCore.html#absentSumFieldErrorName"><span class="hs-identifier hs-var">absentSumFieldErrorName</span></a><span>
</span><a name="line-760"></a><span>      </span><span class="hs-special">(</span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span> </span><span class="hs-special">[</span><a href="TysPrim.html#alphaTyVar"><span class="hs-identifier hs-var">alphaTyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a><span> </span><a href="TysPrim.html#alphaTyVar"><span class="hs-identifier hs-var">alphaTyVar</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- forall a . a</span><span>
</span><a name="line-761"></a><span>      </span><span class="hs-special">(</span><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a><span> </span><span class="hs-special">`</span><a href="IdInfo.html#setStrictnessInfo"><span class="hs-identifier hs-var">setStrictnessInfo</span></a><span class="hs-special">`</span><span> </span><a href="Demand.html#mkClosedStrictSig"><span class="hs-identifier hs-var">mkClosedStrictSig</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="Demand.html#exnRes"><span class="hs-identifier hs-var">exnRes</span></a><span>
</span><a name="line-762"></a><span>                     </span><span class="hs-special">`</span><a href="IdInfo.html#setArityInfo"><span class="hs-identifier hs-var">setArityInfo</span></a><span class="hs-special">`</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-763"></a><span>                     </span><span class="hs-special">`</span><a href="IdInfo.html#setCafInfo"><span class="hs-identifier hs-var">setCafInfo</span></a><span class="hs-special">`</span><span> </span><a href="IdInfo.html#NoCafRefs"><span class="hs-identifier hs-var">NoCafRefs</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- #15038</span><span>
</span><a name="line-764"></a><span>
</span><a name="line-765"></a><span class="hs-identifier">mkRuntimeErrorId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-766"></a><span class="hs-comment">-- Error function</span><span>
</span><a name="line-767"></a><span class="hs-comment">--   with type:  forall (r:RuntimeRep) (a:TYPE r). Addr# -&gt; a</span><span>
</span><a name="line-768"></a><span class="hs-comment">--   with arity: 1</span><span>
</span><a name="line-769"></a><span class="hs-comment">-- which diverges after being given one argument</span><span>
</span><a name="line-770"></a><span class="hs-comment">-- The Addr# is expected to be the address of</span><span>
</span><a name="line-771"></a><span class="hs-comment">--   a UTF8-encoded error string</span><span>
</span><a name="line-772"></a><a name="mkRuntimeErrorId"><a href="MkCore.html#mkRuntimeErrorId"><span class="hs-identifier">mkRuntimeErrorId</span></a></a><span> </span><a name="local-6989586621684659960"><a href="#local-6989586621684659960"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-773"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkVanillaGlobalWithInfo"><span class="hs-identifier hs-var">mkVanillaGlobalWithInfo</span></a><span> </span><a href="#local-6989586621684659960"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="MkCore.html#runtimeErrorTy"><span class="hs-identifier hs-var">runtimeErrorTy</span></a><span> </span><a href="#local-6989586621684659961"><span class="hs-identifier hs-var">bottoming_info</span></a><span>
</span><a name="line-774"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-775"></a><span>    </span><a name="local-6989586621684659961"><a href="#local-6989586621684659961"><span class="hs-identifier">bottoming_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a><span> </span><span class="hs-special">`</span><a href="IdInfo.html#setStrictnessInfo"><span class="hs-identifier hs-var">setStrictnessInfo</span></a><span class="hs-special">`</span><span>    </span><a href="#local-6989586621684659962"><span class="hs-identifier hs-var">strict_sig</span></a><span>
</span><a name="line-776"></a><span>                                   </span><span class="hs-special">`</span><a href="IdInfo.html#setArityInfo"><span class="hs-identifier hs-var">setArityInfo</span></a><span class="hs-special">`</span><span>         </span><span class="hs-number">1</span><span>
</span><a name="line-777"></a><span>                        </span><span class="hs-comment">-- Make arity and strictness agree</span><span>
</span><a name="line-778"></a><span>
</span><a name="line-779"></a><span>        </span><span class="hs-comment">-- Do *not* mark them as NoCafRefs, because they can indeed have</span><span>
</span><a name="line-780"></a><span>        </span><span class="hs-comment">-- CAF refs.  For example, pAT_ERROR_ID calls GHC.Err.untangle,</span><span>
</span><a name="line-781"></a><span>        </span><span class="hs-comment">-- which has some CAFs</span><span>
</span><a name="line-782"></a><span>        </span><span class="hs-comment">-- In due course we may arrange that these error-y things are</span><span>
</span><a name="line-783"></a><span>        </span><span class="hs-comment">-- regarded by the GC as permanently live, in which case we</span><span>
</span><a name="line-784"></a><span>        </span><span class="hs-comment">-- can give them NoCaf info.  As it is, any function that calls</span><span>
</span><a name="line-785"></a><span>        </span><span class="hs-comment">-- any pc_bottoming_Id will itself have CafRefs, which bloats</span><span>
</span><a name="line-786"></a><span>        </span><span class="hs-comment">-- SRTs.</span><span>
</span><a name="line-787"></a><span>
</span><a name="line-788"></a><span>    </span><a name="local-6989586621684659962"><a href="#local-6989586621684659962"><span class="hs-identifier">strict_sig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Demand.html#mkClosedStrictSig"><span class="hs-identifier hs-var">mkClosedStrictSig</span></a><span> </span><span class="hs-special">[</span><a href="Demand.html#evalDmd"><span class="hs-identifier hs-var">evalDmd</span></a><span class="hs-special">]</span><span> </span><a href="Demand.html#exnRes"><span class="hs-identifier hs-var">exnRes</span></a><span>
</span><a name="line-789"></a><span>              </span><span class="hs-comment">-- exnRes: these throw an exception, not just diverge</span><span>
</span><a name="line-790"></a><span>
</span><a name="line-791"></a><span class="hs-identifier">runtimeErrorTy</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-792"></a><span class="hs-comment">-- forall (rr :: RuntimeRep) (a :: rr). Addr# -&gt; a</span><span>
</span><a name="line-793"></a><span class="hs-comment">--   See Note [Error and friends have an &quot;open-tyvar&quot; forall]</span><span>
</span><a name="line-794"></a><a name="runtimeErrorTy"><a href="MkCore.html#runtimeErrorTy"><span class="hs-identifier">runtimeErrorTy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span> </span><span class="hs-special">[</span><a href="TysPrim.html#runtimeRep1TyVar"><span class="hs-identifier hs-var">runtimeRep1TyVar</span></a><span class="hs-special">,</span><span> </span><a href="TysPrim.html#openAlphaTyVar"><span class="hs-identifier hs-var">openAlphaTyVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-795"></a><span>                                 </span><span class="hs-special">(</span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><a href="TysPrim.html#addrPrimTy"><span class="hs-identifier hs-var">addrPrimTy</span></a><span> </span><a href="TysPrim.html#openAlphaTy"><span class="hs-identifier hs-var">openAlphaTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-796"></a><span>
</span><a name="line-797"></a><span class="hs-comment">{- Note [Error and friends have an &quot;open-tyvar&quot; forall]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
'error' and 'undefined' have types
        error     :: forall (v :: RuntimeRep) (a :: TYPE v). String -&gt; a
        undefined :: forall (v :: RuntimeRep) (a :: TYPE v). a
Notice the runtime-representation polymorphism. This ensures that
&quot;error&quot; can be instantiated at unboxed as well as boxed types.
This is OK because it never returns, so the return type is irrelevant.


************************************************************************
*                                                                      *
                     aBSENT_ERROR_ID
*                                                                      *
************************************************************************

Note [aBSENT_ERROR_ID]
~~~~~~~~~~~~~~~~~~~~~~
We use aBSENT_ERROR_ID to build dummy values in workers.  E.g.

   f x = (case x of (a,b) -&gt; b) + 1::Int

The demand analyser figures ot that only the second component of x is
used, and does a w/w split thus

   f x = case x of (a,b) -&gt; $wf b

   $wf b = let a = absentError &quot;blah&quot;
               x = (a,b)
           in &lt;the original RHS of f&gt;

After some simplification, the (absentError &quot;blah&quot;) thunk goes away.

------ Tricky wrinkle -------
Trac #14285 had, roughly

   data T a = MkT a !a
   {-# INLINABLE f #-}
   f x = case x of MkT a b -&gt; g (MkT b a)

It turned out that g didn't use the second component, and hence f doesn't use
the first.  But the stable-unfolding for f looks like
   \x. case x of MkT a b -&gt; g ($WMkT b a)
where $WMkT is the wrapper for MkT that evaluates its arguments.  We
apply the same w/w split to this unfolding (see Note [Worker-wrapper
for INLINEABLE functions] in WorkWrap) so the template ends up like
   \b. let a = absentError &quot;blah&quot;
           x = MkT a b
        in case x of MkT a b -&gt; g ($WMkT b a)

After doing case-of-known-constructor, and expanding $WMkT we get
   \b -&gt; g (case absentError &quot;blah&quot; of a -&gt; MkT b a)

Yikes!  That bogusly appears to evaluate the absentError!

This is extremely tiresome.  Another way to think of this is that, in
Core, it is an invariant that a strict data contructor, like MkT, must
be applied only to an argument in HNF. So (absentError &quot;blah&quot;) had
better be non-bottom.

So the &quot;solution&quot; is to add a special case for absentError to exprIsHNFlike.
This allows Simplify.rebuildCase, in the Note [Case to let transformation]
branch, to convert the case on absentError into a let. We also make
absentError *not* be diverging, unlike the other error-ids, so that we
can be sure not to remove the case branches before converting the case to
a let.

If, by some bug or bizarre happenstance, we ever call absentError, we should
throw an exception.  This should never happen, of course, but we definitely
can't return anything.  e.g. if somehow we had
    case absentError &quot;foo&quot; of
       Nothing -&gt; ...
       Just x  -&gt; ...
then if we return, the case expression will select a field and continue.
Seg fault city. Better to throw an exception. (Even though we've said
it is in HNF :-)

It might seem a bit surprising that seq on absentError is simply erased

    absentError &quot;foo&quot; `seq` x ==&gt; x

but that should be okay; since there's no pattern match we can't really
be relying on anything from it.
-}</span><span>
</span><a name="line-881"></a><span>
</span><a name="line-882"></a><a name="aBSENT_ERROR_ID"><a href="MkCore.html#aBSENT_ERROR_ID"><span class="hs-identifier">aBSENT_ERROR_ID</span></a></a><span>
</span><a name="line-883"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#mkVanillaGlobalWithInfo"><span class="hs-identifier hs-var">mkVanillaGlobalWithInfo</span></a><span> </span><a href="MkCore.html#absentErrorName"><span class="hs-identifier hs-var">absentErrorName</span></a><span> </span><a href="#local-6989586621684659963"><span class="hs-identifier hs-var">absent_ty</span></a><span> </span><a href="#local-6989586621684659964"><span class="hs-identifier hs-var">arity_info</span></a><span>
</span><a name="line-884"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-885"></a><span>   </span><a name="local-6989586621684659963"><a href="#local-6989586621684659963"><span class="hs-identifier">absent_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span> </span><span class="hs-special">[</span><a href="TysPrim.html#alphaTyVar"><span class="hs-identifier hs-var">alphaTyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#mkFunTy"><span class="hs-identifier hs-var">mkFunTy</span></a><span> </span><a href="TysPrim.html#addrPrimTy"><span class="hs-identifier hs-var">addrPrimTy</span></a><span> </span><a href="TysPrim.html#alphaTy"><span class="hs-identifier hs-var">alphaTy</span></a><span class="hs-special">)</span><span>
</span><a name="line-886"></a><span>   </span><span class="hs-comment">-- Not runtime-rep polymorphic. aBSENT_ERROR_ID is only used for</span><span>
</span><a name="line-887"></a><span>   </span><span class="hs-comment">-- lifted-type things; see Note [Absent errors] in WwLib</span><span>
</span><a name="line-888"></a><span>   </span><a name="local-6989586621684659964"><a href="#local-6989586621684659964"><span class="hs-identifier">arity_info</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#vanillaIdInfo"><span class="hs-identifier hs-var">vanillaIdInfo</span></a><span> </span><span class="hs-special">`</span><a href="IdInfo.html#setArityInfo"><span class="hs-identifier hs-var">setArityInfo</span></a><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-889"></a><span>   </span><span class="hs-comment">-- NB: no bottoming strictness info, unlike other error-ids.</span><span>
</span><a name="line-890"></a><span>   </span><span class="hs-comment">-- See Note [aBSENT_ERROR_ID]</span><span>
</span><a name="line-891"></a><span>
</span><a name="line-892"></a><span class="hs-identifier">mkAbsentErrorApp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>         </span><span class="hs-comment">-- The type to instantiate 'a'</span><span>
</span><a name="line-893"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>       </span><span class="hs-comment">-- The string to print</span><span>
</span><a name="line-894"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoreSyn.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a><span>
</span><a name="line-895"></a><span>
</span><a name="line-896"></a><a name="mkAbsentErrorApp"><a href="MkCore.html#mkAbsentErrorApp"><span class="hs-identifier">mkAbsentErrorApp</span></a></a><span> </span><a name="local-6989586621684659965"><a href="#local-6989586621684659965"><span class="hs-identifier">res_ty</span></a></a><span> </span><a name="local-6989586621684659966"><a href="#local-6989586621684659966"><span class="hs-identifier">err_msg</span></a></a><span>
</span><a name="line-897"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#mkApps"><span class="hs-identifier hs-var">mkApps</span></a><span> </span><span class="hs-special">(</span><a href="CoreSyn.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="MkCore.html#aBSENT_ERROR_ID"><span class="hs-identifier hs-var">aBSENT_ERROR_ID</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span> </span><a href="CoreSyn.html#Type"><span class="hs-identifier hs-var">Type</span></a><span> </span><a href="#local-6989586621684659965"><span class="hs-identifier hs-var">res_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659967"><span class="hs-identifier hs-var">err_string</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-898"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-899"></a><span>    </span><a name="local-6989586621684659967"><a href="#local-6989586621684659967"><span class="hs-identifier">err_string</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Lit"><span class="hs-identifier hs-var">Lit</span></a><span> </span><span class="hs-special">(</span><a href="Literal.html#mkLitString"><span class="hs-identifier hs-var">mkLitString</span></a><span> </span><a href="#local-6989586621684659966"><span class="hs-identifier hs-var">err_msg</span></a><span class="hs-special">)</span><span>
</span><a name="line-900"></a></pre></body></html>