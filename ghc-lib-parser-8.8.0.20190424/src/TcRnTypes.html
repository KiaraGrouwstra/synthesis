<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006-2012
(c) The GRASP Project, Glasgow University, 1992-2002


Various types used during typechecking, please see TcRnMonad as well for
operations on these types. You probably want to import it, instead of this
module.

All the monads exported here are built on top of the same IOEnv monad. The
monad functions like a Reader monad in the way it passes the environment
around. This is done to allow the environment to be manipulated in a stack
like fashion when entering expressions... etc.

For state that is global and should be returned at the end (e.g not part
of the stack mechanism), you should use a TcRef (= IORef) to store them.
-}</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-pragma">{-# LANGUAGE CPP, ExistentialQuantification, GeneralizedNewtypeDeriving,
             ViewPatterns #-}</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcRnTypes</span><span class="hs-special">(</span><span>
</span><a name="line-23"></a><span>        </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#RnM"><span class="hs-identifier hs-type">RnM</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#IfM"><span class="hs-identifier hs-type">IfM</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#IfL"><span class="hs-identifier hs-type">IfL</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- The monad is opaque outside this module</span><span>
</span><a name="line-24"></a><span>        </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span>        </span><span class="hs-comment">-- The environment types</span><span>
</span><a name="line-27"></a><span>        </span><a href="TcRnTypes.html#Env"><span class="hs-identifier hs-type">Env</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>        </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>        </span><a href="TcRnTypes.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#IfLclEnv"><span class="hs-identifier hs-type">IfLclEnv</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="TcRnTypes.html#tcVisibleOrphanMods"><span class="hs-identifier hs-var">tcVisibleOrphanMods</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span>        </span><span class="hs-comment">-- Frontend types (shouldn't really be here)</span><span>
</span><a name="line-33"></a><span>        </span><a href="TcRnTypes.html#FrontendResult"><span class="hs-identifier hs-type">FrontendResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>        </span><span class="hs-comment">-- Renamer types</span><span>
</span><a name="line-36"></a><span>        </span><a href="TcRnTypes.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#RecFieldEnv"><span class="hs-identifier hs-type">RecFieldEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#plusImportAvails"><span class="hs-identifier hs-var">plusImportAvails</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="TcRnTypes.html#WhereFrom"><span class="hs-identifier hs-type">WhereFrom</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#mkModDeps"><span class="hs-identifier hs-var">mkModDeps</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#modDepsElts"><span class="hs-identifier hs-var">modDepsElts</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span>        </span><span class="hs-comment">-- Typechecker types</span><span>
</span><a name="line-41"></a><span>        </span><a href="TcRnTypes.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcBinderStack"><span class="hs-identifier hs-type">TcBinderStack</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcBinder"><span class="hs-identifier hs-type">TcBinder</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>        </span><a href="TcRnTypes.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#PromotionErr"><span class="hs-identifier hs-type">PromotionErr</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="TcRnTypes.html#IdBindingInfo"><span class="hs-identifier hs-type">IdBindingInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ClosedTypeId"><span class="hs-identifier hs-type">ClosedTypeId</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#RhsNames"><span class="hs-identifier hs-type">RhsNames</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="TcRnTypes.html#IsGroupClosed"><span class="hs-identifier hs-type">IsGroupClosed</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>        </span><a href="TcRnTypes.html#SelfBootInfo"><span class="hs-identifier hs-type">SelfBootInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>        </span><a href="TcRnTypes.html#pprTcTyThingCategory"><span class="hs-identifier hs-var">pprTcTyThingCategory</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#pprPECategory"><span class="hs-identifier hs-var">pprPECategory</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span>        </span><span class="hs-comment">-- Desugaring types</span><span>
</span><a name="line-49"></a><span>        </span><a href="TcRnTypes.html#DsM"><span class="hs-identifier hs-type">DsM</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-50"></a><span>        </span><a href="TcRnTypes.html#DsMetaEnv"><span class="hs-identifier hs-type">DsMetaEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#DsMetaVal"><span class="hs-identifier hs-type">DsMetaVal</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#CompleteMatchMap"><span class="hs-identifier hs-type">CompleteMatchMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>        </span><a href="HscTypes.html#mkCompleteMatchMap"><span class="hs-identifier hs-var">mkCompleteMatchMap</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#extendCompleteMatchMap"><span class="hs-identifier hs-var">extendCompleteMatchMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span>        </span><span class="hs-comment">-- Template Haskell</span><span>
</span><a name="line-54"></a><span>        </span><a href="TcRnTypes.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#SpliceType"><span class="hs-identifier hs-type">SpliceType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#PendingStuff"><span class="hs-identifier hs-type">PendingStuff</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>        </span><a href="TcRnTypes.html#topStage"><span class="hs-identifier hs-var">topStage</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#topAnnStage"><span class="hs-identifier hs-var">topAnnStage</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#topSpliceStage"><span class="hs-identifier hs-var">topSpliceStage</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>        </span><a href="TcRnTypes.html#ThLevel"><span class="hs-identifier hs-type">ThLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#impLevel"><span class="hs-identifier hs-var">impLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#outerLevel"><span class="hs-identifier hs-var">outerLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#thLevel"><span class="hs-identifier hs-var">thLevel</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>        </span><a href="GHC.ForeignSrcLang.Type.html#ForeignSrcLang"><span class="hs-identifier hs-type">ForeignSrcLang</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span>        </span><span class="hs-comment">-- Arrows</span><span>
</span><a name="line-60"></a><span>        </span><a href="TcRnTypes.html#ArrowCtxt"><span class="hs-identifier hs-type">ArrowCtxt</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span>        </span><span class="hs-comment">-- TcSigInfo</span><span>
</span><a name="line-63"></a><span>        </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcSigInfo"><span class="hs-identifier hs-type">TcSigInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>        </span><a href="TcRnTypes.html#TcIdSigInst"><span class="hs-identifier hs-type">TcIdSigInst</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcPatSynInfo"><span class="hs-identifier hs-type">TcPatSynInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>        </span><a href="TcRnTypes.html#isPartialSig"><span class="hs-identifier hs-var">isPartialSig</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#hasCompleteSig"><span class="hs-identifier hs-var">hasCompleteSig</span></a><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>        </span><span class="hs-comment">-- QCInst</span><span>
</span><a name="line-68"></a><span>        </span><a href="TcRnTypes.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isPendingScInst"><span class="hs-identifier hs-var">isPendingScInst</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span>        </span><span class="hs-comment">-- Canonical constraints</span><span>
</span><a name="line-71"></a><span>        </span><a href="TcRnTypes.html#Xi"><span class="hs-identifier hs-type">Xi</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier hs-var">emptyCts</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#andCts"><span class="hs-identifier hs-var">andCts</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#andManyCts"><span class="hs-identifier hs-var">andManyCts</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#pprCts"><span class="hs-identifier hs-var">pprCts</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>        </span><a href="TcRnTypes.html#singleCt"><span class="hs-identifier hs-var">singleCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#listToCts"><span class="hs-identifier hs-var">listToCts</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctsElts"><span class="hs-identifier hs-var">ctsElts</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#consCts"><span class="hs-identifier hs-var">consCts</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#snocCts"><span class="hs-identifier hs-var">snocCts</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#extendCtsList"><span class="hs-identifier hs-var">extendCtsList</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>        </span><a href="TcRnTypes.html#isEmptyCts"><span class="hs-identifier hs-var">isEmptyCts</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isCTyEqCan"><span class="hs-identifier hs-var">isCTyEqCan</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isCFunEqCan"><span class="hs-identifier hs-var">isCFunEqCan</span></a><span class="hs-special">,</span><span>
</span><a name="line-74"></a><span>        </span><a href="TcRnTypes.html#isPendingScDict"><span class="hs-identifier hs-var">isPendingScDict</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#superClassesMightHelp"><span class="hs-identifier hs-var">superClassesMightHelp</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#getPendingWantedScs"><span class="hs-identifier hs-var">getPendingWantedScs</span></a><span class="hs-special">,</span><span>
</span><a name="line-75"></a><span>        </span><a href="TcRnTypes.html#isCDictCan_Maybe"><span class="hs-identifier hs-var">isCDictCan_Maybe</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isCFunEqCan_maybe"><span class="hs-identifier hs-var">isCFunEqCan_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>        </span><a href="TcRnTypes.html#isCNonCanonical"><span class="hs-identifier hs-var">isCNonCanonical</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isWantedCt"><span class="hs-identifier hs-var">isWantedCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isDerivedCt"><span class="hs-identifier hs-var">isDerivedCt</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>        </span><a href="TcRnTypes.html#isGivenCt"><span class="hs-identifier hs-var">isGivenCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isHoleCt"><span class="hs-identifier hs-var">isHoleCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isOutOfScopeCt"><span class="hs-identifier hs-var">isOutOfScopeCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isExprHoleCt"><span class="hs-identifier hs-var">isExprHoleCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isTypeHoleCt"><span class="hs-identifier hs-var">isTypeHoleCt</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>        </span><a href="TcRnTypes.html#isUserTypeErrorCt"><span class="hs-identifier hs-var">isUserTypeErrorCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#getUserTypeErrorMsg"><span class="hs-identifier hs-var">getUserTypeErrorMsg</span></a><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>        </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctLoc"><span class="hs-identifier hs-var">ctLoc</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#setCtLoc"><span class="hs-identifier hs-var">setCtLoc</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctFlavour"><span class="hs-identifier hs-var">ctFlavour</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEqRel"><span class="hs-identifier hs-var">ctEqRel</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctOrigin"><span class="hs-identifier hs-var">ctOrigin</span></a><span class="hs-special">,</span><span>
</span><a name="line-80"></a><span>        </span><a href="TcRnTypes.html#ctEvId"><span class="hs-identifier hs-var">ctEvId</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#mkTcEqPredLikeEv"><span class="hs-identifier hs-var">mkTcEqPredLikeEv</span></a><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>        </span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#mkNonCanonicalCt"><span class="hs-identifier hs-var">mkNonCanonicalCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#mkGivens"><span class="hs-identifier hs-var">mkGivens</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>        </span><a href="TcRnTypes.html#mkIrredCt"><span class="hs-identifier hs-var">mkIrredCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#mkInsolubleCt"><span class="hs-identifier hs-var">mkInsolubleCt</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>        </span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEvOrigin"><span class="hs-identifier hs-var">ctEvOrigin</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEvEqRel"><span class="hs-identifier hs-var">ctEvEqRel</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>        </span><a href="TcRnTypes.html#ctEvExpr"><span class="hs-identifier hs-var">ctEvExpr</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEvTerm"><span class="hs-identifier hs-var">ctEvTerm</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEvCoercion"><span class="hs-identifier hs-var">ctEvCoercion</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEvEvId"><span class="hs-identifier hs-var">ctEvEvId</span></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>        </span><a href="TcRnTypes.html#tyCoVarsOfCt"><span class="hs-identifier hs-var">tyCoVarsOfCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#tyCoVarsOfCts"><span class="hs-identifier hs-var">tyCoVarsOfCts</span></a><span class="hs-special">,</span><span>
</span><a name="line-86"></a><span>        </span><a href="TcRnTypes.html#tyCoVarsOfCtList"><span class="hs-identifier hs-var">tyCoVarsOfCtList</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#tyCoVarsOfCtsList"><span class="hs-identifier hs-var">tyCoVarsOfCtsList</span></a><span class="hs-special">,</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span>        </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#insolubleWC"><span class="hs-identifier hs-var">insolubleWC</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isEmptyWC"><span class="hs-identifier hs-var">isEmptyWC</span></a><span class="hs-special">,</span><span>
</span><a name="line-89"></a><span>        </span><a href="TcRnTypes.html#isSolvedWC"><span class="hs-identifier hs-var">isSolvedWC</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#andWC"><span class="hs-identifier hs-var">andWC</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#unionsWC"><span class="hs-identifier hs-var">unionsWC</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#mkSimpleWC"><span class="hs-identifier hs-var">mkSimpleWC</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#mkImplicWC"><span class="hs-identifier hs-var">mkImplicWC</span></a><span class="hs-special">,</span><span>
</span><a name="line-90"></a><span>        </span><a href="TcRnTypes.html#addInsols"><span class="hs-identifier hs-var">addInsols</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#insolublesOnly"><span class="hs-identifier hs-var">insolublesOnly</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#addSimples"><span class="hs-identifier hs-var">addSimples</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#addImplics"><span class="hs-identifier hs-var">addImplics</span></a><span class="hs-special">,</span><span>
</span><a name="line-91"></a><span>        </span><a href="TcRnTypes.html#tyCoVarsOfWC"><span class="hs-identifier hs-var">tyCoVarsOfWC</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#dropDerivedWC"><span class="hs-identifier hs-var">dropDerivedWC</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#dropDerivedSimples"><span class="hs-identifier hs-var">dropDerivedSimples</span></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>        </span><a href="TcRnTypes.html#tyCoVarsOfWCList"><span class="hs-identifier hs-var">tyCoVarsOfWCList</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#insolubleCt"><span class="hs-identifier hs-var">insolubleCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#insolubleEqCt"><span class="hs-identifier hs-var">insolubleEqCt</span></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>        </span><a href="TcRnTypes.html#isDroppableCt"><span class="hs-identifier hs-var">isDroppableCt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#insolubleImplic"><span class="hs-identifier hs-var">insolubleImplic</span></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>        </span><a href="TcRnTypes.html#arisesFromGivens"><span class="hs-identifier hs-var">arisesFromGivens</span></a><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>        </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#newImplication"><span class="hs-identifier hs-var">newImplication</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#implicationPrototype"><span class="hs-identifier hs-var">implicationPrototype</span></a><span class="hs-special">,</span><span>
</span><a name="line-97"></a><span>        </span><a href="TcRnTypes.html#implicLclEnv"><span class="hs-identifier hs-var">implicLclEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#implicDynFlags"><span class="hs-identifier hs-var">implicDynFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-98"></a><span>        </span><a href="TcRnTypes.html#ImplicStatus"><span class="hs-identifier hs-type">ImplicStatus</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isInsolubleStatus"><span class="hs-identifier hs-var">isInsolubleStatus</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isSolvedStatus"><span class="hs-identifier hs-var">isSolvedStatus</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>        </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-type">SubGoalDepth</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#initialSubGoalDepth"><span class="hs-identifier hs-var">initialSubGoalDepth</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#maxSubGoalDepth"><span class="hs-identifier hs-var">maxSubGoalDepth</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>        </span><a href="TcRnTypes.html#bumpSubGoalDepth"><span class="hs-identifier hs-var">bumpSubGoalDepth</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#subGoalDepthExceeded"><span class="hs-identifier hs-var">subGoalDepthExceeded</span></a><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>        </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctLocSpan"><span class="hs-identifier hs-var">ctLocSpan</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctLocEnv"><span class="hs-identifier hs-var">ctLocEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctLocLevel"><span class="hs-identifier hs-var">ctLocLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>        </span><a href="TcRnTypes.html#ctLocTypeOrKind_maybe"><span class="hs-identifier hs-var">ctLocTypeOrKind_maybe</span></a><span class="hs-special">,</span><span>
</span><a name="line-103"></a><span>        </span><a href="TcRnTypes.html#ctLocDepth"><span class="hs-identifier hs-var">ctLocDepth</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#bumpCtLocDepth"><span class="hs-identifier hs-var">bumpCtLocDepth</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isGivenLoc"><span class="hs-identifier hs-var">isGivenLoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-104"></a><span>        </span><a href="TcRnTypes.html#setCtLocOrigin"><span class="hs-identifier hs-var">setCtLocOrigin</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#updateCtLocOrigin"><span class="hs-identifier hs-var">updateCtLocOrigin</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#setCtLocEnv"><span class="hs-identifier hs-var">setCtLocEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#setCtLocSpan"><span class="hs-identifier hs-var">setCtLocSpan</span></a><span class="hs-special">,</span><span>
</span><a name="line-105"></a><span>        </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#exprCtOrigin"><span class="hs-identifier hs-var">exprCtOrigin</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#matchesCtOrigin"><span class="hs-identifier hs-var">matchesCtOrigin</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#grhssCtOrigin"><span class="hs-identifier hs-var">grhssCtOrigin</span></a><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>        </span><a href="TcRnTypes.html#isVisibleOrigin"><span class="hs-identifier hs-var">isVisibleOrigin</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#toInvisibleOrigin"><span class="hs-identifier hs-var">toInvisibleOrigin</span></a><span class="hs-special">,</span><span>
</span><a name="line-107"></a><span>        </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier hs-var">isTypeLevel</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isKindLevel"><span class="hs-identifier hs-var">isKindLevel</span></a><span class="hs-special">,</span><span>
</span><a name="line-108"></a><span>        </span><a href="TcRnTypes.html#pprCtOrigin"><span class="hs-identifier hs-var">pprCtOrigin</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#pprCtLoc"><span class="hs-identifier hs-var">pprCtLoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>        </span><a href="TcRnTypes.html#pushErrCtxt"><span class="hs-identifier hs-var">pushErrCtxt</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#pushErrCtxtSameOrigin"><span class="hs-identifier hs-var">pushErrCtxtSameOrigin</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span>        </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#pprSigSkolInfo"><span class="hs-identifier hs-var">pprSigSkolInfo</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#pprSkolInfo"><span class="hs-identifier hs-var">pprSkolInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span>        </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcEvDest"><span class="hs-identifier hs-type">TcEvDest</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-115"></a><span>        </span><a href="TcRnTypes.html#mkKindLoc"><span class="hs-identifier hs-var">mkKindLoc</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#toKindLoc"><span class="hs-identifier hs-var">toKindLoc</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#mkGivenLoc"><span class="hs-identifier hs-var">mkGivenLoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-116"></a><span>        </span><a href="TcRnTypes.html#isWanted"><span class="hs-identifier hs-var">isWanted</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isGiven"><span class="hs-identifier hs-var">isGiven</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isDerived"><span class="hs-identifier hs-var">isDerived</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#isGivenOrWDeriv"><span class="hs-identifier hs-var">isGivenOrWDeriv</span></a><span class="hs-special">,</span><span>
</span><a name="line-117"></a><span>        </span><a href="TcRnTypes.html#ctEvRole"><span class="hs-identifier hs-var">ctEvRole</span></a><span class="hs-special">,</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span>        </span><a href="TcRnTypes.html#wrapType"><span class="hs-identifier hs-var">wrapType</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#wrapTypeWithImplication"><span class="hs-identifier hs-var">wrapTypeWithImplication</span></a><span class="hs-special">,</span><span>
</span><a name="line-120"></a><span>        </span><a href="TcRnTypes.html#removeBindingShadowing"><span class="hs-identifier hs-var">removeBindingShadowing</span></a><span class="hs-special">,</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span>        </span><span class="hs-comment">-- Constraint solver plugins</span><span>
</span><a name="line-123"></a><span>        </span><a href="TcRnTypes.html#TcPlugin"><span class="hs-identifier hs-type">TcPlugin</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcPluginResult"><span class="hs-identifier hs-type">TcPluginResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcPluginSolver"><span class="hs-identifier hs-type">TcPluginSolver</span></a><span class="hs-special">,</span><span>
</span><a name="line-124"></a><span>        </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#runTcPluginM"><span class="hs-identifier hs-var">runTcPluginM</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#unsafeTcPluginTcM"><span class="hs-identifier hs-var">unsafeTcPluginTcM</span></a><span class="hs-special">,</span><span>
</span><a name="line-125"></a><span>        </span><a href="TcRnTypes.html#getEvBindsTcPluginM"><span class="hs-identifier hs-var">getEvBindsTcPluginM</span></a><span class="hs-special">,</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span>        </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ShadowInfo"><span class="hs-identifier hs-type">ShadowInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span class="hs-special">,</span><span>
</span><a name="line-128"></a><span>        </span><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEvFlavourRole"><span class="hs-identifier hs-var">ctEvFlavourRole</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctFlavourRole"><span class="hs-identifier hs-var">ctFlavourRole</span></a><span class="hs-special">,</span><span>
</span><a name="line-129"></a><span>        </span><a href="TcRnTypes.html#eqCanRewrite"><span class="hs-identifier hs-var">eqCanRewrite</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#eqCanRewriteFR"><span class="hs-identifier hs-var">eqCanRewriteFR</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#eqMayRewriteFR"><span class="hs-identifier hs-var">eqMayRewriteFR</span></a><span class="hs-special">,</span><span>
</span><a name="line-130"></a><span>        </span><a href="TcRnTypes.html#eqCanDischargeFR"><span class="hs-identifier hs-var">eqCanDischargeFR</span></a><span class="hs-special">,</span><span>
</span><a name="line-131"></a><span>        </span><a href="TcRnTypes.html#funEqCanDischarge"><span class="hs-identifier hs-var">funEqCanDischarge</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#funEqCanDischargeF"><span class="hs-identifier hs-var">funEqCanDischargeF</span></a><span class="hs-special">,</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span>        </span><span class="hs-comment">-- Pretty printing</span><span>
</span><a name="line-134"></a><span>        </span><a href="TcRnTypes.html#pprEvVarTheta"><span class="hs-identifier hs-var">pprEvVarTheta</span></a><span class="hs-special">,</span><span>
</span><a name="line-135"></a><span>        </span><a href="TcRnTypes.html#pprEvVars"><span class="hs-identifier hs-var">pprEvVars</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#pprEvVarWithType"><span class="hs-identifier hs-var">pprEvVarWithType</span></a><span class="hs-special">,</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span>        </span><span class="hs-comment">-- Misc other types</span><span>
</span><a name="line-138"></a><span>        </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#TcIdSet"><span class="hs-identifier hs-type">TcIdSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-139"></a><span>        </span><a href="TcRnTypes.html#Hole"><span class="hs-identifier hs-type">Hole</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#holeOcc"><span class="hs-identifier hs-var">holeOcc</span></a><span class="hs-special">,</span><span>
</span><a name="line-140"></a><span>        </span><a href="TcRnTypes.html#NameShape"><span class="hs-identifier hs-type">NameShape</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>        </span><span class="hs-comment">-- Role annotations</span><span>
</span><a name="line-143"></a><span>        </span><a href="TcRnTypes.html#RoleAnnotEnv"><span class="hs-identifier hs-type">RoleAnnotEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#emptyRoleAnnotEnv"><span class="hs-identifier hs-var">emptyRoleAnnotEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#mkRoleAnnotEnv"><span class="hs-identifier hs-var">mkRoleAnnotEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-144"></a><span>        </span><a href="TcRnTypes.html#lookupRoleAnnot"><span class="hs-identifier hs-var">lookupRoleAnnot</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#getRoleAnnots"><span class="hs-identifier hs-var">getRoleAnnots</span></a><span class="hs-special">,</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-150"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-153"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>
</span><a name="line-154"></a><span class="hs-keyword">import</span><span> </span><a href="HscTypes.html"><span class="hs-identifier">HscTypes</span></a><span>
</span><a name="line-155"></a><span class="hs-keyword">import</span><span> </span><a href="TcEvidence.html"><span class="hs-identifier">TcEvidence</span></a><span>
</span><a name="line-156"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-157"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>    </span><span class="hs-special">(</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a><span class="hs-special">,</span><span> </span><a href="TyCon.html#tyConKind"><span class="hs-identifier hs-var">tyConKind</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span class="hs-keyword">import</span><span> </span><a href="TyCoRep.html"><span class="hs-identifier">TyCoRep</span></a><span>  </span><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span class="hs-keyword">import</span><span> </span><a href="Coercion.html"><span class="hs-identifier">Coercion</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span class="hs-special">,</span><span> </span><a href="Coercion.html#mkHoleCo"><span class="hs-identifier hs-var">mkHoleCo</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span class="hs-keyword">import</span><span> </span><a href="ConLike.html"><span class="hs-identifier">ConLike</span></a><span>  </span><span class="hs-special">(</span><span> </span><a href="ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>  </span><span class="hs-special">(</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConUserType"><span class="hs-identifier hs-var">dataConUserType</span></a><span class="hs-special">,</span><span> </span><a href="DataCon.html#dataConOrigArgTys"><span class="hs-identifier hs-var">dataConOrigArgTys</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span class="hs-keyword">import</span><span> </span><a href="PatSyn.html"><span class="hs-identifier">PatSyn</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a><span class="hs-special">,</span><span> </span><a href="PatSyn.html#pprPatSynType"><span class="hs-identifier hs-var">pprPatSynType</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>       </span><span class="hs-special">(</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span class="hs-special">,</span><span> </span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span class="hs-keyword">import</span><span> </span><a href="FieldLabel.html"><span class="hs-identifier">FieldLabel</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span class="hs-keyword">import</span><span> </span><a href="TcType.html"><span class="hs-identifier">TcType</span></a><span>
</span><a name="line-167"></a><span class="hs-keyword">import</span><span> </span><a href="Annotations.html"><span class="hs-identifier">Annotations</span></a><span>
</span><a name="line-168"></a><span class="hs-keyword">import</span><span> </span><a href="InstEnv.html"><span class="hs-identifier">InstEnv</span></a><span>
</span><a name="line-169"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span>
</span><a name="line-170"></a><span class="hs-keyword">import</span><span> </span><a href="PmExpr.html"><span class="hs-identifier">PmExpr</span></a><span>
</span><a name="line-171"></a><span class="hs-keyword">import</span><span> </span><a href="IOEnv.html"><span class="hs-identifier">IOEnv</span></a><span>
</span><a name="line-172"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span>
</span><a name="line-173"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-174"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-175"></a><span class="hs-keyword">import</span><span> </span><a href="NameSet.html"><span class="hs-identifier">NameSet</span></a><span>
</span><a name="line-176"></a><span class="hs-keyword">import</span><span> </span><a href="Avail.html"><span class="hs-identifier">Avail</span></a><span>
</span><a name="line-177"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-178"></a><span class="hs-keyword">import</span><span> </span><a href="FV.html"><span class="hs-identifier">FV</span></a><span>
</span><a name="line-179"></a><span class="hs-keyword">import</span><span> </span><a href="VarEnv.html"><span class="hs-identifier">VarEnv</span></a><span>
</span><a name="line-180"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-181"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-182"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-183"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span>
</span><a name="line-184"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-185"></a><span class="hs-keyword">import</span><span> </span><a href="UniqSupply.html"><span class="hs-identifier">UniqSupply</span></a><span>
</span><a name="line-186"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-187"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-188"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-189"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-190"></a><span class="hs-keyword">import</span><span> </span><a href="ListSetOps.html"><span class="hs-identifier">ListSetOps</span></a><span>
</span><a name="line-191"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-192"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-193"></a><span class="hs-keyword">import</span><span> </span><a href="Fingerprint.html"><span class="hs-identifier">Fingerprint</span></a><span>
</span><a name="line-194"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-195"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="PrelNames.html#isUnboundName"><span class="hs-identifier hs-var">isUnboundName</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span class="hs-keyword">import</span><span> </span><a href="CostCentreState.html"><span class="hs-identifier">CostCentreState</span></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ap</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">msum</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Monad.Fail</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MonadFail</span><span>
</span><a name="line-200"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Set</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Dynamic</span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Dynamic</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Typeable</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span class="hs-keyword">import</span><span> </span><a href="GHCi.Message.html"><span class="hs-identifier">GHCi.Message</span></a><span>
</span><a name="line-209"></a><span class="hs-keyword">import</span><span> </span><a href="GHCi.RemoteTypes.html"><span class="hs-identifier">GHCi.RemoteTypes</span></a><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Language.Haskell.TH.html"><span class="hs-identifier">Language.Haskell.TH</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TH</span><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-comment">-- | A 'NameShape' is a substitution on 'Name's that can be used</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- to refine the identities of a hole while we are renaming interfaces</span><span>
</span><a name="line-215"></a><span class="hs-comment">-- (see 'RnModIface').  Specifically, a 'NameShape' for</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- 'ns_module_name' @A@, defines a mapping from @{A.T}@</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- (for some 'OccName' @T@) to some arbitrary other 'Name'.</span><span>
</span><a name="line-218"></a><span class="hs-comment">--</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- The most intruiging thing about a 'NameShape', however, is</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- how it's constructed.  A 'NameShape' is *implied* by the</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- exported 'AvailInfo's of the implementor of an interface:</span><span>
</span><a name="line-222"></a><span class="hs-comment">-- if an implementor of signature @&lt;H&gt;@ exports @M.T@, you implicitly</span><span>
</span><a name="line-223"></a><span class="hs-comment">-- define a substitution from @{H.T}@ to @M.T@.  So a 'NameShape'</span><span>
</span><a name="line-224"></a><span class="hs-comment">-- is computed from the list of 'AvailInfo's that are exported</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- by the implementation of a module, or successively merged</span><span>
</span><a name="line-226"></a><span class="hs-comment">-- together by the export lists of signatures which are joining</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- together.</span><span>
</span><a name="line-228"></a><span class="hs-comment">--</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- It's not the most obvious way to go about doing this, but it</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- does seem to work!</span><span>
</span><a name="line-231"></a><span class="hs-comment">--</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- NB: Can't boot this and put it in NameShape because then we</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- start pulling in too many DynFlags things.</span><span>
</span><a name="line-234"></a><span class="hs-keyword">data</span><span> </span><a name="NameShape"><a href="TcRnTypes.html#NameShape"><span class="hs-identifier">NameShape</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="NameShape"><a href="TcRnTypes.html#NameShape"><span class="hs-identifier">NameShape</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-235"></a><span>        </span><a name="ns_mod_name"><a href="TcRnTypes.html#ns_mod_name"><span class="hs-identifier">ns_mod_name</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span>
</span><a name="line-236"></a><span>        </span><a name="ns_exports"><a href="TcRnTypes.html#ns_exports"><span class="hs-identifier">ns_exports</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-237"></a><span>        </span><a name="ns_map"><a href="TcRnTypes.html#ns_map"><span class="hs-identifier">ns_map</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccEnv"><span class="hs-identifier hs-type">OccEnv</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-238"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
               Standard monad definition for TcRn
    All the combinators for the monad can be found in TcRnMonad
*                                                                      *
************************************************************************

The monad itself has to be defined here, because it is mentioned by ErrCtxt
-}</span><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-keyword">type</span><span> </span><a name="TcRnIf"><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier">TcRnIf</span></a></a><span> </span><a name="local-6989586621684145916"><a href="#local-6989586621684145916"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621684145917"><a href="#local-6989586621684145917"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="IOEnv.html#IOEnv"><span class="hs-identifier hs-type">IOEnv</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><a href="#local-6989586621684145916"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621684145917"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span class="hs-keyword">type</span><span> </span><a name="TcRn"><a href="TcRnTypes.html#TcRn"><span class="hs-identifier">TcRn</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span>    </span><span class="hs-comment">-- Type inference</span><span>
</span><a name="line-254"></a><span class="hs-keyword">type</span><span> </span><a name="IfM"><a href="TcRnTypes.html#IfM"><span class="hs-identifier">IfM</span></a></a><span> </span><a name="local-6989586621684145915"><a href="#local-6989586621684145915"><span class="hs-identifier">lcl</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="TcRnTypes.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a><span> </span><a href="#local-6989586621684145915"><span class="hs-identifier hs-type">lcl</span></a><span>         </span><span class="hs-comment">-- Iface stuff</span><span>
</span><a name="line-255"></a><span class="hs-keyword">type</span><span> </span><a name="IfG"><a href="TcRnTypes.html#IfG"><span class="hs-identifier">IfG</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#IfM"><span class="hs-identifier hs-type">IfM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>                      </span><span class="hs-comment">--    Top level</span><span>
</span><a name="line-256"></a><span class="hs-keyword">type</span><span> </span><a name="IfL"><a href="TcRnTypes.html#IfL"><span class="hs-identifier">IfL</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#IfM"><span class="hs-identifier hs-type">IfM</span></a><span> </span><a href="TcRnTypes.html#IfLclEnv"><span class="hs-identifier hs-type">IfLclEnv</span></a><span>                </span><span class="hs-comment">--    Nested</span><span>
</span><a name="line-257"></a><span class="hs-keyword">type</span><span> </span><a name="DsM"><a href="TcRnTypes.html#DsM"><span class="hs-identifier">DsM</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a><span> </span><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a><span> </span><a href="TcRnTypes.html#DsLclEnv"><span class="hs-identifier hs-type">DsLclEnv</span></a><span>    </span><span class="hs-comment">-- Desugaring</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-comment">-- TcRn is the type-checking and renaming monad: the main monad that</span><span>
</span><a name="line-260"></a><span class="hs-comment">-- most type-checking takes place in.  The global environment is</span><span>
</span><a name="line-261"></a><span class="hs-comment">-- 'TcGblEnv', which tracks all of the top-level type-checking</span><span>
</span><a name="line-262"></a><span class="hs-comment">-- information we've accumulated while checking a module, while the</span><span>
</span><a name="line-263"></a><span class="hs-comment">-- local environment is 'TcLclEnv', which tracks local information as</span><span>
</span><a name="line-264"></a><span class="hs-comment">-- we move inside expressions.</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-comment">-- | Historical &quot;renaming monad&quot; (now it's just 'TcRn').</span><span>
</span><a name="line-267"></a><span class="hs-keyword">type</span><span> </span><a name="RnM"><a href="TcRnTypes.html#RnM"><span class="hs-identifier">RnM</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-comment">-- | Historical &quot;type-checking monad&quot; (now it's just 'TcRn').</span><span>
</span><a name="line-270"></a><span class="hs-keyword">type</span><span> </span><a name="TcM"><a href="TcRnTypes.html#TcM"><span class="hs-identifier">TcM</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-comment">-- We 'stack' these envs through the Reader like monad infrastructure</span><span>
</span><a name="line-273"></a><span class="hs-comment">-- as we move into an expression (although the change is focused in</span><span>
</span><a name="line-274"></a><span class="hs-comment">-- the lcl type).</span><span>
</span><a name="line-275"></a><span class="hs-keyword">data</span><span> </span><a name="Env"><a href="TcRnTypes.html#Env"><span class="hs-identifier">Env</span></a></a><span> </span><a name="local-6989586621684145913"><a href="#local-6989586621684145913"><span class="hs-identifier">gbl</span></a></a><span> </span><a name="local-6989586621684145914"><a href="#local-6989586621684145914"><span class="hs-identifier">lcl</span></a></a><span>
</span><a name="line-276"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Env"><a href="TcRnTypes.html#Env"><span class="hs-identifier">Env</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-277"></a><span>        </span><a name="env_top"><a href="TcRnTypes.html#env_top"><span class="hs-identifier">env_top</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Top-level stuff that never changes</span><span>
</span><a name="line-278"></a><span>                             </span><span class="hs-comment">-- Includes all info about imported things</span><span>
</span><a name="line-279"></a><span>                             </span><span class="hs-comment">-- BangPattern is to fix leak, see #15111</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span>        </span><a name="env_us"><a href="TcRnTypes.html#env_us"><span class="hs-identifier">env_us</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="UniqSupply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-282"></a><span>                             </span><span class="hs-comment">-- Unique supply for local variables</span><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span>        </span><a name="env_gbl"><a href="TcRnTypes.html#env_gbl"><span class="hs-identifier">env_gbl</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621684145913"><span class="hs-identifier hs-type">gbl</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Info about things defined at the top level</span><span>
</span><a name="line-285"></a><span>                             </span><span class="hs-comment">-- of the module being compiled</span><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span>        </span><a name="env_lcl"><a href="TcRnTypes.html#env_lcl"><span class="hs-identifier">env_lcl</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621684145914"><span class="hs-identifier hs-type">lcl</span></a><span>      </span><span class="hs-comment">-- Nested stuff; changes as we go into</span><span>
</span><a name="line-288"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span class="hs-keyword">instance</span><span> </span><a href="DynFlags.html#ContainsDynFlags"><span class="hs-identifier hs-type">ContainsDynFlags</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><a href="#local-6989586621684145986"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621684145987"><span class="hs-identifier hs-type">lcl</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-291"></a><span>    </span><a name="local-8214565720325324393"><a href="DynFlags.html#extractDynFlags"><span class="hs-identifier">extractDynFlags</span></a></a><span> </span><a name="local-6989586621684145988"><a href="#local-6989586621684145988"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">env_top</span><span> </span><a href="#local-6989586621684145988"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-keyword">instance</span><span> </span><a href="Module.html#ContainsModule"><span class="hs-identifier hs-type">ContainsModule</span></a><span> </span><a href="#local-6989586621684145983"><span class="hs-identifier hs-type">gbl</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Module.html#ContainsModule"><span class="hs-identifier hs-type">ContainsModule</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><a href="#local-6989586621684145983"><span class="hs-identifier hs-type">gbl</span></a><span> </span><a href="#local-6989586621684145984"><span class="hs-identifier hs-type">lcl</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-294"></a><span>    </span><a name="local-8214565720325186564"><a href="Module.html#extractModule"><span class="hs-identifier">extractModule</span></a></a><span> </span><a name="local-6989586621684145985"><a href="#local-6989586621684145985"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#extractModule"><span class="hs-identifier hs-var">extractModule</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">env_gbl</span><span> </span><a href="#local-6989586621684145985"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                The interface environments
              Used when dealing with IfaceDecls
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-keyword">data</span><span> </span><a name="IfGblEnv"><a href="TcRnTypes.html#IfGblEnv"><span class="hs-identifier">IfGblEnv</span></a></a><span>
</span><a name="line-307"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IfGblEnv"><a href="TcRnTypes.html#IfGblEnv"><span class="hs-identifier">IfGblEnv</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-308"></a><span>        </span><span class="hs-comment">-- Some information about where this environment came from;</span><span>
</span><a name="line-309"></a><span>        </span><span class="hs-comment">-- useful for debugging.</span><span>
</span><a name="line-310"></a><span>        </span><a name="if_doc"><a href="TcRnTypes.html#if_doc"><span class="hs-identifier">if_doc</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-311"></a><span>        </span><span class="hs-comment">-- The type environment for the module being compiled,</span><span>
</span><a name="line-312"></a><span>        </span><span class="hs-comment">-- in case the interface refers back to it via a reference that</span><span>
</span><a name="line-313"></a><span>        </span><span class="hs-comment">-- was originally a hi-boot file.</span><span>
</span><a name="line-314"></a><span>        </span><span class="hs-comment">-- We need the module name so we can test when it's appropriate</span><span>
</span><a name="line-315"></a><span>        </span><span class="hs-comment">-- to look in this env.</span><span>
</span><a name="line-316"></a><span>        </span><span class="hs-comment">-- See Note [Tying the knot] in TcIface</span><span>
</span><a name="line-317"></a><span>        </span><a name="if_rec_types"><a href="TcRnTypes.html#if_rec_types"><span class="hs-identifier">if_rec_types</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#IfG"><span class="hs-identifier hs-type">IfG</span></a><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-318"></a><span>                </span><span class="hs-comment">-- Allows a read effect, so it can be in a mutable</span><span>
</span><a name="line-319"></a><span>                </span><span class="hs-comment">-- variable; c.f. handling the external package type env</span><span>
</span><a name="line-320"></a><span>                </span><span class="hs-comment">-- Nothing =&gt; interactive stuff, no loops possible</span><span>
</span><a name="line-321"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span class="hs-keyword">data</span><span> </span><a name="IfLclEnv"><a href="TcRnTypes.html#IfLclEnv"><span class="hs-identifier">IfLclEnv</span></a></a><span>
</span><a name="line-324"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IfLclEnv"><a href="TcRnTypes.html#IfLclEnv"><span class="hs-identifier">IfLclEnv</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-325"></a><span>        </span><span class="hs-comment">-- The module for the current IfaceDecl</span><span>
</span><a name="line-326"></a><span>        </span><span class="hs-comment">-- So if we see   f = \x -&gt; x</span><span>
</span><a name="line-327"></a><span>        </span><span class="hs-comment">-- it means M.f = \x -&gt; x, where M is the if_mod</span><span>
</span><a name="line-328"></a><span>        </span><span class="hs-comment">-- NB: This is a semantic module, see</span><span>
</span><a name="line-329"></a><span>        </span><span class="hs-comment">-- Note [Identity versus semantic module]</span><span>
</span><a name="line-330"></a><span>        </span><a name="if_mod"><a href="TcRnTypes.html#if_mod"><span class="hs-identifier">if_mod</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span>        </span><span class="hs-comment">-- Whether or not the IfaceDecl came from a boot</span><span>
</span><a name="line-333"></a><span>        </span><span class="hs-comment">-- file or not; we'll use this to choose between</span><span>
</span><a name="line-334"></a><span>        </span><span class="hs-comment">-- NoUnfolding and BootUnfolding</span><span>
</span><a name="line-335"></a><span>        </span><a name="if_boot"><a href="TcRnTypes.html#if_boot"><span class="hs-identifier">if_boot</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span>        </span><span class="hs-comment">-- The field is used only for error reporting</span><span>
</span><a name="line-338"></a><span>        </span><span class="hs-comment">-- if (say) there's a Lint error in it</span><span>
</span><a name="line-339"></a><span>        </span><a name="if_loc"><a href="TcRnTypes.html#if_loc"><span class="hs-identifier">if_loc</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">,</span><span>
</span><a name="line-340"></a><span>                </span><span class="hs-comment">-- Where the interface came from:</span><span>
</span><a name="line-341"></a><span>                </span><span class="hs-comment">--      .hi file, or GHCi state, or ext core</span><span>
</span><a name="line-342"></a><span>                </span><span class="hs-comment">-- plus which bit is currently being examined</span><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span>        </span><a name="if_nsubst"><a href="TcRnTypes.html#if_nsubst"><span class="hs-identifier">if_nsubst</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TcRnTypes.html#NameShape"><span class="hs-identifier hs-type">NameShape</span></a><span class="hs-special">,</span><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span>        </span><span class="hs-comment">-- This field is used to make sure &quot;implicit&quot; declarations</span><span>
</span><a name="line-347"></a><span>        </span><span class="hs-comment">-- (anything that cannot be exported in mi_exports) get</span><span>
</span><a name="line-348"></a><span>        </span><span class="hs-comment">-- wired up correctly in typecheckIfacesForMerging.  Most</span><span>
</span><a name="line-349"></a><span>        </span><span class="hs-comment">-- of the time it's @Nothing@.  See Note [Resolving never-exported Names in TcIface]</span><span>
</span><a name="line-350"></a><span>        </span><span class="hs-comment">-- in TcIface.</span><span>
</span><a name="line-351"></a><span>        </span><a name="if_implicits_env"><a href="TcRnTypes.html#if_implicits_env"><span class="hs-identifier">if_implicits_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span>        </span><a name="if_tv_env"><a href="TcRnTypes.html#if_tv_env"><span class="hs-identifier">if_tv_env</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="FastStringEnv.html#FastStringEnv"><span class="hs-identifier hs-type">FastStringEnv</span></a><span> </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Nested tyvar bindings</span><span>
</span><a name="line-354"></a><span>        </span><a name="if_id_env"><a href="TcRnTypes.html#if_id_env"><span class="hs-identifier">if_id_env</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="FastStringEnv.html#FastStringEnv"><span class="hs-identifier hs-type">FastStringEnv</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>         </span><span class="hs-comment">-- Nested id binding</span><span>
</span><a name="line-355"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-356"></a><span>
</span><a name="line-357"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Desugarer monad
*                                                                      *
************************************************************************

Now the mondo monad magic (yes, @DsM@ is a silly name)---carry around
a @UniqueSupply@ and some annotations, which
presumably include source-file location information:
-}</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span class="hs-keyword">data</span><span> </span><a name="DsGblEnv"><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier">DsGblEnv</span></a></a><span>
</span><a name="line-370"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="DsGblEnv"><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier">DsGblEnv</span></a></a><span>
</span><a name="line-371"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="ds_mod"><a href="TcRnTypes.html#ds_mod"><span class="hs-identifier">ds_mod</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>             </span><span class="hs-comment">-- For SCC profiling</span><span>
</span><a name="line-372"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="ds_fam_inst_env"><a href="TcRnTypes.html#ds_fam_inst_env"><span class="hs-identifier">ds_fam_inst_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a><span>         </span><span class="hs-comment">-- Like tcg_fam_inst_env</span><span>
</span><a name="line-373"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="ds_unqual"><a href="TcRnTypes.html#ds_unqual"><span class="hs-identifier">ds_unqual</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span>
</span><a name="line-374"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="ds_msgs"><a href="TcRnTypes.html#ds_msgs"><span class="hs-identifier">ds_msgs</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span>          </span><span class="hs-comment">-- Warning messages</span><span>
</span><a name="line-375"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="ds_if_env"><a href="TcRnTypes.html#ds_if_env"><span class="hs-identifier">ds_if_env</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#IfLclEnv"><span class="hs-identifier hs-type">IfLclEnv</span></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Used for looking up global,</span><span>
</span><a name="line-376"></a><span>                                                </span><span class="hs-comment">-- possibly-imported things</span><span>
</span><a name="line-377"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="ds_complete_matches"><a href="TcRnTypes.html#ds_complete_matches"><span class="hs-identifier">ds_complete_matches</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#CompleteMatchMap"><span class="hs-identifier hs-type">CompleteMatchMap</span></a><span>
</span><a name="line-378"></a><span>           </span><span class="hs-comment">-- Additional complete pattern matches</span><span>
</span><a name="line-379"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="ds_cc_st"><a href="TcRnTypes.html#ds_cc_st"><span class="hs-identifier">ds_cc_st</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="CostCentreState.html#CostCentreState"><span class="hs-identifier hs-type">CostCentreState</span></a><span>
</span><a name="line-380"></a><span>           </span><span class="hs-comment">-- Tracking indices for cost centre annotations</span><span>
</span><a name="line-381"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-keyword">instance</span><span> </span><a href="Module.html#ContainsModule"><span class="hs-identifier hs-type">ContainsModule</span></a><span> </span><a href="TcRnTypes.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-384"></a><span>    </span><a name="local-8214565720325186564"><a href="Module.html#extractModule"><span class="hs-identifier">extractModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ds_mod</span><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-keyword">data</span><span> </span><a name="DsLclEnv"><a href="TcRnTypes.html#DsLclEnv"><span class="hs-identifier">DsLclEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DsLclEnv"><a href="TcRnTypes.html#DsLclEnv"><span class="hs-identifier">DsLclEnv</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-387"></a><span>        </span><a name="dsl_meta"><a href="TcRnTypes.html#dsl_meta"><span class="hs-identifier">dsl_meta</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#DsMetaEnv"><span class="hs-identifier hs-type">DsMetaEnv</span></a><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- Template Haskell bindings</span><span>
</span><a name="line-388"></a><span>        </span><a name="dsl_loc"><a href="TcRnTypes.html#dsl_loc"><span class="hs-identifier">dsl_loc</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- To put in pattern-matching error msgs</span><span>
</span><a name="line-389"></a><span>
</span><a name="line-390"></a><span>        </span><span class="hs-comment">-- See Note [Note [Type and Term Equality Propagation] in Check.hs</span><span>
</span><a name="line-391"></a><span>        </span><span class="hs-comment">-- These two fields are augmented as we walk inwards,</span><span>
</span><a name="line-392"></a><span>        </span><span class="hs-comment">-- through each patttern match in turn</span><span>
</span><a name="line-393"></a><span>        </span><a name="dsl_dicts"><a href="TcRnTypes.html#dsl_dicts"><span class="hs-identifier">dsl_dicts</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Constraints from GADT pattern-matching</span><span>
</span><a name="line-394"></a><span>        </span><a name="dsl_tm_cs"><a href="TcRnTypes.html#dsl_tm_cs"><span class="hs-identifier">dsl_tm_cs</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="PmExpr.html#SimpleEq"><span class="hs-identifier hs-type">SimpleEq</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- Constraints form term-level pattern matching</span><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span>        </span><a name="dsl_pm_iter"><a href="TcRnTypes.html#dsl_pm_iter"><span class="hs-identifier">dsl_pm_iter</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><span class="hs-identifier hs-type">Int</span><span>  </span><span class="hs-comment">-- Number of iterations for pmcheck so far</span><span>
</span><a name="line-397"></a><span>                                  </span><span class="hs-comment">-- We fail if this gets too big</span><span>
</span><a name="line-398"></a><span>     </span><span class="hs-special">}</span><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-comment">-- Inside [| |] brackets, the desugarer looks</span><span>
</span><a name="line-401"></a><span class="hs-comment">-- up variables in the DsMetaEnv</span><span>
</span><a name="line-402"></a><span class="hs-keyword">type</span><span> </span><a name="DsMetaEnv"><a href="TcRnTypes.html#DsMetaEnv"><span class="hs-identifier">DsMetaEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="TcRnTypes.html#DsMetaVal"><span class="hs-identifier hs-type">DsMetaVal</span></a><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span class="hs-keyword">data</span><span> </span><a name="DsMetaVal"><a href="TcRnTypes.html#DsMetaVal"><span class="hs-identifier">DsMetaVal</span></a></a><span>
</span><a name="line-405"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="DsBound"><a href="TcRnTypes.html#DsBound"><span class="hs-identifier">DsBound</span></a></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>         </span><span class="hs-comment">-- Bound by a pattern inside the [| |].</span><span>
</span><a name="line-406"></a><span>                        </span><span class="hs-comment">-- Will be dynamically alpha renamed.</span><span>
</span><a name="line-407"></a><span>                        </span><span class="hs-comment">-- The Id has type THSyntax.Var</span><span>
</span><a name="line-408"></a><span>
</span><a name="line-409"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="DsSplice"><a href="TcRnTypes.html#DsSplice"><span class="hs-identifier">DsSplice</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- These bindings are introduced by</span><span>
</span><a name="line-410"></a><span>                             </span><span class="hs-comment">-- the PendingSplices on a HsBracketOut</span><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span>
</span><a name="line-413"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Global typechecker environment
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-comment">-- | 'FrontendResult' describes the result of running the</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- frontend of a Haskell module.  Usually, you'll get</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- a 'FrontendTypecheck', since running the frontend involves</span><span>
</span><a name="line-424"></a><span class="hs-comment">-- typechecking a program, but for an hs-boot merge you'll</span><span>
</span><a name="line-425"></a><span class="hs-comment">-- just get a ModIface, since no actual typechecking occurred.</span><span>
</span><a name="line-426"></a><span class="hs-comment">--</span><span>
</span><a name="line-427"></a><span class="hs-comment">-- This data type really should be in HscTypes, but it needs</span><span>
</span><a name="line-428"></a><span class="hs-comment">-- to have a TcGblEnv which is only defined here.</span><span>
</span><a name="line-429"></a><span class="hs-keyword">data</span><span> </span><a name="FrontendResult"><a href="TcRnTypes.html#FrontendResult"><span class="hs-identifier">FrontendResult</span></a></a><span>
</span><a name="line-430"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="FrontendTypecheck"><a href="TcRnTypes.html#FrontendTypecheck"><span class="hs-identifier">FrontendTypecheck</span></a></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">-- Note [Identity versus semantic module]</span><span>
</span><a name="line-433"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-434"></a><span class="hs-comment">-- When typechecking an hsig file, it is convenient to keep track</span><span>
</span><a name="line-435"></a><span class="hs-comment">-- of two different &quot;this module&quot; identifiers:</span><span>
</span><a name="line-436"></a><span class="hs-comment">--</span><span>
</span><a name="line-437"></a><span class="hs-comment">--      - The IDENTITY module is simply thisPackage + the module</span><span>
</span><a name="line-438"></a><span class="hs-comment">--        name; i.e. it uniquely *identifies* the interface file</span><span>
</span><a name="line-439"></a><span class="hs-comment">--        we're compiling.  For example, p[A=&lt;A&gt;]:A is an</span><span>
</span><a name="line-440"></a><span class="hs-comment">--        identity module identifying the requirement named A</span><span>
</span><a name="line-441"></a><span class="hs-comment">--        from library p.</span><span>
</span><a name="line-442"></a><span class="hs-comment">--</span><span>
</span><a name="line-443"></a><span class="hs-comment">--      - The SEMANTIC module, which is the actual module that</span><span>
</span><a name="line-444"></a><span class="hs-comment">--        this signature is intended to represent (e.g. if</span><span>
</span><a name="line-445"></a><span class="hs-comment">--        we have a identity module p[A=base:Data.IORef]:A,</span><span>
</span><a name="line-446"></a><span class="hs-comment">--        then the semantic module is base:Data.IORef)</span><span>
</span><a name="line-447"></a><span class="hs-comment">--</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- Which one should you use?</span><span>
</span><a name="line-449"></a><span class="hs-comment">--</span><span>
</span><a name="line-450"></a><span class="hs-comment">--      - In the desugarer and later phases of compilation,</span><span>
</span><a name="line-451"></a><span class="hs-comment">--        identity and semantic modules coincide, since we never compile</span><span>
</span><a name="line-452"></a><span class="hs-comment">--        signatures (we just generate blank object files for</span><span>
</span><a name="line-453"></a><span class="hs-comment">--        hsig files.)</span><span>
</span><a name="line-454"></a><span class="hs-comment">--</span><span>
</span><a name="line-455"></a><span class="hs-comment">--        A corrolary of this is that the following invariant holds at any point</span><span>
</span><a name="line-456"></a><span class="hs-comment">--        past desugaring,</span><span>
</span><a name="line-457"></a><span class="hs-comment">--</span><span>
</span><a name="line-458"></a><span class="hs-comment">--            if I have a Module, this_mod, in hand representing the module</span><span>
</span><a name="line-459"></a><span class="hs-comment">--            currently being compiled,</span><span>
</span><a name="line-460"></a><span class="hs-comment">--            then moduleUnitId this_mod == thisPackage dflags</span><span>
</span><a name="line-461"></a><span class="hs-comment">--</span><span>
</span><a name="line-462"></a><span class="hs-comment">--      - For any code involving Names, we want semantic modules.</span><span>
</span><a name="line-463"></a><span class="hs-comment">--        See lookupIfaceTop in IfaceEnv, mkIface and addFingerprints</span><span>
</span><a name="line-464"></a><span class="hs-comment">--        in MkIface, and tcLookupGlobal in TcEnv</span><span>
</span><a name="line-465"></a><span class="hs-comment">--</span><span>
</span><a name="line-466"></a><span class="hs-comment">--      - When reading interfaces, we want the identity module to</span><span>
</span><a name="line-467"></a><span class="hs-comment">--        identify the specific interface we want (such interfaces</span><span>
</span><a name="line-468"></a><span class="hs-comment">--        should never be loaded into the EPS).  However, if a</span><span>
</span><a name="line-469"></a><span class="hs-comment">--        hole module &lt;A&gt; is requested, we look for A.hi</span><span>
</span><a name="line-470"></a><span class="hs-comment">--        in the home library we are compiling.  (See LoadIface.)</span><span>
</span><a name="line-471"></a><span class="hs-comment">--        Similarly, in RnNames we check for self-imports using</span><span>
</span><a name="line-472"></a><span class="hs-comment">--        identity modules, to allow signatures to import their implementor.</span><span>
</span><a name="line-473"></a><span class="hs-comment">--</span><span>
</span><a name="line-474"></a><span class="hs-comment">--      - For recompilation avoidance, you want the identity module,</span><span>
</span><a name="line-475"></a><span class="hs-comment">--        since that will actually say the specific interface you</span><span>
</span><a name="line-476"></a><span class="hs-comment">--        want to track (and recompile if it changes)</span><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span class="hs-comment">-- | 'TcGblEnv' describes the top-level of the module at the</span><span>
</span><a name="line-479"></a><span class="hs-comment">-- point at which the typechecker is finished work.</span><span>
</span><a name="line-480"></a><span class="hs-comment">-- It is this structure that is handed on to the desugarer</span><span>
</span><a name="line-481"></a><span class="hs-comment">-- For state that needs to be updated during the typechecking</span><span>
</span><a name="line-482"></a><span class="hs-comment">-- phase and returned at end, use a 'TcRef' (= 'IORef').</span><span>
</span><a name="line-483"></a><span class="hs-keyword">data</span><span> </span><a name="TcGblEnv"><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier">TcGblEnv</span></a></a><span>
</span><a name="line-484"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TcGblEnv"><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier">TcGblEnv</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-485"></a><span>        </span><a name="tcg_mod"><a href="TcRnTypes.html#tcg_mod"><span class="hs-identifier">tcg_mod</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- ^ Module being compiled</span><span>
</span><a name="line-486"></a><span>        </span><a name="tcg_semantic_mod"><a href="TcRnTypes.html#tcg_semantic_mod"><span class="hs-identifier">tcg_semantic_mod</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- ^ If a signature, the backing module</span><span>
</span><a name="line-487"></a><span>            </span><span class="hs-comment">-- See also Note [Identity versus semantic module]</span><span>
</span><a name="line-488"></a><span>        </span><a name="tcg_src"><a href="TcRnTypes.html#tcg_src"><span class="hs-identifier">tcg_src</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span class="hs-special">,</span><span>
</span><a name="line-489"></a><span>          </span><span class="hs-comment">-- ^ What kind of module (regular Haskell, hs-boot, hsig)</span><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span>        </span><a name="tcg_rdr_env"><a href="TcRnTypes.html#tcg_rdr_env"><span class="hs-identifier">tcg_rdr_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ Top level envt; used during renaming</span><span>
</span><a name="line-492"></a><span>        </span><a name="tcg_default"><a href="TcRnTypes.html#tcg_default"><span class="hs-identifier">tcg_default</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-493"></a><span>          </span><span class="hs-comment">-- ^ Types used for defaulting. @Nothing@ =&gt; no @default@ decl</span><span>
</span><a name="line-494"></a><span>
</span><a name="line-495"></a><span>        </span><a name="tcg_fix_env"><a href="TcRnTypes.html#tcg_fix_env"><span class="hs-identifier">tcg_fix_env</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ Just for things in this module</span><span>
</span><a name="line-496"></a><span>        </span><a name="tcg_field_env"><a href="TcRnTypes.html#tcg_field_env"><span class="hs-identifier">tcg_field_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#RecFieldEnv"><span class="hs-identifier hs-type">RecFieldEnv</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ Just for things in this module</span><span>
</span><a name="line-497"></a><span>                                        </span><span class="hs-comment">-- See Note [The interactive package] in HscTypes</span><span>
</span><a name="line-498"></a><span>
</span><a name="line-499"></a><span>        </span><a name="tcg_type_env"><a href="TcRnTypes.html#tcg_type_env"><span class="hs-identifier">tcg_type_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-500"></a><span>          </span><span class="hs-comment">-- ^ Global type env for the module we are compiling now.  All</span><span>
</span><a name="line-501"></a><span>          </span><span class="hs-comment">-- TyCons and Classes (for this module) end up in here right away,</span><span>
</span><a name="line-502"></a><span>          </span><span class="hs-comment">-- along with their derived constructors, selectors.</span><span>
</span><a name="line-503"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-504"></a><span>          </span><span class="hs-comment">-- (Ids defined in this module start in the local envt, though they</span><span>
</span><a name="line-505"></a><span>          </span><span class="hs-comment">--  move to the global envt during zonking)</span><span>
</span><a name="line-506"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-507"></a><span>          </span><span class="hs-comment">-- NB: for what &quot;things in this module&quot; means, see</span><span>
</span><a name="line-508"></a><span>          </span><span class="hs-comment">-- Note [The interactive package] in HscTypes</span><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><span>        </span><a name="tcg_type_env_var"><a href="TcRnTypes.html#tcg_type_env_var"><span class="hs-identifier">tcg_type_env_var</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-511"></a><span>                </span><span class="hs-comment">-- Used only to initialise the interface-file</span><span>
</span><a name="line-512"></a><span>                </span><span class="hs-comment">-- typechecker in initIfaceTcRn, so that it can see stuff</span><span>
</span><a name="line-513"></a><span>                </span><span class="hs-comment">-- bound in this module when dealing with hi-boot recursions</span><span>
</span><a name="line-514"></a><span>                </span><span class="hs-comment">-- Updated at intervals (e.g. after dealing with types and classes)</span><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span>        </span><a name="tcg_inst_env"><a href="TcRnTypes.html#tcg_inst_env"><span class="hs-identifier">tcg_inst_env</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-517"></a><span>          </span><span class="hs-comment">-- ^ Instance envt for all /home-package/ modules;</span><span>
</span><a name="line-518"></a><span>          </span><span class="hs-comment">-- Includes the dfuns in tcg_insts</span><span>
</span><a name="line-519"></a><span>          </span><span class="hs-comment">-- NB. BangPattern is to fix a leak, see #15111</span><span>
</span><a name="line-520"></a><span>        </span><a name="tcg_fam_inst_env"><a href="TcRnTypes.html#tcg_fam_inst_env"><span class="hs-identifier">tcg_fam_inst_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Ditto for family instances</span><span>
</span><a name="line-521"></a><span>          </span><span class="hs-comment">-- NB. BangPattern is to fix a leak, see #15111</span><span>
</span><a name="line-522"></a><span>        </span><a name="tcg_ann_env"><a href="TcRnTypes.html#tcg_ann_env"><span class="hs-identifier">tcg_ann_env</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Annotations.html#AnnEnv"><span class="hs-identifier hs-type">AnnEnv</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ And for annotations</span><span>
</span><a name="line-523"></a><span>
</span><a name="line-524"></a><span>                </span><span class="hs-comment">-- Now a bunch of things about this module that are simply</span><span>
</span><a name="line-525"></a><span>                </span><span class="hs-comment">-- accumulated, but never consulted until the end.</span><span>
</span><a name="line-526"></a><span>                </span><span class="hs-comment">-- Nevertheless, it's convenient to accumulate them along</span><span>
</span><a name="line-527"></a><span>                </span><span class="hs-comment">-- with the rest of the info from this module.</span><span>
</span><a name="line-528"></a><span>        </span><a name="tcg_exports"><a href="TcRnTypes.html#tcg_exports"><span class="hs-identifier">tcg_exports</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ What is exported</span><span>
</span><a name="line-529"></a><span>        </span><a name="tcg_imports"><a href="TcRnTypes.html#tcg_imports"><span class="hs-identifier">tcg_imports</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a><span class="hs-special">,</span><span>
</span><a name="line-530"></a><span>          </span><span class="hs-comment">-- ^ Information about what was imported from where, including</span><span>
</span><a name="line-531"></a><span>          </span><span class="hs-comment">-- things bound in this module. Also store Safe Haskell info</span><span>
</span><a name="line-532"></a><span>          </span><span class="hs-comment">-- here about transitive trusted package requirements.</span><span>
</span><a name="line-533"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-534"></a><span>          </span><span class="hs-comment">-- There are not many uses of this field, so you can grep for</span><span>
</span><a name="line-535"></a><span>          </span><span class="hs-comment">-- all them.</span><span>
</span><a name="line-536"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-537"></a><span>          </span><span class="hs-comment">-- The ImportAvails records information about the following</span><span>
</span><a name="line-538"></a><span>          </span><span class="hs-comment">-- things:</span><span>
</span><a name="line-539"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-540"></a><span>          </span><span class="hs-comment">--    1. All of the modules you directly imported (tcRnImports)</span><span>
</span><a name="line-541"></a><span>          </span><span class="hs-comment">--    2. The orphans (only!) of all imported modules in a GHCi</span><span>
</span><a name="line-542"></a><span>          </span><span class="hs-comment">--       session (runTcInteractive)</span><span>
</span><a name="line-543"></a><span>          </span><span class="hs-comment">--    3. The module that instantiated a signature</span><span>
</span><a name="line-544"></a><span>          </span><span class="hs-comment">--    4. Each of the signatures that merged in</span><span>
</span><a name="line-545"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-546"></a><span>          </span><span class="hs-comment">-- It is used in the following ways:</span><span>
</span><a name="line-547"></a><span>          </span><span class="hs-comment">--    - imp_orphs is used to determine what orphan modules should be</span><span>
</span><a name="line-548"></a><span>          </span><span class="hs-comment">--      visible in the context (tcVisibleOrphanMods)</span><span>
</span><a name="line-549"></a><span>          </span><span class="hs-comment">--    - imp_finsts is used to determine what family instances should</span><span>
</span><a name="line-550"></a><span>          </span><span class="hs-comment">--      be visible (tcExtendLocalFamInstEnv)</span><span>
</span><a name="line-551"></a><span>          </span><span class="hs-comment">--    - To resolve the meaning of the export list of a module</span><span>
</span><a name="line-552"></a><span>          </span><span class="hs-comment">--      (tcRnExports)</span><span>
</span><a name="line-553"></a><span>          </span><span class="hs-comment">--    - imp_mods is used to compute usage info (mkIfaceTc, deSugar)</span><span>
</span><a name="line-554"></a><span>          </span><span class="hs-comment">--    - imp_trust_own_pkg is used for Safe Haskell in interfaces</span><span>
</span><a name="line-555"></a><span>          </span><span class="hs-comment">--      (mkIfaceTc, as well as in HscMain)</span><span>
</span><a name="line-556"></a><span>          </span><span class="hs-comment">--    - To create the Dependencies field in interface (mkDependencies)</span><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span>        </span><a name="tcg_dus"><a href="TcRnTypes.html#tcg_dus"><span class="hs-identifier">tcg_dus</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#DefUses"><span class="hs-identifier hs-type">DefUses</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ What is defined in this module and what is used.</span><span>
</span><a name="line-559"></a><span>        </span><a name="tcg_used_gres"><a href="TcRnTypes.html#tcg_used_gres"><span class="hs-identifier">tcg_used_gres</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">[</span><a href="RdrName.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^ Records occurrences of imported entities</span><span>
</span><a name="line-560"></a><span>          </span><span class="hs-comment">-- One entry for each occurrence; but may have different GREs for</span><span>
</span><a name="line-561"></a><span>          </span><span class="hs-comment">-- the same Name See Note [Tracking unused binding and imports]</span><span>
</span><a name="line-562"></a><span>
</span><a name="line-563"></a><span>        </span><a name="tcg_keep"><a href="TcRnTypes.html#tcg_keep"><span class="hs-identifier">tcg_keep</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-564"></a><span>          </span><span class="hs-comment">-- ^ Locally-defined top-level names to keep alive.</span><span>
</span><a name="line-565"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-566"></a><span>          </span><span class="hs-comment">-- &quot;Keep alive&quot; means give them an Exported flag, so that the</span><span>
</span><a name="line-567"></a><span>          </span><span class="hs-comment">-- simplifier does not discard them as dead code, and so that they</span><span>
</span><a name="line-568"></a><span>          </span><span class="hs-comment">-- are exposed in the interface file (but not to export to the</span><span>
</span><a name="line-569"></a><span>          </span><span class="hs-comment">-- user).</span><span>
</span><a name="line-570"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-571"></a><span>          </span><span class="hs-comment">-- Some things, like dict-fun Ids and default-method Ids are &quot;born&quot;</span><span>
</span><a name="line-572"></a><span>          </span><span class="hs-comment">-- with the Exported flag on, for exactly the above reason, but some</span><span>
</span><a name="line-573"></a><span>          </span><span class="hs-comment">-- we only discover as we go.  Specifically:</span><span>
</span><a name="line-574"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-575"></a><span>          </span><span class="hs-comment">--   * The to/from functions for generic data types</span><span>
</span><a name="line-576"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-577"></a><span>          </span><span class="hs-comment">--   * Top-level variables appearing free in the RHS of an orphan</span><span>
</span><a name="line-578"></a><span>          </span><span class="hs-comment">--     rule</span><span>
</span><a name="line-579"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-580"></a><span>          </span><span class="hs-comment">--   * Top-level variables appearing free in a TH bracket</span><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span>        </span><a name="tcg_th_used"><a href="TcRnTypes.html#tcg_th_used"><span class="hs-identifier">tcg_th_used</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>
</span><a name="line-583"></a><span>          </span><span class="hs-comment">-- ^ @True@ &lt;=&gt; Template Haskell syntax used.</span><span>
</span><a name="line-584"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-585"></a><span>          </span><span class="hs-comment">-- We need this so that we can generate a dependency on the</span><span>
</span><a name="line-586"></a><span>          </span><span class="hs-comment">-- Template Haskell package, because the desugarer is going</span><span>
</span><a name="line-587"></a><span>          </span><span class="hs-comment">-- to emit loads of references to TH symbols.  The reference</span><span>
</span><a name="line-588"></a><span>          </span><span class="hs-comment">-- is implicit rather than explicit, so we have to zap a</span><span>
</span><a name="line-589"></a><span>          </span><span class="hs-comment">-- mutable variable.</span><span>
</span><a name="line-590"></a><span>
</span><a name="line-591"></a><span>        </span><a name="tcg_th_splice_used"><a href="TcRnTypes.html#tcg_th_splice_used"><span class="hs-identifier">tcg_th_splice_used</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>
</span><a name="line-592"></a><span>          </span><span class="hs-comment">-- ^ @True@ &lt;=&gt; A Template Haskell splice was used.</span><span>
</span><a name="line-593"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-594"></a><span>          </span><span class="hs-comment">-- Splices disable recompilation avoidance (see #481)</span><span>
</span><a name="line-595"></a><span>
</span><a name="line-596"></a><span>        </span><a name="tcg_th_top_level_locs"><a href="TcRnTypes.html#tcg_th_top_level_locs"><span class="hs-identifier">tcg_th_top_level_locs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set</span><span> </span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-597"></a><span>          </span><span class="hs-comment">-- ^ Locations of the top-level splices; used for providing details on</span><span>
</span><a name="line-598"></a><span>          </span><span class="hs-comment">-- scope in error messages for out-of-scope variables</span><span>
</span><a name="line-599"></a><span>
</span><a name="line-600"></a><span>        </span><a name="tcg_dfun_n"><a href="TcRnTypes.html#tcg_dfun_n"><span class="hs-identifier">tcg_dfun_n</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="OccName.html#OccSet"><span class="hs-identifier hs-type">OccSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-601"></a><span>          </span><span class="hs-comment">-- ^ Allows us to choose unique DFun names.</span><span>
</span><a name="line-602"></a><span>
</span><a name="line-603"></a><span>        </span><a name="tcg_merged"><a href="TcRnTypes.html#tcg_merged"><span class="hs-identifier">tcg_merged</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-604"></a><span>          </span><span class="hs-comment">-- ^ The requirements we merged with; we always have to recompile</span><span>
</span><a name="line-605"></a><span>          </span><span class="hs-comment">-- if any of these changed.</span><span>
</span><a name="line-606"></a><span>
</span><a name="line-607"></a><span>        </span><span class="hs-comment">-- The next fields accumulate the payload of the module</span><span>
</span><a name="line-608"></a><span>        </span><span class="hs-comment">-- The binds, rules and foreign-decl fields are collected</span><span>
</span><a name="line-609"></a><span>        </span><span class="hs-comment">-- initially in un-zonked form and are finally zonked in tcRnSrcDecls</span><span>
</span><a name="line-610"></a><span>
</span><a name="line-611"></a><span>        </span><a name="tcg_rn_exports"><a href="TcRnTypes.html#tcg_rn_exports"><span class="hs-identifier">tcg_rn_exports</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="HsImpExp.html#IE"><span class="hs-identifier hs-type">IE</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Avail.html#Avails"><span class="hs-identifier hs-type">Avails</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-612"></a><span>                </span><span class="hs-comment">-- Nothing &lt;=&gt; no explicit export list</span><span>
</span><a name="line-613"></a><span>                </span><span class="hs-comment">-- Is always Nothing if we don't want to retain renamed</span><span>
</span><a name="line-614"></a><span>                </span><span class="hs-comment">-- exports.</span><span>
</span><a name="line-615"></a><span>                </span><span class="hs-comment">-- If present contains each renamed export list item</span><span>
</span><a name="line-616"></a><span>                </span><span class="hs-comment">-- together with its exported names.</span><span>
</span><a name="line-617"></a><span>
</span><a name="line-618"></a><span>        </span><a name="tcg_rn_imports"><a href="TcRnTypes.html#tcg_rn_imports"><span class="hs-identifier">tcg_rn_imports</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-619"></a><span>                </span><span class="hs-comment">-- Keep the renamed imports regardless.  They are not</span><span>
</span><a name="line-620"></a><span>                </span><span class="hs-comment">-- voluminous and are needed if you want to report unused imports</span><span>
</span><a name="line-621"></a><span>
</span><a name="line-622"></a><span>        </span><a name="tcg_rn_decls"><a href="TcRnTypes.html#tcg_rn_decls"><span class="hs-identifier">tcg_rn_decls</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#HsGroup"><span class="hs-identifier hs-type">HsGroup</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-623"></a><span>          </span><span class="hs-comment">-- ^ Renamed decls, maybe.  @Nothing@ &lt;=&gt; Don't retain renamed</span><span>
</span><a name="line-624"></a><span>          </span><span class="hs-comment">-- decls.</span><span>
</span><a name="line-625"></a><span>
</span><a name="line-626"></a><span>        </span><a name="tcg_dependent_files"><a href="TcRnTypes.html#tcg_dependent_files"><span class="hs-identifier">tcg_dependent_files</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ dependencies from addDependentFile</span><span>
</span><a name="line-627"></a><span>
</span><a name="line-628"></a><span>        </span><a name="tcg_th_topdecls"><a href="TcRnTypes.html#tcg_th_topdecls"><span class="hs-identifier">tcg_th_topdecls</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-629"></a><span>        </span><span class="hs-comment">-- ^ Top-level declarations from addTopDecls</span><span>
</span><a name="line-630"></a><span>
</span><a name="line-631"></a><span>        </span><a name="tcg_th_foreign_files"><a href="TcRnTypes.html#tcg_th_foreign_files"><span class="hs-identifier">tcg_th_foreign_files</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="GHC.ForeignSrcLang.Type.html#ForeignSrcLang"><span class="hs-identifier hs-type">ForeignSrcLang</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-632"></a><span>        </span><span class="hs-comment">-- ^ Foreign files emitted from TH.</span><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span>        </span><a name="tcg_th_topnames"><a href="TcRnTypes.html#tcg_th_topnames"><span class="hs-identifier">tcg_th_topnames</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span class="hs-special">,</span><span>
</span><a name="line-635"></a><span>        </span><span class="hs-comment">-- ^ Exact names bound in top-level declarations in tcg_th_topdecls</span><span>
</span><a name="line-636"></a><span>
</span><a name="line-637"></a><span>        </span><a name="tcg_th_modfinalizers"><a href="TcRnTypes.html#tcg_th_modfinalizers"><span class="hs-identifier">tcg_th_modfinalizers</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span class="hs-special">,</span><span> </span><a href="HsExpr.html#ThModFinalizers"><span class="hs-identifier hs-type">ThModFinalizers</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-638"></a><span>        </span><span class="hs-comment">-- ^ Template Haskell module finalizers.</span><span>
</span><a name="line-639"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-640"></a><span>        </span><span class="hs-comment">-- They can use particular local environments.</span><span>
</span><a name="line-641"></a><span>
</span><a name="line-642"></a><span>        </span><a name="tcg_th_coreplugins"><a href="TcRnTypes.html#tcg_th_coreplugins"><span class="hs-identifier">tcg_th_coreplugins</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-643"></a><span>        </span><span class="hs-comment">-- ^ Core plugins added by Template Haskell code.</span><span>
</span><a name="line-644"></a><span>
</span><a name="line-645"></a><span>        </span><a name="tcg_th_state"><a href="TcRnTypes.html#tcg_th_state"><span class="hs-identifier">tcg_th_state</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-identifier hs-type">TypeRep</span><span> </span><span class="hs-identifier hs-type">Dynamic</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-646"></a><span>        </span><a name="tcg_th_remote_state"><a href="TcRnTypes.html#tcg_th_remote_state"><span class="hs-identifier">tcg_th_remote_state</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="GHCi.Message.html#QState"><span class="hs-identifier hs-type">QState</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-647"></a><span>        </span><span class="hs-comment">-- ^ Template Haskell state</span><span>
</span><a name="line-648"></a><span>
</span><a name="line-649"></a><span>        </span><a name="tcg_ev_binds"><a href="TcRnTypes.html#tcg_ev_binds"><span class="hs-identifier">tcg_ev_binds</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcEvidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- Top-level evidence bindings</span><span>
</span><a name="line-650"></a><span>
</span><a name="line-651"></a><span>        </span><span class="hs-comment">-- Things defined in this module, or (in GHCi)</span><span>
</span><a name="line-652"></a><span>        </span><span class="hs-comment">-- in the declarations for a single GHCi command.</span><span>
</span><a name="line-653"></a><span>        </span><span class="hs-comment">-- For the latter, see Note [The interactive package] in HscTypes</span><span>
</span><a name="line-654"></a><span>        </span><a name="tcg_tr_module"><a href="TcRnTypes.html#tcg_tr_module"><span class="hs-identifier">tcg_tr_module</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- Id for $trModule :: GHC.Types.Module</span><span>
</span><a name="line-655"></a><span>                                             </span><span class="hs-comment">-- for which every module has a top-level defn</span><span>
</span><a name="line-656"></a><span>                                             </span><span class="hs-comment">-- except in GHCi in which case we have Nothing</span><span>
</span><a name="line-657"></a><span>        </span><a name="tcg_binds"><a href="TcRnTypes.html#tcg_binds"><span class="hs-identifier">tcg_binds</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="HsBinds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Value bindings in this module</span><span>
</span><a name="line-658"></a><span>        </span><a name="tcg_sigs"><a href="TcRnTypes.html#tcg_sigs"><span class="hs-identifier">tcg_sigs</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- ...Top-level names that *lack* a signature</span><span>
</span><a name="line-659"></a><span>        </span><a name="tcg_imp_specs"><a href="TcRnTypes.html#tcg_imp_specs"><span class="hs-identifier">tcg_imp_specs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsBinds.html#LTcSpecPrag"><span class="hs-identifier hs-type">LTcSpecPrag</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- ...SPECIALISE prags for imported Ids</span><span>
</span><a name="line-660"></a><span>        </span><a name="tcg_warns"><a href="TcRnTypes.html#tcg_warns"><span class="hs-identifier">tcg_warns</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- ...Warnings and deprecations</span><span>
</span><a name="line-661"></a><span>        </span><a name="tcg_anns"><a href="TcRnTypes.html#tcg_anns"><span class="hs-identifier">tcg_anns</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ...Annotations</span><span>
</span><a name="line-662"></a><span>        </span><a name="tcg_tcs"><a href="TcRnTypes.html#tcg_tcs"><span class="hs-identifier">tcg_tcs</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- ...TyCons and Classes</span><span>
</span><a name="line-663"></a><span>        </span><a name="tcg_insts"><a href="TcRnTypes.html#tcg_insts"><span class="hs-identifier">tcg_insts</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- ...Instances</span><span>
</span><a name="line-664"></a><span>        </span><a name="tcg_fam_insts"><a href="TcRnTypes.html#tcg_fam_insts"><span class="hs-identifier">tcg_fam_insts</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- ...Family instances</span><span>
</span><a name="line-665"></a><span>        </span><a name="tcg_rules"><a href="TcRnTypes.html#tcg_rules"><span class="hs-identifier">tcg_rules</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LRuleDecl"><span class="hs-identifier hs-type">LRuleDecl</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ...Rules</span><span>
</span><a name="line-666"></a><span>        </span><a name="tcg_fords"><a href="TcRnTypes.html#tcg_fords"><span class="hs-identifier">tcg_fords</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LForeignDecl"><span class="hs-identifier hs-type">LForeignDecl</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ...Foreign import &amp; exports</span><span>
</span><a name="line-667"></a><span>        </span><a name="tcg_patsyns"><a href="TcRnTypes.html#tcg_patsyns"><span class="hs-identifier">tcg_patsyns</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- ...Pattern synonyms</span><span>
</span><a name="line-668"></a><span>
</span><a name="line-669"></a><span>        </span><a name="tcg_doc_hdr"><a href="TcRnTypes.html#tcg_doc_hdr"><span class="hs-identifier">tcg_doc_hdr</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HsDoc.html#LHsDocString"><span class="hs-identifier hs-type">LHsDocString</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Maybe Haddock header docs</span><span>
</span><a name="line-670"></a><span>        </span><a name="tcg_hpc"><a href="TcRnTypes.html#tcg_hpc"><span class="hs-identifier">tcg_hpc</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#AnyHpcUsage"><span class="hs-identifier hs-type">AnyHpcUsage</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ @True@ if any part of the</span><span>
</span><a name="line-671"></a><span>                                             </span><span class="hs-comment">--  prog uses hpc instrumentation.</span><span>
</span><a name="line-672"></a><span>           </span><span class="hs-comment">-- NB. BangPattern is to fix a leak, see #15111</span><span>
</span><a name="line-673"></a><span>
</span><a name="line-674"></a><span>        </span><a name="tcg_self_boot"><a href="TcRnTypes.html#tcg_self_boot"><span class="hs-identifier">tcg_self_boot</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SelfBootInfo"><span class="hs-identifier hs-type">SelfBootInfo</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ Whether this module has a</span><span>
</span><a name="line-675"></a><span>                                             </span><span class="hs-comment">-- corresponding hi-boot file</span><span>
</span><a name="line-676"></a><span>
</span><a name="line-677"></a><span>        </span><a name="tcg_main"><a href="TcRnTypes.html#tcg_main"><span class="hs-identifier">tcg_main</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- ^ The Name of the main</span><span>
</span><a name="line-678"></a><span>                                             </span><span class="hs-comment">-- function, if this module is</span><span>
</span><a name="line-679"></a><span>                                             </span><span class="hs-comment">-- the main module.</span><span>
</span><a name="line-680"></a><span>
</span><a name="line-681"></a><span>        </span><a name="tcg_safeInfer"><a href="TcRnTypes.html#tcg_safeInfer"><span class="hs-identifier">tcg_safeInfer</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><a href="ErrUtils.html#WarningMessages"><span class="hs-identifier hs-type">WarningMessages</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-682"></a><span>        </span><span class="hs-comment">-- ^ Has the typechecker inferred this module as -XSafe (Safe Haskell)</span><span>
</span><a name="line-683"></a><span>        </span><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation],</span><span>
</span><a name="line-684"></a><span>        </span><span class="hs-comment">-- although this is used for more than just that failure case.</span><span>
</span><a name="line-685"></a><span>
</span><a name="line-686"></a><span>        </span><a name="tcg_tc_plugins"><a href="TcRnTypes.html#tcg_tc_plugins"><span class="hs-identifier">tcg_tc_plugins</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#TcPluginSolver"><span class="hs-identifier hs-type">TcPluginSolver</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-687"></a><span>        </span><span class="hs-comment">-- ^ A list of user-defined plugins for the constraint solver.</span><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span>        </span><a name="tcg_top_loc"><a href="TcRnTypes.html#tcg_top_loc"><span class="hs-identifier">tcg_top_loc</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a><span class="hs-special">,</span><span>
</span><a name="line-690"></a><span>        </span><span class="hs-comment">-- ^ The RealSrcSpan this module came from</span><span>
</span><a name="line-691"></a><span>
</span><a name="line-692"></a><span>        </span><a name="tcg_static_wc"><a href="TcRnTypes.html#tcg_static_wc"><span class="hs-identifier">tcg_static_wc</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span class="hs-special">,</span><span>
</span><a name="line-693"></a><span>          </span><span class="hs-comment">-- ^ Wanted constraints of static forms.</span><span>
</span><a name="line-694"></a><span>        </span><span class="hs-comment">-- See Note [Constraints in static forms].</span><span>
</span><a name="line-695"></a><span>        </span><a name="tcg_complete_matches"><a href="TcRnTypes.html#tcg_complete_matches"><span class="hs-identifier">tcg_complete_matches</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-696"></a><span>
</span><a name="line-697"></a><span>        </span><span class="hs-comment">-- ^ Tracking indices for cost centre annotations</span><span>
</span><a name="line-698"></a><span>        </span><a name="tcg_cc_st"><a href="TcRnTypes.html#tcg_cc_st"><span class="hs-identifier">tcg_cc_st</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="CostCentreState.html#CostCentreState"><span class="hs-identifier hs-type">CostCentreState</span></a><span>
</span><a name="line-699"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-700"></a><span>
</span><a name="line-701"></a><span class="hs-comment">-- NB: topModIdentity, not topModSemantic!</span><span>
</span><a name="line-702"></a><span class="hs-comment">-- Definition sites of orphan identities will be identity modules, not semantic</span><span>
</span><a name="line-703"></a><span class="hs-comment">-- modules.</span><span>
</span><a name="line-704"></a><span>
</span><a name="line-705"></a><span class="hs-comment">-- Note [Constraints in static forms]</span><span>
</span><a name="line-706"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-707"></a><span class="hs-comment">--</span><span>
</span><a name="line-708"></a><span class="hs-comment">-- When a static form produces constraints like</span><span>
</span><a name="line-709"></a><span class="hs-comment">--</span><span>
</span><a name="line-710"></a><span class="hs-comment">-- f :: StaticPtr (Bool -&gt; String)</span><span>
</span><a name="line-711"></a><span class="hs-comment">-- f = static show</span><span>
</span><a name="line-712"></a><span class="hs-comment">--</span><span>
</span><a name="line-713"></a><span class="hs-comment">-- we collect them in tcg_static_wc and resolve them at the end</span><span>
</span><a name="line-714"></a><span class="hs-comment">-- of type checking. They need to be resolved separately because</span><span>
</span><a name="line-715"></a><span class="hs-comment">-- we don't want to resolve them in the context of the enclosing</span><span>
</span><a name="line-716"></a><span class="hs-comment">-- expression. Consider</span><span>
</span><a name="line-717"></a><span class="hs-comment">--</span><span>
</span><a name="line-718"></a><span class="hs-comment">-- g :: Show a =&gt; StaticPtr (a -&gt; String)</span><span>
</span><a name="line-719"></a><span class="hs-comment">-- g = static show</span><span>
</span><a name="line-720"></a><span class="hs-comment">--</span><span>
</span><a name="line-721"></a><span class="hs-comment">-- If the @Show a0@ constraint that the body of the static form produces was</span><span>
</span><a name="line-722"></a><span class="hs-comment">-- resolved in the context of the enclosing expression, then the body of the</span><span>
</span><a name="line-723"></a><span class="hs-comment">-- static form wouldn't be closed because the Show dictionary would come from</span><span>
</span><a name="line-724"></a><span class="hs-comment">-- g's context instead of coming from the top level.</span><span>
</span><a name="line-725"></a><span>
</span><a name="line-726"></a><span class="hs-identifier">tcVisibleOrphanMods</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-727"></a><a name="tcVisibleOrphanMods"><a href="TcRnTypes.html#tcVisibleOrphanMods"><span class="hs-identifier">tcVisibleOrphanMods</span></a></a><span> </span><a name="local-6989586621684145994"><a href="#local-6989586621684145994"><span class="hs-identifier">tcg_env</span></a></a><span>
</span><a name="line-728"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#mkModuleSet"><span class="hs-identifier hs-var">mkModuleSet</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_mod</span><span> </span><a href="#local-6989586621684145994"><span class="hs-identifier hs-var">tcg_env</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">imp_orphs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcg_imports</span><span> </span><a href="#local-6989586621684145994"><span class="hs-identifier hs-var">tcg_env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-729"></a><span>
</span><a name="line-730"></a><span class="hs-keyword">instance</span><span> </span><a href="Module.html#ContainsModule"><span class="hs-identifier hs-type">ContainsModule</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-731"></a><span>    </span><a name="local-8214565720325186564"><a href="Module.html#extractModule"><span class="hs-identifier">extractModule</span></a></a><span> </span><a name="local-6989586621684145982"><a href="#local-6989586621684145982"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcg_semantic_mod</span><span> </span><a href="#local-6989586621684145982"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-732"></a><span>
</span><a name="line-733"></a><span class="hs-keyword">type</span><span> </span><a name="RecFieldEnv"><a href="TcRnTypes.html#RecFieldEnv"><span class="hs-identifier">RecFieldEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><span class="hs-special">[</span><a href="FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a><span class="hs-special">]</span><span>
</span><a name="line-734"></a><span>        </span><span class="hs-comment">-- Maps a constructor name *in this module*</span><span>
</span><a name="line-735"></a><span>        </span><span class="hs-comment">-- to the fields for that constructor.</span><span>
</span><a name="line-736"></a><span>        </span><span class="hs-comment">-- This is used when dealing with &quot;..&quot; notation in record</span><span>
</span><a name="line-737"></a><span>        </span><span class="hs-comment">-- construction and pattern matching.</span><span>
</span><a name="line-738"></a><span>        </span><span class="hs-comment">-- The FieldEnv deals *only* with constructors defined in *this*</span><span>
</span><a name="line-739"></a><span>        </span><span class="hs-comment">-- module.  For imported modules, we get the same info from the</span><span>
</span><a name="line-740"></a><span>        </span><span class="hs-comment">-- TypeEnv</span><span>
</span><a name="line-741"></a><span>
</span><a name="line-742"></a><span class="hs-keyword">data</span><span> </span><a name="SelfBootInfo"><a href="TcRnTypes.html#SelfBootInfo"><span class="hs-identifier">SelfBootInfo</span></a></a><span>
</span><a name="line-743"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NoSelfBoot"><a href="TcRnTypes.html#NoSelfBoot"><span class="hs-identifier">NoSelfBoot</span></a></a><span>    </span><span class="hs-comment">-- No corresponding hi-boot file</span><span>
</span><a name="line-744"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SelfBoot"><a href="TcRnTypes.html#SelfBoot"><span class="hs-identifier">SelfBoot</span></a></a><span>
</span><a name="line-745"></a><span>       </span><span class="hs-special">{</span><span> </span><a name="sb_mds"><a href="TcRnTypes.html#sb_mds"><span class="hs-identifier">sb_mds</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span>   </span><span class="hs-comment">-- There was a hi-boot file,</span><span>
</span><a name="line-746"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="sb_tcs"><a href="TcRnTypes.html#sb_tcs"><span class="hs-identifier">sb_tcs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span> </span><span class="hs-special">}</span><span>    </span><span class="hs-comment">-- defining these TyCons,</span><span>
</span><a name="line-747"></a><span class="hs-comment">-- What is sb_tcs used for?  See Note [Extra dependencies from .hs-boot files]</span><span>
</span><a name="line-748"></a><span class="hs-comment">-- in RnSource</span><span>
</span><a name="line-749"></a><span>
</span><a name="line-750"></a><span>
</span><a name="line-751"></a><span class="hs-comment">{- Note [Tracking unused binding and imports]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We gather two sorts of usage information

 * tcg_dus (defs/uses)
      Records *defined* Names (local, top-level)
          and *used*    Names (local or imported)

      Used (a) to report &quot;defined but not used&quot;
               (see RnNames.reportUnusedNames)
           (b) to generate version-tracking usage info in interface
               files (see MkIface.mkUsedNames)
   This usage info is mainly gathered by the renamer's
   gathering of free-variables

 * tcg_used_gres
      Used only to report unused import declarations

      Records each *occurrence* an *imported* (not locally-defined) entity.
      The occurrence is recorded by keeping a GlobalRdrElt for it.
      These is not the GRE that is in the GlobalRdrEnv; rather it
      is recorded *after* the filtering done by pickGREs.  So it reflect
      /how that occurrence is in scope/.   See Note [GRE filtering] in
      RdrName.


************************************************************************
*                                                                      *
                The local typechecker environment
*                                                                      *
************************************************************************

Note [The Global-Env/Local-Env story]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
During type checking, we keep in the tcg_type_env
        * All types and classes
        * All Ids derived from types and classes (constructors, selectors)

At the end of type checking, we zonk the local bindings,
and as we do so we add to the tcg_type_env
        * Locally defined top-level Ids

Why?  Because they are now Ids not TcIds.  This final GlobalEnv is
        a) fed back (via the knot) to typechecking the
           unfoldings of interface signatures
        b) used in the ModDetails of this module
-}</span><span>
</span><a name="line-798"></a><span>
</span><a name="line-799"></a><span class="hs-keyword">data</span><span> </span><a name="TcLclEnv"><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier">TcLclEnv</span></a></a><span>           </span><span class="hs-comment">-- Changes as we move inside an expression</span><span>
</span><a name="line-800"></a><span>                        </span><span class="hs-comment">-- Discarded after typecheck/rename; not passed on to desugarer</span><span>
</span><a name="line-801"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TcLclEnv"><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier">TcLclEnv</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-802"></a><span>        </span><a name="tcl_loc"><a href="TcRnTypes.html#tcl_loc"><span class="hs-identifier">tcl_loc</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Source span</span><span>
</span><a name="line-803"></a><span>        </span><a name="tcl_ctxt"><a href="TcRnTypes.html#tcl_ctxt"><span class="hs-identifier">tcl_ctxt</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- Error context, innermost on top</span><span>
</span><a name="line-804"></a><span>        </span><a name="tcl_tclvl"><a href="TcRnTypes.html#tcl_tclvl"><span class="hs-identifier">tcl_tclvl</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- Birthplace for new unification variables</span><span>
</span><a name="line-805"></a><span>
</span><a name="line-806"></a><span>        </span><a name="tcl_th_ctxt"><a href="TcRnTypes.html#tcl_th_ctxt"><span class="hs-identifier">tcl_th_ctxt</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- Template Haskell context</span><span>
</span><a name="line-807"></a><span>        </span><a name="tcl_th_bndrs"><a href="TcRnTypes.html#tcl_th_bndrs"><span class="hs-identifier">tcl_th_bndrs</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ThBindEnv"><span class="hs-identifier hs-type">ThBindEnv</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- and binder info</span><span>
</span><a name="line-808"></a><span>            </span><span class="hs-comment">-- The ThBindEnv records the TH binding level of in-scope Names</span><span>
</span><a name="line-809"></a><span>            </span><span class="hs-comment">-- defined in this module (not imported)</span><span>
</span><a name="line-810"></a><span>            </span><span class="hs-comment">-- We can't put this info in the TypeEnv because it's needed</span><span>
</span><a name="line-811"></a><span>            </span><span class="hs-comment">-- (and extended) in the renamer, for untyed splices</span><span>
</span><a name="line-812"></a><span>
</span><a name="line-813"></a><span>        </span><a name="tcl_arrow_ctxt"><a href="TcRnTypes.html#tcl_arrow_ctxt"><span class="hs-identifier">tcl_arrow_ctxt</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ArrowCtxt"><span class="hs-identifier hs-type">ArrowCtxt</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- Arrow-notation context</span><span>
</span><a name="line-814"></a><span>
</span><a name="line-815"></a><span>        </span><a name="tcl_rdr"><a href="TcRnTypes.html#tcl_rdr"><span class="hs-identifier">tcl_rdr</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- Local name envt</span><span>
</span><a name="line-816"></a><span>                </span><span class="hs-comment">-- Maintained during renaming, of course, but also during</span><span>
</span><a name="line-817"></a><span>                </span><span class="hs-comment">-- type checking, solely so that when renaming a Template-Haskell</span><span>
</span><a name="line-818"></a><span>                </span><span class="hs-comment">-- splice we have the right environment for the renamer.</span><span>
</span><a name="line-819"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-820"></a><span>                </span><span class="hs-comment">--   Does *not* include global name envt; may shadow it</span><span>
</span><a name="line-821"></a><span>                </span><span class="hs-comment">--   Includes both ordinary variables and type variables;</span><span>
</span><a name="line-822"></a><span>                </span><span class="hs-comment">--   they are kept distinct because tyvar have a different</span><span>
</span><a name="line-823"></a><span>                </span><span class="hs-comment">--   occurrence constructor (Name.TvOcc)</span><span>
</span><a name="line-824"></a><span>                </span><span class="hs-comment">-- We still need the unsullied global name env so that</span><span>
</span><a name="line-825"></a><span>                </span><span class="hs-comment">--   we can look up record field names</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span>        </span><a name="tcl_env"><a href="TcRnTypes.html#tcl_env"><span class="hs-identifier">tcl_env</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- The local type environment:</span><span>
</span><a name="line-828"></a><span>                                  </span><span class="hs-comment">-- Ids and TyVars defined in this module</span><span>
</span><a name="line-829"></a><span>
</span><a name="line-830"></a><span>        </span><a name="tcl_bndrs"><a href="TcRnTypes.html#tcl_bndrs"><span class="hs-identifier">tcl_bndrs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcBinderStack"><span class="hs-identifier hs-type">TcBinderStack</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- Used for reporting relevant bindings,</span><span>
</span><a name="line-831"></a><span>                                      </span><span class="hs-comment">-- and for tidying types</span><span>
</span><a name="line-832"></a><span>
</span><a name="line-833"></a><span>        </span><a name="tcl_tyvars"><a href="TcRnTypes.html#tcl_tyvars"><span class="hs-identifier">tcl_tyvars</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="TcType.html#TcTyVarSet"><span class="hs-identifier hs-type">TcTyVarSet</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- The &quot;global tyvars&quot;</span><span>
</span><a name="line-834"></a><span>                        </span><span class="hs-comment">-- Namely, the in-scope TyVars bound in tcl_env,</span><span>
</span><a name="line-835"></a><span>                        </span><span class="hs-comment">-- plus the tyvars mentioned in the types of Ids bound</span><span>
</span><a name="line-836"></a><span>                        </span><span class="hs-comment">-- in tcl_lenv.</span><span>
</span><a name="line-837"></a><span>                        </span><span class="hs-comment">-- Why mutable? see notes with tcGetGlobalTyCoVars</span><span>
</span><a name="line-838"></a><span>
</span><a name="line-839"></a><span>        </span><a name="tcl_lie"><a href="TcRnTypes.html#tcl_lie"><span class="hs-identifier">tcl_lie</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Place to accumulate type constraints</span><span>
</span><a name="line-840"></a><span>        </span><a name="tcl_errs"><a href="TcRnTypes.html#tcl_errs"><span class="hs-identifier">tcl_errs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="ErrUtils.html#Messages"><span class="hs-identifier hs-type">Messages</span></a><span>              </span><span class="hs-comment">-- Place to accumulate errors</span><span>
</span><a name="line-841"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-842"></a><span>
</span><a name="line-843"></a><span class="hs-keyword">type</span><span> </span><a name="ErrCtxt"><a href="TcRnTypes.html#ErrCtxt"><span class="hs-identifier">ErrCtxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><span class="hs-special">(</span><a href="VarEnv.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a><span class="hs-special">,</span><span> </span><a href="ErrUtils.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-844"></a><span>        </span><span class="hs-comment">-- Monadic so that we have a chance</span><span>
</span><a name="line-845"></a><span>        </span><span class="hs-comment">-- to deal with bound type variables just before error</span><span>
</span><a name="line-846"></a><span>        </span><span class="hs-comment">-- message construction</span><span>
</span><a name="line-847"></a><span>
</span><a name="line-848"></a><span>        </span><span class="hs-comment">-- Bool:  True &lt;=&gt; this is a landmark context; do not</span><span>
</span><a name="line-849"></a><span>        </span><span class="hs-comment">--                 discard it when trimming for display</span><span>
</span><a name="line-850"></a><span>
</span><a name="line-851"></a><span class="hs-keyword">type</span><span> </span><a name="TcTypeEnv"><a href="TcRnTypes.html#TcTypeEnv"><span class="hs-identifier">TcTypeEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="TcRnTypes.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a><span>
</span><a name="line-852"></a><span>
</span><a name="line-853"></a><span class="hs-keyword">type</span><span> </span><a name="ThBindEnv"><a href="TcRnTypes.html#ThBindEnv"><span class="hs-identifier">ThBindEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ThLevel"><span class="hs-identifier hs-type">ThLevel</span></a><span class="hs-special">)</span><span>
</span><a name="line-854"></a><span>   </span><span class="hs-comment">-- Domain = all Ids bound in this module (ie not imported)</span><span>
</span><a name="line-855"></a><span>   </span><span class="hs-comment">-- The TopLevelFlag tells if the binding is syntactically top level.</span><span>
</span><a name="line-856"></a><span>   </span><span class="hs-comment">-- We need to know this, because the cross-stage persistence story allows</span><span>
</span><a name="line-857"></a><span>   </span><span class="hs-comment">-- cross-stage at arbitrary types if the Id is bound at top level.</span><span>
</span><a name="line-858"></a><span>   </span><span class="hs-comment">--</span><span>
</span><a name="line-859"></a><span>   </span><span class="hs-comment">-- Nota bene: a ThLevel of 'outerLevel' is *not* the same as being</span><span>
</span><a name="line-860"></a><span>   </span><span class="hs-comment">-- bound at top level!  See Note [Template Haskell levels] in TcSplice</span><span>
</span><a name="line-861"></a><span>
</span><a name="line-862"></a><span class="hs-comment">{- Note [Given Insts]
   ~~~~~~~~~~~~~~~~~~
Because of GADTs, we have to pass inwards the Insts provided by type signatures
and existential contexts. Consider
        data T a where { T1 :: b -&gt; b -&gt; T [b] }
        f :: Eq a =&gt; T a -&gt; Bool
        f (T1 x y) = [x]==[y]

The constructor T1 binds an existential variable 'b', and we need Eq [b].
Well, we have it, because Eq a refines to Eq [b], but we can only spot that if we
pass it inwards.

-}</span><span>
</span><a name="line-875"></a><span>
</span><a name="line-876"></a><span class="hs-comment">-- | Type alias for 'IORef'; the convention is we'll use this for mutable</span><span>
</span><a name="line-877"></a><span class="hs-comment">-- bits of data in 'TcGblEnv' which are updated during typechecking and</span><span>
</span><a name="line-878"></a><span class="hs-comment">-- returned at the end.</span><span>
</span><a name="line-879"></a><span class="hs-keyword">type</span><span> </span><a name="TcRef"><a href="TcRnTypes.html#TcRef"><span class="hs-identifier">TcRef</span></a></a><span> </span><a name="local-6989586621684145912"><a href="#local-6989586621684145912"><span class="hs-identifier">a</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="#local-6989586621684145912"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-880"></a><span class="hs-comment">-- ToDo: when should I refer to it as a 'TcId' instead of an 'Id'?</span><span>
</span><a name="line-881"></a><span class="hs-keyword">type</span><span> </span><a name="TcId"><a href="TcRnTypes.html#TcId"><span class="hs-identifier">TcId</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-882"></a><span class="hs-keyword">type</span><span> </span><a name="TcIdSet"><a href="TcRnTypes.html#TcIdSet"><span class="hs-identifier">TcIdSet</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#IdSet"><span class="hs-identifier hs-type">IdSet</span></a><span>
</span><a name="line-883"></a><span>
</span><a name="line-884"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-885"></a><span class="hs-comment">-- The TcBinderStack</span><span>
</span><a name="line-886"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-887"></a><span>
</span><a name="line-888"></a><span class="hs-keyword">type</span><span> </span><a name="TcBinderStack"><a href="TcRnTypes.html#TcBinderStack"><span class="hs-identifier">TcBinderStack</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#TcBinder"><span class="hs-identifier hs-type">TcBinder</span></a><span class="hs-special">]</span><span>
</span><a name="line-889"></a><span>   </span><span class="hs-comment">-- This is a stack of locally-bound ids and tyvars,</span><span>
</span><a name="line-890"></a><span>   </span><span class="hs-comment">--   innermost on top</span><span>
</span><a name="line-891"></a><span>   </span><span class="hs-comment">-- Used only in error reporting (relevantBindings in TcError),</span><span>
</span><a name="line-892"></a><span>   </span><span class="hs-comment">--   and in tidying</span><span>
</span><a name="line-893"></a><span>   </span><span class="hs-comment">-- We can't use the tcl_env type environment, because it doesn't</span><span>
</span><a name="line-894"></a><span>   </span><span class="hs-comment">--   keep track of the nesting order</span><span>
</span><a name="line-895"></a><span>
</span><a name="line-896"></a><span class="hs-keyword">data</span><span> </span><a name="TcBinder"><a href="TcRnTypes.html#TcBinder"><span class="hs-identifier">TcBinder</span></a></a><span>
</span><a name="line-897"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TcIdBndr"><a href="TcRnTypes.html#TcIdBndr"><span class="hs-identifier">TcIdBndr</span></a></a><span>
</span><a name="line-898"></a><span>       </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span>
</span><a name="line-899"></a><span>       </span><a href="BasicTypes.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a><span>    </span><span class="hs-comment">-- Tells whether the binding is syntactically top-level</span><span>
</span><a name="line-900"></a><span>                       </span><span class="hs-comment">-- (The monomorphic Ids for a recursive group count</span><span>
</span><a name="line-901"></a><span>                       </span><span class="hs-comment">--  as not-top-level for this purpose.)</span><span>
</span><a name="line-902"></a><span>
</span><a name="line-903"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TcIdBndr_ExpType"><a href="TcRnTypes.html#TcIdBndr_ExpType"><span class="hs-identifier">TcIdBndr_ExpType</span></a></a><span>  </span><span class="hs-comment">-- Variant that allows the type to be specified as</span><span>
</span><a name="line-904"></a><span>                      </span><span class="hs-comment">-- an ExpType</span><span>
</span><a name="line-905"></a><span>       </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-906"></a><span>       </span><a href="TcType.html#ExpType"><span class="hs-identifier hs-type">ExpType</span></a><span>
</span><a name="line-907"></a><span>       </span><a href="BasicTypes.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a><span>
</span><a name="line-908"></a><span>
</span><a name="line-909"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TcTvBndr"><a href="TcRnTypes.html#TcTvBndr"><span class="hs-identifier">TcTvBndr</span></a></a><span>          </span><span class="hs-comment">-- e.g.   case x of P (y::a) -&gt; blah</span><span>
</span><a name="line-910"></a><span>       </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>           </span><span class="hs-comment">-- We bind the lexical name &quot;a&quot; to the type of y,</span><span>
</span><a name="line-911"></a><span>       </span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span>          </span><span class="hs-comment">-- which might be an utterly different (perhaps</span><span>
</span><a name="line-912"></a><span>                      </span><span class="hs-comment">-- existential) tyvar</span><span>
</span><a name="line-913"></a><span>
</span><a name="line-914"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#TcBinder"><span class="hs-identifier hs-type">TcBinder</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-915"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcIdBndr"><span class="hs-identifier hs-var">TcIdBndr</span></a><span> </span><a name="local-6989586621684145976"><a href="#local-6989586621684145976"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621684145977"><a href="#local-6989586621684145977"><span class="hs-identifier">top_lvl</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145976"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145977"><span class="hs-identifier hs-var">top_lvl</span></a><span class="hs-special">)</span><span>
</span><a name="line-916"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcIdBndr_ExpType"><span class="hs-identifier hs-var">TcIdBndr_ExpType</span></a><span> </span><a name="local-6989586621684145978"><a href="#local-6989586621684145978"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684145979"><a href="#local-6989586621684145979"><span class="hs-identifier">top_lvl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145978"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145979"><span class="hs-identifier hs-var">top_lvl</span></a><span class="hs-special">)</span><span>
</span><a name="line-917"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcTvBndr"><span class="hs-identifier hs-var">TcTvBndr</span></a><span> </span><a name="local-6989586621684145980"><a href="#local-6989586621684145980"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621684145981"><a href="#local-6989586621684145981"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145980"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145981"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-918"></a><span>
</span><a name="line-919"></a><span class="hs-keyword">instance</span><span> </span><a href="OccName.html#HasOccName"><span class="hs-identifier hs-type">HasOccName</span></a><span> </span><a href="TcRnTypes.html#TcBinder"><span class="hs-identifier hs-type">TcBinder</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-920"></a><span>    </span><a name="local-8214565720325908782"><a href="OccName.html#occName"><span class="hs-identifier">occName</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcIdBndr"><span class="hs-identifier hs-var">TcIdBndr</span></a><span> </span><a name="local-6989586621684145973"><a href="#local-6989586621684145973"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#occName"><span class="hs-identifier hs-var">occName</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idName"><span class="hs-identifier hs-var">idName</span></a><span> </span><a href="#local-6989586621684145973"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-921"></a><span>    </span><span class="hs-identifier">occName</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcIdBndr_ExpType"><span class="hs-identifier hs-var">TcIdBndr_ExpType</span></a><span> </span><a name="local-6989586621684145974"><a href="#local-6989586621684145974"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#occName"><span class="hs-identifier hs-var">occName</span></a><span> </span><a href="#local-6989586621684145974"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-922"></a><span>    </span><span class="hs-identifier">occName</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcTvBndr"><span class="hs-identifier hs-var">TcTvBndr</span></a><span> </span><a name="local-6989586621684145975"><a href="#local-6989586621684145975"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#occName"><span class="hs-identifier hs-var">occName</span></a><span> </span><a href="#local-6989586621684145975"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-923"></a><span>
</span><a name="line-924"></a><span class="hs-comment">-- fixes #12177</span><span>
</span><a name="line-925"></a><span class="hs-comment">-- Builds up a list of bindings whose OccName has not been seen before</span><span>
</span><a name="line-926"></a><span class="hs-comment">-- i.e., If    ys  = removeBindingShadowing xs</span><span>
</span><a name="line-927"></a><span class="hs-comment">-- then</span><span>
</span><a name="line-928"></a><span class="hs-comment">--  - ys is obtained from xs by deleting some elements</span><span>
</span><a name="line-929"></a><span class="hs-comment">--  - ys has no duplicate OccNames</span><span>
</span><a name="line-930"></a><span class="hs-comment">--  - The first duplicated OccName in xs is retained in ys</span><span>
</span><a name="line-931"></a><span class="hs-comment">-- Overloaded so that it can be used for both GlobalRdrElt in typed-hole</span><span>
</span><a name="line-932"></a><span class="hs-comment">-- substitutions and TcBinder when looking for relevant bindings.</span><span>
</span><a name="line-933"></a><span class="hs-identifier">removeBindingShadowing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#HasOccName"><span class="hs-identifier hs-type">HasOccName</span></a><span> </span><a href="#local-6989586621684145993"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684145993"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684145993"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-934"></a><a name="removeBindingShadowing"><a href="TcRnTypes.html#removeBindingShadowing"><span class="hs-identifier">removeBindingShadowing</span></a></a><span> </span><a name="local-6989586621684145995"><a href="#local-6989586621684145995"><span class="hs-identifier">bindings</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldl</span><span>
</span><a name="line-935"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621684145996"><a href="#local-6989586621684145996"><span class="hs-identifier">bindingAcc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684145997"><a href="#local-6989586621684145997"><span class="hs-identifier">seenNames</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684145998"><a href="#local-6989586621684145998"><span class="hs-identifier">binding</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-936"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="OccName.html#occName"><span class="hs-identifier hs-var">occName</span></a><span> </span><a href="#local-6989586621684145998"><span class="hs-identifier hs-var">binding</span></a><span> </span><span class="hs-special">`</span><a href="OccName.html#elemOccSet"><span class="hs-identifier hs-var">elemOccSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684145997"><span class="hs-identifier hs-var">seenNames</span></a><span> </span><span class="hs-comment">-- if we've seen it</span><span>
</span><a name="line-937"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684145996"><span class="hs-identifier hs-var">bindingAcc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684145997"><span class="hs-identifier hs-var">seenNames</span></a><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- skip it</span><span>
</span><a name="line-938"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684145998"><span class="hs-identifier hs-var">binding</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684145996"><span class="hs-identifier hs-var">bindingAcc</span></a><span class="hs-special">,</span><span> </span><a href="OccName.html#extendOccSet"><span class="hs-identifier hs-var">extendOccSet</span></a><span> </span><a href="#local-6989586621684145997"><span class="hs-identifier hs-var">seenNames</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#occName"><span class="hs-identifier hs-var">occName</span></a><span> </span><a href="#local-6989586621684145998"><span class="hs-identifier hs-var">binding</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-939"></a><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="OccName.html#emptyOccSet"><span class="hs-identifier hs-var">emptyOccSet</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684145995"><span class="hs-identifier hs-var">bindings</span></a><span>
</span><a name="line-940"></a><span>
</span><a name="line-941"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-942"></a><span class="hs-comment">-- Template Haskell stages and levels</span><span>
</span><a name="line-943"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-944"></a><span>
</span><a name="line-945"></a><span class="hs-keyword">data</span><span> </span><a name="SpliceType"><a href="TcRnTypes.html#SpliceType"><span class="hs-identifier">SpliceType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Typed"><a href="TcRnTypes.html#Typed"><span class="hs-identifier">Typed</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Untyped"><a href="TcRnTypes.html#Untyped"><span class="hs-identifier">Untyped</span></a></a><span>
</span><a name="line-946"></a><span>
</span><a name="line-947"></a><span class="hs-keyword">data</span><span> </span><a name="ThStage"><a href="TcRnTypes.html#ThStage"><span class="hs-identifier">ThStage</span></a></a><span>    </span><span class="hs-comment">-- See Note [Template Haskell state diagram] in TcSplice</span><span>
</span><a name="line-948"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Splice"><a href="TcRnTypes.html#Splice"><span class="hs-identifier">Splice</span></a></a><span> </span><a href="TcRnTypes.html#SpliceType"><span class="hs-identifier hs-type">SpliceType</span></a><span> </span><span class="hs-comment">-- Inside a top-level splice</span><span>
</span><a name="line-949"></a><span>                      </span><span class="hs-comment">-- This code will be run *at compile time*;</span><span>
</span><a name="line-950"></a><span>                      </span><span class="hs-comment">--   the result replaces the splice</span><span>
</span><a name="line-951"></a><span>                      </span><span class="hs-comment">-- Binding level = 0</span><span>
</span><a name="line-952"></a><span>
</span><a name="line-953"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RunSplice"><a href="TcRnTypes.html#RunSplice"><span class="hs-identifier">RunSplice</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">[</span><a href="GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a><span> </span><span class="hs-special">(</span><a href="Language.Haskell.TH.Syntax.html#Q"><span class="hs-identifier hs-type">TH.Q</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-954"></a><span>      </span><span class="hs-comment">-- Set when running a splice, i.e. NOT when renaming or typechecking the</span><span>
</span><a name="line-955"></a><span>      </span><span class="hs-comment">-- Haskell code for the splice. See Note [RunSplice ThLevel].</span><span>
</span><a name="line-956"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-957"></a><span>      </span><span class="hs-comment">-- Contains a list of mod finalizers collected while executing the splice.</span><span>
</span><a name="line-958"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-959"></a><span>      </span><span class="hs-comment">-- 'addModFinalizer' inserts finalizers here, and from here they are taken</span><span>
</span><a name="line-960"></a><span>      </span><span class="hs-comment">-- to construct an @HsSpliced@ annotation for untyped splices. See Note</span><span>
</span><a name="line-961"></a><span>      </span><span class="hs-comment">-- [Delaying modFinalizers in untyped splices] in &quot;RnSplice&quot;.</span><span>
</span><a name="line-962"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-963"></a><span>      </span><span class="hs-comment">-- For typed splices, the typechecker takes finalizers from here and</span><span>
</span><a name="line-964"></a><span>      </span><span class="hs-comment">-- inserts them in the list of finalizers in the global environment.</span><span>
</span><a name="line-965"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-966"></a><span>      </span><span class="hs-comment">-- See Note [Collecting modFinalizers in typed splices] in &quot;TcSplice&quot;.</span><span>
</span><a name="line-967"></a><span>
</span><a name="line-968"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Comp"><a href="TcRnTypes.html#Comp"><span class="hs-identifier">Comp</span></a></a><span>        </span><span class="hs-comment">-- Ordinary Haskell code</span><span>
</span><a name="line-969"></a><span>                </span><span class="hs-comment">-- Binding level = 1</span><span>
</span><a name="line-970"></a><span>
</span><a name="line-971"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Brack"><a href="TcRnTypes.html#Brack"><span class="hs-identifier">Brack</span></a></a><span>                       </span><span class="hs-comment">-- Inside brackets</span><span>
</span><a name="line-972"></a><span>      </span><a href="TcRnTypes.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a><span>                   </span><span class="hs-comment">--   Enclosing stage</span><span>
</span><a name="line-973"></a><span>      </span><a href="TcRnTypes.html#PendingStuff"><span class="hs-identifier hs-type">PendingStuff</span></a><span>
</span><a name="line-974"></a><span>
</span><a name="line-975"></a><span class="hs-keyword">data</span><span> </span><a name="PendingStuff"><a href="TcRnTypes.html#PendingStuff"><span class="hs-identifier">PendingStuff</span></a></a><span>
</span><a name="line-976"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="RnPendingUntyped"><a href="TcRnTypes.html#RnPendingUntyped"><span class="hs-identifier">RnPendingUntyped</span></a></a><span>              </span><span class="hs-comment">-- Renaming the inside of an *untyped* bracket</span><span>
</span><a name="line-977"></a><span>      </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">[</span><a href="HsExpr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Pending splices in here</span><span>
</span><a name="line-978"></a><span>
</span><a name="line-979"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RnPendingTyped"><a href="TcRnTypes.html#RnPendingTyped"><span class="hs-identifier">RnPendingTyped</span></a></a><span>                </span><span class="hs-comment">-- Renaming the inside of a *typed* bracket</span><span>
</span><a name="line-980"></a><span>
</span><a name="line-981"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TcPending"><a href="TcRnTypes.html#TcPending"><span class="hs-identifier">TcPending</span></a></a><span>                     </span><span class="hs-comment">-- Typechecking the inside of a typed bracket</span><span>
</span><a name="line-982"></a><span>      </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><span class="hs-special">[</span><a href="HsExpr.html#PendingTcSplice"><span class="hs-identifier hs-type">PendingTcSplice</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">--   Accumulate pending splices here</span><span>
</span><a name="line-983"></a><span>      </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">--     and type constraints here</span><span>
</span><a name="line-984"></a><span>
</span><a name="line-985"></a><span class="hs-identifier">topStage</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">topAnnStage</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">topSpliceStage</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a><span>
</span><a name="line-986"></a><a name="topStage"><a href="TcRnTypes.html#topStage"><span class="hs-identifier">topStage</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Comp"><span class="hs-identifier hs-var">Comp</span></a><span>
</span><a name="line-987"></a><a name="topAnnStage"><a href="TcRnTypes.html#topAnnStage"><span class="hs-identifier">topAnnStage</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Splice"><span class="hs-identifier hs-var">Splice</span></a><span> </span><a href="TcRnTypes.html#Untyped"><span class="hs-identifier hs-var">Untyped</span></a><span>
</span><a name="line-988"></a><a name="topSpliceStage"><a href="TcRnTypes.html#topSpliceStage"><span class="hs-identifier">topSpliceStage</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Splice"><span class="hs-identifier hs-var">Splice</span></a><span> </span><a href="TcRnTypes.html#Untyped"><span class="hs-identifier hs-var">Untyped</span></a><span>
</span><a name="line-989"></a><span>
</span><a name="line-990"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-991"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Splice"><span class="hs-identifier hs-var">Splice</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Splice&quot;</span><span>
</span><a name="line-992"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#RunSplice"><span class="hs-identifier hs-var">RunSplice</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;RunSplice&quot;</span><span>
</span><a name="line-993"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#Comp"><span class="hs-identifier hs-var">Comp</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Comp&quot;</span><span>
</span><a name="line-994"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Brack"><span class="hs-identifier hs-var">Brack</span></a><span> </span><a name="local-6989586621684145972"><a href="#local-6989586621684145972"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Brack&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145972"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-995"></a><span>
</span><a name="line-996"></a><span class="hs-keyword">type</span><span> </span><a name="ThLevel"><a href="TcRnTypes.html#ThLevel"><span class="hs-identifier">ThLevel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-997"></a><span>    </span><span class="hs-comment">-- NB: see Note [Template Haskell levels] in TcSplice</span><span>
</span><a name="line-998"></a><span>    </span><span class="hs-comment">-- Incremented when going inside a bracket,</span><span>
</span><a name="line-999"></a><span>    </span><span class="hs-comment">-- decremented when going inside a splice</span><span>
</span><a name="line-1000"></a><span>    </span><span class="hs-comment">-- NB: ThLevel is one greater than the 'n' in Fig 2 of the</span><span>
</span><a name="line-1001"></a><span>    </span><span class="hs-comment">--     original &quot;Template meta-programming for Haskell&quot; paper</span><span>
</span><a name="line-1002"></a><span>
</span><a name="line-1003"></a><span class="hs-identifier">impLevel</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">outerLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ThLevel"><span class="hs-identifier hs-type">ThLevel</span></a><span>
</span><a name="line-1004"></a><a name="impLevel"><a href="TcRnTypes.html#impLevel"><span class="hs-identifier">impLevel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>    </span><span class="hs-comment">-- Imported things; they can be used inside a top level splice</span><span>
</span><a name="line-1005"></a><a name="outerLevel"><a href="TcRnTypes.html#outerLevel"><span class="hs-identifier">outerLevel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>  </span><span class="hs-comment">-- Things defined outside brackets</span><span>
</span><a name="line-1006"></a><span>
</span><a name="line-1007"></a><span class="hs-identifier">thLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#ThLevel"><span class="hs-identifier hs-type">ThLevel</span></a><span>
</span><a name="line-1008"></a><a name="thLevel"><a href="TcRnTypes.html#thLevel"><span class="hs-identifier">thLevel</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Splice"><span class="hs-identifier hs-var">Splice</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1009"></a><span class="hs-identifier">thLevel</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#RunSplice"><span class="hs-identifier hs-var">RunSplice</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1010"></a><span>    </span><span class="hs-comment">-- See Note [RunSplice ThLevel].</span><span>
</span><a name="line-1011"></a><span>    </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;thLevel: called when running a splice&quot;</span><span>
</span><a name="line-1012"></a><span class="hs-identifier">thLevel</span><span> </span><a href="TcRnTypes.html#Comp"><span class="hs-identifier hs-var">Comp</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1013"></a><span class="hs-identifier">thLevel</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Brack"><span class="hs-identifier hs-var">Brack</span></a><span> </span><a name="local-6989586621684145999"><a href="#local-6989586621684145999"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#thLevel"><span class="hs-identifier hs-var">thLevel</span></a><span> </span><a href="#local-6989586621684145999"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1014"></a><span>
</span><a name="line-1015"></a><span class="hs-comment">{- Node [RunSplice ThLevel]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The 'RunSplice' stage is set when executing a splice, and only when running a
splice. In particular it is not set when the splice is renamed or typechecked.

'RunSplice' is needed to provide a reference where 'addModFinalizer' can insert
the finalizer (see Note [Delaying modFinalizers in untyped splices]), and
'addModFinalizer' runs when doing Q things. Therefore, It doesn't make sense to
set 'RunSplice' when renaming or typechecking the splice, where 'Splice', 
'Brack' or 'Comp' are used instead.

-}</span><span>
</span><a name="line-1027"></a><span>
</span><a name="line-1028"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1029"></a><span class="hs-comment">-- Arrow-notation context</span><span>
</span><a name="line-1030"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1031"></a><span>
</span><a name="line-1032"></a><span class="hs-comment">{- Note [Escaping the arrow scope]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In arrow notation, a variable bound by a proc (or enclosed let/kappa)
is not in scope to the left of an arrow tail (-&lt;) or the head of (|..|).
For example

        proc x -&gt; (e1 -&lt; e2)

Here, x is not in scope in e1, but it is in scope in e2.  This can get
a bit complicated:

        let x = 3 in
        proc y -&gt; (proc z -&gt; e1) -&lt; e2

Here, x and z are in scope in e1, but y is not.

We implement this by
recording the environment when passing a proc (using newArrowScope),
and returning to that (using escapeArrowScope) on the left of -&lt; and the
head of (|..|).

All this can be dealt with by the *renamer*. But the type checker needs
to be involved too.  Example (arrowfail001)
  class Foo a where foo :: a -&gt; ()
  data Bar = forall a. Foo a =&gt; Bar a
  get :: Bar -&gt; ()
  get = proc x -&gt; case x of Bar a -&gt; foo -&lt; a
Here the call of 'foo' gives rise to a (Foo a) constraint that should not
be captured by the pattern match on 'Bar'.  Rather it should join the
constraints from further out.  So we must capture the constraint bag
from further out in the ArrowCtxt that we push inwards.
-}</span><span>
</span><a name="line-1064"></a><span>
</span><a name="line-1065"></a><span class="hs-keyword">data</span><span> </span><a name="ArrowCtxt"><a href="TcRnTypes.html#ArrowCtxt"><span class="hs-identifier">ArrowCtxt</span></a></a><span>   </span><span class="hs-comment">-- Note [Escaping the arrow scope]</span><span>
</span><a name="line-1066"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NoArrowCtxt"><a href="TcRnTypes.html#NoArrowCtxt"><span class="hs-identifier">NoArrowCtxt</span></a></a><span>
</span><a name="line-1067"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ArrowCtxt"><a href="TcRnTypes.html#ArrowCtxt"><span class="hs-identifier">ArrowCtxt</span></a></a><span> </span><a href="RdrName.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span class="hs-special">)</span><span>
</span><a name="line-1068"></a><span>
</span><a name="line-1069"></a><span>
</span><a name="line-1070"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1071"></a><span class="hs-comment">-- TcTyThing</span><span>
</span><a name="line-1072"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1073"></a><span>
</span><a name="line-1074"></a><span class="hs-comment">-- | A typecheckable thing available in a local context.  Could be</span><span>
</span><a name="line-1075"></a><span class="hs-comment">-- 'AGlobal' 'TyThing', but also lexically scoped variables, etc.</span><span>
</span><a name="line-1076"></a><span class="hs-comment">-- See 'TcEnv' for how to retrieve a 'TyThing' given a 'Name'.</span><span>
</span><a name="line-1077"></a><span class="hs-keyword">data</span><span> </span><a name="TcTyThing"><a href="TcRnTypes.html#TcTyThing"><span class="hs-identifier">TcTyThing</span></a></a><span>
</span><a name="line-1078"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="AGlobal"><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier">AGlobal</span></a></a><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span>             </span><span class="hs-comment">-- Used only in the return type of a lookup</span><span>
</span><a name="line-1079"></a><span>
</span><a name="line-1080"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ATcId"><a href="TcRnTypes.html#ATcId"><span class="hs-identifier">ATcId</span></a></a><span>           </span><span class="hs-comment">-- Ids defined in this module; may not be fully zonked</span><span>
</span><a name="line-1081"></a><span>      </span><span class="hs-special">{</span><span> </span><a name="tct_id"><a href="TcRnTypes.html#tct_id"><span class="hs-identifier">tct_id</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span>
</span><a name="line-1082"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="tct_info"><a href="TcRnTypes.html#tct_info"><span class="hs-identifier">tct_info</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#IdBindingInfo"><span class="hs-identifier hs-type">IdBindingInfo</span></a><span>   </span><span class="hs-comment">-- See Note [Meaning of IdBindingInfo]</span><span>
</span><a name="line-1083"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-1084"></a><span>
</span><a name="line-1085"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ATyVar"><a href="TcRnTypes.html#ATyVar"><span class="hs-identifier">ATyVar</span></a></a><span>  </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>   </span><span class="hs-comment">-- See Note [Type variables in the type environment]</span><span>
</span><a name="line-1086"></a><span>
</span><a name="line-1087"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ATcTyCon"><a href="TcRnTypes.html#ATcTyCon"><span class="hs-identifier">ATcTyCon</span></a></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>   </span><span class="hs-comment">-- Used temporarily, during kind checking, for the</span><span>
</span><a name="line-1088"></a><span>                     </span><span class="hs-comment">-- tycons and clases in this recursive group</span><span>
</span><a name="line-1089"></a><span>                     </span><span class="hs-comment">-- The TyCon is always a TcTyCon.  Its kind</span><span>
</span><a name="line-1090"></a><span>                     </span><span class="hs-comment">-- can be a mono-kind or a poly-kind; in TcTyClsDcls see</span><span>
</span><a name="line-1091"></a><span>                     </span><span class="hs-comment">-- Note [Type checking recursive type and class declarations]</span><span>
</span><a name="line-1092"></a><span>
</span><a name="line-1093"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="APromotionErr"><a href="TcRnTypes.html#APromotionErr"><span class="hs-identifier">APromotionErr</span></a></a><span> </span><a href="TcRnTypes.html#PromotionErr"><span class="hs-identifier hs-type">PromotionErr</span></a><span>
</span><a name="line-1094"></a><span>
</span><a name="line-1095"></a><span class="hs-keyword">data</span><span> </span><a name="PromotionErr"><a href="TcRnTypes.html#PromotionErr"><span class="hs-identifier">PromotionErr</span></a></a><span>
</span><a name="line-1096"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TyConPE"><a href="TcRnTypes.html#TyConPE"><span class="hs-identifier">TyConPE</span></a></a><span>          </span><span class="hs-comment">-- TyCon used in a kind before we are ready</span><span>
</span><a name="line-1097"></a><span>                     </span><span class="hs-comment">--     data T :: T -&gt; * where ...</span><span>
</span><a name="line-1098"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ClassPE"><a href="TcRnTypes.html#ClassPE"><span class="hs-identifier">ClassPE</span></a></a><span>          </span><span class="hs-comment">-- Ditto Class</span><span>
</span><a name="line-1099"></a><span>
</span><a name="line-1100"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FamDataConPE"><a href="TcRnTypes.html#FamDataConPE"><span class="hs-identifier">FamDataConPE</span></a></a><span>     </span><span class="hs-comment">-- Data constructor for a data family</span><span>
</span><a name="line-1101"></a><span>                     </span><span class="hs-comment">-- See Note [AFamDataCon: not promoting data family constructors]</span><span>
</span><a name="line-1102"></a><span>                     </span><span class="hs-comment">-- in TcEnv.</span><span>
</span><a name="line-1103"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ConstrainedDataConPE"><a href="TcRnTypes.html#ConstrainedDataConPE"><span class="hs-identifier">ConstrainedDataConPE</span></a></a><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-1104"></a><span>                     </span><span class="hs-comment">-- Data constructor with a non-equality context</span><span>
</span><a name="line-1105"></a><span>                     </span><span class="hs-comment">-- See Note [Don't promote data constructors with</span><span>
</span><a name="line-1106"></a><span>                     </span><span class="hs-comment">--           non-equality contexts] in TcHsType</span><span>
</span><a name="line-1107"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PatSynPE"><a href="TcRnTypes.html#PatSynPE"><span class="hs-identifier">PatSynPE</span></a></a><span>         </span><span class="hs-comment">-- Pattern synonyms</span><span>
</span><a name="line-1108"></a><span>                     </span><span class="hs-comment">-- See Note [Don't promote pattern synonyms] in TcEnv</span><span>
</span><a name="line-1109"></a><span>
</span><a name="line-1110"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PatSynExPE"><a href="TcRnTypes.html#PatSynExPE"><span class="hs-identifier">PatSynExPE</span></a></a><span>       </span><span class="hs-comment">-- Pattern synonym existential type variable</span><span>
</span><a name="line-1111"></a><span>                     </span><span class="hs-comment">-- See Note [Pattern synonym existentials do not scope] in TcPatSyn</span><span>
</span><a name="line-1112"></a><span>
</span><a name="line-1113"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RecDataConPE"><a href="TcRnTypes.html#RecDataConPE"><span class="hs-identifier">RecDataConPE</span></a></a><span>     </span><span class="hs-comment">-- Data constructor in a recursive loop</span><span>
</span><a name="line-1114"></a><span>                     </span><span class="hs-comment">-- See Note [Recursion and promoting data constructors] in TcTyClsDecls</span><span>
</span><a name="line-1115"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="NoDataKindsTC"><a href="TcRnTypes.html#NoDataKindsTC"><span class="hs-identifier">NoDataKindsTC</span></a></a><span>    </span><span class="hs-comment">-- -XDataKinds not enabled (for a tycon)</span><span>
</span><a name="line-1116"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="NoDataKindsDC"><a href="TcRnTypes.html#NoDataKindsDC"><span class="hs-identifier">NoDataKindsDC</span></a></a><span>    </span><span class="hs-comment">-- -XDataKinds not enabled (for a datacon)</span><span>
</span><a name="line-1117"></a><span>
</span><a name="line-1118"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a><span> </span><span class="hs-keyword">where</span><span>     </span><span class="hs-comment">-- Debugging only</span><span>
</span><a name="line-1119"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a><span> </span><a name="local-6989586621684145966"><a href="#local-6989586621684145966"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145966"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-1120"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><a name="local-6989586621684145967"><a href="#local-6989586621684145967"><span class="hs-identifier">elt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#ATcId"><span class="hs-identifier hs-var">ATcId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Identifier&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span>
</span><a name="line-1121"></a><span>                          </span><a href="Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tct_id</span><span> </span><a href="#local-6989586621684145967"><span class="hs-identifier hs-var">elt</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span>
</span><a name="line-1122"></a><span>                                 </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tct_id</span><span> </span><a href="#local-6989586621684145967"><span class="hs-identifier hs-var">elt</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-1123"></a><span>                                 </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tct_info</span><span> </span><a href="#local-6989586621684145967"><span class="hs-identifier hs-var">elt</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1124"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ATyVar"><span class="hs-identifier hs-var">ATyVar</span></a><span> </span><a name="local-6989586621684145968"><a href="#local-6989586621684145968"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621684145969"><a href="#local-6989586621684145969"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type variable&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145968"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#equals"><span class="hs-identifier hs-var">equals</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145969"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1125"></a><span>                            </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621684145969"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1126"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ATcTyCon"><span class="hs-identifier hs-var">ATcTyCon</span></a><span> </span><a name="local-6989586621684145970"><a href="#local-6989586621684145970"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ATcTyCon&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145970"><span class="hs-identifier hs-var">tc</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621684145970"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1127"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#APromotionErr"><span class="hs-identifier hs-var">APromotionErr</span></a><span> </span><a name="local-6989586621684145971"><a href="#local-6989586621684145971"><span class="hs-identifier">err</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;APromotionErr&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145971"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-1128"></a><span>
</span><a name="line-1129"></a><span class="hs-comment">-- | IdBindingInfo describes how an Id is bound.</span><span>
</span><a name="line-1130"></a><span class="hs-comment">--</span><span>
</span><a name="line-1131"></a><span class="hs-comment">-- It is used for the following purposes:</span><span>
</span><a name="line-1132"></a><span class="hs-comment">-- a) for static forms in TcExpr.checkClosedInStaticForm and</span><span>
</span><a name="line-1133"></a><span class="hs-comment">-- b) to figure out when a nested binding can be generalised,</span><span>
</span><a name="line-1134"></a><span class="hs-comment">--    in TcBinds.decideGeneralisationPlan.</span><span>
</span><a name="line-1135"></a><span class="hs-comment">--</span><span>
</span><a name="line-1136"></a><span class="hs-keyword">data</span><span> </span><a name="IdBindingInfo"><a href="TcRnTypes.html#IdBindingInfo"><span class="hs-identifier">IdBindingInfo</span></a></a><span> </span><span class="hs-comment">-- See Note [Meaning of IdBindingInfo and ClosedTypeId]</span><span>
</span><a name="line-1137"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="NotLetBound"><a href="TcRnTypes.html#NotLetBound"><span class="hs-identifier">NotLetBound</span></a></a><span>
</span><a name="line-1138"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="ClosedLet"><a href="TcRnTypes.html#ClosedLet"><span class="hs-identifier">ClosedLet</span></a></a><span>
</span><a name="line-1139"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="NonClosedLet"><a href="TcRnTypes.html#NonClosedLet"><span class="hs-identifier">NonClosedLet</span></a></a><span>
</span><a name="line-1140"></a><span>         </span><a href="TcRnTypes.html#RhsNames"><span class="hs-identifier hs-type">RhsNames</span></a><span>        </span><span class="hs-comment">-- Used for (static e) checks only</span><span>
</span><a name="line-1141"></a><span>         </span><a href="TcRnTypes.html#ClosedTypeId"><span class="hs-identifier hs-type">ClosedTypeId</span></a><span>    </span><span class="hs-comment">-- Used for generalisation checks</span><span>
</span><a name="line-1142"></a><span>                         </span><span class="hs-comment">-- and for (static e) checks</span><span>
</span><a name="line-1143"></a><span>
</span><a name="line-1144"></a><span class="hs-comment">-- | IsGroupClosed describes a group of mutually-recursive bindings</span><span>
</span><a name="line-1145"></a><span class="hs-keyword">data</span><span> </span><a name="IsGroupClosed"><a href="TcRnTypes.html#IsGroupClosed"><span class="hs-identifier">IsGroupClosed</span></a></a><span>
</span><a name="line-1146"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IsGroupClosed"><a href="TcRnTypes.html#IsGroupClosed"><span class="hs-identifier">IsGroupClosed</span></a></a><span>
</span><a name="line-1147"></a><span>      </span><span class="hs-special">(</span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="TcRnTypes.html#RhsNames"><span class="hs-identifier hs-type">RhsNames</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Free var info for the RHS of each binding in the goup</span><span>
</span><a name="line-1148"></a><span>                          </span><span class="hs-comment">-- Used only for (static e) checks</span><span>
</span><a name="line-1149"></a><span>
</span><a name="line-1150"></a><span>      </span><a href="TcRnTypes.html#ClosedTypeId"><span class="hs-identifier hs-type">ClosedTypeId</span></a><span>        </span><span class="hs-comment">-- True &lt;=&gt; all the free vars of the group are</span><span>
</span><a name="line-1151"></a><span>                          </span><span class="hs-comment">--          imported or ClosedLet or</span><span>
</span><a name="line-1152"></a><span>                          </span><span class="hs-comment">--          NonClosedLet with ClosedTypeId=True.</span><span>
</span><a name="line-1153"></a><span>                          </span><span class="hs-comment">--          In particular, no tyvars, no NotLetBound</span><span>
</span><a name="line-1154"></a><span>
</span><a name="line-1155"></a><span class="hs-keyword">type</span><span> </span><a name="RhsNames"><a href="TcRnTypes.html#RhsNames"><span class="hs-identifier">RhsNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameSet.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a><span>   </span><span class="hs-comment">-- Names of variables, mentioned on the RHS of</span><span>
</span><a name="line-1156"></a><span>                          </span><span class="hs-comment">-- a definition, that are not Global or ClosedLet</span><span>
</span><a name="line-1157"></a><span>
</span><a name="line-1158"></a><span class="hs-keyword">type</span><span> </span><a name="ClosedTypeId"><a href="TcRnTypes.html#ClosedTypeId"><span class="hs-identifier">ClosedTypeId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1159"></a><span>  </span><span class="hs-comment">-- See Note [Meaning of IdBindingInfo and ClosedTypeId]</span><span>
</span><a name="line-1160"></a><span>
</span><a name="line-1161"></a><span class="hs-comment">{- Note [Meaning of IdBindingInfo]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
NotLetBound means that
  the Id is not let-bound (e.g. it is bound in a
  lambda-abstraction or in a case pattern)

ClosedLet means that
   - The Id is let-bound,
   - Any free term variables are also Global or ClosedLet
   - Its type has no free variables (NB: a top-level binding subject
     to the MR might have free vars in its type)
   These ClosedLets can definitely be floated to top level; and we
   may need to do so for static forms.

   Property:   ClosedLet
             is equivalent to
               NonClosedLet emptyNameSet True

(NonClosedLet (fvs::RhsNames) (cl::ClosedTypeId)) means that
   - The Id is let-bound

   - The fvs::RhsNames contains the free names of the RHS,
     excluding Global and ClosedLet ones.

   - For the ClosedTypeId field see Note [Bindings with closed types]

For (static e) to be valid, we need for every 'x' free in 'e',
that x's binding is floatable to the top level.  Specifically:
   * x's RhsNames must be empty
   * x's type has no free variables
See Note [Grand plan for static forms] in StaticPtrTable.hs.
This test is made in TcExpr.checkClosedInStaticForm.
Actually knowing x's RhsNames (rather than just its emptiness
or otherwise) is just so we can produce better error messages

Note [Bindings with closed types: ClosedTypeId]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  f x = let g ys = map not ys
        in ...

Can we generalise 'g' under the OutsideIn algorithm?  Yes,
because all g's free variables are top-level; that is they themselves
have no free type variables, and it is the type variables in the
environment that makes things tricky for OutsideIn generalisation.

Here's the invariant:
   If an Id has ClosedTypeId=True (in its IdBindingInfo), then
   the Id's type is /definitely/ closed (has no free type variables).
   Specifically,
       a) The Id's acutal type is closed (has no free tyvars)
       b) Either the Id has a (closed) user-supplied type signature
          or all its free variables are Global/ClosedLet
             or NonClosedLet with ClosedTypeId=True.
          In particular, none are NotLetBound.

Why is (b) needed?   Consider
    \x. (x :: Int, let y = x+1 in ...)
Initially x::alpha.  If we happen to typecheck the 'let' before the
(x::Int), y's type will have a free tyvar; but if the other way round
it won't.  So we treat any let-bound variable with a free
non-let-bound variable as not ClosedTypeId, regardless of what the
free vars of its type actually are.

But if it has a signature, all is well:
   \x. ...(let { y::Int; y = x+1 } in
           let { v = y+2 } in ...)...
Here the signature on 'v' makes 'y' a ClosedTypeId, so we can
generalise 'v'.

Note that:

  * A top-level binding may not have ClosedTypeId=True, if it suffers
    from the MR

  * A nested binding may be closed (eg 'g' in the example we started
    with). Indeed, that's the point; whether a function is defined at
    top level or nested is orthogonal to the question of whether or
    not it is closed.

  * A binding may be non-closed because it mentions a lexically scoped
    *type variable*  Eg
        f :: forall a. blah
        f x = let g y = ...(y::a)...

Under OutsideIn we are free to generalise an Id all of whose free
variables have ClosedTypeId=True (or imported).  This is an extension
compared to the JFP paper on OutsideIn, which used &quot;top-level&quot; as a
proxy for &quot;closed&quot;.  (It's not a good proxy anyway -- the MR can make
a top-level binding with a free type variable.)

Note [Type variables in the type environment]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The type environment has a binding for each lexically-scoped
type variable that is in scope.  For example

  f :: forall a. a -&gt; a
  f x = (x :: a)

  g1 :: [a] -&gt; a
  g1 (ys :: [b]) = head ys :: b

  g2 :: [Int] -&gt; Int
  g2 (ys :: [c]) = head ys :: c

* The forall'd variable 'a' in the signature scopes over f's RHS.

* The pattern-bound type variable 'b' in 'g1' scopes over g1's
  RHS; note that it is bound to a skolem 'a' which is not itself
  lexically in scope.

* The pattern-bound type variable 'c' in 'g2' is bound to
  Int; that is, pattern-bound type variables can stand for
  arbitrary types. (see
    GHC proposal #128 &quot;Allow ScopedTypeVariables to refer to types&quot;
    https://github.com/ghc-proposals/ghc-proposals/pull/128,
  and the paper
    &quot;Type variables in patterns&quot;, Haskell Symposium 2018.


This is implemented by the constructor
   ATyVar Name TcTyVar
in the type environment.

* The Name is the name of the original, lexically scoped type
  variable

* The TcTyVar is sometimes a skolem (like in 'f'), and sometimes
  a unification variable (like in 'g1', 'g2').  We never zonk the
  type environment so in the latter case it always stays as a
  unification variable, although that variable may be later
  unified with a type (such as Int in 'g2').
-}</span><span>
</span><a name="line-1295"></a><span>
</span><a name="line-1296"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#IdBindingInfo"><span class="hs-identifier hs-type">IdBindingInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1297"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="TcRnTypes.html#NotLetBound"><span class="hs-identifier hs-var">NotLetBound</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;NotLetBound&quot;</span><span>
</span><a name="line-1298"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#ClosedLet"><span class="hs-identifier hs-var">ClosedLet</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;TopLevelLet&quot;</span><span>
</span><a name="line-1299"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#NonClosedLet"><span class="hs-identifier hs-var">NonClosedLet</span></a><span> </span><a name="local-6989586621684145964"><a href="#local-6989586621684145964"><span class="hs-identifier">fvs</span></a></a><span> </span><a name="local-6989586621684145965"><a href="#local-6989586621684145965"><span class="hs-identifier">closed_type</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1300"></a><span>    </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;TopLevelLet&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145964"><span class="hs-identifier hs-var">fvs</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145965"><span class="hs-identifier hs-var">closed_type</span></a><span>
</span><a name="line-1301"></a><span>
</span><a name="line-1302"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#PromotionErr"><span class="hs-identifier hs-type">PromotionErr</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1303"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="TcRnTypes.html#ClassPE"><span class="hs-identifier hs-var">ClassPE</span></a><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ClassPE&quot;</span><span>
</span><a name="line-1304"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#TyConPE"><span class="hs-identifier hs-var">TyConPE</span></a><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;TyConPE&quot;</span><span>
</span><a name="line-1305"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#PatSynPE"><span class="hs-identifier hs-var">PatSynPE</span></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;PatSynPE&quot;</span><span>
</span><a name="line-1306"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#PatSynExPE"><span class="hs-identifier hs-var">PatSynExPE</span></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;PatSynExPE&quot;</span><span>
</span><a name="line-1307"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#FamDataConPE"><span class="hs-identifier hs-var">FamDataConPE</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;FamDataConPE&quot;</span><span>
</span><a name="line-1308"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ConstrainedDataConPE"><span class="hs-identifier hs-var">ConstrainedDataConPE</span></a><span> </span><a name="local-6989586621684145963"><a href="#local-6989586621684145963"><span class="hs-identifier">pred</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ConstrainedDataConPE&quot;</span><span>
</span><a name="line-1309"></a><span>                                      </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145963"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">)</span><span>
</span><a name="line-1310"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#RecDataConPE"><span class="hs-identifier hs-var">RecDataConPE</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;RecDataConPE&quot;</span><span>
</span><a name="line-1311"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#NoDataKindsTC"><span class="hs-identifier hs-var">NoDataKindsTC</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;NoDataKindsTC&quot;</span><span>
</span><a name="line-1312"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#NoDataKindsDC"><span class="hs-identifier hs-var">NoDataKindsDC</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;NoDataKindsDC&quot;</span><span>
</span><a name="line-1313"></a><span>
</span><a name="line-1314"></a><span class="hs-identifier">pprTcTyThingCategory</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1315"></a><a name="pprTcTyThingCategory"><a href="TcRnTypes.html#pprTcTyThingCategory"><span class="hs-identifier">pprTcTyThingCategory</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a><span> </span><a name="local-6989586621684146000"><a href="#local-6989586621684146000"><span class="hs-identifier">thing</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprTyThingCategory"><span class="hs-identifier hs-var">pprTyThingCategory</span></a><span> </span><a href="#local-6989586621684146000"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1316"></a><span class="hs-identifier">pprTcTyThingCategory</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ATyVar"><span class="hs-identifier hs-var">ATyVar</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type variable&quot;</span><span>
</span><a name="line-1317"></a><span class="hs-identifier">pprTcTyThingCategory</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ATcId"><span class="hs-identifier hs-var">ATcId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Local identifier&quot;</span><span>
</span><a name="line-1318"></a><span class="hs-identifier">pprTcTyThingCategory</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ATcTyCon"><span class="hs-identifier hs-var">ATcTyCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Local tycon&quot;</span><span>
</span><a name="line-1319"></a><span class="hs-identifier">pprTcTyThingCategory</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#APromotionErr"><span class="hs-identifier hs-var">APromotionErr</span></a><span> </span><a name="local-6989586621684146001"><a href="#local-6989586621684146001"><span class="hs-identifier">pe</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#pprPECategory"><span class="hs-identifier hs-var">pprPECategory</span></a><span> </span><a href="#local-6989586621684146001"><span class="hs-identifier hs-var">pe</span></a><span>
</span><a name="line-1320"></a><span>
</span><a name="line-1321"></a><span class="hs-identifier">pprPECategory</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#PromotionErr"><span class="hs-identifier hs-type">PromotionErr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1322"></a><a name="pprPECategory"><a href="TcRnTypes.html#pprPECategory"><span class="hs-identifier">pprPECategory</span></a></a><span> </span><a href="TcRnTypes.html#ClassPE"><span class="hs-identifier hs-var">ClassPE</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Class&quot;</span><span>
</span><a name="line-1323"></a><span class="hs-identifier">pprPECategory</span><span> </span><a href="TcRnTypes.html#TyConPE"><span class="hs-identifier hs-var">TyConPE</span></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type constructor&quot;</span><span>
</span><a name="line-1324"></a><span class="hs-identifier">pprPECategory</span><span> </span><a href="TcRnTypes.html#PatSynPE"><span class="hs-identifier hs-var">PatSynPE</span></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Pattern synonym&quot;</span><span>
</span><a name="line-1325"></a><span class="hs-identifier">pprPECategory</span><span> </span><a href="TcRnTypes.html#PatSynExPE"><span class="hs-identifier hs-var">PatSynExPE</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Pattern synonym existential&quot;</span><span>
</span><a name="line-1326"></a><span class="hs-identifier">pprPECategory</span><span> </span><a href="TcRnTypes.html#FamDataConPE"><span class="hs-identifier hs-var">FamDataConPE</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Data constructor&quot;</span><span>
</span><a name="line-1327"></a><span class="hs-identifier">pprPECategory</span><span> </span><a href="TcRnTypes.html#ConstrainedDataConPE"><span class="hs-identifier hs-var">ConstrainedDataConPE</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Data constructor&quot;</span><span>
</span><a name="line-1328"></a><span class="hs-identifier">pprPECategory</span><span> </span><a href="TcRnTypes.html#RecDataConPE"><span class="hs-identifier hs-var">RecDataConPE</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Data constructor&quot;</span><span>
</span><a name="line-1329"></a><span class="hs-identifier">pprPECategory</span><span> </span><a href="TcRnTypes.html#NoDataKindsTC"><span class="hs-identifier hs-var">NoDataKindsTC</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Type constructor&quot;</span><span>
</span><a name="line-1330"></a><span class="hs-identifier">pprPECategory</span><span> </span><a href="TcRnTypes.html#NoDataKindsDC"><span class="hs-identifier hs-var">NoDataKindsDC</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Data constructor&quot;</span><span>
</span><a name="line-1331"></a><span>
</span><a name="line-1332"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Operations over ImportAvails
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1339"></a><span>
</span><a name="line-1340"></a><span class="hs-comment">-- | 'ImportAvails' summarises what was imported from where, irrespective of</span><span>
</span><a name="line-1341"></a><span class="hs-comment">-- whether the imported things are actually used or not.  It is used:</span><span>
</span><a name="line-1342"></a><span class="hs-comment">--</span><span>
</span><a name="line-1343"></a><span class="hs-comment">--  * when processing the export list,</span><span>
</span><a name="line-1344"></a><span class="hs-comment">--</span><span>
</span><a name="line-1345"></a><span class="hs-comment">--  * when constructing usage info for the interface file,</span><span>
</span><a name="line-1346"></a><span class="hs-comment">--</span><span>
</span><a name="line-1347"></a><span class="hs-comment">--  * to identify the list of directly imported modules for initialisation</span><span>
</span><a name="line-1348"></a><span class="hs-comment">--    purposes and for optimised overlap checking of family instances,</span><span>
</span><a name="line-1349"></a><span class="hs-comment">--</span><span>
</span><a name="line-1350"></a><span class="hs-comment">--  * when figuring out what things are really unused</span><span>
</span><a name="line-1351"></a><span class="hs-comment">--</span><span>
</span><a name="line-1352"></a><span class="hs-keyword">data</span><span> </span><a name="ImportAvails"><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier">ImportAvails</span></a></a><span>
</span><a name="line-1353"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="ImportAvails"><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier">ImportAvails</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1354"></a><span>        </span><a name="imp_mods"><a href="TcRnTypes.html#imp_mods"><span class="hs-identifier">imp_mods</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ImportedMods"><span class="hs-identifier hs-type">ImportedMods</span></a><span class="hs-special">,</span><span>
</span><a name="line-1355"></a><span>          </span><span class="hs-comment">--      = ModuleEnv [ImportedModsVal],</span><span>
</span><a name="line-1356"></a><span>          </span><span class="hs-comment">-- ^ Domain is all directly-imported modules</span><span>
</span><a name="line-1357"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-1358"></a><span>          </span><span class="hs-comment">-- See the documentation on ImportedModsVal in HscTypes for the</span><span>
</span><a name="line-1359"></a><span>          </span><span class="hs-comment">-- meaning of the fields.</span><span>
</span><a name="line-1360"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-1361"></a><span>          </span><span class="hs-comment">-- We need a full ModuleEnv rather than a ModuleNameEnv here,</span><span>
</span><a name="line-1362"></a><span>          </span><span class="hs-comment">-- because we might be importing modules of the same name from</span><span>
</span><a name="line-1363"></a><span>          </span><span class="hs-comment">-- different packages. (currently not the case, but might be in the</span><span>
</span><a name="line-1364"></a><span>          </span><span class="hs-comment">-- future).</span><span>
</span><a name="line-1365"></a><span>
</span><a name="line-1366"></a><span>        </span><a name="imp_dep_mods"><a href="TcRnTypes.html#imp_dep_mods"><span class="hs-identifier">imp_dep_mods</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleNameEnv"><span class="hs-identifier hs-type">ModuleNameEnv</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1367"></a><span>          </span><span class="hs-comment">-- ^ Home-package modules needed by the module being compiled</span><span>
</span><a name="line-1368"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-1369"></a><span>          </span><span class="hs-comment">-- It doesn't matter whether any of these dependencies</span><span>
</span><a name="line-1370"></a><span>          </span><span class="hs-comment">-- are actually /used/ when compiling the module; they</span><span>
</span><a name="line-1371"></a><span>          </span><span class="hs-comment">-- are listed if they are below it at all.  For</span><span>
</span><a name="line-1372"></a><span>          </span><span class="hs-comment">-- example, suppose M imports A which imports X.  Then</span><span>
</span><a name="line-1373"></a><span>          </span><span class="hs-comment">-- compiling M might not need to consult X.hi, but X</span><span>
</span><a name="line-1374"></a><span>          </span><span class="hs-comment">-- is still listed in M's dependencies.</span><span>
</span><a name="line-1375"></a><span>
</span><a name="line-1376"></a><span>        </span><a name="imp_dep_pkgs"><a href="TcRnTypes.html#imp_dep_pkgs"><span class="hs-identifier">imp_dep_pkgs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-1377"></a><span>          </span><span class="hs-comment">-- ^ Packages needed by the module being compiled, whether directly,</span><span>
</span><a name="line-1378"></a><span>          </span><span class="hs-comment">-- or via other modules in this package, or via modules imported</span><span>
</span><a name="line-1379"></a><span>          </span><span class="hs-comment">-- from other packages.</span><span>
</span><a name="line-1380"></a><span>
</span><a name="line-1381"></a><span>        </span><a name="imp_trust_pkgs"><a href="TcRnTypes.html#imp_trust_pkgs"><span class="hs-identifier">imp_trust_pkgs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span class="hs-special">,</span><span>
</span><a name="line-1382"></a><span>          </span><span class="hs-comment">-- ^ This is strictly a subset of imp_dep_pkgs and records the</span><span>
</span><a name="line-1383"></a><span>          </span><span class="hs-comment">-- packages the current module needs to trust for Safe Haskell</span><span>
</span><a name="line-1384"></a><span>          </span><span class="hs-comment">-- compilation to succeed. A package is required to be trusted if</span><span>
</span><a name="line-1385"></a><span>          </span><span class="hs-comment">-- we are dependent on a trustworthy module in that package.</span><span>
</span><a name="line-1386"></a><span>          </span><span class="hs-comment">-- While perhaps making imp_dep_pkgs a tuple of (UnitId, Bool)</span><span>
</span><a name="line-1387"></a><span>          </span><span class="hs-comment">-- where True for the bool indicates the package is required to be</span><span>
</span><a name="line-1388"></a><span>          </span><span class="hs-comment">-- trusted is the more logical  design, doing so complicates a lot</span><span>
</span><a name="line-1389"></a><span>          </span><span class="hs-comment">-- of code not concerned with Safe Haskell.</span><span>
</span><a name="line-1390"></a><span>          </span><span class="hs-comment">-- See Note [RnNames . Tracking Trust Transitively]</span><span>
</span><a name="line-1391"></a><span>
</span><a name="line-1392"></a><span>        </span><a name="imp_trust_own_pkg"><a href="TcRnTypes.html#imp_trust_own_pkg"><span class="hs-identifier">imp_trust_own_pkg</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>
</span><a name="line-1393"></a><span>          </span><span class="hs-comment">-- ^ Do we require that our own package is trusted?</span><span>
</span><a name="line-1394"></a><span>          </span><span class="hs-comment">-- This is to handle efficiently the case where a Safe module imports</span><span>
</span><a name="line-1395"></a><span>          </span><span class="hs-comment">-- a Trustworthy module that resides in the same package as it.</span><span>
</span><a name="line-1396"></a><span>          </span><span class="hs-comment">-- See Note [RnNames . Trust Own Package]</span><span>
</span><a name="line-1397"></a><span>
</span><a name="line-1398"></a><span>        </span><a name="imp_orphs"><a href="TcRnTypes.html#imp_orphs"><span class="hs-identifier">imp_orphs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1399"></a><span>          </span><span class="hs-comment">-- ^ Orphan modules below us in the import tree (and maybe including</span><span>
</span><a name="line-1400"></a><span>          </span><span class="hs-comment">-- us for imported modules)</span><span>
</span><a name="line-1401"></a><span>
</span><a name="line-1402"></a><span>        </span><a name="imp_finsts"><a href="TcRnTypes.html#imp_finsts"><span class="hs-identifier">imp_finsts</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">]</span><span>
</span><a name="line-1403"></a><span>          </span><span class="hs-comment">-- ^ Family instance modules below us in the import tree (and maybe</span><span>
</span><a name="line-1404"></a><span>          </span><span class="hs-comment">-- including us for imported modules)</span><span>
</span><a name="line-1405"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-1406"></a><span>
</span><a name="line-1407"></a><span class="hs-identifier">mkModDeps</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1408"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleNameEnv"><span class="hs-identifier hs-type">ModuleNameEnv</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span>
</span><a name="line-1409"></a><a name="mkModDeps"><a href="TcRnTypes.html#mkModDeps"><span class="hs-identifier">mkModDeps</span></a></a><span> </span><a name="local-6989586621684146002"><a href="#local-6989586621684146002"><span class="hs-identifier">deps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621684146003"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span> </span><a href="#local-6989586621684146002"><span class="hs-identifier hs-var">deps</span></a><span>
</span><a name="line-1410"></a><span>               </span><span class="hs-keyword">where</span><span>
</span><a name="line-1411"></a><span>                 </span><a name="local-6989586621684146003"><a href="#local-6989586621684146003"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621684146004"><a href="#local-6989586621684146004"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621684146005"><a href="#local-6989586621684146005"><span class="hs-identifier">elt</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621684146006"><a href="#local-6989586621684146006"><span class="hs-identifier">m</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#addToUFM"><span class="hs-identifier hs-var">addToUFM</span></a><span> </span><a href="#local-6989586621684146004"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621684146006"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621684146005"><span class="hs-identifier hs-var">elt</span></a><span>
</span><a name="line-1412"></a><span>
</span><a name="line-1413"></a><span class="hs-identifier">modDepsElts</span><span>
</span><a name="line-1414"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleNameEnv"><span class="hs-identifier hs-type">ModuleNameEnv</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span>
</span><a name="line-1415"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1416"></a><a name="modDepsElts"><a href="TcRnTypes.html#modDepsElts"><span class="hs-identifier">modDepsElts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="UniqFM.html#nonDetEltsUFM"><span class="hs-identifier hs-var">nonDetEltsUFM</span></a><span>
</span><a name="line-1417"></a><span>  </span><span class="hs-comment">-- It's OK to use nonDetEltsUFM here because sorting by module names</span><span>
</span><a name="line-1418"></a><span>  </span><span class="hs-comment">-- restores determinism</span><span>
</span><a name="line-1419"></a><span>
</span><a name="line-1420"></a><span class="hs-identifier">emptyImportAvails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a><span>
</span><a name="line-1421"></a><a name="emptyImportAvails"><a href="TcRnTypes.html#emptyImportAvails"><span class="hs-identifier">emptyImportAvails</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier hs-var">ImportAvails</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">imp_mods</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#emptyModuleEnv"><span class="hs-identifier hs-var">emptyModuleEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-1422"></a><span>                                   </span><span class="hs-identifier">imp_dep_mods</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span class="hs-special">,</span><span>
</span><a name="line-1423"></a><span>                                   </span><span class="hs-identifier">imp_dep_pkgs</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span class="hs-special">,</span><span>
</span><a name="line-1424"></a><span>                                   </span><span class="hs-identifier">imp_trust_pkgs</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span class="hs-special">,</span><span>
</span><a name="line-1425"></a><span>                                   </span><span class="hs-identifier">imp_trust_own_pkg</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-1426"></a><span>                                   </span><span class="hs-identifier">imp_orphs</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1427"></a><span>                                   </span><span class="hs-identifier">imp_finsts</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1428"></a><span>
</span><a name="line-1429"></a><span class="hs-comment">-- | Union two ImportAvails</span><span>
</span><a name="line-1430"></a><span class="hs-comment">--</span><span>
</span><a name="line-1431"></a><span class="hs-comment">-- This function is a key part of Import handling, basically</span><span>
</span><a name="line-1432"></a><span class="hs-comment">-- for each import we create a separate ImportAvails structure</span><span>
</span><a name="line-1433"></a><span class="hs-comment">-- and then union them all together with this function.</span><span>
</span><a name="line-1434"></a><span class="hs-identifier">plusImportAvails</span><span> </span><span class="hs-glyph">::</span><span>  </span><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a><span>
</span><a name="line-1435"></a><a name="plusImportAvails"><a href="TcRnTypes.html#plusImportAvails"><span class="hs-identifier">plusImportAvails</span></a></a><span>
</span><a name="line-1436"></a><span>  </span><span class="hs-special">(</span><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier hs-var">ImportAvails</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">imp_mods</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146007"><a href="#local-6989586621684146007"><span class="hs-identifier">mods1</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1437"></a><span>                  </span><span class="hs-identifier">imp_dep_mods</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146008"><a href="#local-6989586621684146008"><span class="hs-identifier">dmods1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">imp_dep_pkgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146009"><a href="#local-6989586621684146009"><span class="hs-identifier">dpkgs1</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1438"></a><span>                  </span><span class="hs-identifier">imp_trust_pkgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146010"><a href="#local-6989586621684146010"><span class="hs-identifier">tpkgs1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">imp_trust_own_pkg</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146011"><a href="#local-6989586621684146011"><span class="hs-identifier">tself1</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1439"></a><span>                  </span><span class="hs-identifier">imp_orphs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146012"><a href="#local-6989586621684146012"><span class="hs-identifier">orphs1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">imp_finsts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146013"><a href="#local-6989586621684146013"><span class="hs-identifier">finsts1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1440"></a><span>  </span><span class="hs-special">(</span><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier hs-var">ImportAvails</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">imp_mods</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146014"><a href="#local-6989586621684146014"><span class="hs-identifier">mods2</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1441"></a><span>                  </span><span class="hs-identifier">imp_dep_mods</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146015"><a href="#local-6989586621684146015"><span class="hs-identifier">dmods2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">imp_dep_pkgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146016"><a href="#local-6989586621684146016"><span class="hs-identifier">dpkgs2</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1442"></a><span>                  </span><span class="hs-identifier">imp_trust_pkgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146017"><a href="#local-6989586621684146017"><span class="hs-identifier">tpkgs2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">imp_trust_own_pkg</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146018"><a href="#local-6989586621684146018"><span class="hs-identifier">tself2</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1443"></a><span>                  </span><span class="hs-identifier">imp_orphs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146019"><a href="#local-6989586621684146019"><span class="hs-identifier">orphs2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">imp_finsts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146020"><a href="#local-6989586621684146020"><span class="hs-identifier">finsts2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1444"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ImportAvails"><span class="hs-identifier hs-var">ImportAvails</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">imp_mods</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#plusModuleEnv_C"><span class="hs-identifier hs-var">plusModuleEnv_C</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684146007"><span class="hs-identifier hs-var">mods1</span></a><span> </span><a href="#local-6989586621684146014"><span class="hs-identifier hs-var">mods2</span></a><span class="hs-special">,</span><span>
</span><a name="line-1445"></a><span>                   </span><span class="hs-identifier">imp_dep_mods</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#plusUFM_C"><span class="hs-identifier hs-var">plusUFM_C</span></a><span> </span><a href="#local-6989586621684146021"><span class="hs-identifier hs-var">plus_mod_dep</span></a><span> </span><a href="#local-6989586621684146008"><span class="hs-identifier hs-var">dmods1</span></a><span> </span><a href="#local-6989586621684146015"><span class="hs-identifier hs-var">dmods2</span></a><span class="hs-special">,</span><span>
</span><a name="line-1446"></a><span>                   </span><span class="hs-identifier">imp_dep_pkgs</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146009"><span class="hs-identifier hs-var">dpkgs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">S.union</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146016"><span class="hs-identifier hs-var">dpkgs2</span></a><span class="hs-special">,</span><span>
</span><a name="line-1447"></a><span>                   </span><span class="hs-identifier">imp_trust_pkgs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146010"><span class="hs-identifier hs-var">tpkgs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">S.union</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146017"><span class="hs-identifier hs-var">tpkgs2</span></a><span class="hs-special">,</span><span>
</span><a name="line-1448"></a><span>                   </span><span class="hs-identifier">imp_trust_own_pkg</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146011"><span class="hs-identifier hs-var">tself1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684146018"><span class="hs-identifier hs-var">tself2</span></a><span class="hs-special">,</span><span>
</span><a name="line-1449"></a><span>                   </span><span class="hs-identifier">imp_orphs</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146012"><span class="hs-identifier hs-var">orphs1</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146019"><span class="hs-identifier hs-var">orphs2</span></a><span class="hs-special">,</span><span>
</span><a name="line-1450"></a><span>                   </span><span class="hs-identifier">imp_finsts</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146013"><span class="hs-identifier hs-var">finsts1</span></a><span> </span><span class="hs-special">`</span><a href="ListSetOps.html#unionLists"><span class="hs-identifier hs-var">unionLists</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146020"><span class="hs-identifier hs-var">finsts2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1451"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1452"></a><span>    </span><a name="local-6989586621684146021"><a href="#local-6989586621684146021"><span class="hs-identifier">plus_mod_dep</span></a></a><span> </span><a name="local-6989586621684146022"><a href="#local-6989586621684146022"><span class="hs-identifier">r1</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621684146023"><a href="#local-6989586621684146023"><span class="hs-identifier">m1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684146024"><a href="#local-6989586621684146024"><span class="hs-identifier">boot1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684146025"><a href="#local-6989586621684146025"><span class="hs-identifier">r2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621684146026"><a href="#local-6989586621684146026"><span class="hs-identifier">m2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684146027"><a href="#local-6989586621684146027"><span class="hs-identifier">boot2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1453"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><a href="Util.html#debugIsOn"><span class="hs-identifier hs-var">m1</span></a><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">m2</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">m1</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">m2</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-operator hs-var">$$</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="Outputable.html#assertPprPanic"><span class="hs-identifier hs-var">boot1</span></a><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">boot2</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1454"></a><span>        </span><a href="#local-6989586621684146024"><span class="hs-identifier hs-var">boot1</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146025"><span class="hs-identifier hs-var">r2</span></a><span>
</span><a name="line-1455"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146022"><span class="hs-identifier hs-var">r1</span></a><span>
</span><a name="line-1456"></a><span>      </span><span class="hs-comment">-- If either side can &quot;see&quot; a non-hi-boot interface, use that</span><span>
</span><a name="line-1457"></a><span>      </span><span class="hs-comment">-- Reusing existing tuples saves 10% of allocations on test</span><span>
</span><a name="line-1458"></a><span>      </span><span class="hs-comment">-- perf/compiler/MultiLayerModules</span><span>
</span><a name="line-1459"></a><span>
</span><a name="line-1460"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Where from}
*                                                                      *
************************************************************************

The @WhereFrom@ type controls where the renamer looks for an interface file
-}</span><span>
</span><a name="line-1469"></a><span>
</span><a name="line-1470"></a><span class="hs-keyword">data</span><span> </span><a name="WhereFrom"><a href="TcRnTypes.html#WhereFrom"><span class="hs-identifier">WhereFrom</span></a></a><span>
</span><a name="line-1471"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ImportByUser"><a href="TcRnTypes.html#ImportByUser"><span class="hs-identifier">ImportByUser</span></a></a><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span>        </span><span class="hs-comment">-- Ordinary user import (perhaps {-# SOURCE #-})</span><span>
</span><a name="line-1472"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImportBySystem"><a href="TcRnTypes.html#ImportBySystem"><span class="hs-identifier">ImportBySystem</span></a></a><span>                      </span><span class="hs-comment">-- Non user import.</span><span>
</span><a name="line-1473"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ImportByPlugin"><a href="TcRnTypes.html#ImportByPlugin"><span class="hs-identifier">ImportByPlugin</span></a></a><span>                      </span><span class="hs-comment">-- Importing a plugin;</span><span>
</span><a name="line-1474"></a><span>                                        </span><span class="hs-comment">-- See Note [Care with plugin imports] in LoadIface</span><span>
</span><a name="line-1475"></a><span>
</span><a name="line-1476"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#WhereFrom"><span class="hs-identifier hs-type">WhereFrom</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1477"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ImportByUser"><span class="hs-identifier hs-var">ImportByUser</span></a><span> </span><a name="local-6989586621684145962"><a href="#local-6989586621684145962"><span class="hs-identifier">is_boot</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684145962"><span class="hs-identifier hs-var">is_boot</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;{- SOURCE -}&quot;</span><span>
</span><a name="line-1478"></a><span>                             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-1479"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#ImportBySystem"><span class="hs-identifier hs-var">ImportBySystem</span></a><span>                       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;{- SYSTEM -}&quot;</span><span>
</span><a name="line-1480"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#ImportByPlugin"><span class="hs-identifier hs-var">ImportByPlugin</span></a><span>                       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;{- PLUGIN -}&quot;</span><span>
</span><a name="line-1481"></a><span>
</span><a name="line-1482"></a><span>
</span><a name="line-1483"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Type signatures
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-1488"></a><span>
</span><a name="line-1489"></a><span class="hs-comment">-- These data types need to be here only because</span><span>
</span><a name="line-1490"></a><span class="hs-comment">-- TcSimplify uses them, and TcSimplify is fairly</span><span>
</span><a name="line-1491"></a><span class="hs-comment">-- low down in the module hierarchy</span><span>
</span><a name="line-1492"></a><span>
</span><a name="line-1493"></a><span class="hs-keyword">type</span><span> </span><a name="TcSigFun"><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier">TcSigFun</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TcRnTypes.html#TcSigInfo"><span class="hs-identifier hs-type">TcSigInfo</span></a><span>
</span><a name="line-1494"></a><span>
</span><a name="line-1495"></a><span class="hs-keyword">data</span><span> </span><a name="TcSigInfo"><a href="TcRnTypes.html#TcSigInfo"><span class="hs-identifier">TcSigInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TcIdSig"><a href="TcRnTypes.html#TcIdSig"><span class="hs-identifier">TcIdSig</span></a></a><span>     </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span>
</span><a name="line-1496"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a name="TcPatSynSig"><a href="TcRnTypes.html#TcPatSynSig"><span class="hs-identifier">TcPatSynSig</span></a></a><span> </span><a href="TcRnTypes.html#TcPatSynInfo"><span class="hs-identifier hs-type">TcPatSynInfo</span></a><span>
</span><a name="line-1497"></a><span>
</span><a name="line-1498"></a><span class="hs-keyword">data</span><span> </span><a name="TcIdSigInfo"><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier">TcIdSigInfo</span></a></a><span>   </span><span class="hs-comment">-- See Note [Complete and partial type signatures]</span><span>
</span><a name="line-1499"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="CompleteSig"><a href="TcRnTypes.html#CompleteSig"><span class="hs-identifier">CompleteSig</span></a></a><span>    </span><span class="hs-comment">-- A complete signature with no wildcards,</span><span>
</span><a name="line-1500"></a><span>                   </span><span class="hs-comment">-- so the complete polymorphic type is known.</span><span>
</span><a name="line-1501"></a><span>      </span><span class="hs-special">{</span><span> </span><a name="sig_bndr"><a href="TcRnTypes.html#sig_bndr"><span class="hs-identifier">sig_bndr</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcId"><span class="hs-identifier hs-type">TcId</span></a><span>          </span><span class="hs-comment">-- The polymorphic Id with that type</span><span>
</span><a name="line-1502"></a><span>
</span><a name="line-1503"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="sig_ctxt"><a href="TcRnTypes.html#sig_ctxt"><span class="hs-identifier">sig_ctxt</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>  </span><span class="hs-comment">-- In the case of type-class default methods,</span><span>
</span><a name="line-1504"></a><span>                                  </span><span class="hs-comment">-- the Name in the FunSigCtxt is not the same</span><span>
</span><a name="line-1505"></a><span>                                  </span><span class="hs-comment">-- as the TcId; the former is 'op', while the</span><span>
</span><a name="line-1506"></a><span>                                  </span><span class="hs-comment">-- latter is '$dmop' or some such</span><span>
</span><a name="line-1507"></a><span>
</span><a name="line-1508"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="sig_loc"><a href="TcRnTypes.html#sig_loc"><span class="hs-identifier">sig_loc</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>       </span><span class="hs-comment">-- Location of the type signature</span><span>
</span><a name="line-1509"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-1510"></a><span>
</span><a name="line-1511"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PartialSig"><a href="TcRnTypes.html#PartialSig"><span class="hs-identifier">PartialSig</span></a></a><span>     </span><span class="hs-comment">-- A partial type signature (i.e. includes one or more</span><span>
</span><a name="line-1512"></a><span>                   </span><span class="hs-comment">-- wildcards). In this case it doesn't make sense to give</span><span>
</span><a name="line-1513"></a><span>                   </span><span class="hs-comment">-- the polymorphic Id, because we are going to /infer/ its</span><span>
</span><a name="line-1514"></a><span>                   </span><span class="hs-comment">-- type, so we can't make the polymorphic Id ab-initio</span><span>
</span><a name="line-1515"></a><span>      </span><span class="hs-special">{</span><span> </span><a name="psig_name"><a href="TcRnTypes.html#psig_name"><span class="hs-identifier">psig_name</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>   </span><span class="hs-comment">-- Name of the function; used when report wildcards</span><span>
</span><a name="line-1516"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="psig_hs_ty"><a href="TcRnTypes.html#psig_hs_ty"><span class="hs-identifier">psig_hs_ty</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span>  </span><span class="hs-comment">-- The original partial signature in</span><span>
</span><a name="line-1517"></a><span>                                          </span><span class="hs-comment">-- HsSyn form</span><span>
</span><a name="line-1518"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="sig_ctxt"><a href="TcRnTypes.html#sig_ctxt"><span class="hs-identifier">sig_ctxt</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>
</span><a name="line-1519"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="sig_loc"><a href="TcRnTypes.html#sig_loc"><span class="hs-identifier">sig_loc</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>            </span><span class="hs-comment">-- Location of the type signature</span><span>
</span><a name="line-1520"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-1521"></a><span>
</span><a name="line-1522"></a><span>
</span><a name="line-1523"></a><span class="hs-comment">{- Note [Complete and partial type signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A type signature is partial when it contains one or more wildcards
(= type holes).  The wildcard can either be:
* A (type) wildcard occurring in sig_theta or sig_tau. These are
  stored in sig_wcs.
      f :: Bool -&gt; _
      g :: Eq _a =&gt; _a -&gt; _a -&gt; Bool
* Or an extra-constraints wildcard, stored in sig_cts:
      h :: (Num a, _) =&gt; a -&gt; a

A type signature is a complete type signature when there are no
wildcards in the type signature, i.e. iff sig_wcs is empty and
sig_extra_cts is Nothing.
-}</span><span>
</span><a name="line-1538"></a><span>
</span><a name="line-1539"></a><span class="hs-keyword">data</span><span> </span><a name="TcIdSigInst"><a href="TcRnTypes.html#TcIdSigInst"><span class="hs-identifier">TcIdSigInst</span></a></a><span>
</span><a name="line-1540"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TISI"><a href="TcRnTypes.html#TISI"><span class="hs-identifier">TISI</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="sig_inst_sig"><a href="TcRnTypes.html#sig_inst_sig"><span class="hs-identifier">sig_inst_sig</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span>
</span><a name="line-1541"></a><span>
</span><a name="line-1542"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="sig_inst_skols"><a href="TcRnTypes.html#sig_inst_skols"><span class="hs-identifier">sig_inst_skols</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1543"></a><span>               </span><span class="hs-comment">-- Instantiated type and kind variables, TyVarTvs</span><span>
</span><a name="line-1544"></a><span>               </span><span class="hs-comment">-- The Name is the Name that the renamer chose;</span><span>
</span><a name="line-1545"></a><span>               </span><span class="hs-comment">--   but the TcTyVar may come from instantiating</span><span>
</span><a name="line-1546"></a><span>               </span><span class="hs-comment">--   the type and hence have a different unique.</span><span>
</span><a name="line-1547"></a><span>               </span><span class="hs-comment">-- No need to keep track of whether they are truly lexically</span><span>
</span><a name="line-1548"></a><span>               </span><span class="hs-comment">--   scoped because the renamer has named them uniquely</span><span>
</span><a name="line-1549"></a><span>               </span><span class="hs-comment">-- See Note [Binding scoped type variables] in TcSigs</span><span>
</span><a name="line-1550"></a><span>
</span><a name="line-1551"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="sig_inst_theta"><a href="TcRnTypes.html#sig_inst_theta"><span class="hs-identifier">sig_inst_theta</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span>
</span><a name="line-1552"></a><span>               </span><span class="hs-comment">-- Instantiated theta.  In the case of a</span><span>
</span><a name="line-1553"></a><span>               </span><span class="hs-comment">-- PartialSig, sig_theta does not include</span><span>
</span><a name="line-1554"></a><span>               </span><span class="hs-comment">-- the extra-constraints wildcard</span><span>
</span><a name="line-1555"></a><span>
</span><a name="line-1556"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="sig_inst_tau"><a href="TcRnTypes.html#sig_inst_tau"><span class="hs-identifier">sig_inst_tau</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span>   </span><span class="hs-comment">-- Instantiated tau</span><span>
</span><a name="line-1557"></a><span>               </span><span class="hs-comment">-- See Note [sig_inst_tau may be polymorphic]</span><span>
</span><a name="line-1558"></a><span>
</span><a name="line-1559"></a><span>         </span><span class="hs-comment">-- Relevant for partial signature only</span><span>
</span><a name="line-1560"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="sig_inst_wcs"><a href="TcRnTypes.html#sig_inst_wcs"><span class="hs-identifier">sig_inst_wcs</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1561"></a><span>               </span><span class="hs-comment">-- Like sig_inst_skols, but for wildcards.  The named</span><span>
</span><a name="line-1562"></a><span>               </span><span class="hs-comment">-- wildcards scope over the binding, and hence their</span><span>
</span><a name="line-1563"></a><span>               </span><span class="hs-comment">-- Names may appear in type signatures in the binding</span><span>
</span><a name="line-1564"></a><span>
</span><a name="line-1565"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="sig_inst_wcx"><a href="TcRnTypes.html#sig_inst_wcx"><span class="hs-identifier">sig_inst_wcx</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-1566"></a><span>               </span><span class="hs-comment">-- Extra-constraints wildcard to fill in, if any</span><span>
</span><a name="line-1567"></a><span>               </span><span class="hs-comment">-- If this exists, it is surely of the form (meta_tv |&gt; co)</span><span>
</span><a name="line-1568"></a><span>               </span><span class="hs-comment">-- (where the co might be reflexive). This is filled in</span><span>
</span><a name="line-1569"></a><span>               </span><span class="hs-comment">-- only from the return value of TcHsType.tcWildCardOcc</span><span>
</span><a name="line-1570"></a><span>         </span><span class="hs-special">}</span><span>
</span><a name="line-1571"></a><span>
</span><a name="line-1572"></a><span class="hs-comment">{- Note [sig_inst_tau may be polymorphic]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Note that &quot;sig_inst_tau&quot; might actually be a polymorphic type,
if the original function had a signature like
   forall a. Eq a =&gt; forall b. Ord b =&gt; ....
But that's ok: tcMatchesFun (called by tcRhs) can deal with that
It happens, too!  See Note [Polymorphic methods] in TcClassDcl.

Note [Wildcards in partial signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The wildcards in psig_wcs may stand for a type mentioning
the universally-quantified tyvars of psig_ty

E.g.  f :: forall a. _ -&gt; a
      f x = x
We get sig_inst_skols = [a]
       sig_inst_tau   = _22 -&gt; a
       sig_inst_wcs   = [_22]
and _22 in the end is unified with the type 'a'

Moreover the kind of a wildcard in sig_inst_wcs may mention
the universally-quantified tyvars sig_inst_skols
e.g.   f :: t a -&gt; t _
Here we get
   sig_inst_skols = [k:*, (t::k -&gt;*), (a::k)]
   sig_inst_tau   = t a -&gt; t _22
   sig_inst_wcs   = [ _22::k ]
-}</span><span>
</span><a name="line-1600"></a><span>
</span><a name="line-1601"></a><span class="hs-keyword">data</span><span> </span><a name="TcPatSynInfo"><a href="TcRnTypes.html#TcPatSynInfo"><span class="hs-identifier">TcPatSynInfo</span></a></a><span>
</span><a name="line-1602"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TPSI"><a href="TcRnTypes.html#TPSI"><span class="hs-identifier">TPSI</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1603"></a><span>        </span><a name="patsig_name"><a href="TcRnTypes.html#patsig_name"><span class="hs-identifier">patsig_name</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span>
</span><a name="line-1604"></a><span>        </span><a name="patsig_implicit_bndrs"><a href="TcRnTypes.html#patsig_implicit_bndrs"><span class="hs-identifier">patsig_implicit_bndrs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVarBinder"><span class="hs-identifier hs-type">TyVarBinder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Implicitly-bound kind vars (Inferred) and</span><span>
</span><a name="line-1605"></a><span>                                                </span><span class="hs-comment">-- implicitly-bound type vars (Specified)</span><span>
</span><a name="line-1606"></a><span>          </span><span class="hs-comment">-- See Note [The pattern-synonym signature splitting rule] in TcPatSyn</span><span>
</span><a name="line-1607"></a><span>        </span><a name="patsig_univ_bndrs"><a href="TcRnTypes.html#patsig_univ_bndrs"><span class="hs-identifier">patsig_univ_bndrs</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- Bound by explicit user forall</span><span>
</span><a name="line-1608"></a><span>        </span><a name="patsig_req"><a href="TcRnTypes.html#patsig_req"><span class="hs-identifier">patsig_req</span></a></a><span>            </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span class="hs-special">,</span><span>
</span><a name="line-1609"></a><span>        </span><a name="patsig_ex_bndrs"><a href="TcRnTypes.html#patsig_ex_bndrs"><span class="hs-identifier">patsig_ex_bndrs</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- Bound by explicit user forall</span><span>
</span><a name="line-1610"></a><span>        </span><a name="patsig_prov"><a href="TcRnTypes.html#patsig_prov"><span class="hs-identifier">patsig_prov</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcThetaType"><span class="hs-identifier hs-type">TcThetaType</span></a><span class="hs-special">,</span><span>
</span><a name="line-1611"></a><span>        </span><a name="patsig_body_ty"><a href="TcRnTypes.html#patsig_body_ty"><span class="hs-identifier">patsig_body_ty</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a><span>
</span><a name="line-1612"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1613"></a><span>
</span><a name="line-1614"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#TcSigInfo"><span class="hs-identifier hs-type">TcSigInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1615"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcIdSig"><span class="hs-identifier hs-var">TcIdSig</span></a><span>     </span><a name="local-6989586621684145960"><a href="#local-6989586621684145960"><span class="hs-identifier">idsi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145960"><span class="hs-identifier hs-var">idsi</span></a><span>
</span><a name="line-1616"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcPatSynSig"><span class="hs-identifier hs-var">TcPatSynSig</span></a><span> </span><a name="local-6989586621684145961"><a href="#local-6989586621684145961"><span class="hs-identifier">tpsi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;TcPatSynInfo&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145961"><span class="hs-identifier hs-var">tpsi</span></a><span>
</span><a name="line-1617"></a><span>
</span><a name="line-1618"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1619"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CompleteSig"><span class="hs-identifier hs-var">CompleteSig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_bndr</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145957"><a href="#local-6989586621684145957"><span class="hs-identifier">bndr</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1620"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145957"><span class="hs-identifier hs-var">bndr</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684145957"><span class="hs-identifier hs-var">bndr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1621"></a><span>    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#PartialSig"><span class="hs-identifier hs-var">PartialSig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">psig_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145958"><a href="#local-6989586621684145958"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">psig_hs_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145959"><a href="#local-6989586621684145959"><span class="hs-identifier">hs_ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1622"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;psig&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145958"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145959"><span class="hs-identifier hs-var">hs_ty</span></a><span>
</span><a name="line-1623"></a><span>
</span><a name="line-1624"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#TcIdSigInst"><span class="hs-identifier hs-type">TcIdSigInst</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1625"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_inst_sig</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145953"><a href="#local-6989586621684145953"><span class="hs-identifier">sig</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_inst_skols</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145954"><a href="#local-6989586621684145954"><span class="hs-identifier">skols</span></a></a><span>
</span><a name="line-1626"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_inst_theta</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145955"><a href="#local-6989586621684145955"><span class="hs-identifier">theta</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">sig_inst_tau</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145956"><a href="#local-6989586621684145956"><span class="hs-identifier">tau</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1627"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145953"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145954"><span class="hs-identifier hs-var">skols</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145955"><span class="hs-identifier hs-var">theta</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#darrow"><span class="hs-identifier hs-var">darrow</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145956"><span class="hs-identifier hs-var">tau</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1628"></a><span>
</span><a name="line-1629"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#TcPatSynInfo"><span class="hs-identifier hs-type">TcPatSynInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1630"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TPSI"><span class="hs-identifier hs-var">TPSI</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">patsig_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145952"><a href="#local-6989586621684145952"><span class="hs-identifier">name</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145952"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-1631"></a><span>
</span><a name="line-1632"></a><span class="hs-identifier">isPartialSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcIdSigInst"><span class="hs-identifier hs-type">TcIdSigInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1633"></a><a name="isPartialSig"><a href="TcRnTypes.html#isPartialSig"><span class="hs-identifier">isPartialSig</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TISI"><span class="hs-identifier hs-var">TISI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sig_inst_sig</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#PartialSig"><span class="hs-identifier hs-var">PartialSig</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1634"></a><span class="hs-identifier">isPartialSig</span><span> </span><span class="hs-identifier">_</span><span>                                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1635"></a><span>
</span><a name="line-1636"></a><span class="hs-comment">-- | No signature or a partial signature</span><span>
</span><a name="line-1637"></a><span class="hs-identifier">hasCompleteSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcSigFun"><span class="hs-identifier hs-type">TcSigFun</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1638"></a><a name="hasCompleteSig"><a href="TcRnTypes.html#hasCompleteSig"><span class="hs-identifier">hasCompleteSig</span></a></a><span> </span><a name="local-6989586621684146028"><a href="#local-6989586621684146028"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-6989586621684146029"><a href="#local-6989586621684146029"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-1639"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684146028"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-6989586621684146029"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1640"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcIdSig"><span class="hs-identifier hs-var">TcIdSig</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CompleteSig"><span class="hs-identifier hs-var">CompleteSig</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1641"></a><span>      </span><span class="hs-identifier">_</span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1642"></a><span>
</span><a name="line-1643"></a><span>
</span><a name="line-1644"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
*                       Canonical constraints                          *
*                                                                      *
*   These are the constraints the low-level simplifier works with      *
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1653"></a><span>
</span><a name="line-1654"></a><span class="hs-comment">-- The syntax of xi (&#958;) types:</span><span>
</span><a name="line-1655"></a><span class="hs-comment">-- xi ::= a | T xis | xis -&gt; xis | ... | forall a. tau</span><span>
</span><a name="line-1656"></a><span class="hs-comment">-- Two important notes:</span><span>
</span><a name="line-1657"></a><span class="hs-comment">--      (i) No type families, unless we are under a ForAll</span><span>
</span><a name="line-1658"></a><span class="hs-comment">--      (ii) Note that xi types can contain unexpanded type synonyms;</span><span>
</span><a name="line-1659"></a><span class="hs-comment">--           however, the (transitive) expansions of those type synonyms</span><span>
</span><a name="line-1660"></a><span class="hs-comment">--           will not contain any type functions, unless we are under a ForAll.</span><span>
</span><a name="line-1661"></a><span class="hs-comment">-- We enforce the structure of Xi types when we flatten (TcCanonical)</span><span>
</span><a name="line-1662"></a><span>
</span><a name="line-1663"></a><span class="hs-keyword">type</span><span> </span><a name="Xi"><a href="TcRnTypes.html#Xi"><span class="hs-identifier">Xi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>       </span><span class="hs-comment">-- In many comments, &quot;xi&quot; ranges over Xi</span><span>
</span><a name="line-1664"></a><span>
</span><a name="line-1665"></a><span class="hs-keyword">type</span><span> </span><a name="Cts"><a href="TcRnTypes.html#Cts"><span class="hs-identifier">Cts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1666"></a><span>
</span><a name="line-1667"></a><span class="hs-keyword">data</span><span> </span><a name="Ct"><a href="TcRnTypes.html#Ct"><span class="hs-identifier">Ct</span></a></a><span>
</span><a name="line-1668"></a><span>  </span><span class="hs-comment">-- Atomic canonical constraints</span><span>
</span><a name="line-1669"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="CDictCan"><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier">CDictCan</span></a></a><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- e.g.  Num xi</span><span>
</span><a name="line-1670"></a><span>      </span><a name="cc_ev"><a href="TcRnTypes.html#cc_ev"><span class="hs-identifier">cc_ev</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- See Note [Ct/evidence invariant]</span><span>
</span><a name="line-1671"></a><span>
</span><a name="line-1672"></a><span>      </span><a name="cc_class"><a href="TcRnTypes.html#cc_class"><span class="hs-identifier">cc_class</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">,</span><span>
</span><a name="line-1673"></a><span>      </span><a name="cc_tyargs"><a href="TcRnTypes.html#cc_tyargs"><span class="hs-identifier">cc_tyargs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Xi"><span class="hs-identifier hs-type">Xi</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- cc_tyargs are function-free, hence Xi</span><span>
</span><a name="line-1674"></a><span>
</span><a name="line-1675"></a><span>      </span><a name="cc_pend_sc"><a href="TcRnTypes.html#cc_pend_sc"><span class="hs-identifier">cc_pend_sc</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>   </span><span class="hs-comment">-- See Note [The superclass story] in TcCanonical</span><span>
</span><a name="line-1676"></a><span>                           </span><span class="hs-comment">-- True &lt;=&gt; (a) cc_class has superclasses</span><span>
</span><a name="line-1677"></a><span>                           </span><span class="hs-comment">--          (b) we have not (yet) added those</span><span>
</span><a name="line-1678"></a><span>                           </span><span class="hs-comment">--              superclasses as Givens</span><span>
</span><a name="line-1679"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1680"></a><span>
</span><a name="line-1681"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CIrredCan"><a href="TcRnTypes.html#CIrredCan"><span class="hs-identifier">CIrredCan</span></a></a><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- These stand for yet-unusable predicates</span><span>
</span><a name="line-1682"></a><span>      </span><a name="cc_ev"><a href="TcRnTypes.html#cc_ev"><span class="hs-identifier">cc_ev</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- See Note [Ct/evidence invariant]</span><span>
</span><a name="line-1683"></a><span>      </span><a name="cc_insol"><a href="TcRnTypes.html#cc_insol"><span class="hs-identifier">cc_insol</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>   </span><span class="hs-comment">-- True  &lt;=&gt; definitely an error, can never be solved</span><span>
</span><a name="line-1684"></a><span>                         </span><span class="hs-comment">-- False &lt;=&gt; might be soluble</span><span>
</span><a name="line-1685"></a><span>
</span><a name="line-1686"></a><span>        </span><span class="hs-comment">-- For the might-be-soluble case, the ctev_pred of the evidence is</span><span>
</span><a name="line-1687"></a><span>        </span><span class="hs-comment">-- of form   (tv xi1 xi2 ... xin)   with a tyvar at the head</span><span>
</span><a name="line-1688"></a><span>        </span><span class="hs-comment">--      or   (tv1 ~ ty2)   where the CTyEqCan  kind invariant fails</span><span>
</span><a name="line-1689"></a><span>        </span><span class="hs-comment">--      or   (F tys ~ ty)  where the CFunEqCan kind invariant fails</span><span>
</span><a name="line-1690"></a><span>        </span><span class="hs-comment">-- See Note [CIrredCan constraints]</span><span>
</span><a name="line-1691"></a><span>
</span><a name="line-1692"></a><span>        </span><span class="hs-comment">-- The definitely-insoluble case is for things like</span><span>
</span><a name="line-1693"></a><span>        </span><span class="hs-comment">--    Int ~ Bool      tycons don't match</span><span>
</span><a name="line-1694"></a><span>        </span><span class="hs-comment">--    a ~ [a]         occurs check</span><span>
</span><a name="line-1695"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1696"></a><span>
</span><a name="line-1697"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CTyEqCan"><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier">CTyEqCan</span></a></a><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- tv ~ rhs</span><span>
</span><a name="line-1698"></a><span>       </span><span class="hs-comment">-- Invariants:</span><span>
</span><a name="line-1699"></a><span>       </span><span class="hs-comment">--   * See Note [Applying the inert substitution] in TcFlatten</span><span>
</span><a name="line-1700"></a><span>       </span><span class="hs-comment">--   * tv not in tvs(rhs)   (occurs check)</span><span>
</span><a name="line-1701"></a><span>       </span><span class="hs-comment">--   * If tv is a TauTv, then rhs has no foralls</span><span>
</span><a name="line-1702"></a><span>       </span><span class="hs-comment">--       (this avoids substituting a forall for the tyvar in other types)</span><span>
</span><a name="line-1703"></a><span>       </span><span class="hs-comment">--   * tcTypeKind ty `tcEqKind` tcTypeKind tv; Note [Ct kind invariant]</span><span>
</span><a name="line-1704"></a><span>       </span><span class="hs-comment">--   * rhs may have at most one top-level cast</span><span>
</span><a name="line-1705"></a><span>       </span><span class="hs-comment">--   * rhs (perhaps under the one cast) is not necessarily function-free,</span><span>
</span><a name="line-1706"></a><span>       </span><span class="hs-comment">--       but it has no top-level function.</span><span>
</span><a name="line-1707"></a><span>       </span><span class="hs-comment">--     E.g. a ~ [F b]  is fine</span><span>
</span><a name="line-1708"></a><span>       </span><span class="hs-comment">--     but  a ~ F b    is not</span><span>
</span><a name="line-1709"></a><span>       </span><span class="hs-comment">--   * If the equality is representational, rhs has no top-level newtype</span><span>
</span><a name="line-1710"></a><span>       </span><span class="hs-comment">--     See Note [No top-level newtypes on RHS of representational</span><span>
</span><a name="line-1711"></a><span>       </span><span class="hs-comment">--     equalities] in TcCanonical</span><span>
</span><a name="line-1712"></a><span>       </span><span class="hs-comment">--   * If rhs (perhaps under the cast) is also a tv, then it is oriented</span><span>
</span><a name="line-1713"></a><span>       </span><span class="hs-comment">--     to give best chance of</span><span>
</span><a name="line-1714"></a><span>       </span><span class="hs-comment">--     unification happening; eg if rhs is touchable then lhs is too</span><span>
</span><a name="line-1715"></a><span>      </span><a name="cc_ev"><a href="TcRnTypes.html#cc_ev"><span class="hs-identifier">cc_ev</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- See Note [Ct/evidence invariant]</span><span>
</span><a name="line-1716"></a><span>      </span><a name="cc_tyvar"><a href="TcRnTypes.html#cc_tyvar"><span class="hs-identifier">cc_tyvar</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-1717"></a><span>      </span><a name="cc_rhs"><a href="TcRnTypes.html#cc_rhs"><span class="hs-identifier">cc_rhs</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Not necessarily function-free (hence not Xi)</span><span>
</span><a name="line-1718"></a><span>                               </span><span class="hs-comment">-- See invariants above</span><span>
</span><a name="line-1719"></a><span>
</span><a name="line-1720"></a><span>      </span><a name="cc_eq_rel"><a href="TcRnTypes.html#cc_eq_rel"><span class="hs-identifier">cc_eq_rel</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span>       </span><span class="hs-comment">-- INVARIANT: cc_eq_rel = ctEvEqRel cc_ev</span><span>
</span><a name="line-1721"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1722"></a><span>
</span><a name="line-1723"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CFunEqCan"><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier">CFunEqCan</span></a></a><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- F xis ~ fsk</span><span>
</span><a name="line-1724"></a><span>       </span><span class="hs-comment">-- Invariants:</span><span>
</span><a name="line-1725"></a><span>       </span><span class="hs-comment">--   * isTypeFamilyTyCon cc_fun</span><span>
</span><a name="line-1726"></a><span>       </span><span class="hs-comment">--   * tcTypeKind (F xis) = tyVarKind fsk; Note [Ct kind invariant]</span><span>
</span><a name="line-1727"></a><span>       </span><span class="hs-comment">--   * always Nominal role</span><span>
</span><a name="line-1728"></a><span>      </span><a name="cc_ev"><a href="TcRnTypes.html#cc_ev"><span class="hs-identifier">cc_ev</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- See Note [Ct/evidence invariant]</span><span>
</span><a name="line-1729"></a><span>      </span><a name="cc_fun"><a href="TcRnTypes.html#cc_fun"><span class="hs-identifier">cc_fun</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- A type function</span><span>
</span><a name="line-1730"></a><span>
</span><a name="line-1731"></a><span>      </span><a name="cc_tyargs"><a href="TcRnTypes.html#cc_tyargs"><span class="hs-identifier">cc_tyargs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Xi"><span class="hs-identifier hs-type">Xi</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- cc_tyargs are function-free (hence Xi)</span><span>
</span><a name="line-1732"></a><span>        </span><span class="hs-comment">-- Either under-saturated or exactly saturated</span><span>
</span><a name="line-1733"></a><span>        </span><span class="hs-comment">--    *never* over-saturated (because if so</span><span>
</span><a name="line-1734"></a><span>        </span><span class="hs-comment">--    we should have decomposed)</span><span>
</span><a name="line-1735"></a><span>
</span><a name="line-1736"></a><span>      </span><a name="cc_fsk"><a href="TcRnTypes.html#cc_fsk"><span class="hs-identifier">cc_fsk</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span>  </span><span class="hs-comment">-- [G]  always a FlatSkolTv</span><span>
</span><a name="line-1737"></a><span>                            </span><span class="hs-comment">-- [W], [WD], or [D] always a FlatMetaTv</span><span>
</span><a name="line-1738"></a><span>        </span><span class="hs-comment">-- See Note [The flattening story] in TcFlatten</span><span>
</span><a name="line-1739"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1740"></a><span>
</span><a name="line-1741"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CNonCanonical"><a href="TcRnTypes.html#CNonCanonical"><span class="hs-identifier">CNonCanonical</span></a></a><span> </span><span class="hs-special">{</span><span>        </span><span class="hs-comment">-- See Note [NonCanonical Semantics] in TcSMonad</span><span>
</span><a name="line-1742"></a><span>      </span><a name="cc_ev"><a href="TcRnTypes.html#cc_ev"><span class="hs-identifier">cc_ev</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-1743"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1744"></a><span>
</span><a name="line-1745"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CHoleCan"><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier">CHoleCan</span></a></a><span> </span><span class="hs-special">{</span><span>             </span><span class="hs-comment">-- See Note [Hole constraints]</span><span>
</span><a name="line-1746"></a><span>       </span><span class="hs-comment">-- Treated as an &quot;insoluble&quot; constraint</span><span>
</span><a name="line-1747"></a><span>       </span><span class="hs-comment">-- See Note [Insoluble constraints]</span><span>
</span><a name="line-1748"></a><span>      </span><a name="cc_ev"><a href="TcRnTypes.html#cc_ev"><span class="hs-identifier">cc_ev</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">,</span><span>
</span><a name="line-1749"></a><span>      </span><a name="cc_hole"><a href="TcRnTypes.html#cc_hole"><span class="hs-identifier">cc_hole</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Hole"><span class="hs-identifier hs-type">Hole</span></a><span>
</span><a name="line-1750"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1751"></a><span>
</span><a name="line-1752"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CQuantCan"><a href="TcRnTypes.html#CQuantCan"><span class="hs-identifier">CQuantCan</span></a></a><span> </span><a href="TcRnTypes.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a><span>       </span><span class="hs-comment">-- A quantified constraint</span><span>
</span><a name="line-1753"></a><span>      </span><span class="hs-comment">-- NB: I expect to make more of the cases in Ct</span><span>
</span><a name="line-1754"></a><span>      </span><span class="hs-comment">--     look like this, with the payload in an</span><span>
</span><a name="line-1755"></a><span>      </span><span class="hs-comment">--     auxiliary type</span><span>
</span><a name="line-1756"></a><span>
</span><a name="line-1757"></a><span class="hs-comment">------------</span><span>
</span><a name="line-1758"></a><span class="hs-keyword">data</span><span> </span><a name="QCInst"><a href="TcRnTypes.html#QCInst"><span class="hs-identifier">QCInst</span></a></a><span>  </span><span class="hs-comment">-- A much simplified version of ClsInst</span><span>
</span><a name="line-1759"></a><span>             </span><span class="hs-comment">-- See Note [Quantified constraints] in TcCanonical</span><span>
</span><a name="line-1760"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="QCI"><a href="TcRnTypes.html#QCI"><span class="hs-identifier">QCI</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="qci_ev"><a href="TcRnTypes.html#qci_ev"><span class="hs-identifier">qci_ev</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-comment">-- Always of type forall tvs. context =&gt; ty</span><span>
</span><a name="line-1761"></a><span>                                 </span><span class="hs-comment">-- Always Given</span><span>
</span><a name="line-1762"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="qci_tvs"><a href="TcRnTypes.html#qci_tvs"><span class="hs-identifier">qci_tvs</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- The tvs</span><span>
</span><a name="line-1763"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="qci_pred"><a href="TcRnTypes.html#qci_pred"><span class="hs-identifier">qci_pred</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span> </span><span class="hs-comment">-- The ty</span><span>
</span><a name="line-1764"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="qci_pend_sc"><a href="TcRnTypes.html#qci_pend_sc"><span class="hs-identifier">qci_pend_sc</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>    </span><span class="hs-comment">-- Same as cc_pend_sc flag in CDictCan</span><span>
</span><a name="line-1765"></a><span>                                 </span><span class="hs-comment">-- Invariant: True =&gt; qci_pred is a ClassPred</span><span>
</span><a name="line-1766"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1767"></a><span>
</span><a name="line-1768"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1769"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#QCI"><span class="hs-identifier hs-var">QCI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qci_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145951"><a href="#local-6989586621684145951"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145951"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1770"></a><span>
</span><a name="line-1771"></a><span class="hs-comment">------------</span><span>
</span><a name="line-1772"></a><span class="hs-comment">-- | An expression or type hole</span><span>
</span><a name="line-1773"></a><span class="hs-keyword">data</span><span> </span><a name="Hole"><a href="TcRnTypes.html#Hole"><span class="hs-identifier">Hole</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ExprHole"><a href="TcRnTypes.html#ExprHole"><span class="hs-identifier">ExprHole</span></a></a><span> </span><a href="HsExpr.html#UnboundVar"><span class="hs-identifier hs-type">UnboundVar</span></a><span>
</span><a name="line-1774"></a><span>            </span><span class="hs-comment">-- ^ Either an out-of-scope variable or a &quot;true&quot; hole in an</span><span>
</span><a name="line-1775"></a><span>            </span><span class="hs-comment">-- expression (TypedHoles)</span><span>
</span><a name="line-1776"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a name="TypeHole"><a href="TcRnTypes.html#TypeHole"><span class="hs-identifier">TypeHole</span></a></a><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-1777"></a><span>            </span><span class="hs-comment">-- ^ A hole in a type (PartialTypeSignatures)</span><span>
</span><a name="line-1778"></a><span>
</span><a name="line-1779"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#Hole"><span class="hs-identifier hs-type">Hole</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1780"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ExprHole"><span class="hs-identifier hs-var">ExprHole</span></a><span> </span><a name="local-6989586621684145949"><a href="#local-6989586621684145949"><span class="hs-identifier">ub</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145949"><span class="hs-identifier hs-var">ub</span></a><span>
</span><a name="line-1781"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TypeHole"><span class="hs-identifier hs-var">TypeHole</span></a><span> </span><a name="local-6989586621684145950"><a href="#local-6989586621684145950"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;TypeHole&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145950"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-1782"></a><span>
</span><a name="line-1783"></a><span class="hs-identifier">holeOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Hole"><span class="hs-identifier hs-type">Hole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-1784"></a><a name="holeOcc"><a href="TcRnTypes.html#holeOcc"><span class="hs-identifier">holeOcc</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ExprHole"><span class="hs-identifier hs-var">ExprHole</span></a><span> </span><a name="local-6989586621684146030"><a href="#local-6989586621684146030"><span class="hs-identifier">uv</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HsExpr.html#unboundVarOcc"><span class="hs-identifier hs-var">unboundVarOcc</span></a><span> </span><a href="#local-6989586621684146030"><span class="hs-identifier hs-var">uv</span></a><span>
</span><a name="line-1785"></a><span class="hs-identifier">holeOcc</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TypeHole"><span class="hs-identifier hs-var">TypeHole</span></a><span> </span><a name="local-6989586621684146031"><a href="#local-6989586621684146031"><span class="hs-identifier">occ</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146031"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-1786"></a><span>
</span><a name="line-1787"></a><span class="hs-comment">{- Note [Hole constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~
CHoleCan constraints are used for two kinds of holes,
distinguished by cc_hole:

  * For holes in expressions (including variables not in scope)
    e.g.   f x = g _ x

  * For holes in type signatures
    e.g.   f :: _ -&gt; _
           f x = [x,True]

Note [CIrredCan constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
CIrredCan constraints are used for constraints that are &quot;stuck&quot;
   - we can't solve them (yet)
   - we can't use them to solve other constraints
   - but they may become soluble if we substitute for some
     of the type variables in the constraint

Example 1:  (c Int), where c :: * -&gt; Constraint.  We can't do anything
            with this yet, but if later c := Num, *then* we can solve it

Example 2:  a ~ b, where a :: *, b :: k, where k is a kind variable
            We don't want to use this to substitute 'b' for 'a', in case
            'k' is subsequently unifed with (say) *-&gt;*, because then
            we'd have ill-kinded types floating about.  Rather we want
            to defer using the equality altogether until 'k' get resolved.

Note [Ct/evidence invariant]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If  ct :: Ct, then extra fields of 'ct' cache precisely the ctev_pred field
of (cc_ev ct), and is fully rewritten wrt the substitution.   Eg for CDictCan,
   ctev_pred (cc_ev ct) = (cc_class ct) (cc_tyargs ct)
This holds by construction; look at the unique place where CDictCan is
built (in TcCanonical).

In contrast, the type of the evidence *term* (ctev_dest / ctev_evar) in
the evidence may *not* be fully zonked; we are careful not to look at it
during constraint solving. See Note [Evidence field of CtEvidence].

Note [Ct kind invariant]
~~~~~~~~~~~~~~~~~~~~~~~~
CTyEqCan and CFunEqCan both require that the kind of the lhs matches the kind
of the rhs. This is necessary because both constraints are used for substitutions
during solving. If the kinds differed, then the substitution would take a well-kinded
type to an ill-kinded one.

-}</span><span>
</span><a name="line-1836"></a><span>
</span><a name="line-1837"></a><span class="hs-identifier">mkNonCanonical</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1838"></a><a name="mkNonCanonical"><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier">mkNonCanonical</span></a></a><span> </span><a name="local-6989586621684146032"><a href="#local-6989586621684146032"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CNonCanonical"><span class="hs-identifier hs-var">CNonCanonical</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146032"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1839"></a><span>
</span><a name="line-1840"></a><span class="hs-identifier">mkNonCanonicalCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1841"></a><a name="mkNonCanonicalCt"><a href="TcRnTypes.html#mkNonCanonicalCt"><span class="hs-identifier">mkNonCanonicalCt</span></a></a><span> </span><a name="local-6989586621684146033"><a href="#local-6989586621684146033"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CNonCanonical"><span class="hs-identifier hs-var">CNonCanonical</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><a href="#local-6989586621684146033"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1842"></a><span>
</span><a name="line-1843"></a><span class="hs-identifier">mkIrredCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1844"></a><a name="mkIrredCt"><a href="TcRnTypes.html#mkIrredCt"><span class="hs-identifier">mkIrredCt</span></a></a><span> </span><a name="local-6989586621684146034"><a href="#local-6989586621684146034"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146034"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_insol</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1845"></a><span>
</span><a name="line-1846"></a><span class="hs-identifier">mkInsolubleCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1847"></a><a name="mkInsolubleCt"><a href="TcRnTypes.html#mkInsolubleCt"><span class="hs-identifier">mkInsolubleCt</span></a></a><span> </span><a name="local-6989586621684146035"><a href="#local-6989586621684146035"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146035"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_insol</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1848"></a><span>
</span><a name="line-1849"></a><span class="hs-identifier">mkGivens</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#EvId"><span class="hs-identifier hs-type">EvId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>
</span><a name="line-1850"></a><a name="mkGivens"><a href="TcRnTypes.html#mkGivens"><span class="hs-identifier">mkGivens</span></a></a><span> </span><a name="local-6989586621684146036"><a href="#local-6989586621684146036"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621684146037"><a href="#local-6989586621684146037"><span class="hs-identifier">ev_ids</span></a></a><span>
</span><a name="line-1851"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621684146038"><span class="hs-identifier hs-var">mk</span></a><span> </span><a href="#local-6989586621684146037"><span class="hs-identifier hs-var">ev_ids</span></a><span>
</span><a name="line-1852"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1853"></a><span>    </span><a name="local-6989586621684146038"><a href="#local-6989586621684146038"><span class="hs-identifier">mk</span></a></a><span> </span><a name="local-6989586621684146039"><a href="#local-6989586621684146039"><span class="hs-identifier">ev_id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_evar</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146039"><span class="hs-identifier hs-var">ev_id</span></a><span>
</span><a name="line-1854"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_pred</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#evVarPred"><span class="hs-identifier hs-var">evVarPred</span></a><span> </span><a href="#local-6989586621684146039"><span class="hs-identifier hs-var">ev_id</span></a><span>
</span><a name="line-1855"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146036"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1856"></a><span>
</span><a name="line-1857"></a><span class="hs-identifier">ctEvidence</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-1858"></a><a name="ctEvidence"><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier">ctEvidence</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CQuantCan"><span class="hs-identifier hs-var">CQuantCan</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#QCI"><span class="hs-identifier hs-var">QCI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qci_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146040"><a href="#local-6989586621684146040"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146040"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1859"></a><span class="hs-identifier">ctEvidence</span><span> </span><a name="local-6989586621684146041"><a href="#local-6989586621684146041"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><a href="#local-6989586621684146041"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-1860"></a><span>
</span><a name="line-1861"></a><span class="hs-identifier">ctLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-1862"></a><a name="ctLoc"><a href="TcRnTypes.html#ctLoc"><span class="hs-identifier">ctLoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span>
</span><a name="line-1863"></a><span>
</span><a name="line-1864"></a><span class="hs-identifier">setCtLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-1865"></a><a name="setCtLoc"><a href="TcRnTypes.html#setCtLoc"><span class="hs-identifier">setCtLoc</span></a></a><span> </span><a name="local-6989586621684146042"><a href="#local-6989586621684146042"><span class="hs-identifier">ct</span></a></a><span> </span><a name="local-6989586621684146043"><a href="#local-6989586621684146043"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146042"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cc_ev</span><span> </span><a href="#local-6989586621684146042"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146043"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1866"></a><span>
</span><a name="line-1867"></a><span class="hs-identifier">ctOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-1868"></a><a name="ctOrigin"><a href="TcRnTypes.html#ctOrigin"><span class="hs-identifier">ctOrigin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#ctLoc"><span class="hs-identifier hs-var">ctLoc</span></a><span>
</span><a name="line-1869"></a><span>
</span><a name="line-1870"></a><span class="hs-identifier">ctPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span>
</span><a name="line-1871"></a><span class="hs-comment">-- See Note [Ct/evidence invariant]</span><span>
</span><a name="line-1872"></a><a name="ctPred"><a href="TcRnTypes.html#ctPred"><span class="hs-identifier">ctPred</span></a></a><span> </span><a name="local-6989586621684146044"><a href="#local-6989586621684146044"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-6989586621684146044"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1873"></a><span>
</span><a name="line-1874"></a><span class="hs-identifier">ctEvId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>
</span><a name="line-1875"></a><span class="hs-comment">-- The evidence Id for this Ct</span><span>
</span><a name="line-1876"></a><a name="ctEvId"><a href="TcRnTypes.html#ctEvId"><span class="hs-identifier">ctEvId</span></a></a><span> </span><a name="local-6989586621684146045"><a href="#local-6989586621684146045"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvEvId"><span class="hs-identifier hs-var">ctEvEvId</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-6989586621684146045"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1877"></a><span>
</span><a name="line-1878"></a><span class="hs-comment">-- | Makes a new equality predicate with the same role as the given</span><span>
</span><a name="line-1879"></a><span class="hs-comment">-- evidence.</span><span>
</span><a name="line-1880"></a><span class="hs-identifier">mkTcEqPredLikeEv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-1881"></a><a name="mkTcEqPredLikeEv"><a href="TcRnTypes.html#mkTcEqPredLikeEv"><span class="hs-identifier">mkTcEqPredLikeEv</span></a></a><span> </span><a name="local-6989586621684146046"><a href="#local-6989586621684146046"><span class="hs-identifier">ev</span></a></a><span>
</span><a name="line-1882"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#predTypeEqRel"><span class="hs-identifier hs-var">predTypeEqRel</span></a><span> </span><a href="#local-6989586621684146047"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1883"></a><span>      </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#mkPrimEqPred"><span class="hs-identifier hs-var">mkPrimEqPred</span></a><span>
</span><a name="line-1884"></a><span>      </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#mkReprPrimEqPred"><span class="hs-identifier hs-var">mkReprPrimEqPred</span></a><span>
</span><a name="line-1885"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1886"></a><span>    </span><a name="local-6989586621684146047"><a href="#local-6989586621684146047"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span> </span><a href="#local-6989586621684146046"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1887"></a><span>
</span><a name="line-1888"></a><span class="hs-comment">-- | Get the flavour of the given 'Ct'</span><span>
</span><a name="line-1889"></a><span class="hs-identifier">ctFlavour</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span>
</span><a name="line-1890"></a><a name="ctFlavour"><a href="TcRnTypes.html#ctFlavour"><span class="hs-identifier">ctFlavour</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span>
</span><a name="line-1891"></a><span>
</span><a name="line-1892"></a><span class="hs-comment">-- | Get the equality relation for the given 'Ct'</span><span>
</span><a name="line-1893"></a><span class="hs-identifier">ctEqRel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span>
</span><a name="line-1894"></a><a name="ctEqRel"><a href="TcRnTypes.html#ctEqRel"><span class="hs-identifier">ctEqRel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvEqRel"><span class="hs-identifier hs-var">ctEvEqRel</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span>
</span><a name="line-1895"></a><span>
</span><a name="line-1896"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1897"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621684145943"><a href="#local-6989586621684145943"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-6989586621684145943"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><a href="#local-6989586621684145944"><span class="hs-identifier hs-var">pp_sort</span></a><span>
</span><a name="line-1898"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1899"></a><span>      </span><a name="local-6989586621684145944"><a href="#local-6989586621684145944"><span class="hs-identifier">pp_sort</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684145943"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1900"></a><span>         </span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CTyEqCan&quot;</span><span>
</span><a name="line-1901"></a><span>         </span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CFunEqCan&quot;</span><span>
</span><a name="line-1902"></a><span>         </span><a href="TcRnTypes.html#CNonCanonical"><span class="hs-identifier hs-var">CNonCanonical</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CNonCanonical&quot;</span><span>
</span><a name="line-1903"></a><span>         </span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_pend_sc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145945"><a href="#local-6989586621684145945"><span class="hs-identifier">pend_sc</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1904"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684145945"><span class="hs-identifier hs-var">pend_sc</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CDictCan(psc)&quot;</span><span>
</span><a name="line-1905"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CDictCan&quot;</span><span>
</span><a name="line-1906"></a><span>         </span><a href="TcRnTypes.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_insol</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145946"><a href="#local-6989586621684145946"><span class="hs-identifier">insol</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1907"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684145946"><span class="hs-identifier hs-var">insol</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CIrredCan(insol)&quot;</span><span>
</span><a name="line-1908"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CIrredCan(sol)&quot;</span><span>
</span><a name="line-1909"></a><span>         </span><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier hs-var">CHoleCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_hole</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145947"><a href="#local-6989586621684145947"><span class="hs-identifier">hole</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CHoleCan:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145947"><span class="hs-identifier hs-var">hole</span></a><span>
</span><a name="line-1910"></a><span>         </span><a href="TcRnTypes.html#CQuantCan"><span class="hs-identifier hs-var">CQuantCan</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#QCI"><span class="hs-identifier hs-var">QCI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qci_pend_sc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145948"><a href="#local-6989586621684145948"><span class="hs-identifier">pend_sc</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1911"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684145948"><span class="hs-identifier hs-var">pend_sc</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CQuantCan(psc)&quot;</span><span>
</span><a name="line-1912"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CQuantCan&quot;</span><span>
</span><a name="line-1913"></a><span>
</span><a name="line-1914"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Simple functions over evidence variables
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1921"></a><span>
</span><a name="line-1922"></a><span class="hs-comment">---------------- Getting free tyvars -------------------------</span><span>
</span><a name="line-1923"></a><span>
</span><a name="line-1924"></a><span class="hs-comment">-- | Returns free variables of constraints as a non-deterministic set</span><span>
</span><a name="line-1925"></a><span class="hs-identifier">tyCoVarsOfCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a><span>
</span><a name="line-1926"></a><a name="tyCoVarsOfCt"><a href="TcRnTypes.html#tyCoVarsOfCt"><span class="hs-identifier">tyCoVarsOfCt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvVarSet"><span class="hs-identifier hs-var">fvVarSet</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#tyCoFVsOfCt"><span class="hs-identifier hs-var">tyCoFVsOfCt</span></a><span>
</span><a name="line-1927"></a><span>
</span><a name="line-1928"></a><span class="hs-comment">-- | Returns free variables of constraints as a deterministically ordered.</span><span>
</span><a name="line-1929"></a><span class="hs-comment">-- list. See Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1930"></a><span class="hs-identifier">tyCoVarsOfCtList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-1931"></a><a name="tyCoVarsOfCtList"><a href="TcRnTypes.html#tyCoVarsOfCtList"><span class="hs-identifier">tyCoVarsOfCtList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvVarList"><span class="hs-identifier hs-var">fvVarList</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#tyCoFVsOfCt"><span class="hs-identifier hs-var">tyCoFVsOfCt</span></a><span>
</span><a name="line-1932"></a><span>
</span><a name="line-1933"></a><span class="hs-comment">-- | Returns free variables of constraints as a composable FV computation.</span><span>
</span><a name="line-1934"></a><span class="hs-comment">-- See Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1935"></a><span class="hs-identifier">tyCoFVsOfCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FV.html#FV"><span class="hs-identifier hs-type">FV</span></a><span>
</span><a name="line-1936"></a><a name="tyCoFVsOfCt"><a href="TcRnTypes.html#tyCoFVsOfCt"><span class="hs-identifier">tyCoFVsOfCt</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146048"><a href="#local-6989586621684146048"><span class="hs-identifier">tv</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146049"><a href="#local-6989586621684146049"><span class="hs-identifier">xi</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1937"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoFVsOfType"><span class="hs-identifier hs-var">tyCoFVsOfType</span></a><span> </span><a href="#local-6989586621684146049"><span class="hs-identifier hs-var">xi</span></a><span> </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><a href="FV.html#unitFV"><span class="hs-identifier hs-var">FV.unitFV</span></a><span> </span><a href="#local-6989586621684146048"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1938"></a><span>                     </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoFVsOfType"><span class="hs-identifier hs-var">tyCoFVsOfType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621684146048"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1939"></a><span class="hs-identifier">tyCoFVsOfCt</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146050"><a href="#local-6989586621684146050"><span class="hs-identifier">tys</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_fsk</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146051"><a href="#local-6989586621684146051"><span class="hs-identifier">fsk</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1940"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoFVsOfTypes"><span class="hs-identifier hs-var">tyCoFVsOfTypes</span></a><span> </span><a href="#local-6989586621684146050"><span class="hs-identifier hs-var">tys</span></a><span> </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><a href="FV.html#unitFV"><span class="hs-identifier hs-var">FV.unitFV</span></a><span> </span><a href="#local-6989586621684146051"><span class="hs-identifier hs-var">fsk</span></a><span>
</span><a name="line-1941"></a><span>                       </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#tyCoFVsOfType"><span class="hs-identifier hs-var">tyCoFVsOfType</span></a><span> </span><span class="hs-special">(</span><a href="Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a><span> </span><a href="#local-6989586621684146051"><span class="hs-identifier hs-var">fsk</span></a><span class="hs-special">)</span><span>
</span><a name="line-1942"></a><span class="hs-identifier">tyCoFVsOfCt</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146052"><a href="#local-6989586621684146052"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoFVsOfTypes"><span class="hs-identifier hs-var">tyCoFVsOfTypes</span></a><span> </span><a href="#local-6989586621684146052"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1943"></a><span class="hs-identifier">tyCoFVsOfCt</span><span> </span><a name="local-6989586621684146053"><a href="#local-6989586621684146053"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoFVsOfType"><span class="hs-identifier hs-var">tyCoFVsOfType</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a><span> </span><a href="#local-6989586621684146053"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-1944"></a><span>
</span><a name="line-1945"></a><span class="hs-comment">-- | Returns free variables of a bag of constraints as a non-deterministic</span><span>
</span><a name="line-1946"></a><span class="hs-comment">-- set. See Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1947"></a><span class="hs-identifier">tyCoVarsOfCts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcTyCoVarSet"><span class="hs-identifier hs-type">TcTyCoVarSet</span></a><span>
</span><a name="line-1948"></a><a name="tyCoVarsOfCts"><a href="TcRnTypes.html#tyCoVarsOfCts"><span class="hs-identifier">tyCoVarsOfCts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvVarSet"><span class="hs-identifier hs-var">fvVarSet</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#tyCoFVsOfCts"><span class="hs-identifier hs-var">tyCoFVsOfCts</span></a><span>
</span><a name="line-1949"></a><span>
</span><a name="line-1950"></a><span class="hs-comment">-- | Returns free variables of a bag of constraints as a deterministically</span><span>
</span><a name="line-1951"></a><span class="hs-comment">-- odered list. See Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1952"></a><span class="hs-identifier">tyCoVarsOfCtsList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcType.html#TcTyCoVar"><span class="hs-identifier hs-type">TcTyCoVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-1953"></a><a name="tyCoVarsOfCtsList"><a href="TcRnTypes.html#tyCoVarsOfCtsList"><span class="hs-identifier">tyCoVarsOfCtsList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvVarList"><span class="hs-identifier hs-var">fvVarList</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#tyCoFVsOfCts"><span class="hs-identifier hs-var">tyCoFVsOfCts</span></a><span>
</span><a name="line-1954"></a><span>
</span><a name="line-1955"></a><span class="hs-comment">-- | Returns free variables of a bag of constraints as a composable FV</span><span>
</span><a name="line-1956"></a><span class="hs-comment">-- computation. See Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1957"></a><span class="hs-identifier">tyCoFVsOfCts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FV.html#FV"><span class="hs-identifier hs-type">FV</span></a><span>
</span><a name="line-1958"></a><a name="tyCoFVsOfCts"><a href="TcRnTypes.html#tyCoFVsOfCts"><span class="hs-identifier">tyCoFVsOfCts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#foldrBag"><span class="hs-identifier hs-var">foldrBag</span></a><span> </span><span class="hs-special">(</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#tyCoFVsOfCt"><span class="hs-identifier hs-var">tyCoFVsOfCt</span></a><span class="hs-special">)</span><span> </span><a href="FV.html#emptyFV"><span class="hs-identifier hs-var">emptyFV</span></a><span>
</span><a name="line-1959"></a><span>
</span><a name="line-1960"></a><span class="hs-comment">-- | Returns free variables of WantedConstraints as a non-deterministic</span><span>
</span><a name="line-1961"></a><span class="hs-comment">-- set. See Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1962"></a><span class="hs-identifier">tyCoVarsOfWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span>
</span><a name="line-1963"></a><span class="hs-comment">-- Only called on *zonked* things, hence no need to worry about flatten-skolems</span><span>
</span><a name="line-1964"></a><a name="tyCoVarsOfWC"><a href="TcRnTypes.html#tyCoVarsOfWC"><span class="hs-identifier">tyCoVarsOfWC</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvVarSet"><span class="hs-identifier hs-var">fvVarSet</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#tyCoFVsOfWC"><span class="hs-identifier hs-var">tyCoFVsOfWC</span></a><span>
</span><a name="line-1965"></a><span>
</span><a name="line-1966"></a><span class="hs-comment">-- | Returns free variables of WantedConstraints as a deterministically</span><span>
</span><a name="line-1967"></a><span class="hs-comment">-- ordered list. See Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1968"></a><span class="hs-identifier">tyCoVarsOfWCList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyCoVar"><span class="hs-identifier hs-type">TyCoVar</span></a><span class="hs-special">]</span><span>
</span><a name="line-1969"></a><span class="hs-comment">-- Only called on *zonked* things, hence no need to worry about flatten-skolems</span><span>
</span><a name="line-1970"></a><a name="tyCoVarsOfWCList"><a href="TcRnTypes.html#tyCoVarsOfWCList"><span class="hs-identifier">tyCoVarsOfWCList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvVarList"><span class="hs-identifier hs-var">fvVarList</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#tyCoFVsOfWC"><span class="hs-identifier hs-var">tyCoFVsOfWC</span></a><span>
</span><a name="line-1971"></a><span>
</span><a name="line-1972"></a><span class="hs-comment">-- | Returns free variables of WantedConstraints as a composable FV</span><span>
</span><a name="line-1973"></a><span class="hs-comment">-- computation. See Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1974"></a><span class="hs-identifier">tyCoFVsOfWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FV.html#FV"><span class="hs-identifier hs-type">FV</span></a><span>
</span><a name="line-1975"></a><span class="hs-comment">-- Only called on *zonked* things, hence no need to worry about flatten-skolems</span><span>
</span><a name="line-1976"></a><a name="tyCoFVsOfWC"><a href="TcRnTypes.html#tyCoFVsOfWC"><span class="hs-identifier">tyCoFVsOfWC</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146054"><a href="#local-6989586621684146054"><span class="hs-identifier">simple</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146055"><a href="#local-6989586621684146055"><span class="hs-identifier">implic</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1977"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#tyCoFVsOfCts"><span class="hs-identifier hs-var">tyCoFVsOfCts</span></a><span> </span><a href="#local-6989586621684146054"><span class="hs-identifier hs-var">simple</span></a><span> </span><span class="hs-special">`</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span class="hs-special">`</span><span>
</span><a name="line-1978"></a><span>    </span><a href="TcRnTypes.html#tyCoFVsOfBag"><span class="hs-identifier hs-var">tyCoFVsOfBag</span></a><span> </span><a href="TcRnTypes.html#tyCoFVsOfImplic"><span class="hs-identifier hs-var">tyCoFVsOfImplic</span></a><span> </span><a href="#local-6989586621684146055"><span class="hs-identifier hs-var">implic</span></a><span>
</span><a name="line-1979"></a><span>
</span><a name="line-1980"></a><span class="hs-comment">-- | Returns free variables of Implication as a composable FV computation.</span><span>
</span><a name="line-1981"></a><span class="hs-comment">-- See Note [Deterministic FV] in FV.</span><span>
</span><a name="line-1982"></a><span class="hs-identifier">tyCoFVsOfImplic</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FV.html#FV"><span class="hs-identifier hs-type">FV</span></a><span>
</span><a name="line-1983"></a><span class="hs-comment">-- Only called on *zonked* things, hence no need to worry about flatten-skolems</span><span>
</span><a name="line-1984"></a><a name="tyCoFVsOfImplic"><a href="TcRnTypes.html#tyCoFVsOfImplic"><span class="hs-identifier">tyCoFVsOfImplic</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Implic"><span class="hs-identifier hs-var">Implic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_skols</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146056"><a href="#local-6989586621684146056"><span class="hs-identifier">skols</span></a></a><span>
</span><a name="line-1985"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_given</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146057"><a href="#local-6989586621684146057"><span class="hs-identifier">givens</span></a></a><span>
</span><a name="line-1986"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_wanted</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146058"><a href="#local-6989586621684146058"><span class="hs-identifier">wanted</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1987"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#isEmptyWC"><span class="hs-identifier hs-var">isEmptyWC</span></a><span> </span><a href="#local-6989586621684146058"><span class="hs-identifier hs-var">wanted</span></a><span>
</span><a name="line-1988"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#emptyFV"><span class="hs-identifier hs-var">emptyFV</span></a><span>
</span><a name="line-1989"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1990"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoFVsVarBndrs"><span class="hs-identifier hs-var">tyCoFVsVarBndrs</span></a><span> </span><a href="#local-6989586621684146056"><span class="hs-identifier hs-var">skols</span></a><span>  </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1991"></a><span>    </span><a href="TyCoRep.html#tyCoFVsVarBndrs"><span class="hs-identifier hs-var">tyCoFVsVarBndrs</span></a><span> </span><a href="#local-6989586621684146057"><span class="hs-identifier hs-var">givens</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1992"></a><span>    </span><a href="TcRnTypes.html#tyCoFVsOfWC"><span class="hs-identifier hs-var">tyCoFVsOfWC</span></a><span> </span><a href="#local-6989586621684146058"><span class="hs-identifier hs-var">wanted</span></a><span>
</span><a name="line-1993"></a><span>
</span><a name="line-1994"></a><span class="hs-identifier">tyCoFVsOfBag</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684145992"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FV.html#FV"><span class="hs-identifier hs-type">FV</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="#local-6989586621684145992"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FV.html#FV"><span class="hs-identifier hs-type">FV</span></a><span>
</span><a name="line-1995"></a><a name="tyCoFVsOfBag"><a href="TcRnTypes.html#tyCoFVsOfBag"><span class="hs-identifier">tyCoFVsOfBag</span></a></a><span> </span><a name="local-6989586621684146059"><a href="#local-6989586621684146059"><span class="hs-identifier">tvs_of</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#foldrBag"><span class="hs-identifier hs-var">foldrBag</span></a><span> </span><span class="hs-special">(</span><a href="FV.html#unionFV"><span class="hs-identifier hs-var">unionFV</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621684146059"><span class="hs-identifier hs-var">tvs_of</span></a><span class="hs-special">)</span><span> </span><a href="FV.html#emptyFV"><span class="hs-identifier hs-var">emptyFV</span></a><span>
</span><a name="line-1996"></a><span>
</span><a name="line-1997"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1998"></a><span class="hs-identifier">dropDerivedWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-1999"></a><span class="hs-comment">-- See Note [Dropping derived constraints]</span><span>
</span><a name="line-2000"></a><a name="dropDerivedWC"><a href="TcRnTypes.html#dropDerivedWC"><span class="hs-identifier">dropDerivedWC</span></a></a><span> </span><a name="local-6989586621684146060"><a href="#local-6989586621684146060"><span class="hs-identifier">wc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146061"><a href="#local-6989586621684146061"><span class="hs-identifier">simples</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2001"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146060"><span class="hs-identifier hs-var">wc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#dropDerivedSimples"><span class="hs-identifier hs-var">dropDerivedSimples</span></a><span> </span><a href="#local-6989586621684146061"><span class="hs-identifier hs-var">simples</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2002"></a><span>    </span><span class="hs-comment">-- The wc_impl implications are already (recursively) filtered</span><span>
</span><a name="line-2003"></a><span>
</span><a name="line-2004"></a><span class="hs-comment">--------------------------</span><span>
</span><a name="line-2005"></a><span class="hs-identifier">dropDerivedSimples</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-2006"></a><span class="hs-comment">-- Drop all Derived constraints, but make [W] back into [WD],</span><span>
</span><a name="line-2007"></a><span class="hs-comment">-- so that if we re-simplify these constraints we will get all</span><span>
</span><a name="line-2008"></a><span class="hs-comment">-- the right derived constraints re-generated.  Forgetting this</span><span>
</span><a name="line-2009"></a><span class="hs-comment">-- step led to #12936</span><span>
</span><a name="line-2010"></a><a name="dropDerivedSimples"><a href="TcRnTypes.html#dropDerivedSimples"><span class="hs-identifier">dropDerivedSimples</span></a></a><span> </span><a name="local-6989586621684146062"><a href="#local-6989586621684146062"><span class="hs-identifier">simples</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#mapMaybeBag"><span class="hs-identifier hs-var">mapMaybeBag</span></a><span> </span><a href="TcRnTypes.html#dropDerivedCt"><span class="hs-identifier hs-var">dropDerivedCt</span></a><span> </span><a href="#local-6989586621684146062"><span class="hs-identifier hs-var">simples</span></a><span>
</span><a name="line-2011"></a><span>
</span><a name="line-2012"></a><span class="hs-identifier">dropDerivedCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-2013"></a><a name="dropDerivedCt"><a href="TcRnTypes.html#dropDerivedCt"><span class="hs-identifier">dropDerivedCt</span></a></a><span> </span><a name="local-6989586621684146063"><a href="#local-6989586621684146063"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-2014"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><a href="#local-6989586621684146064"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2015"></a><span>      </span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WOnly"><span class="hs-identifier hs-var">WOnly</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146066"><span class="hs-identifier hs-var">ct'</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146065"><span class="hs-identifier hs-var">ev_wd</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2016"></a><span>      </span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684146066"><span class="hs-identifier hs-var">ct'</span></a><span>
</span><a name="line-2017"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#isDroppableCt"><span class="hs-identifier hs-var">isDroppableCt</span></a><span> </span><a href="#local-6989586621684146063"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2018"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684146063"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-2019"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2020"></a><span>    </span><a name="local-6989586621684146064"><a href="#local-6989586621684146064"><span class="hs-identifier">ev</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-6989586621684146063"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-2021"></a><span>    </span><a name="local-6989586621684146065"><a href="#local-6989586621684146065"><span class="hs-identifier">ev_wd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146064"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_nosh</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2022"></a><span>    </span><a name="local-6989586621684146066"><a href="#local-6989586621684146066"><span class="hs-identifier">ct'</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#setPendingScDict"><span class="hs-identifier hs-var">setPendingScDict</span></a><span> </span><a href="#local-6989586621684146063"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-comment">-- See Note [Resetting cc_pend_sc]</span><span>
</span><a name="line-2023"></a><span>
</span><a name="line-2024"></a><span class="hs-comment">{- Note [Resetting cc_pend_sc]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
When we discard Derived constraints, in dropDerivedSimples, we must
set the cc_pend_sc flag to True, so that if we re-process this
CDictCan we will re-generate its derived superclasses. Otherwise
we might miss some fundeps.  Trac #13662 showed this up.

See Note [The superclass story] in TcCanonical.
-}</span><span>
</span><a name="line-2033"></a><span>
</span><a name="line-2034"></a><span class="hs-identifier">isDroppableCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2035"></a><a name="isDroppableCt"><a href="TcRnTypes.html#isDroppableCt"><span class="hs-identifier">isDroppableCt</span></a></a><span> </span><a name="local-6989586621684146067"><a href="#local-6989586621684146067"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-2036"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isDerived"><span class="hs-identifier hs-var">isDerived</span></a><span> </span><a href="#local-6989586621684146068"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684146071"><span class="hs-identifier hs-var">keep_deriv</span></a><span>
</span><a name="line-2037"></a><span>    </span><span class="hs-comment">-- Drop only derived constraints, and then only if they</span><span>
</span><a name="line-2038"></a><span>    </span><span class="hs-comment">-- obey Note [Dropping derived constraints]</span><span>
</span><a name="line-2039"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2040"></a><span>    </span><a name="local-6989586621684146068"><a href="#local-6989586621684146068"><span class="hs-identifier">ev</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-6989586621684146067"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-2041"></a><span>    </span><a name="local-6989586621684146069"><a href="#local-6989586621684146069"><span class="hs-identifier">loc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a><span> </span><a href="#local-6989586621684146068"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-2042"></a><span>    </span><a name="local-6989586621684146070"><a href="#local-6989586621684146070"><span class="hs-identifier">orig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a><span> </span><a href="#local-6989586621684146069"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-2043"></a><span>
</span><a name="line-2044"></a><span>    </span><a name="local-6989586621684146071"><a href="#local-6989586621684146071"><span class="hs-identifier">keep_deriv</span></a></a><span>
</span><a name="line-2045"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684146067"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2046"></a><span>          </span><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier hs-var">CHoleCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2047"></a><span>          </span><a href="TcRnTypes.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_insol</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146073"><a href="#local-6989586621684146073"><span class="hs-identifier">insoluble</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2048"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684146072"><span class="hs-identifier hs-var">keep_eq</span></a><span> </span><a href="#local-6989586621684146073"><span class="hs-identifier hs-var">insoluble</span></a><span>
</span><a name="line-2049"></a><span>          </span><span class="hs-identifier">_</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684146072"><span class="hs-identifier hs-var">keep_eq</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2050"></a><span>
</span><a name="line-2051"></a><span>    </span><a name="local-6989586621684146072"><a href="#local-6989586621684146072"><span class="hs-identifier">keep_eq</span></a></a><span> </span><a name="local-6989586621684146074"><a href="#local-6989586621684146074"><span class="hs-identifier">definitely_insoluble</span></a></a><span>
</span><a name="line-2052"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#isGivenOrigin"><span class="hs-identifier hs-var">isGivenOrigin</span></a><span> </span><a href="#local-6989586621684146070"><span class="hs-identifier hs-var">orig</span></a><span>    </span><span class="hs-comment">-- Arising only from givens</span><span>
</span><a name="line-2053"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146074"><span class="hs-identifier hs-var">definitely_insoluble</span></a><span>  </span><span class="hs-comment">-- Keep only definitely insoluble</span><span>
</span><a name="line-2054"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2055"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684146070"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2056"></a><span>           </span><a href="TcRnTypes.html#KindEqOrigin"><span class="hs-identifier hs-var">KindEqOrigin</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>    </span><span class="hs-comment">-- See Note [Dropping derived constraints]</span><span>
</span><a name="line-2057"></a><span>
</span><a name="line-2058"></a><span>           </span><span class="hs-comment">-- See Note [Dropping derived constraints]</span><span>
</span><a name="line-2059"></a><span>           </span><span class="hs-comment">-- For fundeps, drop wanted/wanted interactions</span><span>
</span><a name="line-2060"></a><span>           </span><a href="TcRnTypes.html#FunDepOrigin2"><span class="hs-identifier hs-var">FunDepOrigin2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-comment">-- Top-level/Wanted</span><span>
</span><a name="line-2061"></a><span>           </span><a href="TcRnTypes.html#FunDepOrigin1"><span class="hs-identifier hs-var">FunDepOrigin1</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146075"><a href="#local-6989586621684146075"><span class="hs-identifier">loc1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146076"><a href="#local-6989586621684146076"><span class="hs-identifier">loc2</span></a></a><span>
</span><a name="line-2062"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684146077"><span class="hs-identifier hs-var">g1</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684146078"><span class="hs-identifier hs-var">g2</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-comment">-- Given/Wanted errors: keep all</span><span>
</span><a name="line-2063"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-comment">-- Wanted/Wanted errors: discard</span><span>
</span><a name="line-2064"></a><span>             </span><span class="hs-keyword">where</span><span>
</span><a name="line-2065"></a><span>               </span><a name="local-6989586621684146077"><a href="#local-6989586621684146077"><span class="hs-identifier">g1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isGivenLoc"><span class="hs-identifier hs-var">isGivenLoc</span></a><span> </span><a href="#local-6989586621684146075"><span class="hs-identifier hs-var">loc1</span></a><span>
</span><a name="line-2066"></a><span>               </span><a name="local-6989586621684146078"><a href="#local-6989586621684146078"><span class="hs-identifier">g2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isGivenLoc"><span class="hs-identifier hs-var">isGivenLoc</span></a><span> </span><a href="#local-6989586621684146076"><span class="hs-identifier hs-var">loc2</span></a><span>
</span><a name="line-2067"></a><span>
</span><a name="line-2068"></a><span>           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2069"></a><span>
</span><a name="line-2070"></a><span class="hs-identifier">arisesFromGivens</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2071"></a><a name="arisesFromGivens"><a href="TcRnTypes.html#arisesFromGivens"><span class="hs-identifier">arisesFromGivens</span></a></a><span> </span><a name="local-6989586621684146079"><a href="#local-6989586621684146079"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-2072"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-6989586621684146079"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2073"></a><span>      </span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2074"></a><span>      </span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2075"></a><span>      </span><a href="TcRnTypes.html#CtDerived"><span class="hs-identifier hs-var">CtDerived</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146080"><a href="#local-6989586621684146080"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#isGivenLoc"><span class="hs-identifier hs-var">isGivenLoc</span></a><span> </span><a href="#local-6989586621684146080"><span class="hs-identifier hs-var">loc</span></a><span>
</span><a name="line-2076"></a><span>
</span><a name="line-2077"></a><span class="hs-identifier">isGivenLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2078"></a><a name="isGivenLoc"><a href="TcRnTypes.html#isGivenLoc"><span class="hs-identifier">isGivenLoc</span></a></a><span> </span><a name="local-6989586621684146081"><a href="#local-6989586621684146081"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isGivenOrigin"><span class="hs-identifier hs-var">isGivenOrigin</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a><span> </span><a href="#local-6989586621684146081"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2079"></a><span>
</span><a name="line-2080"></a><span class="hs-identifier">isGivenOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2081"></a><a name="isGivenOrigin"><a href="TcRnTypes.html#isGivenOrigin"><span class="hs-identifier">isGivenOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#GivenOrigin"><span class="hs-identifier hs-var">GivenOrigin</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2082"></a><span class="hs-identifier">isGivenOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#FunDepOrigin1"><span class="hs-identifier hs-var">FunDepOrigin1</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146082"><a href="#local-6989586621684146082"><span class="hs-identifier">l1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146083"><a href="#local-6989586621684146083"><span class="hs-identifier">l2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isGivenLoc"><span class="hs-identifier hs-var">isGivenLoc</span></a><span> </span><a href="#local-6989586621684146082"><span class="hs-identifier hs-var">l1</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TcRnTypes.html#isGivenLoc"><span class="hs-identifier hs-var">isGivenLoc</span></a><span> </span><a href="#local-6989586621684146083"><span class="hs-identifier hs-var">l2</span></a><span>
</span><a name="line-2083"></a><span class="hs-identifier">isGivenOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#FunDepOrigin2"><span class="hs-identifier hs-var">FunDepOrigin2</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146084"><a href="#local-6989586621684146084"><span class="hs-identifier">o1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isGivenOrigin"><span class="hs-identifier hs-var">isGivenOrigin</span></a><span> </span><a href="#local-6989586621684146084"><span class="hs-identifier hs-var">o1</span></a><span>
</span><a name="line-2084"></a><span class="hs-identifier">isGivenOrigin</span><span> </span><span class="hs-identifier">_</span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2085"></a><span>
</span><a name="line-2086"></a><span class="hs-comment">{- Note [Dropping derived constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In general we discard derived constraints at the end of constraint solving;
see dropDerivedWC.  For example

 * Superclasses: if we have an unsolved [W] (Ord a), we don't want to
   complain about an unsolved [D] (Eq a) as well.

 * If we have [W] a ~ Int, [W] a ~ Bool, improvement will generate
   [D] Int ~ Bool, and we don't want to report that because it's
   incomprehensible. That is why we don't rewrite wanteds with wanteds!

But (tiresomely) we do keep *some* Derived constraints:

 * Type holes are derived constraints, because they have no evidence
   and we want to keep them, so we get the error report

 * Insoluble kind equalities (e.g. [D] * ~ (* -&gt; *)), with
   KindEqOrigin, may arise from a type equality a ~ Int#, say.  See
   Note [Equalities with incompatible kinds] in TcCanonical.
   These need to be kept because the kind equalities might have different
   source locations and hence different error messages.
   E.g., test case dependent/should_fail/T11471

 * We keep most derived equalities arising from functional dependencies
      - Given/Given interactions (subset of FunDepOrigin1):
        The definitely-insoluble ones reflect unreachable code.

        Others not-definitely-insoluble ones like [D] a ~ Int do not
        reflect unreachable code; indeed if fundeps generated proofs, it'd
        be a useful equality.  See Trac #14763.   So we discard them.

      - Given/Wanted interacGiven or Wanted interacting with an
        instance declaration (FunDepOrigin2)

      - Given/Wanted interactions (FunDepOrigin1); see Trac #9612

      - But for Wanted/Wanted interactions we do /not/ want to report an
        error (Trac #13506).  Consider [W] C Int Int, [W] C Int Bool, with
        a fundep on class C.  We don't want to report an insoluble Int~Bool;
        c.f. &quot;wanteds do not rewrite wanteds&quot;.

To distinguish these cases we use the CtOrigin.

NB: we keep *all* derived insolubles under some circumstances:

  * They are looked at by simplifyInfer, to decide whether to
    generalise.  Example: [W] a ~ Int, [W] a ~ Bool
    We get [D] Int ~ Bool, and indeed the constraints are insoluble,
    and we want simplifyInfer to see that, even though we don't
    ultimately want to generate an (inexplicable) error message from it


************************************************************************
*                                                                      *
                    CtEvidence
         The &quot;flavor&quot; of a canonical constraint
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2146"></a><span>
</span><a name="line-2147"></a><span class="hs-identifier">isWantedCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2148"></a><a name="isWantedCt"><a href="TcRnTypes.html#isWantedCt"><span class="hs-identifier">isWantedCt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isWanted"><span class="hs-identifier hs-var">isWanted</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span>
</span><a name="line-2149"></a><span>
</span><a name="line-2150"></a><span class="hs-identifier">isGivenCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2151"></a><a name="isGivenCt"><a href="TcRnTypes.html#isGivenCt"><span class="hs-identifier">isGivenCt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isGiven"><span class="hs-identifier hs-var">isGiven</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span>
</span><a name="line-2152"></a><span>
</span><a name="line-2153"></a><span class="hs-identifier">isDerivedCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2154"></a><a name="isDerivedCt"><a href="TcRnTypes.html#isDerivedCt"><span class="hs-identifier">isDerivedCt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isDerived"><span class="hs-identifier hs-var">isDerived</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span>
</span><a name="line-2155"></a><span>
</span><a name="line-2156"></a><span class="hs-identifier">isCTyEqCan</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2157"></a><a name="isCTyEqCan"><a href="TcRnTypes.html#isCTyEqCan"><span class="hs-identifier">isCTyEqCan</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2158"></a><span class="hs-identifier">isCTyEqCan</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2159"></a><span class="hs-identifier">isCTyEqCan</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2160"></a><span>
</span><a name="line-2161"></a><span class="hs-identifier">isCDictCan_Maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span>
</span><a name="line-2162"></a><a name="isCDictCan_Maybe"><a href="TcRnTypes.html#isCDictCan_Maybe"><span class="hs-identifier">isCDictCan_Maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">cc_class</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146085"><a href="#local-6989586621684146085"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684146085"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-2163"></a><span class="hs-identifier">isCDictCan_Maybe</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2164"></a><span>
</span><a name="line-2165"></a><span class="hs-identifier">isCFunEqCan_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2166"></a><a name="isCFunEqCan_maybe"><a href="TcRnTypes.html#isCFunEqCan_maybe"><span class="hs-identifier">isCFunEqCan_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_fun</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146086"><a href="#local-6989586621684146086"><span class="hs-identifier">tc</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_tyargs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146087"><a href="#local-6989586621684146087"><span class="hs-identifier">xis</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146086"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684146087"><span class="hs-identifier hs-var">xis</span></a><span class="hs-special">)</span><span>
</span><a name="line-2167"></a><span class="hs-identifier">isCFunEqCan_maybe</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2168"></a><span>
</span><a name="line-2169"></a><span class="hs-identifier">isCFunEqCan</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2170"></a><a name="isCFunEqCan"><a href="TcRnTypes.html#isCFunEqCan"><span class="hs-identifier">isCFunEqCan</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2171"></a><span class="hs-identifier">isCFunEqCan</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2172"></a><span>
</span><a name="line-2173"></a><span class="hs-identifier">isCNonCanonical</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2174"></a><a name="isCNonCanonical"><a href="TcRnTypes.html#isCNonCanonical"><span class="hs-identifier">isCNonCanonical</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CNonCanonical"><span class="hs-identifier hs-var">CNonCanonical</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2175"></a><span class="hs-identifier">isCNonCanonical</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2176"></a><span>
</span><a name="line-2177"></a><span class="hs-identifier">isHoleCt</span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2178"></a><a name="isHoleCt"><a href="TcRnTypes.html#isHoleCt"><span class="hs-identifier">isHoleCt</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier hs-var">CHoleCan</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2179"></a><span class="hs-identifier">isHoleCt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2180"></a><span>
</span><a name="line-2181"></a><span class="hs-identifier">isOutOfScopeCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2182"></a><span class="hs-comment">-- We treat expression holes representing out-of-scope variables a bit</span><span>
</span><a name="line-2183"></a><span class="hs-comment">-- differently when it comes to error reporting</span><span>
</span><a name="line-2184"></a><a name="isOutOfScopeCt"><a href="TcRnTypes.html#isOutOfScopeCt"><span class="hs-identifier">isOutOfScopeCt</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier hs-var">CHoleCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_hole</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ExprHole"><span class="hs-identifier hs-var">ExprHole</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#OutOfScope"><span class="hs-identifier hs-var">OutOfScope</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2185"></a><span class="hs-identifier">isOutOfScopeCt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2186"></a><span>
</span><a name="line-2187"></a><span class="hs-identifier">isExprHoleCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2188"></a><a name="isExprHoleCt"><a href="TcRnTypes.html#isExprHoleCt"><span class="hs-identifier">isExprHoleCt</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier hs-var">CHoleCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_hole</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ExprHole"><span class="hs-identifier hs-var">ExprHole</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2189"></a><span class="hs-identifier">isExprHoleCt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2190"></a><span>
</span><a name="line-2191"></a><span class="hs-identifier">isTypeHoleCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2192"></a><a name="isTypeHoleCt"><a href="TcRnTypes.html#isTypeHoleCt"><span class="hs-identifier">isTypeHoleCt</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier hs-var">CHoleCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_hole</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TypeHole"><span class="hs-identifier hs-var">TypeHole</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2193"></a><span class="hs-identifier">isTypeHoleCt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2194"></a><span>
</span><a name="line-2195"></a><span>
</span><a name="line-2196"></a><span class="hs-comment">{- Note [Custom type errors in constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When GHC reports a type-error about an unsolved-constraint, we check
to see if the constraint contains any custom-type errors, and if so
we report them.  Here are some examples of constraints containing type
errors:

TypeError msg           -- The actual constraint is a type error

TypError msg ~ Int      -- Some type was supposed to be Int, but ended up
                        -- being a type error instead

Eq (TypeError msg)      -- A class constraint is stuck due to a type error

F (TypeError msg) ~ a   -- A type function failed to evaluate due to a type err

It is also possible to have constraints where the type error is nested deeper,
for example see #11990, and also:

Eq (F (TypeError msg))  -- Here the type error is nested under a type-function
                        -- call, which failed to evaluate because of it,
                        -- and so the `Eq` constraint was unsolved.
                        -- This may happen when one function calls another
                        -- and the called function produced a custom type error.
-}</span><span>
</span><a name="line-2222"></a><span>
</span><a name="line-2223"></a><span class="hs-comment">-- | A constraint is considered to be a custom type error, if it contains</span><span>
</span><a name="line-2224"></a><span class="hs-comment">-- custom type errors anywhere in it.</span><span>
</span><a name="line-2225"></a><span class="hs-comment">-- See Note [Custom type errors in constraints]</span><span>
</span><a name="line-2226"></a><span class="hs-identifier">getUserTypeErrorMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2227"></a><a name="getUserTypeErrorMsg"><a href="TcRnTypes.html#getUserTypeErrorMsg"><span class="hs-identifier">getUserTypeErrorMsg</span></a></a><span> </span><a name="local-6989586621684146088"><a href="#local-6989586621684146088"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146089"><span class="hs-identifier hs-var">findUserTypeError</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctPred"><span class="hs-identifier hs-var">ctPred</span></a><span> </span><a href="#local-6989586621684146088"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-2228"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2229"></a><span>  </span><a name="local-6989586621684146089"><a href="#local-6989586621684146089"><span class="hs-identifier">findUserTypeError</span></a></a><span> </span><a name="local-6989586621684146091"><a href="#local-6989586621684146091"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">msum</span><span> </span><span class="hs-special">(</span><span> </span><a href="Type.html#userTypeError_maybe"><span class="hs-identifier hs-var">userTypeError_maybe</span></a><span> </span><a href="#local-6989586621684146091"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-2230"></a><span>                             </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621684146089"><span class="hs-identifier hs-var">findUserTypeError</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146090"><span class="hs-identifier hs-var">subTys</span></a><span> </span><a href="#local-6989586621684146091"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-2231"></a><span>                             </span><span class="hs-special">)</span><span>
</span><a name="line-2232"></a><span>
</span><a name="line-2233"></a><span>  </span><a name="local-6989586621684146090"><a href="#local-6989586621684146090"><span class="hs-identifier">subTys</span></a></a><span> </span><a name="local-6989586621684146092"><a href="#local-6989586621684146092"><span class="hs-identifier">t</span></a></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitAppTys"><span class="hs-identifier hs-var">splitAppTys</span></a><span> </span><a href="#local-6989586621684146092"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2234"></a><span>                          </span><span class="hs-special">(</span><a name="local-6989586621684146093"><a href="#local-6989586621684146093"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2235"></a><span>                            </span><span class="hs-keyword">case</span><span> </span><a href="Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a><span> </span><a href="#local-6989586621684146093"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2236"></a><span>                              </span><span class="hs-identifier hs-var">Nothing</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2237"></a><span>                              </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621684146094"><a href="#local-6989586621684146094"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684146094"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-2238"></a><span>                          </span><span class="hs-special">(</span><a name="local-6989586621684146095"><a href="#local-6989586621684146095"><span class="hs-identifier">t</span></a></a><span class="hs-special">,</span><a name="local-6989586621684146096"><a href="#local-6989586621684146096"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684146095"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684146096"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-2239"></a><span>
</span><a name="line-2240"></a><span>
</span><a name="line-2241"></a><span>
</span><a name="line-2242"></a><span>
</span><a name="line-2243"></a><span class="hs-identifier">isUserTypeErrorCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2244"></a><a name="isUserTypeErrorCt"><a href="TcRnTypes.html#isUserTypeErrorCt"><span class="hs-identifier">isUserTypeErrorCt</span></a></a><span> </span><a name="local-6989586621684146097"><a href="#local-6989586621684146097"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TcRnTypes.html#getUserTypeErrorMsg"><span class="hs-identifier hs-var">getUserTypeErrorMsg</span></a><span> </span><a href="#local-6989586621684146097"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2245"></a><span>                         </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2246"></a><span>                         </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2247"></a><span>
</span><a name="line-2248"></a><span class="hs-identifier">isPendingScDict</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-2249"></a><span class="hs-comment">-- Says whether this is a CDictCan with cc_pend_sc is True,</span><span>
</span><a name="line-2250"></a><span class="hs-comment">-- AND if so flips the flag</span><span>
</span><a name="line-2251"></a><a name="isPendingScDict"><a href="TcRnTypes.html#isPendingScDict"><span class="hs-identifier">isPendingScDict</span></a></a><span> </span><a name="local-6989586621684146098"><a href="#local-6989586621684146098"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_pend_sc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2252"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146098"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_pend_sc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2253"></a><span class="hs-identifier">isPendingScDict</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2254"></a><span>
</span><a name="line-2255"></a><span class="hs-identifier">isPendingScInst</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TcRnTypes.html#QCInst"><span class="hs-identifier hs-type">QCInst</span></a><span>
</span><a name="line-2256"></a><span class="hs-comment">-- Same as isPrendinScDict, but for QCInsts</span><span>
</span><a name="line-2257"></a><a name="isPendingScInst"><a href="TcRnTypes.html#isPendingScInst"><span class="hs-identifier">isPendingScInst</span></a></a><span> </span><a name="local-6989586621684146099"><a href="#local-6989586621684146099"><span class="hs-identifier">qci</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#QCI"><span class="hs-identifier hs-var">QCI</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qci_pend_sc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2258"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146099"><span class="hs-identifier hs-var">qci</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">qci_pend_sc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2259"></a><span class="hs-identifier">isPendingScInst</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2260"></a><span>
</span><a name="line-2261"></a><span class="hs-identifier">setPendingScDict</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span>
</span><a name="line-2262"></a><span class="hs-comment">-- Set the cc_pend_sc flag to True</span><span>
</span><a name="line-2263"></a><a name="setPendingScDict"><a href="TcRnTypes.html#setPendingScDict"><span class="hs-identifier">setPendingScDict</span></a></a><span> </span><a name="local-6989586621684146100"><a href="#local-6989586621684146100"><span class="hs-identifier">ct</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_pend_sc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2264"></a><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146100"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_pend_sc</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2265"></a><span class="hs-identifier">setPendingScDict</span><span> </span><a name="local-6989586621684146101"><a href="#local-6989586621684146101"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146101"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-2266"></a><span>
</span><a name="line-2267"></a><span class="hs-identifier">superClassesMightHelp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2268"></a><span class="hs-comment">-- ^ True if taking superclasses of givens, or of wanteds (to perhaps</span><span>
</span><a name="line-2269"></a><span class="hs-comment">-- expose more equalities or functional dependencies) might help to</span><span>
</span><a name="line-2270"></a><span class="hs-comment">-- solve this constraint.  See Note [When superclasses help]</span><span>
</span><a name="line-2271"></a><a name="superClassesMightHelp"><a href="TcRnTypes.html#superClassesMightHelp"><span class="hs-identifier">superClassesMightHelp</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146102"><a href="#local-6989586621684146102"><span class="hs-identifier">simples</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146103"><a href="#local-6989586621684146103"><span class="hs-identifier">implics</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2272"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#anyBag"><span class="hs-identifier hs-var">anyBag</span></a><span> </span><a href="#local-6989586621684146105"><span class="hs-identifier hs-var">might_help_ct</span></a><span> </span><a href="#local-6989586621684146102"><span class="hs-identifier hs-var">simples</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Bag.html#anyBag"><span class="hs-identifier hs-var">anyBag</span></a><span> </span><a href="#local-6989586621684146104"><span class="hs-identifier hs-var">might_help_implic</span></a><span> </span><a href="#local-6989586621684146103"><span class="hs-identifier hs-var">implics</span></a><span>
</span><a name="line-2273"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2274"></a><span>    </span><a name="local-6989586621684146104"><a href="#local-6989586621684146104"><span class="hs-identifier">might_help_implic</span></a></a><span> </span><a name="local-6989586621684146107"><a href="#local-6989586621684146107"><span class="hs-identifier">ic</span></a></a><span>
</span><a name="line-2275"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#IC_Unsolved"><span class="hs-identifier hs-var">IC_Unsolved</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">ic_status</span><span> </span><a href="#local-6989586621684146107"><span class="hs-identifier hs-var">ic</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#superClassesMightHelp"><span class="hs-identifier hs-var">superClassesMightHelp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_wanted</span><span> </span><a href="#local-6989586621684146107"><span class="hs-identifier hs-var">ic</span></a><span class="hs-special">)</span><span>
</span><a name="line-2276"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2277"></a><span>
</span><a name="line-2278"></a><span>    </span><a name="local-6989586621684146105"><a href="#local-6989586621684146105"><span class="hs-identifier">might_help_ct</span></a></a><span> </span><a name="local-6989586621684146108"><a href="#local-6989586621684146108"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isWantedCt"><span class="hs-identifier hs-var">isWantedCt</span></a><span> </span><a href="#local-6989586621684146108"><span class="hs-identifier hs-var">ct</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146106"><span class="hs-identifier hs-var">is_ip</span></a><span> </span><a href="#local-6989586621684146108"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-2279"></a><span>
</span><a name="line-2280"></a><span>    </span><a name="local-6989586621684146106"><a href="#local-6989586621684146106"><span class="hs-identifier">is_ip</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_class</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146109"><a href="#local-6989586621684146109"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#isIPClass"><span class="hs-identifier hs-var">isIPClass</span></a><span> </span><a href="#local-6989586621684146109"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-2281"></a><span>    </span><span class="hs-identifier">is_ip</span><span> </span><span class="hs-identifier">_</span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2282"></a><span>
</span><a name="line-2283"></a><span class="hs-identifier">getPendingWantedScs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span class="hs-special">)</span><span>
</span><a name="line-2284"></a><a name="getPendingWantedScs"><a href="TcRnTypes.html#getPendingWantedScs"><span class="hs-identifier">getPendingWantedScs</span></a></a><span> </span><a name="local-6989586621684146110"><a href="#local-6989586621684146110"><span class="hs-identifier">simples</span></a></a><span>
</span><a name="line-2285"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#mapAccumBagL"><span class="hs-identifier hs-var">mapAccumBagL</span></a><span> </span><a href="#local-6989586621684146111"><span class="hs-identifier hs-var">get</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621684146110"><span class="hs-identifier hs-var">simples</span></a><span>
</span><a name="line-2286"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2287"></a><span>    </span><a name="local-6989586621684146111"><a href="#local-6989586621684146111"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621684146112"><a href="#local-6989586621684146112"><span class="hs-identifier">acc</span></a></a><span> </span><a name="local-6989586621684146113"><a href="#local-6989586621684146113"><span class="hs-identifier">ct</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684146114"><a href="#local-6989586621684146114"><span class="hs-identifier">ct'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnTypes.html#isPendingScDict"><span class="hs-identifier hs-var">isPendingScDict</span></a><span> </span><a href="#local-6989586621684146113"><span class="hs-identifier hs-var">ct</span></a><span>
</span><a name="line-2288"></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146114"><span class="hs-identifier hs-var">ct'</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684146112"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684146114"><span class="hs-identifier hs-var">ct'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2289"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2290"></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146112"><span class="hs-identifier hs-var">acc</span></a><span class="hs-special">,</span><span>     </span><a href="#local-6989586621684146113"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-2291"></a><span>
</span><a name="line-2292"></a><span class="hs-comment">{- Note [When superclasses help]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
First read Note [The superclass story] in TcCanonical.

We expand superclasses and iterate only if there is at unsolved wanted
for which expansion of superclasses (e.g. from given constraints)
might actually help. The function superClassesMightHelp tells if
doing this superclass expansion might help solve this constraint.
Note that

  * We look inside implications; maybe it'll help to expand the Givens
    at level 2 to help solve an unsolved Wanted buried inside an
    implication.  E.g.
        forall a. Ord a =&gt; forall b. [W] Eq a

  * Superclasses help only for Wanted constraints.  Derived constraints
    are not really &quot;unsolved&quot; and we certainly don't want them to
    trigger superclass expansion. This was a good part of the loop
    in  Trac #11523

  * Even for Wanted constraints, we say &quot;no&quot; for implicit parameters.
    we have [W] ?x::ty, expanding superclasses won't help:
      - Superclasses can't be implicit parameters
      - If we have a [G] ?x:ty2, then we'll have another unsolved
        [D] ty ~ ty2 (from the functional dependency)
        which will trigger superclass expansion.

    It's a bit of a special case, but it's easy to do.  The runtime cost
    is low because the unsolved set is usually empty anyway (errors
    aside), and the first non-imlicit-parameter will terminate the search.

    The special case is worth it (Trac #11480, comment:2) because it
    applies to CallStack constraints, which aren't type errors. If we have
       f :: (C a) =&gt; blah
       f x = ...undefined...
    we'll get a CallStack constraint.  If that's the only unsolved
    constraint it'll eventually be solved by defaulting.  So we don't
    want to emit warnings about hitting the simplifier's iteration
    limit.  A CallStack constraint really isn't an unsolved
    constraint; it can always be solved by defaulting.
-}</span><span>
</span><a name="line-2333"></a><span>
</span><a name="line-2334"></a><span class="hs-identifier">singleCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-2335"></a><a name="singleCt"><a href="TcRnTypes.html#singleCt"><span class="hs-identifier">singleCt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a><span>
</span><a name="line-2336"></a><span>
</span><a name="line-2337"></a><span class="hs-identifier">andCts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-2338"></a><a name="andCts"><a href="TcRnTypes.html#andCts"><span class="hs-identifier">andCts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span>
</span><a name="line-2339"></a><span>
</span><a name="line-2340"></a><span class="hs-identifier">listToCts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-2341"></a><a name="listToCts"><a href="TcRnTypes.html#listToCts"><span class="hs-identifier">listToCts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a><span>
</span><a name="line-2342"></a><span>
</span><a name="line-2343"></a><span class="hs-identifier">ctsElts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>
</span><a name="line-2344"></a><a name="ctsElts"><a href="TcRnTypes.html#ctsElts"><span class="hs-identifier">ctsElts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span>
</span><a name="line-2345"></a><span>
</span><a name="line-2346"></a><span class="hs-identifier">consCts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-2347"></a><a name="consCts"><a href="TcRnTypes.html#consCts"><span class="hs-identifier">consCts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#consBag"><span class="hs-identifier hs-var">consBag</span></a><span>
</span><a name="line-2348"></a><span>
</span><a name="line-2349"></a><span class="hs-identifier">snocCts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-2350"></a><a name="snocCts"><a href="TcRnTypes.html#snocCts"><span class="hs-identifier">snocCts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#snocBag"><span class="hs-identifier hs-var">snocBag</span></a><span>
</span><a name="line-2351"></a><span>
</span><a name="line-2352"></a><span class="hs-identifier">extendCtsList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-2353"></a><a name="extendCtsList"><a href="TcRnTypes.html#extendCtsList"><span class="hs-identifier">extendCtsList</span></a></a><span> </span><a name="local-6989586621684146115"><a href="#local-6989586621684146115"><span class="hs-identifier">cts</span></a></a><span> </span><a name="local-6989586621684146116"><a href="#local-6989586621684146116"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621684146116"><span class="hs-identifier hs-var">xs</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146115"><span class="hs-identifier hs-var">cts</span></a><span>
</span><a name="line-2354"></a><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146115"><span class="hs-identifier hs-var">cts</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a><span> </span><a href="#local-6989586621684146116"><span class="hs-identifier hs-var">xs</span></a><span>
</span><a name="line-2355"></a><span>
</span><a name="line-2356"></a><span class="hs-identifier">andManyCts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-2357"></a><a name="andManyCts"><a href="TcRnTypes.html#andManyCts"><span class="hs-identifier">andManyCts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#unionManyBags"><span class="hs-identifier hs-var">unionManyBags</span></a><span>
</span><a name="line-2358"></a><span>
</span><a name="line-2359"></a><span class="hs-identifier">emptyCts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>
</span><a name="line-2360"></a><a name="emptyCts"><a href="TcRnTypes.html#emptyCts"><span class="hs-identifier">emptyCts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-2361"></a><span>
</span><a name="line-2362"></a><span class="hs-identifier">isEmptyCts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2363"></a><a name="isEmptyCts"><a href="TcRnTypes.html#isEmptyCts"><span class="hs-identifier">isEmptyCts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a><span>
</span><a name="line-2364"></a><span>
</span><a name="line-2365"></a><span class="hs-identifier">pprCts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2366"></a><a name="pprCts"><a href="TcRnTypes.html#pprCts"><span class="hs-identifier">pprCts</span></a></a><span> </span><a name="local-6989586621684146117"><a href="#local-6989586621684146117"><span class="hs-identifier">cts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><a href="#local-6989586621684146117"><span class="hs-identifier hs-var">cts</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2367"></a><span>
</span><a name="line-2368"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Wanted constraints
     These are forced to be in TcRnTypes because
           TcLclEnv mentions WantedConstraints
           WantedConstraint mentions CtLoc
           CtLoc mentions ErrCtxt
           ErrCtxt mentions TcM
*                                                                      *
v%************************************************************************
-}</span><span>
</span><a name="line-2380"></a><span>
</span><a name="line-2381"></a><span class="hs-keyword">data</span><span> </span><a name="WantedConstraints"><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier">WantedConstraints</span></a></a><span>
</span><a name="line-2382"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="WC"><a href="TcRnTypes.html#WC"><span class="hs-identifier">WC</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="wc_simple"><a href="TcRnTypes.html#wc_simple"><span class="hs-identifier">wc_simple</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Cts"><span class="hs-identifier hs-type">Cts</span></a><span>              </span><span class="hs-comment">-- Unsolved constraints, all wanted</span><span>
</span><a name="line-2383"></a><span>       </span><span class="hs-special">,</span><span> </span><a name="wc_impl"><a href="TcRnTypes.html#wc_impl"><span class="hs-identifier">wc_impl</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span>
</span><a name="line-2384"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-2385"></a><span>
</span><a name="line-2386"></a><span class="hs-identifier">emptyWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-2387"></a><a name="emptyWC"><a href="TcRnTypes.html#emptyWC"><span class="hs-identifier">emptyWC</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2388"></a><span>
</span><a name="line-2389"></a><span class="hs-identifier">mkSimpleWC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-2390"></a><a name="mkSimpleWC"><a href="TcRnTypes.html#mkSimpleWC"><span class="hs-identifier">mkSimpleWC</span></a></a><span> </span><a name="local-6989586621684146118"><a href="#local-6989586621684146118"><span class="hs-identifier">cts</span></a></a><span>
</span><a name="line-2391"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="TcRnTypes.html#mkNonCanonical"><span class="hs-identifier hs-var">mkNonCanonical</span></a><span> </span><a href="#local-6989586621684146118"><span class="hs-identifier hs-var">cts</span></a><span class="hs-special">)</span><span>
</span><a name="line-2392"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2393"></a><span>
</span><a name="line-2394"></a><span class="hs-identifier">mkImplicWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-2395"></a><a name="mkImplicWC"><a href="TcRnTypes.html#mkImplicWC"><span class="hs-identifier">mkImplicWC</span></a></a><span> </span><a name="local-6989586621684146119"><a href="#local-6989586621684146119"><span class="hs-identifier">implic</span></a></a><span>
</span><a name="line-2396"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146119"><span class="hs-identifier hs-var">implic</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2397"></a><span>
</span><a name="line-2398"></a><span class="hs-identifier">isEmptyWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2399"></a><a name="isEmptyWC"><a href="TcRnTypes.html#isEmptyWC"><span class="hs-identifier">isEmptyWC</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146120"><a href="#local-6989586621684146120"><span class="hs-identifier">f</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146121"><a href="#local-6989586621684146121"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2400"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a><span> </span><a href="#local-6989586621684146120"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a><span> </span><a href="#local-6989586621684146121"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-2401"></a><span>
</span><a name="line-2402"></a><span>
</span><a name="line-2403"></a><span class="hs-comment">-- | Checks whether a the given wanted constraints are solved, i.e.</span><span>
</span><a name="line-2404"></a><span class="hs-comment">-- that there are no simple constraints left and all the implications</span><span>
</span><a name="line-2405"></a><span class="hs-comment">-- are solved.</span><span>
</span><a name="line-2406"></a><span class="hs-identifier">isSolvedWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2407"></a><a name="isSolvedWC"><a href="TcRnTypes.html#isSolvedWC"><span class="hs-identifier">isSolvedWC</span></a></a><span> </span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146122"><a href="#local-6989586621684146122"><span class="hs-identifier">wc_simple</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146123"><a href="#local-6989586621684146123"><span class="hs-identifier">wc_impl</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2408"></a><span>  </span><a href="Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a><span> </span><a href="#local-6989586621684146122"><span class="hs-identifier hs-var">wc_simple</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Bag.html#allBag"><span class="hs-identifier hs-var">allBag</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#isSolvedStatus"><span class="hs-identifier hs-var">isSolvedStatus</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">ic_status</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684146123"><span class="hs-identifier hs-var">wc_impl</span></a><span>
</span><a name="line-2409"></a><span>
</span><a name="line-2410"></a><span class="hs-identifier">andWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-2411"></a><a name="andWC"><a href="TcRnTypes.html#andWC"><span class="hs-identifier">andWC</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146124"><a href="#local-6989586621684146124"><span class="hs-identifier">f1</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146125"><a href="#local-6989586621684146125"><span class="hs-identifier">i1</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2412"></a><span>      </span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146126"><a href="#local-6989586621684146126"><span class="hs-identifier">f2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146127"><a href="#local-6989586621684146127"><span class="hs-identifier">i2</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2413"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146124"><span class="hs-identifier hs-var">f1</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146126"><span class="hs-identifier hs-var">f2</span></a><span>
</span><a name="line-2414"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146125"><span class="hs-identifier hs-var">i1</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146127"><span class="hs-identifier hs-var">i2</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2415"></a><span>
</span><a name="line-2416"></a><span class="hs-identifier">unionsWC</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-2417"></a><a name="unionsWC"><a href="TcRnTypes.html#unionsWC"><span class="hs-identifier">unionsWC</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="TcRnTypes.html#andWC"><span class="hs-identifier hs-var">andWC</span></a><span> </span><a href="TcRnTypes.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a><span>
</span><a name="line-2418"></a><span>
</span><a name="line-2419"></a><span class="hs-identifier">addSimples</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-2420"></a><a name="addSimples"><a href="TcRnTypes.html#addSimples"><span class="hs-identifier">addSimples</span></a></a><span> </span><a name="local-6989586621684146128"><a href="#local-6989586621684146128"><span class="hs-identifier">wc</span></a></a><span> </span><a name="local-6989586621684146129"><a href="#local-6989586621684146129"><span class="hs-identifier">cts</span></a></a><span>
</span><a name="line-2421"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146128"><span class="hs-identifier hs-var">wc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><a href="#local-6989586621684146128"><span class="hs-identifier hs-var">wc</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146129"><span class="hs-identifier hs-var">cts</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2422"></a><span>    </span><span class="hs-comment">-- Consider: Put the new constraints at the front, so they get solved first</span><span>
</span><a name="line-2423"></a><span>
</span><a name="line-2424"></a><span class="hs-identifier">addImplics</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-2425"></a><a name="addImplics"><a href="TcRnTypes.html#addImplics"><span class="hs-identifier">addImplics</span></a></a><span> </span><a name="local-6989586621684146130"><a href="#local-6989586621684146130"><span class="hs-identifier">wc</span></a></a><span> </span><a name="local-6989586621684146131"><a href="#local-6989586621684146131"><span class="hs-identifier">implic</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146130"><span class="hs-identifier hs-var">wc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><a href="#local-6989586621684146130"><span class="hs-identifier hs-var">wc</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146131"><span class="hs-identifier hs-var">implic</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2426"></a><span>
</span><a name="line-2427"></a><span class="hs-identifier">addInsols</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-2428"></a><a name="addInsols"><a href="TcRnTypes.html#addInsols"><span class="hs-identifier">addInsols</span></a></a><span> </span><a name="local-6989586621684146132"><a href="#local-6989586621684146132"><span class="hs-identifier">wc</span></a></a><span> </span><a name="local-6989586621684146133"><a href="#local-6989586621684146133"><span class="hs-identifier">cts</span></a></a><span>
</span><a name="line-2429"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146132"><span class="hs-identifier hs-var">wc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><a href="#local-6989586621684146132"><span class="hs-identifier hs-var">wc</span></a><span> </span><span class="hs-special">`</span><a href="Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146133"><span class="hs-identifier hs-var">cts</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2430"></a><span>
</span><a name="line-2431"></a><span class="hs-identifier">insolublesOnly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span>
</span><a name="line-2432"></a><span class="hs-comment">-- Keep only the definitely-insoluble constraints</span><span>
</span><a name="line-2433"></a><a name="insolublesOnly"><a href="TcRnTypes.html#insolublesOnly"><span class="hs-identifier">insolublesOnly</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146134"><a href="#local-6989586621684146134"><span class="hs-identifier">simples</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146135"><a href="#local-6989586621684146135"><span class="hs-identifier">implics</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2434"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#filterBag"><span class="hs-identifier hs-var">filterBag</span></a><span> </span><a href="TcRnTypes.html#insolubleCt"><span class="hs-identifier hs-var">insolubleCt</span></a><span> </span><a href="#local-6989586621684146134"><span class="hs-identifier hs-var">simples</span></a><span>
</span><a name="line-2435"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#mapBag"><span class="hs-identifier hs-var">mapBag</span></a><span> </span><a href="#local-6989586621684146136"><span class="hs-identifier hs-var">implic_insols_only</span></a><span> </span><a href="#local-6989586621684146135"><span class="hs-identifier hs-var">implics</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2436"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2437"></a><span>    </span><a name="local-6989586621684146136"><a href="#local-6989586621684146136"><span class="hs-identifier">implic_insols_only</span></a></a><span> </span><a name="local-6989586621684146137"><a href="#local-6989586621684146137"><span class="hs-identifier">implic</span></a></a><span>
</span><a name="line-2438"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146137"><span class="hs-identifier hs-var">implic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_wanted</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#insolublesOnly"><span class="hs-identifier hs-var">insolublesOnly</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_wanted</span><span> </span><a href="#local-6989586621684146137"><span class="hs-identifier hs-var">implic</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2439"></a><span>
</span><a name="line-2440"></a><span class="hs-identifier">isSolvedStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ImplicStatus"><span class="hs-identifier hs-type">ImplicStatus</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2441"></a><a name="isSolvedStatus"><a href="TcRnTypes.html#isSolvedStatus"><span class="hs-identifier">isSolvedStatus</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#IC_Solved"><span class="hs-identifier hs-var">IC_Solved</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2442"></a><span class="hs-identifier">isSolvedStatus</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2443"></a><span>
</span><a name="line-2444"></a><span class="hs-identifier">isInsolubleStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ImplicStatus"><span class="hs-identifier hs-type">ImplicStatus</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2445"></a><a name="isInsolubleStatus"><a href="TcRnTypes.html#isInsolubleStatus"><span class="hs-identifier">isInsolubleStatus</span></a></a><span> </span><a href="TcRnTypes.html#IC_Insoluble"><span class="hs-identifier hs-var">IC_Insoluble</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2446"></a><span class="hs-identifier">isInsolubleStatus</span><span> </span><a href="TcRnTypes.html#IC_BadTelescope"><span class="hs-identifier hs-var">IC_BadTelescope</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2447"></a><span class="hs-identifier">isInsolubleStatus</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2448"></a><span>
</span><a name="line-2449"></a><span class="hs-identifier">insolubleImplic</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2450"></a><a name="insolubleImplic"><a href="TcRnTypes.html#insolubleImplic"><span class="hs-identifier">insolubleImplic</span></a></a><span> </span><a name="local-6989586621684146138"><a href="#local-6989586621684146138"><span class="hs-identifier">ic</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isInsolubleStatus"><span class="hs-identifier hs-var">isInsolubleStatus</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_status</span><span> </span><a href="#local-6989586621684146138"><span class="hs-identifier hs-var">ic</span></a><span class="hs-special">)</span><span>
</span><a name="line-2451"></a><span>
</span><a name="line-2452"></a><span class="hs-identifier">insolubleWC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2453"></a><a name="insolubleWC"><a href="TcRnTypes.html#insolubleWC"><span class="hs-identifier">insolubleWC</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146139"><a href="#local-6989586621684146139"><span class="hs-identifier">implics</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146140"><a href="#local-6989586621684146140"><span class="hs-identifier">simples</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2454"></a><span>  </span><span class="hs-glyph">=</span><span>  </span><a href="Bag.html#anyBag"><span class="hs-identifier hs-var">anyBag</span></a><span> </span><a href="TcRnTypes.html#insolubleCt"><span class="hs-identifier hs-var">insolubleCt</span></a><span> </span><a href="#local-6989586621684146140"><span class="hs-identifier hs-var">simples</span></a><span>
</span><a name="line-2455"></a><span>  </span><span class="hs-operator hs-var">||</span><span> </span><a href="Bag.html#anyBag"><span class="hs-identifier hs-var">anyBag</span></a><span> </span><a href="TcRnTypes.html#insolubleImplic"><span class="hs-identifier hs-var">insolubleImplic</span></a><span> </span><a href="#local-6989586621684146139"><span class="hs-identifier hs-var">implics</span></a><span>
</span><a name="line-2456"></a><span>
</span><a name="line-2457"></a><span class="hs-identifier">insolubleCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2458"></a><span class="hs-comment">-- Definitely insoluble, in particular /excluding/ type-hole constraints</span><span>
</span><a name="line-2459"></a><span class="hs-comment">-- Namely: a) an equality constraint</span><span>
</span><a name="line-2460"></a><span class="hs-comment">--         b) that is insoluble</span><span>
</span><a name="line-2461"></a><span class="hs-comment">--         c) and does not arise from a Given</span><span>
</span><a name="line-2462"></a><a name="insolubleCt"><a href="TcRnTypes.html#insolubleCt"><span class="hs-identifier">insolubleCt</span></a></a><span> </span><a name="local-6989586621684146141"><a href="#local-6989586621684146141"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-2463"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#isHoleCt"><span class="hs-identifier hs-var">isHoleCt</span></a><span> </span><a href="#local-6989586621684146141"><span class="hs-identifier hs-var">ct</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isOutOfScopeCt"><span class="hs-identifier hs-var">isOutOfScopeCt</span></a><span> </span><a href="#local-6989586621684146141"><span class="hs-identifier hs-var">ct</span></a><span>  </span><span class="hs-comment">-- See Note [Insoluble holes]</span><span>
</span><a name="line-2464"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#insolubleEqCt"><span class="hs-identifier hs-var">insolubleEqCt</span></a><span> </span><a href="#local-6989586621684146141"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2465"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#arisesFromGivens"><span class="hs-identifier hs-var">arisesFromGivens</span></a><span> </span><a href="#local-6989586621684146141"><span class="hs-identifier hs-var">ct</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>              </span><span class="hs-comment">-- See Note [Given insolubles]</span><span>
</span><a name="line-2466"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2467"></a><span>
</span><a name="line-2468"></a><span class="hs-identifier">insolubleEqCt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2469"></a><span class="hs-comment">-- Returns True of /equality/ constraints</span><span>
</span><a name="line-2470"></a><span class="hs-comment">-- that are /definitely/ insoluble</span><span>
</span><a name="line-2471"></a><span class="hs-comment">-- It won't detect some definite errors like</span><span>
</span><a name="line-2472"></a><span class="hs-comment">--       F a ~ T (F a)</span><span>
</span><a name="line-2473"></a><span class="hs-comment">-- where F is a type family, which actually has an occurs check</span><span>
</span><a name="line-2474"></a><span class="hs-comment">--</span><span>
</span><a name="line-2475"></a><span class="hs-comment">-- The function is tuned for application /after/ constraint solving</span><span>
</span><a name="line-2476"></a><span class="hs-comment">--       i.e. assuming canonicalisation has been done</span><span>
</span><a name="line-2477"></a><span class="hs-comment">-- E.g.  It'll reply True  for     a ~ [a]</span><span>
</span><a name="line-2478"></a><span class="hs-comment">--               but False for   [a] ~ a</span><span>
</span><a name="line-2479"></a><span class="hs-comment">-- and</span><span>
</span><a name="line-2480"></a><span class="hs-comment">--                   True for  Int ~ F a Int</span><span>
</span><a name="line-2481"></a><span class="hs-comment">--               but False for  Maybe Int ~ F a Int Int</span><span>
</span><a name="line-2482"></a><span class="hs-comment">--               (where F is an arity-1 type function)</span><span>
</span><a name="line-2483"></a><a name="insolubleEqCt"><a href="TcRnTypes.html#insolubleEqCt"><span class="hs-identifier">insolubleEqCt</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CIrredCan"><span class="hs-identifier hs-var">CIrredCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_insol</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146142"><a href="#local-6989586621684146142"><span class="hs-identifier">insol</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146142"><span class="hs-identifier hs-var">insol</span></a><span>
</span><a name="line-2484"></a><span class="hs-identifier">insolubleEqCt</span><span> </span><span class="hs-identifier">_</span><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2485"></a><span>
</span><a name="line-2486"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2487"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#WC"><span class="hs-identifier hs-var">WC</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">wc_simple</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145941"><a href="#local-6989586621684145941"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">wc_impl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145942"><a href="#local-6989586621684145942"><span class="hs-identifier">i</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2488"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;WC&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span>
</span><a name="line-2489"></a><span>        </span><span class="hs-special">[</span><span> </span><a href="TcRnTypes.html#ppr_bag"><span class="hs-identifier hs-var">ppr_bag</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;wc_simple&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684145941"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-2490"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ppr_bag"><span class="hs-identifier hs-var">ppr_bag</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;wc_impl&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684145942"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2491"></a><span>
</span><a name="line-2492"></a><span class="hs-identifier">ppr_bag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="#local-6989586621684145991"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="#local-6989586621684145991"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2493"></a><a name="ppr_bag"><a href="TcRnTypes.html#ppr_bag"><span class="hs-identifier">ppr_bag</span></a></a><span> </span><a name="local-6989586621684146143"><a href="#local-6989586621684146143"><span class="hs-identifier">doc</span></a></a><span> </span><a name="local-6989586621684146144"><a href="#local-6989586621684146144"><span class="hs-identifier">bag</span></a></a><span>
</span><a name="line-2494"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a><span> </span><a href="#local-6989586621684146144"><span class="hs-identifier hs-var">bag</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-2495"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146143"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#equals"><span class="hs-identifier hs-var">equals</span></a><span class="hs-special">)</span><span>
</span><a name="line-2496"></a><span>                       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Bag.html#foldrBag"><span class="hs-identifier hs-var">foldrBag</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><a href="#local-6989586621684146144"><span class="hs-identifier hs-var">bag</span></a><span class="hs-special">)</span><span>
</span><a name="line-2497"></a><span>
</span><a name="line-2498"></a><span class="hs-comment">{- Note [Given insolubles]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (Trac #14325, comment:)
    class (a~b) =&gt; C a b

    foo :: C a c =&gt; a -&gt; c
    foo x = x

    hm3 :: C (f b) b =&gt; b -&gt; f b
    hm3 x = foo x

In the RHS of hm3, from the [G] C (f b) b we get the insoluble
[G] f b ~# b.  Then we also get an unsolved [W] C b (f b).
Residual implication looks like
    forall b. C (f b) b =&gt; [G] f b ~# b
                           [W] C f (f b)

We do /not/ want to set the implication status to IC_Insoluble,
because that'll suppress reports of [W] C b (f b).  But we
may not report the insoluble [G] f b ~# b either (see Note [Given errors]
in TcErrors), so we may fail to report anything at all!  Yikes.

The same applies to Derived constraints that /arise from/ Givens.
E.g.   f :: (C Int [a]) =&gt; blah
where a fundep means we get
       [D] Int ~ [a]
By the same reasoning we must not suppress other errors (Trac #15767)

Bottom line: insolubleWC (called in TcSimplify.setImplicationStatus)
             should ignore givens even if they are insoluble.

Note [Insoluble holes]
~~~~~~~~~~~~~~~~~~~~~~
Hole constraints that ARE NOT treated as truly insoluble:
  a) type holes, arising from PartialTypeSignatures,
  b) &quot;true&quot; expression holes arising from TypedHoles

An &quot;expression hole&quot; or &quot;type hole&quot; constraint isn't really an error
at all; it's a report saying &quot;_ :: Int&quot; here.  But an out-of-scope
variable masquerading as expression holes IS treated as truly
insoluble, so that it trumps other errors during error reporting.
Yuk!

************************************************************************
*                                                                      *
                Implication constraints
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2547"></a><span>
</span><a name="line-2548"></a><span class="hs-keyword">data</span><span> </span><a name="Implication"><a href="TcRnTypes.html#Implication"><span class="hs-identifier">Implication</span></a></a><span>
</span><a name="line-2549"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Implic"><a href="TcRnTypes.html#Implic"><span class="hs-identifier">Implic</span></a></a><span> </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">-- Invariants for a tree of implications:</span><span>
</span><a name="line-2550"></a><span>               </span><span class="hs-comment">-- see TcType Note [TcLevel and untouchable type variables]</span><span>
</span><a name="line-2551"></a><span>
</span><a name="line-2552"></a><span>      </span><a name="ic_tclvl"><a href="TcRnTypes.html#ic_tclvl"><span class="hs-identifier">ic_tclvl</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- TcLevel of unification variables</span><span>
</span><a name="line-2553"></a><span>                                 </span><span class="hs-comment">-- allocated /inside/ this implication</span><span>
</span><a name="line-2554"></a><span>
</span><a name="line-2555"></a><span>      </span><a name="ic_skols"><a href="TcRnTypes.html#ic_skols"><span class="hs-identifier">ic_skols</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Introduced skolems</span><span>
</span><a name="line-2556"></a><span>      </span><a name="ic_info"><a href="TcRnTypes.html#ic_info"><span class="hs-identifier">ic_info</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- See Note [Skolems in an implication]</span><span>
</span><a name="line-2557"></a><span>                                 </span><span class="hs-comment">-- See Note [Shadowing in a constraint]</span><span>
</span><a name="line-2558"></a><span>      </span><a name="ic_telescope"><a href="TcRnTypes.html#ic_telescope"><span class="hs-identifier">ic_telescope</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- User-written telescope, if there is one</span><span>
</span><a name="line-2559"></a><span>                                   </span><span class="hs-comment">-- The list of skolems is order-checked</span><span>
</span><a name="line-2560"></a><span>                                   </span><span class="hs-comment">-- if and only if this is a Just.</span><span>
</span><a name="line-2561"></a><span>                                   </span><span class="hs-comment">-- See Note [Keeping scoped variables in order: Explicit]</span><span>
</span><a name="line-2562"></a><span>                                   </span><span class="hs-comment">-- in TcHsType</span><span>
</span><a name="line-2563"></a><span>
</span><a name="line-2564"></a><span>      </span><a name="ic_given"><a href="TcRnTypes.html#ic_given"><span class="hs-identifier">ic_given</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- Given evidence variables</span><span>
</span><a name="line-2565"></a><span>                                 </span><span class="hs-comment">--   (order does not matter)</span><span>
</span><a name="line-2566"></a><span>                                 </span><span class="hs-comment">-- See Invariant (GivenInv) in TcType</span><span>
</span><a name="line-2567"></a><span>
</span><a name="line-2568"></a><span>      </span><a name="ic_no_eqs"><a href="TcRnTypes.html#ic_no_eqs"><span class="hs-identifier">ic_no_eqs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- True  &lt;=&gt; ic_givens have no equalities, for sure</span><span>
</span><a name="line-2569"></a><span>                                 </span><span class="hs-comment">-- False &lt;=&gt; ic_givens might have equalities</span><span>
</span><a name="line-2570"></a><span>
</span><a name="line-2571"></a><span>      </span><a name="ic_env"><a href="TcRnTypes.html#ic_env"><span class="hs-identifier">ic_env</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Env"><span class="hs-identifier hs-type">Env</span></a><span> </span><a href="TcRnTypes.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-2572"></a><span>                                 </span><span class="hs-comment">-- Records the Env at the time of creation.</span><span>
</span><a name="line-2573"></a><span>                                 </span><span class="hs-comment">--</span><span>
</span><a name="line-2574"></a><span>                                 </span><span class="hs-comment">-- This is primarly needed for the enclosed</span><span>
</span><a name="line-2575"></a><span>                                 </span><span class="hs-comment">-- TcLclEnv, which gives the source location</span><span>
</span><a name="line-2576"></a><span>                                 </span><span class="hs-comment">-- and error context for the implication, and</span><span>
</span><a name="line-2577"></a><span>                                 </span><span class="hs-comment">-- hence for all the given evidence variables.</span><span>
</span><a name="line-2578"></a><span>                                 </span><span class="hs-comment">--</span><span>
</span><a name="line-2579"></a><span>                                 </span><span class="hs-comment">-- The enclosed DynFlags also influences error</span><span>
</span><a name="line-2580"></a><span>                                 </span><span class="hs-comment">-- reporting. See Note [Avoid</span><span>
</span><a name="line-2581"></a><span>                                 </span><span class="hs-comment">-- -Winaccessible-code when deriving] in</span><span>
</span><a name="line-2582"></a><span>                                 </span><span class="hs-comment">-- TcInstDcls.</span><span>
</span><a name="line-2583"></a><span>
</span><a name="line-2584"></a><span>      </span><a name="ic_wanted"><a href="TcRnTypes.html#ic_wanted"><span class="hs-identifier">ic_wanted</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- The wanteds</span><span>
</span><a name="line-2585"></a><span>                                       </span><span class="hs-comment">-- See Invariang (WantedInf) in TcType</span><span>
</span><a name="line-2586"></a><span>
</span><a name="line-2587"></a><span>      </span><a name="ic_binds"><a href="TcRnTypes.html#ic_binds"><span class="hs-identifier">ic_binds</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Points to the place to fill in the</span><span>
</span><a name="line-2588"></a><span>                                  </span><span class="hs-comment">-- abstraction and bindings.</span><span>
</span><a name="line-2589"></a><span>
</span><a name="line-2590"></a><span>      </span><span class="hs-comment">-- The ic_need fields keep track of which Given evidence</span><span>
</span><a name="line-2591"></a><span>      </span><span class="hs-comment">-- is used by this implication or its children</span><span>
</span><a name="line-2592"></a><span>      </span><span class="hs-comment">-- NB: including stuff used by nested implications that have since</span><span>
</span><a name="line-2593"></a><span>      </span><span class="hs-comment">--     been discarded</span><span>
</span><a name="line-2594"></a><span>      </span><a name="ic_need_inner"><a href="TcRnTypes.html#ic_need_inner"><span class="hs-identifier">ic_need_inner</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Includes all used Given evidence</span><span>
</span><a name="line-2595"></a><span>      </span><a name="ic_need_outer"><a href="TcRnTypes.html#ic_need_outer"><span class="hs-identifier">ic_need_outer</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="VarSet.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- Includes only the free Given evidence</span><span>
</span><a name="line-2596"></a><span>                                  </span><span class="hs-comment">--  i.e. ic_need_inner after deleting</span><span>
</span><a name="line-2597"></a><span>                                  </span><span class="hs-comment">--       (a) givens (b) binders of ic_binds</span><span>
</span><a name="line-2598"></a><span>
</span><a name="line-2599"></a><span>      </span><a name="ic_status"><a href="TcRnTypes.html#ic_status"><span class="hs-identifier">ic_status</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ImplicStatus"><span class="hs-identifier hs-type">ImplicStatus</span></a><span>
</span><a name="line-2600"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-2601"></a><span>
</span><a name="line-2602"></a><span class="hs-comment">-- | Create a new 'Implication' with as many sensible defaults for its fields</span><span>
</span><a name="line-2603"></a><span class="hs-comment">-- as possible. Note that the 'ic_tclvl', 'ic_binds', and 'ic_info' fields do</span><span>
</span><a name="line-2604"></a><span class="hs-comment">-- /not/ have sensible defaults, so they are initialized with lazy thunks that</span><span>
</span><a name="line-2605"></a><span class="hs-comment">-- will 'panic' if forced, so one should take care to initialize these fields</span><span>
</span><a name="line-2606"></a><span class="hs-comment">-- after creation.</span><span>
</span><a name="line-2607"></a><span class="hs-comment">--</span><span>
</span><a name="line-2608"></a><span class="hs-comment">-- This is monadic purely to look up the 'Env', which is used to initialize</span><span>
</span><a name="line-2609"></a><span class="hs-comment">-- 'ic_env'.</span><span>
</span><a name="line-2610"></a><span class="hs-identifier">newImplication</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span>
</span><a name="line-2611"></a><a name="newImplication"><a href="TcRnTypes.html#newImplication"><span class="hs-identifier">newImplication</span></a></a><span>
</span><a name="line-2612"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684146145"><a href="#local-6989586621684146145"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a><span>
</span><a name="line-2613"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#implicationPrototype"><span class="hs-identifier hs-var">implicationPrototype</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146145"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2614"></a><span>
</span><a name="line-2615"></a><span class="hs-identifier">implicationPrototype</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span>
</span><a name="line-2616"></a><a name="implicationPrototype"><a href="TcRnTypes.html#implicationPrototype"><span class="hs-identifier">implicationPrototype</span></a></a><span>
</span><a name="line-2617"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Implic"><span class="hs-identifier hs-var">Implic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- These fields must be initialised</span><span>
</span><a name="line-2618"></a><span>              </span><span class="hs-identifier">ic_tclvl</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;newImplic:tclvl&quot;</span><span>
</span><a name="line-2619"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_binds</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;newImplic:binds&quot;</span><span>
</span><a name="line-2620"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_info</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;newImplic:info&quot;</span><span>
</span><a name="line-2621"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_env</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;newImplic:env&quot;</span><span>
</span><a name="line-2622"></a><span>
</span><a name="line-2623"></a><span>              </span><span class="hs-comment">-- The rest have sensible default values</span><span>
</span><a name="line-2624"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_skols</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2625"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_telescope</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2626"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_given</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2627"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_wanted</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a><span>
</span><a name="line-2628"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_no_eqs</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2629"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_status</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#IC_Unsolved"><span class="hs-identifier hs-var">IC_Unsolved</span></a><span>
</span><a name="line-2630"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_need_inner</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-2631"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_need_outer</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2632"></a><span>
</span><a name="line-2633"></a><span class="hs-comment">-- | Retrieve the enclosed 'TcLclEnv' from an 'Implication'.</span><span>
</span><a name="line-2634"></a><span class="hs-identifier">implicLclEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span>
</span><a name="line-2635"></a><a name="implicLclEnv"><a href="TcRnTypes.html#implicLclEnv"><span class="hs-identifier">implicLclEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">env_lcl</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">ic_env</span><span>
</span><a name="line-2636"></a><span>
</span><a name="line-2637"></a><span class="hs-comment">-- | Retrieve the enclosed 'DynFlags' from an 'Implication'.</span><span>
</span><a name="line-2638"></a><span class="hs-identifier">implicDynFlags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-2639"></a><a name="implicDynFlags"><a href="TcRnTypes.html#implicDynFlags"><span class="hs-identifier">implicDynFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">env_top</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">ic_env</span><span>
</span><a name="line-2640"></a><span>
</span><a name="line-2641"></a><span class="hs-keyword">data</span><span> </span><a name="ImplicStatus"><a href="TcRnTypes.html#ImplicStatus"><span class="hs-identifier">ImplicStatus</span></a></a><span>
</span><a name="line-2642"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IC_Solved"><a href="TcRnTypes.html#IC_Solved"><span class="hs-identifier">IC_Solved</span></a></a><span>     </span><span class="hs-comment">-- All wanteds in the tree are solved, all the way down</span><span>
</span><a name="line-2643"></a><span>       </span><span class="hs-special">{</span><span> </span><a name="ics_dead"><a href="TcRnTypes.html#ics_dead"><span class="hs-identifier">ics_dead</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>  </span><span class="hs-comment">-- Subset of ic_given that are not needed</span><span>
</span><a name="line-2644"></a><span>         </span><span class="hs-comment">-- See Note [Tracking redundant constraints] in TcSimplify</span><span>
</span><a name="line-2645"></a><span>
</span><a name="line-2646"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IC_Insoluble"><a href="TcRnTypes.html#IC_Insoluble"><span class="hs-identifier">IC_Insoluble</span></a></a><span>  </span><span class="hs-comment">-- At least one insoluble constraint in the tree</span><span>
</span><a name="line-2647"></a><span>
</span><a name="line-2648"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IC_BadTelescope"><a href="TcRnTypes.html#IC_BadTelescope"><span class="hs-identifier">IC_BadTelescope</span></a></a><span>  </span><span class="hs-comment">-- solved, but the skolems in the telescope are out of</span><span>
</span><a name="line-2649"></a><span>                     </span><span class="hs-comment">-- dependency order</span><span>
</span><a name="line-2650"></a><span>
</span><a name="line-2651"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IC_Unsolved"><a href="TcRnTypes.html#IC_Unsolved"><span class="hs-identifier">IC_Unsolved</span></a></a><span>   </span><span class="hs-comment">-- Neither of the above; might go either way</span><span>
</span><a name="line-2652"></a><span>
</span><a name="line-2653"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2654"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Implic"><span class="hs-identifier hs-var">Implic</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145931"><a href="#local-6989586621684145931"><span class="hs-identifier">tclvl</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_skols</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145932"><a href="#local-6989586621684145932"><span class="hs-identifier">skols</span></a></a><span>
</span><a name="line-2655"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_given</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145933"><a href="#local-6989586621684145933"><span class="hs-identifier">given</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_no_eqs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145934"><a href="#local-6989586621684145934"><span class="hs-identifier">no_eqs</span></a></a><span>
</span><a name="line-2656"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_wanted</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145935"><a href="#local-6989586621684145935"><span class="hs-identifier">wanted</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_status</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145936"><a href="#local-6989586621684145936"><span class="hs-identifier">status</span></a></a><span>
</span><a name="line-2657"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145937"><a href="#local-6989586621684145937"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-2658"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_need_inner</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145938"><a href="#local-6989586621684145938"><span class="hs-identifier">need_in</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_need_outer</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145939"><a href="#local-6989586621684145939"><span class="hs-identifier">need_out</span></a></a><span>
</span><a name="line-2659"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_info</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145940"><a href="#local-6989586621684145940"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2660"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Implic&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#lbrace"><span class="hs-identifier hs-var">lbrace</span></a><span class="hs-special">)</span><span>
</span><a name="line-2661"></a><span>        </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;TcLevel =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145931"><span class="hs-identifier hs-var">tclvl</span></a><span>
</span><a name="line-2662"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Skolems =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a><span> </span><a href="#local-6989586621684145932"><span class="hs-identifier hs-var">skols</span></a><span>
</span><a name="line-2663"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;No-eqs =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145934"><span class="hs-identifier hs-var">no_eqs</span></a><span>
</span><a name="line-2664"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Status =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145936"><span class="hs-identifier hs-var">status</span></a><span>
</span><a name="line-2665"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Given =&quot;</span><span class="hs-special">)</span><span>  </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#pprEvVars"><span class="hs-identifier hs-var">pprEvVars</span></a><span> </span><a href="#local-6989586621684145933"><span class="hs-identifier hs-var">given</span></a><span class="hs-special">)</span><span>
</span><a name="line-2666"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Wanted =&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145935"><span class="hs-identifier hs-var">wanted</span></a><span class="hs-special">)</span><span>
</span><a name="line-2667"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Binds =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145937"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-2668"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#whenPprDebug"><span class="hs-identifier hs-var">whenPprDebug</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Needed inner =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145938"><span class="hs-identifier hs-var">need_in</span></a><span class="hs-special">)</span><span>
</span><a name="line-2669"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#whenPprDebug"><span class="hs-identifier hs-var">whenPprDebug</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Needed outer =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145939"><span class="hs-identifier hs-var">need_out</span></a><span class="hs-special">)</span><span>
</span><a name="line-2670"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#pprSkolInfo"><span class="hs-identifier hs-var">pprSkolInfo</span></a><span> </span><a href="#local-6989586621684145940"><span class="hs-identifier hs-var">info</span></a><span> </span><span class="hs-special">]</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#rbrace"><span class="hs-identifier hs-var">rbrace</span></a><span class="hs-special">)</span><span>
</span><a name="line-2671"></a><span>
</span><a name="line-2672"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#ImplicStatus"><span class="hs-identifier hs-type">ImplicStatus</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2673"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="TcRnTypes.html#IC_Insoluble"><span class="hs-identifier hs-var">IC_Insoluble</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Insoluble&quot;</span><span>
</span><a name="line-2674"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#IC_BadTelescope"><span class="hs-identifier hs-var">IC_BadTelescope</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Bad telescope&quot;</span><span>
</span><a name="line-2675"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#IC_Unsolved"><span class="hs-identifier hs-var">IC_Unsolved</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Unsolved&quot;</span><span>
</span><a name="line-2676"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#IC_Solved"><span class="hs-identifier hs-var">IC_Solved</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ics_dead</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145930"><a href="#local-6989586621684145930"><span class="hs-identifier">dead</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2677"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Solved&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Dead givens =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145930"><span class="hs-identifier hs-var">dead</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2678"></a><span>
</span><a name="line-2679"></a><span class="hs-comment">{-
Note [Needed evidence variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Th ic_need_evs field holds the free vars of ic_binds, and all the
ic_binds in nested implications.

  * Main purpose: if one of the ic_givens is not mentioned in here, it
    is redundant.

  * solveImplication may drop an implication altogether if it has no
    remaining 'wanteds'. But we still track the free vars of its
    evidence binds, even though it has now disappeared.

Note [Shadowing in a constraint]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We assume NO SHADOWING in a constraint.  Specifically
 * The unification variables are all implicitly quantified at top
   level, and are all unique
 * The skolem variables bound in ic_skols are all freah when the
   implication is created.
So we can safely substitute. For example, if we have
   forall a.  a~Int =&gt; ...(forall b. ...a...)...
we can push the (a~Int) constraint inwards in the &quot;givens&quot; without
worrying that 'b' might clash.

Note [Skolems in an implication]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The skolems in an implication are not there to perform a skolem escape
check.  That happens because all the environment variables are in the
untouchables, and therefore cannot be unified with anything at all,
let alone the skolems.

Instead, ic_skols is used only when considering floating a constraint
outside the implication in TcSimplify.floatEqualities or
TcSimplify.approximateImplications

Note [Insoluble constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Some of the errors that we get during canonicalization are best
reported when all constraints have been simplified as much as
possible. For instance, assume that during simplification the
following constraints arise:

 [Wanted]   F alpha ~  uf1
 [Wanted]   beta ~ uf1 beta

When canonicalizing the wanted (beta ~ uf1 beta), if we eagerly fail
we will simply see a message:
    'Can't construct the infinite type  beta ~ uf1 beta'
and the user has no idea what the uf1 variable is.

Instead our plan is that we will NOT fail immediately, but:
    (1) Record the &quot;frozen&quot; error in the ic_insols field
    (2) Isolate the offending constraint from the rest of the inerts
    (3) Keep on simplifying/canonicalizing

At the end, we will hopefully have substituted uf1 := F alpha, and we
will be able to report a more informative error:
    'Can't construct the infinite type beta ~ F alpha beta'

Insoluble constraints *do* include Derived constraints. For example,
a functional dependency might give rise to [D] Int ~ Bool, and we must
report that.  If insolubles did not contain Deriveds, reportErrors would
never see it.


************************************************************************
*                                                                      *
            Pretty printing
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2751"></a><span>
</span><a name="line-2752"></a><span class="hs-identifier">pprEvVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>    </span><span class="hs-comment">-- Print with their types</span><span>
</span><a name="line-2753"></a><a name="pprEvVars"><a href="TcRnTypes.html#pprEvVars"><span class="hs-identifier">pprEvVars</span></a></a><span> </span><a name="local-6989586621684146146"><a href="#local-6989586621684146146"><span class="hs-identifier">ev_vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="TcRnTypes.html#pprEvVarWithType"><span class="hs-identifier hs-var">pprEvVarWithType</span></a><span> </span><a href="#local-6989586621684146146"><span class="hs-identifier hs-var">ev_vars</span></a><span class="hs-special">)</span><span>
</span><a name="line-2754"></a><span>
</span><a name="line-2755"></a><span class="hs-identifier">pprEvVarTheta</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2756"></a><a name="pprEvVarTheta"><a href="TcRnTypes.html#pprEvVarTheta"><span class="hs-identifier">pprEvVarTheta</span></a></a><span> </span><a name="local-6989586621684146147"><a href="#local-6989586621684146147"><span class="hs-identifier">ev_vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#pprTheta"><span class="hs-identifier hs-var">pprTheta</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="TcType.html#evVarPred"><span class="hs-identifier hs-var">evVarPred</span></a><span> </span><a href="#local-6989586621684146147"><span class="hs-identifier hs-var">ev_vars</span></a><span class="hs-special">)</span><span>
</span><a name="line-2757"></a><span>
</span><a name="line-2758"></a><span class="hs-identifier">pprEvVarWithType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-2759"></a><a name="pprEvVarWithType"><a href="TcRnTypes.html#pprEvVarWithType"><span class="hs-identifier">pprEvVarWithType</span></a></a><span> </span><a name="local-6989586621684146148"><a href="#local-6989586621684146148"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146148"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span> </span><span class="hs-special">(</span><a href="TcType.html#evVarPred"><span class="hs-identifier hs-var">evVarPred</span></a><span> </span><a href="#local-6989586621684146148"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-2760"></a><span>
</span><a name="line-2761"></a><span>
</span><a name="line-2762"></a><span>
</span><a name="line-2763"></a><span class="hs-comment">-- | Wraps the given type with the constraints (via ic_given) in the given</span><span>
</span><a name="line-2764"></a><span class="hs-comment">-- implication, according to the variables mentioned (via ic_skols)</span><span>
</span><a name="line-2765"></a><span class="hs-comment">-- in the implication, but taking care to only wrap those variables</span><span>
</span><a name="line-2766"></a><span class="hs-comment">-- that are mentioned in the type or the implication.</span><span>
</span><a name="line-2767"></a><span class="hs-identifier">wrapTypeWithImplication</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#Implication"><span class="hs-identifier hs-type">Implication</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2768"></a><a name="wrapTypeWithImplication"><a href="TcRnTypes.html#wrapTypeWithImplication"><span class="hs-identifier">wrapTypeWithImplication</span></a></a><span> </span><a name="local-6989586621684146149"><a href="#local-6989586621684146149"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621684146150"><a href="#local-6989586621684146150"><span class="hs-identifier">impl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#wrapType"><span class="hs-identifier hs-var">wrapType</span></a><span> </span><a href="#local-6989586621684146149"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621684146154"><span class="hs-identifier hs-var">mentioned_skols</span></a><span> </span><a href="#local-6989586621684146151"><span class="hs-identifier hs-var">givens</span></a><span>
</span><a name="line-2769"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684146151"><a href="#local-6989586621684146151"><span class="hs-identifier">givens</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">ic_given</span><span> </span><a href="#local-6989586621684146150"><span class="hs-identifier hs-var">impl</span></a><span>
</span><a name="line-2770"></a><span>          </span><a name="local-6989586621684146152"><a href="#local-6989586621684146152"><span class="hs-identifier">skols</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_skols</span><span> </span><a href="#local-6989586621684146150"><span class="hs-identifier hs-var">impl</span></a><span>
</span><a name="line-2771"></a><span>          </span><a name="local-6989586621684146153"><a href="#local-6989586621684146153"><span class="hs-identifier">freeVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FV.html#fvVarSet"><span class="hs-identifier hs-var">fvVarSet</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TyCoRep.html#tyCoFVsOfTypes"><span class="hs-identifier hs-var">tyCoFVsOfTypes</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146149"><span class="hs-identifier hs-var">ty</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684146151"><span class="hs-identifier hs-var">givens</span></a><span class="hs-special">)</span><span>
</span><a name="line-2772"></a><span>          </span><a name="local-6989586621684146154"><a href="#local-6989586621684146154"><span class="hs-identifier">mentioned_skols</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><a href="VarSet.html#elemVarSet"><span class="hs-identifier hs-var">elemVarSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146153"><span class="hs-identifier hs-var">freeVars</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684146152"><span class="hs-identifier hs-var">skols</span></a><span>
</span><a name="line-2773"></a><span>
</span><a name="line-2774"></a><span class="hs-identifier">wrapType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-2775"></a><a name="wrapType"><a href="TcRnTypes.html#wrapType"><span class="hs-identifier">wrapType</span></a></a><span> </span><a name="local-6989586621684146155"><a href="#local-6989586621684146155"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621684146156"><a href="#local-6989586621684146156"><span class="hs-identifier">skols</span></a></a><span> </span><a name="local-6989586621684146157"><a href="#local-6989586621684146157"><span class="hs-identifier">givens</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a><span> </span><a href="#local-6989586621684146156"><span class="hs-identifier hs-var">skols</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TyCoRep.html#mkFunTys"><span class="hs-identifier hs-var">mkFunTys</span></a><span> </span><a href="#local-6989586621684146157"><span class="hs-identifier hs-var">givens</span></a><span> </span><a href="#local-6989586621684146155"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2776"></a><span>
</span><a name="line-2777"></a><span>
</span><a name="line-2778"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
            CtEvidence
*                                                                      *
************************************************************************

Note [Evidence field of CtEvidence]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
During constraint solving we never look at the type of ctev_evar/ctev_dest;
instead we look at the ctev_pred field.  The evtm/evar field
may be un-zonked.

Note [Bind new Givens immediately]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For Givens we make new EvVars and bind them immediately. Two main reasons:
  * Gain sharing.  E.g. suppose we start with g :: C a b, where
       class D a =&gt; C a b
       class (E a, F a) =&gt; D a
    If we generate all g's superclasses as separate EvTerms we might
    get    selD1 (selC1 g) :: E a
           selD2 (selC1 g) :: F a
           selC1 g :: D a
    which we could do more economically as:
           g1 :: D a = selC1 g
           g2 :: E a = selD1 g1
           g3 :: F a = selD2 g1

  * For *coercion* evidence we *must* bind each given:
      class (a~b) =&gt; C a b where ....
      f :: C a b =&gt; ....
    Then in f's Givens we have g:(C a b) and the superclass sc(g,0):a~b.
    But that superclass selector can't (yet) appear in a coercion
    (see evTermCoercion), so the easy thing is to bind it to an Id.

So a Given has EvVar inside it rather than (as previously) an EvTerm.

-}</span><span>
</span><a name="line-2816"></a><span>
</span><a name="line-2817"></a><span class="hs-comment">-- | A place for type-checking evidence to go after it is generated.</span><span>
</span><a name="line-2818"></a><span class="hs-comment">-- Wanted equalities are always HoleDest; other wanteds are always</span><span>
</span><a name="line-2819"></a><span class="hs-comment">-- EvVarDest.</span><span>
</span><a name="line-2820"></a><span class="hs-keyword">data</span><span> </span><a name="TcEvDest"><a href="TcRnTypes.html#TcEvDest"><span class="hs-identifier">TcEvDest</span></a></a><span>
</span><a name="line-2821"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="EvVarDest"><a href="TcRnTypes.html#EvVarDest"><span class="hs-identifier">EvVarDest</span></a></a><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>         </span><span class="hs-comment">-- ^ bind this var to the evidence</span><span>
</span><a name="line-2822"></a><span>              </span><span class="hs-comment">-- EvVarDest is always used for non-type-equalities</span><span>
</span><a name="line-2823"></a><span>              </span><span class="hs-comment">-- e.g. class constraints</span><span>
</span><a name="line-2824"></a><span>
</span><a name="line-2825"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HoleDest"><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier">HoleDest</span></a></a><span>  </span><a href="TyCoRep.html#CoercionHole"><span class="hs-identifier hs-type">CoercionHole</span></a><span>  </span><span class="hs-comment">-- ^ fill in this hole with the evidence</span><span>
</span><a name="line-2826"></a><span>              </span><span class="hs-comment">-- HoleDest is always used for type-equalities</span><span>
</span><a name="line-2827"></a><span>              </span><span class="hs-comment">-- See Note [Coercion holes] in TyCoRep</span><span>
</span><a name="line-2828"></a><span>
</span><a name="line-2829"></a><span class="hs-keyword">data</span><span> </span><a name="CtEvidence"><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier">CtEvidence</span></a></a><span>
</span><a name="line-2830"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="CtGiven"><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier">CtGiven</span></a></a><span>    </span><span class="hs-comment">-- Truly given, not depending on subgoals</span><span>
</span><a name="line-2831"></a><span>      </span><span class="hs-special">{</span><span> </span><a name="ctev_pred"><a href="TcRnTypes.html#ctev_pred"><span class="hs-identifier">ctev_pred</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span>      </span><span class="hs-comment">-- See Note [Ct/evidence invariant]</span><span>
</span><a name="line-2832"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="ctev_evar"><a href="TcRnTypes.html#ctev_evar"><span class="hs-identifier">ctev_evar</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>           </span><span class="hs-comment">-- See Note [Evidence field of CtEvidence]</span><span>
</span><a name="line-2833"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="ctev_loc"><a href="TcRnTypes.html#ctev_loc"><span class="hs-identifier">ctev_loc</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2834"></a><span>
</span><a name="line-2835"></a><span>
</span><a name="line-2836"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CtWanted"><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier">CtWanted</span></a></a><span>   </span><span class="hs-comment">-- Wanted goal</span><span>
</span><a name="line-2837"></a><span>      </span><span class="hs-special">{</span><span> </span><a name="ctev_pred"><a href="TcRnTypes.html#ctev_pred"><span class="hs-identifier">ctev_pred</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span>     </span><span class="hs-comment">-- See Note [Ct/evidence invariant]</span><span>
</span><a name="line-2838"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="ctev_dest"><a href="TcRnTypes.html#ctev_dest"><span class="hs-identifier">ctev_dest</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcEvDest"><span class="hs-identifier hs-type">TcEvDest</span></a><span>
</span><a name="line-2839"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="ctev_nosh"><a href="TcRnTypes.html#ctev_nosh"><span class="hs-identifier">ctev_nosh</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ShadowInfo"><span class="hs-identifier hs-type">ShadowInfo</span></a><span>     </span><span class="hs-comment">-- See Note [Constraint flavours]</span><span>
</span><a name="line-2840"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="ctev_loc"><a href="TcRnTypes.html#ctev_loc"><span class="hs-identifier">ctev_loc</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2841"></a><span>
</span><a name="line-2842"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="CtDerived"><a href="TcRnTypes.html#CtDerived"><span class="hs-identifier">CtDerived</span></a></a><span>  </span><span class="hs-comment">-- A goal that we don't really have to solve and can't</span><span>
</span><a name="line-2843"></a><span>               </span><span class="hs-comment">-- immediately rewrite anything other than a derived</span><span>
</span><a name="line-2844"></a><span>               </span><span class="hs-comment">-- (there's no evidence!) but if we do manage to solve</span><span>
</span><a name="line-2845"></a><span>               </span><span class="hs-comment">-- it may help in solving other goals.</span><span>
</span><a name="line-2846"></a><span>      </span><span class="hs-special">{</span><span> </span><a name="ctev_pred"><a href="TcRnTypes.html#ctev_pred"><span class="hs-identifier">ctev_pred</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span>
</span><a name="line-2847"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="ctev_loc"><a href="TcRnTypes.html#ctev_loc"><span class="hs-identifier">ctev_loc</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2848"></a><span>
</span><a name="line-2849"></a><span class="hs-identifier">ctEvPred</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a><span>
</span><a name="line-2850"></a><span class="hs-comment">-- The predicate of a flavor</span><span>
</span><a name="line-2851"></a><a name="ctEvPred"><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier">ctEvPred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctev_pred</span><span>
</span><a name="line-2852"></a><span>
</span><a name="line-2853"></a><span class="hs-identifier">ctEvLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-2854"></a><a name="ctEvLoc"><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier">ctEvLoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctev_loc</span><span>
</span><a name="line-2855"></a><span>
</span><a name="line-2856"></a><span class="hs-identifier">ctEvOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-2857"></a><a name="ctEvOrigin"><a href="TcRnTypes.html#ctEvOrigin"><span class="hs-identifier">ctEvOrigin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a><span>
</span><a name="line-2858"></a><span>
</span><a name="line-2859"></a><span class="hs-comment">-- | Get the equality relation relevant for a 'CtEvidence'</span><span>
</span><a name="line-2860"></a><span class="hs-identifier">ctEvEqRel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span>
</span><a name="line-2861"></a><a name="ctEvEqRel"><a href="TcRnTypes.html#ctEvEqRel"><span class="hs-identifier">ctEvEqRel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#predTypeEqRel"><span class="hs-identifier hs-var">predTypeEqRel</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span>
</span><a name="line-2862"></a><span>
</span><a name="line-2863"></a><span class="hs-comment">-- | Get the role relevant for a 'CtEvidence'</span><span>
</span><a name="line-2864"></a><span class="hs-identifier">ctEvRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#Role"><span class="hs-identifier hs-type">Role</span></a><span>
</span><a name="line-2865"></a><a name="ctEvRole"><a href="TcRnTypes.html#ctEvRole"><span class="hs-identifier">ctEvRole</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Type.html#eqRelRole"><span class="hs-identifier hs-var">eqRelRole</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="TcRnTypes.html#ctEvEqRel"><span class="hs-identifier hs-var">ctEvEqRel</span></a><span>
</span><a name="line-2866"></a><span>
</span><a name="line-2867"></a><span class="hs-identifier">ctEvTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEvidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a><span>
</span><a name="line-2868"></a><a name="ctEvTerm"><a href="TcRnTypes.html#ctEvTerm"><span class="hs-identifier">ctEvTerm</span></a></a><span> </span><a name="local-6989586621684146158"><a href="#local-6989586621684146158"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcEvidence.html#EvExpr"><span class="hs-identifier hs-var">EvExpr</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvExpr"><span class="hs-identifier hs-var">ctEvExpr</span></a><span> </span><a href="#local-6989586621684146158"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-2869"></a><span>
</span><a name="line-2870"></a><span class="hs-identifier">ctEvExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEvidence.html#EvExpr"><span class="hs-identifier hs-type">EvExpr</span></a><span>
</span><a name="line-2871"></a><a name="ctEvExpr"><a href="TcRnTypes.html#ctEvExpr"><span class="hs-identifier">ctEvExpr</span></a></a><span> </span><a name="local-6989586621684146159"><a href="#local-6989586621684146159"><span class="hs-identifier">ev</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2872"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#Coercion"><span class="hs-identifier hs-var">Coercion</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcRnTypes.html#ctEvCoercion"><span class="hs-identifier hs-var">ctEvCoercion</span></a><span> </span><a href="#local-6989586621684146159"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-2873"></a><span class="hs-identifier">ctEvExpr</span><span> </span><a name="local-6989586621684146160"><a href="#local-6989586621684146160"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcEvidence.html#evId"><span class="hs-identifier hs-var">evId</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvEvId"><span class="hs-identifier hs-var">ctEvEvId</span></a><span> </span><a href="#local-6989586621684146160"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-2874"></a><span>
</span><a name="line-2875"></a><span class="hs-identifier">ctEvCoercion</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Util.html#HasDebugCallStack"><span class="hs-identifier hs-type">HasDebugCallStack</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#Coercion"><span class="hs-identifier hs-type">Coercion</span></a><span>
</span><a name="line-2876"></a><a name="ctEvCoercion"><a href="TcRnTypes.html#ctEvCoercion"><span class="hs-identifier">ctEvCoercion</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_evar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146161"><a href="#local-6989586621684146161"><span class="hs-identifier">ev_id</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2877"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcEvidence.html#mkTcCoVarCo"><span class="hs-identifier hs-var">mkTcCoVarCo</span></a><span> </span><a href="#local-6989586621684146161"><span class="hs-identifier hs-var">ev_id</span></a><span>
</span><a name="line-2878"></a><span class="hs-identifier">ctEvCoercion</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146162"><a href="#local-6989586621684146162"><span class="hs-identifier">dest</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2879"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span> </span><a name="local-6989586621684146163"><a href="#local-6989586621684146163"><span class="hs-identifier">hole</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684146162"><span class="hs-identifier hs-var">dest</span></a><span>
</span><a name="line-2880"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- ctEvCoercion is only called on type equalities</span><span>
</span><a name="line-2881"></a><span>    </span><span class="hs-comment">-- and they always have HoleDests</span><span>
</span><a name="line-2882"></a><span>    </span><a href="Coercion.html#mkHoleCo"><span class="hs-identifier hs-var">mkHoleCo</span></a><span> </span><a href="#local-6989586621684146163"><span class="hs-identifier hs-var">hole</span></a><span>
</span><a name="line-2883"></a><span class="hs-identifier">ctEvCoercion</span><span> </span><a name="local-6989586621684146164"><a href="#local-6989586621684146164"><span class="hs-identifier">ev</span></a></a><span>
</span><a name="line-2884"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;ctEvCoercion&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146164"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-2885"></a><span>
</span><a name="line-2886"></a><span class="hs-identifier">ctEvEvId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a><span>
</span><a name="line-2887"></a><a name="ctEvEvId"><a href="TcRnTypes.html#ctEvEvId"><span class="hs-identifier">ctEvEvId</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a><span> </span><a name="local-6989586621684146165"><a href="#local-6989586621684146165"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146165"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-2888"></a><span class="hs-identifier">ctEvEvId</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span> </span><a name="local-6989586621684146166"><a href="#local-6989586621684146166"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#coHoleCoVar"><span class="hs-identifier hs-var">coHoleCoVar</span></a><span> </span><a href="#local-6989586621684146166"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-2889"></a><span class="hs-identifier">ctEvEvId</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_evar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146167"><a href="#local-6989586621684146167"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146167"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-2890"></a><span class="hs-identifier">ctEvEvId</span><span> </span><a name="local-6989586621684146168"><a href="#local-6989586621684146168"><span class="hs-identifier">ctev</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtDerived"><span class="hs-identifier hs-var">CtDerived</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;ctEvId:&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146168"><span class="hs-identifier hs-var">ctev</span></a><span class="hs-special">)</span><span>
</span><a name="line-2891"></a><span>
</span><a name="line-2892"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#TcEvDest"><span class="hs-identifier hs-type">TcEvDest</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2893"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#HoleDest"><span class="hs-identifier hs-var">HoleDest</span></a><span> </span><a name="local-6989586621684145928"><a href="#local-6989586621684145928"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;hole&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145928"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-2894"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#EvVarDest"><span class="hs-identifier hs-var">EvVarDest</span></a><span> </span><a name="local-6989586621684145929"><a href="#local-6989586621684145929"><span class="hs-identifier">ev</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145929"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-2895"></a><span>
</span><a name="line-2896"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2897"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621684145924"><a href="#local-6989586621684145924"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><a href="#local-6989586621684145924"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-2898"></a><span>           </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="#local-6989586621684145925"><span class="hs-identifier hs-var">pp_ev</span></a><span>
</span><a name="line-2899"></a><span>           </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#braces"><span class="hs-identifier hs-var">braces</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ctl_depth</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvLoc"><span class="hs-identifier hs-var">ctEvLoc</span></a><span> </span><a href="#local-6989586621684145924"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span>
</span><a name="line-2900"></a><span>                  </span><span class="hs-comment">-- Show the sub-goal depth too</span><span>
</span><a name="line-2901"></a><span>           </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvPred"><span class="hs-identifier hs-var">ctEvPred</span></a><span> </span><a href="#local-6989586621684145924"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-2902"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-2903"></a><span>      </span><a name="local-6989586621684145925"><a href="#local-6989586621684145925"><span class="hs-identifier">pp_ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684145924"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2904"></a><span>             </span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_evar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145926"><a href="#local-6989586621684145926"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145926"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-2905"></a><span>             </span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">ctev_dest</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684145927"><a href="#local-6989586621684145927"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684145927"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-2906"></a><span>             </span><a href="TcRnTypes.html#CtDerived"><span class="hs-identifier hs-var">CtDerived</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;_&quot;</span><span>
</span><a name="line-2907"></a><span>
</span><a name="line-2908"></a><span class="hs-identifier">isWanted</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2909"></a><a name="isWanted"><a href="TcRnTypes.html#isWanted"><span class="hs-identifier">isWanted</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2910"></a><span class="hs-identifier">isWanted</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2911"></a><span>
</span><a name="line-2912"></a><span class="hs-identifier">isGiven</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2913"></a><a name="isGiven"><a href="TcRnTypes.html#isGiven"><span class="hs-identifier">isGiven</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2914"></a><span class="hs-identifier">isGiven</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2915"></a><span>
</span><a name="line-2916"></a><span class="hs-identifier">isDerived</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2917"></a><a name="isDerived"><a href="TcRnTypes.html#isDerived"><span class="hs-identifier">isDerived</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtDerived"><span class="hs-identifier hs-var">CtDerived</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2918"></a><span class="hs-identifier">isDerived</span><span> </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2919"></a><span>
</span><a name="line-2920"></a><span class="hs-comment">{-
%************************************************************************
%*                                                                      *
            CtFlavour
%*                                                                      *
%************************************************************************

Note [Constraint flavours]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Constraints come in four flavours:

* [G] Given: we have evidence

* [W] Wanted WOnly: we want evidence

* [D] Derived: any solution must satisfy this constraint, but
      we don't need evidence for it.  Examples include:
        - superclasses of [W] class constraints
        - equalities arising from functional dependencies
          or injectivity

* [WD] Wanted WDeriv: a single constraint that represents
                      both [W] and [D]
  We keep them paired as one both for efficiency, and because
  when we have a finite map  F tys -&gt; CFunEqCan, it's inconvenient
  to have two CFunEqCans in the range

The ctev_nosh field of a Wanted distinguishes between [W] and [WD]

Wanted constraints are born as [WD], but are split into [W] and its
&quot;shadow&quot; [D] in TcSMonad.maybeEmitShadow.

See Note [The improvement story and derived shadows] in TcSMonad
-}</span><span>
</span><a name="line-2954"></a><span>
</span><a name="line-2955"></a><span class="hs-keyword">data</span><span> </span><a name="CtFlavour"><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier">CtFlavour</span></a></a><span>  </span><span class="hs-comment">-- See Note [Constraint flavours]</span><span>
</span><a name="line-2956"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Given"><a href="TcRnTypes.html#Given"><span class="hs-identifier">Given</span></a></a><span>
</span><a name="line-2957"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Wanted"><a href="TcRnTypes.html#Wanted"><span class="hs-identifier">Wanted</span></a></a><span> </span><a href="TcRnTypes.html#ShadowInfo"><span class="hs-identifier hs-type">ShadowInfo</span></a><span>
</span><a name="line-2958"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Derived"><a href="TcRnTypes.html#Derived"><span class="hs-identifier">Derived</span></a></a><span>
</span><a name="line-2959"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>
</span><a name="line-2960"></a><span>
</span><a name="line-2961"></a><span class="hs-keyword">data</span><span> </span><a name="ShadowInfo"><a href="TcRnTypes.html#ShadowInfo"><span class="hs-identifier">ShadowInfo</span></a></a><span>
</span><a name="line-2962"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="WDeriv"><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier">WDeriv</span></a></a><span>   </span><span class="hs-comment">-- [WD] This Wanted constraint has no Derived shadow,</span><span>
</span><a name="line-2963"></a><span>             </span><span class="hs-comment">-- so it behaves like a pair of a Wanted and a Derived</span><span>
</span><a name="line-2964"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="WOnly"><a href="TcRnTypes.html#WOnly"><span class="hs-identifier">WOnly</span></a></a><span>    </span><span class="hs-comment">-- [W] It has a separate derived shadow</span><span>
</span><a name="line-2965"></a><span>             </span><span class="hs-comment">-- See Note [Derived shadows]</span><span>
</span><a name="line-2966"></a><span>  </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2967"></a><span>
</span><a name="line-2968"></a><span class="hs-identifier">isGivenOrWDeriv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2969"></a><a name="isGivenOrWDeriv"><a href="TcRnTypes.html#isGivenOrWDeriv"><span class="hs-identifier">isGivenOrWDeriv</span></a></a><span> </span><a href="TcRnTypes.html#Given"><span class="hs-identifier hs-var">Given</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2970"></a><span class="hs-identifier">isGivenOrWDeriv</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2971"></a><span class="hs-identifier">isGivenOrWDeriv</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2972"></a><span>
</span><a name="line-2973"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2974"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="TcRnTypes.html#Given"><span class="hs-identifier hs-var">Given</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;[G]&quot;</span><span>
</span><a name="line-2975"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;[WD]&quot;</span><span>
</span><a name="line-2976"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WOnly"><span class="hs-identifier hs-var">WOnly</span></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;[W]&quot;</span><span>
</span><a name="line-2977"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;[D]&quot;</span><span>
</span><a name="line-2978"></a><span>
</span><a name="line-2979"></a><span class="hs-identifier">ctEvFlavour</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span>
</span><a name="line-2980"></a><a name="ctEvFlavour"><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier">ctEvFlavour</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtWanted"><span class="hs-identifier hs-var">CtWanted</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctev_nosh</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146169"><a href="#local-6989586621684146169"><span class="hs-identifier">nosh</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="#local-6989586621684146169"><span class="hs-identifier hs-var">nosh</span></a><span>
</span><a name="line-2981"></a><span class="hs-identifier">ctEvFlavour</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtGiven"><span class="hs-identifier hs-var">CtGiven</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Given"><span class="hs-identifier hs-var">Given</span></a><span>
</span><a name="line-2982"></a><span class="hs-identifier">ctEvFlavour</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtDerived"><span class="hs-identifier hs-var">CtDerived</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span>
</span><a name="line-2983"></a><span>
</span><a name="line-2984"></a><span class="hs-comment">-- | Whether or not one 'Ct' can rewrite another is determined by its</span><span>
</span><a name="line-2985"></a><span class="hs-comment">-- flavour and its equality relation. See also</span><span>
</span><a name="line-2986"></a><span class="hs-comment">-- Note [Flavours with roles] in TcSMonad</span><span>
</span><a name="line-2987"></a><span class="hs-keyword">type</span><span> </span><a name="CtFlavourRole"><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier">CtFlavourRole</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span class="hs-special">)</span><span>
</span><a name="line-2988"></a><span>
</span><a name="line-2989"></a><span class="hs-comment">-- | Extract the flavour, role, and boxity from a 'CtEvidence'</span><span>
</span><a name="line-2990"></a><span class="hs-identifier">ctEvFlavourRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a><span>
</span><a name="line-2991"></a><a name="ctEvFlavourRole"><a href="TcRnTypes.html#ctEvFlavourRole"><span class="hs-identifier">ctEvFlavourRole</span></a></a><span> </span><a name="local-6989586621684146170"><a href="#local-6989586621684146170"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><a href="#local-6989586621684146170"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#ctEvEqRel"><span class="hs-identifier hs-var">ctEvEqRel</span></a><span> </span><a href="#local-6989586621684146170"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-2992"></a><span>
</span><a name="line-2993"></a><span class="hs-comment">-- | Extract the flavour and role from a 'Ct'</span><span>
</span><a name="line-2994"></a><span class="hs-identifier">ctFlavourRole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a><span>
</span><a name="line-2995"></a><span class="hs-comment">-- Uses short-cuts to role for special cases</span><span>
</span><a name="line-2996"></a><a name="ctFlavourRole"><a href="TcRnTypes.html#ctFlavourRole"><span class="hs-identifier">ctFlavourRole</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CDictCan"><span class="hs-identifier hs-var">CDictCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146171"><a href="#local-6989586621684146171"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2997"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><a href="#local-6989586621684146171"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span>
</span><a name="line-2998"></a><span class="hs-identifier">ctFlavourRole</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CTyEqCan"><span class="hs-identifier hs-var">CTyEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146172"><a href="#local-6989586621684146172"><span class="hs-identifier">ev</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">cc_eq_rel</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146173"><a href="#local-6989586621684146173"><span class="hs-identifier">eq_rel</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2999"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><a href="#local-6989586621684146172"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684146173"><span class="hs-identifier hs-var">eq_rel</span></a><span class="hs-special">)</span><span>
</span><a name="line-3000"></a><span class="hs-identifier">ctFlavourRole</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CFunEqCan"><span class="hs-identifier hs-var">CFunEqCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146174"><a href="#local-6989586621684146174"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-3001"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><a href="#local-6989586621684146174"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span>
</span><a name="line-3002"></a><span class="hs-identifier">ctFlavourRole</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CHoleCan"><span class="hs-identifier hs-var">CHoleCan</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cc_ev</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146175"><a href="#local-6989586621684146175"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-3003"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><a href="#local-6989586621684146175"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- NomEq: CHoleCans can be rewritten by</span><span>
</span><a name="line-3004"></a><span>                             </span><span class="hs-comment">-- by nominal equalities but empahatically</span><span>
</span><a name="line-3005"></a><span>                             </span><span class="hs-comment">-- not by representational equalities</span><span>
</span><a name="line-3006"></a><span class="hs-identifier">ctFlavourRole</span><span> </span><a name="local-6989586621684146176"><a href="#local-6989586621684146176"><span class="hs-identifier">ct</span></a></a><span>
</span><a name="line-3007"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctEvFlavourRole"><span class="hs-identifier hs-var">ctEvFlavourRole</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvidence"><span class="hs-identifier hs-var">ctEvidence</span></a><span> </span><a href="#local-6989586621684146176"><span class="hs-identifier hs-var">ct</span></a><span class="hs-special">)</span><span>
</span><a name="line-3008"></a><span>
</span><a name="line-3009"></a><span class="hs-comment">{- Note [eqCanRewrite]
~~~~~~~~~~~~~~~~~~~~~~
(eqCanRewrite ct1 ct2) holds if the constraint ct1 (a CTyEqCan of form
tv ~ ty) can be used to rewrite ct2.  It must satisfy the properties of
a can-rewrite relation, see Definition [Can-rewrite relation] in
TcSMonad.

With the solver handling Coercible constraints like equality constraints,
the rewrite conditions must take role into account, never allowing
a representational equality to rewrite a nominal one.

Note [Wanteds do not rewrite Wanteds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We don't allow Wanteds to rewrite Wanteds, because that can give rise
to very confusing type error messages.  A good example is Trac #8450.
Here's another
   f :: a -&gt; Bool
   f x = ( [x,'c'], [x,True] ) `seq` True
Here we get
  [W] a ~ Char
  [W] a ~ Bool
but we do not want to complain about Bool ~ Char!

Note [Deriveds do rewrite Deriveds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
However we DO allow Deriveds to rewrite Deriveds, because that's how
improvement works; see Note [The improvement story] in TcInteract.

However, for now at least I'm only letting (Derived,NomEq) rewrite
(Derived,NomEq) and not doing anything for ReprEq.  If we have
    eqCanRewriteFR (Derived, NomEq) (Derived, _)  = True
then we lose property R2 of Definition [Can-rewrite relation]
in TcSMonad
  R2.  If f1 &gt;= f, and f2 &gt;= f,
       then either f1 &gt;= f2 or f2 &gt;= f1
Consider f1 = (Given, ReprEq)
         f2 = (Derived, NomEq)
          f = (Derived, ReprEq)

I thought maybe we could never get Derived ReprEq constraints, but
we can; straight from the Wanteds during improvement. And from a Derived
ReprEq we could conceivably get a Derived NomEq improvement (by decomposing
a type constructor with Nomninal role), and hence unify.
-}</span><span>
</span><a name="line-3053"></a><span>
</span><a name="line-3054"></a><span class="hs-identifier">eqCanRewrite</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Type.html#EqRel"><span class="hs-identifier hs-type">EqRel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3055"></a><a name="eqCanRewrite"><a href="TcRnTypes.html#eqCanRewrite"><span class="hs-identifier">eqCanRewrite</span></a></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>  </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3056"></a><span class="hs-identifier">eqCanRewrite</span><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3057"></a><span class="hs-identifier">eqCanRewrite</span><span> </span><a href="Type.html#ReprEq"><span class="hs-identifier hs-var">ReprEq</span></a><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-3058"></a><span>
</span><a name="line-3059"></a><span class="hs-identifier">eqCanRewriteFR</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3060"></a><span class="hs-comment">-- Can fr1 actually rewrite fr2?</span><span>
</span><a name="line-3061"></a><span class="hs-comment">-- Very important function!</span><span>
</span><a name="line-3062"></a><span class="hs-comment">-- See Note [eqCanRewrite]</span><span>
</span><a name="line-3063"></a><span class="hs-comment">-- See Note [Wanteds do not rewrite Wanteds]</span><span>
</span><a name="line-3064"></a><span class="hs-comment">-- See Note [Deriveds do rewrite Deriveds]</span><span>
</span><a name="line-3065"></a><a name="eqCanRewriteFR"><a href="TcRnTypes.html#eqCanRewriteFR"><span class="hs-identifier">eqCanRewriteFR</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Given"><span class="hs-identifier hs-var">Given</span></a><span class="hs-special">,</span><span>         </span><a name="local-6989586621684146177"><a href="#local-6989586621684146177"><span class="hs-identifier">r1</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>       </span><a name="local-6989586621684146178"><a href="#local-6989586621684146178"><span class="hs-identifier">r2</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#eqCanRewrite"><span class="hs-identifier hs-var">eqCanRewrite</span></a><span> </span><a href="#local-6989586621684146177"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-6989586621684146178"><span class="hs-identifier hs-var">r2</span></a><span>
</span><a name="line-3066"></a><span class="hs-identifier">eqCanRewriteFR</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3067"></a><span class="hs-identifier">eqCanRewriteFR</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span class="hs-special">,</span><span>       </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3068"></a><span class="hs-identifier">eqCanRewriteFR</span><span> </span><span class="hs-identifier">_</span><span>                      </span><span class="hs-identifier">_</span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-3069"></a><span>
</span><a name="line-3070"></a><span class="hs-identifier">eqMayRewriteFR</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3071"></a><span class="hs-comment">-- Is it /possible/ that fr1 can rewrite fr2?</span><span>
</span><a name="line-3072"></a><span class="hs-comment">-- This is used when deciding which inerts to kick out,</span><span>
</span><a name="line-3073"></a><span class="hs-comment">-- at which time a [WD] inert may be split into [W] and [D]</span><span>
</span><a name="line-3074"></a><a name="eqMayRewriteFR"><a href="TcRnTypes.html#eqMayRewriteFR"><span class="hs-identifier">eqMayRewriteFR</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3075"></a><span class="hs-identifier">eqMayRewriteFR</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span class="hs-special">,</span><span>       </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span class="hs-special">,</span><span> </span><a href="Type.html#NomEq"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3076"></a><span class="hs-identifier">eqMayRewriteFR</span><span> </span><a name="local-6989586621684146179"><a href="#local-6989586621684146179"><span class="hs-identifier">fr1</span></a></a><span> </span><a name="local-6989586621684146180"><a href="#local-6989586621684146180"><span class="hs-identifier">fr2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#eqCanRewriteFR"><span class="hs-identifier hs-var">eqCanRewriteFR</span></a><span> </span><a href="#local-6989586621684146179"><span class="hs-identifier hs-var">fr1</span></a><span> </span><a href="#local-6989586621684146180"><span class="hs-identifier hs-var">fr2</span></a><span>
</span><a name="line-3077"></a><span>
</span><a name="line-3078"></a><span class="hs-comment">-----------------</span><span>
</span><a name="line-3079"></a><span class="hs-comment">{- Note [funEqCanDischarge]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have two CFunEqCans with the same LHS:
    (x1:F ts ~ f1) `funEqCanDischarge` (x2:F ts ~ f2)
Can we drop x2 in favour of x1, either unifying
f2 (if it's a flatten meta-var) or adding a new Given
(f1 ~ f2), if x2 is a Given?

Answer: yes if funEqCanDischarge is true.
-}</span><span>
</span><a name="line-3089"></a><span>
</span><a name="line-3090"></a><span class="hs-identifier">funEqCanDischarge</span><span>
</span><a name="line-3091"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtEvidence"><span class="hs-identifier hs-type">CtEvidence</span></a><span>
</span><a name="line-3092"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><a href="BasicTypes.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a><span>   </span><span class="hs-comment">-- NotSwapped =&gt; lhs can discharge rhs</span><span>
</span><a name="line-3093"></a><span>                  </span><span class="hs-comment">-- Swapped    =&gt; rhs can discharge lhs</span><span>
</span><a name="line-3094"></a><span>     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- True &lt;=&gt; upgrade non-discharded one</span><span>
</span><a name="line-3095"></a><span>                  </span><span class="hs-comment">--          from [W] to [WD]</span><span>
</span><a name="line-3096"></a><span class="hs-comment">-- See Note [funEqCanDischarge]</span><span>
</span><a name="line-3097"></a><a name="funEqCanDischarge"><a href="TcRnTypes.html#funEqCanDischarge"><span class="hs-identifier">funEqCanDischarge</span></a></a><span> </span><a name="local-6989586621684146181"><a href="#local-6989586621684146181"><span class="hs-identifier">ev1</span></a></a><span> </span><a name="local-6989586621684146182"><a href="#local-6989586621684146182"><span class="hs-identifier">ev2</span></a></a><span>
</span><a name="line-3098"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">ctEvEqRel</span><span> </span><span class="hs-identifier">ev1</span><span> </span><a href="TcRnTypes.html#ctEvEqRel"><span class="hs-operator hs-var">==</span></a><span> </span><a href="TcRnTypes.html#ctEvEqRel"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ev1</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-3099"></a><span>    </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">ctEvEqRel</span><span> </span><span class="hs-identifier">ev2</span><span> </span><a href="TcRnTypes.html#ctEvEqRel"><span class="hs-operator hs-var">==</span></a><span> </span><a href="TcRnTypes.html#ctEvEqRel"><span class="hs-identifier hs-var">NomEq</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">ev2</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-3100"></a><span>    </span><span class="hs-comment">-- CFunEqCans are all Nominal, hence asserts</span><span>
</span><a name="line-3101"></a><span>    </span><a href="TcRnTypes.html#funEqCanDischargeF"><span class="hs-identifier hs-var">funEqCanDischargeF</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><a href="#local-6989586621684146181"><span class="hs-identifier hs-var">ev1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctEvFlavour"><span class="hs-identifier hs-var">ctEvFlavour</span></a><span> </span><a href="#local-6989586621684146182"><span class="hs-identifier hs-var">ev2</span></a><span class="hs-special">)</span><span>
</span><a name="line-3102"></a><span>
</span><a name="line-3103"></a><span class="hs-identifier">funEqCanDischargeF</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#SwapFlag"><span class="hs-identifier hs-type">SwapFlag</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-3104"></a><a name="funEqCanDischargeF"><a href="TcRnTypes.html#funEqCanDischargeF"><span class="hs-identifier">funEqCanDischargeF</span></a></a><span> </span><a href="TcRnTypes.html#Given"><span class="hs-identifier hs-var">Given</span></a><span>           </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-3105"></a><span class="hs-identifier">funEqCanDischargeF</span><span> </span><span class="hs-identifier">_</span><span>               </span><a href="TcRnTypes.html#Given"><span class="hs-identifier hs-var">Given</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-3106"></a><span class="hs-identifier">funEqCanDischargeF</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-3107"></a><span class="hs-identifier">funEqCanDischargeF</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-3108"></a><span class="hs-identifier">funEqCanDischargeF</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WOnly"><span class="hs-identifier hs-var">WOnly</span></a><span class="hs-special">)</span><span>  </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WOnly"><span class="hs-identifier hs-var">WOnly</span></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-3109"></a><span class="hs-identifier">funEqCanDischargeF</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WOnly"><span class="hs-identifier hs-var">WOnly</span></a><span class="hs-special">)</span><span>  </span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-3110"></a><span class="hs-identifier">funEqCanDischargeF</span><span> </span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span>         </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WOnly"><span class="hs-identifier hs-var">WOnly</span></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#IsSwapped"><span class="hs-identifier hs-var">IsSwapped</span></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-3111"></a><span class="hs-identifier">funEqCanDischargeF</span><span> </span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span>         </span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="BasicTypes.html#NotSwapped"><span class="hs-identifier hs-var">NotSwapped</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-3112"></a><span>
</span><a name="line-3113"></a><span>
</span><a name="line-3114"></a><span class="hs-comment">{- Note [eqCanDischarge]
~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have two identical CTyEqCan equality constraints
(i.e. both LHS and RHS are the same)
      (x1:a~t) `eqCanDischarge` (xs:a~t)
Can we just drop x2 in favour of x1?

Answer: yes if eqCanDischarge is true.

Note that we do /not/ allow Wanted to discharge Derived.
We must keep both.  Why?  Because the Derived may rewrite
other Deriveds in the model whereas the Wanted cannot.

However a Wanted can certainly discharge an identical Wanted.  So
eqCanDischarge does /not/ define a can-rewrite relation in the
sense of Definition [Can-rewrite relation] in TcSMonad.

We /do/ say that a [W] can discharge a [WD].  In evidence terms it
certainly can, and the /caller/ arranges that the otherwise-lost [D]
is spat out as a new Derived.  -}</span><span>
</span><a name="line-3134"></a><span>
</span><a name="line-3135"></a><span class="hs-identifier">eqCanDischargeFR</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtFlavourRole"><span class="hs-identifier hs-type">CtFlavourRole</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3136"></a><span class="hs-comment">-- See Note [eqCanDischarge]</span><span>
</span><a name="line-3137"></a><a name="eqCanDischargeFR"><a href="TcRnTypes.html#eqCanDischargeFR"><span class="hs-identifier">eqCanDischargeFR</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684146183"><a href="#local-6989586621684146183"><span class="hs-identifier">f1</span></a></a><span class="hs-special">,</span><a name="local-6989586621684146184"><a href="#local-6989586621684146184"><span class="hs-identifier">r1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684146185"><a href="#local-6989586621684146185"><span class="hs-identifier">f2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684146186"><a href="#local-6989586621684146186"><span class="hs-identifier">r2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="TcRnTypes.html#eqCanRewrite"><span class="hs-identifier hs-var">eqCanRewrite</span></a><span> </span><a href="#local-6989586621684146184"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-6989586621684146186"><span class="hs-identifier hs-var">r2</span></a><span>
</span><a name="line-3138"></a><span>                                  </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="TcRnTypes.html#eqCanDischargeF"><span class="hs-identifier hs-var">eqCanDischargeF</span></a><span> </span><a href="#local-6989586621684146183"><span class="hs-identifier hs-var">f1</span></a><span> </span><a href="#local-6989586621684146185"><span class="hs-identifier hs-var">f2</span></a><span>
</span><a name="line-3139"></a><span>
</span><a name="line-3140"></a><span class="hs-identifier">eqCanDischargeF</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtFlavour"><span class="hs-identifier hs-type">CtFlavour</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3141"></a><a name="eqCanDischargeF"><a href="TcRnTypes.html#eqCanDischargeF"><span class="hs-identifier">eqCanDischargeF</span></a></a><span> </span><a href="TcRnTypes.html#Given"><span class="hs-identifier hs-var">Given</span></a><span>   </span><span class="hs-identifier">_</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3142"></a><span class="hs-identifier">eqCanDischargeF</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3143"></a><span class="hs-identifier">eqCanDischargeF</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Wanted"><span class="hs-identifier hs-var">Wanted</span></a><span> </span><a href="TcRnTypes.html#WDeriv"><span class="hs-identifier hs-var">WDeriv</span></a><span class="hs-special">)</span><span> </span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3144"></a><span class="hs-identifier">eqCanDischargeF</span><span> </span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span>         </span><a href="TcRnTypes.html#Derived"><span class="hs-identifier hs-var">Derived</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3145"></a><span class="hs-identifier">eqCanDischargeF</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-3146"></a><span>
</span><a name="line-3147"></a><span>
</span><a name="line-3148"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
            SubGoalDepth
*                                                                      *
************************************************************************

Note [SubGoalDepth]
~~~~~~~~~~~~~~~~~~~
The 'SubGoalDepth' takes care of stopping the constraint solver from looping.

The counter starts at zero and increases. It includes dictionary constraints,
equality simplification, and type family reduction. (Why combine these? Because
it's actually quite easy to mistake one for another, in sufficiently involved
scenarios, like ConstraintKinds.)

The flag -fcontext-stack=n (not very well named!) fixes the maximium
level.

* The counter includes the depth of type class instance declarations.  Example:
     [W] d{7} : Eq [Int]
  That is d's dictionary-constraint depth is 7.  If we use the instance
     $dfEqList :: Eq a =&gt; Eq [a]
  to simplify it, we get
     d{7} = $dfEqList d'{8}
  where d'{8} : Eq Int, and d' has depth 8.

  For civilised (decidable) instance declarations, each increase of
  depth removes a type constructor from the type, so the depth never
  gets big; i.e. is bounded by the structural depth of the type.

* The counter also increments when resolving
equalities involving type functions. Example:
  Assume we have a wanted at depth 7:
    [W] d{7} : F () ~ a
  If there is a type function equation &quot;F () = Int&quot;, this would be rewritten to
    [W] d{8} : Int ~ a
  and remembered as having depth 8.

  Again, without UndecidableInstances, this counter is bounded, but without it
  can resolve things ad infinitum. Hence there is a maximum level.

* Lastly, every time an equality is rewritten, the counter increases. Again,
  rewriting an equality constraint normally makes progress, but it's possible
  the &quot;progress&quot; is just the reduction of an infinitely-reducing type family.
  Hence we need to track the rewrites.

When compiling a program requires a greater depth, then GHC recommends turning
off this check entirely by setting -freduction-depth=0. This is because the
exact number that works is highly variable, and is likely to change even between
minor releases. Because this check is solely to prevent infinite compilation
times, it seems safe to disable it when a user has ascertained that their program
doesn't loop at the type level.

-}</span><span>
</span><a name="line-3203"></a><span>
</span><a name="line-3204"></a><span class="hs-comment">-- | See Note [SubGoalDepth]</span><span>
</span><a name="line-3205"></a><span class="hs-keyword">newtype</span><span> </span><a name="SubGoalDepth"><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier">SubGoalDepth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SubGoalDepth"><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier">SubGoalDepth</span></a></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-3206"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span class="hs-special">)</span><span>
</span><a name="line-3207"></a><span>
</span><a name="line-3208"></a><span class="hs-identifier">initialSubGoalDepth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-type">SubGoalDepth</span></a><span>
</span><a name="line-3209"></a><a name="initialSubGoalDepth"><a href="TcRnTypes.html#initialSubGoalDepth"><span class="hs-identifier">initialSubGoalDepth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-var">SubGoalDepth</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-3210"></a><span>
</span><a name="line-3211"></a><span class="hs-identifier">bumpSubGoalDepth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-type">SubGoalDepth</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-type">SubGoalDepth</span></a><span>
</span><a name="line-3212"></a><a name="bumpSubGoalDepth"><a href="TcRnTypes.html#bumpSubGoalDepth"><span class="hs-identifier">bumpSubGoalDepth</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-var">SubGoalDepth</span></a><span> </span><a name="local-6989586621684146187"><a href="#local-6989586621684146187"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-var">SubGoalDepth</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146187"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-3213"></a><span>
</span><a name="line-3214"></a><span class="hs-identifier">maxSubGoalDepth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-type">SubGoalDepth</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-type">SubGoalDepth</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-type">SubGoalDepth</span></a><span>
</span><a name="line-3215"></a><a name="maxSubGoalDepth"><a href="TcRnTypes.html#maxSubGoalDepth"><span class="hs-identifier">maxSubGoalDepth</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-var">SubGoalDepth</span></a><span> </span><a name="local-6989586621684146188"><a href="#local-6989586621684146188"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-var">SubGoalDepth</span></a><span> </span><a name="local-6989586621684146189"><a href="#local-6989586621684146189"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-var">SubGoalDepth</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">max</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684146189"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-3216"></a><span>
</span><a name="line-3217"></a><span class="hs-identifier">subGoalDepthExceeded</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-type">SubGoalDepth</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3218"></a><a name="subGoalDepthExceeded"><a href="TcRnTypes.html#subGoalDepthExceeded"><span class="hs-identifier">subGoalDepthExceeded</span></a></a><span> </span><a name="local-6989586621684146190"><a href="#local-6989586621684146190"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-var">SubGoalDepth</span></a><span> </span><a name="local-6989586621684146191"><a href="#local-6989586621684146191"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3219"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="BasicTypes.html#mkIntWithInf"><span class="hs-identifier hs-var">mkIntWithInf</span></a><span> </span><a href="#local-6989586621684146191"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-identifier">reductionDepth</span><span> </span><a href="#local-6989586621684146190"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-3220"></a><span>
</span><a name="line-3221"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
            CtLoc
*                                                                      *
************************************************************************

The 'CtLoc' gives information about where a constraint came from.
This is important for decent error message reporting because
dictionaries don't appear in the original source code.
type will evolve...

-}</span><span>
</span><a name="line-3234"></a><span>
</span><a name="line-3235"></a><span class="hs-keyword">data</span><span> </span><a name="CtLoc"><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier">CtLoc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CtLoc"><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier">CtLoc</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="ctl_origin"><a href="TcRnTypes.html#ctl_origin"><span class="hs-identifier">ctl_origin</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-3236"></a><span>                   </span><span class="hs-special">,</span><span> </span><a name="ctl_env"><a href="TcRnTypes.html#ctl_env"><span class="hs-identifier">ctl_env</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span>
</span><a name="line-3237"></a><span>                   </span><span class="hs-special">,</span><span> </span><a name="ctl_t_or_k"><a href="TcRnTypes.html#ctl_t_or_k"><span class="hs-identifier">ctl_t_or_k</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span>  </span><span class="hs-comment">-- OK if we're not sure</span><span>
</span><a name="line-3238"></a><span>                   </span><span class="hs-special">,</span><span> </span><a name="ctl_depth"><a href="TcRnTypes.html#ctl_depth"><span class="hs-identifier">ctl_depth</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-type">SubGoalDepth</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3239"></a><span>
</span><a name="line-3240"></a><span>  </span><span class="hs-comment">-- The TcLclEnv includes particularly</span><span>
</span><a name="line-3241"></a><span>  </span><span class="hs-comment">--    source location:  tcl_loc   :: RealSrcSpan</span><span>
</span><a name="line-3242"></a><span>  </span><span class="hs-comment">--    context:          tcl_ctxt  :: [ErrCtxt]</span><span>
</span><a name="line-3243"></a><span>  </span><span class="hs-comment">--    binder stack:     tcl_bndrs :: TcBinderStack</span><span>
</span><a name="line-3244"></a><span>  </span><span class="hs-comment">--    level:            tcl_tclvl :: TcLevel</span><span>
</span><a name="line-3245"></a><span>
</span><a name="line-3246"></a><span class="hs-identifier">mkKindLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>   </span><span class="hs-comment">-- original *types* being compared</span><span>
</span><a name="line-3247"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-3248"></a><a name="mkKindLoc"><a href="TcRnTypes.html#mkKindLoc"><span class="hs-identifier">mkKindLoc</span></a></a><span> </span><a name="local-6989586621684146192"><a href="#local-6989586621684146192"><span class="hs-identifier">s1</span></a></a><span> </span><a name="local-6989586621684146193"><a href="#local-6989586621684146193"><span class="hs-identifier">s2</span></a></a><span> </span><a name="local-6989586621684146194"><a href="#local-6989586621684146194"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#setCtLocOrigin"><span class="hs-identifier hs-var">setCtLocOrigin</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#toKindLoc"><span class="hs-identifier hs-var">toKindLoc</span></a><span> </span><a href="#local-6989586621684146194"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-3249"></a><span>                        </span><span class="hs-special">(</span><a href="TcRnTypes.html#KindEqOrigin"><span class="hs-identifier hs-var">KindEqOrigin</span></a><span> </span><a href="#local-6989586621684146192"><span class="hs-identifier hs-var">s1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684146193"><span class="hs-identifier hs-var">s2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctLocOrigin"><span class="hs-identifier hs-var">ctLocOrigin</span></a><span> </span><a href="#local-6989586621684146194"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-3250"></a><span>                                      </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctLocTypeOrKind_maybe"><span class="hs-identifier hs-var">ctLocTypeOrKind_maybe</span></a><span> </span><a href="#local-6989586621684146194"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3251"></a><span>
</span><a name="line-3252"></a><span class="hs-comment">-- | Take a CtLoc and moves it to the kind level</span><span>
</span><a name="line-3253"></a><span class="hs-identifier">toKindLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-3254"></a><a name="toKindLoc"><a href="TcRnTypes.html#toKindLoc"><span class="hs-identifier">toKindLoc</span></a></a><span> </span><a name="local-6989586621684146195"><a href="#local-6989586621684146195"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146195"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_t_or_k</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3255"></a><span>
</span><a name="line-3256"></a><span class="hs-identifier">mkGivenLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-3257"></a><a name="mkGivenLoc"><a href="TcRnTypes.html#mkGivenLoc"><span class="hs-identifier">mkGivenLoc</span></a></a><span> </span><a name="local-6989586621684146196"><a href="#local-6989586621684146196"><span class="hs-identifier">tclvl</span></a></a><span> </span><a name="local-6989586621684146197"><a href="#local-6989586621684146197"><span class="hs-identifier">skol_info</span></a></a><span> </span><a name="local-6989586621684146198"><a href="#local-6989586621684146198"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-3258"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-var">CtLoc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_origin</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#GivenOrigin"><span class="hs-identifier hs-var">GivenOrigin</span></a><span> </span><a href="#local-6989586621684146197"><span class="hs-identifier hs-var">skol_info</span></a><span>
</span><a name="line-3259"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctl_env</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146198"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcl_tclvl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146196"><span class="hs-identifier hs-var">tclvl</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3260"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctl_t_or_k</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-comment">-- this only matters for error msgs</span><span>
</span><a name="line-3261"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctl_depth</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#initialSubGoalDepth"><span class="hs-identifier hs-var">initialSubGoalDepth</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3262"></a><span>
</span><a name="line-3263"></a><span class="hs-identifier">ctLocEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span>
</span><a name="line-3264"></a><a name="ctLocEnv"><a href="TcRnTypes.html#ctLocEnv"><span class="hs-identifier">ctLocEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctl_env</span><span>
</span><a name="line-3265"></a><span>
</span><a name="line-3266"></a><span class="hs-identifier">ctLocLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a><span>
</span><a name="line-3267"></a><a name="ctLocLevel"><a href="TcRnTypes.html#ctLocLevel"><span class="hs-identifier">ctLocLevel</span></a></a><span> </span><a name="local-6989586621684146199"><a href="#local-6989586621684146199"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcl_tclvl</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctLocEnv"><span class="hs-identifier hs-var">ctLocEnv</span></a><span> </span><a href="#local-6989586621684146199"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">)</span><span>
</span><a name="line-3268"></a><span>
</span><a name="line-3269"></a><span class="hs-identifier">ctLocDepth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#SubGoalDepth"><span class="hs-identifier hs-type">SubGoalDepth</span></a><span>
</span><a name="line-3270"></a><a name="ctLocDepth"><a href="TcRnTypes.html#ctLocDepth"><span class="hs-identifier">ctLocDepth</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctl_depth</span><span>
</span><a name="line-3271"></a><span>
</span><a name="line-3272"></a><span class="hs-identifier">ctLocOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-3273"></a><a name="ctLocOrigin"><a href="TcRnTypes.html#ctLocOrigin"><span class="hs-identifier">ctLocOrigin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctl_origin</span><span>
</span><a name="line-3274"></a><span>
</span><a name="line-3275"></a><span class="hs-identifier">ctLocSpan</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a><span>
</span><a name="line-3276"></a><a name="ctLocSpan"><a href="TcRnTypes.html#ctLocSpan"><span class="hs-identifier">ctLocSpan</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-var">CtLoc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146200"><a href="#local-6989586621684146200"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">tcl_loc</span><span> </span><a href="#local-6989586621684146200"><span class="hs-identifier hs-var">lcl</span></a><span>
</span><a name="line-3277"></a><span>
</span><a name="line-3278"></a><span class="hs-identifier">ctLocTypeOrKind_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span>
</span><a name="line-3279"></a><a name="ctLocTypeOrKind_maybe"><a href="TcRnTypes.html#ctLocTypeOrKind_maybe"><span class="hs-identifier">ctLocTypeOrKind_maybe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctl_t_or_k</span><span>
</span><a name="line-3280"></a><span>
</span><a name="line-3281"></a><span class="hs-identifier">setCtLocSpan</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-3282"></a><a name="setCtLocSpan"><a href="TcRnTypes.html#setCtLocSpan"><span class="hs-identifier">setCtLocSpan</span></a></a><span> </span><a name="local-6989586621684146201"><a href="#local-6989586621684146201"><span class="hs-identifier">ctl</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-var">CtLoc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146202"><a href="#local-6989586621684146202"><span class="hs-identifier">lcl</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684146203"><a href="#local-6989586621684146203"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#setCtLocEnv"><span class="hs-identifier hs-var">setCtLocEnv</span></a><span> </span><a href="#local-6989586621684146201"><span class="hs-identifier hs-var">ctl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146202"><span class="hs-identifier hs-var">lcl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcl_loc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146203"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-3283"></a><span>
</span><a name="line-3284"></a><span class="hs-identifier">bumpCtLocDepth</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-3285"></a><a name="bumpCtLocDepth"><a href="TcRnTypes.html#bumpCtLocDepth"><span class="hs-identifier">bumpCtLocDepth</span></a></a><span> </span><a name="local-6989586621684146204"><a href="#local-6989586621684146204"><span class="hs-identifier">loc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-var">CtLoc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_depth</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146205"><a href="#local-6989586621684146205"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146204"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_depth</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#bumpSubGoalDepth"><span class="hs-identifier hs-var">bumpSubGoalDepth</span></a><span> </span><a href="#local-6989586621684146205"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3286"></a><span>
</span><a name="line-3287"></a><span class="hs-identifier">setCtLocOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-3288"></a><a name="setCtLocOrigin"><a href="TcRnTypes.html#setCtLocOrigin"><span class="hs-identifier">setCtLocOrigin</span></a></a><span> </span><a name="local-6989586621684146206"><a href="#local-6989586621684146206"><span class="hs-identifier">ctl</span></a></a><span> </span><a name="local-6989586621684146207"><a href="#local-6989586621684146207"><span class="hs-identifier">orig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146206"><span class="hs-identifier hs-var">ctl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_origin</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146207"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3289"></a><span>
</span><a name="line-3290"></a><span class="hs-identifier">updateCtLocOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-3291"></a><a name="updateCtLocOrigin"><a href="TcRnTypes.html#updateCtLocOrigin"><span class="hs-identifier">updateCtLocOrigin</span></a></a><span> </span><a name="local-6989586621684146208"><a href="#local-6989586621684146208"><span class="hs-identifier">ctl</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-var">CtLoc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_origin</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146209"><a href="#local-6989586621684146209"><span class="hs-identifier">orig</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684146210"><a href="#local-6989586621684146210"><span class="hs-identifier">upd</span></a></a><span>
</span><a name="line-3292"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146208"><span class="hs-identifier hs-var">ctl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_origin</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146210"><span class="hs-identifier hs-var">upd</span></a><span> </span><a href="#local-6989586621684146209"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3293"></a><span>
</span><a name="line-3294"></a><span class="hs-identifier">setCtLocEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-3295"></a><a name="setCtLocEnv"><a href="TcRnTypes.html#setCtLocEnv"><span class="hs-identifier">setCtLocEnv</span></a></a><span> </span><a name="local-6989586621684146211"><a href="#local-6989586621684146211"><span class="hs-identifier">ctl</span></a></a><span> </span><a name="local-6989586621684146212"><a href="#local-6989586621684146212"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146211"><span class="hs-identifier hs-var">ctl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146212"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3296"></a><span>
</span><a name="line-3297"></a><span class="hs-identifier">pushErrCtxt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-3298"></a><a name="pushErrCtxt"><a href="TcRnTypes.html#pushErrCtxt"><span class="hs-identifier">pushErrCtxt</span></a></a><span> </span><a name="local-6989586621684146213"><a href="#local-6989586621684146213"><span class="hs-identifier">o</span></a></a><span> </span><a name="local-6989586621684146214"><a href="#local-6989586621684146214"><span class="hs-identifier">err</span></a></a><span> </span><a name="local-6989586621684146215"><a href="#local-6989586621684146215"><span class="hs-identifier">loc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-var">CtLoc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146216"><a href="#local-6989586621684146216"><span class="hs-identifier">lcl</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-3299"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146215"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_origin</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146213"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146216"><span class="hs-identifier hs-var">lcl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcl_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146214"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">tcl_ctxt</span><span> </span><a href="#local-6989586621684146216"><span class="hs-identifier hs-var">lcl</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3300"></a><span>
</span><a name="line-3301"></a><span class="hs-identifier">pushErrCtxtSameOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>
</span><a name="line-3302"></a><span class="hs-comment">-- Just add information w/o updating the origin!</span><span>
</span><a name="line-3303"></a><a name="pushErrCtxtSameOrigin"><a href="TcRnTypes.html#pushErrCtxtSameOrigin"><span class="hs-identifier">pushErrCtxtSameOrigin</span></a></a><span> </span><a name="local-6989586621684146217"><a href="#local-6989586621684146217"><span class="hs-identifier">err</span></a></a><span> </span><a name="local-6989586621684146218"><a href="#local-6989586621684146218"><span class="hs-identifier">loc</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-var">CtLoc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146219"><a href="#local-6989586621684146219"><span class="hs-identifier">lcl</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-3304"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146218"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146219"><span class="hs-identifier hs-var">lcl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcl_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146217"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">tcl_ctxt</span><span> </span><a href="#local-6989586621684146219"><span class="hs-identifier hs-var">lcl</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3305"></a><span>
</span><a name="line-3306"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                SkolemInfo
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-3313"></a><span>
</span><a name="line-3314"></a><span class="hs-comment">-- SkolemInfo gives the origin of *given* constraints</span><span>
</span><a name="line-3315"></a><span class="hs-comment">--   a) type variables are skolemised</span><span>
</span><a name="line-3316"></a><span class="hs-comment">--   b) an implication constraint is generated</span><span>
</span><a name="line-3317"></a><span class="hs-keyword">data</span><span> </span><a name="SkolemInfo"><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier">SkolemInfo</span></a></a><span>
</span><a name="line-3318"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="SigSkol"><a href="TcRnTypes.html#SigSkol"><span class="hs-identifier">SigSkol</span></a></a><span> </span><span class="hs-comment">-- A skolem that is created by instantiating</span><span>
</span><a name="line-3319"></a><span>            </span><span class="hs-comment">-- a programmer-supplied type signature</span><span>
</span><a name="line-3320"></a><span>            </span><span class="hs-comment">-- Location of the binding site is on the TyVar</span><span>
</span><a name="line-3321"></a><span>            </span><span class="hs-comment">-- See Note [SigSkol SkolemInfo]</span><span>
</span><a name="line-3322"></a><span>       </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>        </span><span class="hs-comment">-- What sort of signature</span><span>
</span><a name="line-3323"></a><span>       </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>              </span><span class="hs-comment">-- Original type signature (before skolemisation)</span><span>
</span><a name="line-3324"></a><span>       </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- Maps the original name of the skolemised tyvar</span><span>
</span><a name="line-3325"></a><span>                           </span><span class="hs-comment">-- to its instantiated version</span><span>
</span><a name="line-3326"></a><span>
</span><a name="line-3327"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SigTypeSkol"><a href="TcRnTypes.html#SigTypeSkol"><span class="hs-identifier">SigTypeSkol</span></a></a><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>
</span><a name="line-3328"></a><span>                 </span><span class="hs-comment">-- like SigSkol, but when we're kind-checking the *type*</span><span>
</span><a name="line-3329"></a><span>                 </span><span class="hs-comment">-- hence, we have less info</span><span>
</span><a name="line-3330"></a><span>
</span><a name="line-3331"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ForAllSkol"><a href="TcRnTypes.html#ForAllSkol"><span class="hs-identifier">ForAllSkol</span></a></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>     </span><span class="hs-comment">-- Bound by a user-written &quot;forall&quot;.</span><span>
</span><a name="line-3332"></a><span>
</span><a name="line-3333"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DerivSkol"><a href="TcRnTypes.html#DerivSkol"><span class="hs-identifier">DerivSkol</span></a></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>      </span><span class="hs-comment">-- Bound by a 'deriving' clause;</span><span>
</span><a name="line-3334"></a><span>                        </span><span class="hs-comment">-- the type is the instance we are trying to derive</span><span>
</span><a name="line-3335"></a><span>
</span><a name="line-3336"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InstSkol"><a href="TcRnTypes.html#InstSkol"><span class="hs-identifier">InstSkol</span></a></a><span>            </span><span class="hs-comment">-- Bound at an instance decl</span><span>
</span><a name="line-3337"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InstSC"><a href="TcRnTypes.html#InstSC"><span class="hs-identifier">InstSC</span></a></a><span> </span><a href="TcType.html#TypeSize"><span class="hs-identifier hs-type">TypeSize</span></a><span>     </span><span class="hs-comment">-- A &quot;given&quot; constraint obtained by superclass selection.</span><span>
</span><a name="line-3338"></a><span>                        </span><span class="hs-comment">-- If (C ty1 .. tyn) is the largest class from</span><span>
</span><a name="line-3339"></a><span>                        </span><span class="hs-comment">--    which we made a superclass selection in the chain,</span><span>
</span><a name="line-3340"></a><span>                        </span><span class="hs-comment">--    then TypeSize = sizeTypes [ty1, .., tyn]</span><span>
</span><a name="line-3341"></a><span>                        </span><span class="hs-comment">-- See Note [Solving superclass constraints] in TcInstDcls</span><span>
</span><a name="line-3342"></a><span>
</span><a name="line-3343"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FamInstSkol"><a href="TcRnTypes.html#FamInstSkol"><span class="hs-identifier">FamInstSkol</span></a></a><span>         </span><span class="hs-comment">-- Bound at a family instance decl</span><span>
</span><a name="line-3344"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PatSkol"><a href="TcRnTypes.html#PatSkol"><span class="hs-identifier">PatSkol</span></a></a><span>             </span><span class="hs-comment">-- An existential type variable bound by a pattern for</span><span>
</span><a name="line-3345"></a><span>      </span><a href="ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a><span>           </span><span class="hs-comment">-- a data constructor with an existential type.</span><span>
</span><a name="line-3346"></a><span>      </span><span class="hs-special">(</span><a href="HsExpr.html#HsMatchContext"><span class="hs-identifier hs-type">HsMatchContext</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span>
</span><a name="line-3347"></a><span>             </span><span class="hs-comment">-- e.g.   data T = forall a. Eq a =&gt; MkT a</span><span>
</span><a name="line-3348"></a><span>             </span><span class="hs-comment">--        f (MkT x) = ...</span><span>
</span><a name="line-3349"></a><span>             </span><span class="hs-comment">-- The pattern MkT x will allocate an existential type</span><span>
</span><a name="line-3350"></a><span>             </span><span class="hs-comment">-- variable for 'a'.</span><span>
</span><a name="line-3351"></a><span>
</span><a name="line-3352"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ArrowSkol"><a href="TcRnTypes.html#ArrowSkol"><span class="hs-identifier">ArrowSkol</span></a></a><span>           </span><span class="hs-comment">-- An arrow form (see TcArrows)</span><span>
</span><a name="line-3353"></a><span>
</span><a name="line-3354"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IPSkol"><a href="TcRnTypes.html#IPSkol"><span class="hs-identifier">IPSkol</span></a></a><span> </span><span class="hs-special">[</span><a href="HsTypes.html#HsIPName"><span class="hs-identifier hs-type">HsIPName</span></a><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Binding site of an implicit parameter</span><span>
</span><a name="line-3355"></a><span>
</span><a name="line-3356"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RuleSkol"><a href="TcRnTypes.html#RuleSkol"><span class="hs-identifier">RuleSkol</span></a></a><span> </span><a href="BasicTypes.html#RuleName"><span class="hs-identifier hs-type">RuleName</span></a><span>   </span><span class="hs-comment">-- The LHS of a RULE</span><span>
</span><a name="line-3357"></a><span>
</span><a name="line-3358"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InferSkol"><a href="TcRnTypes.html#InferSkol"><span class="hs-identifier">InferSkol</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-3359"></a><span>                        </span><span class="hs-comment">-- We have inferred a type for these (mutually-recursivive)</span><span>
</span><a name="line-3360"></a><span>                        </span><span class="hs-comment">-- polymorphic Ids, and are now checking that their RHS</span><span>
</span><a name="line-3361"></a><span>                        </span><span class="hs-comment">-- constraints are satisfied.</span><span>
</span><a name="line-3362"></a><span>
</span><a name="line-3363"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="BracketSkol"><a href="TcRnTypes.html#BracketSkol"><span class="hs-identifier">BracketSkol</span></a></a><span>         </span><span class="hs-comment">-- Template Haskell bracket</span><span>
</span><a name="line-3364"></a><span>
</span><a name="line-3365"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UnifyForAllSkol"><a href="TcRnTypes.html#UnifyForAllSkol"><span class="hs-identifier">UnifyForAllSkol</span></a></a><span>     </span><span class="hs-comment">-- We are unifying two for-all types</span><span>
</span><a name="line-3366"></a><span>       </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>           </span><span class="hs-comment">-- The instantiated type *inside* the forall</span><span>
</span><a name="line-3367"></a><span>
</span><a name="line-3368"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TyConSkol"><a href="TcRnTypes.html#TyConSkol"><span class="hs-identifier">TyConSkol</span></a></a><span> </span><a href="TyCon.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>  </span><span class="hs-comment">-- bound in a type declaration of the given flavour</span><span>
</span><a name="line-3369"></a><span>
</span><a name="line-3370"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DataConSkol"><a href="TcRnTypes.html#DataConSkol"><span class="hs-identifier">DataConSkol</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>    </span><span class="hs-comment">-- bound as an existential in a Haskell98 datacon decl or</span><span>
</span><a name="line-3371"></a><span>                        </span><span class="hs-comment">-- as any variable in a GADT datacon decl</span><span>
</span><a name="line-3372"></a><span>
</span><a name="line-3373"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ReifySkol"><a href="TcRnTypes.html#ReifySkol"><span class="hs-identifier">ReifySkol</span></a></a><span>           </span><span class="hs-comment">-- Bound during Template Haskell reification</span><span>
</span><a name="line-3374"></a><span>
</span><a name="line-3375"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="QuantCtxtSkol"><a href="TcRnTypes.html#QuantCtxtSkol"><span class="hs-identifier">QuantCtxtSkol</span></a></a><span>       </span><span class="hs-comment">-- Quantified context, e.g.</span><span>
</span><a name="line-3376"></a><span>                        </span><span class="hs-comment">--   f :: forall c. (forall a. c a =&gt; c [a]) =&gt; blah</span><span>
</span><a name="line-3377"></a><span>
</span><a name="line-3378"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UnkSkol"><a href="TcRnTypes.html#UnkSkol"><span class="hs-identifier">UnkSkol</span></a></a><span>             </span><span class="hs-comment">-- Unhelpful info (until I improve it)</span><span>
</span><a name="line-3379"></a><span>
</span><a name="line-3380"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3381"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#pprSkolInfo"><span class="hs-identifier hs-var">pprSkolInfo</span></a><span>
</span><a name="line-3382"></a><span>
</span><a name="line-3383"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-3384"></a><span class="hs-comment">-- Complete the sentence &quot;is a rigid type variable bound by...&quot;</span><span>
</span><a name="line-3385"></a><a name="pprSkolInfo"><a href="TcRnTypes.html#pprSkolInfo"><span class="hs-identifier">pprSkolInfo</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SigSkol"><span class="hs-identifier hs-var">SigSkol</span></a><span> </span><a name="local-6989586621684146220"><a href="#local-6989586621684146220"><span class="hs-identifier">cx</span></a></a><span> </span><a name="local-6989586621684146221"><a href="#local-6989586621684146221"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#pprSigSkolInfo"><span class="hs-identifier hs-var">pprSigSkolInfo</span></a><span> </span><a href="#local-6989586621684146220"><span class="hs-identifier hs-var">cx</span></a><span> </span><a href="#local-6989586621684146221"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-3386"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SigTypeSkol"><span class="hs-identifier hs-var">SigTypeSkol</span></a><span> </span><a name="local-6989586621684146222"><a href="#local-6989586621684146222"><span class="hs-identifier">cx</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcType.html#pprUserTypeCtxt"><span class="hs-identifier hs-var">pprUserTypeCtxt</span></a><span> </span><a href="#local-6989586621684146222"><span class="hs-identifier hs-var">cx</span></a><span>
</span><a name="line-3387"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ForAllSkol"><span class="hs-identifier hs-var">ForAllSkol</span></a><span> </span><a name="local-6989586621684146223"><a href="#local-6989586621684146223"><span class="hs-identifier">doc</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><a href="#local-6989586621684146223"><span class="hs-identifier hs-var">doc</span></a><span>
</span><a name="line-3388"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#IPSkol"><span class="hs-identifier hs-var">IPSkol</span></a><span> </span><a name="local-6989586621684146224"><a href="#local-6989586621684146224"><span class="hs-identifier">ips</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the implicit-parameter binding&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a><span> </span><a href="#local-6989586621684146224"><span class="hs-identifier hs-var">ips</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;for&quot;</span><span>
</span><a name="line-3389"></a><span>                                 </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146224"><span class="hs-identifier hs-var">ips</span></a><span>
</span><a name="line-3390"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#DerivSkol"><span class="hs-identifier hs-var">DerivSkol</span></a><span> </span><a name="local-6989586621684146225"><a href="#local-6989586621684146225"><span class="hs-identifier">pred</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the deriving clause for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146225"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">)</span><span>
</span><a name="line-3391"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><a href="TcRnTypes.html#InstSkol"><span class="hs-identifier hs-var">InstSkol</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the instance declaration&quot;</span><span>
</span><a name="line-3392"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#InstSC"><span class="hs-identifier hs-var">InstSC</span></a><span> </span><a name="local-6989586621684146226"><a href="#local-6989586621684146226"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the instance declaration&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#whenPprDebug"><span class="hs-identifier hs-var">whenPprDebug</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146226"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3393"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><a href="TcRnTypes.html#FamInstSkol"><span class="hs-identifier hs-var">FamInstSkol</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a family instance declaration&quot;</span><span>
</span><a name="line-3394"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><a href="TcRnTypes.html#BracketSkol"><span class="hs-identifier hs-var">BracketSkol</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a Template Haskell bracket&quot;</span><span>
</span><a name="line-3395"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#RuleSkol"><span class="hs-identifier hs-var">RuleSkol</span></a><span> </span><a name="local-6989586621684146227"><a href="#local-6989586621684146227"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the RULE&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="BasicTypes.html#pprRuleName"><span class="hs-identifier hs-var">pprRuleName</span></a><span> </span><a href="#local-6989586621684146227"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-3396"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><a href="TcRnTypes.html#ArrowSkol"><span class="hs-identifier hs-var">ArrowSkol</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an arrow form&quot;</span><span>
</span><a name="line-3397"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#PatSkol"><span class="hs-identifier hs-var">PatSkol</span></a><span> </span><a name="local-6989586621684146228"><a href="#local-6989586621684146228"><span class="hs-identifier">cl</span></a></a><span> </span><a name="local-6989586621684146229"><a href="#local-6989586621684146229"><span class="hs-identifier">mc</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="TcRnTypes.html#pprPatSkolInfo"><span class="hs-identifier hs-var">pprPatSkolInfo</span></a><span> </span><a href="#local-6989586621684146228"><span class="hs-identifier hs-var">cl</span></a><span>
</span><a name="line-3398"></a><span>                                    </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="HsExpr.html#pprMatchContext"><span class="hs-identifier hs-var">pprMatchContext</span></a><span> </span><a href="#local-6989586621684146229"><span class="hs-identifier hs-var">mc</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-3399"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#InferSkol"><span class="hs-identifier hs-var">InferSkol</span></a><span> </span><a name="local-6989586621684146230"><a href="#local-6989586621684146230"><span class="hs-identifier">ids</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the inferred type&quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a><span> </span><a href="#local-6989586621684146230"><span class="hs-identifier hs-var">ids</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;of&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-3400"></a><span>                                   </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146231"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146232"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-3401"></a><span>                                                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684146231"><a href="#local-6989586621684146231"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><a name="local-6989586621684146232"><a href="#local-6989586621684146232"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684146230"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-3402"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#UnifyForAllSkol"><span class="hs-identifier hs-var">UnifyForAllSkol</span></a><span> </span><a name="local-6989586621684146233"><a href="#local-6989586621684146233"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146233"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-3403"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TyConSkol"><span class="hs-identifier hs-var">TyConSkol</span></a><span> </span><a name="local-6989586621684146234"><a href="#local-6989586621684146234"><span class="hs-identifier">flav</span></a></a><span> </span><a name="local-6989586621684146235"><a href="#local-6989586621684146235"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146234"><span class="hs-identifier hs-var">flav</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;declaration for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146235"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-3404"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#DataConSkol"><span class="hs-identifier hs-var">DataConSkol</span></a><span> </span><a name="local-6989586621684146236"><a href="#local-6989586621684146236"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the data constructor&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146236"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-3405"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><a href="TcRnTypes.html#ReifySkol"><span class="hs-identifier hs-var">ReifySkol</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the type being reified&quot;</span><span>
</span><a name="line-3406"></a><span>
</span><a name="line-3407"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#QuantCtxtSkol"><span class="hs-identifier hs-var">QuantCtxtSkol</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a quantified context&quot;</span><span>
</span><a name="line-3408"></a><span>
</span><a name="line-3409"></a><span class="hs-comment">-- UnkSkol</span><span>
</span><a name="line-3410"></a><span class="hs-comment">-- For type variables the others are dealt with by pprSkolTvBinding.</span><span>
</span><a name="line-3411"></a><span class="hs-comment">-- For Insts, these cases should not happen</span><span>
</span><a name="line-3412"></a><span class="hs-identifier">pprSkolInfo</span><span> </span><a href="TcRnTypes.html#UnkSkol"><span class="hs-identifier hs-var">UnkSkol</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><a href="Outputable.html#warnPprTrace"><span class="hs-identifier hs-var">True</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;pprSkolInfo: UnkSkol&quot;</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;UnkSkol&quot;</span><span>
</span><a name="line-3413"></a><span>
</span><a name="line-3414"></a><span class="hs-identifier">pprSigSkolInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-3415"></a><span class="hs-comment">-- The type is already tidied</span><span>
</span><a name="line-3416"></a><a name="pprSigSkolInfo"><a href="TcRnTypes.html#pprSigSkolInfo"><span class="hs-identifier">pprSigSkolInfo</span></a></a><span> </span><a name="local-6989586621684146237"><a href="#local-6989586621684146237"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621684146238"><a href="#local-6989586621684146238"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-3417"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684146237"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-3418"></a><span>       </span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a name="local-6989586621684146239"><a href="#local-6989586621684146239"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the type signature for:&quot;</span><span>
</span><a name="line-3419"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#pprPrefixOcc"><span class="hs-identifier hs-var">pprPrefixOcc</span></a><span> </span><a href="#local-6989586621684146239"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146238"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-3420"></a><span>       </span><a href="TcType.html#PatSynCtxt"><span class="hs-identifier hs-var">PatSynCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcType.html#pprUserTypeCtxt"><span class="hs-identifier hs-var">pprUserTypeCtxt</span></a><span> </span><a href="#local-6989586621684146237"><span class="hs-identifier hs-var">ctxt</span></a><span>  </span><span class="hs-comment">-- See Note [Skolem info for pattern synonyms]</span><span>
</span><a name="line-3421"></a><span>       </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="TcType.html#pprUserTypeCtxt"><span class="hs-identifier hs-var">pprUserTypeCtxt</span></a><span> </span><a href="#local-6989586621684146237"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span>
</span><a name="line-3422"></a><span>                              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146238"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-3423"></a><span>
</span><a name="line-3424"></a><span class="hs-identifier">pprPatSkolInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-3425"></a><a name="pprPatSkolInfo"><a href="TcRnTypes.html#pprPatSkolInfo"><span class="hs-identifier">pprPatSkolInfo</span></a></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-6989586621684146240"><a href="#local-6989586621684146240"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3426"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a pattern with constructor:&quot;</span><span>
</span><a name="line-3427"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146240"><span class="hs-identifier hs-var">dc</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span>
</span><a name="line-3428"></a><span>          </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TyCoRep.html#pprType"><span class="hs-identifier hs-var">pprType</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConUserType"><span class="hs-identifier hs-var">dataConUserType</span></a><span> </span><a href="#local-6989586621684146240"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-3429"></a><span>          </span><span class="hs-comment">-- pprType prints forall's regardless of -fprint-explicit-foralls</span><span>
</span><a name="line-3430"></a><span>          </span><span class="hs-comment">-- which is what we want here, since we might be saying</span><span>
</span><a name="line-3431"></a><span>          </span><span class="hs-comment">-- type variable 't' is bound by ...</span><span>
</span><a name="line-3432"></a><span>
</span><a name="line-3433"></a><span class="hs-identifier">pprPatSkolInfo</span><span> </span><span class="hs-special">(</span><a href="ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a><span> </span><a name="local-6989586621684146241"><a href="#local-6989586621684146241"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3434"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a pattern with pattern synonym:&quot;</span><span>
</span><a name="line-3435"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146241"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span>
</span><a name="line-3436"></a><span>                   </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="PatSyn.html#pprPatSynType"><span class="hs-identifier hs-var">pprPatSynType</span></a><span> </span><a href="#local-6989586621684146241"><span class="hs-identifier hs-var">ps</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-3437"></a><span>
</span><a name="line-3438"></a><span class="hs-comment">{- Note [Skolem info for pattern synonyms]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For pattern synonym SkolemInfo we have
   SigSkol (PatSynCtxt p) ty _
but the type 'ty' is not very helpful.  The full pattern-synonym type
has the provided and required pieces, which it is inconvenient to
record and display here. So we simply don't display the type at all,
contenting outselves with just the name of the pattern synonym, which
is fine.  We could do more, but it doesn't seem worth it.

Note [SigSkol SkolemInfo]
~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we (deeply) skolemise a type
   f :: forall a. a -&gt; forall b. b -&gt; a
Then we'll instantiate [a :-&gt; a', b :-&gt; b'], and with the instantiated
      a' -&gt; b' -&gt; a.
But when, in an error message, we report that &quot;b is a rigid type
variable bound by the type signature for f&quot;, we want to show the foralls
in the right place.  So we proceed as follows:

* In SigSkol we record
    - the original signature forall a. a -&gt; forall b. b -&gt; a
    - the instantiation mapping [a :-&gt; a', b :-&gt; b']

* Then when tidying in TcMType.tidySkolemInfo, we first tidy a' to
  whatever it tidies to, say a''; and then we walk over the type
  replacing the binder a by the tidied version a'', to give
       forall a''. a'' -&gt; forall b''. b'' -&gt; a''
  We need to do this under function arrows, to match what deeplySkolemise
  does.

* Typically a'' will have a nice pretty name like &quot;a&quot;, but the point is
  that the foral-bound variables of the signature we report line up with
  the instantiated skolems lying  around in other types.


************************************************************************
*                                                                      *
            CtOrigin
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-3480"></a><span>
</span><a name="line-3481"></a><span class="hs-keyword">data</span><span> </span><a name="CtOrigin"><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier">CtOrigin</span></a></a><span>
</span><a name="line-3482"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="GivenOrigin"><a href="TcRnTypes.html#GivenOrigin"><span class="hs-identifier">GivenOrigin</span></a></a><span> </span><a href="TcRnTypes.html#SkolemInfo"><span class="hs-identifier hs-type">SkolemInfo</span></a><span>
</span><a name="line-3483"></a><span>
</span><a name="line-3484"></a><span>  </span><span class="hs-comment">-- All the others are for *wanted* constraints</span><span>
</span><a name="line-3485"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="OccurrenceOf"><a href="TcRnTypes.html#OccurrenceOf"><span class="hs-identifier">OccurrenceOf</span></a></a><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>              </span><span class="hs-comment">-- Occurrence of an overloaded identifier</span><span>
</span><a name="line-3486"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="OccurrenceOfRecSel"><a href="TcRnTypes.html#OccurrenceOfRecSel"><span class="hs-identifier">OccurrenceOfRecSel</span></a></a><span> </span><a href="RdrName.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a><span>     </span><span class="hs-comment">-- Occurrence of a record selector</span><span>
</span><a name="line-3487"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AppOrigin"><a href="TcRnTypes.html#AppOrigin"><span class="hs-identifier">AppOrigin</span></a></a><span>                      </span><span class="hs-comment">-- An application of some kind</span><span>
</span><a name="line-3488"></a><span>
</span><a name="line-3489"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SpecPragOrigin"><a href="TcRnTypes.html#SpecPragOrigin"><span class="hs-identifier">SpecPragOrigin</span></a></a><span> </span><a href="TcType.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a><span>    </span><span class="hs-comment">-- Specialisation pragma for</span><span>
</span><a name="line-3490"></a><span>                                   </span><span class="hs-comment">-- function or instance</span><span>
</span><a name="line-3491"></a><span>
</span><a name="line-3492"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TypeEqOrigin"><a href="TcRnTypes.html#TypeEqOrigin"><span class="hs-identifier">TypeEqOrigin</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="uo_actual"><a href="TcRnTypes.html#uo_actual"><span class="hs-identifier">uo_actual</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-3493"></a><span>                 </span><span class="hs-special">,</span><span> </span><a name="uo_expected"><a href="TcRnTypes.html#uo_expected"><span class="hs-identifier">uo_expected</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span>
</span><a name="line-3494"></a><span>                 </span><span class="hs-special">,</span><span> </span><a name="uo_thing"><a href="TcRnTypes.html#uo_thing"><span class="hs-identifier">uo_thing</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-3495"></a><span>                       </span><span class="hs-comment">-- ^ The thing that has type &quot;actual&quot;</span><span>
</span><a name="line-3496"></a><span>                 </span><span class="hs-special">,</span><span> </span><a name="uo_visible"><a href="TcRnTypes.html#uo_visible"><span class="hs-identifier">uo_visible</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3497"></a><span>                       </span><span class="hs-comment">-- ^ Is at least one of the three elements above visible?</span><span>
</span><a name="line-3498"></a><span>                       </span><span class="hs-comment">-- (Errors from the polymorphic subsumption check are considered</span><span>
</span><a name="line-3499"></a><span>                       </span><span class="hs-comment">-- visible.) Only used for prioritizing error messages.</span><span>
</span><a name="line-3500"></a><span>                 </span><span class="hs-special">}</span><span>
</span><a name="line-3501"></a><span>
</span><a name="line-3502"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="KindEqOrigin"><a href="TcRnTypes.html#KindEqOrigin"><span class="hs-identifier">KindEqOrigin</span></a></a><span>  </span><span class="hs-comment">-- See Note [Equalities with incompatible kinds] in TcCanonical.</span><span>
</span><a name="line-3503"></a><span>      </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- A kind equality arising from unifying these two types</span><span>
</span><a name="line-3504"></a><span>      </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>                  </span><span class="hs-comment">-- originally arising from this</span><span>
</span><a name="line-3505"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- the level of the eq this arises from</span><span>
</span><a name="line-3506"></a><span>
</span><a name="line-3507"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IPOccOrigin"><a href="TcRnTypes.html#IPOccOrigin"><span class="hs-identifier">IPOccOrigin</span></a></a><span>  </span><a href="HsTypes.html#HsIPName"><span class="hs-identifier hs-type">HsIPName</span></a><span>       </span><span class="hs-comment">-- Occurrence of an implicit parameter</span><span>
</span><a name="line-3508"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="OverLabelOrigin"><a href="TcRnTypes.html#OverLabelOrigin"><span class="hs-identifier">OverLabelOrigin</span></a></a><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span>  </span><span class="hs-comment">-- Occurrence of an overloaded label</span><span>
</span><a name="line-3509"></a><span>
</span><a name="line-3510"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LiteralOrigin"><a href="TcRnTypes.html#LiteralOrigin"><span class="hs-identifier">LiteralOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="HsLit.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Occurrence of a literal</span><span>
</span><a name="line-3511"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="NegateOrigin"><a href="TcRnTypes.html#NegateOrigin"><span class="hs-identifier">NegateOrigin</span></a></a><span>                        </span><span class="hs-comment">-- Occurrence of syntactic negation</span><span>
</span><a name="line-3512"></a><span>
</span><a name="line-3513"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ArithSeqOrigin"><a href="TcRnTypes.html#ArithSeqOrigin"><span class="hs-identifier">ArithSeqOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#ArithSeqInfo"><span class="hs-identifier hs-type">ArithSeqInfo</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- [x..], [x..y] etc</span><span>
</span><a name="line-3514"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AssocFamPatOrigin"><a href="TcRnTypes.html#AssocFamPatOrigin"><span class="hs-identifier">AssocFamPatOrigin</span></a></a><span>   </span><span class="hs-comment">-- When matching the patterns of an associated</span><span>
</span><a name="line-3515"></a><span>                        </span><span class="hs-comment">-- family instance with that of its parent class</span><span>
</span><a name="line-3516"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SectionOrigin"><a href="TcRnTypes.html#SectionOrigin"><span class="hs-identifier">SectionOrigin</span></a></a><span>
</span><a name="line-3517"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TupleOrigin"><a href="TcRnTypes.html#TupleOrigin"><span class="hs-identifier">TupleOrigin</span></a></a><span>         </span><span class="hs-comment">-- (..,..)</span><span>
</span><a name="line-3518"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ExprSigOrigin"><a href="TcRnTypes.html#ExprSigOrigin"><span class="hs-identifier">ExprSigOrigin</span></a></a><span>       </span><span class="hs-comment">-- e :: ty</span><span>
</span><a name="line-3519"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PatSigOrigin"><a href="TcRnTypes.html#PatSigOrigin"><span class="hs-identifier">PatSigOrigin</span></a></a><span>        </span><span class="hs-comment">-- p :: ty</span><span>
</span><a name="line-3520"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="PatOrigin"><a href="TcRnTypes.html#PatOrigin"><span class="hs-identifier">PatOrigin</span></a></a><span>           </span><span class="hs-comment">-- Instantiating a polytyped pattern at a constructor</span><span>
</span><a name="line-3521"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ProvCtxtOrigin"><a href="TcRnTypes.html#ProvCtxtOrigin"><span class="hs-identifier">ProvCtxtOrigin</span></a></a><span>      </span><span class="hs-comment">-- The &quot;provided&quot; context of a pattern synonym signature</span><span>
</span><a name="line-3522"></a><span>        </span><span class="hs-special">(</span><a href="HsBinds.html#PatSynBind"><span class="hs-identifier hs-type">PatSynBind</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Information about the pattern synonym, in</span><span>
</span><a name="line-3523"></a><span>                                 </span><span class="hs-comment">-- particular the name and the right-hand side</span><span>
</span><a name="line-3524"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RecordUpdOrigin"><a href="TcRnTypes.html#RecordUpdOrigin"><span class="hs-identifier">RecordUpdOrigin</span></a></a><span>
</span><a name="line-3525"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ViewPatOrigin"><a href="TcRnTypes.html#ViewPatOrigin"><span class="hs-identifier">ViewPatOrigin</span></a></a><span>
</span><a name="line-3526"></a><span>
</span><a name="line-3527"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ScOrigin"><a href="TcRnTypes.html#ScOrigin"><span class="hs-identifier">ScOrigin</span></a></a><span> </span><a href="TcType.html#TypeSize"><span class="hs-identifier hs-type">TypeSize</span></a><span>   </span><span class="hs-comment">-- Typechecking superclasses of an instance declaration</span><span>
</span><a name="line-3528"></a><span>                        </span><span class="hs-comment">-- If the instance head is C ty1 .. tyn</span><span>
</span><a name="line-3529"></a><span>                        </span><span class="hs-comment">--    then TypeSize = sizeTypes [ty1, .., tyn]</span><span>
</span><a name="line-3530"></a><span>                        </span><span class="hs-comment">-- See Note [Solving superclass constraints] in TcInstDcls</span><span>
</span><a name="line-3531"></a><span>
</span><a name="line-3532"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DerivClauseOrigin"><a href="TcRnTypes.html#DerivClauseOrigin"><span class="hs-identifier">DerivClauseOrigin</span></a></a><span>   </span><span class="hs-comment">-- Typechecking a deriving clause (as opposed to</span><span>
</span><a name="line-3533"></a><span>                        </span><span class="hs-comment">-- standalone deriving).</span><span>
</span><a name="line-3534"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DerivOriginDC"><a href="TcRnTypes.html#DerivOriginDC"><span class="hs-identifier">DerivOriginDC</span></a></a><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3535"></a><span>      </span><span class="hs-comment">-- Checking constraints arising from this data con and field index. The</span><span>
</span><a name="line-3536"></a><span>      </span><span class="hs-comment">-- Bool argument in DerivOriginDC and DerivOriginCoerce is True if</span><span>
</span><a name="line-3537"></a><span>      </span><span class="hs-comment">-- standalong deriving (with a wildcard constraint) is being used. This</span><span>
</span><a name="line-3538"></a><span>      </span><span class="hs-comment">-- is used to inform error messages on how to recommended fixes (e.g., if</span><span>
</span><a name="line-3539"></a><span>      </span><span class="hs-comment">-- the argument is True, then don't recommend &quot;use standalone deriving&quot;,</span><span>
</span><a name="line-3540"></a><span>      </span><span class="hs-comment">-- but rather &quot;fill in the wildcard constraint yourself&quot;).</span><span>
</span><a name="line-3541"></a><span>      </span><span class="hs-comment">-- See Note [Inferring the instance context] in TcDerivInfer</span><span>
</span><a name="line-3542"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DerivOriginCoerce"><a href="TcRnTypes.html#DerivOriginCoerce"><span class="hs-identifier">DerivOriginCoerce</span></a></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3543"></a><span>                        </span><span class="hs-comment">-- DerivOriginCoerce id ty1 ty2: Trying to coerce class method `id` from</span><span>
</span><a name="line-3544"></a><span>                        </span><span class="hs-comment">-- `ty1` to `ty2`.</span><span>
</span><a name="line-3545"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StandAloneDerivOrigin"><a href="TcRnTypes.html#StandAloneDerivOrigin"><span class="hs-identifier">StandAloneDerivOrigin</span></a></a><span> </span><span class="hs-comment">-- Typechecking stand-alone deriving. Useful for</span><span>
</span><a name="line-3546"></a><span>                          </span><span class="hs-comment">-- constraints coming from a wildcard constraint,</span><span>
</span><a name="line-3547"></a><span>                          </span><span class="hs-comment">-- e.g., deriving instance _ =&gt; Eq (Foo a)</span><span>
</span><a name="line-3548"></a><span>                          </span><span class="hs-comment">-- See Note [Inferring the instance context]</span><span>
</span><a name="line-3549"></a><span>                          </span><span class="hs-comment">-- in TcDerivInfer</span><span>
</span><a name="line-3550"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DefaultOrigin"><a href="TcRnTypes.html#DefaultOrigin"><span class="hs-identifier">DefaultOrigin</span></a></a><span>       </span><span class="hs-comment">-- Typechecking a default decl</span><span>
</span><a name="line-3551"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DoOrigin"><a href="TcRnTypes.html#DoOrigin"><span class="hs-identifier">DoOrigin</span></a></a><span>            </span><span class="hs-comment">-- Arising from a do expression</span><span>
</span><a name="line-3552"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="DoPatOrigin"><a href="TcRnTypes.html#DoPatOrigin"><span class="hs-identifier">DoPatOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="HsPat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Arising from a failable pattern in</span><span>
</span><a name="line-3553"></a><span>                             </span><span class="hs-comment">-- a do expression</span><span>
</span><a name="line-3554"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MCompOrigin"><a href="TcRnTypes.html#MCompOrigin"><span class="hs-identifier">MCompOrigin</span></a></a><span>         </span><span class="hs-comment">-- Arising from a monad comprehension</span><span>
</span><a name="line-3555"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MCompPatOrigin"><a href="TcRnTypes.html#MCompPatOrigin"><span class="hs-identifier">MCompPatOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="HsPat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Arising from a failable pattern in a</span><span>
</span><a name="line-3556"></a><span>                                </span><span class="hs-comment">-- monad comprehension</span><span>
</span><a name="line-3557"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IfOrigin"><a href="TcRnTypes.html#IfOrigin"><span class="hs-identifier">IfOrigin</span></a></a><span>            </span><span class="hs-comment">-- Arising from an if statement</span><span>
</span><a name="line-3558"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ProcOrigin"><a href="TcRnTypes.html#ProcOrigin"><span class="hs-identifier">ProcOrigin</span></a></a><span>          </span><span class="hs-comment">-- Arising from a proc expression</span><span>
</span><a name="line-3559"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AnnOrigin"><a href="TcRnTypes.html#AnnOrigin"><span class="hs-identifier">AnnOrigin</span></a></a><span>           </span><span class="hs-comment">-- An annotation</span><span>
</span><a name="line-3560"></a><span>
</span><a name="line-3561"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FunDepOrigin1"><a href="TcRnTypes.html#FunDepOrigin1"><span class="hs-identifier">FunDepOrigin1</span></a></a><span>       </span><span class="hs-comment">-- A functional dependency from combining</span><span>
</span><a name="line-3562"></a><span>        </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>      </span><span class="hs-comment">-- This constraint arising from ...</span><span>
</span><a name="line-3563"></a><span>        </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span>      </span><span class="hs-comment">-- and this constraint arising from ...</span><span>
</span><a name="line-3564"></a><span>
</span><a name="line-3565"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FunDepOrigin2"><a href="TcRnTypes.html#FunDepOrigin2"><span class="hs-identifier">FunDepOrigin2</span></a></a><span>       </span><span class="hs-comment">-- A functional dependency from combining</span><span>
</span><a name="line-3566"></a><span>        </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>   </span><span class="hs-comment">-- This constraint arising from ...</span><span>
</span><a name="line-3567"></a><span>        </span><a href="TyCoRep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>    </span><span class="hs-comment">-- and this top-level instance</span><span>
</span><a name="line-3568"></a><span>        </span><span class="hs-comment">-- We only need a CtOrigin on the first, because the location</span><span>
</span><a name="line-3569"></a><span>        </span><span class="hs-comment">-- is pinned on the entire error message</span><span>
</span><a name="line-3570"></a><span>
</span><a name="line-3571"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="HoleOrigin"><a href="TcRnTypes.html#HoleOrigin"><span class="hs-identifier">HoleOrigin</span></a></a><span>
</span><a name="line-3572"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UnboundOccurrenceOf"><a href="TcRnTypes.html#UnboundOccurrenceOf"><span class="hs-identifier">UnboundOccurrenceOf</span></a></a><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span>
</span><a name="line-3573"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ListOrigin"><a href="TcRnTypes.html#ListOrigin"><span class="hs-identifier">ListOrigin</span></a></a><span>          </span><span class="hs-comment">-- An overloaded list</span><span>
</span><a name="line-3574"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StaticOrigin"><a href="TcRnTypes.html#StaticOrigin"><span class="hs-identifier">StaticOrigin</span></a></a><span>        </span><span class="hs-comment">-- A static form</span><span>
</span><a name="line-3575"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FailablePattern"><a href="TcRnTypes.html#FailablePattern"><span class="hs-identifier">FailablePattern</span></a></a><span> </span><span class="hs-special">(</span><a href="HsPat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a><span> </span><a href="HsExtension.html#GhcTcId"><span class="hs-identifier hs-type">GhcTcId</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- A failable pattern in do-notation for the</span><span>
</span><a name="line-3576"></a><span>                                   </span><span class="hs-comment">-- MonadFail Proposal (MFP). Obsolete when</span><span>
</span><a name="line-3577"></a><span>                                   </span><span class="hs-comment">-- actual desugaring to MonadFail.fail is</span><span>
</span><a name="line-3578"></a><span>                                   </span><span class="hs-comment">-- live.</span><span>
</span><a name="line-3579"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="Shouldn%27tHappenOrigin"><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier">Shouldn'tHappenOrigin</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-3580"></a><span>                            </span><span class="hs-comment">-- the user should never see this one,</span><span>
</span><a name="line-3581"></a><span>                            </span><span class="hs-comment">-- unless ImpredicativeTypes is on, where all</span><span>
</span><a name="line-3582"></a><span>                            </span><span class="hs-comment">-- bets are off</span><span>
</span><a name="line-3583"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InstProvidedOrigin"><a href="TcRnTypes.html#InstProvidedOrigin"><span class="hs-identifier">InstProvidedOrigin</span></a></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span>
</span><a name="line-3584"></a><span>        </span><span class="hs-comment">-- Skolem variable arose when we were testing if an instance</span><span>
</span><a name="line-3585"></a><span>        </span><span class="hs-comment">-- is solvable or not.</span><span>
</span><a name="line-3586"></a><span>
</span><a name="line-3587"></a><span class="hs-comment">-- | Flag to see whether we're type-checking terms or kind-checking types</span><span>
</span><a name="line-3588"></a><span class="hs-keyword">data</span><span> </span><a name="TypeOrKind"><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier">TypeOrKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TypeLevel"><a href="TcRnTypes.html#TypeLevel"><span class="hs-identifier">TypeLevel</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="KindLevel"><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier">KindLevel</span></a></a><span>
</span><a name="line-3589"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>
</span><a name="line-3590"></a><span>
</span><a name="line-3591"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3592"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a href="TcRnTypes.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;TypeLevel&quot;</span><span>
</span><a name="line-3593"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;KindLevel&quot;</span><span>
</span><a name="line-3594"></a><span>
</span><a name="line-3595"></a><span class="hs-identifier">isTypeLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3596"></a><a name="isTypeLevel"><a href="TcRnTypes.html#isTypeLevel"><span class="hs-identifier">isTypeLevel</span></a></a><span> </span><a href="TcRnTypes.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3597"></a><span class="hs-identifier">isTypeLevel</span><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-3598"></a><span>
</span><a name="line-3599"></a><span class="hs-identifier">isKindLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3600"></a><a name="isKindLevel"><a href="TcRnTypes.html#isKindLevel"><span class="hs-identifier">isKindLevel</span></a></a><span> </span><a href="TcRnTypes.html#TypeLevel"><span class="hs-identifier hs-var">TypeLevel</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-3601"></a><span class="hs-identifier">isKindLevel</span><span> </span><a href="TcRnTypes.html#KindLevel"><span class="hs-identifier hs-var">KindLevel</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3602"></a><span>
</span><a name="line-3603"></a><span class="hs-comment">-- An origin is visible if the place where the constraint arises is manifest</span><span>
</span><a name="line-3604"></a><span class="hs-comment">-- in user code. Currently, all origins are visible except for invisible</span><span>
</span><a name="line-3605"></a><span class="hs-comment">-- TypeEqOrigins. This is used when choosing which error of</span><span>
</span><a name="line-3606"></a><span class="hs-comment">-- several to report</span><span>
</span><a name="line-3607"></a><span class="hs-identifier">isVisibleOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3608"></a><a name="isVisibleOrigin"><a href="TcRnTypes.html#isVisibleOrigin"><span class="hs-identifier">isVisibleOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TypeEqOrigin"><span class="hs-identifier hs-var">TypeEqOrigin</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">uo_visible</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146242"><a href="#local-6989586621684146242"><span class="hs-identifier">vis</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146242"><span class="hs-identifier hs-var">vis</span></a><span>
</span><a name="line-3609"></a><span class="hs-identifier">isVisibleOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#KindEqOrigin"><span class="hs-identifier hs-var">KindEqOrigin</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146243"><a href="#local-6989586621684146243"><span class="hs-identifier">sub_orig</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#isVisibleOrigin"><span class="hs-identifier hs-var">isVisibleOrigin</span></a><span> </span><a href="#local-6989586621684146243"><span class="hs-identifier hs-var">sub_orig</span></a><span>
</span><a name="line-3610"></a><span class="hs-identifier">isVisibleOrigin</span><span> </span><span class="hs-identifier">_</span><span>                                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3611"></a><span>
</span><a name="line-3612"></a><span class="hs-comment">-- Converts a visible origin to an invisible one, if possible. Currently,</span><span>
</span><a name="line-3613"></a><span class="hs-comment">-- this works only for TypeEqOrigin</span><span>
</span><a name="line-3614"></a><span class="hs-identifier">toInvisibleOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-3615"></a><a name="toInvisibleOrigin"><a href="TcRnTypes.html#toInvisibleOrigin"><span class="hs-identifier">toInvisibleOrigin</span></a></a><span> </span><a name="local-6989586621684146244"><a href="#local-6989586621684146244"><span class="hs-identifier">orig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcRnTypes.html#TypeEqOrigin"><span class="hs-identifier hs-var">TypeEqOrigin</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146244"><span class="hs-identifier hs-var">orig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">uo_visible</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-3616"></a><span class="hs-identifier">toInvisibleOrigin</span><span> </span><a name="local-6989586621684146245"><a href="#local-6989586621684146245"><span class="hs-identifier">orig</span></a></a><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146245"><span class="hs-identifier hs-var">orig</span></a><span>
</span><a name="line-3617"></a><span>
</span><a name="line-3618"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3619"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#pprCtOrigin"><span class="hs-identifier hs-var">pprCtOrigin</span></a><span>
</span><a name="line-3620"></a><span>
</span><a name="line-3621"></a><span class="hs-identifier">ctoHerald</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-3622"></a><a name="ctoHerald"><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier">ctoHerald</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;arising from&quot;</span><span>
</span><a name="line-3623"></a><span>
</span><a name="line-3624"></a><span class="hs-comment">-- | Extract a suitable CtOrigin from a HsExpr</span><span>
</span><a name="line-3625"></a><span class="hs-identifier">lexprCtOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-3626"></a><a name="lexprCtOrigin"><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier">lexprCtOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146246"><a href="#local-6989586621684146246"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#exprCtOrigin"><span class="hs-identifier hs-var">exprCtOrigin</span></a><span> </span><a href="#local-6989586621684146246"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3627"></a><span>
</span><a name="line-3628"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsExpr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-3629"></a><a name="exprCtOrigin"><a href="TcRnTypes.html#exprCtOrigin"><span class="hs-identifier">exprCtOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146247"><a href="#local-6989586621684146247"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a><span> </span><a href="#local-6989586621684146247"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-3630"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsUnboundVar"><span class="hs-identifier hs-var">HsUnboundVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146248"><a href="#local-6989586621684146248"><span class="hs-identifier">uv</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#UnboundOccurrenceOf"><span class="hs-identifier hs-var">UnboundOccurrenceOf</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#unboundVarOcc"><span class="hs-identifier hs-var">unboundVarOcc</span></a><span> </span><a href="#local-6989586621684146248"><span class="hs-identifier hs-var">uv</span></a><span class="hs-special">)</span><span>
</span><a name="line-3631"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsConLikeOut"><span class="hs-identifier hs-var">HsConLikeOut</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprCtOrigin HsConLikeOut&quot;</span><span>
</span><a name="line-3632"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsRecFld"><span class="hs-identifier hs-var">HsRecFld</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146249"><a href="#local-6989586621684146249"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#OccurrenceOfRecSel"><span class="hs-identifier hs-var">OccurrenceOfRecSel</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a><span> </span><a href="#local-6989586621684146249"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-3633"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsOverLabel"><span class="hs-identifier hs-var">HsOverLabel</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146250"><a href="#local-6989586621684146250"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#OverLabelOrigin"><span class="hs-identifier hs-var">OverLabelOrigin</span></a><span> </span><a href="#local-6989586621684146250"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-3634"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsIPVar"><span class="hs-identifier hs-var">HsIPVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146251"><a href="#local-6989586621684146251"><span class="hs-identifier">ip</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#IPOccOrigin"><span class="hs-identifier hs-var">IPOccOrigin</span></a><span> </span><a href="#local-6989586621684146251"><span class="hs-identifier hs-var">ip</span></a><span>
</span><a name="line-3635"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsOverLit"><span class="hs-identifier hs-var">HsOverLit</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146252"><a href="#local-6989586621684146252"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#LiteralOrigin"><span class="hs-identifier hs-var">LiteralOrigin</span></a><span> </span><a href="#local-6989586621684146252"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-3636"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;concrete literal&quot;</span><span>
</span><a name="line-3637"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsLam"><span class="hs-identifier hs-var">HsLam</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146253"><a href="#local-6989586621684146253"><span class="hs-identifier">matches</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#matchesCtOrigin"><span class="hs-identifier hs-var">matchesCtOrigin</span></a><span> </span><a href="#local-6989586621684146253"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-3638"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsLamCase"><span class="hs-identifier hs-var">HsLamCase</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146254"><a href="#local-6989586621684146254"><span class="hs-identifier">ms</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#matchesCtOrigin"><span class="hs-identifier hs-var">matchesCtOrigin</span></a><span> </span><a href="#local-6989586621684146254"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-3639"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146255"><a href="#local-6989586621684146255"><span class="hs-identifier">e1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146255"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-3640"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsAppType"><span class="hs-identifier hs-var">HsAppType</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146256"><a href="#local-6989586621684146256"><span class="hs-identifier">e1</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146256"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-3641"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#OpApp"><span class="hs-identifier hs-var">OpApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146257"><a href="#local-6989586621684146257"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146257"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-3642"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#NegApp"><span class="hs-identifier hs-var">NegApp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146258"><a href="#local-6989586621684146258"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146258"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3643"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsPar"><span class="hs-identifier hs-var">HsPar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146259"><a href="#local-6989586621684146259"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146259"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3644"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#SectionL"><span class="hs-identifier hs-var">SectionL</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#SectionOrigin"><span class="hs-identifier hs-var">SectionOrigin</span></a><span>
</span><a name="line-3645"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#SectionR"><span class="hs-identifier hs-var">SectionR</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#SectionOrigin"><span class="hs-identifier hs-var">SectionOrigin</span></a><span>
</span><a name="line-3646"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#ExplicitTuple"><span class="hs-identifier hs-var">ExplicitTuple</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;explicit tuple&quot;</span><span>
</span><a name="line-3647"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><a href="HsExpr.html#ExplicitSum"><span class="hs-identifier hs-var">ExplicitSum</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;explicit sum&quot;</span><span>
</span><a name="line-3648"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsCase"><span class="hs-identifier hs-var">HsCase</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146260"><a href="#local-6989586621684146260"><span class="hs-identifier">matches</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#matchesCtOrigin"><span class="hs-identifier hs-var">matchesCtOrigin</span></a><span> </span><a href="#local-6989586621684146260"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-3649"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsIf"><span class="hs-identifier hs-var">HsIf</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684146261"><a href="#local-6989586621684146261"><span class="hs-identifier">syn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#exprCtOrigin"><span class="hs-identifier hs-var">exprCtOrigin</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">syn_expr</span><span> </span><a href="#local-6989586621684146261"><span class="hs-identifier hs-var">syn</span></a><span class="hs-special">)</span><span>
</span><a name="line-3650"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsIf"><span class="hs-identifier hs-var">HsIf</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;if expression&quot;</span><span>
</span><a name="line-3651"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsMultiIf"><span class="hs-identifier hs-var">HsMultiIf</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146262"><a href="#local-6989586621684146262"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lGRHSCtOrigin"><span class="hs-identifier hs-var">lGRHSCtOrigin</span></a><span> </span><a href="#local-6989586621684146262"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-3652"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsLet"><span class="hs-identifier hs-var">HsLet</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146263"><a href="#local-6989586621684146263"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146263"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3653"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsDo"><span class="hs-identifier hs-var">HsDo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#DoOrigin"><span class="hs-identifier hs-var">DoOrigin</span></a><span>
</span><a name="line-3654"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#ExplicitList"><span class="hs-identifier hs-var">ExplicitList</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;list&quot;</span><span>
</span><a name="line-3655"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#RecordCon"><span class="hs-identifier hs-var">RecordCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;record construction&quot;</span><span>
</span><a name="line-3656"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#RecordUpd"><span class="hs-identifier hs-var">RecordUpd</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;record update&quot;</span><span>
</span><a name="line-3657"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#ExprWithTySig"><span class="hs-identifier hs-var">ExprWithTySig</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ExprSigOrigin"><span class="hs-identifier hs-var">ExprSigOrigin</span></a><span>
</span><a name="line-3658"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;arithmetic sequence&quot;</span><span>
</span><a name="line-3659"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsSCC"><span class="hs-identifier hs-var">HsSCC</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146264"><a href="#local-6989586621684146264"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146264"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3660"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsCoreAnn"><span class="hs-identifier hs-var">HsCoreAnn</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146265"><a href="#local-6989586621684146265"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146265"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3661"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsBracket"><span class="hs-identifier hs-var">HsBracket</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;TH bracket&quot;</span><span>
</span><a name="line-3662"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsRnBracketOut"><span class="hs-identifier hs-var">HsRnBracketOut</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;HsRnBracketOut&quot;</span><span>
</span><a name="line-3663"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsTcBracketOut"><span class="hs-identifier hs-var">HsTcBracketOut</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprCtOrigin HsTcBracketOut&quot;</span><span>
</span><a name="line-3664"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsSpliceE"><span class="hs-identifier hs-var">HsSpliceE</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;TH splice&quot;</span><span>
</span><a name="line-3665"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsProc"><span class="hs-identifier hs-var">HsProc</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;proc&quot;</span><span>
</span><a name="line-3666"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsStatic"><span class="hs-identifier hs-var">HsStatic</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;static expression&quot;</span><span>
</span><a name="line-3667"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsArrApp"><span class="hs-identifier hs-var">HsArrApp</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprCtOrigin HsArrApp&quot;</span><span>
</span><a name="line-3668"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsArrForm"><span class="hs-identifier hs-var">HsArrForm</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprCtOrigin HsArrForm&quot;</span><span>
</span><a name="line-3669"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsTick"><span class="hs-identifier hs-var">HsTick</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146266"><a href="#local-6989586621684146266"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146266"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3670"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsBinTick"><span class="hs-identifier hs-var">HsBinTick</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146267"><a href="#local-6989586621684146267"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146267"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3671"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsTickPragma"><span class="hs-identifier hs-var">HsTickPragma</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146268"><a href="#local-6989586621684146268"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a><span> </span><a href="#local-6989586621684146268"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3672"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#EWildPat"><span class="hs-identifier hs-var">EWildPat</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprCtOrigin EWildPat&quot;</span><span>
</span><a name="line-3673"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#EAsPat"><span class="hs-identifier hs-var">EAsPat</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprCtOrigin EAsPat&quot;</span><span>
</span><a name="line-3674"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#EViewPat"><span class="hs-identifier hs-var">EViewPat</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprCtOrigin EViewPat&quot;</span><span>
</span><a name="line-3675"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#ELazyPat"><span class="hs-identifier hs-var">ELazyPat</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprCtOrigin ELazyPat&quot;</span><span>
</span><a name="line-3676"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#HsWrap"><span class="hs-identifier hs-var">HsWrap</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprCtOrigin HsWrap&quot;</span><span>
</span><a name="line-3677"></a><span class="hs-identifier">exprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#XExpr"><span class="hs-identifier hs-var">XExpr</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;exprCtOrigin XExpr&quot;</span><span>
</span><a name="line-3678"></a><span>
</span><a name="line-3679"></a><span class="hs-comment">-- | Extract a suitable CtOrigin from a MatchGroup</span><span>
</span><a name="line-3680"></a><span class="hs-identifier">matchesCtOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsExpr.html#MatchGroup"><span class="hs-identifier hs-type">MatchGroup</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-3681"></a><a name="matchesCtOrigin"><a href="TcRnTypes.html#matchesCtOrigin"><span class="hs-identifier">matchesCtOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#MG"><span class="hs-identifier hs-var">MG</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mg_alts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146269"><a href="#local-6989586621684146269"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-3682"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146270"><a href="#local-6989586621684146270"><span class="hs-identifier">match</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684146269"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-3683"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="HsExpr.html#Match"><span class="hs-identifier hs-var">Match</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_grhss</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146271"><a href="#local-6989586621684146271"><span class="hs-identifier">grhss</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684146270"><span class="hs-identifier hs-var">match</span></a><span>
</span><a name="line-3684"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#grhssCtOrigin"><span class="hs-identifier hs-var">grhssCtOrigin</span></a><span> </span><a href="#local-6989586621684146271"><span class="hs-identifier hs-var">grhss</span></a><span>
</span><a name="line-3685"></a><span>
</span><a name="line-3686"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-3687"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;multi-way match&quot;</span><span>
</span><a name="line-3688"></a><span class="hs-identifier">matchesCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#XMatchGroup"><span class="hs-identifier hs-var">XMatchGroup</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;matchesCtOrigin&quot;</span><span>
</span><a name="line-3689"></a><span>
</span><a name="line-3690"></a><span class="hs-comment">-- | Extract a suitable CtOrigin from guarded RHSs</span><span>
</span><a name="line-3691"></a><span class="hs-identifier">grhssCtOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsExpr.html#GRHSs"><span class="hs-identifier hs-type">GRHSs</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-3692"></a><a name="grhssCtOrigin"><a href="TcRnTypes.html#grhssCtOrigin"><span class="hs-identifier">grhssCtOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#GRHSs"><span class="hs-identifier hs-var">GRHSs</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">grhssGRHSs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146272"><a href="#local-6989586621684146272"><span class="hs-identifier">lgrhss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#lGRHSCtOrigin"><span class="hs-identifier hs-var">lGRHSCtOrigin</span></a><span> </span><a href="#local-6989586621684146272"><span class="hs-identifier hs-var">lgrhss</span></a><span>
</span><a name="line-3693"></a><span class="hs-identifier">grhssCtOrigin</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#XGRHSs"><span class="hs-identifier hs-var">XGRHSs</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;grhssCtOrigin&quot;</span><span>
</span><a name="line-3694"></a><span>
</span><a name="line-3695"></a><span class="hs-comment">-- | Extract a suitable CtOrigin from a list of guarded RHSs</span><span>
</span><a name="line-3696"></a><span class="hs-identifier">lGRHSCtOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsExpr.html#LGRHS"><span class="hs-identifier hs-type">LGRHS</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span>
</span><a name="line-3697"></a><a name="lGRHSCtOrigin"><a href="TcRnTypes.html#lGRHSCtOrigin"><span class="hs-identifier">lGRHSCtOrigin</span></a></a><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#GRHS"><span class="hs-identifier hs-var">GRHS</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146273"><a href="#local-6989586621684146273"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#exprCtOrigin"><span class="hs-identifier hs-var">exprCtOrigin</span></a><span> </span><a href="#local-6989586621684146273"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3698"></a><span class="hs-identifier">lGRHSCtOrigin</span><span> </span><span class="hs-special">[</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HsExpr.html#XGRHS"><span class="hs-identifier hs-var">XGRHS</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;lGRHSCtOrigin&quot;</span><span>
</span><a name="line-3699"></a><span class="hs-identifier">lGRHSCtOrigin</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><span class="hs-string">&quot;multi-way GRHS&quot;</span><span>
</span><a name="line-3700"></a><span>
</span><a name="line-3701"></a><span class="hs-identifier">pprCtLoc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-3702"></a><span class="hs-comment">-- &quot;arising from ... at ...&quot;</span><span>
</span><a name="line-3703"></a><span class="hs-comment">-- Not an instance of Outputable because of the &quot;arising from&quot; prefix</span><span>
</span><a name="line-3704"></a><a name="pprCtLoc"><a href="TcRnTypes.html#pprCtLoc"><span class="hs-identifier">pprCtLoc</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#CtLoc"><span class="hs-identifier hs-var">CtLoc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ctl_origin</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146274"><a href="#local-6989586621684146274"><span class="hs-identifier">o</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684146275"><a href="#local-6989586621684146275"><span class="hs-identifier">lcl</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-3705"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="TcRnTypes.html#pprCtOrigin"><span class="hs-identifier hs-var">pprCtOrigin</span></a><span> </span><a href="#local-6989586621684146274"><span class="hs-identifier hs-var">o</span></a><span>
</span><a name="line-3706"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;at&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcl_loc</span><span> </span><a href="#local-6989586621684146275"><span class="hs-identifier hs-var">lcl</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-3707"></a><span>
</span><a name="line-3708"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-3709"></a><span class="hs-comment">-- &quot;arising from ...&quot;</span><span>
</span><a name="line-3710"></a><span class="hs-comment">-- Not an instance of Outputable because of the &quot;arising from&quot; prefix</span><span>
</span><a name="line-3711"></a><a name="pprCtOrigin"><a href="TcRnTypes.html#pprCtOrigin"><span class="hs-identifier">pprCtOrigin</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#GivenOrigin"><span class="hs-identifier hs-var">GivenOrigin</span></a><span> </span><a name="local-6989586621684146276"><a href="#local-6989586621684146276"><span class="hs-identifier">sk</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146276"><span class="hs-identifier hs-var">sk</span></a><span>
</span><a name="line-3712"></a><span>
</span><a name="line-3713"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#SpecPragOrigin"><span class="hs-identifier hs-var">SpecPragOrigin</span></a><span> </span><a name="local-6989586621684146277"><a href="#local-6989586621684146277"><span class="hs-identifier">ctxt</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3714"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684146277"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-3715"></a><span>       </span><a href="TcType.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a><span> </span><a name="local-6989586621684146278"><a href="#local-6989586621684146278"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a SPECIALISE pragma for&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146278"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-3716"></a><span>       </span><a href="TcType.html#SpecInstCtxt"><span class="hs-identifier hs-var">SpecInstCtxt</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a SPECIALISE INSTANCE pragma&quot;</span><span>
</span><a name="line-3717"></a><span>       </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a SPECIALISE pragma&quot;</span><span>  </span><span class="hs-comment">-- Never happens I think</span><span>
</span><a name="line-3718"></a><span>
</span><a name="line-3719"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#FunDepOrigin1"><span class="hs-identifier hs-var">FunDepOrigin1</span></a><span> </span><a name="local-6989586621684146279"><a href="#local-6989586621684146279"><span class="hs-identifier">pred1</span></a></a><span> </span><a name="local-6989586621684146280"><a href="#local-6989586621684146280"><span class="hs-identifier">loc1</span></a></a><span> </span><a name="local-6989586621684146281"><a href="#local-6989586621684146281"><span class="hs-identifier">pred2</span></a></a><span> </span><a name="local-6989586621684146282"><a href="#local-6989586621684146282"><span class="hs-identifier">loc2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3720"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a functional dependency between constraints:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-3721"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146279"><span class="hs-identifier hs-var">pred1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#pprCtLoc"><span class="hs-identifier hs-var">pprCtLoc</span></a><span> </span><a href="#local-6989586621684146280"><span class="hs-identifier hs-var">loc1</span></a><span class="hs-special">)</span><span>
</span><a name="line-3722"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146281"><span class="hs-identifier hs-var">pred2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#pprCtLoc"><span class="hs-identifier hs-var">pprCtLoc</span></a><span> </span><a href="#local-6989586621684146282"><span class="hs-identifier hs-var">loc2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-3723"></a><span>
</span><a name="line-3724"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#FunDepOrigin2"><span class="hs-identifier hs-var">FunDepOrigin2</span></a><span> </span><a name="local-6989586621684146283"><a href="#local-6989586621684146283"><span class="hs-identifier">pred1</span></a></a><span> </span><a name="local-6989586621684146284"><a href="#local-6989586621684146284"><span class="hs-identifier">orig1</span></a></a><span> </span><a name="local-6989586621684146285"><a href="#local-6989586621684146285"><span class="hs-identifier">pred2</span></a></a><span> </span><a name="local-6989586621684146286"><a href="#local-6989586621684146286"><span class="hs-identifier">loc2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3725"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a functional dependency between:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-3726"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;constraint&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146283"><span class="hs-identifier hs-var">pred1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3727"></a><span>                    </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#pprCtOrigin"><span class="hs-identifier hs-var">pprCtOrigin</span></a><span> </span><a href="#local-6989586621684146284"><span class="hs-identifier hs-var">orig1</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-3728"></a><span>               </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;instance&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146285"><span class="hs-identifier hs-var">pred2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3729"></a><span>                    </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;at&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146286"><span class="hs-identifier hs-var">loc2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-3730"></a><span>
</span><a name="line-3731"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#KindEqOrigin"><span class="hs-identifier hs-var">KindEqOrigin</span></a><span> </span><a name="local-6989586621684146287"><a href="#local-6989586621684146287"><span class="hs-identifier">t1</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684146288"><a href="#local-6989586621684146288"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-3732"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a kind equality arising from&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-3733"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146287"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'~'</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146288"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-3734"></a><span>
</span><a name="line-3735"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><a href="TcRnTypes.html#AssocFamPatOrigin"><span class="hs-identifier hs-var">AssocFamPatOrigin</span></a><span>
</span><a name="line-3736"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;when matching a family LHS with its class instance head&quot;</span><span>
</span><a name="line-3737"></a><span>
</span><a name="line-3738"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#KindEqOrigin"><span class="hs-identifier hs-var">KindEqOrigin</span></a><span> </span><a name="local-6989586621684146289"><a href="#local-6989586621684146289"><span class="hs-identifier">t1</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-3739"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a kind equality when matching&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-3740"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146289"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">)</span><span>
</span><a name="line-3741"></a><span>
</span><a name="line-3742"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#UnboundOccurrenceOf"><span class="hs-identifier hs-var">UnboundOccurrenceOf</span></a><span> </span><a name="local-6989586621684146290"><a href="#local-6989586621684146290"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3743"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an undeclared identifier&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146290"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-3744"></a><span>
</span><a name="line-3745"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#DerivOriginDC"><span class="hs-identifier hs-var">DerivOriginDC</span></a><span> </span><a name="local-6989586621684146291"><a href="#local-6989586621684146291"><span class="hs-identifier">dc</span></a></a><span> </span><a name="local-6989586621684146292"><a href="#local-6989586621684146292"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-3746"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#speakNth"><span class="hs-identifier hs-var">speakNth</span></a><span> </span><a href="#local-6989586621684146292"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-3747"></a><span>          </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;field of&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146291"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3748"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146293"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3749"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-3750"></a><span>    </span><a name="local-6989586621684146293"><a href="#local-6989586621684146293"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConOrigArgTys"><span class="hs-identifier hs-var">dataConOrigArgTys</span></a><span> </span><a href="#local-6989586621684146291"><span class="hs-identifier hs-var">dc</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146292"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-3751"></a><span>
</span><a name="line-3752"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#DerivOriginCoerce"><span class="hs-identifier hs-var">DerivOriginCoerce</span></a><span> </span><a name="local-6989586621684146294"><a href="#local-6989586621684146294"><span class="hs-identifier">meth</span></a></a><span> </span><a name="local-6989586621684146295"><a href="#local-6989586621684146295"><span class="hs-identifier">ty1</span></a></a><span> </span><a name="local-6989586621684146296"><a href="#local-6989586621684146296"><span class="hs-identifier">ty2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-3753"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the coercion of the method&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146294"><span class="hs-identifier hs-var">meth</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3754"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;from type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146295"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span>
</span><a name="line-3755"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;to type&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146296"><span class="hs-identifier hs-var">ty2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-3756"></a><span>
</span><a name="line-3757"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#DoPatOrigin"><span class="hs-identifier hs-var">DoPatOrigin</span></a><span> </span><a name="local-6989586621684146297"><a href="#local-6989586621684146297"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3758"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a do statement&quot;</span><span>
</span><a name="line-3759"></a><span>      </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-3760"></a><span>      </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;with the failable pattern&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146297"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>
</span><a name="line-3761"></a><span>
</span><a name="line-3762"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#MCompPatOrigin"><span class="hs-identifier hs-var">MCompPatOrigin</span></a><span> </span><a name="local-6989586621684146298"><a href="#local-6989586621684146298"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3763"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the failable pattern&quot;</span><span>
</span><a name="line-3764"></a><span>           </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146298"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>
</span><a name="line-3765"></a><span>           </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in a statement in a monad comprehension&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-3766"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#FailablePattern"><span class="hs-identifier hs-var">FailablePattern</span></a><span> </span><a name="local-6989586621684146299"><a href="#local-6989586621684146299"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3767"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the failable pattern&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146299"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>
</span><a name="line-3768"></a><span>      </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span>
</span><a name="line-3769"></a><span>      </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;(this will become an error in a future GHC release)&quot;</span><span>
</span><a name="line-3770"></a><span>
</span><a name="line-3771"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a><span> </span><a name="local-6989586621684146300"><a href="#local-6989586621684146300"><span class="hs-identifier">note</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3772"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684146301"><a href="#local-6989586621684146301"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-3773"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="GHC.LanguageExtensions.Type.html#ImpredicativeTypes"><span class="hs-identifier hs-var">LangExt.ImpredicativeTypes</span></a><span> </span><a href="#local-6989586621684146301"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-3774"></a><span>    </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a situation created by impredicative types&quot;</span><span>
</span><a name="line-3775"></a><span>    </span><span class="hs-keyword">else</span><span>
</span><a name="line-3776"></a><span>    </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;&lt;&lt; This should not appear in error messages. If you see this&quot;</span><span>
</span><a name="line-3777"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;in an error message, please report a bug mentioning&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621684146300"><span class="hs-identifier hs-var">note</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;at&quot;</span><span>
</span><a name="line-3778"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;https://ghc.haskell.org/trac/ghc/wiki/ReportABug &gt;&gt;&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-3779"></a><span>
</span><a name="line-3780"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ProvCtxtOrigin"><span class="hs-identifier hs-var">ProvCtxtOrigin</span></a><span> </span><a href="HsBinds.html#PSB"><span class="hs-identifier hs-var">PSB</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684146302"><a href="#local-6989586621684146302"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-3781"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the \&quot;provided\&quot; constraints claimed by&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-3782"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the signature of&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146302"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3783"></a><span>
</span><a name="line-3784"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#InstProvidedOrigin"><span class="hs-identifier hs-var">InstProvidedOrigin</span></a><span> </span><a name="local-6989586621684146303"><a href="#local-6989586621684146303"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621684146304"><a href="#local-6989586621684146304"><span class="hs-identifier">cls_inst</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3785"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;arising when attempting to show that&quot;</span><span>
</span><a name="line-3786"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146304"><span class="hs-identifier hs-var">cls_inst</span></a><span>
</span><a name="line-3787"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;is provided by&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146303"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-3788"></a><span>
</span><a name="line-3789"></a><span class="hs-identifier">pprCtOrigin</span><span> </span><a name="local-6989586621684146305"><a href="#local-6989586621684146305"><span class="hs-identifier">simple_origin</span></a></a><span>
</span><a name="line-3790"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#ctoHerald"><span class="hs-identifier hs-var">ctoHerald</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="TcRnTypes.html#pprCtO"><span class="hs-identifier hs-var">pprCtO</span></a><span> </span><a href="#local-6989586621684146305"><span class="hs-identifier hs-var">simple_origin</span></a><span>
</span><a name="line-3791"></a><span>
</span><a name="line-3792"></a><span class="hs-comment">-- | Short one-liners</span><span>
</span><a name="line-3793"></a><span class="hs-identifier">pprCtO</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-3794"></a><a name="pprCtO"><a href="TcRnTypes.html#pprCtO"><span class="hs-identifier">pprCtO</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a><span> </span><a name="local-6989586621684146306"><a href="#local-6989586621684146306"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a use of&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146306"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-3795"></a><span class="hs-identifier">pprCtO</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#OccurrenceOfRecSel"><span class="hs-identifier hs-var">OccurrenceOfRecSel</span></a><span> </span><a name="local-6989586621684146307"><a href="#local-6989586621684146307"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a use of&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146307"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-3796"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#AppOrigin"><span class="hs-identifier hs-var">AppOrigin</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an application&quot;</span><span>
</span><a name="line-3797"></a><span class="hs-identifier">pprCtO</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#IPOccOrigin"><span class="hs-identifier hs-var">IPOccOrigin</span></a><span> </span><a name="local-6989586621684146308"><a href="#local-6989586621684146308"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a use of implicit parameter&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146308"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-3798"></a><span class="hs-identifier">pprCtO</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#OverLabelOrigin"><span class="hs-identifier hs-var">OverLabelOrigin</span></a><span> </span><a name="local-6989586621684146309"><a href="#local-6989586621684146309"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the overloaded label&quot;</span><span>
</span><a name="line-3799"></a><span>                                    </span><span class="hs-special">,</span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'#'</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146309"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-3800"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#RecordUpdOrigin"><span class="hs-identifier hs-var">RecordUpdOrigin</span></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a record update&quot;</span><span>
</span><a name="line-3801"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#ExprSigOrigin"><span class="hs-identifier hs-var">ExprSigOrigin</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an expression type signature&quot;</span><span>
</span><a name="line-3802"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#PatSigOrigin"><span class="hs-identifier hs-var">PatSigOrigin</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a pattern type signature&quot;</span><span>
</span><a name="line-3803"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#PatOrigin"><span class="hs-identifier hs-var">PatOrigin</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a pattern&quot;</span><span>
</span><a name="line-3804"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#ViewPatOrigin"><span class="hs-identifier hs-var">ViewPatOrigin</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a view pattern&quot;</span><span>
</span><a name="line-3805"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#IfOrigin"><span class="hs-identifier hs-var">IfOrigin</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an if expression&quot;</span><span>
</span><a name="line-3806"></a><span class="hs-identifier">pprCtO</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#LiteralOrigin"><span class="hs-identifier hs-var">LiteralOrigin</span></a><span> </span><a name="local-6989586621684146310"><a href="#local-6989586621684146310"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the literal&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146310"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-3807"></a><span class="hs-identifier">pprCtO</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a><span> </span><a name="local-6989586621684146311"><a href="#local-6989586621684146311"><span class="hs-identifier">seq</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the arithmetic sequence&quot;</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146311"><span class="hs-identifier hs-var">seq</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-3808"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#SectionOrigin"><span class="hs-identifier hs-var">SectionOrigin</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an operator section&quot;</span><span>
</span><a name="line-3809"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#AssocFamPatOrigin"><span class="hs-identifier hs-var">AssocFamPatOrigin</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the LHS of a famly instance&quot;</span><span>
</span><a name="line-3810"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#TupleOrigin"><span class="hs-identifier hs-var">TupleOrigin</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a tuple&quot;</span><span>
</span><a name="line-3811"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#NegateOrigin"><span class="hs-identifier hs-var">NegateOrigin</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a use of syntactic negation&quot;</span><span>
</span><a name="line-3812"></a><span class="hs-identifier">pprCtO</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#ScOrigin"><span class="hs-identifier hs-var">ScOrigin</span></a><span> </span><a name="local-6989586621684146312"><a href="#local-6989586621684146312"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the superclasses of an instance declaration&quot;</span><span>
</span><a name="line-3813"></a><span>                               </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#whenPprDebug"><span class="hs-identifier hs-var">whenPprDebug</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146312"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3814"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#DerivClauseOrigin"><span class="hs-identifier hs-var">DerivClauseOrigin</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;the 'deriving' clause of a data type declaration&quot;</span><span>
</span><a name="line-3815"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#StandAloneDerivOrigin"><span class="hs-identifier hs-var">StandAloneDerivOrigin</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a 'deriving' declaration&quot;</span><span>
</span><a name="line-3816"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#DefaultOrigin"><span class="hs-identifier hs-var">DefaultOrigin</span></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a 'default' declaration&quot;</span><span>
</span><a name="line-3817"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#DoOrigin"><span class="hs-identifier hs-var">DoOrigin</span></a><span>              </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a do statement&quot;</span><span>
</span><a name="line-3818"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#MCompOrigin"><span class="hs-identifier hs-var">MCompOrigin</span></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a statement in a monad comprehension&quot;</span><span>
</span><a name="line-3819"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#ProcOrigin"><span class="hs-identifier hs-var">ProcOrigin</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a proc expression&quot;</span><span>
</span><a name="line-3820"></a><span class="hs-identifier">pprCtO</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TypeEqOrigin"><span class="hs-identifier hs-var">TypeEqOrigin</span></a><span> </span><a name="local-6989586621684146313"><a href="#local-6989586621684146313"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621684146314"><a href="#local-6989586621684146314"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a type equality&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146313"><span class="hs-identifier hs-var">t1</span></a><span class="hs-special">,</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'~'</span><span class="hs-special">,</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684146314"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">]</span><span>
</span><a name="line-3821"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#AnnOrigin"><span class="hs-identifier hs-var">AnnOrigin</span></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an annotation&quot;</span><span>
</span><a name="line-3822"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#HoleOrigin"><span class="hs-identifier hs-var">HoleOrigin</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a use of&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;_&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-3823"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#ListOrigin"><span class="hs-identifier hs-var">ListOrigin</span></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;an overloaded list&quot;</span><span>
</span><a name="line-3824"></a><span class="hs-identifier">pprCtO</span><span> </span><a href="TcRnTypes.html#StaticOrigin"><span class="hs-identifier hs-var">StaticOrigin</span></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;a static form&quot;</span><span>
</span><a name="line-3825"></a><span class="hs-identifier">pprCtO</span><span> </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a><span> </span><span class="hs-string">&quot;pprCtOrigin&quot;</span><span>
</span><a name="line-3826"></a><span>
</span><a name="line-3827"></a><span class="hs-comment">{-
Constraint Solver Plugins
-------------------------
-}</span><span>
</span><a name="line-3831"></a><span>
</span><a name="line-3832"></a><span class="hs-keyword">type</span><span> </span><a name="TcPluginSolver"><a href="TcRnTypes.html#TcPluginSolver"><span class="hs-identifier">TcPluginSolver</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- given</span><span>
</span><a name="line-3833"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- derived</span><span>
</span><a name="line-3834"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- wanted</span><span>
</span><a name="line-3835"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><a href="TcRnTypes.html#TcPluginResult"><span class="hs-identifier hs-type">TcPluginResult</span></a><span>
</span><a name="line-3836"></a><span>
</span><a name="line-3837"></a><span class="hs-keyword">newtype</span><span> </span><a name="TcPluginM"><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier">TcPluginM</span></a></a><span> </span><a name="local-6989586621684145911"><a href="#local-6989586621684145911"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TcPluginM"><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier">TcPluginM</span></a></a><span> </span><span class="hs-special">(</span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621684145911"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-3838"></a><span>
</span><a name="line-3839"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3840"></a><span>  </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-3841"></a><span>
</span><a name="line-3842"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3843"></a><span>  </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621684145923"><a href="#local-6989586621684145923"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-var">TcPluginM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621684145923"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-3844"></a><span>  </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-3845"></a><span>
</span><a name="line-3846"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3847"></a><span class="hs-cpp">#if !MIN_VERSION_base(4,13,0)
</span><span>  </span><a name="local-3458764513820541098"><span class="hs-identifier">fail</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MonadFail.fail</span><span>
</span><a name="line-3849"></a><span class="hs-cpp">#endif
</span><span>  </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-var">TcPluginM</span></a><span> </span><a name="local-6989586621684145919"><a href="#local-6989586621684145919"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621684145920"><a href="#local-6989586621684145920"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3851"></a><span>    </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-var">TcPluginM</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621684145921"><a href="#local-6989586621684145921"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684145922"><a href="#local-6989586621684145922"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684145919"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621684145921"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-3852"></a><span>                          </span><a href="TcRnTypes.html#runTcPluginM"><span class="hs-identifier hs-var">runTcPluginM</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684145920"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621684145922"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684145921"><span class="hs-identifier hs-var">ev</span></a><span class="hs-special">)</span><span>
</span><a name="line-3853"></a><span>
</span><a name="line-3854"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadFail.MonadFail</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3855"></a><span>  </span><a name="local-3458764513820541104"><span class="hs-identifier">fail</span></a><span> </span><a name="local-6989586621684145918"><a href="#local-6989586621684145918"><span class="hs-identifier">x</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-var">TcPluginM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><a href="#local-6989586621684145918"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-3856"></a><span>
</span><a name="line-3857"></a><span class="hs-identifier">runTcPluginM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><a href="#local-6989586621684145990"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621684145990"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-3858"></a><a name="runTcPluginM"><a href="TcRnTypes.html#runTcPluginM"><span class="hs-identifier">runTcPluginM</span></a></a><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-var">TcPluginM</span></a><span> </span><a name="local-6989586621684146315"><a href="#local-6989586621684146315"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684146315"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-3859"></a><span>
</span><a name="line-3860"></a><span class="hs-comment">-- | This function provides an escape for direct access to</span><span>
</span><a name="line-3861"></a><span class="hs-comment">-- the 'TcM` monad.  It should not be used lightly, and</span><span>
</span><a name="line-3862"></a><span class="hs-comment">-- the provided 'TcPluginM' API should be favoured instead.</span><span>
</span><a name="line-3863"></a><span class="hs-identifier">unsafeTcPluginTcM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcM"><span class="hs-identifier hs-type">TcM</span></a><span> </span><a href="#local-6989586621684145989"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><a href="#local-6989586621684145989"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-3864"></a><a name="unsafeTcPluginTcM"><a href="TcRnTypes.html#unsafeTcPluginTcM"><span class="hs-identifier">unsafeTcPluginTcM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-var">TcPluginM</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">const</span><span>
</span><a name="line-3865"></a><span>
</span><a name="line-3866"></a><span class="hs-comment">-- | Access the 'EvBindsVar' carried by the 'TcPluginM' during</span><span>
</span><a name="line-3867"></a><span class="hs-comment">-- constraint solving.  Returns 'Nothing' if invoked during</span><span>
</span><a name="line-3868"></a><span class="hs-comment">-- 'tcPluginInit' or 'tcPluginStop'.</span><span>
</span><a name="line-3869"></a><span class="hs-identifier">getEvBindsTcPluginM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><a href="TcEvidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a><span>
</span><a name="line-3870"></a><a name="getEvBindsTcPluginM"><a href="TcRnTypes.html#getEvBindsTcPluginM"><span class="hs-identifier">getEvBindsTcPluginM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-var">TcPluginM</span></a><span> </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-3871"></a><span>
</span><a name="line-3872"></a><span>
</span><a name="line-3873"></a><span class="hs-keyword">data</span><span> </span><a name="TcPlugin"><a href="TcRnTypes.html#TcPlugin"><span class="hs-identifier">TcPlugin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621684145910"><a href="#local-6989586621684145910"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><a name="TcPlugin"><a href="TcRnTypes.html#TcPlugin"><span class="hs-identifier">TcPlugin</span></a></a><span>
</span><a name="line-3874"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="tcPluginInit"><a href="TcRnTypes.html#tcPluginInit"><span class="hs-identifier">tcPluginInit</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><a href="#local-6989586621684145910"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-3875"></a><span>    </span><span class="hs-comment">-- ^ Initialize plugin, when entering type-checker.</span><span>
</span><a name="line-3876"></a><span>
</span><a name="line-3877"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="tcPluginSolve"><a href="TcRnTypes.html#tcPluginSolve"><span class="hs-identifier">tcPluginSolve</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621684145910"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcPluginSolver"><span class="hs-identifier hs-type">TcPluginSolver</span></a><span>
</span><a name="line-3878"></a><span>    </span><span class="hs-comment">-- ^ Solve some constraints.</span><span>
</span><a name="line-3879"></a><span>    </span><span class="hs-comment">-- TODO: WRITE MORE DETAILS ON HOW THIS WORKS.</span><span>
</span><a name="line-3880"></a><span>
</span><a name="line-3881"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="tcPluginStop"><a href="TcRnTypes.html#tcPluginStop"><span class="hs-identifier">tcPluginStop</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621684145910"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#TcPluginM"><span class="hs-identifier hs-type">TcPluginM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-3882"></a><span>   </span><span class="hs-comment">-- ^ Clean up after the plugin, when exiting the type-checker.</span><span>
</span><a name="line-3883"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-3884"></a><span>
</span><a name="line-3885"></a><span class="hs-keyword">data</span><span> </span><a name="TcPluginResult"><a href="TcRnTypes.html#TcPluginResult"><span class="hs-identifier">TcPluginResult</span></a></a><span>
</span><a name="line-3886"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TcPluginContradiction"><a href="TcRnTypes.html#TcPluginContradiction"><span class="hs-identifier">TcPluginContradiction</span></a></a><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>
</span><a name="line-3887"></a><span>    </span><span class="hs-comment">-- ^ The plugin found a contradiction.</span><span>
</span><a name="line-3888"></a><span>    </span><span class="hs-comment">-- The returned constraints are removed from the inert set,</span><span>
</span><a name="line-3889"></a><span>    </span><span class="hs-comment">-- and recorded as insoluble.</span><span>
</span><a name="line-3890"></a><span>
</span><a name="line-3891"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TcPluginOk"><a href="TcRnTypes.html#TcPluginOk"><span class="hs-identifier">TcPluginOk</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="TcEvidence.html#EvTerm"><span class="hs-identifier hs-type">EvTerm</span></a><span class="hs-special">,</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a href="TcRnTypes.html#Ct"><span class="hs-identifier hs-type">Ct</span></a><span class="hs-special">]</span><span>
</span><a name="line-3892"></a><span>    </span><span class="hs-comment">-- ^ The first field is for constraints that were solved.</span><span>
</span><a name="line-3893"></a><span>    </span><span class="hs-comment">-- These are removed from the inert set,</span><span>
</span><a name="line-3894"></a><span>    </span><span class="hs-comment">-- and the evidence for them is recorded.</span><span>
</span><a name="line-3895"></a><span>    </span><span class="hs-comment">-- The second field contains new work, that should be processed by</span><span>
</span><a name="line-3896"></a><span>    </span><span class="hs-comment">-- the constraint solver.</span><span>
</span><a name="line-3897"></a><span>
</span><a name="line-3898"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                        Role annotations
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-3903"></a><span>
</span><a name="line-3904"></a><span class="hs-keyword">type</span><span> </span><a name="RoleAnnotEnv"><a href="TcRnTypes.html#RoleAnnotEnv"><span class="hs-identifier">RoleAnnotEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span>
</span><a name="line-3905"></a><span>
</span><a name="line-3906"></a><span class="hs-identifier">mkRoleAnnotEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RoleAnnotEnv"><span class="hs-identifier hs-type">RoleAnnotEnv</span></a><span>
</span><a name="line-3907"></a><a name="mkRoleAnnotEnv"><a href="TcRnTypes.html#mkRoleAnnotEnv"><span class="hs-identifier">mkRoleAnnotEnv</span></a></a><span> </span><a name="local-6989586621684146316"><a href="#local-6989586621684146316"><span class="hs-identifier">role_annot_decls</span></a></a><span>
</span><a name="line-3908"></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684146318"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684146317"><span class="hs-identifier hs-var">ra_decl</span></a><span class="hs-special">)</span><span>
</span><a name="line-3909"></a><span>             </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621684146317"><a href="#local-6989586621684146317"><span class="hs-identifier">ra_decl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684146316"><span class="hs-identifier hs-var">role_annot_decls</span></a><span>
</span><a name="line-3910"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684146318"><a href="#local-6989586621684146318"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HsDecls.html#roleAnnotDeclName"><span class="hs-identifier hs-var">roleAnnotDeclName</span></a><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a><span> </span><a href="#local-6989586621684146317"><span class="hs-identifier hs-var">ra_decl</span></a><span class="hs-special">)</span><span>
</span><a name="line-3911"></a><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="PrelNames.html#isUnboundName"><span class="hs-identifier hs-var">isUnboundName</span></a><span> </span><a href="#local-6989586621684146318"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-3912"></a><span>       </span><span class="hs-comment">-- Some of the role annots will be unbound;</span><span>
</span><a name="line-3913"></a><span>       </span><span class="hs-comment">-- we don't wish to include these</span><span>
</span><a name="line-3914"></a><span>
</span><a name="line-3915"></a><span class="hs-identifier">emptyRoleAnnotEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#RoleAnnotEnv"><span class="hs-identifier hs-type">RoleAnnotEnv</span></a><span>
</span><a name="line-3916"></a><a name="emptyRoleAnnotEnv"><a href="TcRnTypes.html#emptyRoleAnnotEnv"><span class="hs-identifier">emptyRoleAnnotEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span>
</span><a name="line-3917"></a><span>
</span><a name="line-3918"></a><span class="hs-identifier">lookupRoleAnnot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcRnTypes.html#RoleAnnotEnv"><span class="hs-identifier hs-type">RoleAnnotEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">)</span><span>
</span><a name="line-3919"></a><a name="lookupRoleAnnot"><a href="TcRnTypes.html#lookupRoleAnnot"><span class="hs-identifier">lookupRoleAnnot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span>
</span><a name="line-3920"></a><span>
</span><a name="line-3921"></a><span class="hs-identifier">getRoleAnnots</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcRnTypes.html#RoleAnnotEnv"><span class="hs-identifier hs-type">RoleAnnotEnv</span></a><span>
</span><a name="line-3922"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a><span> </span><a href="HsExtension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="TcRnTypes.html#RoleAnnotEnv"><span class="hs-identifier hs-type">RoleAnnotEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-3923"></a><a name="getRoleAnnots"><a href="TcRnTypes.html#getRoleAnnots"><span class="hs-identifier">getRoleAnnots</span></a></a><span> </span><a name="local-6989586621684146319"><a href="#local-6989586621684146319"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-6989586621684146320"><a href="#local-6989586621684146320"><span class="hs-identifier">role_env</span></a></a><span>
</span><a name="line-3924"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><span class="hs-special">(</span><a href="TcRnTypes.html#lookupRoleAnnot"><span class="hs-identifier hs-var">lookupRoleAnnot</span></a><span> </span><a href="#local-6989586621684146320"><span class="hs-identifier hs-var">role_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684146319"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-3925"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="NameEnv.html#delListFromNameEnv"><span class="hs-identifier hs-var">delListFromNameEnv</span></a><span> </span><a href="#local-6989586621684146320"><span class="hs-identifier hs-var">role_env</span></a><span> </span><a href="#local-6989586621684146319"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-3926"></a></pre></body></html>