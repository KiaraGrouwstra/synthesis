<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow, 2006

\section[HscTypes]{Types for the per-module compiler}
-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE CPP, ScopedTypeVariables #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-comment">-- | Types for the per-module compiler</span><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">HscTypes</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-13"></a><span>        </span><span class="hs-comment">-- * compilation state</span><span>
</span><a name="line-14"></a><span>        </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>        </span><a href="HscTypes.html#FinderCache"><span class="hs-identifier hs-type">FinderCache</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#FindResult"><span class="hs-identifier hs-type">FindResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#InstalledFindResult"><span class="hs-identifier hs-type">InstalledFindResult</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>        </span><a href="HscTypes.html#Target"><span class="hs-identifier hs-type">Target</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#TargetId"><span class="hs-identifier hs-type">TargetId</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#pprTarget"><span class="hs-identifier hs-var">pprTarget</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#pprTargetId"><span class="hs-identifier hs-var">pprTargetId</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>        </span><a href="HscTypes.html#HscStatus"><span class="hs-identifier hs-type">HscStatus</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>        </span><a href="HscTypes.html#IServ"><span class="hs-identifier hs-type">IServ</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span>        </span><span class="hs-comment">-- * ModuleGraph</span><span>
</span><a name="line-21"></a><span>        </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#emptyMG"><span class="hs-identifier hs-var">emptyMG</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkModuleGraph"><span class="hs-identifier hs-var">mkModuleGraph</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#extendMG"><span class="hs-identifier hs-var">extendMG</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mapMG"><span class="hs-identifier hs-var">mapMG</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="HscTypes.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mgElemModule"><span class="hs-identifier hs-var">mgElemModule</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mgLookupModule"><span class="hs-identifier hs-var">mgLookupModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="HscTypes.html#needsTemplateHaskellOrQQ"><span class="hs-identifier hs-var">needsTemplateHaskellOrQQ</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mgBootModules"><span class="hs-identifier hs-var">mgBootModules</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>        </span><span class="hs-comment">-- * Hsc monad</span><span>
</span><a name="line-26"></a><span>        </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkInteractiveHscEnv"><span class="hs-identifier hs-var">mkInteractiveHscEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>        </span><span class="hs-comment">-- * Information about modules</span><span>
</span><a name="line-29"></a><span>        </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#emptyModDetails"><span class="hs-identifier hs-var">emptyModDetails</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>        </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ForeignStubs"><span class="hs-identifier hs-type">ForeignStubs</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#appendStubC"><span class="hs-identifier hs-var">appendStubC</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>        </span><a href="HscTypes.html#ImportedMods"><span class="hs-identifier hs-type">ImportedMods</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ImportedBy"><span class="hs-identifier hs-type">ImportedBy</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#importedByUser"><span class="hs-identifier hs-var">importedByUser</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>        </span><a href="GHC.ForeignSrcLang.Type.html#ForeignSrcLang"><span class="hs-identifier hs-type">ForeignSrcLang</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>        </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ms_imps"><span class="hs-identifier hs-var">ms_imps</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ms_installed_mod"><span class="hs-identifier hs-var">ms_installed_mod</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#showModMsg"><span class="hs-identifier hs-var">showModMsg</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="HscTypes.html#msHsFilePath"><span class="hs-identifier hs-var">msHsFilePath</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#msHiFilePath"><span class="hs-identifier hs-var">msHiFilePath</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#msObjFilePath"><span class="hs-identifier hs-var">msObjFilePath</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="HscTypes.html#SourceModified"><span class="hs-identifier hs-type">SourceModified</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#isTemplateHaskellOrQQNonBoot"><span class="hs-identifier hs-var">isTemplateHaskellOrQQNonBoot</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>        </span><span class="hs-comment">-- * Information about the module being compiled</span><span>
</span><a name="line-39"></a><span>        </span><span class="hs-comment">-- (re-exported from DriverPhases)</span><span>
</span><a name="line-40"></a><span>        </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DriverPhases.html#isHsBootOrSig"><span class="hs-identifier hs-var">isHsBootOrSig</span></a><span class="hs-special">,</span><span> </span><a href="DriverPhases.html#isHsigFile"><span class="hs-identifier hs-var">isHsigFile</span></a><span class="hs-special">,</span><span> </span><a href="DriverPhases.html#hscSourceString"><span class="hs-identifier hs-var">hscSourceString</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>        </span><span class="hs-comment">-- * State relating to modules in this package</span><span>
</span><a name="line-44"></a><span>        </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#emptyHomePackageTable"><span class="hs-identifier hs-var">emptyHomePackageTable</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>        </span><a href="HscTypes.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#eltsHpt"><span class="hs-identifier hs-var">eltsHpt</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#filterHpt"><span class="hs-identifier hs-var">filterHpt</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#allHpt"><span class="hs-identifier hs-var">allHpt</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mapHpt"><span class="hs-identifier hs-var">mapHpt</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#delFromHpt"><span class="hs-identifier hs-var">delFromHpt</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>        </span><a href="HscTypes.html#addToHpt"><span class="hs-identifier hs-var">addToHpt</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#addListToHpt"><span class="hs-identifier hs-var">addListToHpt</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#lookupHptDirectly"><span class="hs-identifier hs-var">lookupHptDirectly</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#listToHpt"><span class="hs-identifier hs-var">listToHpt</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>        </span><a href="HscTypes.html#hptCompleteSigs"><span class="hs-identifier hs-var">hptCompleteSigs</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>        </span><a href="HscTypes.html#hptInstances"><span class="hs-identifier hs-var">hptInstances</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#hptRules"><span class="hs-identifier hs-var">hptRules</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#pprHPT"><span class="hs-identifier hs-var">pprHPT</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>        </span><span class="hs-comment">-- * State relating to known packages</span><span>
</span><a name="line-51"></a><span>        </span><a href="HscTypes.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#EpsStats"><span class="hs-identifier hs-type">EpsStats</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#addEpsInStats"><span class="hs-identifier hs-var">addEpsInStats</span></a><span class="hs-special">,</span><span>
</span><a name="line-52"></a><span>        </span><a href="HscTypes.html#PackageTypeEnv"><span class="hs-identifier hs-type">PackageTypeEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#PackageIfaceTable"><span class="hs-identifier hs-type">PackageIfaceTable</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#emptyPackageIfaceTable"><span class="hs-identifier hs-var">emptyPackageIfaceTable</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>        </span><a href="HscTypes.html#lookupIfaceByModule"><span class="hs-identifier hs-var">lookupIfaceByModule</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#emptyModIface"><span class="hs-identifier hs-var">emptyModIface</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#lookupHptByModule"><span class="hs-identifier hs-var">lookupHptByModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span>        </span><a href="HscTypes.html#PackageInstEnv"><span class="hs-identifier hs-type">PackageInstEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#PackageFamInstEnv"><span class="hs-identifier hs-type">PackageFamInstEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#PackageRuleBase"><span class="hs-identifier hs-type">PackageRuleBase</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>        </span><a href="HscTypes.html#PackageCompleteMatchMap"><span class="hs-identifier hs-type">PackageCompleteMatchMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span>        </span><a href="HscTypes.html#mkSOName"><span class="hs-identifier hs-var">mkSOName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkHsSOName"><span class="hs-identifier hs-var">mkHsSOName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#soExt"><span class="hs-identifier hs-var">soExt</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>        </span><span class="hs-comment">-- * Metaprogramming</span><span>
</span><a name="line-61"></a><span>        </span><a href="HscTypes.html#MetaRequest"><span class="hs-identifier hs-type">MetaRequest</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>        </span><a href="HscTypes.html#MetaResult"><span class="hs-identifier hs-type">MetaResult</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- data constructors not exported to ensure correct response type</span><span>
</span><a name="line-63"></a><span>        </span><a href="HscTypes.html#metaRequestE"><span class="hs-identifier hs-var">metaRequestE</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#metaRequestP"><span class="hs-identifier hs-var">metaRequestP</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#metaRequestT"><span class="hs-identifier hs-var">metaRequestT</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#metaRequestD"><span class="hs-identifier hs-var">metaRequestD</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#metaRequestAW"><span class="hs-identifier hs-var">metaRequestAW</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>        </span><a href="HscTypes.html#MetaHook"><span class="hs-identifier hs-type">MetaHook</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span>        </span><span class="hs-comment">-- * Annotations</span><span>
</span><a name="line-67"></a><span>        </span><a href="HscTypes.html#prepareAnnotations"><span class="hs-identifier hs-var">prepareAnnotations</span></a><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span>        </span><span class="hs-comment">-- * Interactive context</span><span>
</span><a name="line-70"></a><span>        </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#emptyInteractiveContext"><span class="hs-identifier hs-var">emptyInteractiveContext</span></a><span class="hs-special">,</span><span>
</span><a name="line-71"></a><span>        </span><a href="HscTypes.html#icPrintUnqual"><span class="hs-identifier hs-var">icPrintUnqual</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#icInScopeTTs"><span class="hs-identifier hs-var">icInScopeTTs</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#icExtendGblRdrEnv"><span class="hs-identifier hs-var">icExtendGblRdrEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-72"></a><span>        </span><a href="HscTypes.html#extendInteractiveContext"><span class="hs-identifier hs-var">extendInteractiveContext</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#extendInteractiveContextWithIds"><span class="hs-identifier hs-var">extendInteractiveContextWithIds</span></a><span class="hs-special">,</span><span>
</span><a name="line-73"></a><span>        </span><a href="HscTypes.html#substInteractiveContext"><span class="hs-identifier hs-var">substInteractiveContext</span></a><span class="hs-special">,</span><span>
</span><a name="line-74"></a><span>        </span><a href="HscTypes.html#setInteractivePrintName"><span class="hs-identifier hs-var">setInteractivePrintName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#icInteractiveModule"><span class="hs-identifier hs-var">icInteractiveModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-75"></a><span>        </span><a href="HscTypes.html#InteractiveImport"><span class="hs-identifier hs-type">InteractiveImport</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#setInteractivePackage"><span class="hs-identifier hs-var">setInteractivePackage</span></a><span class="hs-special">,</span><span>
</span><a name="line-76"></a><span>        </span><a href="HscTypes.html#mkPrintUnqualified"><span class="hs-identifier hs-var">mkPrintUnqualified</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#pprModulePrefix"><span class="hs-identifier hs-var">pprModulePrefix</span></a><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>        </span><a href="HscTypes.html#mkQualPackage"><span class="hs-identifier hs-var">mkQualPackage</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkQualModule"><span class="hs-identifier hs-var">mkQualModule</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#pkgQual"><span class="hs-identifier hs-var">pkgQual</span></a><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span>        </span><span class="hs-comment">-- * Interfaces</span><span>
</span><a name="line-80"></a><span>        </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkIfaceWarnCache"><span class="hs-identifier hs-var">mkIfaceWarnCache</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkIfaceHashCache"><span class="hs-identifier hs-var">mkIfaceHashCache</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkIfaceFixCache"><span class="hs-identifier hs-var">mkIfaceFixCache</span></a><span class="hs-special">,</span><span>
</span><a name="line-81"></a><span>        </span><a href="HscTypes.html#emptyIfaceWarnCache"><span class="hs-identifier hs-var">emptyIfaceWarnCache</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mi_boot"><span class="hs-identifier hs-var">mi_boot</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mi_fix"><span class="hs-identifier hs-var">mi_fix</span></a><span class="hs-special">,</span><span>
</span><a name="line-82"></a><span>        </span><a href="HscTypes.html#mi_semantic_module"><span class="hs-identifier hs-var">mi_semantic_module</span></a><span class="hs-special">,</span><span>
</span><a name="line-83"></a><span>        </span><a href="HscTypes.html#mi_free_holes"><span class="hs-identifier hs-var">mi_free_holes</span></a><span class="hs-special">,</span><span>
</span><a name="line-84"></a><span>        </span><a href="HscTypes.html#renameFreeHoles"><span class="hs-identifier hs-var">renameFreeHoles</span></a><span class="hs-special">,</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span>        </span><span class="hs-comment">-- * Fixity</span><span>
</span><a name="line-87"></a><span>        </span><a href="HscTypes.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#FixItem"><span class="hs-identifier hs-type">FixItem</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#lookupFixity"><span class="hs-identifier hs-var">lookupFixity</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#emptyFixityEnv"><span class="hs-identifier hs-var">emptyFixityEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span>        </span><span class="hs-comment">-- * TyThings and type environments</span><span>
</span><a name="line-90"></a><span>        </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>  </span><a href="HscTypes.html#tyThingAvailInfo"><span class="hs-identifier hs-var">tyThingAvailInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-91"></a><span>        </span><a href="HscTypes.html#tyThingTyCon"><span class="hs-identifier hs-var">tyThingTyCon</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#tyThingDataCon"><span class="hs-identifier hs-var">tyThingDataCon</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#tyThingConLike"><span class="hs-identifier hs-var">tyThingConLike</span></a><span class="hs-special">,</span><span>
</span><a name="line-92"></a><span>        </span><a href="HscTypes.html#tyThingId"><span class="hs-identifier hs-var">tyThingId</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#tyThingCoAxiom"><span class="hs-identifier hs-var">tyThingCoAxiom</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#tyThingParent_maybe"><span class="hs-identifier hs-var">tyThingParent_maybe</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#tyThingsTyCoVars"><span class="hs-identifier hs-var">tyThingsTyCoVars</span></a><span class="hs-special">,</span><span>
</span><a name="line-93"></a><span>        </span><a href="HscTypes.html#implicitTyThings"><span class="hs-identifier hs-var">implicitTyThings</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#implicitTyConThings"><span class="hs-identifier hs-var">implicitTyConThings</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#implicitClassThings"><span class="hs-identifier hs-var">implicitClassThings</span></a><span class="hs-special">,</span><span>
</span><a name="line-94"></a><span>        </span><a href="HscTypes.html#isImplicitTyThing"><span class="hs-identifier hs-var">isImplicitTyThing</span></a><span class="hs-special">,</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>        </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#lookupTypeHscEnv"><span class="hs-identifier hs-var">lookupTypeHscEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkTypeEnv"><span class="hs-identifier hs-var">mkTypeEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#emptyTypeEnv"><span class="hs-identifier hs-var">emptyTypeEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-97"></a><span>        </span><a href="HscTypes.html#typeEnvFromEntities"><span class="hs-identifier hs-var">typeEnvFromEntities</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkTypeEnvWithImplicits"><span class="hs-identifier hs-var">mkTypeEnvWithImplicits</span></a><span class="hs-special">,</span><span>
</span><a name="line-98"></a><span>        </span><a href="HscTypes.html#extendTypeEnv"><span class="hs-identifier hs-var">extendTypeEnv</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#extendTypeEnvList"><span class="hs-identifier hs-var">extendTypeEnvList</span></a><span class="hs-special">,</span><span>
</span><a name="line-99"></a><span>        </span><a href="HscTypes.html#extendTypeEnvWithIds"><span class="hs-identifier hs-var">extendTypeEnvWithIds</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#plusTypeEnv"><span class="hs-identifier hs-var">plusTypeEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-100"></a><span>        </span><a href="HscTypes.html#lookupTypeEnv"><span class="hs-identifier hs-var">lookupTypeEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-101"></a><span>        </span><a href="HscTypes.html#typeEnvElts"><span class="hs-identifier hs-var">typeEnvElts</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#typeEnvTyCons"><span class="hs-identifier hs-var">typeEnvTyCons</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#typeEnvIds"><span class="hs-identifier hs-var">typeEnvIds</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#typeEnvPatSyns"><span class="hs-identifier hs-var">typeEnvPatSyns</span></a><span class="hs-special">,</span><span>
</span><a name="line-102"></a><span>        </span><a href="HscTypes.html#typeEnvDataCons"><span class="hs-identifier hs-var">typeEnvDataCons</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#typeEnvCoAxioms"><span class="hs-identifier hs-var">typeEnvCoAxioms</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#typeEnvClasses"><span class="hs-identifier hs-var">typeEnvClasses</span></a><span class="hs-special">,</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span>        </span><span class="hs-comment">-- * MonadThings</span><span>
</span><a name="line-105"></a><span>        </span><a href="HscTypes.html#MonadThings"><span class="hs-identifier hs-type">MonadThings</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span>        </span><span class="hs-comment">-- * Information on imports and exports</span><span>
</span><a name="line-108"></a><span>        </span><a href="HscTypes.html#WhetherHasOrphans"><span class="hs-identifier hs-type">WhetherHasOrphans</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#Usage"><span class="hs-identifier hs-type">Usage</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-109"></a><span>        </span><a href="HscTypes.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#noDependencies"><span class="hs-identifier hs-var">noDependencies</span></a><span class="hs-special">,</span><span>
</span><a name="line-110"></a><span>        </span><a href="HscTypes.html#updNameCache"><span class="hs-identifier hs-var">updNameCache</span></a><span class="hs-special">,</span><span>
</span><a name="line-111"></a><span>        </span><a href="HscTypes.html#IfaceExport"><span class="hs-identifier hs-type">IfaceExport</span></a><span class="hs-special">,</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span>        </span><span class="hs-comment">-- * Warnings</span><span>
</span><a name="line-114"></a><span>        </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#WarningTxt"><span class="hs-identifier hs-type">WarningTxt</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#plusWarns"><span class="hs-identifier hs-var">plusWarns</span></a><span class="hs-special">,</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span>        </span><span class="hs-comment">-- * Linker stuff</span><span>
</span><a name="line-117"></a><span>        </span><a href="HscTypes.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#isObjectLinkable"><span class="hs-identifier hs-var">isObjectLinkable</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#linkableObjs"><span class="hs-identifier hs-var">linkableObjs</span></a><span class="hs-special">,</span><span>
</span><a name="line-118"></a><span>        </span><a href="HscTypes.html#Unlinked"><span class="hs-identifier hs-type">Unlinked</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="ByteCodeTypes.html#CompiledByteCode"><span class="hs-identifier hs-type">CompiledByteCode</span></a><span class="hs-special">,</span><span>
</span><a name="line-119"></a><span>        </span><a href="HscTypes.html#isObject"><span class="hs-identifier hs-var">isObject</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#nameOfObject"><span class="hs-identifier hs-var">nameOfObject</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#isInterpretable"><span class="hs-identifier hs-var">isInterpretable</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#byteCodeOfObject"><span class="hs-identifier hs-var">byteCodeOfObject</span></a><span class="hs-special">,</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span>        </span><span class="hs-comment">-- * Program coverage</span><span>
</span><a name="line-122"></a><span>        </span><a href="HscTypes.html#HpcInfo"><span class="hs-identifier hs-type">HpcInfo</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#emptyHpcInfo"><span class="hs-identifier hs-var">emptyHpcInfo</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#isHpcUsed"><span class="hs-identifier hs-var">isHpcUsed</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#AnyHpcUsage"><span class="hs-identifier hs-type">AnyHpcUsage</span></a><span class="hs-special">,</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span>        </span><span class="hs-comment">-- * Breakpoints</span><span>
</span><a name="line-125"></a><span>        </span><a href="ByteCodeTypes.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="ByteCodeTypes.html#emptyModBreaks"><span class="hs-identifier hs-var">emptyModBreaks</span></a><span class="hs-special">,</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span>        </span><span class="hs-comment">-- * Safe Haskell information</span><span>
</span><a name="line-128"></a><span>        </span><a href="HscTypes.html#IfaceTrustInfo"><span class="hs-identifier hs-type">IfaceTrustInfo</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#getSafeMode"><span class="hs-identifier hs-var">getSafeMode</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#setSafeMode"><span class="hs-identifier hs-var">setSafeMode</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#noIfaceTrustInfo"><span class="hs-identifier hs-var">noIfaceTrustInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-129"></a><span>        </span><a href="HscTypes.html#trustInfoToNum"><span class="hs-identifier hs-var">trustInfoToNum</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#numToTrustInfo"><span class="hs-identifier hs-var">numToTrustInfo</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsSafeImport"><span class="hs-identifier hs-type">IsSafeImport</span></a><span class="hs-special">,</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span>        </span><span class="hs-comment">-- * result of the parser</span><span>
</span><a name="line-132"></a><span>        </span><a href="HscTypes.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span>        </span><span class="hs-comment">-- * Compilation errors and warnings</span><span>
</span><a name="line-135"></a><span>        </span><a href="HscTypes.html#SourceError"><span class="hs-identifier hs-type">SourceError</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#GhcApiError"><span class="hs-identifier hs-type">GhcApiError</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkSrcErr"><span class="hs-identifier hs-var">mkSrcErr</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#srcErrorMessages"><span class="hs-identifier hs-var">srcErrorMessages</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#mkApiErr"><span class="hs-identifier hs-var">mkApiErr</span></a><span class="hs-special">,</span><span>
</span><a name="line-136"></a><span>        </span><a href="HscTypes.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#handleSourceError"><span class="hs-identifier hs-var">handleSourceError</span></a><span class="hs-special">,</span><span>
</span><a name="line-137"></a><span>        </span><a href="HscTypes.html#handleFlagWarnings"><span class="hs-identifier hs-var">handleFlagWarnings</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#printOrThrowWarnings"><span class="hs-identifier hs-var">printOrThrowWarnings</span></a><span class="hs-special">,</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span>        </span><span class="hs-comment">-- * COMPLETE signature</span><span>
</span><a name="line-140"></a><span>        </span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="HscTypes.html#CompleteMatchMap"><span class="hs-identifier hs-type">CompleteMatchMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-141"></a><span>        </span><a href="HscTypes.html#mkCompleteMatchMap"><span class="hs-identifier hs-var">mkCompleteMatchMap</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#extendCompleteMatchMap"><span class="hs-identifier hs-var">extendCompleteMatchMap</span></a><span>
</span><a name="line-142"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-146"></a><span class="hs-keyword">import</span><span> </span><a href="GhcPrelude.html"><span class="hs-identifier">GhcPrelude</span></a><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-keyword">import</span><span> </span><a href="ByteCodeTypes.html"><span class="hs-identifier">ByteCodeTypes</span></a><span>
</span><a name="line-149"></a><span class="hs-keyword">import</span><span> </span><a href="InteractiveEvalTypes.html"><span class="hs-identifier">InteractiveEvalTypes</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="InteractiveEvalTypes.html#Resume"><span class="hs-identifier hs-type">Resume</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span class="hs-keyword">import</span><span> </span><a href="GHCi.Message.html"><span class="hs-identifier">GHCi.Message</span></a><span>         </span><span class="hs-special">(</span><span> </span><a href="GHCi.Message.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span class="hs-keyword">import</span><span> </span><a href="GHCi.RemoteTypes.html"><span class="hs-identifier">GHCi.RemoteTypes</span></a><span>
</span><a name="line-152"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.ForeignSrcLang.html"><span class="hs-identifier">GHC.ForeignSrcLang</span></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-keyword">import</span><span> </span><a href="UniqFM.html"><span class="hs-identifier">UniqFM</span></a><span>
</span><a name="line-155"></a><span class="hs-keyword">import</span><span> </span><a href="HsSyn.html"><span class="hs-identifier">HsSyn</span></a><span>
</span><a name="line-156"></a><span class="hs-keyword">import</span><span> </span><a href="RdrName.html"><span class="hs-identifier">RdrName</span></a><span>
</span><a name="line-157"></a><span class="hs-keyword">import</span><span> </span><a href="Avail.html"><span class="hs-identifier">Avail</span></a><span>
</span><a name="line-158"></a><span class="hs-keyword">import</span><span> </span><a href="Module.html"><span class="hs-identifier">Module</span></a><span>
</span><a name="line-159"></a><span class="hs-keyword">import</span><span> </span><a href="InstEnv.html"><span class="hs-identifier">InstEnv</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a><span class="hs-special">,</span><span> </span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">,</span><span> </span><a href="InstEnv.html#identicalClsInstHead"><span class="hs-identifier hs-var">identicalClsInstHead</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span class="hs-keyword">import</span><span> </span><a href="FamInstEnv.html"><span class="hs-identifier">FamInstEnv</span></a><span>
</span><a name="line-161"></a><span class="hs-keyword">import</span><span> </span><a href="CoreSyn.html"><span class="hs-identifier">CoreSyn</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="CoreSyn.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#RuleBase"><span class="hs-identifier hs-type">RuleBase</span></a><span class="hs-special">,</span><span> </span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span class="hs-keyword">import</span><span> </span><a href="Name.html"><span class="hs-identifier">Name</span></a><span>
</span><a name="line-163"></a><span class="hs-keyword">import</span><span> </span><a href="NameEnv.html"><span class="hs-identifier">NameEnv</span></a><span>
</span><a name="line-164"></a><span class="hs-keyword">import</span><span> </span><a href="VarSet.html"><span class="hs-identifier">VarSet</span></a><span>
</span><a name="line-165"></a><span class="hs-keyword">import</span><span> </span><a href="Var.html"><span class="hs-identifier">Var</span></a><span>
</span><a name="line-166"></a><span class="hs-keyword">import</span><span> </span><a href="Id.html"><span class="hs-identifier">Id</span></a><span>
</span><a name="line-167"></a><span class="hs-keyword">import</span><span> </span><a href="IdInfo.html"><span class="hs-identifier">IdInfo</span></a><span>           </span><span class="hs-special">(</span><span> </span><a href="IdInfo.html#IdDetails"><span class="hs-identifier hs-type">IdDetails</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="IdInfo.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span class="hs-keyword">import</span><span> </span><a href="Type.html"><span class="hs-identifier">Type</span></a><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-keyword">import</span><span> </span><a href="ApiAnnotation.html"><span class="hs-identifier">ApiAnnotation</span></a><span>    </span><span class="hs-special">(</span><span> </span><a href="ApiAnnotation.html#ApiAnns"><span class="hs-identifier hs-type">ApiAnns</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span class="hs-keyword">import</span><span> </span><a href="Annotations.html"><span class="hs-identifier">Annotations</span></a><span>      </span><span class="hs-special">(</span><span> </span><a href="Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a><span class="hs-special">,</span><span> </span><a href="Annotations.html#AnnEnv"><span class="hs-identifier hs-type">AnnEnv</span></a><span class="hs-special">,</span><span> </span><a href="Annotations.html#mkAnnEnv"><span class="hs-identifier hs-var">mkAnnEnv</span></a><span class="hs-special">,</span><span> </span><a href="Annotations.html#plusAnnEnv"><span class="hs-identifier hs-var">plusAnnEnv</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span class="hs-keyword">import</span><span> </span><a href="Class.html"><span class="hs-identifier">Class</span></a><span>
</span><a name="line-173"></a><span class="hs-keyword">import</span><span> </span><a href="TyCon.html"><span class="hs-identifier">TyCon</span></a><span>
</span><a name="line-174"></a><span class="hs-keyword">import</span><span> </span><a href="CoAxiom.html"><span class="hs-identifier">CoAxiom</span></a><span>
</span><a name="line-175"></a><span class="hs-keyword">import</span><span> </span><a href="ConLike.html"><span class="hs-identifier">ConLike</span></a><span>
</span><a name="line-176"></a><span class="hs-keyword">import</span><span> </span><a href="DataCon.html"><span class="hs-identifier">DataCon</span></a><span>
</span><a name="line-177"></a><span class="hs-keyword">import</span><span> </span><a href="PatSyn.html"><span class="hs-identifier">PatSyn</span></a><span>
</span><a name="line-178"></a><span class="hs-keyword">import</span><span> </span><a href="PrelNames.html"><span class="hs-identifier">PrelNames</span></a><span>        </span><span class="hs-special">(</span><span> </span><a href="PrelNames.html#gHC_PRIM"><span class="hs-identifier hs-var">gHC_PRIM</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#ioTyConName"><span class="hs-identifier hs-var">ioTyConName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#printName"><span class="hs-identifier hs-var">printName</span></a><span class="hs-special">,</span><span> </span><a href="PrelNames.html#mkInteractiveModule"><span class="hs-identifier hs-var">mkInteractiveModule</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span class="hs-keyword">import</span><span> </span><a href="TysWiredIn.html"><span class="hs-identifier">TysWiredIn</span></a><span>
</span><a name="line-180"></a><span class="hs-keyword">import</span><span> </span><a href="Packages.html"><span class="hs-identifier">Packages</span></a><span> </span><span class="hs-keyword">hiding</span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Version</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span class="hs-keyword">import</span><span> </span><a href="CmdLineParser.html"><span class="hs-identifier">CmdLineParser</span></a><span>
</span><a name="line-182"></a><span class="hs-keyword">import</span><span> </span><a href="DynFlags.html"><span class="hs-identifier">DynFlags</span></a><span>
</span><a name="line-183"></a><span class="hs-keyword">import</span><span> </span><a href="DriverPhases.html"><span class="hs-identifier">DriverPhases</span></a><span>     </span><span class="hs-special">(</span><span> </span><a href="DriverPhases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a><span class="hs-special">,</span><span> </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DriverPhases.html#hscSourceString"><span class="hs-identifier hs-var">hscSourceString</span></a><span>
</span><a name="line-184"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="DriverPhases.html#isHsBootOrSig"><span class="hs-identifier hs-var">isHsBootOrSig</span></a><span class="hs-special">,</span><span> </span><a href="DriverPhases.html#isHsigFile"><span class="hs-identifier hs-var">isHsigFile</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span class="hs-keyword">import</span><span> </span><a href="BasicTypes.html"><span class="hs-identifier">BasicTypes</span></a><span>
</span><a name="line-186"></a><span class="hs-keyword">import</span><span> </span><a href="IfaceSyn.html"><span class="hs-identifier">IfaceSyn</span></a><span>
</span><a name="line-187"></a><span class="hs-keyword">import</span><span> </span><a href="Maybes.html"><span class="hs-identifier">Maybes</span></a><span>
</span><a name="line-188"></a><span class="hs-keyword">import</span><span> </span><a href="Outputable.html"><span class="hs-identifier">Outputable</span></a><span>
</span><a name="line-189"></a><span class="hs-keyword">import</span><span> </span><a href="SrcLoc.html"><span class="hs-identifier">SrcLoc</span></a><span>
</span><a name="line-190"></a><span class="hs-keyword">import</span><span> </span><a href="Unique.html"><span class="hs-identifier">Unique</span></a><span>
</span><a name="line-191"></a><span class="hs-keyword">import</span><span> </span><a href="UniqDFM.html"><span class="hs-identifier">UniqDFM</span></a><span>
</span><a name="line-192"></a><span class="hs-keyword">import</span><span> </span><a href="FastString.html"><span class="hs-identifier">FastString</span></a><span>
</span><a name="line-193"></a><span class="hs-keyword">import</span><span> </span><a href="StringBuffer.html"><span class="hs-identifier">StringBuffer</span></a><span>     </span><span class="hs-special">(</span><span> </span><a href="StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span class="hs-keyword">import</span><span> </span><a href="Fingerprint.html"><span class="hs-identifier">Fingerprint</span></a><span>
</span><a name="line-195"></a><span class="hs-keyword">import</span><span> </span><a href="MonadUtils.html"><span class="hs-identifier">MonadUtils</span></a><span>
</span><a name="line-196"></a><span class="hs-keyword">import</span><span> </span><a href="Bag.html"><span class="hs-identifier">Bag</span></a><span>
</span><a name="line-197"></a><span class="hs-keyword">import</span><span> </span><a href="Binary.html"><span class="hs-identifier">Binary</span></a><span>
</span><a name="line-198"></a><span class="hs-keyword">import</span><span> </span><a href="ErrUtils.html"><span class="hs-identifier">ErrUtils</span></a><span>
</span><a name="line-199"></a><span class="hs-keyword">import</span><span> </span><a href="NameCache.html"><span class="hs-identifier">NameCache</span></a><span>
</span><a name="line-200"></a><span class="hs-keyword">import</span><span> </span><a href="Platform.html"><span class="hs-identifier">Platform</span></a><span>
</span><a name="line-201"></a><span class="hs-keyword">import</span><span> </span><a href="Util.html"><span class="hs-identifier">Util</span></a><span>
</span><a name="line-202"></a><span class="hs-keyword">import</span><span> </span><a href="UniqDSet.html"><span class="hs-identifier">UniqDSet</span></a><span>
</span><a name="line-203"></a><span class="hs-keyword">import</span><span> </span><a href="GHC.Serialized.html"><span class="hs-identifier">GHC.Serialized</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="GHC.LanguageExtensions.html"><span class="hs-identifier">GHC.LanguageExtensions</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span>
</span><a name="line-207"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">guard</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ap</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.IORef</span><span>
</span><a name="line-209"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Time</span><span>
</span><a name="line-210"></a><span class="hs-keyword">import</span><span> </span><a href="Exception.html"><span class="hs-identifier">Exception</span></a><span>
</span><a name="line-211"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.FilePath</span><span>
</span><a name="line-212"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Concurrent</span><span>
</span><a name="line-213"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Process</span><span>   </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">ProcessHandle</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-216"></a><span class="hs-comment">-- Compilation state</span><span>
</span><a name="line-217"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-comment">-- | Status of a compilation to hard-code</span><span>
</span><a name="line-220"></a><span class="hs-keyword">data</span><span> </span><a name="HscStatus"><a href="HscTypes.html#HscStatus"><span class="hs-identifier">HscStatus</span></a></a><span>
</span><a name="line-221"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="HscNotGeneratingCode"><a href="HscTypes.html#HscNotGeneratingCode"><span class="hs-identifier">HscNotGeneratingCode</span></a></a><span>
</span><a name="line-222"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="HscUpToDate"><a href="HscTypes.html#HscUpToDate"><span class="hs-identifier">HscUpToDate</span></a></a><span>
</span><a name="line-223"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="HscUpdateBoot"><a href="HscTypes.html#HscUpdateBoot"><span class="hs-identifier">HscUpdateBoot</span></a></a><span>
</span><a name="line-224"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="HscUpdateSig"><a href="HscTypes.html#HscUpdateSig"><span class="hs-identifier">HscUpdateSig</span></a></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="HscRecomp"><a href="HscTypes.html#HscRecomp"><span class="hs-identifier">HscRecomp</span></a></a><span> </span><a href="HscTypes.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-228"></a><span class="hs-comment">-- The Hsc monad: Passing an environment and warning state</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-keyword">newtype</span><span> </span><a name="Hsc"><a href="HscTypes.html#Hsc"><span class="hs-identifier">Hsc</span></a></a><span> </span><a name="local-6989586621684063022"><a href="#local-6989586621684063022"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Hsc"><a href="HscTypes.html#Hsc"><span class="hs-identifier">Hsc</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#WarningMessages"><span class="hs-identifier hs-type">WarningMessages</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063022"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="ErrUtils.html#WarningMessages"><span class="hs-identifier hs-type">WarningMessages</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-233"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-236"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><a name="local-6989586621684063161"><a href="#local-6989586621684063161"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684063162"><a href="#local-6989586621684063162"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063161"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684063162"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-237"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-240"></a><span>    </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a><span> </span><a name="local-6989586621684063154"><a href="#local-6989586621684063154"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621684063155"><a href="#local-6989586621684063155"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684063156"><a href="#local-6989586621684063156"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621684063157"><a href="#local-6989586621684063157"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684063158"><a href="#local-6989586621684063158"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684063159"><a href="#local-6989586621684063159"><span class="hs-identifier">w1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063154"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621684063156"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621684063157"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-241"></a><span>                                   </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684063155"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621684063158"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-242"></a><span>                                       </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a><span> </span><a name="local-6989586621684063160"><a href="#local-6989586621684063160"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063160"><span class="hs-identifier hs-var">k'</span></a><span> </span><a href="#local-6989586621684063156"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621684063159"><span class="hs-identifier hs-var">w1</span></a><span>
</span><a name="line-243"></a><span>
</span><a name="line-244"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-245"></a><span>    </span><a name="local-8214565720323787328"><span class="hs-identifier">liftIO</span></a><span> </span><a name="local-6989586621684063151"><a href="#local-6989586621684063151"><span class="hs-identifier">io</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684063152"><a href="#local-6989586621684063152"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684063153"><a href="#local-6989586621684063153"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063151"><span class="hs-identifier hs-var">io</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063153"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684063152"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span class="hs-keyword">instance</span><span> </span><a href="DynFlags.html#HasDynFlags"><span class="hs-identifier hs-type">HasDynFlags</span></a><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-248"></a><span>    </span><a name="local-8214565720325324395"><a href="DynFlags.html#getDynFlags"><span class="hs-identifier">getDynFlags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684063149"><a href="#local-6989586621684063149"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621684063150"><a href="#local-6989586621684063150"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621684063149"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684063150"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-identifier">runHsc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a><span> </span><a href="#local-6989586621684063176"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621684063176"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-251"></a><a name="runHsc"><a href="HscTypes.html#runHsc"><span class="hs-identifier">runHsc</span></a></a><span> </span><a name="local-6989586621684063177"><a href="#local-6989586621684063177"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a><span> </span><a name="local-6989586621684063178"><a href="#local-6989586621684063178"><span class="hs-identifier">hsc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-252"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684063179"><a href="#local-6989586621684063179"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684063180"><a href="#local-6989586621684063180"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063178"><span class="hs-identifier hs-var">hsc</span></a><span> </span><a href="#local-6989586621684063177"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a><span>
</span><a name="line-253"></a><span>    </span><a href="HscTypes.html#printOrThrowWarnings"><span class="hs-identifier hs-var">printOrThrowWarnings</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621684063177"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063180"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-254"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684063179"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span class="hs-identifier">mkInteractiveHscEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-257"></a><a name="mkInteractiveHscEnv"><a href="HscTypes.html#mkInteractiveHscEnv"><span class="hs-identifier">mkInteractiveHscEnv</span></a></a><span> </span><a name="local-6989586621684063181"><a href="#local-6989586621684063181"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063181"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063182"><span class="hs-identifier hs-var">interactive_dflags</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-258"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-259"></a><span>    </span><a name="local-6989586621684063182"><a href="#local-6989586621684063182"><span class="hs-identifier">interactive_dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_dflags</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_IC</span><span> </span><a href="#local-6989586621684063181"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-identifier">runInteractiveHsc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a><span> </span><a href="#local-6989586621684063175"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621684063175"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-262"></a><span class="hs-comment">-- A variant of runHsc that switches in the DynFlags from the</span><span>
</span><a name="line-263"></a><span class="hs-comment">-- InteractiveContext before running the Hsc computation.</span><span>
</span><a name="line-264"></a><a name="runInteractiveHsc"><a href="HscTypes.html#runInteractiveHsc"><span class="hs-identifier">runInteractiveHsc</span></a></a><span> </span><a name="local-6989586621684063183"><a href="#local-6989586621684063183"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#mkInteractiveHscEnv"><span class="hs-identifier hs-var">mkInteractiveHscEnv</span></a><span> </span><a href="#local-6989586621684063183"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-267"></a><span class="hs-comment">-- Source Errors</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-comment">-- When the compiler (HscMain) discovers errors, it throws an</span><span>
</span><a name="line-270"></a><span class="hs-comment">-- exception in the IO monad.</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-identifier">mkSrcErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ErrUtils.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#SourceError"><span class="hs-identifier hs-type">SourceError</span></a><span>
</span><a name="line-273"></a><a name="mkSrcErr"><a href="HscTypes.html#mkSrcErr"><span class="hs-identifier">mkSrcErr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#SourceError"><span class="hs-identifier hs-var">SourceError</span></a><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-identifier">srcErrorMessages</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#SourceError"><span class="hs-identifier hs-type">SourceError</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ErrUtils.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a><span>
</span><a name="line-276"></a><a name="srcErrorMessages"><a href="HscTypes.html#srcErrorMessages"><span class="hs-identifier">srcErrorMessages</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#SourceError"><span class="hs-identifier hs-var">SourceError</span></a><span> </span><a name="local-6989586621684063184"><a href="#local-6989586621684063184"><span class="hs-identifier">msgs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063184"><span class="hs-identifier hs-var">msgs</span></a><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-identifier">mkApiErr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#GhcApiError"><span class="hs-identifier hs-type">GhcApiError</span></a><span>
</span><a name="line-279"></a><a name="mkApiErr"><a href="HscTypes.html#mkApiErr"><span class="hs-identifier">mkApiErr</span></a></a><span> </span><a name="local-6989586621684063185"><a href="#local-6989586621684063185"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684063186"><a href="#local-6989586621684063186"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#GhcApiError"><span class="hs-identifier hs-var">GhcApiError</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a><span> </span><a href="#local-6989586621684063185"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684063186"><span class="hs-identifier hs-var">msg</span></a><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-identifier">throwOneError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621684063173"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="ErrUtils.html#ErrMsg"><span class="hs-identifier hs-type">ErrMsg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063173"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621684063174"><span class="hs-identifier hs-type">ab</span></a><span>
</span><a name="line-282"></a><a name="throwOneError"><a href="HscTypes.html#throwOneError"><span class="hs-identifier">throwOneError</span></a></a><span> </span><a name="local-6989586621684063187"><a href="#local-6989586621684063187"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">throwIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HscTypes.html#mkSrcErr"><span class="hs-identifier hs-var">mkSrcErr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a><span> </span><a href="#local-6989586621684063187"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span class="hs-comment">-- | A source error is an error that is caused by one or more errors in the</span><span>
</span><a name="line-285"></a><span class="hs-comment">-- source code.  A 'SourceError' is thrown by many functions in the</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- compilation pipeline.  Inside GHC these errors are merely printed via</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- 'log_action', but API clients may treat them differently, for example,</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- insert them into a list box.  If you want the default behaviour, use the</span><span>
</span><a name="line-289"></a><span class="hs-comment">-- idiom:</span><span>
</span><a name="line-290"></a><span class="hs-comment">--</span><span>
</span><a name="line-291"></a><span class="hs-comment">-- &gt; handleSourceError printExceptionAndWarnings $ do</span><span>
</span><a name="line-292"></a><span class="hs-comment">-- &gt;   ... api calls that may fail ...</span><span>
</span><a name="line-293"></a><span class="hs-comment">--</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- The 'SourceError's error messages can be accessed via 'srcErrorMessages'.</span><span>
</span><a name="line-295"></a><span class="hs-comment">-- This list may be empty if the compiler failed due to @-Werror@</span><span>
</span><a name="line-296"></a><span class="hs-comment">-- ('Opt_WarnIsError').</span><span>
</span><a name="line-297"></a><span class="hs-comment">--</span><span>
</span><a name="line-298"></a><span class="hs-comment">-- See 'printExceptionAndWarnings' for more information on what to take care</span><span>
</span><a name="line-299"></a><span class="hs-comment">-- of when writing a custom error handler.</span><span>
</span><a name="line-300"></a><span class="hs-keyword">newtype</span><span> </span><a name="SourceError"><a href="HscTypes.html#SourceError"><span class="hs-identifier">SourceError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SourceError"><a href="HscTypes.html#SourceError"><span class="hs-identifier">SourceError</span></a></a><span> </span><a href="ErrUtils.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="HscTypes.html#SourceError"><span class="hs-identifier hs-type">SourceError</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-303"></a><span>  </span><a name="local-8214565720323790323"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#SourceError"><span class="hs-identifier hs-var">SourceError</span></a><span> </span><a name="local-6989586621684063148"><a href="#local-6989586621684063148"><span class="hs-identifier">msgs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Bag.html#bagToList"><span class="hs-identifier hs-var">bagToList</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684063148"><span class="hs-identifier hs-var">msgs</span></a><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="HscTypes.html#SourceError"><span class="hs-identifier hs-type">SourceError</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-comment">-- | Perform the given action and call the exception handler if the action</span><span>
</span><a name="line-308"></a><span class="hs-comment">-- throws a 'SourceError'.  See 'SourceError' for more information.</span><span>
</span><a name="line-309"></a><span class="hs-identifier">handleSourceError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Exception.html#ExceptionMonad"><span class="hs-identifier hs-type">ExceptionMonad</span></a><span> </span><a href="#local-6989586621684063171"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-310"></a><span>                     </span><span class="hs-special">(</span><a href="HscTypes.html#SourceError"><span class="hs-identifier hs-type">SourceError</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063171"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621684063172"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ exception handler</span><span>
</span><a name="line-311"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063171"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621684063172"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ action to perform</span><span>
</span><a name="line-312"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063171"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621684063172"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-313"></a><a name="handleSourceError"><a href="HscTypes.html#handleSourceError"><span class="hs-identifier">handleSourceError</span></a></a><span> </span><a name="local-6989586621684063188"><a href="#local-6989586621684063188"><span class="hs-identifier">handler</span></a></a><span> </span><a name="local-6989586621684063189"><a href="#local-6989586621684063189"><span class="hs-identifier">act</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-314"></a><span>  </span><a href="Exception.html#gcatch"><span class="hs-identifier hs-var">gcatch</span></a><span> </span><a href="#local-6989586621684063189"><span class="hs-identifier hs-var">act</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621684063190"><a href="#local-6989586621684063190"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#SourceError"><span class="hs-identifier hs-type">SourceError</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063188"><span class="hs-identifier hs-var">handler</span></a><span> </span><a href="#local-6989586621684063190"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-comment">-- | An error thrown if the GHC API is used in an incorrect fashion.</span><span>
</span><a name="line-317"></a><span class="hs-keyword">newtype</span><span> </span><a name="GhcApiError"><a href="HscTypes.html#GhcApiError"><span class="hs-identifier">GhcApiError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GhcApiError"><a href="HscTypes.html#GhcApiError"><span class="hs-identifier">GhcApiError</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="HscTypes.html#GhcApiError"><span class="hs-identifier hs-type">GhcApiError</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-320"></a><span>  </span><a name="local-8214565720323790323"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#GhcApiError"><span class="hs-identifier hs-var">GhcApiError</span></a><span> </span><a name="local-6989586621684063147"><a href="#local-6989586621684063147"><span class="hs-identifier">msg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063147"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="HscTypes.html#GhcApiError"><span class="hs-identifier hs-type">GhcApiError</span></a><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span class="hs-comment">-- | Given a bag of warnings, turn them into an exception if</span><span>
</span><a name="line-325"></a><span class="hs-comment">-- -Werror is enabled, or print them out otherwise.</span><span>
</span><a name="line-326"></a><span class="hs-identifier">printOrThrowWarnings</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a><span> </span><a href="ErrUtils.html#WarnMsg"><span class="hs-identifier hs-type">WarnMsg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-327"></a><a name="printOrThrowWarnings"><a href="HscTypes.html#printOrThrowWarnings"><span class="hs-identifier">printOrThrowWarnings</span></a></a><span> </span><a name="local-6989586621684063191"><a href="#local-6989586621684063191"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684063192"><a href="#local-6989586621684063192"><span class="hs-identifier">warns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-328"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684063193"><a href="#local-6989586621684063193"><span class="hs-identifier">make_error</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684063194"><a href="#local-6989586621684063194"><span class="hs-identifier">warns'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-329"></a><span>        </span><a href="Bag.html#mapAccumBagL"><span class="hs-identifier hs-var">mapAccumBagL</span></a><span>
</span><a name="line-330"></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684063195"><a href="#local-6989586621684063195"><span class="hs-identifier">make_err</span></a></a><span> </span><a name="local-6989586621684063196"><a href="#local-6989586621684063196"><span class="hs-identifier">warn</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-331"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="ErrUtils.html#isWarnMsgFatal"><span class="hs-identifier hs-var">isWarnMsgFatal</span></a><span> </span><a href="#local-6989586621684063191"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684063196"><span class="hs-identifier hs-var">warn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-332"></a><span>              </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-333"></a><span>                </span><span class="hs-special">(</span><a href="#local-6989586621684063195"><span class="hs-identifier hs-var">make_err</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684063196"><span class="hs-identifier hs-var">warn</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063197"><a href="#local-6989586621684063197"><span class="hs-identifier">err_reason</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-335"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684063196"><span class="hs-identifier hs-var">warn</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">errMsgSeverity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="ErrUtils.html#SevError"><span class="hs-identifier hs-var">SevError</span></a><span>
</span><a name="line-336"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">errMsgReason</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#ErrReason"><span class="hs-identifier hs-var">ErrReason</span></a><span> </span><a href="#local-6989586621684063197"><span class="hs-identifier hs-var">err_reason</span></a><span>
</span><a name="line-337"></a><span>                           </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>          </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684063192"><span class="hs-identifier hs-var">warns</span></a><span>
</span><a name="line-339"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684063193"><span class="hs-identifier hs-var">make_error</span></a><span>
</span><a name="line-340"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">throwIO</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#mkSrcErr"><span class="hs-identifier hs-var">mkSrcErr</span></a><span> </span><a href="#local-6989586621684063194"><span class="hs-identifier hs-var">warns'</span></a><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="ErrUtils.html#printBagOfErrors"><span class="hs-identifier hs-var">printBagOfErrors</span></a><span> </span><a href="#local-6989586621684063191"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684063192"><span class="hs-identifier hs-var">warns</span></a><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span class="hs-identifier">handleFlagWarnings</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmdLineParser.html#Warn"><span class="hs-identifier hs-type">Warn</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-344"></a><a name="handleFlagWarnings"><a href="HscTypes.html#handleFlagWarnings"><span class="hs-identifier">handleFlagWarnings</span></a></a><span> </span><a name="local-6989586621684063198"><a href="#local-6989586621684063198"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684063199"><a href="#local-6989586621684063199"><span class="hs-identifier">warns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-345"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684063200"><a href="#local-6989586621684063200"><span class="hs-identifier">warns'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#shouldPrintWarning"><span class="hs-identifier hs-var">shouldPrintWarning</span></a><span> </span><a href="#local-6989586621684063198"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">warnReason</span><span class="hs-special">)</span><span>  </span><a href="#local-6989586621684063199"><span class="hs-identifier hs-var">warns</span></a><span>
</span><a name="line-346"></a><span>
</span><a name="line-347"></a><span>      </span><span class="hs-comment">-- It would be nicer if warns :: [Located MsgDoc], but that</span><span>
</span><a name="line-348"></a><span>      </span><span class="hs-comment">-- has circular import problems.</span><span>
</span><a name="line-349"></a><span>      </span><a name="local-6989586621684063201"><a href="#local-6989586621684063201"><span class="hs-identifier">bag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="ErrUtils.html#mkPlainWarnMsg"><span class="hs-identifier hs-var">mkPlainWarnMsg</span></a><span> </span><a href="#local-6989586621684063198"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684063202"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621684063203"><span class="hs-identifier hs-var">warn</span></a><span class="hs-special">)</span><span>
</span><a name="line-350"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><a href="CmdLineParser.html#Warn"><span class="hs-identifier hs-var">Warn</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="SrcLoc.html#dL"><span class="hs-identifier hs-var">dL</span></a><span class="hs-glyph">-&gt;</span><a href="SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a><span> </span><a name="local-6989586621684063202"><a href="#local-6989586621684063202"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621684063203"><a href="#local-6989586621684063203"><span class="hs-identifier">warn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063200"><span class="hs-identifier hs-var">warns'</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span>  </span><a href="HscTypes.html#printOrThrowWarnings"><span class="hs-identifier hs-var">printOrThrowWarnings</span></a><span> </span><a href="#local-6989586621684063198"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684063201"><span class="hs-identifier hs-var">bag</span></a><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- Given a warn reason, check to see if it's associated -W opt is enabled</span><span>
</span><a name="line-355"></a><span class="hs-identifier">shouldPrintWarning</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmdLineParser.html#WarnReason"><span class="hs-identifier hs-type">CmdLineParser.WarnReason</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-356"></a><a name="shouldPrintWarning"><a href="HscTypes.html#shouldPrintWarning"><span class="hs-identifier">shouldPrintWarning</span></a></a><span> </span><a name="local-6989586621684063204"><a href="#local-6989586621684063204"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="CmdLineParser.html#ReasonDeprecatedFlag"><span class="hs-identifier hs-var">ReasonDeprecatedFlag</span></a><span>
</span><a name="line-357"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#wopt"><span class="hs-identifier hs-var">wopt</span></a><span> </span><a href="DynFlags.html#Opt_WarnDeprecatedFlags"><span class="hs-identifier hs-var">Opt_WarnDeprecatedFlags</span></a><span> </span><a href="#local-6989586621684063204"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-358"></a><span class="hs-identifier">shouldPrintWarning</span><span> </span><a name="local-6989586621684063205"><a href="#local-6989586621684063205"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="CmdLineParser.html#ReasonUnrecognisedFlag"><span class="hs-identifier hs-var">ReasonUnrecognisedFlag</span></a><span>
</span><a name="line-359"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="DynFlags.html#wopt"><span class="hs-identifier hs-var">wopt</span></a><span> </span><a href="DynFlags.html#Opt_WarnUnrecognisedWarningFlags"><span class="hs-identifier hs-var">Opt_WarnUnrecognisedWarningFlags</span></a><span> </span><a href="#local-6989586621684063205"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-360"></a><span class="hs-identifier">shouldPrintWarning</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-361"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{HscEnv}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">-- | HscEnv is like 'Session', except that some of the fields are immutable.</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- An HscEnv is used to compile a single module from plain Haskell source</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- code (after preprocessing) to either C, assembly or C--.  Things like</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- the module graph don't change during a single compilation.</span><span>
</span><a name="line-375"></a><span class="hs-comment">--</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- Historical note: \&quot;hsc\&quot; used to be the name of the compiler binary,</span><span>
</span><a name="line-377"></a><span class="hs-comment">-- when there was a separate driver and compiler.  To compile a single</span><span>
</span><a name="line-378"></a><span class="hs-comment">-- module, the driver would invoke hsc on the source code... so nowadays</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- we think of hsc as the layer of the compiler that deals with compiling</span><span>
</span><a name="line-380"></a><span class="hs-comment">-- a single module.</span><span>
</span><a name="line-381"></a><span class="hs-keyword">data</span><span> </span><a name="HscEnv"><a href="HscTypes.html#HscEnv"><span class="hs-identifier">HscEnv</span></a></a><span>
</span><a name="line-382"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="HscEnv"><a href="HscTypes.html#HscEnv"><span class="hs-identifier">HscEnv</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-383"></a><span>        </span><a name="hsc_dflags"><a href="HscTypes.html#hsc_dflags"><span class="hs-identifier">hsc_dflags</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-384"></a><span>                </span><span class="hs-comment">-- ^ The dynamic flag settings</span><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span>        </span><a name="hsc_targets"><a href="HscTypes.html#hsc_targets"><span class="hs-identifier">hsc_targets</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#Target"><span class="hs-identifier hs-type">Target</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-387"></a><span>                </span><span class="hs-comment">-- ^ The targets (or roots) of the current session</span><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span>        </span><a name="hsc_mod_graph"><a href="HscTypes.html#hsc_mod_graph"><span class="hs-identifier">hsc_mod_graph</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span class="hs-special">,</span><span>
</span><a name="line-390"></a><span>                </span><span class="hs-comment">-- ^ The module graph of the current session</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span>        </span><a name="hsc_IC"><a href="HscTypes.html#hsc_IC"><span class="hs-identifier">hsc_IC</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span class="hs-special">,</span><span>
</span><a name="line-393"></a><span>                </span><span class="hs-comment">-- ^ The context for evaluating interactive statements</span><span>
</span><a name="line-394"></a><span>
</span><a name="line-395"></a><span>        </span><a name="hsc_HPT"><a href="HscTypes.html#hsc_HPT"><span class="hs-identifier">hsc_HPT</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span class="hs-special">,</span><span>
</span><a name="line-396"></a><span>                </span><span class="hs-comment">-- ^ The home package table describes already-compiled</span><span>
</span><a name="line-397"></a><span>                </span><span class="hs-comment">-- home-package modules, /excluding/ the module we</span><span>
</span><a name="line-398"></a><span>                </span><span class="hs-comment">-- are compiling right now.</span><span>
</span><a name="line-399"></a><span>                </span><span class="hs-comment">-- (In one-shot mode the current module is the only</span><span>
</span><a name="line-400"></a><span>                </span><span class="hs-comment">-- home-package module, so hsc_HPT is empty.  All other</span><span>
</span><a name="line-401"></a><span>                </span><span class="hs-comment">-- modules count as \&quot;external-package\&quot; modules.</span><span>
</span><a name="line-402"></a><span>                </span><span class="hs-comment">-- However, even in GHCi mode, hi-boot interfaces are</span><span>
</span><a name="line-403"></a><span>                </span><span class="hs-comment">-- demand-loaded into the external-package table.)</span><span>
</span><a name="line-404"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-405"></a><span>                </span><span class="hs-comment">-- 'hsc_HPT' is not mutable because we only demand-load</span><span>
</span><a name="line-406"></a><span>                </span><span class="hs-comment">-- external packages; the home package is eagerly</span><span>
</span><a name="line-407"></a><span>                </span><span class="hs-comment">-- loaded, module by module, by the compilation manager.</span><span>
</span><a name="line-408"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-409"></a><span>                </span><span class="hs-comment">-- The HPT may contain modules compiled earlier by @--make@</span><span>
</span><a name="line-410"></a><span>                </span><span class="hs-comment">-- but not actually below the current module in the dependency</span><span>
</span><a name="line-411"></a><span>                </span><span class="hs-comment">-- graph.</span><span>
</span><a name="line-412"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-413"></a><span>                </span><span class="hs-comment">-- (This changes a previous invariant: changed Jan 05.)</span><span>
</span><a name="line-414"></a><span>
</span><a name="line-415"></a><span>        </span><a name="hsc_EPS"><a href="HscTypes.html#hsc_EPS"><span class="hs-identifier">hsc_EPS</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="HscTypes.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-416"></a><span>                </span><span class="hs-comment">-- ^ Information about the currently loaded external packages.</span><span>
</span><a name="line-417"></a><span>                </span><span class="hs-comment">-- This is mutable because packages will be demand-loaded during</span><span>
</span><a name="line-418"></a><span>                </span><span class="hs-comment">-- a compilation run as required.</span><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span>        </span><a name="hsc_NC"><a href="HscTypes.html#hsc_NC"><span class="hs-identifier">hsc_NC</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="NameCache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-421"></a><span>                </span><span class="hs-comment">-- ^ As with 'hsc_EPS', this is side-effected by compiling to</span><span>
</span><a name="line-422"></a><span>                </span><span class="hs-comment">-- reflect sucking in interface files.  They cache the state of</span><span>
</span><a name="line-423"></a><span>                </span><span class="hs-comment">-- external interface files, in effect.</span><span>
</span><a name="line-424"></a><span>
</span><a name="line-425"></a><span>        </span><a name="hsc_FC"><a href="HscTypes.html#hsc_FC"><span class="hs-identifier">hsc_FC</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="HscTypes.html#FinderCache"><span class="hs-identifier hs-type">FinderCache</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-426"></a><span>                </span><span class="hs-comment">-- ^ The cached result of performing finding in the file system</span><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span>        </span><a name="hsc_type_env_var"><a href="HscTypes.html#hsc_type_env_var"><span class="hs-identifier">hsc_type_env_var</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span class="hs-special">)</span><span>
</span><a name="line-429"></a><span>                </span><span class="hs-comment">-- ^ Used for one-shot compilation only, to initialise</span><span>
</span><a name="line-430"></a><span>                </span><span class="hs-comment">-- the 'IfGblEnv'. See 'TcRnTypes.tcg_type_env_var' for</span><span>
</span><a name="line-431"></a><span>                </span><span class="hs-comment">-- 'TcRnTypes.TcGblEnv'.  See also Note [hsc_type_env_var hack]</span><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="hsc_iserv"><a href="HscTypes.html#hsc_iserv"><span class="hs-identifier">hsc_iserv</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HscTypes.html#IServ"><span class="hs-identifier hs-type">IServ</span></a><span class="hs-special">)</span><span>
</span><a name="line-434"></a><span>                </span><span class="hs-comment">-- ^ interactive server process.  Created the first</span><span>
</span><a name="line-435"></a><span>                </span><span class="hs-comment">-- time it is needed.</span><span>
</span><a name="line-436"></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span class="hs-comment">-- Note [hsc_type_env_var hack]</span><span>
</span><a name="line-439"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-440"></a><span class="hs-comment">-- hsc_type_env_var is used to initialize tcg_type_env_var, and</span><span>
</span><a name="line-441"></a><span class="hs-comment">-- eventually it is the mutable variable that is queried from</span><span>
</span><a name="line-442"></a><span class="hs-comment">-- if_rec_types to get a TypeEnv.  So, clearly, it's something</span><span>
</span><a name="line-443"></a><span class="hs-comment">-- related to knot-tying (see Note [Tying the knot]).</span><span>
</span><a name="line-444"></a><span class="hs-comment">-- hsc_type_env_var is used in two places: initTcRn (where</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- it initializes tcg_type_env_var) and initIfaceCheck</span><span>
</span><a name="line-446"></a><span class="hs-comment">-- (where it initializes if_rec_types).</span><span>
</span><a name="line-447"></a><span class="hs-comment">--</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- But why do we need a way to feed a mutable variable in?  Why</span><span>
</span><a name="line-449"></a><span class="hs-comment">-- can't we just initialize tcg_type_env_var when we start</span><span>
</span><a name="line-450"></a><span class="hs-comment">-- typechecking?  The problem is we need to knot-tie the</span><span>
</span><a name="line-451"></a><span class="hs-comment">-- EPS, and we may start adding things to the EPS before type</span><span>
</span><a name="line-452"></a><span class="hs-comment">-- checking starts.</span><span>
</span><a name="line-453"></a><span class="hs-comment">--</span><span>
</span><a name="line-454"></a><span class="hs-comment">-- Here is a concrete example. Suppose we are running</span><span>
</span><a name="line-455"></a><span class="hs-comment">-- &quot;ghc -c A.hs&quot;, and we have this file system state:</span><span>
</span><a name="line-456"></a><span class="hs-comment">--</span><span>
</span><a name="line-457"></a><span class="hs-comment">--  A.hs-boot   A.hi-boot **up to date**</span><span>
</span><a name="line-458"></a><span class="hs-comment">--  B.hs        B.hi      **up to date**</span><span>
</span><a name="line-459"></a><span class="hs-comment">--  A.hs        A.hi      **stale**</span><span>
</span><a name="line-460"></a><span class="hs-comment">--</span><span>
</span><a name="line-461"></a><span class="hs-comment">-- The first thing we do is run checkOldIface on A.hi.</span><span>
</span><a name="line-462"></a><span class="hs-comment">-- checkOldIface will call loadInterface on B.hi so it can</span><span>
</span><a name="line-463"></a><span class="hs-comment">-- get its hands on the fingerprints, to find out if A.hi</span><span>
</span><a name="line-464"></a><span class="hs-comment">-- needs recompilation.  But loadInterface also populates</span><span>
</span><a name="line-465"></a><span class="hs-comment">-- the EPS!  And so if compilation turns out to be necessary,</span><span>
</span><a name="line-466"></a><span class="hs-comment">-- as it is in this case, the thunks we put into the EPS for</span><span>
</span><a name="line-467"></a><span class="hs-comment">-- B.hi need to have the correct if_rec_types mutable variable</span><span>
</span><a name="line-468"></a><span class="hs-comment">-- to query.</span><span>
</span><a name="line-469"></a><span class="hs-comment">--</span><span>
</span><a name="line-470"></a><span class="hs-comment">-- If the mutable variable is only allocated WHEN we start</span><span>
</span><a name="line-471"></a><span class="hs-comment">-- typechecking, then that's too late: we can't get the</span><span>
</span><a name="line-472"></a><span class="hs-comment">-- information to the thunks.  So we need to pre-commit</span><span>
</span><a name="line-473"></a><span class="hs-comment">-- to a type variable in 'hscIncrementalCompile' BEFORE we</span><span>
</span><a name="line-474"></a><span class="hs-comment">-- check the old interface.</span><span>
</span><a name="line-475"></a><span class="hs-comment">--</span><span>
</span><a name="line-476"></a><span class="hs-comment">-- This is all a massive hack because arguably checkOldIface</span><span>
</span><a name="line-477"></a><span class="hs-comment">-- should not populate the EPS. But that's a refactor for</span><span>
</span><a name="line-478"></a><span class="hs-comment">-- another day.</span><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span>
</span><a name="line-481"></a><span class="hs-keyword">data</span><span> </span><a name="IServ"><a href="HscTypes.html#IServ"><span class="hs-identifier">IServ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="IServ"><a href="HscTypes.html#IServ"><span class="hs-identifier">IServ</span></a></a><span>
</span><a name="line-482"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="iservPipe"><a href="HscTypes.html#iservPipe"><span class="hs-identifier">iservPipe</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHCi.Message.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a><span>
</span><a name="line-483"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="iservProcess"><a href="HscTypes.html#iservProcess"><span class="hs-identifier">iservProcess</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ProcessHandle</span><span>
</span><a name="line-484"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="iservLookupSymbolCache"><a href="HscTypes.html#iservLookupSymbolCache"><span class="hs-identifier">iservLookupSymbolCache</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><span class="hs-special">(</span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ptr</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-485"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="iservPendingFrees"><a href="HscTypes.html#iservPendingFrees"><span class="hs-identifier">iservPendingFrees</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="GHCi.RemoteTypes.html#HValueRef"><span class="hs-identifier hs-type">HValueRef</span></a><span class="hs-special">]</span><span>
</span><a name="line-486"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span class="hs-comment">-- | Retrieve the ExternalPackageState cache.</span><span>
</span><a name="line-489"></a><span class="hs-identifier">hscEPS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="HscTypes.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a><span>
</span><a name="line-490"></a><a name="hscEPS"><a href="HscTypes.html#hscEPS"><span class="hs-identifier">hscEPS</span></a></a><span> </span><a name="local-6989586621684063206"><a href="#local-6989586621684063206"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readIORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_EPS</span><span> </span><a href="#local-6989586621684063206"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span class="hs-comment">-- | A compilation target.</span><span>
</span><a name="line-493"></a><span class="hs-comment">--</span><span>
</span><a name="line-494"></a><span class="hs-comment">-- A target may be supplied with the actual text of the</span><span>
</span><a name="line-495"></a><span class="hs-comment">-- module.  If so, use this instead of the file contents (this</span><span>
</span><a name="line-496"></a><span class="hs-comment">-- is for use in an IDE where the file hasn't been saved by</span><span>
</span><a name="line-497"></a><span class="hs-comment">-- the user yet).</span><span>
</span><a name="line-498"></a><span class="hs-keyword">data</span><span> </span><a name="Target"><a href="HscTypes.html#Target"><span class="hs-identifier">Target</span></a></a><span>
</span><a name="line-499"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Target"><a href="HscTypes.html#Target"><span class="hs-identifier">Target</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-500"></a><span>      </span><a name="targetId"><a href="HscTypes.html#targetId"><span class="hs-identifier">targetId</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TargetId"><span class="hs-identifier hs-type">TargetId</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ module or filename</span><span>
</span><a name="line-501"></a><span>      </span><a name="targetAllowObjCode"><a href="HscTypes.html#targetAllowObjCode"><span class="hs-identifier">targetAllowObjCode</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ object code allowed?</span><span>
</span><a name="line-502"></a><span>      </span><a name="targetContents"><a href="HscTypes.html#targetContents"><span class="hs-identifier">targetContents</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">UTCTime</span><span class="hs-special">)</span><span>
</span><a name="line-503"></a><span>                                        </span><span class="hs-comment">-- ^ in-memory text buffer?</span><span>
</span><a name="line-504"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-505"></a><span>
</span><a name="line-506"></a><span class="hs-keyword">data</span><span> </span><a name="TargetId"><a href="HscTypes.html#TargetId"><span class="hs-identifier">TargetId</span></a></a><span>
</span><a name="line-507"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TargetModule"><a href="HscTypes.html#TargetModule"><span class="hs-identifier">TargetModule</span></a></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-508"></a><span>        </span><span class="hs-comment">-- ^ A module name: search for the file</span><span>
</span><a name="line-509"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="TargetFile"><a href="HscTypes.html#TargetFile"><span class="hs-identifier">TargetFile</span></a></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="DriverPhases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a><span class="hs-special">)</span><span>
</span><a name="line-510"></a><span>        </span><span class="hs-comment">-- ^ A filename: preprocess &amp; parse it to find the module name.</span><span>
</span><a name="line-511"></a><span>        </span><span class="hs-comment">-- If specified, the Phase indicates how to compile this file</span><span>
</span><a name="line-512"></a><span>        </span><span class="hs-comment">-- (which phase to start from).  Nothing indicates the starting phase</span><span>
</span><a name="line-513"></a><span>        </span><span class="hs-comment">-- should be determined from the suffix of the filename.</span><span>
</span><a name="line-514"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Eq</span><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span class="hs-identifier">pprTarget</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Target"><span class="hs-identifier hs-type">Target</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-517"></a><a name="pprTarget"><a href="HscTypes.html#pprTarget"><span class="hs-identifier">pprTarget</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#Target"><span class="hs-identifier hs-var">Target</span></a><span> </span><a name="local-6989586621684063207"><a href="#local-6989586621684063207"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621684063208"><a href="#local-6989586621684063208"><span class="hs-identifier">obj</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-518"></a><span>    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684063208"><span class="hs-identifier hs-var">obj</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'*'</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="HscTypes.html#pprTargetId"><span class="hs-identifier hs-var">pprTargetId</span></a><span> </span><a href="#local-6989586621684063207"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="HscTypes.html#Target"><span class="hs-identifier hs-type">Target</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-521"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#pprTarget"><span class="hs-identifier hs-var">pprTarget</span></a><span>
</span><a name="line-522"></a><span>
</span><a name="line-523"></a><span class="hs-identifier">pprTargetId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TargetId"><span class="hs-identifier hs-type">TargetId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-524"></a><a name="pprTargetId"><a href="HscTypes.html#pprTargetId"><span class="hs-identifier">pprTargetId</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TargetModule"><span class="hs-identifier hs-var">TargetModule</span></a><span> </span><a name="local-6989586621684063209"><a href="#local-6989586621684063209"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063209"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-525"></a><span class="hs-identifier">pprTargetId</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TargetFile"><span class="hs-identifier hs-var">TargetFile</span></a><span> </span><a name="local-6989586621684063210"><a href="#local-6989586621684063210"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621684063210"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="HscTypes.html#TargetId"><span class="hs-identifier hs-type">TargetId</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-528"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#pprTargetId"><span class="hs-identifier hs-var">pprTargetId</span></a><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Package and Module Tables}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-537"></a><span>
</span><a name="line-538"></a><span class="hs-comment">-- | Helps us find information about modules in the home package</span><span>
</span><a name="line-539"></a><span class="hs-keyword">type</span><span> </span><a name="HomePackageTable"><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier">HomePackageTable</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#DModuleNameEnv"><span class="hs-identifier hs-type">DModuleNameEnv</span></a><span> </span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span>
</span><a name="line-540"></a><span>        </span><span class="hs-comment">-- Domain = modules in the home package that have been fully compiled</span><span>
</span><a name="line-541"></a><span>        </span><span class="hs-comment">-- &quot;home&quot; unit id cached here for convenience</span><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><span class="hs-comment">-- | Helps us find information about modules in the imported packages</span><span>
</span><a name="line-544"></a><span class="hs-keyword">type</span><span> </span><a name="PackageIfaceTable"><a href="HscTypes.html#PackageIfaceTable"><span class="hs-identifier">PackageIfaceTable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span>
</span><a name="line-545"></a><span>        </span><span class="hs-comment">-- Domain = modules in the imported packages</span><span>
</span><a name="line-546"></a><span>
</span><a name="line-547"></a><span class="hs-comment">-- | Constructs an empty HomePackageTable</span><span>
</span><a name="line-548"></a><span class="hs-identifier">emptyHomePackageTable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span>
</span><a name="line-549"></a><a name="emptyHomePackageTable"><a href="HscTypes.html#emptyHomePackageTable"><span class="hs-identifier">emptyHomePackageTable</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#emptyUDFM"><span class="hs-identifier hs-var">emptyUDFM</span></a><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><span class="hs-comment">-- | Constructs an empty PackageIfaceTable</span><span>
</span><a name="line-552"></a><span class="hs-identifier">emptyPackageIfaceTable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#PackageIfaceTable"><span class="hs-identifier hs-type">PackageIfaceTable</span></a><span>
</span><a name="line-553"></a><a name="emptyPackageIfaceTable"><a href="HscTypes.html#emptyPackageIfaceTable"><span class="hs-identifier">emptyPackageIfaceTable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#emptyModuleEnv"><span class="hs-identifier hs-var">emptyModuleEnv</span></a><span>
</span><a name="line-554"></a><span>
</span><a name="line-555"></a><span class="hs-identifier">pprHPT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-556"></a><span class="hs-comment">-- A bit arbitrary for now</span><span>
</span><a name="line-557"></a><a name="pprHPT"><a href="HscTypes.html#pprHPT"><span class="hs-identifier">pprHPT</span></a></a><span> </span><a name="local-6989586621684063211"><a href="#local-6989586621684063211"><span class="hs-identifier">hpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#pprUDFM"><span class="hs-identifier hs-var">pprUDFM</span></a><span> </span><a href="#local-6989586621684063211"><span class="hs-identifier hs-var">hpt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684063212"><a href="#local-6989586621684063212"><span class="hs-identifier">hms</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-558"></a><span>    </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_module</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hm_iface</span><span> </span><a href="#local-6989586621684063213"><span class="hs-identifier hs-var">hm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-559"></a><span>              </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">md_types</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hm_details</span><span> </span><a href="#local-6989586621684063213"><span class="hs-identifier hs-var">hm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-560"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621684063213"><a href="#local-6989586621684063213"><span class="hs-identifier">hm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063212"><span class="hs-identifier hs-var">hms</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-561"></a><span>
</span><a name="line-562"></a><span class="hs-identifier">lookupHpt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span>
</span><a name="line-563"></a><a name="lookupHpt"><a href="HscTypes.html#lookupHpt"><span class="hs-identifier">lookupHpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#lookupUDFM"><span class="hs-identifier hs-var">lookupUDFM</span></a><span>
</span><a name="line-564"></a><span>
</span><a name="line-565"></a><span class="hs-identifier">lookupHptDirectly</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span>
</span><a name="line-566"></a><a name="lookupHptDirectly"><a href="HscTypes.html#lookupHptDirectly"><span class="hs-identifier">lookupHptDirectly</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#lookupUDFM_Directly"><span class="hs-identifier hs-var">lookupUDFM_Directly</span></a><span>
</span><a name="line-567"></a><span>
</span><a name="line-568"></a><span class="hs-identifier">eltsHpt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-569"></a><a name="eltsHpt"><a href="HscTypes.html#eltsHpt"><span class="hs-identifier">eltsHpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#eltsUDFM"><span class="hs-identifier hs-var">eltsUDFM</span></a><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span class="hs-identifier">filterHpt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span>
</span><a name="line-572"></a><a name="filterHpt"><a href="HscTypes.html#filterHpt"><span class="hs-identifier">filterHpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#filterUDFM"><span class="hs-identifier hs-var">filterUDFM</span></a><span>
</span><a name="line-573"></a><span>
</span><a name="line-574"></a><span class="hs-identifier">allHpt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-575"></a><a name="allHpt"><a href="HscTypes.html#allHpt"><span class="hs-identifier">allHpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#allUDFM"><span class="hs-identifier hs-var">allUDFM</span></a><span>
</span><a name="line-576"></a><span>
</span><a name="line-577"></a><span class="hs-identifier">mapHpt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span>
</span><a name="line-578"></a><a name="mapHpt"><a href="HscTypes.html#mapHpt"><span class="hs-identifier">mapHpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#mapUDFM"><span class="hs-identifier hs-var">mapUDFM</span></a><span>
</span><a name="line-579"></a><span>
</span><a name="line-580"></a><span class="hs-identifier">delFromHpt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span>
</span><a name="line-581"></a><a name="delFromHpt"><a href="HscTypes.html#delFromHpt"><span class="hs-identifier">delFromHpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#delFromUDFM"><span class="hs-identifier hs-var">delFromUDFM</span></a><span>
</span><a name="line-582"></a><span>
</span><a name="line-583"></a><span class="hs-identifier">addToHpt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span>
</span><a name="line-584"></a><a name="addToHpt"><a href="HscTypes.html#addToHpt"><span class="hs-identifier">addToHpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#addToUDFM"><span class="hs-identifier hs-var">addToUDFM</span></a><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span class="hs-identifier">addListToHpt</span><span>
</span><a name="line-587"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span>
</span><a name="line-588"></a><a name="addListToHpt"><a href="HscTypes.html#addListToHpt"><span class="hs-identifier">addListToHpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#addListToUDFM"><span class="hs-identifier hs-var">addListToUDFM</span></a><span>
</span><a name="line-589"></a><span>
</span><a name="line-590"></a><span class="hs-identifier">listToHpt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span>
</span><a name="line-591"></a><a name="listToHpt"><a href="HscTypes.html#listToHpt"><span class="hs-identifier">listToHpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqDFM.html#listToUDFM"><span class="hs-identifier hs-var">listToUDFM</span></a><span>
</span><a name="line-592"></a><span>
</span><a name="line-593"></a><span class="hs-identifier">lookupHptByModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span>
</span><a name="line-594"></a><span class="hs-comment">-- The HPT is indexed by ModuleName, not Module,</span><span>
</span><a name="line-595"></a><span class="hs-comment">-- we must check for a hit on the right Module</span><span>
</span><a name="line-596"></a><a name="lookupHptByModule"><a href="HscTypes.html#lookupHptByModule"><span class="hs-identifier">lookupHptByModule</span></a></a><span> </span><a name="local-6989586621684063214"><a href="#local-6989586621684063214"><span class="hs-identifier">hpt</span></a></a><span> </span><a name="local-6989586621684063215"><a href="#local-6989586621684063215"><span class="hs-identifier">mod</span></a></a><span>
</span><a name="line-597"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="HscTypes.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a><span> </span><a href="#local-6989586621684063214"><span class="hs-identifier hs-var">hpt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621684063215"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-598"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063216"><a href="#local-6989586621684063216"><span class="hs-identifier">hm</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">mi_module</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hm_iface</span><span> </span><a href="#local-6989586621684063216"><span class="hs-identifier hs-var">hm</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684063215"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684063216"><span class="hs-identifier hs-var">hm</span></a><span>
</span><a name="line-599"></a><span>      </span><a name="local-6989586621684063217"><a href="#local-6989586621684063217"><span class="hs-identifier">_otherwise</span></a></a><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-600"></a><span>
</span><a name="line-601"></a><span class="hs-comment">-- | Information about modules in the package being compiled</span><span>
</span><a name="line-602"></a><span class="hs-keyword">data</span><span> </span><a name="HomeModInfo"><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier">HomeModInfo</span></a></a><span>
</span><a name="line-603"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="HomeModInfo"><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier">HomeModInfo</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-604"></a><span>      </span><a name="hm_iface"><a href="HscTypes.html#hm_iface"><span class="hs-identifier">hm_iface</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span class="hs-special">,</span><span>
</span><a name="line-605"></a><span>        </span><span class="hs-comment">-- ^ The basic loaded interface file: every loaded module has one of</span><span>
</span><a name="line-606"></a><span>        </span><span class="hs-comment">-- these, even if it is imported from another package</span><span>
</span><a name="line-607"></a><span>      </span><a name="hm_details"><a href="HscTypes.html#hm_details"><span class="hs-identifier">hm_details</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span class="hs-special">,</span><span>
</span><a name="line-608"></a><span>        </span><span class="hs-comment">-- ^ Extra information that has been created from the 'ModIface' for</span><span>
</span><a name="line-609"></a><span>        </span><span class="hs-comment">-- the module, typically during typechecking</span><span>
</span><a name="line-610"></a><span>      </span><a name="hm_linkable"><a href="HscTypes.html#hm_linkable"><span class="hs-identifier">hm_linkable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HscTypes.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a><span class="hs-special">)</span><span>
</span><a name="line-611"></a><span>        </span><span class="hs-comment">-- ^ The actual artifact we would like to link to access things in</span><span>
</span><a name="line-612"></a><span>        </span><span class="hs-comment">-- this module.</span><span>
</span><a name="line-613"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-614"></a><span>        </span><span class="hs-comment">-- 'hm_linkable' might be Nothing:</span><span>
</span><a name="line-615"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-616"></a><span>        </span><span class="hs-comment">--   1. If this is an .hs-boot module</span><span>
</span><a name="line-617"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-618"></a><span>        </span><span class="hs-comment">--   2. Temporarily during compilation if we pruned away</span><span>
</span><a name="line-619"></a><span>        </span><span class="hs-comment">--      the old linkable because it was out of date.</span><span>
</span><a name="line-620"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-621"></a><span>        </span><span class="hs-comment">-- After a complete compilation ('GHC.load'), all 'hm_linkable' fields</span><span>
</span><a name="line-622"></a><span>        </span><span class="hs-comment">-- in the 'HomePackageTable' will be @Just@.</span><span>
</span><a name="line-623"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-624"></a><span>        </span><span class="hs-comment">-- When re-linking a module ('HscMain.HscNoRecomp'), we construct the</span><span>
</span><a name="line-625"></a><span>        </span><span class="hs-comment">-- 'HomeModInfo' by building a new 'ModDetails' from the old</span><span>
</span><a name="line-626"></a><span>        </span><span class="hs-comment">-- 'ModIface' (only).</span><span>
</span><a name="line-627"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-628"></a><span>
</span><a name="line-629"></a><span class="hs-comment">-- | Find the 'ModIface' for a 'Module', searching in both the loaded home</span><span>
</span><a name="line-630"></a><span class="hs-comment">-- and external package module information</span><span>
</span><a name="line-631"></a><span class="hs-identifier">lookupIfaceByModule</span><span>
</span><a name="line-632"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-633"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span>
</span><a name="line-634"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#PackageIfaceTable"><span class="hs-identifier hs-type">PackageIfaceTable</span></a><span>
</span><a name="line-635"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-636"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span>
</span><a name="line-637"></a><a name="lookupIfaceByModule"><a href="HscTypes.html#lookupIfaceByModule"><span class="hs-identifier">lookupIfaceByModule</span></a></a><span> </span><a name="local-6989586621684063218"><a href="#local-6989586621684063218"><span class="hs-identifier">_dflags</span></a></a><span> </span><a name="local-6989586621684063219"><a href="#local-6989586621684063219"><span class="hs-identifier">hpt</span></a></a><span> </span><a name="local-6989586621684063220"><a href="#local-6989586621684063220"><span class="hs-identifier">pit</span></a></a><span> </span><a name="local-6989586621684063221"><a href="#local-6989586621684063221"><span class="hs-identifier">mod</span></a></a><span>
</span><a name="line-638"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="HscTypes.html#lookupHptByModule"><span class="hs-identifier hs-var">lookupHptByModule</span></a><span> </span><a href="#local-6989586621684063219"><span class="hs-identifier hs-var">hpt</span></a><span> </span><a href="#local-6989586621684063221"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-639"></a><span>       </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063222"><a href="#local-6989586621684063222"><span class="hs-identifier">hm</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hm_iface</span><span> </span><a href="#local-6989586621684063222"><span class="hs-identifier hs-var">hm</span></a><span class="hs-special">)</span><span>
</span><a name="line-640"></a><span>       </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#lookupModuleEnv"><span class="hs-identifier hs-var">lookupModuleEnv</span></a><span> </span><a href="#local-6989586621684063220"><span class="hs-identifier hs-var">pit</span></a><span> </span><a href="#local-6989586621684063221"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-641"></a><span>
</span><a name="line-642"></a><span class="hs-comment">-- If the module does come from the home package, why do we look in the PIT as well?</span><span>
</span><a name="line-643"></a><span class="hs-comment">-- (a) In OneShot mode, even home-package modules accumulate in the PIT</span><span>
</span><a name="line-644"></a><span class="hs-comment">-- (b) Even in Batch (--make) mode, there is *one* case where a home-package</span><span>
</span><a name="line-645"></a><span class="hs-comment">--     module is in the PIT, namely GHC.Prim when compiling the base package.</span><span>
</span><a name="line-646"></a><span class="hs-comment">-- We could eliminate (b) if we wanted, by making GHC.Prim belong to a package</span><span>
</span><a name="line-647"></a><span class="hs-comment">-- of its own, but it doesn't seem worth the bother.</span><span>
</span><a name="line-648"></a><span>
</span><a name="line-649"></a><span class="hs-identifier">hptCompleteSigs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">]</span><span>
</span><a name="line-650"></a><a name="hptCompleteSigs"><a href="HscTypes.html#hptCompleteSigs"><span class="hs-identifier">hptCompleteSigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#hptAllThings"><span class="hs-identifier hs-var">hptAllThings</span></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">md_complete_sigs</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">hm_details</span><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>
</span><a name="line-652"></a><span class="hs-comment">-- | Find all the instance declarations (of classes and families) from</span><span>
</span><a name="line-653"></a><span class="hs-comment">-- the Home Package Table filtered by the provided predicate function.</span><span>
</span><a name="line-654"></a><span class="hs-comment">-- Used in @tcRnImports@, to select the instances that are in the</span><span>
</span><a name="line-655"></a><span class="hs-comment">-- transitive closure of imports from the currently compiled module.</span><span>
</span><a name="line-656"></a><span class="hs-identifier">hptInstances</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-657"></a><a name="hptInstances"><a href="HscTypes.html#hptInstances"><span class="hs-identifier">hptInstances</span></a></a><span> </span><a name="local-6989586621684063223"><a href="#local-6989586621684063223"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621684063224"><a href="#local-6989586621684063224"><span class="hs-identifier">want_this_module</span></a></a><span>
</span><a name="line-658"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684063225"><a href="#local-6989586621684063225"><span class="hs-identifier">insts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684063226"><a href="#local-6989586621684063226"><span class="hs-identifier">famInsts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><a href="HscTypes.html#hptAllThings"><span class="hs-identifier hs-var">hptAllThings</span></a><span> </span><a href="#local-6989586621684063223"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684063227"><a href="#local-6989586621684063227"><span class="hs-identifier">mod_info</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-659"></a><span>                </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063224"><span class="hs-identifier hs-var">want_this_module</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_module</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hm_iface</span><span> </span><a href="#local-6989586621684063227"><span class="hs-identifier hs-var">mod_info</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-660"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684063228"><a href="#local-6989586621684063228"><span class="hs-identifier">details</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hm_details</span><span> </span><a href="#local-6989586621684063227"><span class="hs-identifier hs-var">mod_info</span></a><span>
</span><a name="line-661"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">md_insts</span><span> </span><a href="#local-6989586621684063228"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">md_fam_insts</span><span> </span><a href="#local-6989586621684063228"><span class="hs-identifier hs-var">details</span></a><span class="hs-special">)</span><span>
</span><a name="line-662"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621684063225"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621684063226"><span class="hs-identifier hs-var">famInsts</span></a><span class="hs-special">)</span><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span class="hs-comment">-- | Get rules from modules &quot;below&quot; this one (in the dependency sense)</span><span>
</span><a name="line-665"></a><span class="hs-identifier">hptRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span class="hs-special">]</span><span>
</span><a name="line-666"></a><a name="hptRules"><a href="HscTypes.html#hptRules"><span class="hs-identifier">hptRules</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#hptSomeThingsBelowUs"><span class="hs-identifier hs-var">hptSomeThingsBelowUs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">md_rules</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">hm_details</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-667"></a><span>
</span><a name="line-668"></a><span>
</span><a name="line-669"></a><span class="hs-comment">-- | Get annotations from modules &quot;below&quot; this one (in the dependency sense)</span><span>
</span><a name="line-670"></a><span class="hs-identifier">hptAnns</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a><span class="hs-special">]</span><span>
</span><a name="line-671"></a><a name="hptAnns"><a href="HscTypes.html#hptAnns"><span class="hs-identifier">hptAnns</span></a></a><span> </span><a name="local-6989586621684063229"><a href="#local-6989586621684063229"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063230"><a href="#local-6989586621684063230"><span class="hs-identifier">deps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#hptSomeThingsBelowUs"><span class="hs-identifier hs-var">hptSomeThingsBelowUs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">md_anns</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">hm_details</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684063229"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><a href="#local-6989586621684063230"><span class="hs-identifier hs-var">deps</span></a><span>
</span><a name="line-672"></a><span class="hs-identifier">hptAnns</span><span> </span><a name="local-6989586621684063231"><a href="#local-6989586621684063231"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#hptAllThings"><span class="hs-identifier hs-var">hptAllThings</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">md_anns</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">hm_details</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063231"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-673"></a><span>
</span><a name="line-674"></a><span class="hs-identifier">hptAllThings</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063170"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063170"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-675"></a><a name="hptAllThings"><a href="HscTypes.html#hptAllThings"><span class="hs-identifier">hptAllThings</span></a></a><span> </span><a name="local-6989586621684063232"><a href="#local-6989586621684063232"><span class="hs-identifier">extract</span></a></a><span> </span><a name="local-6989586621684063233"><a href="#local-6989586621684063233"><span class="hs-identifier">hsc_env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="#local-6989586621684063232"><span class="hs-identifier hs-var">extract</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#eltsHpt"><span class="hs-identifier hs-var">eltsHpt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_HPT</span><span> </span><a href="#local-6989586621684063233"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-676"></a><span>
</span><a name="line-677"></a><span class="hs-comment">-- | Get things from modules &quot;below&quot; this one (in the dependency sense)</span><span>
</span><a name="line-678"></a><span class="hs-comment">-- C.f Inst.hptInstances</span><span>
</span><a name="line-679"></a><span class="hs-identifier">hptSomeThingsBelowUs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063169"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063169"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-680"></a><a name="hptSomeThingsBelowUs"><a href="HscTypes.html#hptSomeThingsBelowUs"><span class="hs-identifier">hptSomeThingsBelowUs</span></a></a><span> </span><a name="local-6989586621684063234"><a href="#local-6989586621684063234"><span class="hs-identifier">extract</span></a></a><span> </span><a name="local-6989586621684063235"><a href="#local-6989586621684063235"><span class="hs-identifier">include_hi_boot</span></a></a><span> </span><a name="local-6989586621684063236"><a href="#local-6989586621684063236"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621684063237"><a href="#local-6989586621684063237"><span class="hs-identifier">deps</span></a></a><span>
</span><a name="line-681"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#isOneShot"><span class="hs-identifier hs-var">isOneShot</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ghcMode</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621684063236"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-684"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684063238"><a href="#local-6989586621684063238"><span class="hs-identifier">hpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_HPT</span><span> </span><a href="#local-6989586621684063236"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-685"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-686"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621684063244"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-687"></a><span>    </span><span class="hs-glyph">|</span><span>   </span><span class="hs-comment">-- Find each non-hi-boot module below me</span><span>
</span><a name="line-688"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621684063239"><a href="#local-6989586621684063239"><span class="hs-identifier">mod</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684063240"><a href="#local-6989586621684063240"><span class="hs-identifier">is_boot_mod</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063237"><span class="hs-identifier hs-var">deps</span></a><span>
</span><a name="line-689"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684063235"><span class="hs-identifier hs-var">include_hi_boot</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684063240"><span class="hs-identifier hs-var">is_boot_mod</span></a><span>
</span><a name="line-690"></a><span>
</span><a name="line-691"></a><span>        </span><span class="hs-comment">-- unsavoury: when compiling the base package with --make, we</span><span>
</span><a name="line-692"></a><span>        </span><span class="hs-comment">-- sometimes try to look up RULES etc for GHC.Prim. GHC.Prim won't</span><span>
</span><a name="line-693"></a><span>        </span><span class="hs-comment">-- be in the HPT, because we never compile it; it's in the EPT</span><span>
</span><a name="line-694"></a><span>        </span><span class="hs-comment">-- instead. ToDo: clean up, and remove this slightly bogus filter:</span><span>
</span><a name="line-695"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684063239"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><a href="PrelNames.html#gHC_PRIM"><span class="hs-identifier hs-var">gHC_PRIM</span></a><span>
</span><a name="line-696"></a><span>
</span><a name="line-697"></a><span>        </span><span class="hs-comment">-- Look it up in the HPT</span><span>
</span><a name="line-698"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684063241"><a href="#local-6989586621684063241"><span class="hs-identifier">things</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="HscTypes.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a><span> </span><a href="#local-6989586621684063238"><span class="hs-identifier hs-var">hpt</span></a><span> </span><a href="#local-6989586621684063239"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-699"></a><span>                    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063243"><a href="#local-6989586621684063243"><span class="hs-identifier">info</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063234"><span class="hs-identifier hs-var">extract</span></a><span> </span><a href="#local-6989586621684063243"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-700"></a><span>                    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#pprTrace"><span class="hs-identifier hs-var">pprTrace</span></a><span> </span><span class="hs-string">&quot;WARNING in hptSomeThingsBelowUs&quot;</span><span> </span><a href="#local-6989586621684063242"><span class="hs-identifier hs-var">msg</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-701"></a><span>          </span><a name="local-6989586621684063242"><a href="#local-6989586621684063242"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;missing module&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063239"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span>
</span><a name="line-702"></a><span>                      </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;Probable cause: out-of-date interface files&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-703"></a><span>                        </span><span class="hs-comment">-- This really shouldn't happen, but see Trac #962</span><span>
</span><a name="line-704"></a><span>
</span><a name="line-705"></a><span>        </span><span class="hs-comment">-- And get its dfuns</span><span>
</span><a name="line-706"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="local-6989586621684063244"><a href="#local-6989586621684063244"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063241"><span class="hs-identifier hs-var">things</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-707"></a><span>
</span><a name="line-708"></a><span>
</span><a name="line-709"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Metaprogramming}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-716"></a><span>
</span><a name="line-717"></a><span class="hs-comment">-- | The supported metaprogramming result types</span><span>
</span><a name="line-718"></a><span class="hs-keyword">data</span><span> </span><a name="MetaRequest"><a href="HscTypes.html#MetaRequest"><span class="hs-identifier">MetaRequest</span></a></a><span>
</span><a name="line-719"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="MetaE"><a href="HscTypes.html#MetaE"><span class="hs-identifier">MetaE</span></a></a><span>  </span><span class="hs-special">(</span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#MetaResult"><span class="hs-identifier hs-type">MetaResult</span></a><span class="hs-special">)</span><span>
</span><a name="line-720"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MetaP"><a href="HscTypes.html#MetaP"><span class="hs-identifier">MetaP</span></a></a><span>  </span><span class="hs-special">(</span><a href="HsPat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#MetaResult"><span class="hs-identifier hs-type">MetaResult</span></a><span class="hs-special">)</span><span>
</span><a name="line-721"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MetaT"><a href="HscTypes.html#MetaT"><span class="hs-identifier">MetaT</span></a></a><span>  </span><span class="hs-special">(</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#MetaResult"><span class="hs-identifier hs-type">MetaResult</span></a><span class="hs-special">)</span><span>
</span><a name="line-722"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MetaD"><a href="HscTypes.html#MetaD"><span class="hs-identifier">MetaD</span></a></a><span>  </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#MetaResult"><span class="hs-identifier hs-type">MetaResult</span></a><span class="hs-special">)</span><span>
</span><a name="line-723"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MetaAW"><a href="HscTypes.html#MetaAW"><span class="hs-identifier">MetaAW</span></a></a><span> </span><span class="hs-special">(</span><a href="GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#MetaResult"><span class="hs-identifier hs-type">MetaResult</span></a><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>
</span><a name="line-725"></a><span class="hs-comment">-- | data constructors not exported to ensure correct result type</span><span>
</span><a name="line-726"></a><span class="hs-keyword">data</span><span> </span><a name="MetaResult"><a href="HscTypes.html#MetaResult"><span class="hs-identifier">MetaResult</span></a></a><span>
</span><a name="line-727"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="MetaResE"><a href="HscTypes.html#MetaResE"><span class="hs-identifier">MetaResE</span></a></a><span>  </span><span class="hs-special">{</span><span> </span><a name="unMetaResE"><a href="HscTypes.html#unMetaResE"><span class="hs-identifier">unMetaResE</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span>   </span><span class="hs-special">}</span><span>
</span><a name="line-728"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MetaResP"><a href="HscTypes.html#MetaResP"><span class="hs-identifier">MetaResP</span></a></a><span>  </span><span class="hs-special">{</span><span> </span><a name="unMetaResP"><a href="HscTypes.html#unMetaResP"><span class="hs-identifier">unMetaResP</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="HsPat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-729"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MetaResT"><a href="HscTypes.html#MetaResT"><span class="hs-identifier">MetaResT</span></a></a><span>  </span><span class="hs-special">{</span><span> </span><a name="unMetaResT"><a href="HscTypes.html#unMetaResT"><span class="hs-identifier">unMetaResT</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span>   </span><span class="hs-special">}</span><span>
</span><a name="line-730"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MetaResD"><a href="HscTypes.html#MetaResD"><span class="hs-identifier">MetaResD</span></a></a><span>  </span><span class="hs-special">{</span><span> </span><a name="unMetaResD"><a href="HscTypes.html#unMetaResD"><span class="hs-identifier">unMetaResD</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-731"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MetaResAW"><a href="HscTypes.html#MetaResAW"><span class="hs-identifier">MetaResAW</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unMetaResAW"><a href="HscTypes.html#unMetaResAW"><span class="hs-identifier">unMetaResAW</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-732"></a><span>
</span><a name="line-733"></a><span class="hs-keyword">type</span><span> </span><a name="MetaHook"><a href="HscTypes.html#MetaHook"><span class="hs-identifier">MetaHook</span></a></a><span> </span><a name="local-6989586621684062712"><a href="#local-6989586621684062712"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#MetaRequest"><span class="hs-identifier hs-type">MetaRequest</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684062712"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="HscTypes.html#MetaResult"><span class="hs-identifier hs-type">MetaResult</span></a><span>
</span><a name="line-734"></a><span>
</span><a name="line-735"></a><span class="hs-identifier">metaRequestE</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621684063168"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HscTypes.html#MetaHook"><span class="hs-identifier hs-type">MetaHook</span></a><span> </span><a href="#local-6989586621684063168"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063168"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span class="hs-special">)</span><span>
</span><a name="line-736"></a><a name="metaRequestE"><a href="HscTypes.html#metaRequestE"><span class="hs-identifier">metaRequestE</span></a></a><span> </span><a name="local-6989586621684063245"><a href="#local-6989586621684063245"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">unMetaResE</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621684063245"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#MetaE"><span class="hs-identifier hs-var">MetaE</span></a><span> </span><a href="HscTypes.html#MetaResE"><span class="hs-identifier hs-var">MetaResE</span></a><span class="hs-special">)</span><span>
</span><a name="line-737"></a><span>
</span><a name="line-738"></a><span class="hs-identifier">metaRequestP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621684063167"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HscTypes.html#MetaHook"><span class="hs-identifier hs-type">MetaHook</span></a><span> </span><a href="#local-6989586621684063167"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063167"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="HsPat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span class="hs-special">)</span><span>
</span><a name="line-739"></a><a name="metaRequestP"><a href="HscTypes.html#metaRequestP"><span class="hs-identifier">metaRequestP</span></a></a><span> </span><a name="local-6989586621684063246"><a href="#local-6989586621684063246"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">unMetaResP</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621684063246"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#MetaP"><span class="hs-identifier hs-var">MetaP</span></a><span> </span><a href="HscTypes.html#MetaResP"><span class="hs-identifier hs-var">MetaResP</span></a><span class="hs-special">)</span><span>
</span><a name="line-740"></a><span>
</span><a name="line-741"></a><span class="hs-identifier">metaRequestT</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621684063166"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HscTypes.html#MetaHook"><span class="hs-identifier hs-type">MetaHook</span></a><span> </span><a href="#local-6989586621684063166"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063166"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="HsTypes.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span class="hs-special">)</span><span>
</span><a name="line-742"></a><a name="metaRequestT"><a href="HscTypes.html#metaRequestT"><span class="hs-identifier">metaRequestT</span></a></a><span> </span><a name="local-6989586621684063247"><a href="#local-6989586621684063247"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">unMetaResT</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621684063247"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#MetaT"><span class="hs-identifier hs-var">MetaT</span></a><span> </span><a href="HscTypes.html#MetaResT"><span class="hs-identifier hs-var">MetaResT</span></a><span class="hs-special">)</span><span>
</span><a name="line-743"></a><span>
</span><a name="line-744"></a><span class="hs-identifier">metaRequestD</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621684063165"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HscTypes.html#MetaHook"><span class="hs-identifier hs-type">MetaHook</span></a><span> </span><a href="#local-6989586621684063165"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063165"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">[</span><a href="HsDecls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span class="hs-special">]</span><span>
</span><a name="line-745"></a><a name="metaRequestD"><a href="HscTypes.html#metaRequestD"><span class="hs-identifier">metaRequestD</span></a></a><span> </span><a name="local-6989586621684063248"><a href="#local-6989586621684063248"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">unMetaResD</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621684063248"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#MetaD"><span class="hs-identifier hs-var">MetaD</span></a><span> </span><a href="HscTypes.html#MetaResD"><span class="hs-identifier hs-var">MetaResD</span></a><span class="hs-special">)</span><span>
</span><a name="line-746"></a><span>
</span><a name="line-747"></a><span class="hs-identifier">metaRequestAW</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621684063164"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HscTypes.html#MetaHook"><span class="hs-identifier hs-type">MetaHook</span></a><span> </span><a href="#local-6989586621684063164"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HsExpr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a><span> </span><a href="HsExtension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063164"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a><span>
</span><a name="line-748"></a><a name="metaRequestAW"><a href="HscTypes.html#metaRequestAW"><span class="hs-identifier">metaRequestAW</span></a></a><span> </span><a name="local-6989586621684063249"><a href="#local-6989586621684063249"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">unMetaResAW</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621684063249"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#MetaAW"><span class="hs-identifier hs-var">MetaAW</span></a><span> </span><a href="HscTypes.html#MetaResAW"><span class="hs-identifier hs-var">MetaResAW</span></a><span class="hs-special">)</span><span>
</span><a name="line-749"></a><span>
</span><a name="line-750"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Dealing with Annotations}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-757"></a><span>
</span><a name="line-758"></a><span class="hs-comment">-- | Deal with gathering annotations in from all possible places</span><span>
</span><a name="line-759"></a><span class="hs-comment">--   and combining them into a single 'AnnEnv'</span><span>
</span><a name="line-760"></a><span class="hs-identifier">prepareAnnotations</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HscTypes.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Annotations.html#AnnEnv"><span class="hs-identifier hs-type">AnnEnv</span></a><span>
</span><a name="line-761"></a><a name="prepareAnnotations"><a href="HscTypes.html#prepareAnnotations"><span class="hs-identifier">prepareAnnotations</span></a></a><span> </span><a name="local-6989586621684063250"><a href="#local-6989586621684063250"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621684063251"><a href="#local-6989586621684063251"><span class="hs-identifier">mb_guts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-762"></a><span>    </span><a name="local-6989586621684063252"><a href="#local-6989586621684063252"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a><span> </span><a href="#local-6989586621684063250"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-763"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Extract annotations from the module being compiled if supplied one</span><span>
</span><a name="line-764"></a><span>        </span><a name="local-6989586621684063253"><a href="#local-6989586621684063253"><span class="hs-identifier">mb_this_module_anns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="Annotations.html#mkAnnEnv"><span class="hs-identifier hs-var">mkAnnEnv</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">mg_anns</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063251"><span class="hs-identifier hs-var">mb_guts</span></a><span>
</span><a name="line-765"></a><span>        </span><span class="hs-comment">-- Extract dependencies of the module if we are supplied one,</span><span>
</span><a name="line-766"></a><span>        </span><span class="hs-comment">-- otherwise load annotations from all home package table</span><span>
</span><a name="line-767"></a><span>        </span><span class="hs-comment">-- entries regardless of dependency ordering.</span><span>
</span><a name="line-768"></a><span>        </span><a name="local-6989586621684063254"><a href="#local-6989586621684063254"><span class="hs-identifier">home_pkg_anns</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Annotations.html#mkAnnEnv"><span class="hs-identifier hs-var">mkAnnEnv</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HscTypes.html#hptAnns"><span class="hs-identifier hs-var">hptAnns</span></a><span> </span><a href="#local-6989586621684063250"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_mods</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">mg_deps</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063251"><span class="hs-identifier hs-var">mb_guts</span></a><span>
</span><a name="line-769"></a><span>        </span><a name="local-6989586621684063255"><a href="#local-6989586621684063255"><span class="hs-identifier">other_pkg_anns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">eps_ann_env</span><span> </span><a href="#local-6989586621684063252"><span class="hs-identifier hs-var">eps</span></a><span>
</span><a name="line-770"></a><span>        </span><a name="local-6989586621684063256"><a href="#local-6989586621684063256"><span class="hs-identifier">ann_env</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl1'</span><span> </span><a href="Annotations.html#plusAnnEnv"><span class="hs-identifier hs-var">plusAnnEnv</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063253"><span class="hs-identifier hs-var">mb_this_module_anns</span></a><span class="hs-special">,</span><span>
</span><a name="line-771"></a><span>                                                         </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684063254"><span class="hs-identifier hs-var">home_pkg_anns</span></a><span class="hs-special">,</span><span>
</span><a name="line-772"></a><span>                                                         </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684063255"><span class="hs-identifier hs-var">other_pkg_anns</span></a><span class="hs-special">]</span><span>
</span><a name="line-773"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684063256"><span class="hs-identifier hs-var">ann_env</span></a><span>
</span><a name="line-774"></a><span>
</span><a name="line-775"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{The Finder cache}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-782"></a><span>
</span><a name="line-783"></a><span class="hs-comment">-- | The 'FinderCache' maps modules to the result of</span><span>
</span><a name="line-784"></a><span class="hs-comment">-- searching for that module. It records the results of searching for</span><span>
</span><a name="line-785"></a><span class="hs-comment">-- modules along the search path. On @:load@, we flush the entire</span><span>
</span><a name="line-786"></a><span class="hs-comment">-- contents of this cache.</span><span>
</span><a name="line-787"></a><span class="hs-comment">--</span><span>
</span><a name="line-788"></a><span class="hs-keyword">type</span><span> </span><a name="FinderCache"><a href="HscTypes.html#FinderCache"><span class="hs-identifier">FinderCache</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span> </span><a href="HscTypes.html#InstalledFindResult"><span class="hs-identifier hs-type">InstalledFindResult</span></a><span>
</span><a name="line-789"></a><span>
</span><a name="line-790"></a><span class="hs-keyword">data</span><span> </span><a name="InstalledFindResult"><a href="HscTypes.html#InstalledFindResult"><span class="hs-identifier">InstalledFindResult</span></a></a><span>
</span><a name="line-791"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="InstalledFound"><a href="HscTypes.html#InstalledFound"><span class="hs-identifier">InstalledFound</span></a></a><span> </span><a href="Module.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a><span> </span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span>
</span><a name="line-792"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InstalledNoPackage"><a href="HscTypes.html#InstalledNoPackage"><span class="hs-identifier">InstalledNoPackage</span></a></a><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span>
</span><a name="line-793"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="InstalledNotFound"><a href="HscTypes.html#InstalledNotFound"><span class="hs-identifier">InstalledNotFound</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span class="hs-special">)</span><span>
</span><a name="line-794"></a><span>
</span><a name="line-795"></a><span class="hs-comment">-- | The result of searching for an imported module.</span><span>
</span><a name="line-796"></a><span class="hs-comment">--</span><span>
</span><a name="line-797"></a><span class="hs-comment">-- NB: FindResult manages both user source-import lookups</span><span>
</span><a name="line-798"></a><span class="hs-comment">-- (which can result in 'Module') as well as direct imports</span><span>
</span><a name="line-799"></a><span class="hs-comment">-- for interfaces (which always result in 'InstalledModule').</span><span>
</span><a name="line-800"></a><span class="hs-keyword">data</span><span> </span><a name="FindResult"><a href="HscTypes.html#FindResult"><span class="hs-identifier">FindResult</span></a></a><span>
</span><a name="line-801"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Found"><a href="HscTypes.html#Found"><span class="hs-identifier">Found</span></a></a><span> </span><a href="Module.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-802"></a><span>        </span><span class="hs-comment">-- ^ The module was found</span><span>
</span><a name="line-803"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="NoPackage"><a href="HscTypes.html#NoPackage"><span class="hs-identifier">NoPackage</span></a></a><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>
</span><a name="line-804"></a><span>        </span><span class="hs-comment">-- ^ The requested package was not found</span><span>
</span><a name="line-805"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FoundMultiple"><a href="HscTypes.html#FoundMultiple"><span class="hs-identifier">FoundMultiple</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#ModuleOrigin"><span class="hs-identifier hs-type">ModuleOrigin</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-806"></a><span>        </span><span class="hs-comment">-- ^ _Error_: both in multiple packages</span><span>
</span><a name="line-807"></a><span>
</span><a name="line-808"></a><span>        </span><span class="hs-comment">-- | Not found</span><span>
</span><a name="line-809"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="NotFound"><a href="HscTypes.html#NotFound"><span class="hs-identifier">NotFound</span></a></a><span>
</span><a name="line-810"></a><span>      </span><span class="hs-special">{</span><span> </span><a name="fr_paths"><a href="HscTypes.html#fr_paths"><span class="hs-identifier">fr_paths</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Places where I looked</span><span>
</span><a name="line-811"></a><span>
</span><a name="line-812"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="fr_pkg"><a href="HscTypes.html#fr_pkg"><span class="hs-identifier">fr_pkg</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span>  </span><span class="hs-comment">-- Just p =&gt; module is in this package's</span><span>
</span><a name="line-813"></a><span>                                           </span><span class="hs-comment">--           manifest, but couldn't find</span><span>
</span><a name="line-814"></a><span>                                           </span><span class="hs-comment">--           the .hi file</span><span>
</span><a name="line-815"></a><span>
</span><a name="line-816"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="fr_mods_hidden"><a href="HscTypes.html#fr_mods_hidden"><span class="hs-identifier">fr_mods_hidden</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- Module is in these packages,</span><span>
</span><a name="line-817"></a><span>                                           </span><span class="hs-comment">--   but the *module* is hidden</span><span>
</span><a name="line-818"></a><span>
</span><a name="line-819"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="fr_pkgs_hidden"><a href="HscTypes.html#fr_pkgs_hidden"><span class="hs-identifier">fr_pkgs_hidden</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- Module is in these packages,</span><span>
</span><a name="line-820"></a><span>                                           </span><span class="hs-comment">--   but the *package* is hidden</span><span>
</span><a name="line-821"></a><span>
</span><a name="line-822"></a><span>        </span><span class="hs-comment">-- Modules are in these packages, but it is unusable</span><span>
</span><a name="line-823"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="fr_unusables"><a href="HscTypes.html#fr_unusables"><span class="hs-identifier">fr_unusables</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a><span class="hs-special">,</span><span> </span><a href="Packages.html#UnusablePackageReason"><span class="hs-identifier hs-type">UnusablePackageReason</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-824"></a><span>
</span><a name="line-825"></a><span>      </span><span class="hs-special">,</span><span> </span><a name="fr_suggestions"><a href="HscTypes.html#fr_suggestions"><span class="hs-identifier">fr_suggestions</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Packages.html#ModuleSuggestion"><span class="hs-identifier hs-type">ModuleSuggestion</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Possible mis-spelled modules</span><span>
</span><a name="line-826"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-827"></a><span>
</span><a name="line-828"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Symbol tables and Module details}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-835"></a><span>
</span><a name="line-836"></a><span class="hs-comment">-- | A 'ModIface' plus a 'ModDetails' summarises everything we know</span><span>
</span><a name="line-837"></a><span class="hs-comment">-- about a compiled module.  The 'ModIface' is the stuff *before* linking,</span><span>
</span><a name="line-838"></a><span class="hs-comment">-- and can be written out to an interface file. The 'ModDetails is after</span><span>
</span><a name="line-839"></a><span class="hs-comment">-- linking and can be completely recovered from just the 'ModIface'.</span><span>
</span><a name="line-840"></a><span class="hs-comment">--</span><span>
</span><a name="line-841"></a><span class="hs-comment">-- When we read an interface file, we also construct a 'ModIface' from it,</span><span>
</span><a name="line-842"></a><span class="hs-comment">-- except that we explicitly make the 'mi_decls' and a few other fields empty;</span><span>
</span><a name="line-843"></a><span class="hs-comment">-- as when reading we consolidate the declarations etc. into a number of indexed</span><span>
</span><a name="line-844"></a><span class="hs-comment">-- maps and environments in the 'ExternalPackageState'.</span><span>
</span><a name="line-845"></a><span class="hs-keyword">data</span><span> </span><a name="ModIface"><a href="HscTypes.html#ModIface"><span class="hs-identifier">ModIface</span></a></a><span>
</span><a name="line-846"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ModIface"><a href="HscTypes.html#ModIface"><span class="hs-identifier">ModIface</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-847"></a><span>        </span><a name="mi_module"><a href="HscTypes.html#mi_module"><span class="hs-identifier">mi_module</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>             </span><span class="hs-comment">-- ^ Name of the module we are for</span><span>
</span><a name="line-848"></a><span>        </span><a name="mi_sig_of"><a href="HscTypes.html#mi_sig_of"><span class="hs-identifier">mi_sig_of</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ Are we a sig of another mod?</span><span>
</span><a name="line-849"></a><span>        </span><a name="mi_iface_hash"><a href="HscTypes.html#mi_iface_hash"><span class="hs-identifier">mi_iface_hash</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- ^ Hash of the whole interface</span><span>
</span><a name="line-850"></a><span>        </span><a name="mi_mod_hash"><a href="HscTypes.html#mi_mod_hash"><span class="hs-identifier">mi_mod_hash</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- ^ Hash of the ABI only</span><span>
</span><a name="line-851"></a><span>        </span><a name="mi_flag_hash"><a href="HscTypes.html#mi_flag_hash"><span class="hs-identifier">mi_flag_hash</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- ^ Hash of the important flags</span><span>
</span><a name="line-852"></a><span>                                              </span><span class="hs-comment">-- used when compiling the module,</span><span>
</span><a name="line-853"></a><span>                                              </span><span class="hs-comment">-- excluding optimisation flags</span><span>
</span><a name="line-854"></a><span>        </span><a name="mi_opt_hash"><a href="HscTypes.html#mi_opt_hash"><span class="hs-identifier">mi_opt_hash</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- ^ Hash of optimisation flags</span><span>
</span><a name="line-855"></a><span>        </span><a name="mi_hpc_hash"><a href="HscTypes.html#mi_hpc_hash"><span class="hs-identifier">mi_hpc_hash</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- ^ Hash of hpc flags</span><span>
</span><a name="line-856"></a><span>        </span><a name="mi_plugin_hash"><a href="HscTypes.html#mi_plugin_hash"><span class="hs-identifier">mi_plugin_hash</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ Hash of plugins</span><span>
</span><a name="line-857"></a><span>
</span><a name="line-858"></a><span>        </span><a name="mi_orphan"><a href="HscTypes.html#mi_orphan"><span class="hs-identifier">mi_orphan</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#WhetherHasOrphans"><span class="hs-identifier hs-type">WhetherHasOrphans</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^ Whether this module has orphans</span><span>
</span><a name="line-859"></a><span>        </span><a name="mi_finsts"><a href="HscTypes.html#mi_finsts"><span class="hs-identifier">mi_finsts</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#WhetherHasFamInst"><span class="hs-identifier hs-type">WhetherHasFamInst</span></a><span class="hs-special">,</span><span>
</span><a name="line-860"></a><span>                </span><span class="hs-comment">-- ^ Whether this module has family instances.</span><span>
</span><a name="line-861"></a><span>                </span><span class="hs-comment">-- See Note [The type family instance consistency story].</span><span>
</span><a name="line-862"></a><span>        </span><a name="mi_hsc_src"><a href="HscTypes.html#mi_hsc_src"><span class="hs-identifier">mi_hsc_src</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- ^ Boot? Signature?</span><span>
</span><a name="line-863"></a><span>
</span><a name="line-864"></a><span>        </span><a name="mi_deps"><a href="HscTypes.html#mi_deps"><span class="hs-identifier">mi_deps</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a><span class="hs-special">,</span><span>
</span><a name="line-865"></a><span>                </span><span class="hs-comment">-- ^ The dependencies of the module.  This is</span><span>
</span><a name="line-866"></a><span>                </span><span class="hs-comment">-- consulted for directly-imported modules, but not</span><span>
</span><a name="line-867"></a><span>                </span><span class="hs-comment">-- for anything else (hence lazy)</span><span>
</span><a name="line-868"></a><span>
</span><a name="line-869"></a><span>        </span><a name="mi_usages"><a href="HscTypes.html#mi_usages"><span class="hs-identifier">mi_usages</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#Usage"><span class="hs-identifier hs-type">Usage</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-870"></a><span>                </span><span class="hs-comment">-- ^ Usages; kept sorted so that it's easy to decide</span><span>
</span><a name="line-871"></a><span>                </span><span class="hs-comment">-- whether to write a new iface file (changing usages</span><span>
</span><a name="line-872"></a><span>                </span><span class="hs-comment">-- doesn't affect the hash of this module)</span><span>
</span><a name="line-873"></a><span>                </span><span class="hs-comment">-- NOT STRICT!  we read this field lazily from the interface file</span><span>
</span><a name="line-874"></a><span>                </span><span class="hs-comment">-- It is *only* consulted by the recompilation checker</span><span>
</span><a name="line-875"></a><span>
</span><a name="line-876"></a><span>        </span><a name="mi_exports"><a href="HscTypes.html#mi_exports"><span class="hs-identifier">mi_exports</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="HscTypes.html#IfaceExport"><span class="hs-identifier hs-type">IfaceExport</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-877"></a><span>                </span><span class="hs-comment">-- ^ Exports</span><span>
</span><a name="line-878"></a><span>                </span><span class="hs-comment">-- Kept sorted by (mod,occ), to make version comparisons easier</span><span>
</span><a name="line-879"></a><span>                </span><span class="hs-comment">-- Records the modules that are the declaration points for things</span><span>
</span><a name="line-880"></a><span>                </span><span class="hs-comment">-- exported by this module, and the 'OccName's of those things</span><span>
</span><a name="line-881"></a><span>
</span><a name="line-882"></a><span>        </span><a name="mi_exp_hash"><a href="HscTypes.html#mi_exp_hash"><span class="hs-identifier">mi_exp_hash</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>
</span><a name="line-883"></a><span>                </span><span class="hs-comment">-- ^ Hash of export list</span><span>
</span><a name="line-884"></a><span>
</span><a name="line-885"></a><span>        </span><a name="mi_used_th"><a href="HscTypes.html#mi_used_th"><span class="hs-identifier">mi_used_th</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>
</span><a name="line-886"></a><span>                </span><span class="hs-comment">-- ^ Module required TH splices when it was compiled.</span><span>
</span><a name="line-887"></a><span>                </span><span class="hs-comment">-- This disables recompilation avoidance (see #481).</span><span>
</span><a name="line-888"></a><span>
</span><a name="line-889"></a><span>        </span><a name="mi_fixities"><a href="HscTypes.html#mi_fixities"><span class="hs-identifier">mi_fixities</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-890"></a><span>                </span><span class="hs-comment">-- ^ Fixities</span><span>
</span><a name="line-891"></a><span>                </span><span class="hs-comment">-- NOT STRICT!  we read this field lazily from the interface file</span><span>
</span><a name="line-892"></a><span>
</span><a name="line-893"></a><span>        </span><a name="mi_warns"><a href="HscTypes.html#mi_warns"><span class="hs-identifier">mi_warns</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span class="hs-special">,</span><span>
</span><a name="line-894"></a><span>                </span><span class="hs-comment">-- ^ Warnings</span><span>
</span><a name="line-895"></a><span>                </span><span class="hs-comment">-- NOT STRICT!  we read this field lazily from the interface file</span><span>
</span><a name="line-896"></a><span>
</span><a name="line-897"></a><span>        </span><a name="mi_anns"><a href="HscTypes.html#mi_anns"><span class="hs-identifier">mi_anns</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceAnnotation"><span class="hs-identifier hs-type">IfaceAnnotation</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-898"></a><span>                </span><span class="hs-comment">-- ^ Annotations</span><span>
</span><a name="line-899"></a><span>                </span><span class="hs-comment">-- NOT STRICT!  we read this field lazily from the interface file</span><span>
</span><a name="line-900"></a><span>
</span><a name="line-901"></a><span>
</span><a name="line-902"></a><span>        </span><a name="mi_decls"><a href="HscTypes.html#mi_decls"><span class="hs-identifier">mi_decls</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-903"></a><span>                </span><span class="hs-comment">-- ^ Type, class and variable declarations</span><span>
</span><a name="line-904"></a><span>                </span><span class="hs-comment">-- The hash of an Id changes if its fixity or deprecations change</span><span>
</span><a name="line-905"></a><span>                </span><span class="hs-comment">--      (as well as its type of course)</span><span>
</span><a name="line-906"></a><span>                </span><span class="hs-comment">-- Ditto data constructors, class operations, except that</span><span>
</span><a name="line-907"></a><span>                </span><span class="hs-comment">-- the hash of the parent class/tycon changes</span><span>
</span><a name="line-908"></a><span>
</span><a name="line-909"></a><span>        </span><a name="mi_globals"><a href="HscTypes.html#mi_globals"><span class="hs-identifier">mi_globals</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-910"></a><span>                </span><span class="hs-comment">-- ^ Binds all the things defined at the top level in</span><span>
</span><a name="line-911"></a><span>                </span><span class="hs-comment">-- the /original source/ code for this module. which</span><span>
</span><a name="line-912"></a><span>                </span><span class="hs-comment">-- is NOT the same as mi_exports, nor mi_decls (which</span><span>
</span><a name="line-913"></a><span>                </span><span class="hs-comment">-- may contains declarations for things not actually</span><span>
</span><a name="line-914"></a><span>                </span><span class="hs-comment">-- defined by the user).  Used for GHCi and for inspecting</span><span>
</span><a name="line-915"></a><span>                </span><span class="hs-comment">-- the contents of modules via the GHC API only.</span><span>
</span><a name="line-916"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-917"></a><span>                </span><span class="hs-comment">-- (We need the source file to figure out the</span><span>
</span><a name="line-918"></a><span>                </span><span class="hs-comment">-- top-level environment, if we didn't compile this module</span><span>
</span><a name="line-919"></a><span>                </span><span class="hs-comment">-- from source then this field contains @Nothing@).</span><span>
</span><a name="line-920"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-921"></a><span>                </span><span class="hs-comment">-- Strictly speaking this field should live in the</span><span>
</span><a name="line-922"></a><span>                </span><span class="hs-comment">-- 'HomeModInfo', but that leads to more plumbing.</span><span>
</span><a name="line-923"></a><span>
</span><a name="line-924"></a><span>                </span><span class="hs-comment">-- Instance declarations and rules</span><span>
</span><a name="line-925"></a><span>        </span><a name="mi_insts"><a href="HscTypes.html#mi_insts"><span class="hs-identifier">mi_insts</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceClsInst"><span class="hs-identifier hs-type">IfaceClsInst</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ Sorted class instance</span><span>
</span><a name="line-926"></a><span>        </span><a name="mi_fam_insts"><a href="HscTypes.html#mi_fam_insts"><span class="hs-identifier">mi_fam_insts</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceFamInst"><span class="hs-identifier hs-type">IfaceFamInst</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^ Sorted family instances</span><span>
</span><a name="line-927"></a><span>        </span><a name="mi_rules"><a href="HscTypes.html#mi_rules"><span class="hs-identifier">mi_rules</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceRule"><span class="hs-identifier hs-type">IfaceRule</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ Sorted rules</span><span>
</span><a name="line-928"></a><span>        </span><a name="mi_orphan_hash"><a href="HscTypes.html#mi_orphan_hash"><span class="hs-identifier">mi_orphan_hash</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- ^ Hash for orphan rules, class and family</span><span>
</span><a name="line-929"></a><span>                                           </span><span class="hs-comment">-- instances combined</span><span>
</span><a name="line-930"></a><span>
</span><a name="line-931"></a><span>                </span><span class="hs-comment">-- Cached environments for easy lookup</span><span>
</span><a name="line-932"></a><span>                </span><span class="hs-comment">-- These are computed (lazily) from other fields</span><span>
</span><a name="line-933"></a><span>                </span><span class="hs-comment">-- and are not put into the interface file</span><span>
</span><a name="line-934"></a><span>        </span><a name="mi_warn_fn"><a href="HscTypes.html#mi_warn_fn"><span class="hs-identifier">mi_warn_fn</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BasicTypes.html#WarningTxt"><span class="hs-identifier hs-type">WarningTxt</span></a><span class="hs-special">,</span><span>
</span><a name="line-935"></a><span>                </span><span class="hs-comment">-- ^ Cached lookup for 'mi_warns'</span><span>
</span><a name="line-936"></a><span>        </span><a name="mi_fix_fn"><a href="HscTypes.html#mi_fix_fn"><span class="hs-identifier">mi_fix_fn</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span class="hs-special">,</span><span>
</span><a name="line-937"></a><span>                </span><span class="hs-comment">-- ^ Cached lookup for 'mi_fixities'</span><span>
</span><a name="line-938"></a><span>        </span><a name="mi_hash_fn"><a href="HscTypes.html#mi_hash_fn"><span class="hs-identifier">mi_hash_fn</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-939"></a><span>                </span><span class="hs-comment">-- ^ Cached lookup for 'mi_decls'.</span><span>
</span><a name="line-940"></a><span>                </span><span class="hs-comment">-- The @Nothing@ in 'mi_hash_fn' means that the thing</span><span>
</span><a name="line-941"></a><span>                </span><span class="hs-comment">-- isn't in decls. It's useful to know that when</span><span>
</span><a name="line-942"></a><span>                </span><span class="hs-comment">-- seeing if we are up to date wrt. the old interface.</span><span>
</span><a name="line-943"></a><span>                </span><span class="hs-comment">-- The 'OccName' is the parent of the name, if it has one.</span><span>
</span><a name="line-944"></a><span>
</span><a name="line-945"></a><span>        </span><a name="mi_hpc"><a href="HscTypes.html#mi_hpc"><span class="hs-identifier">mi_hpc</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#AnyHpcUsage"><span class="hs-identifier hs-type">AnyHpcUsage</span></a><span class="hs-special">,</span><span>
</span><a name="line-946"></a><span>                </span><span class="hs-comment">-- ^ True if this program uses Hpc at any point in the program.</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span>        </span><a name="mi_trust"><a href="HscTypes.html#mi_trust"><span class="hs-identifier">mi_trust</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#IfaceTrustInfo"><span class="hs-identifier hs-type">IfaceTrustInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-949"></a><span>                </span><span class="hs-comment">-- ^ Safe Haskell Trust information for this module.</span><span>
</span><a name="line-950"></a><span>
</span><a name="line-951"></a><span>        </span><a name="mi_trust_pkg"><a href="HscTypes.html#mi_trust_pkg"><span class="hs-identifier">mi_trust_pkg</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>
</span><a name="line-952"></a><span>                </span><span class="hs-comment">-- ^ Do we require the package this module resides in be trusted</span><span>
</span><a name="line-953"></a><span>                </span><span class="hs-comment">-- to trust this module? This is used for the situation where a</span><span>
</span><a name="line-954"></a><span>                </span><span class="hs-comment">-- module is Safe (so doesn't require the package be trusted</span><span>
</span><a name="line-955"></a><span>                </span><span class="hs-comment">-- itself) but imports some trustworthy modules from its own</span><span>
</span><a name="line-956"></a><span>                </span><span class="hs-comment">-- package (which does require its own package be trusted).</span><span>
</span><a name="line-957"></a><span>                </span><span class="hs-comment">-- See Note [RnNames . Trust Own Package]</span><span>
</span><a name="line-958"></a><span>        </span><a name="mi_complete_sigs"><a href="HscTypes.html#mi_complete_sigs"><span class="hs-identifier">mi_complete_sigs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="IfaceSyn.html#IfaceCompleteMatch"><span class="hs-identifier hs-type">IfaceCompleteMatch</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-959"></a><span>
</span><a name="line-960"></a><span>        </span><a name="mi_doc_hdr"><a href="HscTypes.html#mi_doc_hdr"><span class="hs-identifier">mi_doc_hdr</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HsDoc.html#HsDocString"><span class="hs-identifier hs-type">HsDocString</span></a><span class="hs-special">,</span><span>
</span><a name="line-961"></a><span>                </span><span class="hs-comment">-- ^ Module header.</span><span>
</span><a name="line-962"></a><span>
</span><a name="line-963"></a><span>        </span><a name="mi_decl_docs"><a href="HscTypes.html#mi_decl_docs"><span class="hs-identifier">mi_decl_docs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDoc.html#DeclDocMap"><span class="hs-identifier hs-type">DeclDocMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-964"></a><span>                </span><span class="hs-comment">-- ^ Docs on declarations.</span><span>
</span><a name="line-965"></a><span>
</span><a name="line-966"></a><span>        </span><a name="mi_arg_docs"><a href="HscTypes.html#mi_arg_docs"><span class="hs-identifier">mi_arg_docs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HsDoc.html#ArgDocMap"><span class="hs-identifier hs-type">ArgDocMap</span></a><span>
</span><a name="line-967"></a><span>                </span><span class="hs-comment">-- ^ Docs on arguments.</span><span>
</span><a name="line-968"></a><span>     </span><span class="hs-special">}</span><span>
</span><a name="line-969"></a><span>
</span><a name="line-970"></a><span class="hs-comment">-- | Old-style accessor for whether or not the ModIface came from an hs-boot</span><span>
</span><a name="line-971"></a><span class="hs-comment">-- file.</span><span>
</span><a name="line-972"></a><span class="hs-identifier">mi_boot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-973"></a><a name="mi_boot"><a href="HscTypes.html#mi_boot"><span class="hs-identifier">mi_boot</span></a></a><span> </span><a name="local-6989586621684063257"><a href="#local-6989586621684063257"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mi_hsc_src</span><span> </span><a href="#local-6989586621684063257"><span class="hs-identifier hs-var">iface</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="DriverPhases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a><span>
</span><a name="line-974"></a><span>
</span><a name="line-975"></a><span class="hs-comment">-- | Lookups up a (possibly cached) fixity from a 'ModIface'. If one cannot be</span><span>
</span><a name="line-976"></a><span class="hs-comment">-- found, 'defaultFixity' is returned instead.</span><span>
</span><a name="line-977"></a><span class="hs-identifier">mi_fix</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span>
</span><a name="line-978"></a><a name="mi_fix"><a href="HscTypes.html#mi_fix"><span class="hs-identifier">mi_fix</span></a></a><span> </span><a name="local-6989586621684063258"><a href="#local-6989586621684063258"><span class="hs-identifier">iface</span></a></a><span> </span><a name="local-6989586621684063259"><a href="#local-6989586621684063259"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mi_fix_fn</span><span> </span><a href="#local-6989586621684063258"><span class="hs-identifier hs-var">iface</span></a><span> </span><a href="#local-6989586621684063259"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><a href="Maybes.html#orElse"><span class="hs-identifier hs-var">orElse</span></a><span class="hs-special">`</span><span> </span><a href="BasicTypes.html#defaultFixity"><span class="hs-identifier hs-var">defaultFixity</span></a><span>
</span><a name="line-979"></a><span>
</span><a name="line-980"></a><span class="hs-comment">-- | The semantic module for this interface; e.g., if it's a interface</span><span>
</span><a name="line-981"></a><span class="hs-comment">-- for a signature, if 'mi_module' is @p[A=&lt;A&gt;]:A@, 'mi_semantic_module'</span><span>
</span><a name="line-982"></a><span class="hs-comment">-- will be @&lt;A&gt;@.</span><span>
</span><a name="line-983"></a><span class="hs-identifier">mi_semantic_module</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-984"></a><a name="mi_semantic_module"><a href="HscTypes.html#mi_semantic_module"><span class="hs-identifier">mi_semantic_module</span></a></a><span> </span><a name="local-6989586621684063260"><a href="#local-6989586621684063260"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">mi_sig_of</span><span> </span><a href="#local-6989586621684063260"><span class="hs-identifier hs-var">iface</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-985"></a><span>                            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">mi_module</span><span> </span><a href="#local-6989586621684063260"><span class="hs-identifier hs-var">iface</span></a><span>
</span><a name="line-986"></a><span>                            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063261"><a href="#local-6989586621684063261"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063261"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-987"></a><span>
</span><a name="line-988"></a><span class="hs-comment">-- | The &quot;precise&quot; free holes, e.g., the signatures that this</span><span>
</span><a name="line-989"></a><span class="hs-comment">-- 'ModIface' depends on.</span><span>
</span><a name="line-990"></a><span class="hs-identifier">mi_free_holes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqDSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-991"></a><a name="mi_free_holes"><a href="HscTypes.html#mi_free_holes"><span class="hs-identifier">mi_free_holes</span></a></a><span> </span><a name="local-6989586621684063262"><a href="#local-6989586621684063262"><span class="hs-identifier">iface</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-992"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Module.html#splitModuleInsts"><span class="hs-identifier hs-var">splitModuleInsts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_module</span><span> </span><a href="#local-6989586621684063262"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-993"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063264"><a href="#local-6989586621684063264"><span class="hs-identifier">indef</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-994"></a><span>        </span><span class="hs-comment">-- A mini-hack: we rely on the fact that 'renameFreeHoles'</span><span>
</span><a name="line-995"></a><span>        </span><span class="hs-comment">-- drops things that aren't holes.</span><span>
</span><a name="line-996"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#renameFreeHoles"><span class="hs-identifier hs-var">renameFreeHoles</span></a><span> </span><span class="hs-special">(</span><a href="UniqDSet.html#mkUniqDSet"><span class="hs-identifier hs-var">mkUniqDSet</span></a><span> </span><a href="#local-6989586621684063263"><span class="hs-identifier hs-var">cands</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indefUnitIdInsts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">indefModuleUnitId</span><span> </span><a href="#local-6989586621684063264"><span class="hs-identifier hs-var">indef</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-997"></a><span>    </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqDSet.html#emptyUniqDSet"><span class="hs-identifier hs-var">emptyUniqDSet</span></a><span>
</span><a name="line-998"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-999"></a><span>    </span><a name="local-6989586621684063263"><a href="#local-6989586621684063263"><span class="hs-identifier">cands</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_mods</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mi_deps</span><span> </span><a href="#local-6989586621684063262"><span class="hs-identifier hs-var">iface</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1000"></a><span>
</span><a name="line-1001"></a><span class="hs-comment">-- | Given a set of free holes, and a unit identifier, rename</span><span>
</span><a name="line-1002"></a><span class="hs-comment">-- the free holes according to the instantiation of the unit</span><span>
</span><a name="line-1003"></a><span class="hs-comment">-- identifier.  For example, if we have A and B free, and</span><span>
</span><a name="line-1004"></a><span class="hs-comment">-- our unit identity is @p[A=&lt;C&gt;,B=impl:B]@, the renamed free</span><span>
</span><a name="line-1005"></a><span class="hs-comment">-- holes are just C.</span><span>
</span><a name="line-1006"></a><span class="hs-identifier">renameFreeHoles</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="UniqDSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="UniqDSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-1007"></a><a name="renameFreeHoles"><a href="HscTypes.html#renameFreeHoles"><span class="hs-identifier">renameFreeHoles</span></a></a><span> </span><a name="local-6989586621684063265"><a href="#local-6989586621684063265"><span class="hs-identifier">fhs</span></a></a><span> </span><a name="local-6989586621684063266"><a href="#local-6989586621684063266"><span class="hs-identifier">insts</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1008"></a><span>    </span><a href="UniqDSet.html#unionManyUniqDSets"><span class="hs-identifier hs-var">unionManyUniqDSets</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621684063268"><span class="hs-identifier hs-var">lookup_impl</span></a><span> </span><span class="hs-special">(</span><a href="UniqDSet.html#uniqDSetToList"><span class="hs-identifier hs-var">uniqDSetToList</span></a><span> </span><a href="#local-6989586621684063265"><span class="hs-identifier hs-var">fhs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1009"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1010"></a><span>    </span><a name="local-6989586621684063267"><a href="#local-6989586621684063267"><span class="hs-identifier">hmap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#listToUFM"><span class="hs-identifier hs-var">listToUFM</span></a><span> </span><a href="#local-6989586621684063266"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-1011"></a><span>    </span><a name="local-6989586621684063268"><a href="#local-6989586621684063268"><span class="hs-identifier">lookup_impl</span></a></a><span> </span><a name="local-6989586621684063269"><a href="#local-6989586621684063269"><span class="hs-identifier">mod_name</span></a></a><span>
</span><a name="line-1012"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063270"><a href="#local-6989586621684063270"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="UniqFM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a><span> </span><a href="#local-6989586621684063267"><span class="hs-identifier hs-var">hmap</span></a><span> </span><a href="#local-6989586621684063269"><span class="hs-identifier hs-var">mod_name</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#moduleFreeHoles"><span class="hs-identifier hs-var">moduleFreeHoles</span></a><span> </span><a href="#local-6989586621684063270"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-1013"></a><span>        </span><span class="hs-comment">-- It wasn't actually a hole</span><span>
</span><a name="line-1014"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                           </span><span class="hs-glyph">=</span><span> </span><a href="UniqDSet.html#emptyUniqDSet"><span class="hs-identifier hs-var">emptyUniqDSet</span></a><span>
</span><a name="line-1015"></a><span>
</span><a name="line-1016"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1017"></a><span>   </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621684063083"><a href="#local-6989586621684063083"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-var">ModIface</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1018"></a><span>                 </span><span class="hs-identifier">mi_module</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063084"><a href="#local-6989586621684063084"><span class="hs-identifier">mod</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1019"></a><span>                 </span><span class="hs-identifier">mi_sig_of</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063085"><a href="#local-6989586621684063085"><span class="hs-identifier">sig_of</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1020"></a><span>                 </span><span class="hs-identifier">mi_hsc_src</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063086"><a href="#local-6989586621684063086"><span class="hs-identifier">hsc_src</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1021"></a><span>                 </span><span class="hs-identifier">mi_iface_hash</span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063087"><a href="#local-6989586621684063087"><span class="hs-identifier">iface_hash</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1022"></a><span>                 </span><span class="hs-identifier">mi_mod_hash</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063088"><a href="#local-6989586621684063088"><span class="hs-identifier">mod_hash</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1023"></a><span>                 </span><span class="hs-identifier">mi_flag_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063089"><a href="#local-6989586621684063089"><span class="hs-identifier">flag_hash</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1024"></a><span>                 </span><span class="hs-identifier">mi_opt_hash</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063090"><a href="#local-6989586621684063090"><span class="hs-identifier">opt_hash</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1025"></a><span>                 </span><span class="hs-identifier">mi_hpc_hash</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063091"><a href="#local-6989586621684063091"><span class="hs-identifier">hpc_hash</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1026"></a><span>                 </span><span class="hs-identifier">mi_plugin_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063092"><a href="#local-6989586621684063092"><span class="hs-identifier">plugin_hash</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1027"></a><span>                 </span><span class="hs-identifier">mi_orphan</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063093"><a href="#local-6989586621684063093"><span class="hs-identifier">orphan</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1028"></a><span>                 </span><span class="hs-identifier">mi_finsts</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063094"><a href="#local-6989586621684063094"><span class="hs-identifier">hasFamInsts</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1029"></a><span>                 </span><span class="hs-identifier">mi_deps</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063095"><a href="#local-6989586621684063095"><span class="hs-identifier">deps</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1030"></a><span>                 </span><span class="hs-identifier">mi_usages</span><span>    </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063096"><a href="#local-6989586621684063096"><span class="hs-identifier">usages</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1031"></a><span>                 </span><span class="hs-identifier">mi_exports</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063097"><a href="#local-6989586621684063097"><span class="hs-identifier">exports</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1032"></a><span>                 </span><span class="hs-identifier">mi_exp_hash</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063098"><a href="#local-6989586621684063098"><span class="hs-identifier">exp_hash</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1033"></a><span>                 </span><span class="hs-identifier">mi_used_th</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063099"><a href="#local-6989586621684063099"><span class="hs-identifier">used_th</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1034"></a><span>                 </span><span class="hs-identifier">mi_fixities</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063100"><a href="#local-6989586621684063100"><span class="hs-identifier">fixities</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1035"></a><span>                 </span><span class="hs-identifier">mi_warns</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063101"><a href="#local-6989586621684063101"><span class="hs-identifier">warns</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1036"></a><span>                 </span><span class="hs-identifier">mi_anns</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063102"><a href="#local-6989586621684063102"><span class="hs-identifier">anns</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1037"></a><span>                 </span><span class="hs-identifier">mi_decls</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063103"><a href="#local-6989586621684063103"><span class="hs-identifier">decls</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1038"></a><span>                 </span><span class="hs-identifier">mi_insts</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063104"><a href="#local-6989586621684063104"><span class="hs-identifier">insts</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1039"></a><span>                 </span><span class="hs-identifier">mi_fam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063105"><a href="#local-6989586621684063105"><span class="hs-identifier">fam_insts</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1040"></a><span>                 </span><span class="hs-identifier">mi_rules</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063106"><a href="#local-6989586621684063106"><span class="hs-identifier">rules</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1041"></a><span>                 </span><span class="hs-identifier">mi_orphan_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063107"><a href="#local-6989586621684063107"><span class="hs-identifier">orphan_hash</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1042"></a><span>                 </span><span class="hs-identifier">mi_hpc</span><span>       </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063108"><a href="#local-6989586621684063108"><span class="hs-identifier">hpc_info</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1043"></a><span>                 </span><span class="hs-identifier">mi_trust</span><span>     </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063109"><a href="#local-6989586621684063109"><span class="hs-identifier">trust</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1044"></a><span>                 </span><span class="hs-identifier">mi_trust_pkg</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063110"><a href="#local-6989586621684063110"><span class="hs-identifier">trust_pkg</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1045"></a><span>                 </span><span class="hs-identifier">mi_complete_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063111"><a href="#local-6989586621684063111"><span class="hs-identifier">complete_sigs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1046"></a><span>                 </span><span class="hs-identifier">mi_doc_hdr</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063112"><a href="#local-6989586621684063112"><span class="hs-identifier">doc_hdr</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1047"></a><span>                 </span><span class="hs-identifier">mi_decl_docs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063113"><a href="#local-6989586621684063113"><span class="hs-identifier">decl_docs</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1048"></a><span>                 </span><span class="hs-identifier">mi_arg_docs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063114"><a href="#local-6989586621684063114"><span class="hs-identifier">arg_docs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1049"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063084"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-1050"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063085"><span class="hs-identifier hs-var">sig_of</span></a><span>
</span><a name="line-1051"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063086"><span class="hs-identifier hs-var">hsc_src</span></a><span>
</span><a name="line-1052"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063087"><span class="hs-identifier hs-var">iface_hash</span></a><span>
</span><a name="line-1053"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063088"><span class="hs-identifier hs-var">mod_hash</span></a><span>
</span><a name="line-1054"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063089"><span class="hs-identifier hs-var">flag_hash</span></a><span>
</span><a name="line-1055"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063090"><span class="hs-identifier hs-var">opt_hash</span></a><span>
</span><a name="line-1056"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063091"><span class="hs-identifier hs-var">hpc_hash</span></a><span>
</span><a name="line-1057"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063092"><span class="hs-identifier hs-var">plugin_hash</span></a><span>
</span><a name="line-1058"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063093"><span class="hs-identifier hs-var">orphan</span></a><span>
</span><a name="line-1059"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063094"><span class="hs-identifier hs-var">hasFamInsts</span></a><span>
</span><a name="line-1060"></a><span>        </span><a href="Binary.html#lazyPut"><span class="hs-identifier hs-var">lazyPut</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063095"><span class="hs-identifier hs-var">deps</span></a><span>
</span><a name="line-1061"></a><span>        </span><a href="Binary.html#lazyPut"><span class="hs-identifier hs-var">lazyPut</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063096"><span class="hs-identifier hs-var">usages</span></a><span>
</span><a name="line-1062"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063097"><span class="hs-identifier hs-var">exports</span></a><span>
</span><a name="line-1063"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063098"><span class="hs-identifier hs-var">exp_hash</span></a><span>
</span><a name="line-1064"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063099"><span class="hs-identifier hs-var">used_th</span></a><span>
</span><a name="line-1065"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063100"><span class="hs-identifier hs-var">fixities</span></a><span>
</span><a name="line-1066"></a><span>        </span><a href="Binary.html#lazyPut"><span class="hs-identifier hs-var">lazyPut</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063101"><span class="hs-identifier hs-var">warns</span></a><span>
</span><a name="line-1067"></a><span>        </span><a href="Binary.html#lazyPut"><span class="hs-identifier hs-var">lazyPut</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063102"><span class="hs-identifier hs-var">anns</span></a><span>
</span><a name="line-1068"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063103"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-1069"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063104"><span class="hs-identifier hs-var">insts</span></a><span>
</span><a name="line-1070"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063105"><span class="hs-identifier hs-var">fam_insts</span></a><span>
</span><a name="line-1071"></a><span>        </span><a href="Binary.html#lazyPut"><span class="hs-identifier hs-var">lazyPut</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063106"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-1072"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063107"><span class="hs-identifier hs-var">orphan_hash</span></a><span>
</span><a name="line-1073"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063108"><span class="hs-identifier hs-var">hpc_info</span></a><span>
</span><a name="line-1074"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063109"><span class="hs-identifier hs-var">trust</span></a><span>
</span><a name="line-1075"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063110"><span class="hs-identifier hs-var">trust_pkg</span></a><span>
</span><a name="line-1076"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063111"><span class="hs-identifier hs-var">complete_sigs</span></a><span>
</span><a name="line-1077"></a><span>        </span><a href="Binary.html#lazyPut"><span class="hs-identifier hs-var">lazyPut</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063112"><span class="hs-identifier hs-var">doc_hdr</span></a><span>
</span><a name="line-1078"></a><span>        </span><a href="Binary.html#lazyPut"><span class="hs-identifier hs-var">lazyPut</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063113"><span class="hs-identifier hs-var">decl_docs</span></a><span>
</span><a name="line-1079"></a><span>        </span><a href="Binary.html#lazyPut"><span class="hs-identifier hs-var">lazyPut</span></a><span> </span><a href="#local-6989586621684063083"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063114"><span class="hs-identifier hs-var">arg_docs</span></a><span>
</span><a name="line-1080"></a><span>
</span><a name="line-1081"></a><span>   </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621684063115"><a href="#local-6989586621684063115"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1082"></a><span>        </span><a name="local-6989586621684063116"><a href="#local-6989586621684063116"><span class="hs-identifier">mod</span></a></a><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1083"></a><span>        </span><a name="local-6989586621684063117"><a href="#local-6989586621684063117"><span class="hs-identifier">sig_of</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1084"></a><span>        </span><a name="local-6989586621684063118"><a href="#local-6989586621684063118"><span class="hs-identifier">hsc_src</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1085"></a><span>        </span><a name="local-6989586621684063119"><a href="#local-6989586621684063119"><span class="hs-identifier">iface_hash</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1086"></a><span>        </span><a name="local-6989586621684063120"><a href="#local-6989586621684063120"><span class="hs-identifier">mod_hash</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1087"></a><span>        </span><a name="local-6989586621684063121"><a href="#local-6989586621684063121"><span class="hs-identifier">flag_hash</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1088"></a><span>        </span><a name="local-6989586621684063122"><a href="#local-6989586621684063122"><span class="hs-identifier">opt_hash</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1089"></a><span>        </span><a name="local-6989586621684063123"><a href="#local-6989586621684063123"><span class="hs-identifier">hpc_hash</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1090"></a><span>        </span><a name="local-6989586621684063124"><a href="#local-6989586621684063124"><span class="hs-identifier">plugin_hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1091"></a><span>        </span><a name="local-6989586621684063125"><a href="#local-6989586621684063125"><span class="hs-identifier">orphan</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1092"></a><span>        </span><a name="local-6989586621684063126"><a href="#local-6989586621684063126"><span class="hs-identifier">hasFamInsts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1093"></a><span>        </span><a name="local-6989586621684063127"><a href="#local-6989586621684063127"><span class="hs-identifier">deps</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#lazyGet"><span class="hs-identifier hs-var">lazyGet</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1094"></a><span>        </span><a name="local-6989586621684063128"><a href="#local-6989586621684063128"><span class="hs-identifier">usages</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;bin_usages&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Binary.html#lazyGet"><span class="hs-identifier hs-var">lazyGet</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1095"></a><span>        </span><a name="local-6989586621684063129"><a href="#local-6989586621684063129"><span class="hs-identifier">exports</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;bin_exports&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1096"></a><span>        </span><a name="local-6989586621684063130"><a href="#local-6989586621684063130"><span class="hs-identifier">exp_hash</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1097"></a><span>        </span><a name="local-6989586621684063131"><a href="#local-6989586621684063131"><span class="hs-identifier">used_th</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1098"></a><span>        </span><a name="local-6989586621684063132"><a href="#local-6989586621684063132"><span class="hs-identifier">fixities</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;bin_fixities&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1099"></a><span>        </span><a name="local-6989586621684063133"><a href="#local-6989586621684063133"><span class="hs-identifier">warns</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;bin_warns&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Binary.html#lazyGet"><span class="hs-identifier hs-var">lazyGet</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1100"></a><span>        </span><a name="local-6989586621684063134"><a href="#local-6989586621684063134"><span class="hs-identifier">anns</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;bin_anns&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Binary.html#lazyGet"><span class="hs-identifier hs-var">lazyGet</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1101"></a><span>        </span><a name="local-6989586621684063135"><a href="#local-6989586621684063135"><span class="hs-identifier">decls</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;bin_tycldecls&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1102"></a><span>        </span><a name="local-6989586621684063136"><a href="#local-6989586621684063136"><span class="hs-identifier">insts</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;bin_insts&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1103"></a><span>        </span><a name="local-6989586621684063137"><a href="#local-6989586621684063137"><span class="hs-identifier">fam_insts</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;bin_fam_insts&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1104"></a><span>        </span><a name="local-6989586621684063138"><a href="#local-6989586621684063138"><span class="hs-identifier">rules</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;bin_rules&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Binary.html#lazyGet"><span class="hs-identifier hs-var">lazyGet</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1105"></a><span>        </span><a name="local-6989586621684063139"><a href="#local-6989586621684063139"><span class="hs-identifier">orphan_hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1106"></a><span>        </span><a name="local-6989586621684063140"><a href="#local-6989586621684063140"><span class="hs-identifier">hpc_info</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1107"></a><span>        </span><a name="local-6989586621684063141"><a href="#local-6989586621684063141"><span class="hs-identifier">trust</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1108"></a><span>        </span><a name="local-6989586621684063142"><a href="#local-6989586621684063142"><span class="hs-identifier">trust_pkg</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1109"></a><span>        </span><a name="local-6989586621684063143"><a href="#local-6989586621684063143"><span class="hs-identifier">complete_sigs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1110"></a><span>        </span><a name="local-6989586621684063144"><a href="#local-6989586621684063144"><span class="hs-identifier">doc_hdr</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#lazyGet"><span class="hs-identifier hs-var">lazyGet</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1111"></a><span>        </span><a name="local-6989586621684063145"><a href="#local-6989586621684063145"><span class="hs-identifier">decl_docs</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#lazyGet"><span class="hs-identifier hs-var">lazyGet</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1112"></a><span>        </span><a name="local-6989586621684063146"><a href="#local-6989586621684063146"><span class="hs-identifier">arg_docs</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#lazyGet"><span class="hs-identifier hs-var">lazyGet</span></a><span> </span><a href="#local-6989586621684063115"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-1113"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-var">ModIface</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1114"></a><span>                 </span><span class="hs-identifier">mi_module</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063116"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span>
</span><a name="line-1115"></a><span>                 </span><span class="hs-identifier">mi_sig_of</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063117"><span class="hs-identifier hs-var">sig_of</span></a><span class="hs-special">,</span><span>
</span><a name="line-1116"></a><span>                 </span><span class="hs-identifier">mi_hsc_src</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063118"><span class="hs-identifier hs-var">hsc_src</span></a><span class="hs-special">,</span><span>
</span><a name="line-1117"></a><span>                 </span><span class="hs-identifier">mi_iface_hash</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063119"><span class="hs-identifier hs-var">iface_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-1118"></a><span>                 </span><span class="hs-identifier">mi_mod_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063120"><span class="hs-identifier hs-var">mod_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-1119"></a><span>                 </span><span class="hs-identifier">mi_flag_hash</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063121"><span class="hs-identifier hs-var">flag_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-1120"></a><span>                 </span><span class="hs-identifier">mi_opt_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063122"><span class="hs-identifier hs-var">opt_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-1121"></a><span>                 </span><span class="hs-identifier">mi_hpc_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063123"><span class="hs-identifier hs-var">hpc_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-1122"></a><span>                 </span><span class="hs-identifier">mi_plugin_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063124"><span class="hs-identifier hs-var">plugin_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-1123"></a><span>                 </span><span class="hs-identifier">mi_orphan</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063125"><span class="hs-identifier hs-var">orphan</span></a><span class="hs-special">,</span><span>
</span><a name="line-1124"></a><span>                 </span><span class="hs-identifier">mi_finsts</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063126"><span class="hs-identifier hs-var">hasFamInsts</span></a><span class="hs-special">,</span><span>
</span><a name="line-1125"></a><span>                 </span><span class="hs-identifier">mi_deps</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063127"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">,</span><span>
</span><a name="line-1126"></a><span>                 </span><span class="hs-identifier">mi_usages</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063128"><span class="hs-identifier hs-var">usages</span></a><span class="hs-special">,</span><span>
</span><a name="line-1127"></a><span>                 </span><span class="hs-identifier">mi_exports</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063129"><span class="hs-identifier hs-var">exports</span></a><span class="hs-special">,</span><span>
</span><a name="line-1128"></a><span>                 </span><span class="hs-identifier">mi_exp_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063130"><span class="hs-identifier hs-var">exp_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-1129"></a><span>                 </span><span class="hs-identifier">mi_used_th</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063131"><span class="hs-identifier hs-var">used_th</span></a><span class="hs-special">,</span><span>
</span><a name="line-1130"></a><span>                 </span><span class="hs-identifier">mi_anns</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063134"><span class="hs-identifier hs-var">anns</span></a><span class="hs-special">,</span><span>
</span><a name="line-1131"></a><span>                 </span><span class="hs-identifier">mi_fixities</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063132"><span class="hs-identifier hs-var">fixities</span></a><span class="hs-special">,</span><span>
</span><a name="line-1132"></a><span>                 </span><span class="hs-identifier">mi_warns</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063133"><span class="hs-identifier hs-var">warns</span></a><span class="hs-special">,</span><span>
</span><a name="line-1133"></a><span>                 </span><span class="hs-identifier">mi_decls</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063135"><span class="hs-identifier hs-var">decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-1134"></a><span>                 </span><span class="hs-identifier">mi_globals</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-1135"></a><span>                 </span><span class="hs-identifier">mi_insts</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063136"><span class="hs-identifier hs-var">insts</span></a><span class="hs-special">,</span><span>
</span><a name="line-1136"></a><span>                 </span><span class="hs-identifier">mi_fam_insts</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063137"><span class="hs-identifier hs-var">fam_insts</span></a><span class="hs-special">,</span><span>
</span><a name="line-1137"></a><span>                 </span><span class="hs-identifier">mi_rules</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063138"><span class="hs-identifier hs-var">rules</span></a><span class="hs-special">,</span><span>
</span><a name="line-1138"></a><span>                 </span><span class="hs-identifier">mi_orphan_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063139"><span class="hs-identifier hs-var">orphan_hash</span></a><span class="hs-special">,</span><span>
</span><a name="line-1139"></a><span>                 </span><span class="hs-identifier">mi_hpc</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063140"><span class="hs-identifier hs-var">hpc_info</span></a><span class="hs-special">,</span><span>
</span><a name="line-1140"></a><span>                 </span><span class="hs-identifier">mi_trust</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063141"><span class="hs-identifier hs-var">trust</span></a><span class="hs-special">,</span><span>
</span><a name="line-1141"></a><span>                 </span><span class="hs-identifier">mi_trust_pkg</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063142"><span class="hs-identifier hs-var">trust_pkg</span></a><span class="hs-special">,</span><span>
</span><a name="line-1142"></a><span>                        </span><span class="hs-comment">-- And build the cached values</span><span>
</span><a name="line-1143"></a><span>                 </span><span class="hs-identifier">mi_warn_fn</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#mkIfaceWarnCache"><span class="hs-identifier hs-var">mkIfaceWarnCache</span></a><span> </span><a href="#local-6989586621684063133"><span class="hs-identifier hs-var">warns</span></a><span class="hs-special">,</span><span>
</span><a name="line-1144"></a><span>                 </span><span class="hs-identifier">mi_fix_fn</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#mkIfaceFixCache"><span class="hs-identifier hs-var">mkIfaceFixCache</span></a><span> </span><a href="#local-6989586621684063132"><span class="hs-identifier hs-var">fixities</span></a><span class="hs-special">,</span><span>
</span><a name="line-1145"></a><span>                 </span><span class="hs-identifier">mi_hash_fn</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#mkIfaceHashCache"><span class="hs-identifier hs-var">mkIfaceHashCache</span></a><span> </span><a href="#local-6989586621684063135"><span class="hs-identifier hs-var">decls</span></a><span class="hs-special">,</span><span>
</span><a name="line-1146"></a><span>                 </span><span class="hs-identifier">mi_complete_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063143"><span class="hs-identifier hs-var">complete_sigs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1147"></a><span>                 </span><span class="hs-identifier">mi_doc_hdr</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063144"><span class="hs-identifier hs-var">doc_hdr</span></a><span class="hs-special">,</span><span>
</span><a name="line-1148"></a><span>                 </span><span class="hs-identifier">mi_decl_docs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063145"><span class="hs-identifier hs-var">decl_docs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1149"></a><span>                 </span><span class="hs-identifier">mi_arg_docs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063146"><span class="hs-identifier hs-var">arg_docs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1150"></a><span>
</span><a name="line-1151"></a><span class="hs-comment">-- | The original names declared of a certain module that are exported</span><span>
</span><a name="line-1152"></a><span class="hs-keyword">type</span><span> </span><a name="IfaceExport"><a href="HscTypes.html#IfaceExport"><span class="hs-identifier">IfaceExport</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span>
</span><a name="line-1153"></a><span>
</span><a name="line-1154"></a><span class="hs-comment">-- | Constructs an empty ModIface</span><span>
</span><a name="line-1155"></a><span class="hs-identifier">emptyModIface</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a><span>
</span><a name="line-1156"></a><a name="emptyModIface"><a href="HscTypes.html#emptyModIface"><span class="hs-identifier">emptyModIface</span></a></a><span> </span><a name="local-6989586621684063271"><a href="#local-6989586621684063271"><span class="hs-identifier">mod</span></a></a><span>
</span><a name="line-1157"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#ModIface"><span class="hs-identifier hs-var">ModIface</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mi_module</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063271"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span>
</span><a name="line-1158"></a><span>               </span><span class="hs-identifier">mi_sig_of</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-1159"></a><span>               </span><span class="hs-identifier">mi_iface_hash</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fingerprint0</span><span class="hs-special">,</span><span>
</span><a name="line-1160"></a><span>               </span><span class="hs-identifier">mi_mod_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fingerprint0</span><span class="hs-special">,</span><span>
</span><a name="line-1161"></a><span>               </span><span class="hs-identifier">mi_flag_hash</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fingerprint0</span><span class="hs-special">,</span><span>
</span><a name="line-1162"></a><span>               </span><span class="hs-identifier">mi_opt_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fingerprint0</span><span class="hs-special">,</span><span>
</span><a name="line-1163"></a><span>               </span><span class="hs-identifier">mi_hpc_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fingerprint0</span><span class="hs-special">,</span><span>
</span><a name="line-1164"></a><span>               </span><span class="hs-identifier">mi_plugin_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fingerprint0</span><span class="hs-special">,</span><span>
</span><a name="line-1165"></a><span>               </span><span class="hs-identifier">mi_orphan</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-1166"></a><span>               </span><span class="hs-identifier">mi_finsts</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-1167"></a><span>               </span><span class="hs-identifier">mi_hsc_src</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="DriverPhases.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a><span class="hs-special">,</span><span>
</span><a name="line-1168"></a><span>               </span><span class="hs-identifier">mi_deps</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#noDependencies"><span class="hs-identifier hs-var">noDependencies</span></a><span class="hs-special">,</span><span>
</span><a name="line-1169"></a><span>               </span><span class="hs-identifier">mi_usages</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1170"></a><span>               </span><span class="hs-identifier">mi_exports</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1171"></a><span>               </span><span class="hs-identifier">mi_exp_hash</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fingerprint0</span><span class="hs-special">,</span><span>
</span><a name="line-1172"></a><span>               </span><span class="hs-identifier">mi_used_th</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-1173"></a><span>               </span><span class="hs-identifier">mi_fixities</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1174"></a><span>               </span><span class="hs-identifier">mi_warns</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#NoWarnings"><span class="hs-identifier hs-var">NoWarnings</span></a><span class="hs-special">,</span><span>
</span><a name="line-1175"></a><span>               </span><span class="hs-identifier">mi_anns</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1176"></a><span>               </span><span class="hs-identifier">mi_insts</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1177"></a><span>               </span><span class="hs-identifier">mi_fam_insts</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1178"></a><span>               </span><span class="hs-identifier">mi_rules</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1179"></a><span>               </span><span class="hs-identifier">mi_decls</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1180"></a><span>               </span><span class="hs-identifier">mi_globals</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-1181"></a><span>               </span><span class="hs-identifier">mi_orphan_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fingerprint0</span><span class="hs-special">,</span><span>
</span><a name="line-1182"></a><span>               </span><span class="hs-identifier">mi_warn_fn</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#emptyIfaceWarnCache"><span class="hs-identifier hs-var">emptyIfaceWarnCache</span></a><span class="hs-special">,</span><span>
</span><a name="line-1183"></a><span>               </span><span class="hs-identifier">mi_fix_fn</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#emptyIfaceFixCache"><span class="hs-identifier hs-var">emptyIfaceFixCache</span></a><span class="hs-special">,</span><span>
</span><a name="line-1184"></a><span>               </span><span class="hs-identifier">mi_hash_fn</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#emptyIfaceHashCache"><span class="hs-identifier hs-var">emptyIfaceHashCache</span></a><span class="hs-special">,</span><span>
</span><a name="line-1185"></a><span>               </span><span class="hs-identifier">mi_hpc</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-1186"></a><span>               </span><span class="hs-identifier">mi_trust</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#noIfaceTrustInfo"><span class="hs-identifier hs-var">noIfaceTrustInfo</span></a><span class="hs-special">,</span><span>
</span><a name="line-1187"></a><span>               </span><span class="hs-identifier">mi_trust_pkg</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span>
</span><a name="line-1188"></a><span>               </span><span class="hs-identifier">mi_complete_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1189"></a><span>               </span><span class="hs-identifier">mi_doc_hdr</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-1190"></a><span>               </span><span class="hs-identifier">mi_decl_docs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="HsDoc.html#emptyDeclDocMap"><span class="hs-identifier hs-var">emptyDeclDocMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-1191"></a><span>               </span><span class="hs-identifier">mi_arg_docs</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="HsDoc.html#emptyArgDocMap"><span class="hs-identifier hs-var">emptyArgDocMap</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1192"></a><span>
</span><a name="line-1193"></a><span>
</span><a name="line-1194"></a><span class="hs-comment">-- | Constructs cache for the 'mi_hash_fn' field of a 'ModIface'</span><span>
</span><a name="line-1195"></a><span class="hs-identifier">mkIfaceHashCache</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><a href="IfaceSyn.html#IfaceDecl"><span class="hs-identifier hs-type">IfaceDecl</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1196"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1197"></a><a name="mkIfaceHashCache"><a href="HscTypes.html#mkIfaceHashCache"><span class="hs-identifier">mkIfaceHashCache</span></a></a><span> </span><a name="local-6989586621684063272"><a href="#local-6989586621684063272"><span class="hs-identifier">pairs</span></a></a><span>
</span><a name="line-1198"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684063282"><a href="#local-6989586621684063282"><span class="hs-identifier">occ</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-6989586621684063273"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621684063282"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-1199"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1200"></a><span>    </span><a name="local-6989586621684063273"><a href="#local-6989586621684063273"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621684063274"><span class="hs-identifier hs-var">add_decl</span></a><span> </span><a href="OccName.html#emptyOccEnv"><span class="hs-identifier hs-var">emptyOccEnv</span></a><span> </span><a href="#local-6989586621684063272"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-1201"></a><span>    </span><a name="local-6989586621684063274"><a href="#local-6989586621684063274"><span class="hs-identifier">add_decl</span></a></a><span> </span><a name="local-6989586621684063275"><a href="#local-6989586621684063275"><span class="hs-identifier">env0</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684063276"><a href="#local-6989586621684063276"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><a name="local-6989586621684063277"><a href="#local-6989586621684063277"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621684063278"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="#local-6989586621684063275"><span class="hs-identifier hs-var">env0</span></a><span> </span><span class="hs-special">(</span><a href="IfaceSyn.html#ifaceDeclFingerprints"><span class="hs-identifier hs-var">ifaceDeclFingerprints</span></a><span> </span><a href="#local-6989586621684063276"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621684063277"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-1202"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1203"></a><span>        </span><a name="local-6989586621684063278"><a href="#local-6989586621684063278"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621684063279"><a href="#local-6989586621684063279"><span class="hs-identifier">env0</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684063280"><a href="#local-6989586621684063280"><span class="hs-identifier">occ</span></a></a><span class="hs-special">,</span><a name="local-6989586621684063281"><a href="#local-6989586621684063281"><span class="hs-identifier">hash</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#extendOccEnv"><span class="hs-identifier hs-var">extendOccEnv</span></a><span> </span><a href="#local-6989586621684063279"><span class="hs-identifier hs-var">env0</span></a><span> </span><a href="#local-6989586621684063280"><span class="hs-identifier hs-var">occ</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063280"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">,</span><a href="#local-6989586621684063281"><span class="hs-identifier hs-var">hash</span></a><span class="hs-special">)</span><span>
</span><a name="line-1204"></a><span>
</span><a name="line-1205"></a><span class="hs-identifier">emptyIfaceHashCache</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">)</span><span>
</span><a name="line-1206"></a><a name="emptyIfaceHashCache"><a href="HscTypes.html#emptyIfaceHashCache"><span class="hs-identifier">emptyIfaceHashCache</span></a></a><span> </span><a name="local-6989586621684063283"><a href="#local-6989586621684063283"><span class="hs-identifier">_occ</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1207"></a><span>
</span><a name="line-1208"></a><span>
</span><a name="line-1209"></a><span class="hs-comment">-- | The 'ModDetails' is essentially a cache for information in the 'ModIface'</span><span>
</span><a name="line-1210"></a><span class="hs-comment">-- for home modules only. Information relating to packages will be loaded into</span><span>
</span><a name="line-1211"></a><span class="hs-comment">-- global environments in 'ExternalPackageState'.</span><span>
</span><a name="line-1212"></a><span class="hs-keyword">data</span><span> </span><a name="ModDetails"><a href="HscTypes.html#ModDetails"><span class="hs-identifier">ModDetails</span></a></a><span>
</span><a name="line-1213"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ModDetails"><a href="HscTypes.html#ModDetails"><span class="hs-identifier">ModDetails</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1214"></a><span>        </span><span class="hs-comment">-- The next two fields are created by the typechecker</span><span>
</span><a name="line-1215"></a><span>        </span><a name="md_exports"><a href="HscTypes.html#md_exports"><span class="hs-identifier">md_exports</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1216"></a><span>        </span><a name="md_types"><a href="HscTypes.html#md_types"><span class="hs-identifier">md_types</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ Local type environment for this particular module</span><span>
</span><a name="line-1217"></a><span>                                        </span><span class="hs-comment">-- Includes Ids, TyCons, PatSyns</span><span>
</span><a name="line-1218"></a><span>        </span><a name="md_insts"><a href="HscTypes.html#md_insts"><span class="hs-identifier">md_insts</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ 'DFunId's for the instances in this module</span><span>
</span><a name="line-1219"></a><span>        </span><a name="md_fam_insts"><a href="HscTypes.html#md_fam_insts"><span class="hs-identifier">md_fam_insts</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1220"></a><span>        </span><a name="md_rules"><a href="HscTypes.html#md_rules"><span class="hs-identifier">md_rules</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- ^ Domain may include 'Id's from other modules</span><span>
</span><a name="line-1221"></a><span>        </span><a name="md_anns"><a href="HscTypes.html#md_anns"><span class="hs-identifier">md_anns</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^ Annotations present in this module: currently</span><span>
</span><a name="line-1222"></a><span>                                        </span><span class="hs-comment">-- they only annotate things also declared in this module</span><span>
</span><a name="line-1223"></a><span>        </span><a name="md_complete_sigs"><a href="HscTypes.html#md_complete_sigs"><span class="hs-identifier">md_complete_sigs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">]</span><span>
</span><a name="line-1224"></a><span>          </span><span class="hs-comment">-- ^ Complete match pragmas for this module</span><span>
</span><a name="line-1225"></a><span>     </span><span class="hs-special">}</span><span>
</span><a name="line-1226"></a><span>
</span><a name="line-1227"></a><span class="hs-comment">-- | Constructs an empty ModDetails</span><span>
</span><a name="line-1228"></a><span class="hs-identifier">emptyModDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a><span>
</span><a name="line-1229"></a><a name="emptyModDetails"><a href="HscTypes.html#emptyModDetails"><span class="hs-identifier">emptyModDetails</span></a></a><span>
</span><a name="line-1230"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#ModDetails"><span class="hs-identifier hs-var">ModDetails</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">md_types</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#emptyTypeEnv"><span class="hs-identifier hs-var">emptyTypeEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-1231"></a><span>                 </span><span class="hs-identifier">md_exports</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1232"></a><span>                 </span><span class="hs-identifier">md_insts</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1233"></a><span>                 </span><span class="hs-identifier">md_rules</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1234"></a><span>                 </span><span class="hs-identifier">md_fam_insts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1235"></a><span>                 </span><span class="hs-identifier">md_anns</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1236"></a><span>                 </span><span class="hs-identifier">md_complete_sigs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1237"></a><span>
</span><a name="line-1238"></a><span class="hs-comment">-- | Records the modules directly imported by a module for extracting e.g.</span><span>
</span><a name="line-1239"></a><span class="hs-comment">-- usage information, and also to give better error message</span><span>
</span><a name="line-1240"></a><span class="hs-keyword">type</span><span> </span><a name="ImportedMods"><a href="HscTypes.html#ImportedMods"><span class="hs-identifier">ImportedMods</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><span class="hs-special">[</span><a href="HscTypes.html#ImportedBy"><span class="hs-identifier hs-type">ImportedBy</span></a><span class="hs-special">]</span><span>
</span><a name="line-1241"></a><span>
</span><a name="line-1242"></a><span class="hs-comment">-- | If a module was &quot;imported&quot; by the user, we associate it with</span><span>
</span><a name="line-1243"></a><span class="hs-comment">-- more detailed usage information 'ImportedModsVal'; a module</span><span>
</span><a name="line-1244"></a><span class="hs-comment">-- imported by the system only gets used for usage information.</span><span>
</span><a name="line-1245"></a><span class="hs-keyword">data</span><span> </span><a name="ImportedBy"><a href="HscTypes.html#ImportedBy"><span class="hs-identifier">ImportedBy</span></a></a><span>
</span><a name="line-1246"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="ImportedByUser"><a href="HscTypes.html#ImportedByUser"><span class="hs-identifier">ImportedByUser</span></a></a><span> </span><a href="HscTypes.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a><span>
</span><a name="line-1247"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="ImportedBySystem"><a href="HscTypes.html#ImportedBySystem"><span class="hs-identifier">ImportedBySystem</span></a></a><span>
</span><a name="line-1248"></a><span>
</span><a name="line-1249"></a><span class="hs-identifier">importedByUser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#ImportedBy"><span class="hs-identifier hs-type">ImportedBy</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a><span class="hs-special">]</span><span>
</span><a name="line-1250"></a><a name="importedByUser"><a href="HscTypes.html#importedByUser"><span class="hs-identifier">importedByUser</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ImportedByUser"><span class="hs-identifier hs-var">ImportedByUser</span></a><span> </span><a name="local-6989586621684063284"><a href="#local-6989586621684063284"><span class="hs-identifier">imv</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684063285"><a href="#local-6989586621684063285"><span class="hs-identifier">bys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063284"><span class="hs-identifier hs-var">imv</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="HscTypes.html#importedByUser"><span class="hs-identifier hs-var">importedByUser</span></a><span> </span><a href="#local-6989586621684063285"><span class="hs-identifier hs-var">bys</span></a><span>
</span><a name="line-1251"></a><span class="hs-identifier">importedByUser</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ImportedBySystem"><span class="hs-identifier hs-var">ImportedBySystem</span></a><span>   </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684063286"><a href="#local-6989586621684063286"><span class="hs-identifier">bys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>       </span><a href="HscTypes.html#importedByUser"><span class="hs-identifier hs-var">importedByUser</span></a><span> </span><a href="#local-6989586621684063286"><span class="hs-identifier hs-var">bys</span></a><span>
</span><a name="line-1252"></a><span class="hs-identifier">importedByUser</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1253"></a><span>
</span><a name="line-1254"></a><span class="hs-keyword">data</span><span> </span><a name="ImportedModsVal"><a href="HscTypes.html#ImportedModsVal"><span class="hs-identifier">ImportedModsVal</span></a></a><span>
</span><a name="line-1255"></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ImportedModsVal"><a href="HscTypes.html#ImportedModsVal"><span class="hs-identifier">ImportedModsVal</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1256"></a><span>        </span><a name="imv_name"><a href="HscTypes.html#imv_name"><span class="hs-identifier">imv_name</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- ^ The name the module is imported with</span><span>
</span><a name="line-1257"></a><span>        </span><a name="imv_span"><a href="HscTypes.html#imv_span"><span class="hs-identifier">imv_span</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">,</span><span>             </span><span class="hs-comment">-- ^ the source span of the whole import</span><span>
</span><a name="line-1258"></a><span>        </span><a name="imv_is_safe"><a href="HscTypes.html#imv_is_safe"><span class="hs-identifier">imv_is_safe</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#IsSafeImport"><span class="hs-identifier hs-type">IsSafeImport</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ whether this is a safe import</span><span>
</span><a name="line-1259"></a><span>        </span><a name="imv_is_hiding"><a href="HscTypes.html#imv_is_hiding"><span class="hs-identifier">imv_is_hiding</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- ^ whether this is an &quot;hiding&quot; import</span><span>
</span><a name="line-1260"></a><span>        </span><a name="imv_all_exports"><a href="HscTypes.html#imv_all_exports"><span class="hs-identifier">imv_all_exports</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ all the things the module could provide</span><span>
</span><a name="line-1261"></a><span>          </span><span class="hs-comment">-- NB. BangPattern here: otherwise this leaks. (#15111)</span><span>
</span><a name="line-1262"></a><span>        </span><a name="imv_qualified"><a href="HscTypes.html#imv_qualified"><span class="hs-identifier">imv_qualified</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>            </span><span class="hs-comment">-- ^ whether this is a qualified import</span><span>
</span><a name="line-1263"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-1264"></a><span>
</span><a name="line-1265"></a><span class="hs-comment">-- | A ModGuts is carried through the compiler, accumulating stuff as it goes</span><span>
</span><a name="line-1266"></a><span class="hs-comment">-- There is only one ModGuts at any time, the one for the module</span><span>
</span><a name="line-1267"></a><span class="hs-comment">-- being compiled right now.  Once it is compiled, a 'ModIface' and</span><span>
</span><a name="line-1268"></a><span class="hs-comment">-- 'ModDetails' are extracted and the ModGuts is discarded.</span><span>
</span><a name="line-1269"></a><span class="hs-keyword">data</span><span> </span><a name="ModGuts"><a href="HscTypes.html#ModGuts"><span class="hs-identifier">ModGuts</span></a></a><span>
</span><a name="line-1270"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ModGuts"><a href="HscTypes.html#ModGuts"><span class="hs-identifier">ModGuts</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1271"></a><span>        </span><a name="mg_module"><a href="HscTypes.html#mg_module"><span class="hs-identifier">mg_module</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- ^ Module being compiled</span><span>
</span><a name="line-1272"></a><span>        </span><a name="mg_hsc_src"><a href="HscTypes.html#mg_hsc_src"><span class="hs-identifier">mg_hsc_src</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ Whether it's an hs-boot module</span><span>
</span><a name="line-1273"></a><span>        </span><a name="mg_loc"><a href="HscTypes.html#mg_loc"><span class="hs-identifier">mg_loc</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- ^ For error messages from inner passes</span><span>
</span><a name="line-1274"></a><span>        </span><a name="mg_exports"><a href="HscTypes.html#mg_exports"><span class="hs-identifier">mg_exports</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- ^ What it exports</span><span>
</span><a name="line-1275"></a><span>        </span><a name="mg_deps"><a href="HscTypes.html#mg_deps"><span class="hs-identifier">mg_deps</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ What it depends on, directly or</span><span>
</span><a name="line-1276"></a><span>                                         </span><span class="hs-comment">-- otherwise</span><span>
</span><a name="line-1277"></a><span>        </span><a name="mg_usages"><a href="HscTypes.html#mg_usages"><span class="hs-identifier">mg_usages</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="HscTypes.html#Usage"><span class="hs-identifier hs-type">Usage</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- ^ What was used?  Used for interfaces.</span><span>
</span><a name="line-1278"></a><span>
</span><a name="line-1279"></a><span>        </span><a name="mg_used_th"><a href="HscTypes.html#mg_used_th"><span class="hs-identifier">mg_used_th</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- ^ Did we run a TH splice?</span><span>
</span><a name="line-1280"></a><span>        </span><a name="mg_rdr_env"><a href="HscTypes.html#mg_rdr_env"><span class="hs-identifier">mg_rdr_env</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ Top-level lexical environment</span><span>
</span><a name="line-1281"></a><span>
</span><a name="line-1282"></a><span>        </span><span class="hs-comment">-- These fields all describe the things **declared in this module**</span><span>
</span><a name="line-1283"></a><span>        </span><a name="mg_fix_env"><a href="HscTypes.html#mg_fix_env"><span class="hs-identifier">mg_fix_env</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- ^ Fixities declared in this module.</span><span>
</span><a name="line-1284"></a><span>                                         </span><span class="hs-comment">-- Used for creating interface files.</span><span>
</span><a name="line-1285"></a><span>        </span><a name="mg_tcs"><a href="HscTypes.html#mg_tcs"><span class="hs-identifier">mg_tcs</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- ^ TyCons declared in this module</span><span>
</span><a name="line-1286"></a><span>                                         </span><span class="hs-comment">-- (includes TyCons for classes)</span><span>
</span><a name="line-1287"></a><span>        </span><a name="mg_insts"><a href="HscTypes.html#mg_insts"><span class="hs-identifier">mg_insts</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- ^ Class instances declared in this module</span><span>
</span><a name="line-1288"></a><span>        </span><a name="mg_fam_insts"><a href="HscTypes.html#mg_fam_insts"><span class="hs-identifier">mg_fam_insts</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1289"></a><span>                                         </span><span class="hs-comment">-- ^ Family instances declared in this module</span><span>
</span><a name="line-1290"></a><span>        </span><a name="mg_patsyns"><a href="HscTypes.html#mg_patsyns"><span class="hs-identifier">mg_patsyns</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ Pattern synonyms declared in this module</span><span>
</span><a name="line-1291"></a><span>        </span><a name="mg_rules"><a href="HscTypes.html#mg_rules"><span class="hs-identifier">mg_rules</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="CoreSyn.html#CoreRule"><span class="hs-identifier hs-type">CoreRule</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ Before the core pipeline starts, contains</span><span>
</span><a name="line-1292"></a><span>                                         </span><span class="hs-comment">-- See Note [Overall plumbing for rules] in Rules.hs</span><span>
</span><a name="line-1293"></a><span>        </span><a name="mg_binds"><a href="HscTypes.html#mg_binds"><span class="hs-identifier">mg_binds</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="CoreSyn.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- ^ Bindings for this module</span><span>
</span><a name="line-1294"></a><span>        </span><a name="mg_foreign"><a href="HscTypes.html#mg_foreign"><span class="hs-identifier">mg_foreign</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#ForeignStubs"><span class="hs-identifier hs-type">ForeignStubs</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ Foreign exports declared in this module</span><span>
</span><a name="line-1295"></a><span>        </span><a name="mg_foreign_files"><a href="HscTypes.html#mg_foreign_files"><span class="hs-identifier">mg_foreign_files</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="GHC.ForeignSrcLang.Type.html#ForeignSrcLang"><span class="hs-identifier hs-type">ForeignSrcLang</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1296"></a><span>        </span><span class="hs-comment">-- ^ Files to be compiled with the C compiler</span><span>
</span><a name="line-1297"></a><span>        </span><a name="mg_warns"><a href="HscTypes.html#mg_warns"><span class="hs-identifier">mg_warns</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span class="hs-special">,</span><span>       </span><span class="hs-comment">-- ^ Warnings declared in the module</span><span>
</span><a name="line-1298"></a><span>        </span><a name="mg_anns"><a href="HscTypes.html#mg_anns"><span class="hs-identifier">mg_anns</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- ^ Annotations declared in this module</span><span>
</span><a name="line-1299"></a><span>        </span><a name="mg_complete_sigs"><a href="HscTypes.html#mg_complete_sigs"><span class="hs-identifier">mg_complete_sigs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Complete Matches</span><span>
</span><a name="line-1300"></a><span>        </span><a name="mg_hpc_info"><a href="HscTypes.html#mg_hpc_info"><span class="hs-identifier">mg_hpc_info</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#HpcInfo"><span class="hs-identifier hs-type">HpcInfo</span></a><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- ^ Coverage tick boxes in the module</span><span>
</span><a name="line-1301"></a><span>        </span><a name="mg_modBreaks"><a href="HscTypes.html#mg_modBreaks"><span class="hs-identifier">mg_modBreaks</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="ByteCodeTypes.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Breakpoints for the module</span><span>
</span><a name="line-1302"></a><span>
</span><a name="line-1303"></a><span>                        </span><span class="hs-comment">-- The next two fields are unusual, because they give instance</span><span>
</span><a name="line-1304"></a><span>                        </span><span class="hs-comment">-- environments for *all* modules in the home package, including</span><span>
</span><a name="line-1305"></a><span>                        </span><span class="hs-comment">-- this module, rather than for *just* this module.</span><span>
</span><a name="line-1306"></a><span>                        </span><span class="hs-comment">-- Reason: when looking up an instance we don't want to have to</span><span>
</span><a name="line-1307"></a><span>                        </span><span class="hs-comment">--         look at each module in the home package in turn</span><span>
</span><a name="line-1308"></a><span>        </span><a name="mg_inst_env"><a href="HscTypes.html#mg_inst_env"><span class="hs-identifier">mg_inst_env</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a><span class="hs-special">,</span><span>             </span><span class="hs-comment">-- ^ Class instance environment for</span><span>
</span><a name="line-1309"></a><span>                                                </span><span class="hs-comment">-- /home-package/ modules (including this</span><span>
</span><a name="line-1310"></a><span>                                                </span><span class="hs-comment">-- one); c.f. 'tcg_inst_env'</span><span>
</span><a name="line-1311"></a><span>        </span><a name="mg_fam_inst_env"><a href="HscTypes.html#mg_fam_inst_env"><span class="hs-identifier">mg_fam_inst_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- ^ Type-family instance environment for</span><span>
</span><a name="line-1312"></a><span>                                                </span><span class="hs-comment">-- /home-package/ modules (including this</span><span>
</span><a name="line-1313"></a><span>                                                </span><span class="hs-comment">-- one); c.f. 'tcg_fam_inst_env'</span><span>
</span><a name="line-1314"></a><span>
</span><a name="line-1315"></a><span>        </span><a name="mg_safe_haskell"><a href="HscTypes.html#mg_safe_haskell"><span class="hs-identifier">mg_safe_haskell</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ Safe Haskell mode</span><span>
</span><a name="line-1316"></a><span>        </span><a name="mg_trust_pkg"><a href="HscTypes.html#mg_trust_pkg"><span class="hs-identifier">mg_trust_pkg</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span>                </span><span class="hs-comment">-- ^ Do we need to trust our</span><span>
</span><a name="line-1317"></a><span>                                                </span><span class="hs-comment">-- own package for Safe Haskell?</span><span>
</span><a name="line-1318"></a><span>                                                </span><span class="hs-comment">-- See Note [RnNames . Trust Own Package]</span><span>
</span><a name="line-1319"></a><span>
</span><a name="line-1320"></a><span>        </span><a name="mg_doc_hdr"><a href="HscTypes.html#mg_doc_hdr"><span class="hs-identifier">mg_doc_hdr</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HsDoc.html#HsDocString"><span class="hs-identifier hs-type">HsDocString</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Module header.</span><span>
</span><a name="line-1321"></a><span>        </span><a name="mg_decl_docs"><a href="HscTypes.html#mg_decl_docs"><span class="hs-identifier">mg_decl_docs</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HsDoc.html#DeclDocMap"><span class="hs-identifier hs-type">DeclDocMap</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ Docs on declarations.</span><span>
</span><a name="line-1322"></a><span>        </span><a name="mg_arg_docs"><a href="HscTypes.html#mg_arg_docs"><span class="hs-identifier">mg_arg_docs</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HsDoc.html#ArgDocMap"><span class="hs-identifier hs-type">ArgDocMap</span></a><span>       </span><span class="hs-comment">-- ^ Docs on arguments.</span><span>
</span><a name="line-1323"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1324"></a><span>
</span><a name="line-1325"></a><span class="hs-comment">-- The ModGuts takes on several slightly different forms:</span><span>
</span><a name="line-1326"></a><span class="hs-comment">--</span><span>
</span><a name="line-1327"></a><span class="hs-comment">-- After simplification, the following fields change slightly:</span><span>
</span><a name="line-1328"></a><span class="hs-comment">--      mg_rules        Orphan rules only (local ones now attached to binds)</span><span>
</span><a name="line-1329"></a><span class="hs-comment">--      mg_binds        With rules attached</span><span>
</span><a name="line-1330"></a><span>
</span><a name="line-1331"></a><span class="hs-comment">---------------------------------------------------------</span><span>
</span><a name="line-1332"></a><span class="hs-comment">-- The Tidy pass forks the information about this module:</span><span>
</span><a name="line-1333"></a><span class="hs-comment">--      * one lot goes to interface file generation (ModIface)</span><span>
</span><a name="line-1334"></a><span class="hs-comment">--        and later compilations (ModDetails)</span><span>
</span><a name="line-1335"></a><span class="hs-comment">--      * the other lot goes to code generation (CgGuts)</span><span>
</span><a name="line-1336"></a><span>
</span><a name="line-1337"></a><span class="hs-comment">-- | A restricted form of 'ModGuts' for code generation purposes</span><span>
</span><a name="line-1338"></a><span class="hs-keyword">data</span><span> </span><a name="CgGuts"><a href="HscTypes.html#CgGuts"><span class="hs-identifier">CgGuts</span></a></a><span>
</span><a name="line-1339"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="CgGuts"><a href="HscTypes.html#CgGuts"><span class="hs-identifier">CgGuts</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1340"></a><span>        </span><a name="cg_module"><a href="HscTypes.html#cg_module"><span class="hs-identifier">cg_module</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>
</span><a name="line-1341"></a><span>                </span><span class="hs-comment">-- ^ Module being compiled</span><span>
</span><a name="line-1342"></a><span>
</span><a name="line-1343"></a><span>        </span><a name="cg_tycons"><a href="HscTypes.html#cg_tycons"><span class="hs-identifier">cg_tycons</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1344"></a><span>                </span><span class="hs-comment">-- ^ Algebraic data types (including ones that started</span><span>
</span><a name="line-1345"></a><span>                </span><span class="hs-comment">-- life as classes); generate constructors and info</span><span>
</span><a name="line-1346"></a><span>                </span><span class="hs-comment">-- tables. Includes newtypes, just for the benefit of</span><span>
</span><a name="line-1347"></a><span>                </span><span class="hs-comment">-- External Core</span><span>
</span><a name="line-1348"></a><span>
</span><a name="line-1349"></a><span>        </span><a name="cg_binds"><a href="HscTypes.html#cg_binds"><span class="hs-identifier">cg_binds</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="CoreSyn.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a><span class="hs-special">,</span><span>
</span><a name="line-1350"></a><span>                </span><span class="hs-comment">-- ^ The tidied main bindings, including</span><span>
</span><a name="line-1351"></a><span>                </span><span class="hs-comment">-- previously-implicit bindings for record and class</span><span>
</span><a name="line-1352"></a><span>                </span><span class="hs-comment">-- selectors, and data constructor wrappers.  But *not*</span><span>
</span><a name="line-1353"></a><span>                </span><span class="hs-comment">-- data constructor workers; reason: we regard them</span><span>
</span><a name="line-1354"></a><span>                </span><span class="hs-comment">-- as part of the code-gen of tycons</span><span>
</span><a name="line-1355"></a><span>
</span><a name="line-1356"></a><span>        </span><a name="cg_foreign"><a href="HscTypes.html#cg_foreign"><span class="hs-identifier">cg_foreign</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#ForeignStubs"><span class="hs-identifier hs-type">ForeignStubs</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ Foreign export stubs</span><span>
</span><a name="line-1357"></a><span>        </span><a name="cg_foreign_files"><a href="HscTypes.html#cg_foreign_files"><span class="hs-identifier">cg_foreign_files</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="GHC.ForeignSrcLang.Type.html#ForeignSrcLang"><span class="hs-identifier hs-type">ForeignSrcLang</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1358"></a><span>        </span><a name="cg_dep_pkgs"><a href="HscTypes.html#cg_dep_pkgs"><span class="hs-identifier">cg_dep_pkgs</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Dependent packages, used to</span><span>
</span><a name="line-1359"></a><span>                                            </span><span class="hs-comment">-- generate #includes for C code gen</span><span>
</span><a name="line-1360"></a><span>        </span><a name="cg_hpc_info"><a href="HscTypes.html#cg_hpc_info"><span class="hs-identifier">cg_hpc_info</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#HpcInfo"><span class="hs-identifier hs-type">HpcInfo</span></a><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- ^ Program coverage tick box information</span><span>
</span><a name="line-1361"></a><span>        </span><a name="cg_modBreaks"><a href="HscTypes.html#cg_modBreaks"><span class="hs-identifier">cg_modBreaks</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="ByteCodeTypes.html#ModBreaks"><span class="hs-identifier hs-type">ModBreaks</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Module breakpoints</span><span>
</span><a name="line-1362"></a><span>        </span><a name="cg_spt_entries"><a href="HscTypes.html#cg_spt_entries"><span class="hs-identifier">cg_spt_entries</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a><span class="hs-special">]</span><span>
</span><a name="line-1363"></a><span>                </span><span class="hs-comment">-- ^ Static pointer table entries for static forms defined in</span><span>
</span><a name="line-1364"></a><span>                </span><span class="hs-comment">-- the module.</span><span>
</span><a name="line-1365"></a><span>                </span><span class="hs-comment">-- See Note [Grand plan for static forms] in StaticPtrTable</span><span>
</span><a name="line-1366"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1367"></a><span>
</span><a name="line-1368"></a><span class="hs-comment">-----------------------------------</span><span>
</span><a name="line-1369"></a><span class="hs-comment">-- | Foreign export stubs</span><span>
</span><a name="line-1370"></a><span class="hs-keyword">data</span><span> </span><a name="ForeignStubs"><a href="HscTypes.html#ForeignStubs"><span class="hs-identifier">ForeignStubs</span></a></a><span>
</span><a name="line-1371"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NoStubs"><a href="HscTypes.html#NoStubs"><span class="hs-identifier">NoStubs</span></a></a><span>
</span><a name="line-1372"></a><span>      </span><span class="hs-comment">-- ^ We don't have any stubs</span><span>
</span><a name="line-1373"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ForeignStubs"><a href="HscTypes.html#ForeignStubs"><span class="hs-identifier">ForeignStubs</span></a></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span>
</span><a name="line-1374"></a><span>      </span><span class="hs-comment">-- ^ There are some stubs. Parameters:</span><span>
</span><a name="line-1375"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-1376"></a><span>      </span><span class="hs-comment">--  1) Header file prototypes for</span><span>
</span><a name="line-1377"></a><span>      </span><span class="hs-comment">--     &quot;foreign exported&quot; functions</span><span>
</span><a name="line-1378"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-1379"></a><span>      </span><span class="hs-comment">--  2) C stubs to use when calling</span><span>
</span><a name="line-1380"></a><span>      </span><span class="hs-comment">--     &quot;foreign exported&quot; functions</span><span>
</span><a name="line-1381"></a><span>
</span><a name="line-1382"></a><span class="hs-identifier">appendStubC</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ForeignStubs"><span class="hs-identifier hs-type">ForeignStubs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ForeignStubs"><span class="hs-identifier hs-type">ForeignStubs</span></a><span>
</span><a name="line-1383"></a><a name="appendStubC"><a href="HscTypes.html#appendStubC"><span class="hs-identifier">appendStubC</span></a></a><span> </span><a href="HscTypes.html#NoStubs"><span class="hs-identifier hs-var">NoStubs</span></a><span>            </span><a name="local-6989586621684063287"><a href="#local-6989586621684063287"><span class="hs-identifier">c_code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#ForeignStubs"><span class="hs-identifier hs-var">ForeignStubs</span></a><span> </span><a href="Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a><span> </span><a href="#local-6989586621684063287"><span class="hs-identifier hs-var">c_code</span></a><span>
</span><a name="line-1384"></a><span class="hs-identifier">appendStubC</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ForeignStubs"><span class="hs-identifier hs-var">ForeignStubs</span></a><span> </span><a name="local-6989586621684063288"><a href="#local-6989586621684063288"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621684063289"><a href="#local-6989586621684063289"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684063290"><a href="#local-6989586621684063290"><span class="hs-identifier">c_code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#ForeignStubs"><span class="hs-identifier hs-var">ForeignStubs</span></a><span> </span><a href="#local-6989586621684063288"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063289"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="#local-6989586621684063290"><span class="hs-identifier hs-var">c_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1385"></a><span>
</span><a name="line-1386"></a><span class="hs-comment">-- | An entry to be inserted into a module's static pointer table.</span><span>
</span><a name="line-1387"></a><span class="hs-comment">-- See Note [Grand plan for static forms] in StaticPtrTable.</span><span>
</span><a name="line-1388"></a><span class="hs-keyword">data</span><span> </span><a name="SptEntry"><a href="HscTypes.html#SptEntry"><span class="hs-identifier">SptEntry</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SptEntry"><a href="HscTypes.html#SptEntry"><span class="hs-identifier">SptEntry</span></a></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span>
</span><a name="line-1389"></a><span>
</span><a name="line-1390"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="HscTypes.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1391"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#SptEntry"><span class="hs-identifier hs-var">SptEntry</span></a><span> </span><a name="local-6989586621684063081"><a href="#local-6989586621684063081"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621684063082"><a href="#local-6989586621684063082"><span class="hs-identifier">fpr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063081"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063082"><span class="hs-identifier hs-var">fpr</span></a><span>
</span><a name="line-1392"></a><span>
</span><a name="line-1393"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                The interactive context
*                                                                      *
************************************************************************

Note [The interactive package]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Type, class, and value declarations at the command prompt are treated
as if they were defined in modules
   interactive:Ghci1
   interactive:Ghci2
   ...etc...
with each bunch of declarations using a new module, all sharing a
common package 'interactive' (see Module.interactiveUnitId, and
PrelNames.mkInteractiveModule).

This scheme deals well with shadowing.  For example:

   ghci&gt; data T = A
   ghci&gt; data T = B
   ghci&gt; :i A
   data Ghci1.T = A  -- Defined at &lt;interactive&gt;:2:10

Here we must display info about constructor A, but its type T has been
shadowed by the second declaration.  But it has a respectable
qualified name (Ghci1.T), and its source location says where it was
defined.

So the main invariant continues to hold, that in any session an
original name M.T only refers to one unique thing.  (In a previous
iteration both the T's above were called :Interactive.T, albeit with
different uniques, which gave rise to all sorts of trouble.)

The details are a bit tricky though:

 * The field ic_mod_index counts which Ghci module we've got up to.
   It is incremented when extending ic_tythings

 * ic_tythings contains only things from the 'interactive' package.

 * Module from the 'interactive' package (Ghci1, Ghci2 etc) never go
   in the Home Package Table (HPT).  When you say :load, that's when we
   extend the HPT.

 * The 'thisPackage' field of DynFlags is *not* set to 'interactive'.
   It stays as 'main' (or whatever -this-unit-id says), and is the
   package to which :load'ed modules are added to.

 * So how do we arrange that declarations at the command prompt get to
   be in the 'interactive' package?  Simply by setting the tcg_mod
   field of the TcGblEnv to &quot;interactive:Ghci1&quot;.  This is done by the
   call to initTc in initTcInteractive, which in turn get the module
   from it 'icInteractiveModule' field of the interactive context.

   The 'thisPackage' field stays as 'main' (or whatever -this-unit-id says.

 * The main trickiness is that the type environment (tcg_type_env) and
   fixity envt (tcg_fix_env), now contain entities from all the
   interactive-package modules (Ghci1, Ghci2, ...) together, rather
   than just a single module as is usually the case.  So you can't use
   &quot;nameIsLocalOrFrom&quot; to decide whether to look in the TcGblEnv vs
   the HPT/PTE.  This is a change, but not a problem provided you
   know.

* However, the tcg_binds, tcg_sigs, tcg_insts, tcg_fam_insts, etc fields
  of the TcGblEnv, which collect &quot;things defined in this module&quot;, all
  refer to stuff define in a single GHCi command, *not* all the commands
  so far.

  In contrast, tcg_inst_env, tcg_fam_inst_env, have instances from
  all GhciN modules, which makes sense -- they are all &quot;home package&quot;
  modules.


Note [Interactively-bound Ids in GHCi]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The Ids bound by previous Stmts in GHCi are currently
        a) GlobalIds, with
        b) An External Name, like Ghci4.foo
           See Note [The interactive package] above
        c) A tidied type

 (a) They must be GlobalIds (not LocalIds) otherwise when we come to
     compile an expression using these ids later, the byte code
     generator will consider the occurrences to be free rather than
     global.

 (b) Having an External Name is important because of Note
     [GlobalRdrEnv shadowing] in RdrName

 (c) Their types are tidied. This is important, because :info may ask
     to look at them, and :info expects the things it looks up to have
     tidy types

Where do interactively-bound Ids come from?

  - GHCi REPL Stmts   e.g.
         ghci&gt; let foo x = x+1
    These start with an Internal Name because a Stmt is a local
    construct, so the renamer naturally builds an Internal name for
    each of its binders.  Then in tcRnStmt they are externalised via
    TcRnDriver.externaliseAndTidyId, so they get Names like Ghic4.foo.

  - Ids bound by the debugger etc have Names constructed by
    IfaceEnv.newInteractiveBinder; at the call sites it is followed by
    mkVanillaGlobal or mkVanillaGlobalWithInfo.  So again, they are
    all Global, External.

  - TyCons, Classes, and Ids bound by other top-level declarations in
    GHCi (eg foreign import, record selectors) also get External
    Names, with Ghci9 (or 8, or 7, etc) as the module name.


Note [ic_tythings]
~~~~~~~~~~~~~~~~~~
The ic_tythings field contains
  * The TyThings declared by the user at the command prompt
    (eg Ids, TyCons, Classes)

  * The user-visible Ids that arise from such things, which
    *don't* come from 'implicitTyThings', notably:
       - record selectors
       - class ops
    The implicitTyThings are readily obtained from the TyThings
    but record selectors etc are not

It does *not* contain
  * DFunIds (they can be gotten from ic_instances)
  * CoAxioms (ditto)

See also Note [Interactively-bound Ids in GHCi]

Note [Override identical instances in GHCi]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If you declare a new instance in GHCi that is identical to a previous one,
we simply override the previous one; we don't regard it as overlapping.
e.g.    Prelude&gt; data T = A | B
        Prelude&gt; instance Eq T where ...
        Prelude&gt; instance Eq T where ...   -- This one overrides

It's exactly the same for type-family instances.  See Trac #7102
-}</span><span>
</span><a name="line-1537"></a><span>
</span><a name="line-1538"></a><span class="hs-comment">-- | Interactive context, recording information about the state of the</span><span>
</span><a name="line-1539"></a><span class="hs-comment">-- context in which statements are executed in a GHCi session.</span><span>
</span><a name="line-1540"></a><span class="hs-keyword">data</span><span> </span><a name="InteractiveContext"><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier">InteractiveContext</span></a></a><span>
</span><a name="line-1541"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="InteractiveContext"><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier">InteractiveContext</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1542"></a><span>         </span><a name="ic_dflags"><a href="HscTypes.html#ic_dflags"><span class="hs-identifier">ic_dflags</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-1543"></a><span>             </span><span class="hs-comment">-- ^ The 'DynFlags' used to evaluate interative expressions</span><span>
</span><a name="line-1544"></a><span>             </span><span class="hs-comment">-- and statements.</span><span>
</span><a name="line-1545"></a><span>
</span><a name="line-1546"></a><span>         </span><a name="ic_mod_index"><a href="HscTypes.html#ic_mod_index"><span class="hs-identifier">ic_mod_index</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>
</span><a name="line-1547"></a><span>             </span><span class="hs-comment">-- ^ Each GHCi stmt or declaration brings some new things into</span><span>
</span><a name="line-1548"></a><span>             </span><span class="hs-comment">-- scope. We give them names like interactive:Ghci9.T,</span><span>
</span><a name="line-1549"></a><span>             </span><span class="hs-comment">-- where the ic_index is the '9'.  The ic_mod_index is</span><span>
</span><a name="line-1550"></a><span>             </span><span class="hs-comment">-- incremented whenever we add something to ic_tythings</span><span>
</span><a name="line-1551"></a><span>             </span><span class="hs-comment">-- See Note [The interactive package]</span><span>
</span><a name="line-1552"></a><span>
</span><a name="line-1553"></a><span>         </span><a name="ic_imports"><a href="HscTypes.html#ic_imports"><span class="hs-identifier">ic_imports</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#InteractiveImport"><span class="hs-identifier hs-type">InteractiveImport</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1554"></a><span>             </span><span class="hs-comment">-- ^ The GHCi top-level scope (ic_rn_gbl_env) is extended with</span><span>
</span><a name="line-1555"></a><span>             </span><span class="hs-comment">-- these imports</span><span>
</span><a name="line-1556"></a><span>             </span><span class="hs-comment">--</span><span>
</span><a name="line-1557"></a><span>             </span><span class="hs-comment">-- This field is only stored here so that the client</span><span>
</span><a name="line-1558"></a><span>             </span><span class="hs-comment">-- can retrieve it with GHC.getContext. GHC itself doesn't</span><span>
</span><a name="line-1559"></a><span>             </span><span class="hs-comment">-- use it, but does reset it to empty sometimes (such</span><span>
</span><a name="line-1560"></a><span>             </span><span class="hs-comment">-- as before a GHC.load). The context is set with GHC.setContext.</span><span>
</span><a name="line-1561"></a><span>
</span><a name="line-1562"></a><span>         </span><a name="ic_tythings"><a href="HscTypes.html#ic_tythings"><span class="hs-identifier">ic_tythings</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1563"></a><span>             </span><span class="hs-comment">-- ^ TyThings defined by the user, in reverse order of</span><span>
</span><a name="line-1564"></a><span>             </span><span class="hs-comment">-- definition (ie most recent at the front)</span><span>
</span><a name="line-1565"></a><span>             </span><span class="hs-comment">-- See Note [ic_tythings]</span><span>
</span><a name="line-1566"></a><span>
</span><a name="line-1567"></a><span>         </span><a name="ic_rn_gbl_env"><a href="HscTypes.html#ic_rn_gbl_env"><span class="hs-identifier">ic_rn_gbl_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-1568"></a><span>             </span><span class="hs-comment">-- ^ The cached 'GlobalRdrEnv', built by</span><span>
</span><a name="line-1569"></a><span>             </span><span class="hs-comment">-- 'InteractiveEval.setContext' and updated regularly</span><span>
</span><a name="line-1570"></a><span>             </span><span class="hs-comment">-- It contains everything in scope at the command line,</span><span>
</span><a name="line-1571"></a><span>             </span><span class="hs-comment">-- including everything in ic_tythings</span><span>
</span><a name="line-1572"></a><span>
</span><a name="line-1573"></a><span>         </span><a name="ic_instances"><a href="HscTypes.html#ic_instances"><span class="hs-identifier">ic_instances</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1574"></a><span>             </span><span class="hs-comment">-- ^ All instances and family instances created during</span><span>
</span><a name="line-1575"></a><span>             </span><span class="hs-comment">-- this session.  These are grabbed en masse after each</span><span>
</span><a name="line-1576"></a><span>             </span><span class="hs-comment">-- update to be sure that proper overlapping is retained.</span><span>
</span><a name="line-1577"></a><span>             </span><span class="hs-comment">-- That is, rather than re-check the overlapping each</span><span>
</span><a name="line-1578"></a><span>             </span><span class="hs-comment">-- time we update the context, we just take the results</span><span>
</span><a name="line-1579"></a><span>             </span><span class="hs-comment">-- from the instance code that already does that.</span><span>
</span><a name="line-1580"></a><span>
</span><a name="line-1581"></a><span>         </span><a name="ic_fix_env"><a href="HscTypes.html#ic_fix_env"><span class="hs-identifier">ic_fix_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-1582"></a><span>            </span><span class="hs-comment">-- ^ Fixities declared in let statements</span><span>
</span><a name="line-1583"></a><span>
</span><a name="line-1584"></a><span>         </span><a name="ic_default"><a href="HscTypes.html#ic_default"><span class="hs-identifier">ic_default</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1585"></a><span>             </span><span class="hs-comment">-- ^ The current default types, set by a 'default' declaration</span><span>
</span><a name="line-1586"></a><span>
</span><a name="line-1587"></a><span>          </span><a name="ic_resume"><a href="HscTypes.html#ic_resume"><span class="hs-identifier">ic_resume</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="InteractiveEvalTypes.html#Resume"><span class="hs-identifier hs-type">Resume</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1588"></a><span>             </span><span class="hs-comment">-- ^ The stack of breakpoint contexts</span><span>
</span><a name="line-1589"></a><span>
</span><a name="line-1590"></a><span>         </span><a name="ic_monad"><a href="HscTypes.html#ic_monad"><span class="hs-identifier">ic_monad</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span>
</span><a name="line-1591"></a><span>             </span><span class="hs-comment">-- ^ The monad that GHCi is executing in</span><span>
</span><a name="line-1592"></a><span>
</span><a name="line-1593"></a><span>         </span><a name="ic_int_print"><a href="HscTypes.html#ic_int_print"><span class="hs-identifier">ic_int_print</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span>
</span><a name="line-1594"></a><span>             </span><span class="hs-comment">-- ^ The function that is used for printing results</span><span>
</span><a name="line-1595"></a><span>             </span><span class="hs-comment">-- of expressions in ghci and -e mode.</span><span>
</span><a name="line-1596"></a><span>
</span><a name="line-1597"></a><span>         </span><a name="ic_cwd"><a href="HscTypes.html#ic_cwd"><span class="hs-identifier">ic_cwd</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-1598"></a><span>             </span><span class="hs-comment">-- virtual CWD of the program</span><span>
</span><a name="line-1599"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1600"></a><span>
</span><a name="line-1601"></a><span class="hs-keyword">data</span><span> </span><a name="InteractiveImport"><a href="HscTypes.html#InteractiveImport"><span class="hs-identifier">InteractiveImport</span></a></a><span>
</span><a name="line-1602"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="IIDecl"><a href="HscTypes.html#IIDecl"><span class="hs-identifier">IIDecl</span></a></a><span> </span><span class="hs-special">(</span><a href="HsImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1603"></a><span>      </span><span class="hs-comment">-- ^ Bring the exports of a particular module</span><span>
</span><a name="line-1604"></a><span>      </span><span class="hs-comment">-- (filtered by an import decl) into scope</span><span>
</span><a name="line-1605"></a><span>
</span><a name="line-1606"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="IIModule"><a href="HscTypes.html#IIModule"><span class="hs-identifier">IIModule</span></a></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-1607"></a><span>      </span><span class="hs-comment">-- ^ Bring into scope the entire top-level envt of</span><span>
</span><a name="line-1608"></a><span>      </span><span class="hs-comment">-- of this module, including the things imported</span><span>
</span><a name="line-1609"></a><span>      </span><span class="hs-comment">-- into it.</span><span>
</span><a name="line-1610"></a><span>
</span><a name="line-1611"></a><span>
</span><a name="line-1612"></a><span class="hs-comment">-- | Constructs an empty InteractiveContext.</span><span>
</span><a name="line-1613"></a><span class="hs-identifier">emptyInteractiveContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span>
</span><a name="line-1614"></a><a name="emptyInteractiveContext"><a href="HscTypes.html#emptyInteractiveContext"><span class="hs-identifier">emptyInteractiveContext</span></a></a><span> </span><a name="local-6989586621684063291"><a href="#local-6989586621684063291"><span class="hs-identifier">dflags</span></a></a><span>
</span><a name="line-1615"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-var">InteractiveContext</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1616"></a><span>       </span><span class="hs-identifier">ic_dflags</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063291"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">,</span><span>
</span><a name="line-1617"></a><span>       </span><span class="hs-identifier">ic_imports</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1618"></a><span>       </span><span class="hs-identifier">ic_rn_gbl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-1619"></a><span>       </span><span class="hs-identifier">ic_mod_index</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span class="hs-special">,</span><span>
</span><a name="line-1620"></a><span>       </span><span class="hs-identifier">ic_tythings</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1621"></a><span>       </span><span class="hs-identifier">ic_instances</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1622"></a><span>       </span><span class="hs-identifier">ic_fix_env</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-1623"></a><span>       </span><span class="hs-identifier">ic_monad</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="PrelNames.html#ioTyConName"><span class="hs-identifier hs-var">ioTyConName</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- IO monad by default</span><span>
</span><a name="line-1624"></a><span>       </span><span class="hs-identifier">ic_int_print</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelNames.html#printName"><span class="hs-identifier hs-var">printName</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- System.IO.print by default</span><span>
</span><a name="line-1625"></a><span>       </span><span class="hs-identifier">ic_default</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span>
</span><a name="line-1626"></a><span>       </span><span class="hs-identifier">ic_resume</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1627"></a><span>       </span><span class="hs-identifier">ic_cwd</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1628"></a><span>
</span><a name="line-1629"></a><span class="hs-identifier">icInteractiveModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span>
</span><a name="line-1630"></a><a name="icInteractiveModule"><a href="HscTypes.html#icInteractiveModule"><span class="hs-identifier">icInteractiveModule</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-var">InteractiveContext</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_mod_index</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063292"><a href="#local-6989586621684063292"><span class="hs-identifier">index</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1631"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="PrelNames.html#mkInteractiveModule"><span class="hs-identifier hs-var">mkInteractiveModule</span></a><span> </span><a href="#local-6989586621684063292"><span class="hs-identifier hs-var">index</span></a><span>
</span><a name="line-1632"></a><span>
</span><a name="line-1633"></a><span class="hs-comment">-- | This function returns the list of visible TyThings (useful for</span><span>
</span><a name="line-1634"></a><span class="hs-comment">-- e.g. showBindings)</span><span>
</span><a name="line-1635"></a><span class="hs-identifier">icInScopeTTs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span>
</span><a name="line-1636"></a><a name="icInScopeTTs"><a href="HscTypes.html#icInScopeTTs"><span class="hs-identifier">icInScopeTTs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_tythings</span><span>
</span><a name="line-1637"></a><span>
</span><a name="line-1638"></a><span class="hs-comment">-- | Get the PrintUnqualified function based on the flags and this InteractiveContext</span><span>
</span><a name="line-1639"></a><span class="hs-identifier">icPrintUnqual</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span>
</span><a name="line-1640"></a><a name="icPrintUnqual"><a href="HscTypes.html#icPrintUnqual"><span class="hs-identifier">icPrintUnqual</span></a></a><span> </span><a name="local-6989586621684063293"><a href="#local-6989586621684063293"><span class="hs-identifier">dflags</span></a></a><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-var">InteractiveContext</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_rn_gbl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063294"><a href="#local-6989586621684063294"><span class="hs-identifier">grenv</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1641"></a><span>    </span><a href="HscTypes.html#mkPrintUnqualified"><span class="hs-identifier hs-var">mkPrintUnqualified</span></a><span> </span><a href="#local-6989586621684063293"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684063294"><span class="hs-identifier hs-var">grenv</span></a><span>
</span><a name="line-1642"></a><span>
</span><a name="line-1643"></a><span class="hs-comment">-- | extendInteractiveContext is called with new TyThings recently defined to update the</span><span>
</span><a name="line-1644"></a><span class="hs-comment">-- InteractiveContext to include them.  Ids are easily removed when shadowed,</span><span>
</span><a name="line-1645"></a><span class="hs-comment">-- but Classes and TyCons are not.  Some work could be done to determine</span><span>
</span><a name="line-1646"></a><span class="hs-comment">-- whether they are entirely shadowed, but as you could still have references</span><span>
</span><a name="line-1647"></a><span class="hs-comment">-- to them (e.g. instances for classes or values of the type for TyCons), it's</span><span>
</span><a name="line-1648"></a><span class="hs-comment">-- not clear whether removing them is even the appropriate behavior.</span><span>
</span><a name="line-1649"></a><span class="hs-identifier">extendInteractiveContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span>
</span><a name="line-1650"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span>
</span><a name="line-1651"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span class="hs-special">]</span><span>
</span><a name="line-1652"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span class="hs-special">]</span><span>
</span><a name="line-1653"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a><span>
</span><a name="line-1654"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span>
</span><a name="line-1655"></a><a name="extendInteractiveContext"><a href="HscTypes.html#extendInteractiveContext"><span class="hs-identifier">extendInteractiveContext</span></a></a><span> </span><a name="local-6989586621684063295"><a href="#local-6989586621684063295"><span class="hs-identifier">ictxt</span></a></a><span> </span><a name="local-6989586621684063296"><a href="#local-6989586621684063296"><span class="hs-identifier">new_tythings</span></a></a><span> </span><a name="local-6989586621684063297"><a href="#local-6989586621684063297"><span class="hs-identifier">new_cls_insts</span></a></a><span> </span><a name="local-6989586621684063298"><a href="#local-6989586621684063298"><span class="hs-identifier">new_fam_insts</span></a></a><span> </span><a name="local-6989586621684063299"><a href="#local-6989586621684063299"><span class="hs-identifier">defaults</span></a></a><span> </span><a name="local-6989586621684063300"><a href="#local-6989586621684063300"><span class="hs-identifier">fix_env</span></a></a><span>
</span><a name="line-1656"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063295"><span class="hs-identifier hs-var">ictxt</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_mod_index</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_mod_index</span><span> </span><a href="#local-6989586621684063295"><span class="hs-identifier hs-var">ictxt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1657"></a><span>                            </span><span class="hs-comment">-- Always bump this; even instances should create</span><span>
</span><a name="line-1658"></a><span>                            </span><span class="hs-comment">-- a new mod_index (Trac #9426)</span><span>
</span><a name="line-1659"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_tythings</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063296"><span class="hs-identifier hs-var">new_tythings</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684063302"><span class="hs-identifier hs-var">old_tythings</span></a><span>
</span><a name="line-1660"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_rn_gbl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_rn_gbl_env</span><span> </span><a href="#local-6989586621684063295"><span class="hs-identifier hs-var">ictxt</span></a><span> </span><span class="hs-special">`</span><a href="HscTypes.html#icExtendGblRdrEnv"><span class="hs-identifier hs-var">icExtendGblRdrEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684063296"><span class="hs-identifier hs-var">new_tythings</span></a><span>
</span><a name="line-1661"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_instances</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621684063297"><span class="hs-identifier hs-var">new_cls_insts</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684063305"><span class="hs-identifier hs-var">old_cls_insts</span></a><span>
</span><a name="line-1662"></a><span>                            </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684063298"><span class="hs-identifier hs-var">new_fam_insts</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684063304"><span class="hs-identifier hs-var">fam_insts</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1663"></a><span>                            </span><span class="hs-comment">-- we don't shadow old family instances (#7102),</span><span>
</span><a name="line-1664"></a><span>                            </span><span class="hs-comment">-- so don't need to remove them here</span><span>
</span><a name="line-1665"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_default</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063299"><span class="hs-identifier hs-var">defaults</span></a><span>
</span><a name="line-1666"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_fix_env</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063300"><span class="hs-identifier hs-var">fix_env</span></a><span>  </span><span class="hs-comment">-- See Note [Fixity declarations in GHCi]</span><span>
</span><a name="line-1667"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-1668"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1669"></a><span>    </span><a name="local-6989586621684063301"><a href="#local-6989586621684063301"><span class="hs-identifier">new_ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063306"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-6989586621684063306"><a href="#local-6989586621684063306"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063296"><span class="hs-identifier hs-var">new_tythings</span></a><span class="hs-special">]</span><span>
</span><a name="line-1670"></a><span>    </span><a name="local-6989586621684063302"><a href="#local-6989586621684063302"><span class="hs-identifier">old_tythings</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#shadowed_by"><span class="hs-identifier hs-var">shadowed_by</span></a><span> </span><a href="#local-6989586621684063301"><span class="hs-identifier hs-var">new_ids</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_tythings</span><span> </span><a href="#local-6989586621684063295"><span class="hs-identifier hs-var">ictxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1671"></a><span>
</span><a name="line-1672"></a><span>    </span><span class="hs-comment">-- Discard old instances that have been fully overridden</span><span>
</span><a name="line-1673"></a><span>    </span><span class="hs-comment">-- See Note [Override identical instances in GHCi]</span><span>
</span><a name="line-1674"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684063303"><a href="#local-6989586621684063303"><span class="hs-identifier">cls_insts</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684063304"><a href="#local-6989586621684063304"><span class="hs-identifier">fam_insts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_instances</span><span> </span><a href="#local-6989586621684063295"><span class="hs-identifier hs-var">ictxt</span></a><span>
</span><a name="line-1675"></a><span>    </span><a name="local-6989586621684063305"><a href="#local-6989586621684063305"><span class="hs-identifier">old_cls_insts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684063307"><a href="#local-6989586621684063307"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><a href="InstEnv.html#identicalClsInstHead"><span class="hs-identifier hs-var">identicalClsInstHead</span></a><span> </span><a href="#local-6989586621684063307"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063297"><span class="hs-identifier hs-var">new_cls_insts</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063303"><span class="hs-identifier hs-var">cls_insts</span></a><span>
</span><a name="line-1676"></a><span>
</span><a name="line-1677"></a><span class="hs-identifier">extendInteractiveContextWithIds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span>
</span><a name="line-1678"></a><span class="hs-comment">-- Just a specialised version</span><span>
</span><a name="line-1679"></a><a name="extendInteractiveContextWithIds"><a href="HscTypes.html#extendInteractiveContextWithIds"><span class="hs-identifier">extendInteractiveContextWithIds</span></a></a><span> </span><a name="local-6989586621684063308"><a href="#local-6989586621684063308"><span class="hs-identifier">ictxt</span></a></a><span> </span><a name="local-6989586621684063309"><a href="#local-6989586621684063309"><span class="hs-identifier">new_ids</span></a></a><span>
</span><a name="line-1680"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621684063309"><span class="hs-identifier hs-var">new_ids</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063308"><span class="hs-identifier hs-var">ictxt</span></a><span>
</span><a name="line-1681"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063308"><span class="hs-identifier hs-var">ictxt</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_mod_index</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_mod_index</span><span> </span><a href="#local-6989586621684063308"><span class="hs-identifier hs-var">ictxt</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1682"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_tythings</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063310"><span class="hs-identifier hs-var">new_tythings</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684063311"><span class="hs-identifier hs-var">old_tythings</span></a><span>
</span><a name="line-1683"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ic_rn_gbl_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ic_rn_gbl_env</span><span> </span><a href="#local-6989586621684063308"><span class="hs-identifier hs-var">ictxt</span></a><span> </span><span class="hs-special">`</span><a href="HscTypes.html#icExtendGblRdrEnv"><span class="hs-identifier hs-var">icExtendGblRdrEnv</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684063310"><span class="hs-identifier hs-var">new_tythings</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1684"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1685"></a><span>    </span><a name="local-6989586621684063310"><a href="#local-6989586621684063310"><span class="hs-identifier">new_tythings</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a href="#local-6989586621684063309"><span class="hs-identifier hs-var">new_ids</span></a><span>
</span><a name="line-1686"></a><span>    </span><a name="local-6989586621684063311"><a href="#local-6989586621684063311"><span class="hs-identifier">old_tythings</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Util.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#shadowed_by"><span class="hs-identifier hs-var">shadowed_by</span></a><span> </span><a href="#local-6989586621684063309"><span class="hs-identifier hs-var">new_ids</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ic_tythings</span><span> </span><a href="#local-6989586621684063308"><span class="hs-identifier hs-var">ictxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1687"></a><span>
</span><a name="line-1688"></a><span class="hs-identifier">shadowed_by</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1689"></a><a name="shadowed_by"><a href="HscTypes.html#shadowed_by"><span class="hs-identifier">shadowed_by</span></a></a><span> </span><a name="local-6989586621684063312"><a href="#local-6989586621684063312"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063313"><span class="hs-identifier hs-var">shadowed</span></a><span>
</span><a name="line-1690"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1691"></a><span>    </span><a name="local-6989586621684063313"><a href="#local-6989586621684063313"><span class="hs-identifier">shadowed</span></a></a><span> </span><a name="local-6989586621684063315"><a href="#local-6989586621684063315"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-6989586621684063315"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">`</span><a href="OccName.html#elemOccSet"><span class="hs-identifier hs-var">elemOccSet</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684063314"><span class="hs-identifier hs-var">new_occs</span></a><span>
</span><a name="line-1692"></a><span>    </span><a name="local-6989586621684063314"><a href="#local-6989586621684063314"><span class="hs-identifier">new_occs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkOccSet"><span class="hs-identifier hs-var">mkOccSet</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a><span> </span><a href="#local-6989586621684063312"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">)</span><span>
</span><a name="line-1693"></a><span>
</span><a name="line-1694"></a><span class="hs-identifier">setInteractivePackage</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span>
</span><a name="line-1695"></a><span class="hs-comment">-- Set the 'thisPackage' DynFlag to 'interactive'</span><span>
</span><a name="line-1696"></a><a name="setInteractivePackage"><a href="HscTypes.html#setInteractivePackage"><span class="hs-identifier">setInteractivePackage</span></a></a><span> </span><a name="local-6989586621684063316"><a href="#local-6989586621684063316"><span class="hs-identifier">hsc_env</span></a></a><span>
</span><a name="line-1697"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063316"><span class="hs-identifier hs-var">hsc_env</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621684063316"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1698"></a><span>                </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">thisInstalledUnitId</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#toInstalledUnitId"><span class="hs-identifier hs-var">toInstalledUnitId</span></a><span> </span><a href="Module.html#interactiveUnitId"><span class="hs-identifier hs-var">interactiveUnitId</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1699"></a><span>
</span><a name="line-1700"></a><span class="hs-identifier">setInteractivePrintName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span>
</span><a name="line-1701"></a><a name="setInteractivePrintName"><a href="HscTypes.html#setInteractivePrintName"><span class="hs-identifier">setInteractivePrintName</span></a></a><span> </span><a name="local-6989586621684063317"><a href="#local-6989586621684063317"><span class="hs-identifier">ic</span></a></a><span> </span><a name="local-6989586621684063318"><a href="#local-6989586621684063318"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063317"><span class="hs-identifier hs-var">ic</span></a><span class="hs-special">{</span><span class="hs-identifier">ic_int_print</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063318"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">}</span><span>
</span><a name="line-1702"></a><span>
</span><a name="line-1703"></a><span>    </span><span class="hs-comment">-- ToDo: should not add Ids to the gbl env here</span><span>
</span><a name="line-1704"></a><span>
</span><a name="line-1705"></a><span class="hs-comment">-- | Add TyThings to the GlobalRdrEnv, earlier ones in the list shadowing</span><span>
</span><a name="line-1706"></a><span class="hs-comment">-- later ones, and shadowing existing entries in the GlobalRdrEnv.</span><span>
</span><a name="line-1707"></a><span class="hs-identifier">icExtendGblRdrEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span>
</span><a name="line-1708"></a><a name="icExtendGblRdrEnv"><a href="HscTypes.html#icExtendGblRdrEnv"><span class="hs-identifier">icExtendGblRdrEnv</span></a></a><span> </span><a name="local-6989586621684063319"><a href="#local-6989586621684063319"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621684063320"><a href="#local-6989586621684063320"><span class="hs-identifier">tythings</span></a></a><span>
</span><a name="line-1709"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="#local-6989586621684063321"><span class="hs-identifier hs-var">add</span></a><span> </span><a href="#local-6989586621684063319"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621684063320"><span class="hs-identifier hs-var">tythings</span></a><span>  </span><span class="hs-comment">-- Foldr makes things in the front of</span><span>
</span><a name="line-1710"></a><span>                            </span><span class="hs-comment">-- the list shadow things at the back</span><span>
</span><a name="line-1711"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1712"></a><span>    </span><span class="hs-comment">-- One at a time, to ensure each shadows the previous ones</span><span>
</span><a name="line-1713"></a><span>    </span><a name="local-6989586621684063321"><a href="#local-6989586621684063321"><span class="hs-identifier">add</span></a></a><span> </span><a name="local-6989586621684063323"><a href="#local-6989586621684063323"><span class="hs-identifier">thing</span></a></a><span> </span><a name="local-6989586621684063324"><a href="#local-6989586621684063324"><span class="hs-identifier">env</span></a></a><span>
</span><a name="line-1714"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684063322"><span class="hs-identifier hs-var">is_sub_bndr</span></a><span> </span><a href="#local-6989586621684063323"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1715"></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063324"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-1716"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1717"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="RdrName.html#extendGlobalRdrEnv"><span class="hs-identifier hs-var">extendGlobalRdrEnv</span></a><span> </span><a href="#local-6989586621684063325"><span class="hs-identifier hs-var">env1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="RdrName.html#localGREsFromAvail"><span class="hs-identifier hs-var">localGREsFromAvail</span></a><span> </span><a href="#local-6989586621684063326"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span>
</span><a name="line-1718"></a><span>       </span><span class="hs-keyword">where</span><span>
</span><a name="line-1719"></a><span>          </span><a name="local-6989586621684063325"><a href="#local-6989586621684063325"><span class="hs-identifier">env1</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#shadowNames"><span class="hs-identifier hs-var">shadowNames</span></a><span> </span><a href="#local-6989586621684063324"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="Avail.html#availNames"><span class="hs-identifier hs-var">availNames</span></a><span> </span><a href="#local-6989586621684063326"><span class="hs-identifier hs-var">avail</span></a><span class="hs-special">)</span><span>
</span><a name="line-1720"></a><span>          </span><a name="local-6989586621684063326"><a href="#local-6989586621684063326"><span class="hs-identifier">avail</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#tyThingAvailInfo"><span class="hs-identifier hs-var">tyThingAvailInfo</span></a><span> </span><a href="#local-6989586621684063323"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-1721"></a><span>
</span><a name="line-1722"></a><span>    </span><span class="hs-comment">-- Ugh! The new_tythings may include record selectors, since they</span><span>
</span><a name="line-1723"></a><span>    </span><span class="hs-comment">-- are not implicit-ids, and must appear in the TypeEnv.  But they</span><span>
</span><a name="line-1724"></a><span>    </span><span class="hs-comment">-- will also be brought into scope by the corresponding (ATyCon</span><span>
</span><a name="line-1725"></a><span>    </span><span class="hs-comment">-- tc).  And we want the latter, because that has the correct</span><span>
</span><a name="line-1726"></a><span>    </span><span class="hs-comment">-- parent (Trac #10520)</span><span>
</span><a name="line-1727"></a><span>    </span><a name="local-6989586621684063322"><a href="#local-6989586621684063322"><span class="hs-identifier">is_sub_bndr</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-6989586621684063327"><a href="#local-6989586621684063327"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a><span> </span><a href="#local-6989586621684063327"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1728"></a><span>                             </span><a href="IdInfo.html#RecSelId"><span class="hs-identifier hs-var">RecSelId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1729"></a><span>                             </span><a href="IdInfo.html#ClassOpId"><span class="hs-identifier hs-var">ClassOpId</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1730"></a><span>                             </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1731"></a><span>    </span><span class="hs-identifier">is_sub_bndr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1732"></a><span>
</span><a name="line-1733"></a><span class="hs-identifier">substInteractiveContext</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a><span>
</span><a name="line-1734"></a><a name="substInteractiveContext"><a href="HscTypes.html#substInteractiveContext"><span class="hs-identifier">substInteractiveContext</span></a></a><span> </span><a name="local-6989586621684063328"><a href="#local-6989586621684063328"><span class="hs-identifier">ictxt</span></a></a><span class="hs-glyph">@</span><a href="HscTypes.html#InteractiveContext"><span class="hs-identifier hs-var">InteractiveContext</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_tythings</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063329"><a href="#local-6989586621684063329"><span class="hs-identifier">tts</span></a></a><span> </span><span class="hs-special">}</span><span> </span><a name="local-6989586621684063330"><a href="#local-6989586621684063330"><span class="hs-identifier">subst</span></a></a><span>
</span><a name="line-1735"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#isEmptyTCvSubst"><span class="hs-identifier hs-var">isEmptyTCvSubst</span></a><span> </span><a href="#local-6989586621684063330"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063328"><span class="hs-identifier hs-var">ictxt</span></a><span>
</span><a name="line-1736"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063328"><span class="hs-identifier hs-var">ictxt</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ic_tythings</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621684063331"><span class="hs-identifier hs-var">subst_ty</span></a><span> </span><a href="#local-6989586621684063329"><span class="hs-identifier hs-var">tts</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1737"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1738"></a><span>    </span><a name="local-6989586621684063331"><a href="#local-6989586621684063331"><span class="hs-identifier">subst_ty</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-6989586621684063332"><a href="#local-6989586621684063332"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1739"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684063332"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">`</span><a href="Id.html#setIdType"><span class="hs-identifier hs-var">setIdType</span></a><span class="hs-special">`</span><span> </span><a href="TyCoRep.html#substTyAddInScope"><span class="hs-identifier hs-var">substTyAddInScope</span></a><span> </span><a href="#local-6989586621684063330"><span class="hs-identifier hs-var">subst</span></a><span> </span><span class="hs-special">(</span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684063332"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-1740"></a><span>      </span><span class="hs-comment">-- Variables in the interactive context *can* mention free type variables</span><span>
</span><a name="line-1741"></a><span>      </span><span class="hs-comment">-- because of the runtime debugger. Otherwise you'd expect all</span><span>
</span><a name="line-1742"></a><span>      </span><span class="hs-comment">-- variables bound in the interactive context to be closed.</span><span>
</span><a name="line-1743"></a><span>    </span><span class="hs-identifier">subst_ty</span><span> </span><a name="local-6989586621684063333"><a href="#local-6989586621684063333"><span class="hs-identifier">tt</span></a></a><span>
</span><a name="line-1744"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063333"><span class="hs-identifier hs-var">tt</span></a><span>
</span><a name="line-1745"></a><span>
</span><a name="line-1746"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="HscTypes.html#InteractiveImport"><span class="hs-identifier hs-type">InteractiveImport</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1747"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#IIModule"><span class="hs-identifier hs-var">IIModule</span></a><span> </span><a name="local-6989586621684063079"><a href="#local-6989586621684063079"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'*'</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063079"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-1748"></a><span>  </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#IIDecl"><span class="hs-identifier hs-var">IIDecl</span></a><span> </span><a name="local-6989586621684063080"><a href="#local-6989586621684063080"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063080"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-1749"></a><span>
</span><a name="line-1750"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Building a PrintUnqualified
*                                                                      *
************************************************************************

Note [Printing original names]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Deciding how to print names is pretty tricky.  We are given a name
P:M.T, where P is the package name, M is the defining module, and T is
the occurrence name, and we have to decide in which form to display
the name given a GlobalRdrEnv describing the current scope.

Ideally we want to display the name in the form in which it is in
scope.  However, the name might not be in scope at all, and that's
where it gets tricky.  Here are the cases:

 1. T uniquely maps to  P:M.T      ---&gt;  &quot;T&quot;      NameUnqual
 2. There is an X for which X.T
       uniquely maps to  P:M.T     ---&gt;  &quot;X.T&quot;    NameQual X
 3. There is no binding for &quot;M.T&quot;  ---&gt;  &quot;M.T&quot;    NameNotInScope1
 4. Otherwise                      ---&gt;  &quot;P:M.T&quot;  NameNotInScope2

(3) and (4) apply when the entity P:M.T is not in the GlobalRdrEnv at
all. In these cases we still want to refer to the name as &quot;M.T&quot;, *but*
&quot;M.T&quot; might mean something else in the current scope (e.g. if there's
an &quot;import X as M&quot;), so to avoid confusion we avoid using &quot;M.T&quot; if
there's already a binding for it.  Instead we write P:M.T.

There's one further subtlety: in case (3), what if there are two
things around, P1:M.T and P2:M.T?  Then we don't want to print both of
them as M.T!  However only one of the modules P1:M and P2:M can be
exposed (say P2), so we use M.T for that, and P1:M.T for the other one.
This is handled by the qual_mod component of PrintUnqualified, inside
the (ppr mod) of case (3), in Name.pprModulePrefix

Note [Printing unit ids]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In the old days, original names were tied to PackageIds, which directly
corresponded to the entities that users wrote in Cabal files, and were perfectly
suitable for printing when we need to disambiguate packages.  However, with
UnitId, the situation can be different: if the key is instantiated with
some holes, we should try to give the user some more useful information.
-}</span><span>
</span><a name="line-1795"></a><span>
</span><a name="line-1796"></a><span class="hs-comment">-- | Creates some functions that work out the best ways to format</span><span>
</span><a name="line-1797"></a><span class="hs-comment">-- names for the user according to a set of heuristics.</span><span>
</span><a name="line-1798"></a><span class="hs-identifier">mkPrintUnqualified</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RdrName.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span>
</span><a name="line-1799"></a><a name="mkPrintUnqualified"><a href="HscTypes.html#mkPrintUnqualified"><span class="hs-identifier">mkPrintUnqualified</span></a></a><span> </span><a name="local-6989586621684063334"><a href="#local-6989586621684063334"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684063335"><a href="#local-6989586621684063335"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#QueryQualify"><span class="hs-identifier hs-var">QueryQualify</span></a><span> </span><a href="#local-6989586621684063336"><span class="hs-identifier hs-var">qual_name</span></a><span>
</span><a name="line-1800"></a><span>                                             </span><span class="hs-special">(</span><a href="HscTypes.html#mkQualModule"><span class="hs-identifier hs-var">mkQualModule</span></a><span> </span><a href="#local-6989586621684063334"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1801"></a><span>                                             </span><span class="hs-special">(</span><a href="HscTypes.html#mkQualPackage"><span class="hs-identifier hs-var">mkQualPackage</span></a><span> </span><a href="#local-6989586621684063334"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1802"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1803"></a><span>  </span><a name="local-6989586621684063336"><a href="#local-6989586621684063336"><span class="hs-identifier">qual_name</span></a></a><span> </span><a name="local-6989586621684063337"><a href="#local-6989586621684063337"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621684063338"><a href="#local-6989586621684063338"><span class="hs-identifier">occ</span></a></a><span>
</span><a name="line-1804"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684063346"><a href="#local-6989586621684063346"><span class="hs-identifier">gre</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063342"><span class="hs-identifier hs-var">unqual_gres</span></a><span>
</span><a name="line-1805"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684063341"><span class="hs-identifier hs-var">right_name</span></a><span> </span><a href="#local-6989586621684063346"><span class="hs-identifier hs-var">gre</span></a><span>
</span><a name="line-1806"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#NameUnqual"><span class="hs-identifier hs-var">NameUnqual</span></a><span>   </span><span class="hs-comment">-- If there's a unique entity that's in scope</span><span>
</span><a name="line-1807"></a><span>                       </span><span class="hs-comment">-- unqualified with 'occ' AND that entity is</span><span>
</span><a name="line-1808"></a><span>                       </span><span class="hs-comment">-- the right one, then we can use the unqualified name</span><span>
</span><a name="line-1809"></a><span>
</span><a name="line-1810"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063342"><span class="hs-identifier hs-var">unqual_gres</span></a><span>
</span><a name="line-1811"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="#local-6989586621684063339"><span class="hs-identifier hs-var">is_name</span></a><span> </span><a href="#local-6989586621684063340"><span class="hs-identifier hs-var">forceUnqualNames</span></a><span>
</span><a name="line-1812"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="OccName.html#isDerivedOccName"><span class="hs-identifier hs-var">isDerivedOccName</span></a><span> </span><a href="#local-6989586621684063338"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-1813"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#NameUnqual"><span class="hs-identifier hs-var">NameUnqual</span></a><span>   </span><span class="hs-comment">-- Don't qualify names that come from modules</span><span>
</span><a name="line-1814"></a><span>                       </span><span class="hs-comment">-- that come with GHC, often appear in error messages,</span><span>
</span><a name="line-1815"></a><span>                       </span><span class="hs-comment">-- but aren't typically in scope. Doing this does not</span><span>
</span><a name="line-1816"></a><span>                       </span><span class="hs-comment">-- cause ambiguity, and it reduces the amount of</span><span>
</span><a name="line-1817"></a><span>                       </span><span class="hs-comment">-- qualification in error messages thus improving</span><span>
</span><a name="line-1818"></a><span>                       </span><span class="hs-comment">-- readability.</span><span>
</span><a name="line-1819"></a><span>                       </span><span class="hs-comment">--</span><span>
</span><a name="line-1820"></a><span>                       </span><span class="hs-comment">-- A motivating example is 'Constraint'. It's often not</span><span>
</span><a name="line-1821"></a><span>                       </span><span class="hs-comment">-- in scope, but printing GHC.Prim.Constraint seems</span><span>
</span><a name="line-1822"></a><span>                       </span><span class="hs-comment">-- overkill.</span><span>
</span><a name="line-1823"></a><span>
</span><a name="line-1824"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684063347"><a href="#local-6989586621684063347"><span class="hs-identifier">gre</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063343"><span class="hs-identifier hs-var">qual_gres</span></a><span>
</span><a name="line-1825"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#NameQual"><span class="hs-identifier hs-var">NameQual</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#greQualModName"><span class="hs-identifier hs-var">greQualModName</span></a><span> </span><a href="#local-6989586621684063347"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span>
</span><a name="line-1826"></a><span>
</span><a name="line-1827"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621684063343"><span class="hs-identifier hs-var">qual_gres</span></a><span>
</span><a name="line-1828"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><a href="RdrName.html#lookupGRE_RdrName"><span class="hs-identifier hs-var">lookupGRE_RdrName</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#mkRdrQual"><span class="hs-identifier hs-var">mkRdrQual</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621684063337"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063338"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063335"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-1829"></a><span>          </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#NameNotInScope1"><span class="hs-identifier hs-var">NameNotInScope1</span></a><span>
</span><a name="line-1830"></a><span>          </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#NameNotInScope2"><span class="hs-identifier hs-var">NameNotInScope2</span></a><span>
</span><a name="line-1831"></a><span>
</span><a name="line-1832"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1833"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#NameNotInScope1"><span class="hs-identifier hs-var">NameNotInScope1</span></a><span>   </span><span class="hs-comment">-- Can happen if 'f' is bound twice in the module</span><span>
</span><a name="line-1834"></a><span>                            </span><span class="hs-comment">-- Eg  f = True; g = 0; f = False</span><span>
</span><a name="line-1835"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1836"></a><span>        </span><span class="hs-identifier">is_name</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1837"></a><span>        </span><a name="local-6989586621684063339"><a href="#local-6989586621684063339"><span class="hs-identifier">is_name</span></a></a><span> </span><a name="local-6989586621684063344"><a href="#local-6989586621684063344"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1838"></a><span>                       </span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a><span> </span><a href="#local-6989586621684063344"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684063337"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a><span> </span><a href="#local-6989586621684063344"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684063338"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-1839"></a><span>
</span><a name="line-1840"></a><span>        </span><span class="hs-identifier">forceUnqualNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-1841"></a><span>        </span><a name="local-6989586621684063340"><a href="#local-6989586621684063340"><span class="hs-identifier">forceUnqualNames</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1842"></a><span>          </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><span class="hs-special">[</span><span> </span><a href="TysWiredIn.html#constraintKindTyCon"><span class="hs-identifier hs-var">constraintKindTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#heqTyCon"><span class="hs-identifier hs-var">heqTyCon</span></a><span class="hs-special">,</span><span> </span><a href="TysWiredIn.html#coercibleTyCon"><span class="hs-identifier hs-var">coercibleTyCon</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1843"></a><span>          </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span> </span><a href="TysWiredIn.html#eqTyConName"><span class="hs-identifier hs-var">eqTyConName</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1844"></a><span>
</span><a name="line-1845"></a><span>        </span><a name="local-6989586621684063341"><a href="#local-6989586621684063341"><span class="hs-identifier">right_name</span></a></a><span> </span><a name="local-6989586621684063345"><a href="#local-6989586621684063345"><span class="hs-identifier">gre</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#nameModule_maybe"><span class="hs-identifier hs-var">nameModule_maybe</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gre_name</span><span> </span><a href="#local-6989586621684063345"><span class="hs-identifier hs-var">gre</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684063337"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-1846"></a><span>
</span><a name="line-1847"></a><span>        </span><a name="local-6989586621684063342"><a href="#local-6989586621684063342"><span class="hs-identifier">unqual_gres</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RdrName.html#lookupGRE_RdrName"><span class="hs-identifier hs-var">lookupGRE_RdrName</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#mkRdrUnqual"><span class="hs-identifier hs-var">mkRdrUnqual</span></a><span> </span><a href="#local-6989586621684063338"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063335"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-1848"></a><span>        </span><a name="local-6989586621684063343"><a href="#local-6989586621684063343"><span class="hs-identifier">qual_gres</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><a href="#local-6989586621684063341"><span class="hs-identifier hs-var">right_name</span></a><span> </span><span class="hs-special">(</span><a href="RdrName.html#lookupGlobalRdrEnv"><span class="hs-identifier hs-var">lookupGlobalRdrEnv</span></a><span> </span><a href="#local-6989586621684063335"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621684063338"><span class="hs-identifier hs-var">occ</span></a><span class="hs-special">)</span><span>
</span><a name="line-1849"></a><span>
</span><a name="line-1850"></a><span>    </span><span class="hs-comment">-- we can mention a module P:M without the P: qualifier iff</span><span>
</span><a name="line-1851"></a><span>    </span><span class="hs-comment">-- &quot;import M&quot; would resolve unambiguously to P:M.  (if P is the</span><span>
</span><a name="line-1852"></a><span>    </span><span class="hs-comment">-- current package we can just assume it is unqualified).</span><span>
</span><a name="line-1853"></a><span>
</span><a name="line-1854"></a><span class="hs-comment">-- | Creates a function for formatting modules based on two heuristics:</span><span>
</span><a name="line-1855"></a><span class="hs-comment">-- (1) if the module is the current module, don't qualify, and (2) if there</span><span>
</span><a name="line-1856"></a><span class="hs-comment">-- is only one exposed package which exports this module, don't qualify.</span><span>
</span><a name="line-1857"></a><span class="hs-identifier">mkQualModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#QueryQualifyModule"><span class="hs-identifier hs-type">QueryQualifyModule</span></a><span>
</span><a name="line-1858"></a><a name="mkQualModule"><a href="HscTypes.html#mkQualModule"><span class="hs-identifier">mkQualModule</span></a></a><span> </span><a name="local-6989586621684063348"><a href="#local-6989586621684063348"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684063349"><a href="#local-6989586621684063349"><span class="hs-identifier">mod</span></a></a><span>
</span><a name="line-1859"></a><span>     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-6989586621684063349"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="DynFlags.html#thisPackage"><span class="hs-identifier hs-var">thisPackage</span></a><span> </span><a href="#local-6989586621684063348"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1860"></a><span>
</span><a name="line-1861"></a><span>     </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684063351"><a href="#local-6989586621684063351"><span class="hs-identifier">pkgconfig</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063350"><span class="hs-identifier hs-var">lookup</span></a><span class="hs-special">,</span><span>
</span><a name="line-1862"></a><span>       </span><a href="PackageConfig.html#packageConfigId"><span class="hs-identifier hs-var">packageConfigId</span></a><span> </span><a href="#local-6989586621684063351"><span class="hs-identifier hs-var">pkgconfig</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">moduleUnitId</span><span> </span><a href="#local-6989586621684063349"><span class="hs-identifier hs-var">mod</span></a><span>
</span><a name="line-1863"></a><span>        </span><span class="hs-comment">-- this says: we are given a module P:M, is there just one exposed package</span><span>
</span><a name="line-1864"></a><span>        </span><span class="hs-comment">-- that exposes a module M, and is it package P?</span><span>
</span><a name="line-1865"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1866"></a><span>
</span><a name="line-1867"></a><span>     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1868"></a><span>     </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684063350"><a href="#local-6989586621684063350"><span class="hs-identifier">lookup</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Packages.html#lookupModuleInAllPackages"><span class="hs-identifier hs-var">lookupModuleInAllPackages</span></a><span> </span><a href="#local-6989586621684063348"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><a href="#local-6989586621684063349"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-1869"></a><span>
</span><a name="line-1870"></a><span class="hs-comment">-- | Creates a function for formatting packages based on two heuristics:</span><span>
</span><a name="line-1871"></a><span class="hs-comment">-- (1) don't qualify if the package in question is &quot;main&quot;, and (2) only qualify</span><span>
</span><a name="line-1872"></a><span class="hs-comment">-- with a unit id if the package ID would be ambiguous.</span><span>
</span><a name="line-1873"></a><span class="hs-identifier">mkQualPackage</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#QueryQualifyPackage"><span class="hs-identifier hs-type">QueryQualifyPackage</span></a><span>
</span><a name="line-1874"></a><a name="mkQualPackage"><a href="HscTypes.html#mkQualPackage"><span class="hs-identifier">mkQualPackage</span></a></a><span> </span><a name="local-6989586621684063352"><a href="#local-6989586621684063352"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684063353"><a href="#local-6989586621684063353"><span class="hs-identifier">pkg_key</span></a></a><span>
</span><a name="line-1875"></a><span>     </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684063353"><span class="hs-identifier hs-var">pkg_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Module.html#mainUnitId"><span class="hs-identifier hs-var">mainUnitId</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684063353"><span class="hs-identifier hs-var">pkg_key</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Module.html#interactiveUnitId"><span class="hs-identifier hs-var">interactiveUnitId</span></a><span>
</span><a name="line-1876"></a><span>        </span><span class="hs-comment">-- Skip the lookup if it's main, since it won't be in the package</span><span>
</span><a name="line-1877"></a><span>        </span><span class="hs-comment">-- database!</span><span>
</span><a name="line-1878"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1879"></a><span>     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063355"><a href="#local-6989586621684063355"><span class="hs-identifier">pkgid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063354"><span class="hs-identifier hs-var">mb_pkgid</span></a><span>
</span><a name="line-1880"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Packages.html#searchPackageId"><span class="hs-identifier hs-var">searchPackageId</span></a><span> </span><a href="#local-6989586621684063352"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684063355"><span class="hs-identifier hs-var">pkgid</span></a><span> </span><span class="hs-special">`</span><a href="Util.html#lengthIs"><span class="hs-identifier hs-var">lengthIs</span></a><span class="hs-special">`</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-1881"></a><span>        </span><span class="hs-comment">-- this says: we are given a package pkg-0.1@MMM, are there only one</span><span>
</span><a name="line-1882"></a><span>        </span><span class="hs-comment">-- exposed packages whose package ID is pkg-0.1?</span><span>
</span><a name="line-1883"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1884"></a><span>     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1885"></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1886"></a><span>     </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684063354"><a href="#local-6989586621684063354"><span class="hs-identifier">mb_pkgid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">sourcePackageId</span><span> </span><span class="hs-special">(</span><a href="Packages.html#lookupPackage"><span class="hs-identifier hs-var">lookupPackage</span></a><span> </span><a href="#local-6989586621684063352"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684063353"><span class="hs-identifier hs-var">pkg_key</span></a><span class="hs-special">)</span><span>
</span><a name="line-1887"></a><span>
</span><a name="line-1888"></a><span class="hs-comment">-- | A function which only qualifies package names if necessary; but</span><span>
</span><a name="line-1889"></a><span class="hs-comment">-- qualifies all other identifiers.</span><span>
</span><a name="line-1890"></a><span class="hs-identifier">pkgQual</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a><span>
</span><a name="line-1891"></a><a name="pkgQual"><a href="HscTypes.html#pkgQual"><span class="hs-identifier">pkgQual</span></a></a><span> </span><a name="local-6989586621684063356"><a href="#local-6989586621684063356"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#alwaysQualify"><span class="hs-identifier hs-var">alwaysQualify</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1892"></a><span>        </span><span class="hs-identifier">queryQualifyPackage</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#mkQualPackage"><span class="hs-identifier hs-var">mkQualPackage</span></a><span> </span><a href="#local-6989586621684063356"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1893"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1894"></a><span>
</span><a name="line-1895"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Implicit TyThings
*                                                                      *
************************************************************************

Note [Implicit TyThings]
~~~~~~~~~~~~~~~~~~~~~~~~
  DEFINITION: An &quot;implicit&quot; TyThing is one that does not have its own
  IfaceDecl in an interface file.  Instead, its binding in the type
  environment is created as part of typechecking the IfaceDecl for
  some other thing.

Examples:
  * All DataCons are implicit, because they are generated from the
    IfaceDecl for the data/newtype.  Ditto class methods.

  * Record selectors are *not* implicit, because they get their own
    free-standing IfaceDecl.

  * Associated data/type families are implicit because they are
    included in the IfaceDecl of the parent class.  (NB: the
    IfaceClass decl happens to use IfaceDecl recursively for the
    associated types, but that's irrelevant here.)

  * Dictionary function Ids are not implicit.

  * Axioms for newtypes are implicit (same as above), but axioms
    for data/type family instances are *not* implicit (like DFunIds).
-}</span><span>
</span><a name="line-1926"></a><span>
</span><a name="line-1927"></a><span class="hs-comment">-- | Determine the 'TyThing's brought into scope by another 'TyThing'</span><span>
</span><a name="line-1928"></a><span class="hs-comment">-- /other/ than itself. For example, Id's don't have any implicit TyThings</span><span>
</span><a name="line-1929"></a><span class="hs-comment">-- as they just bring themselves into scope, but classes bring their</span><span>
</span><a name="line-1930"></a><span class="hs-comment">-- dictionary datatype, type constructor and some selector functions into</span><span>
</span><a name="line-1931"></a><span class="hs-comment">-- scope, just for a start!</span><span>
</span><a name="line-1932"></a><span>
</span><a name="line-1933"></a><span class="hs-comment">-- N.B. the set of TyThings returned here *must* match the set of</span><span>
</span><a name="line-1934"></a><span class="hs-comment">-- names returned by LoadIface.ifaceDeclImplicitBndrs, in the sense that</span><span>
</span><a name="line-1935"></a><span class="hs-comment">-- TyThing.getOccName should define a bijection between the two lists.</span><span>
</span><a name="line-1936"></a><span class="hs-comment">-- This invariant is used in LoadIface.loadDecl (see note [Tricky iface loop])</span><span>
</span><a name="line-1937"></a><span class="hs-comment">-- The order of the list does not matter.</span><span>
</span><a name="line-1938"></a><span class="hs-identifier">implicitTyThings</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span>
</span><a name="line-1939"></a><a name="implicitTyThings"><a href="HscTypes.html#implicitTyThings"><span class="hs-identifier">implicitTyThings</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1940"></a><span class="hs-identifier">implicitTyThings</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">ACoAxiom</span></a><span> </span><a name="local-6989586621684063357"><a href="#local-6989586621684063357"><span class="hs-identifier">_cc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1941"></a><span class="hs-identifier">implicitTyThings</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-6989586621684063358"><a href="#local-6989586621684063358"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#implicitTyConThings"><span class="hs-identifier hs-var">implicitTyConThings</span></a><span> </span><a href="#local-6989586621684063358"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1942"></a><span class="hs-identifier">implicitTyThings</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><a name="local-6989586621684063359"><a href="#local-6989586621684063359"><span class="hs-identifier">cl</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#implicitConLikeThings"><span class="hs-identifier hs-var">implicitConLikeThings</span></a><span> </span><a href="#local-6989586621684063359"><span class="hs-identifier hs-var">cl</span></a><span>
</span><a name="line-1943"></a><span>
</span><a name="line-1944"></a><span class="hs-identifier">implicitConLikeThings</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span>
</span><a name="line-1945"></a><a name="implicitConLikeThings"><a href="HscTypes.html#implicitConLikeThings"><span class="hs-identifier">implicitConLikeThings</span></a></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-6989586621684063360"><a href="#local-6989586621684063360"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1946"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConImplicitTyThings"><span class="hs-identifier hs-var">dataConImplicitTyThings</span></a><span> </span><a href="#local-6989586621684063360"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-1947"></a><span>
</span><a name="line-1948"></a><span class="hs-identifier">implicitConLikeThings</span><span> </span><span class="hs-special">(</span><a href="ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1949"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Pattern synonyms have no implicit Ids; the wrapper and matcher</span><span>
</span><a name="line-1950"></a><span>        </span><span class="hs-comment">-- are not &quot;implicit&quot;; they are simply new top-level bindings,</span><span>
</span><a name="line-1951"></a><span>        </span><span class="hs-comment">-- and they have their own declaration in an interface file</span><span>
</span><a name="line-1952"></a><span>        </span><span class="hs-comment">-- Unless a record pat syn when there are implicit selectors</span><span>
</span><a name="line-1953"></a><span>        </span><span class="hs-comment">-- They are still not included here as `implicitConLikeThings` is</span><span>
</span><a name="line-1954"></a><span>        </span><span class="hs-comment">-- used by `tcTyClsDecls` whilst pattern synonyms are typed checked</span><span>
</span><a name="line-1955"></a><span>        </span><span class="hs-comment">-- by `tcTopValBinds`.</span><span>
</span><a name="line-1956"></a><span>
</span><a name="line-1957"></a><span class="hs-identifier">implicitClassThings</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span>
</span><a name="line-1958"></a><a name="implicitClassThings"><a href="HscTypes.html#implicitClassThings"><span class="hs-identifier">implicitClassThings</span></a></a><span> </span><a name="local-6989586621684063361"><a href="#local-6989586621684063361"><span class="hs-identifier">cl</span></a></a><span>
</span><a name="line-1959"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Does not include default methods, because those Ids may have</span><span>
</span><a name="line-1960"></a><span>    </span><span class="hs-comment">--    their own pragmas, unfoldings etc, not derived from the Class object</span><span>
</span><a name="line-1961"></a><span>
</span><a name="line-1962"></a><span>    </span><span class="hs-comment">-- associated types</span><span>
</span><a name="line-1963"></a><span>    </span><span class="hs-comment">--    No recursive call for the classATs, because they</span><span>
</span><a name="line-1964"></a><span>    </span><span class="hs-comment">--    are only the family decls; they have no implicit things</span><span>
</span><a name="line-1965"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><span class="hs-special">(</span><a href="Class.html#classATs"><span class="hs-identifier hs-var">classATs</span></a><span> </span><a href="#local-6989586621684063361"><span class="hs-identifier hs-var">cl</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-1966"></a><span>
</span><a name="line-1967"></a><span>    </span><span class="hs-comment">-- superclass and operation selectors</span><span>
</span><a name="line-1968"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><span class="hs-special">(</span><a href="Class.html#classAllSelIds"><span class="hs-identifier hs-var">classAllSelIds</span></a><span> </span><a href="#local-6989586621684063361"><span class="hs-identifier hs-var">cl</span></a><span class="hs-special">)</span><span>
</span><a name="line-1969"></a><span>
</span><a name="line-1970"></a><span class="hs-identifier">implicitTyConThings</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span>
</span><a name="line-1971"></a><a name="implicitTyConThings"><a href="HscTypes.html#implicitTyConThings"><span class="hs-identifier">implicitTyConThings</span></a></a><span> </span><a name="local-6989586621684063362"><a href="#local-6989586621684063362"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-1972"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063363"><span class="hs-identifier hs-var">class_stuff</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-1973"></a><span>      </span><span class="hs-comment">-- fields (names of selectors)</span><span>
</span><a name="line-1974"></a><span>
</span><a name="line-1975"></a><span>      </span><span class="hs-comment">-- (possibly) implicit newtype axioms</span><span>
</span><a name="line-1976"></a><span>      </span><span class="hs-comment">-- or type family axioms</span><span>
</span><a name="line-1977"></a><span>    </span><a href="HscTypes.html#implicitCoTyCon"><span class="hs-identifier hs-var">implicitCoTyCon</span></a><span> </span><a href="#local-6989586621684063362"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-1978"></a><span>
</span><a name="line-1979"></a><span>      </span><span class="hs-comment">-- for each data constructor in order,</span><span>
</span><a name="line-1980"></a><span>      </span><span class="hs-comment">--   the constructor, worker, and (possibly) wrapper</span><span>
</span><a name="line-1981"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621684063366"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621684063365"><a href="#local-6989586621684063365"><span class="hs-identifier">dc</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-6989586621684063362"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1982"></a><span>            </span><span class="hs-special">,</span><span> </span><a name="local-6989586621684063366"><a href="#local-6989586621684063366"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a href="#local-6989586621684063365"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="DataCon.html#dataConImplicitTyThings"><span class="hs-identifier hs-var">dataConImplicitTyThings</span></a><span> </span><a href="#local-6989586621684063365"><span class="hs-identifier hs-var">dc</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1983"></a><span>      </span><span class="hs-comment">-- NB. record selectors are *not* implicit, they have fully-fledged</span><span>
</span><a name="line-1984"></a><span>      </span><span class="hs-comment">-- bindings that pass through the compilation pipeline as normal.</span><span>
</span><a name="line-1985"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1986"></a><span>    </span><a name="local-6989586621684063363"><a href="#local-6989586621684063363"><span class="hs-identifier">class_stuff</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-6989586621684063362"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1987"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1988"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063364"><a href="#local-6989586621684063364"><span class="hs-identifier">cl</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#implicitClassThings"><span class="hs-identifier hs-var">implicitClassThings</span></a><span> </span><a href="#local-6989586621684063364"><span class="hs-identifier hs-var">cl</span></a><span>
</span><a name="line-1989"></a><span>
</span><a name="line-1990"></a><span class="hs-comment">-- For newtypes and closed type families (only) add the implicit coercion tycon</span><span>
</span><a name="line-1991"></a><span class="hs-identifier">implicitCoTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span>
</span><a name="line-1992"></a><a name="implicitCoTyCon"><a href="HscTypes.html#implicitCoTyCon"><span class="hs-identifier">implicitCoTyCon</span></a></a><span> </span><a name="local-6989586621684063367"><a href="#local-6989586621684063367"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-1993"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063368"><a href="#local-6989586621684063368"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#newTyConCo_maybe"><span class="hs-identifier hs-var">newTyConCo_maybe</span></a><span> </span><a href="#local-6989586621684063367"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">ACoAxiom</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CoAxiom.html#toBranchedAxiom"><span class="hs-identifier hs-var">toBranchedAxiom</span></a><span> </span><a href="#local-6989586621684063368"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">]</span><span>
</span><a name="line-1994"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063369"><a href="#local-6989586621684063369"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TyCon.html#isClosedSynFamilyTyConWithAxiom_maybe"><span class="hs-identifier hs-var">isClosedSynFamilyTyConWithAxiom_maybe</span></a><span> </span><a href="#local-6989586621684063367"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-1995"></a><span>                                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">ACoAxiom</span></a><span> </span><a href="#local-6989586621684063369"><span class="hs-identifier hs-var">co</span></a><span class="hs-special">]</span><span>
</span><a name="line-1996"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1997"></a><span>
</span><a name="line-1998"></a><span class="hs-comment">-- | Returns @True@ if there should be no interface-file declaration</span><span>
</span><a name="line-1999"></a><span class="hs-comment">-- for this thing on its own: either it is built-in, or it is part</span><span>
</span><a name="line-2000"></a><span class="hs-comment">-- of some other declaration, or it is generated implicitly by some</span><span>
</span><a name="line-2001"></a><span class="hs-comment">-- other declaration.</span><span>
</span><a name="line-2002"></a><span class="hs-identifier">isImplicitTyThing</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2003"></a><a name="isImplicitTyThing"><a href="HscTypes.html#isImplicitTyThing"><span class="hs-identifier">isImplicitTyThing</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><a name="local-6989586621684063370"><a href="#local-6989586621684063370"><span class="hs-identifier">cl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684063370"><span class="hs-identifier hs-var">cl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2004"></a><span>                                    </span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2005"></a><span>                                    </span><a href="ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2006"></a><span class="hs-identifier">isImplicitTyThing</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-6989586621684063371"><a href="#local-6989586621684063371"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Id.html#isImplicitId"><span class="hs-identifier hs-var">isImplicitId</span></a><span> </span><a href="#local-6989586621684063371"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-2007"></a><span class="hs-identifier">isImplicitTyThing</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-6989586621684063372"><a href="#local-6989586621684063372"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#isImplicitTyCon"><span class="hs-identifier hs-var">isImplicitTyCon</span></a><span> </span><a href="#local-6989586621684063372"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2008"></a><span class="hs-identifier">isImplicitTyThing</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">ACoAxiom</span></a><span> </span><a name="local-6989586621684063373"><a href="#local-6989586621684063373"><span class="hs-identifier">ax</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CoAxiom.html#isImplicitCoAxiom"><span class="hs-identifier hs-var">isImplicitCoAxiom</span></a><span> </span><a href="#local-6989586621684063373"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-2009"></a><span>
</span><a name="line-2010"></a><span class="hs-comment">-- | tyThingParent_maybe x returns (Just p)</span><span>
</span><a name="line-2011"></a><span class="hs-comment">-- when pprTyThingInContext should print a declaration for p</span><span>
</span><a name="line-2012"></a><span class="hs-comment">-- (albeit with some &quot;...&quot; in it) when asked to show x</span><span>
</span><a name="line-2013"></a><span class="hs-comment">-- It returns the *immediate* parent.  So a datacon returns its tycon</span><span>
</span><a name="line-2014"></a><span class="hs-comment">-- but the tycon could be the associated type of a class, so it in turn</span><span>
</span><a name="line-2015"></a><span class="hs-comment">-- might have a parent.</span><span>
</span><a name="line-2016"></a><span class="hs-identifier">tyThingParent_maybe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span>
</span><a name="line-2017"></a><a name="tyThingParent_maybe"><a href="HscTypes.html#tyThingParent_maybe"><span class="hs-identifier">tyThingParent_maybe</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><a name="local-6989586621684063374"><a href="#local-6989586621684063374"><span class="hs-identifier">cl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684063374"><span class="hs-identifier hs-var">cl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2018"></a><span>    </span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-6989586621684063375"><a href="#local-6989586621684063375"><span class="hs-identifier">dc</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><span class="hs-special">(</span><a href="DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a><span> </span><a href="#local-6989586621684063375"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2019"></a><span>    </span><a href="ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2020"></a><span class="hs-identifier">tyThingParent_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-6989586621684063376"><a href="#local-6989586621684063376"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TyCon.html#tyConAssoc_maybe"><span class="hs-identifier hs-var">tyConAssoc_maybe</span></a><span> </span><a href="#local-6989586621684063376"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2021"></a><span>                                      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063377"><a href="#local-6989586621684063377"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a href="#local-6989586621684063377"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2022"></a><span>                                      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2023"></a><span class="hs-identifier">tyThingParent_maybe</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-6989586621684063378"><a href="#local-6989586621684063378"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a><span> </span><a href="#local-6989586621684063378"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2024"></a><span>                                      </span><a href="IdInfo.html#RecSelId"><span class="hs-identifier hs-var">RecSelId</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">sel_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="IdInfo.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a><span> </span><a name="local-6989586621684063379"><a href="#local-6989586621684063379"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2025"></a><span>                                          </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a href="#local-6989586621684063379"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-2026"></a><span>                                      </span><a href="IdInfo.html#ClassOpId"><span class="hs-identifier hs-var">ClassOpId</span></a><span> </span><a name="local-6989586621684063380"><a href="#local-6989586621684063380"><span class="hs-identifier">cls</span></a></a><span>               </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2027"></a><span>                                          </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">classTyCon</span><span> </span><a href="#local-6989586621684063380"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2028"></a><span>                                      </span><a name="local-6989586621684063381"><a href="#local-6989586621684063381"><span class="hs-identifier">_other</span></a></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2029"></a><span class="hs-identifier">tyThingParent_maybe</span><span> </span><a name="local-6989586621684063382"><a href="#local-6989586621684063382"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2030"></a><span>
</span><a name="line-2031"></a><span class="hs-identifier">tyThingsTyCoVars</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a><span>
</span><a name="line-2032"></a><a name="tyThingsTyCoVars"><a href="HscTypes.html#tyThingsTyCoVars"><span class="hs-identifier">tyThingsTyCoVars</span></a></a><span> </span><a name="local-6989586621684063383"><a href="#local-6989586621684063383"><span class="hs-identifier">tts</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2033"></a><span>    </span><a href="VarSet.html#unionVarSets"><span class="hs-identifier hs-var">unionVarSets</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621684063384"><span class="hs-identifier hs-var">ttToVarSet</span></a><span> </span><a href="#local-6989586621684063383"><span class="hs-identifier hs-var">tts</span></a><span>
</span><a name="line-2034"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-2035"></a><span>        </span><a name="local-6989586621684063384"><a href="#local-6989586621684063384"><span class="hs-identifier">ttToVarSet</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-6989586621684063385"><a href="#local-6989586621684063385"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Id.html#idType"><span class="hs-identifier hs-var">idType</span></a><span> </span><a href="#local-6989586621684063385"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-2036"></a><span>        </span><span class="hs-identifier">ttToVarSet</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><a name="local-6989586621684063386"><a href="#local-6989586621684063386"><span class="hs-identifier">cl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684063386"><span class="hs-identifier hs-var">cl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2037"></a><span>            </span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-6989586621684063387"><a href="#local-6989586621684063387"><span class="hs-identifier">dc</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="DataCon.html#dataConRepType"><span class="hs-identifier hs-var">dataConRepType</span></a><span> </span><a href="#local-6989586621684063387"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-2038"></a><span>            </span><a href="ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-2039"></a><span>        </span><span class="hs-identifier">ttToVarSet</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-6989586621684063388"><a href="#local-6989586621684063388"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2040"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-6989586621684063388"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2041"></a><span>              </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063389"><a href="#local-6989586621684063389"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="VarSet.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Class.html#classTvsFds"><span class="hs-identifier hs-var">classTvsFds</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063389"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-2042"></a><span>              </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">tyConKind</span><span> </span><a href="#local-6989586621684063388"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2043"></a><span>        </span><span class="hs-identifier">ttToVarSet</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">ACoAxiom</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="VarSet.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a><span>
</span><a name="line-2044"></a><span>
</span><a name="line-2045"></a><span class="hs-comment">-- | The Names that a TyThing should bring into scope.  Used to build</span><span>
</span><a name="line-2046"></a><span class="hs-comment">-- the GlobalRdrEnv for the InteractiveContext.</span><span>
</span><a name="line-2047"></a><span class="hs-identifier">tyThingAvailInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailInfo"><span class="hs-identifier hs-type">AvailInfo</span></a><span class="hs-special">]</span><span>
</span><a name="line-2048"></a><a name="tyThingAvailInfo"><a href="HscTypes.html#tyThingAvailInfo"><span class="hs-identifier">tyThingAvailInfo</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-6989586621684063390"><a href="#local-6989586621684063390"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2049"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-6989586621684063390"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2050"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063391"><a href="#local-6989586621684063391"><span class="hs-identifier">c</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621684063392"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063392"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><span class="hs-special">(</span><a href="Class.html#classMethods"><span class="hs-identifier hs-var">classMethods</span></a><span> </span><a href="#local-6989586621684063391"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-2051"></a><span>                                 </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><span class="hs-special">(</span><a href="Class.html#classATs"><span class="hs-identifier hs-var">classATs</span></a><span> </span><a href="#local-6989586621684063391"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2052"></a><span>                             </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-2053"></a><span>             </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684063392"><a href="#local-6989586621684063392"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-6989586621684063391"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-2054"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Avail.html#AvailTC"><span class="hs-identifier hs-var">AvailTC</span></a><span> </span><a href="#local-6989586621684063393"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063393"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-6989586621684063394"><span class="hs-identifier hs-var">dcs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063395"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">]</span><span>
</span><a name="line-2055"></a><span>             </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684063393"><a href="#local-6989586621684063393"><span class="hs-identifier">n</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-6989586621684063390"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-2056"></a><span>                   </span><a name="local-6989586621684063394"><a href="#local-6989586621684063394"><span class="hs-identifier">dcs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a><span> </span><a href="#local-6989586621684063390"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-2057"></a><span>                   </span><a name="local-6989586621684063395"><a href="#local-6989586621684063395"><span class="hs-identifier">flds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TyCon.html#tyConFieldLabels"><span class="hs-identifier hs-var">tyConFieldLabels</span></a><span> </span><a href="#local-6989586621684063390"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-2058"></a><span class="hs-identifier">tyThingAvailInfo</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a><span> </span><a name="local-6989586621684063396"><a href="#local-6989586621684063396"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2059"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="Avail.html#avail"><span class="hs-identifier hs-var">avail</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-6989586621684063396"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">flSelector</span><span> </span><span class="hs-special">(</span><a href="PatSyn.html#patSynFieldLabels"><span class="hs-identifier hs-var">patSynFieldLabels</span></a><span> </span><a href="#local-6989586621684063396"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2060"></a><span class="hs-identifier">tyThingAvailInfo</span><span> </span><a name="local-6989586621684063397"><a href="#local-6989586621684063397"><span class="hs-identifier">t</span></a></a><span>
</span><a name="line-2061"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="Avail.html#avail"><span class="hs-identifier hs-var">avail</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-6989586621684063397"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2062"></a><span>
</span><a name="line-2063"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                TypeEnv
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2070"></a><span>
</span><a name="line-2071"></a><span class="hs-comment">-- | A map from 'Name's to 'TyThing's, constructed by typechecking</span><span>
</span><a name="line-2072"></a><span class="hs-comment">-- local declarations or interface files</span><span>
</span><a name="line-2073"></a><span class="hs-keyword">type</span><span> </span><a name="TypeEnv"><a href="HscTypes.html#TypeEnv"><span class="hs-identifier">TypeEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span>
</span><a name="line-2074"></a><span>
</span><a name="line-2075"></a><span class="hs-identifier">emptyTypeEnv</span><span>    </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span>
</span><a name="line-2076"></a><span class="hs-identifier">typeEnvElts</span><span>     </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span>
</span><a name="line-2077"></a><span class="hs-identifier">typeEnvTyCons</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">]</span><span>
</span><a name="line-2078"></a><span class="hs-identifier">typeEnvCoAxioms</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="CoAxiom.html#Branched"><span class="hs-identifier hs-type">Branched</span></a><span class="hs-special">]</span><span>
</span><a name="line-2079"></a><span class="hs-identifier">typeEnvIds</span><span>      </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span>
</span><a name="line-2080"></a><span class="hs-identifier">typeEnvPatSyns</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="PatSyn.html#PatSyn"><span class="hs-identifier hs-type">PatSyn</span></a><span class="hs-special">]</span><span>
</span><a name="line-2081"></a><span class="hs-identifier">typeEnvDataCons</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span class="hs-special">]</span><span>
</span><a name="line-2082"></a><span class="hs-identifier">typeEnvClasses</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Class.html#Class"><span class="hs-identifier hs-type">Class</span></a><span class="hs-special">]</span><span>
</span><a name="line-2083"></a><span class="hs-identifier">lookupTypeEnv</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span>
</span><a name="line-2084"></a><span>
</span><a name="line-2085"></a><a name="emptyTypeEnv"><a href="HscTypes.html#emptyTypeEnv"><span class="hs-identifier">emptyTypeEnv</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span>
</span><a name="line-2086"></a><a name="typeEnvElts"><a href="HscTypes.html#typeEnvElts"><span class="hs-identifier">typeEnvElts</span></a></a><span>     </span><a name="local-6989586621684063398"><a href="#local-6989586621684063398"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#nameEnvElts"><span class="hs-identifier hs-var">nameEnvElts</span></a><span> </span><a href="#local-6989586621684063398"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-2087"></a><a name="typeEnvTyCons"><a href="HscTypes.html#typeEnvTyCons"><span class="hs-identifier">typeEnvTyCons</span></a></a><span>   </span><a name="local-6989586621684063399"><a href="#local-6989586621684063399"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063400"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-6989586621684063400"><a href="#local-6989586621684063400"><span class="hs-identifier">tc</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#typeEnvElts"><span class="hs-identifier hs-var">typeEnvElts</span></a><span> </span><a href="#local-6989586621684063399"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">]</span><span>
</span><a name="line-2088"></a><a name="typeEnvCoAxioms"><a href="HscTypes.html#typeEnvCoAxioms"><span class="hs-identifier">typeEnvCoAxioms</span></a></a><span> </span><a name="local-6989586621684063401"><a href="#local-6989586621684063401"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063402"><span class="hs-identifier hs-var">ax</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">ACoAxiom</span></a><span> </span><a name="local-6989586621684063402"><a href="#local-6989586621684063402"><span class="hs-identifier">ax</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#typeEnvElts"><span class="hs-identifier hs-var">typeEnvElts</span></a><span> </span><a href="#local-6989586621684063401"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">]</span><span>
</span><a name="line-2089"></a><a name="typeEnvIds"><a href="HscTypes.html#typeEnvIds"><span class="hs-identifier">typeEnvIds</span></a></a><span>      </span><a name="local-6989586621684063403"><a href="#local-6989586621684063403"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063404"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-6989586621684063404"><a href="#local-6989586621684063404"><span class="hs-identifier">id</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#typeEnvElts"><span class="hs-identifier hs-var">typeEnvElts</span></a><span> </span><a href="#local-6989586621684063403"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">]</span><span>
</span><a name="line-2090"></a><a name="typeEnvPatSyns"><a href="HscTypes.html#typeEnvPatSyns"><span class="hs-identifier">typeEnvPatSyns</span></a></a><span>  </span><a name="local-6989586621684063405"><a href="#local-6989586621684063405"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063406"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a><span> </span><a name="local-6989586621684063406"><a href="#local-6989586621684063406"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#typeEnvElts"><span class="hs-identifier hs-var">typeEnvElts</span></a><span> </span><a href="#local-6989586621684063405"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">]</span><span>
</span><a name="line-2091"></a><a name="typeEnvDataCons"><a href="HscTypes.html#typeEnvDataCons"><span class="hs-identifier">typeEnvDataCons</span></a></a><span> </span><a name="local-6989586621684063407"><a href="#local-6989586621684063407"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063408"><span class="hs-identifier hs-var">dc</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-6989586621684063408"><a href="#local-6989586621684063408"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#typeEnvElts"><span class="hs-identifier hs-var">typeEnvElts</span></a><span> </span><a href="#local-6989586621684063407"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">]</span><span>
</span><a name="line-2092"></a><a name="typeEnvClasses"><a href="HscTypes.html#typeEnvClasses"><span class="hs-identifier">typeEnvClasses</span></a></a><span>  </span><a name="local-6989586621684063409"><a href="#local-6989586621684063409"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063411"><span class="hs-identifier hs-var">cl</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621684063410"><a href="#local-6989586621684063410"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HscTypes.html#typeEnvTyCons"><span class="hs-identifier hs-var">typeEnvTyCons</span></a><span> </span><a href="#local-6989586621684063409"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span>
</span><a name="line-2093"></a><span>                            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063411"><a href="#local-6989586621684063411"><span class="hs-identifier">cl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a><span> </span><a href="#local-6989586621684063410"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-2094"></a><span>
</span><a name="line-2095"></a><span class="hs-identifier">mkTypeEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span>
</span><a name="line-2096"></a><a name="mkTypeEnv"><a href="HscTypes.html#mkTypeEnv"><span class="hs-identifier">mkTypeEnv</span></a></a><span> </span><a name="local-6989586621684063412"><a href="#local-6989586621684063412"><span class="hs-identifier">things</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#extendTypeEnvList"><span class="hs-identifier hs-var">extendTypeEnvList</span></a><span> </span><a href="HscTypes.html#emptyTypeEnv"><span class="hs-identifier hs-var">emptyTypeEnv</span></a><span> </span><a href="#local-6989586621684063412"><span class="hs-identifier hs-var">things</span></a><span>
</span><a name="line-2097"></a><span>
</span><a name="line-2098"></a><span class="hs-identifier">mkTypeEnvWithImplicits</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span>
</span><a name="line-2099"></a><a name="mkTypeEnvWithImplicits"><a href="HscTypes.html#mkTypeEnvWithImplicits"><span class="hs-identifier">mkTypeEnvWithImplicits</span></a></a><span> </span><a name="local-6989586621684063413"><a href="#local-6989586621684063413"><span class="hs-identifier">things</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2100"></a><span>  </span><a href="HscTypes.html#mkTypeEnv"><span class="hs-identifier hs-var">mkTypeEnv</span></a><span> </span><a href="#local-6989586621684063413"><span class="hs-identifier hs-var">things</span></a><span>
</span><a name="line-2101"></a><span>    </span><span class="hs-special">`</span><a href="NameEnv.html#plusNameEnv"><span class="hs-identifier hs-var">plusNameEnv</span></a><span class="hs-special">`</span><span>
</span><a name="line-2102"></a><span>  </span><a href="HscTypes.html#mkTypeEnv"><span class="hs-identifier hs-var">mkTypeEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="HscTypes.html#implicitTyThings"><span class="hs-identifier hs-var">implicitTyThings</span></a><span> </span><a href="#local-6989586621684063413"><span class="hs-identifier hs-var">things</span></a><span class="hs-special">)</span><span>
</span><a name="line-2103"></a><span>
</span><a name="line-2104"></a><span class="hs-identifier">typeEnvFromEntities</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span>
</span><a name="line-2105"></a><a name="typeEnvFromEntities"><a href="HscTypes.html#typeEnvFromEntities"><span class="hs-identifier">typeEnvFromEntities</span></a></a><span> </span><a name="local-6989586621684063414"><a href="#local-6989586621684063414"><span class="hs-identifier">ids</span></a></a><span> </span><a name="local-6989586621684063415"><a href="#local-6989586621684063415"><span class="hs-identifier">tcs</span></a></a><span> </span><a name="local-6989586621684063416"><a href="#local-6989586621684063416"><span class="hs-identifier">famInsts</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2106"></a><span>  </span><a href="HscTypes.html#mkTypeEnv"><span class="hs-identifier hs-var">mkTypeEnv</span></a><span> </span><span class="hs-special">(</span><span>   </span><span class="hs-identifier hs-var">map</span><span> </span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a href="#local-6989586621684063414"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-2107"></a><span>             </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a href="#local-6989586621684063417"><span class="hs-identifier hs-var">all_tcs</span></a><span>
</span><a name="line-2108"></a><span>             </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="HscTypes.html#implicitTyConThings"><span class="hs-identifier hs-var">implicitTyConThings</span></a><span> </span><a href="#local-6989586621684063417"><span class="hs-identifier hs-var">all_tcs</span></a><span>
</span><a name="line-2109"></a><span>             </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">ACoAxiom</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="CoAxiom.html#toBranchedAxiom"><span class="hs-identifier hs-var">toBranchedAxiom</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="FamInstEnv.html#famInstAxiom"><span class="hs-identifier hs-var">famInstAxiom</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063416"><span class="hs-identifier hs-var">famInsts</span></a><span>
</span><a name="line-2110"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-2111"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2112"></a><span>  </span><a name="local-6989586621684063417"><a href="#local-6989586621684063417"><span class="hs-identifier">all_tcs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063415"><span class="hs-identifier hs-var">tcs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="FamInstEnv.html#famInstsRepTyCons"><span class="hs-identifier hs-var">famInstsRepTyCons</span></a><span> </span><a href="#local-6989586621684063416"><span class="hs-identifier hs-var">famInsts</span></a><span>
</span><a name="line-2113"></a><span>
</span><a name="line-2114"></a><a name="lookupTypeEnv"><a href="HscTypes.html#lookupTypeEnv"><span class="hs-identifier">lookupTypeEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span>
</span><a name="line-2115"></a><span>
</span><a name="line-2116"></a><span class="hs-comment">-- Extend the type environment</span><span>
</span><a name="line-2117"></a><span class="hs-identifier">extendTypeEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span>
</span><a name="line-2118"></a><a name="extendTypeEnv"><a href="HscTypes.html#extendTypeEnv"><span class="hs-identifier">extendTypeEnv</span></a></a><span> </span><a name="local-6989586621684063418"><a href="#local-6989586621684063418"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621684063419"><a href="#local-6989586621684063419"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#extendNameEnv"><span class="hs-identifier hs-var">extendNameEnv</span></a><span> </span><a href="#local-6989586621684063418"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-6989586621684063419"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063419"><span class="hs-identifier hs-var">thing</span></a><span>
</span><a name="line-2119"></a><span>
</span><a name="line-2120"></a><span class="hs-identifier">extendTypeEnvList</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span>
</span><a name="line-2121"></a><a name="extendTypeEnvList"><a href="HscTypes.html#extendTypeEnvList"><span class="hs-identifier">extendTypeEnvList</span></a></a><span> </span><a name="local-6989586621684063420"><a href="#local-6989586621684063420"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621684063421"><a href="#local-6989586621684063421"><span class="hs-identifier">things</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="HscTypes.html#extendTypeEnv"><span class="hs-identifier hs-var">extendTypeEnv</span></a><span> </span><a href="#local-6989586621684063420"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621684063421"><span class="hs-identifier hs-var">things</span></a><span>
</span><a name="line-2122"></a><span>
</span><a name="line-2123"></a><span class="hs-identifier">extendTypeEnvWithIds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span>
</span><a name="line-2124"></a><a name="extendTypeEnvWithIds"><a href="HscTypes.html#extendTypeEnvWithIds"><span class="hs-identifier">extendTypeEnvWithIds</span></a></a><span> </span><a name="local-6989586621684063422"><a href="#local-6989586621684063422"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621684063423"><a href="#local-6989586621684063423"><span class="hs-identifier">ids</span></a></a><span>
</span><a name="line-2125"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#extendNameEnvList"><span class="hs-identifier hs-var">extendNameEnvList</span></a><span> </span><a href="#local-6989586621684063422"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Name.html#getName"><span class="hs-identifier hs-var">getName</span></a><span> </span><a href="#local-6989586621684063424"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span> </span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a href="#local-6989586621684063424"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621684063424"><a href="#local-6989586621684063424"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684063423"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">]</span><span>
</span><a name="line-2126"></a><span>
</span><a name="line-2127"></a><span class="hs-identifier">plusTypeEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span>
</span><a name="line-2128"></a><a name="plusTypeEnv"><a href="HscTypes.html#plusTypeEnv"><span class="hs-identifier">plusTypeEnv</span></a></a><span> </span><a name="local-6989586621684063425"><a href="#local-6989586621684063425"><span class="hs-identifier">env1</span></a></a><span> </span><a name="local-6989586621684063426"><a href="#local-6989586621684063426"><span class="hs-identifier">env2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#plusNameEnv"><span class="hs-identifier hs-var">plusNameEnv</span></a><span> </span><a href="#local-6989586621684063425"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621684063426"><span class="hs-identifier hs-var">env2</span></a><span>
</span><a name="line-2129"></a><span>
</span><a name="line-2130"></a><span class="hs-comment">-- | Find the 'TyThing' for the given 'Name' by using all the resources</span><span>
</span><a name="line-2131"></a><span class="hs-comment">-- at our disposal: the compiled modules in the 'HomePackageTable' and the</span><span>
</span><a name="line-2132"></a><span class="hs-comment">-- compiled modules in other packages that live in 'PackageTypeEnv'. Note</span><span>
</span><a name="line-2133"></a><span class="hs-comment">-- that this does NOT look up the 'TyThing' in the module being compiled: you</span><span>
</span><a name="line-2134"></a><span class="hs-comment">-- have to do that yourself, if desired</span><span>
</span><a name="line-2135"></a><span class="hs-identifier">lookupType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span>
</span><a name="line-2136"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a><span>
</span><a name="line-2137"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#PackageTypeEnv"><span class="hs-identifier hs-type">PackageTypeEnv</span></a><span>
</span><a name="line-2138"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-2139"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span>
</span><a name="line-2140"></a><span>
</span><a name="line-2141"></a><a name="lookupType"><a href="HscTypes.html#lookupType"><span class="hs-identifier">lookupType</span></a></a><span> </span><a name="local-6989586621684063427"><a href="#local-6989586621684063427"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684063428"><a href="#local-6989586621684063428"><span class="hs-identifier">hpt</span></a></a><span> </span><a name="local-6989586621684063429"><a href="#local-6989586621684063429"><span class="hs-identifier">pte</span></a></a><span> </span><a name="local-6989586621684063430"><a href="#local-6989586621684063430"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-2142"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="DynFlags.html#isOneShot"><span class="hs-identifier hs-var">isOneShot</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ghcMode</span><span> </span><a href="#local-6989586621684063427"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- in one-shot, we don't use the HPT</span><span>
</span><a name="line-2143"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-6989586621684063429"><span class="hs-identifier hs-var">pte</span></a><span> </span><a href="#local-6989586621684063430"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-2144"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2145"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="HscTypes.html#lookupHptByModule"><span class="hs-identifier hs-var">lookupHptByModule</span></a><span> </span><a href="#local-6989586621684063428"><span class="hs-identifier hs-var">hpt</span></a><span> </span><a href="#local-6989586621684063431"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2146"></a><span>       </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684063432"><a href="#local-6989586621684063432"><span class="hs-identifier">hm</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">md_types</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hm_details</span><span> </span><a href="#local-6989586621684063432"><span class="hs-identifier hs-var">hm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063430"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-2147"></a><span>       </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-6989586621684063429"><span class="hs-identifier hs-var">pte</span></a><span> </span><a href="#local-6989586621684063430"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-2148"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2149"></a><span>    </span><a name="local-6989586621684063431"><a href="#local-6989586621684063431"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="Name.html#isExternalName"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2150"></a><span>          </span><span class="hs-keyword">if</span><span> </span><a href="Name.html#isHoleName"><span class="hs-identifier hs-var">isHoleName</span></a><span> </span><a href="#local-6989586621684063430"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-2151"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="Module.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#thisPackage"><span class="hs-identifier hs-var">thisPackage</span></a><span> </span><a href="#local-6989586621684063427"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">moduleName</span><span> </span><span class="hs-special">(</span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a><span> </span><a href="#local-6989586621684063430"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2152"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="Name.html#nameModule"><span class="hs-identifier hs-var">nameModule</span></a><span> </span><a href="#local-6989586621684063430"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-2153"></a><span>
</span><a name="line-2154"></a><span class="hs-comment">-- | As 'lookupType', but with a marginally easier-to-use interface</span><span>
</span><a name="line-2155"></a><span class="hs-comment">-- if you have a 'HscEnv'</span><span>
</span><a name="line-2156"></a><span class="hs-identifier">lookupTypeHscEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span class="hs-special">)</span><span>
</span><a name="line-2157"></a><a name="lookupTypeHscEnv"><a href="HscTypes.html#lookupTypeHscEnv"><span class="hs-identifier">lookupTypeHscEnv</span></a></a><span> </span><a name="local-6989586621684063433"><a href="#local-6989586621684063433"><span class="hs-identifier">hsc_env</span></a></a><span> </span><a name="local-6989586621684063434"><a href="#local-6989586621684063434"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2158"></a><span>    </span><a name="local-6989586621684063437"><a href="#local-6989586621684063437"><span class="hs-identifier">eps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readIORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsc_EPS</span><span> </span><a href="#local-6989586621684063433"><span class="hs-identifier hs-var">hsc_env</span></a><span class="hs-special">)</span><span>
</span><a name="line-2159"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="HscTypes.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a><span> </span><a href="#local-6989586621684063435"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684063436"><span class="hs-identifier hs-var">hpt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">eps_PTE</span><span> </span><a href="#local-6989586621684063437"><span class="hs-identifier hs-var">eps</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063434"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-2160"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2161"></a><span>    </span><a name="local-6989586621684063435"><a href="#local-6989586621684063435"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_dflags</span><span> </span><a href="#local-6989586621684063433"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-2162"></a><span>    </span><a name="local-6989586621684063436"><a href="#local-6989586621684063436"><span class="hs-identifier">hpt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hsc_HPT</span><span> </span><a href="#local-6989586621684063433"><span class="hs-identifier hs-var">hsc_env</span></a><span>
</span><a name="line-2163"></a><span>
</span><a name="line-2164"></a><span class="hs-comment">-- | Get the 'TyCon' from a 'TyThing' if it is a type constructor thing. Panics otherwise</span><span>
</span><a name="line-2165"></a><span class="hs-identifier">tyThingTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-2166"></a><a name="tyThingTyCon"><a href="HscTypes.html#tyThingTyCon"><span class="hs-identifier">tyThingTyCon</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a><span> </span><a name="local-6989586621684063438"><a href="#local-6989586621684063438"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063438"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-2167"></a><span class="hs-identifier">tyThingTyCon</span><span> </span><a name="local-6989586621684063439"><a href="#local-6989586621684063439"><span class="hs-identifier">other</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tyThingTyCon&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063439"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-2168"></a><span>
</span><a name="line-2169"></a><span class="hs-comment">-- | Get the 'CoAxiom' from a 'TyThing' if it is a coercion axiom thing. Panics otherwise</span><span>
</span><a name="line-2170"></a><span class="hs-identifier">tyThingCoAxiom</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CoAxiom.html#CoAxiom"><span class="hs-identifier hs-type">CoAxiom</span></a><span> </span><a href="CoAxiom.html#Branched"><span class="hs-identifier hs-type">Branched</span></a><span>
</span><a name="line-2171"></a><a name="tyThingCoAxiom"><a href="HscTypes.html#tyThingCoAxiom"><span class="hs-identifier">tyThingCoAxiom</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#ACoAxiom"><span class="hs-identifier hs-var">ACoAxiom</span></a><span> </span><a name="local-6989586621684063440"><a href="#local-6989586621684063440"><span class="hs-identifier">ax</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063440"><span class="hs-identifier hs-var">ax</span></a><span>
</span><a name="line-2172"></a><span class="hs-identifier">tyThingCoAxiom</span><span> </span><a name="local-6989586621684063441"><a href="#local-6989586621684063441"><span class="hs-identifier">other</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tyThingCoAxiom&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063441"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-2173"></a><span>
</span><a name="line-2174"></a><span class="hs-comment">-- | Get the 'DataCon' from a 'TyThing' if it is a data constructor thing. Panics otherwise</span><span>
</span><a name="line-2175"></a><span class="hs-identifier">tyThingDataCon</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>
</span><a name="line-2176"></a><a name="tyThingDataCon"><a href="HscTypes.html#tyThingDataCon"><span class="hs-identifier">tyThingDataCon</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-6989586621684063442"><a href="#local-6989586621684063442"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063442"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-2177"></a><span class="hs-identifier">tyThingDataCon</span><span> </span><a name="local-6989586621684063443"><a href="#local-6989586621684063443"><span class="hs-identifier">other</span></a></a><span>                       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tyThingDataCon&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063443"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-2178"></a><span>
</span><a name="line-2179"></a><span class="hs-comment">-- | Get the 'ConLike' from a 'TyThing' if it is a data constructor thing.</span><span>
</span><a name="line-2180"></a><span class="hs-comment">-- Panics otherwise</span><span>
</span><a name="line-2181"></a><span class="hs-identifier">tyThingConLike</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a><span>
</span><a name="line-2182"></a><a name="tyThingConLike"><a href="HscTypes.html#tyThingConLike"><span class="hs-identifier">tyThingConLike</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><a name="local-6989586621684063444"><a href="#local-6989586621684063444"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063444"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-2183"></a><span class="hs-identifier">tyThingConLike</span><span> </span><a name="local-6989586621684063445"><a href="#local-6989586621684063445"><span class="hs-identifier">other</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tyThingConLike&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063445"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-2184"></a><span>
</span><a name="line-2185"></a><span class="hs-comment">-- | Get the 'Id' from a 'TyThing' if it is a id *or* data constructor thing. Panics otherwise</span><span>
</span><a name="line-2186"></a><span class="hs-identifier">tyThingId</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-2187"></a><a name="tyThingId"><a href="HscTypes.html#tyThingId"><span class="hs-identifier">tyThingId</span></a></a><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a><span> </span><a name="local-6989586621684063446"><a href="#local-6989586621684063446"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063446"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-2188"></a><span class="hs-identifier">tyThingId</span><span> </span><span class="hs-special">(</span><a href="TyCoRep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a><span> </span><span class="hs-special">(</span><a href="ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a><span> </span><a name="local-6989586621684063447"><a href="#local-6989586621684063447"><span class="hs-identifier">dc</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataCon.html#dataConWrapId"><span class="hs-identifier hs-var">dataConWrapId</span></a><span> </span><a href="#local-6989586621684063447"><span class="hs-identifier hs-var">dc</span></a><span>
</span><a name="line-2189"></a><span class="hs-identifier">tyThingId</span><span> </span><a name="local-6989586621684063448"><a href="#local-6989586621684063448"><span class="hs-identifier">other</span></a></a><span>                       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;tyThingId&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063448"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-2190"></a><span>
</span><a name="line-2191"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{MonadThings and friends}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2198"></a><span>
</span><a name="line-2199"></a><span class="hs-comment">-- | Class that abstracts out the common ability of the monads in GHC</span><span>
</span><a name="line-2200"></a><span class="hs-comment">-- to lookup a 'TyThing' in the monadic environment by 'Name'. Provides</span><span>
</span><a name="line-2201"></a><span class="hs-comment">-- a number of related convenience functions for accessing particular</span><span>
</span><a name="line-2202"></a><span class="hs-comment">-- kinds of 'TyThing'</span><span>
</span><a name="line-2203"></a><span class="hs-keyword">class</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621684062711"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="MonadThings"><a href="HscTypes.html#MonadThings"><span class="hs-identifier">MonadThings</span></a></a><span> </span><a name="local-6989586621684062711"><a href="#local-6989586621684062711"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2204"></a><span>        </span><a name="lookupThing"><a href="HscTypes.html#lookupThing"><span class="hs-identifier">lookupThing</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684062711"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="TyCoRep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a><span>
</span><a name="line-2205"></a><span>
</span><a name="line-2206"></a><span>        </span><a name="lookupId"><a href="HscTypes.html#lookupId"><span class="hs-identifier">lookupId</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684062711"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Var.html#Id"><span class="hs-identifier hs-type">Id</span></a><span>
</span><a name="line-2207"></a><span>        </span><a name="local-8214565720328837271"><a href="HscTypes.html#lookupId"><span class="hs-identifier">lookupId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="HscTypes.html#tyThingId"><span class="hs-identifier hs-var">tyThingId</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HscTypes.html#lookupThing"><span class="hs-identifier hs-var">lookupThing</span></a><span>
</span><a name="line-2208"></a><span>
</span><a name="line-2209"></a><span>        </span><a name="lookupDataCon"><a href="HscTypes.html#lookupDataCon"><span class="hs-identifier">lookupDataCon</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684062711"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a><span>
</span><a name="line-2210"></a><span>        </span><a name="local-8214565720328837272"><a href="HscTypes.html#lookupDataCon"><span class="hs-identifier">lookupDataCon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="HscTypes.html#tyThingDataCon"><span class="hs-identifier hs-var">tyThingDataCon</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HscTypes.html#lookupThing"><span class="hs-identifier hs-var">lookupThing</span></a><span>
</span><a name="line-2211"></a><span>
</span><a name="line-2212"></a><span>        </span><a name="lookupTyCon"><a href="HscTypes.html#lookupTyCon"><span class="hs-identifier">lookupTyCon</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684062711"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a><span>
</span><a name="line-2213"></a><span>        </span><a name="local-8214565720328837273"><a href="HscTypes.html#lookupTyCon"><span class="hs-identifier">lookupTyCon</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="HscTypes.html#tyThingTyCon"><span class="hs-identifier hs-var">tyThingTyCon</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HscTypes.html#lookupThing"><span class="hs-identifier hs-var">lookupThing</span></a><span>
</span><a name="line-2214"></a><span>
</span><a name="line-2215"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Auxiliary types}
*                                                                      *
************************************************************************

These types are defined here because they are mentioned in ModDetails,
but they are mostly elaborated elsewhere
-}</span><span>
</span><a name="line-2225"></a><span>
</span><a name="line-2226"></a><span class="hs-comment">------------------ Warnings -------------------------</span><span>
</span><a name="line-2227"></a><span class="hs-comment">-- | Warning information for a module</span><span>
</span><a name="line-2228"></a><span class="hs-keyword">data</span><span> </span><a name="Warnings"><a href="HscTypes.html#Warnings"><span class="hs-identifier">Warnings</span></a></a><span>
</span><a name="line-2229"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="NoWarnings"><a href="HscTypes.html#NoWarnings"><span class="hs-identifier">NoWarnings</span></a></a><span>                          </span><span class="hs-comment">-- ^ Nothing deprecated</span><span>
</span><a name="line-2230"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="WarnAll"><a href="HscTypes.html#WarnAll"><span class="hs-identifier">WarnAll</span></a></a><span> </span><a href="BasicTypes.html#WarningTxt"><span class="hs-identifier hs-type">WarningTxt</span></a><span>                  </span><span class="hs-comment">-- ^ Whole module deprecated</span><span>
</span><a name="line-2231"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="WarnSome"><a href="HscTypes.html#WarnSome"><span class="hs-identifier">WarnSome</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><a href="BasicTypes.html#WarningTxt"><span class="hs-identifier hs-type">WarningTxt</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- ^ Some specific things deprecated</span><span>
</span><a name="line-2232"></a><span>
</span><a name="line-2233"></a><span>     </span><span class="hs-comment">-- Only an OccName is needed because</span><span>
</span><a name="line-2234"></a><span>     </span><span class="hs-comment">--    (1) a deprecation always applies to a binding</span><span>
</span><a name="line-2235"></a><span>     </span><span class="hs-comment">--        defined in the module in which the deprecation appears.</span><span>
</span><a name="line-2236"></a><span>     </span><span class="hs-comment">--    (2) deprecations are only reported outside the defining module.</span><span>
</span><a name="line-2237"></a><span>     </span><span class="hs-comment">--        this is important because, otherwise, if we saw something like</span><span>
</span><a name="line-2238"></a><span>     </span><span class="hs-comment">--</span><span>
</span><a name="line-2239"></a><span>     </span><span class="hs-comment">--        {-# DEPRECATED f &quot;&quot; #-}</span><span>
</span><a name="line-2240"></a><span>     </span><span class="hs-comment">--        f = ...</span><span>
</span><a name="line-2241"></a><span>     </span><span class="hs-comment">--        h = f</span><span>
</span><a name="line-2242"></a><span>     </span><span class="hs-comment">--        g = let f = undefined in f</span><span>
</span><a name="line-2243"></a><span>     </span><span class="hs-comment">--</span><span>
</span><a name="line-2244"></a><span>     </span><span class="hs-comment">--        we'd need more information than an OccName to know to say something</span><span>
</span><a name="line-2245"></a><span>     </span><span class="hs-comment">--        about the use of f in h but not the use of the locally bound f in g</span><span>
</span><a name="line-2246"></a><span>     </span><span class="hs-comment">--</span><span>
</span><a name="line-2247"></a><span>     </span><span class="hs-comment">--        however, because we only report about deprecations from the outside,</span><span>
</span><a name="line-2248"></a><span>     </span><span class="hs-comment">--        and a module can only export one value called f,</span><span>
</span><a name="line-2249"></a><span>     </span><span class="hs-comment">--        an OccName suffices.</span><span>
</span><a name="line-2250"></a><span>     </span><span class="hs-comment">--</span><span>
</span><a name="line-2251"></a><span>     </span><span class="hs-comment">--        this is in contrast with fixity declarations, where we need to map</span><span>
</span><a name="line-2252"></a><span>     </span><span class="hs-comment">--        a Name to its fixity declaration.</span><span>
</span><a name="line-2253"></a><span>  </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2254"></a><span>
</span><a name="line-2255"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2256"></a><span>    </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621684063070"><a href="#local-6989586621684063070"><span class="hs-identifier">bh</span></a></a><span> </span><a href="HscTypes.html#NoWarnings"><span class="hs-identifier hs-var">NoWarnings</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621684063070"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2257"></a><span>    </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621684063071"><a href="#local-6989586621684063071"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnAll"><span class="hs-identifier hs-var">WarnAll</span></a><span> </span><a name="local-6989586621684063072"><a href="#local-6989586621684063072"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2258"></a><span>            </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621684063071"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2259"></a><span>            </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063071"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063072"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-2260"></a><span>    </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621684063073"><a href="#local-6989586621684063073"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnSome"><span class="hs-identifier hs-var">WarnSome</span></a><span> </span><a name="local-6989586621684063074"><a href="#local-6989586621684063074"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2261"></a><span>            </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621684063073"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-2262"></a><span>            </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063073"><span class="hs-identifier hs-var">bh</span></a><span> </span><a href="#local-6989586621684063074"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-2263"></a><span>
</span><a name="line-2264"></a><span>    </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621684063075"><a href="#local-6989586621684063075"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2265"></a><span>            </span><a name="local-6989586621684063076"><a href="#local-6989586621684063076"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a><span> </span><a href="#local-6989586621684063075"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2266"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684063076"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2267"></a><span>              </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HscTypes.html#NoWarnings"><span class="hs-identifier hs-var">NoWarnings</span></a><span>
</span><a name="line-2268"></a><span>              </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684063077"><a href="#local-6989586621684063077"><span class="hs-identifier">aa</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063075"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2269"></a><span>                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnAll"><span class="hs-identifier hs-var">WarnAll</span></a><span> </span><a href="#local-6989586621684063077"><span class="hs-identifier hs-var">aa</span></a><span class="hs-special">)</span><span>
</span><a name="line-2270"></a><span>              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684063078"><a href="#local-6989586621684063078"><span class="hs-identifier">aa</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063075"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2271"></a><span>                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnSome"><span class="hs-identifier hs-var">WarnSome</span></a><span> </span><a href="#local-6989586621684063078"><span class="hs-identifier hs-var">aa</span></a><span class="hs-special">)</span><span>
</span><a name="line-2272"></a><span>
</span><a name="line-2273"></a><span class="hs-comment">-- | Constructs the cache for the 'mi_warn_fn' field of a 'ModIface'</span><span>
</span><a name="line-2274"></a><span class="hs-identifier">mkIfaceWarnCache</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BasicTypes.html#WarningTxt"><span class="hs-identifier hs-type">WarningTxt</span></a><span>
</span><a name="line-2275"></a><a name="mkIfaceWarnCache"><a href="HscTypes.html#mkIfaceWarnCache"><span class="hs-identifier">mkIfaceWarnCache</span></a></a><span> </span><a href="HscTypes.html#NoWarnings"><span class="hs-identifier hs-var">NoWarnings</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2276"></a><span class="hs-identifier">mkIfaceWarnCache</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnAll"><span class="hs-identifier hs-var">WarnAll</span></a><span> </span><a name="local-6989586621684063449"><a href="#local-6989586621684063449"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684063449"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-2277"></a><span class="hs-identifier">mkIfaceWarnCache</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnSome"><span class="hs-identifier hs-var">WarnSome</span></a><span> </span><a name="local-6989586621684063450"><a href="#local-6989586621684063450"><span class="hs-identifier">pairs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><span class="hs-special">(</span><a href="OccName.html#mkOccEnv"><span class="hs-identifier hs-var">mkOccEnv</span></a><span> </span><a href="#local-6989586621684063450"><span class="hs-identifier hs-var">pairs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2278"></a><span>
</span><a name="line-2279"></a><span class="hs-identifier">emptyIfaceWarnCache</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BasicTypes.html#WarningTxt"><span class="hs-identifier hs-type">WarningTxt</span></a><span>
</span><a name="line-2280"></a><a name="emptyIfaceWarnCache"><a href="HscTypes.html#emptyIfaceWarnCache"><span class="hs-identifier">emptyIfaceWarnCache</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2281"></a><span>
</span><a name="line-2282"></a><span class="hs-identifier">plusWarns</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#Warnings"><span class="hs-identifier hs-type">Warnings</span></a><span>
</span><a name="line-2283"></a><a name="plusWarns"><a href="HscTypes.html#plusWarns"><span class="hs-identifier">plusWarns</span></a></a><span> </span><a name="local-6989586621684063451"><a href="#local-6989586621684063451"><span class="hs-identifier">d</span></a></a><span> </span><a href="HscTypes.html#NoWarnings"><span class="hs-identifier hs-var">NoWarnings</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063451"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-2284"></a><span class="hs-identifier">plusWarns</span><span> </span><a href="HscTypes.html#NoWarnings"><span class="hs-identifier hs-var">NoWarnings</span></a><span> </span><a name="local-6989586621684063452"><a href="#local-6989586621684063452"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063452"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-2285"></a><span class="hs-identifier">plusWarns</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnAll"><span class="hs-identifier hs-var">WarnAll</span></a><span> </span><a name="local-6989586621684063453"><a href="#local-6989586621684063453"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#WarnAll"><span class="hs-identifier hs-var">WarnAll</span></a><span> </span><a href="#local-6989586621684063453"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-2286"></a><span class="hs-identifier">plusWarns</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnAll"><span class="hs-identifier hs-var">WarnAll</span></a><span> </span><a name="local-6989586621684063454"><a href="#local-6989586621684063454"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#WarnAll"><span class="hs-identifier hs-var">WarnAll</span></a><span> </span><a href="#local-6989586621684063454"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-2287"></a><span class="hs-identifier">plusWarns</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnSome"><span class="hs-identifier hs-var">WarnSome</span></a><span> </span><a name="local-6989586621684063455"><a href="#local-6989586621684063455"><span class="hs-identifier">v1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#WarnSome"><span class="hs-identifier hs-var">WarnSome</span></a><span> </span><a name="local-6989586621684063456"><a href="#local-6989586621684063456"><span class="hs-identifier">v2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#WarnSome"><span class="hs-identifier hs-var">WarnSome</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063455"><span class="hs-identifier hs-var">v1</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684063456"><span class="hs-identifier hs-var">v2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2288"></a><span>
</span><a name="line-2289"></a><span class="hs-comment">-- | Creates cached lookup for the 'mi_fix_fn' field of 'ModIface'</span><span>
</span><a name="line-2290"></a><span class="hs-identifier">mkIfaceFixCache</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span>
</span><a name="line-2291"></a><a name="mkIfaceFixCache"><a href="HscTypes.html#mkIfaceFixCache"><span class="hs-identifier">mkIfaceFixCache</span></a></a><span> </span><a name="local-6989586621684063457"><a href="#local-6989586621684063457"><span class="hs-identifier">pairs</span></a></a><span>
</span><a name="line-2292"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621684063459"><a href="#local-6989586621684063459"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="OccName.html#lookupOccEnv"><span class="hs-identifier hs-var">lookupOccEnv</span></a><span> </span><a href="#local-6989586621684063458"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621684063459"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-2293"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2294"></a><span>   </span><a name="local-6989586621684063458"><a href="#local-6989586621684063458"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="OccName.html#mkOccEnv"><span class="hs-identifier hs-var">mkOccEnv</span></a><span> </span><a href="#local-6989586621684063457"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-2295"></a><span>
</span><a name="line-2296"></a><span class="hs-identifier">emptyIfaceFixCache</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span>
</span><a name="line-2297"></a><a name="emptyIfaceFixCache"><a href="HscTypes.html#emptyIfaceFixCache"><span class="hs-identifier">emptyIfaceFixCache</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-2298"></a><span>
</span><a name="line-2299"></a><span class="hs-comment">-- | Fixity environment mapping names to their fixities</span><span>
</span><a name="line-2300"></a><span class="hs-keyword">type</span><span> </span><a name="FixityEnv"><a href="HscTypes.html#FixityEnv"><span class="hs-identifier">FixityEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a><span> </span><a href="HscTypes.html#FixItem"><span class="hs-identifier hs-type">FixItem</span></a><span>
</span><a name="line-2301"></a><span>
</span><a name="line-2302"></a><span class="hs-comment">-- | Fixity information for an 'Name'. We keep the OccName in the range</span><span>
</span><a name="line-2303"></a><span class="hs-comment">-- so that we can generate an interface from it</span><span>
</span><a name="line-2304"></a><span class="hs-keyword">data</span><span> </span><a name="FixItem"><a href="HscTypes.html#FixItem"><span class="hs-identifier">FixItem</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="FixItem"><a href="HscTypes.html#FixItem"><span class="hs-identifier">FixItem</span></a></a><span> </span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span>
</span><a name="line-2305"></a><span>
</span><a name="line-2306"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="HscTypes.html#FixItem"><span class="hs-identifier hs-type">FixItem</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2307"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#FixItem"><span class="hs-identifier hs-var">FixItem</span></a><span> </span><a name="local-6989586621684063068"><a href="#local-6989586621684063068"><span class="hs-identifier">occ</span></a></a><span> </span><a name="local-6989586621684063069"><a href="#local-6989586621684063069"><span class="hs-identifier">fix</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063069"><span class="hs-identifier hs-var">fix</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063068"><span class="hs-identifier hs-var">occ</span></a><span>
</span><a name="line-2308"></a><span>
</span><a name="line-2309"></a><span class="hs-identifier">emptyFixityEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a><span>
</span><a name="line-2310"></a><a name="emptyFixityEnv"><a href="HscTypes.html#emptyFixityEnv"><span class="hs-identifier">emptyFixityEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="NameEnv.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a><span>
</span><a name="line-2311"></a><span>
</span><a name="line-2312"></a><span class="hs-identifier">lookupFixity</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a><span>
</span><a name="line-2313"></a><a name="lookupFixity"><a href="HscTypes.html#lookupFixity"><span class="hs-identifier">lookupFixity</span></a></a><span> </span><a name="local-6989586621684063460"><a href="#local-6989586621684063460"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621684063461"><a href="#local-6989586621684063461"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="NameEnv.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a><span> </span><a href="#local-6989586621684063460"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621684063461"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2314"></a><span>                        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#FixItem"><span class="hs-identifier hs-var">FixItem</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684063462"><a href="#local-6989586621684063462"><span class="hs-identifier">fix</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684063462"><span class="hs-identifier hs-var">fix</span></a><span>
</span><a name="line-2315"></a><span>                        </span><span class="hs-identifier hs-var">Nothing</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BasicTypes.html#defaultFixity"><span class="hs-identifier hs-var">defaultFixity</span></a><span>
</span><a name="line-2316"></a><span>
</span><a name="line-2317"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{WhatsImported}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2324"></a><span>
</span><a name="line-2325"></a><span class="hs-comment">-- | Records whether a module has orphans. An \&quot;orphan\&quot; is one of:</span><span>
</span><a name="line-2326"></a><span class="hs-comment">--</span><span>
</span><a name="line-2327"></a><span class="hs-comment">-- * An instance declaration in a module other than the definition</span><span>
</span><a name="line-2328"></a><span class="hs-comment">--   module for one of the type constructors or classes in the instance head</span><span>
</span><a name="line-2329"></a><span class="hs-comment">--</span><span>
</span><a name="line-2330"></a><span class="hs-comment">-- * A transformation rule in a module other than the one defining</span><span>
</span><a name="line-2331"></a><span class="hs-comment">--   the function in the head of the rule</span><span>
</span><a name="line-2332"></a><span class="hs-comment">--</span><span>
</span><a name="line-2333"></a><span class="hs-keyword">type</span><span> </span><a name="WhetherHasOrphans"><a href="HscTypes.html#WhetherHasOrphans"><span class="hs-identifier">WhetherHasOrphans</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2334"></a><span>
</span><a name="line-2335"></a><span class="hs-comment">-- | Does this module define family instances?</span><span>
</span><a name="line-2336"></a><span class="hs-keyword">type</span><span> </span><a name="WhetherHasFamInst"><a href="HscTypes.html#WhetherHasFamInst"><span class="hs-identifier">WhetherHasFamInst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2337"></a><span>
</span><a name="line-2338"></a><span class="hs-comment">-- | Did this module originate from a *-boot file?</span><span>
</span><a name="line-2339"></a><span class="hs-keyword">type</span><span> </span><a name="IsBootInterface"><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier">IsBootInterface</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2340"></a><span>
</span><a name="line-2341"></a><span class="hs-comment">-- | Dependency information about ALL modules and packages below this one</span><span>
</span><a name="line-2342"></a><span class="hs-comment">-- in the import hierarchy.</span><span>
</span><a name="line-2343"></a><span class="hs-comment">--</span><span>
</span><a name="line-2344"></a><span class="hs-comment">-- Invariant: the dependencies of a module @M@ never includes @M@.</span><span>
</span><a name="line-2345"></a><span class="hs-comment">--</span><span>
</span><a name="line-2346"></a><span class="hs-comment">-- Invariant: none of the lists contain duplicates.</span><span>
</span><a name="line-2347"></a><span class="hs-keyword">data</span><span> </span><a name="Dependencies"><a href="HscTypes.html#Dependencies"><span class="hs-identifier">Dependencies</span></a></a><span>
</span><a name="line-2348"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Deps"><a href="HscTypes.html#Deps"><span class="hs-identifier">Deps</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="dep_mods"><a href="HscTypes.html#dep_mods"><span class="hs-identifier">dep_mods</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2349"></a><span>                        </span><span class="hs-comment">-- ^ All home-package modules transitively below this one</span><span>
</span><a name="line-2350"></a><span>                        </span><span class="hs-comment">-- I.e. modules that this one imports, or that are in the</span><span>
</span><a name="line-2351"></a><span>                        </span><span class="hs-comment">--      dep_mods of those directly-imported modules</span><span>
</span><a name="line-2352"></a><span>
</span><a name="line-2353"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="dep_pkgs"><a href="HscTypes.html#dep_pkgs"><span class="hs-identifier">dep_pkgs</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Module.html#InstalledUnitId"><span class="hs-identifier hs-type">InstalledUnitId</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2354"></a><span>                        </span><span class="hs-comment">-- ^ All packages transitively below this module</span><span>
</span><a name="line-2355"></a><span>                        </span><span class="hs-comment">-- I.e. packages to which this module's direct imports belong,</span><span>
</span><a name="line-2356"></a><span>                        </span><span class="hs-comment">--      or that are in the dep_pkgs of those modules</span><span>
</span><a name="line-2357"></a><span>                        </span><span class="hs-comment">-- The bool indicates if the package is required to be</span><span>
</span><a name="line-2358"></a><span>                        </span><span class="hs-comment">-- trusted when the module is imported as a safe import</span><span>
</span><a name="line-2359"></a><span>                        </span><span class="hs-comment">-- (Safe Haskell). See Note [RnNames . Tracking Trust Transitively]</span><span>
</span><a name="line-2360"></a><span>
</span><a name="line-2361"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="dep_orphs"><a href="HscTypes.html#dep_orphs"><span class="hs-identifier">dep_orphs</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">]</span><span>
</span><a name="line-2362"></a><span>                        </span><span class="hs-comment">-- ^ Transitive closure of orphan modules (whether</span><span>
</span><a name="line-2363"></a><span>                        </span><span class="hs-comment">-- home or external pkg).</span><span>
</span><a name="line-2364"></a><span>                        </span><span class="hs-comment">--</span><span>
</span><a name="line-2365"></a><span>                        </span><span class="hs-comment">-- (Possible optimization: don't include family</span><span>
</span><a name="line-2366"></a><span>                        </span><span class="hs-comment">-- instance orphans as they are anyway included in</span><span>
</span><a name="line-2367"></a><span>                        </span><span class="hs-comment">-- 'dep_finsts'.  But then be careful about code</span><span>
</span><a name="line-2368"></a><span>                        </span><span class="hs-comment">-- which relies on dep_orphs having the complete list!)</span><span>
</span><a name="line-2369"></a><span>                        </span><span class="hs-comment">-- This does NOT include us, unlike 'imp_orphs'.</span><span>
</span><a name="line-2370"></a><span>
</span><a name="line-2371"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="dep_finsts"><a href="HscTypes.html#dep_finsts"><span class="hs-identifier">dep_finsts</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">]</span><span>
</span><a name="line-2372"></a><span>                        </span><span class="hs-comment">-- ^ Transitive closure of depended upon modules which</span><span>
</span><a name="line-2373"></a><span>                        </span><span class="hs-comment">-- contain family instances (whether home or external).</span><span>
</span><a name="line-2374"></a><span>                        </span><span class="hs-comment">-- This is used by 'checkFamInstConsistency'.  This</span><span>
</span><a name="line-2375"></a><span>                        </span><span class="hs-comment">-- does NOT include us, unlike 'imp_finsts'. See Note</span><span>
</span><a name="line-2376"></a><span>                        </span><span class="hs-comment">-- [The type family instance consistency story].</span><span>
</span><a name="line-2377"></a><span>
</span><a name="line-2378"></a><span>         </span><span class="hs-special">,</span><span> </span><a name="dep_plgins"><a href="HscTypes.html#dep_plgins"><span class="hs-identifier">dep_plgins</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">]</span><span>
</span><a name="line-2379"></a><span>                        </span><span class="hs-comment">-- ^ All the plugins used while compiling this module.</span><span>
</span><a name="line-2380"></a><span>         </span><span class="hs-special">}</span><span>
</span><a name="line-2381"></a><span>  </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2382"></a><span>        </span><span class="hs-comment">-- Equality used only for old/new comparison in MkIface.addFingerprints</span><span>
</span><a name="line-2383"></a><span>        </span><span class="hs-comment">-- See 'TcRnTypes.ImportAvails' for details on dependencies.</span><span>
</span><a name="line-2384"></a><span>
</span><a name="line-2385"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="HscTypes.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2386"></a><span>    </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621684063060"><a href="#local-6989586621684063060"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621684063061"><a href="#local-6989586621684063061"><span class="hs-identifier">deps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063060"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_mods</span><span> </span><a href="#local-6989586621684063061"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">)</span><span>
</span><a name="line-2387"></a><span>                      </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063060"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_pkgs</span><span> </span><a href="#local-6989586621684063061"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">)</span><span>
</span><a name="line-2388"></a><span>                      </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063060"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_orphs</span><span> </span><a href="#local-6989586621684063061"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">)</span><span>
</span><a name="line-2389"></a><span>                      </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063060"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_finsts</span><span> </span><a href="#local-6989586621684063061"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">)</span><span>
</span><a name="line-2390"></a><span>                      </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063060"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">dep_plgins</span><span> </span><a href="#local-6989586621684063061"><span class="hs-identifier hs-var">deps</span></a><span class="hs-special">)</span><span>
</span><a name="line-2391"></a><span>
</span><a name="line-2392"></a><span>    </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621684063062"><a href="#local-6989586621684063062"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684063063"><a href="#local-6989586621684063063"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063062"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2393"></a><span>                </span><a name="local-6989586621684063064"><a href="#local-6989586621684063064"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063062"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2394"></a><span>                </span><a name="local-6989586621684063065"><a href="#local-6989586621684063065"><span class="hs-identifier">os</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063062"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2395"></a><span>                </span><a name="local-6989586621684063066"><a href="#local-6989586621684063066"><span class="hs-identifier">fis</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063062"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2396"></a><span>                </span><a name="local-6989586621684063067"><a href="#local-6989586621684063067"><span class="hs-identifier">pl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063062"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2397"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#Deps"><span class="hs-identifier hs-var">Deps</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dep_mods</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063063"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dep_pkgs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063064"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dep_orphs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063065"><span class="hs-identifier hs-var">os</span></a><span class="hs-special">,</span><span>
</span><a name="line-2398"></a><span>                               </span><span class="hs-identifier">dep_finsts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063066"><span class="hs-identifier hs-var">fis</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">dep_plgins</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063067"><span class="hs-identifier hs-var">pl</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-2399"></a><span>
</span><a name="line-2400"></a><span class="hs-identifier">noDependencies</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Dependencies"><span class="hs-identifier hs-type">Dependencies</span></a><span>
</span><a name="line-2401"></a><a name="noDependencies"><a href="HscTypes.html#noDependencies"><span class="hs-identifier">noDependencies</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#Deps"><span class="hs-identifier hs-var">Deps</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-2402"></a><span>
</span><a name="line-2403"></a><span class="hs-comment">-- | Records modules for which changes may force recompilation of this module</span><span>
</span><a name="line-2404"></a><span class="hs-comment">-- See wiki: http://ghc.haskell.org/trac/ghc/wiki/Commentary/Compiler/RecompilationAvoidance</span><span>
</span><a name="line-2405"></a><span class="hs-comment">--</span><span>
</span><a name="line-2406"></a><span class="hs-comment">-- This differs from Dependencies.  A module X may be in the dep_mods of this</span><span>
</span><a name="line-2407"></a><span class="hs-comment">-- module (via an import chain) but if we don't use anything from X it won't</span><span>
</span><a name="line-2408"></a><span class="hs-comment">-- appear in our Usage</span><span>
</span><a name="line-2409"></a><span class="hs-keyword">data</span><span> </span><a name="Usage"><a href="HscTypes.html#Usage"><span class="hs-identifier">Usage</span></a></a><span>
</span><a name="line-2410"></a><span>  </span><span class="hs-comment">-- | Module from another package</span><span>
</span><a name="line-2411"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="UsagePackageModule"><a href="HscTypes.html#UsagePackageModule"><span class="hs-identifier">UsagePackageModule</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2412"></a><span>        </span><a name="usg_mod"><a href="HscTypes.html#usg_mod"><span class="hs-identifier">usg_mod</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>
</span><a name="line-2413"></a><span>           </span><span class="hs-comment">-- ^ External package module depended on</span><span>
</span><a name="line-2414"></a><span>        </span><a name="usg_mod_hash"><a href="HscTypes.html#usg_mod_hash"><span class="hs-identifier">usg_mod_hash</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>
</span><a name="line-2415"></a><span>            </span><span class="hs-comment">-- ^ Cached module fingerprint</span><span>
</span><a name="line-2416"></a><span>        </span><a name="usg_safe"><a href="HscTypes.html#usg_safe"><span class="hs-identifier">usg_safe</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#IsSafeImport"><span class="hs-identifier hs-type">IsSafeImport</span></a><span>
</span><a name="line-2417"></a><span>            </span><span class="hs-comment">-- ^ Was this module imported as a safe import</span><span>
</span><a name="line-2418"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-2419"></a><span>  </span><span class="hs-comment">-- | Module from the current package</span><span>
</span><a name="line-2420"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UsageHomeModule"><a href="HscTypes.html#UsageHomeModule"><span class="hs-identifier">UsageHomeModule</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2421"></a><span>        </span><a name="usg_mod_name"><a href="HscTypes.html#usg_mod_name"><span class="hs-identifier">usg_mod_name</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span>
</span><a name="line-2422"></a><span>            </span><span class="hs-comment">-- ^ Name of the module</span><span>
</span><a name="line-2423"></a><span>        </span><a name="usg_mod_hash"><a href="HscTypes.html#usg_mod_hash"><span class="hs-identifier">usg_mod_hash</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>
</span><a name="line-2424"></a><span>            </span><span class="hs-comment">-- ^ Cached module fingerprint</span><span>
</span><a name="line-2425"></a><span>        </span><a name="usg_entities"><a href="HscTypes.html#usg_entities"><span class="hs-identifier">usg_entities</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="OccName.html#OccName"><span class="hs-identifier hs-type">OccName</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-2426"></a><span>            </span><span class="hs-comment">-- ^ Entities we depend on, sorted by occurrence name and fingerprinted.</span><span>
</span><a name="line-2427"></a><span>            </span><span class="hs-comment">-- NB: usages are for parent names only, e.g. type constructors</span><span>
</span><a name="line-2428"></a><span>            </span><span class="hs-comment">-- but not the associated data constructors.</span><span>
</span><a name="line-2429"></a><span>        </span><a name="usg_exports"><a href="HscTypes.html#usg_exports"><span class="hs-identifier">usg_exports</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span class="hs-special">,</span><span>
</span><a name="line-2430"></a><span>            </span><span class="hs-comment">-- ^ Fingerprint for the export list of this module,</span><span>
</span><a name="line-2431"></a><span>            </span><span class="hs-comment">-- if we directly imported it (and hence we depend on its export list)</span><span>
</span><a name="line-2432"></a><span>        </span><a name="usg_safe"><a href="HscTypes.html#usg_safe"><span class="hs-identifier">usg_safe</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#IsSafeImport"><span class="hs-identifier hs-type">IsSafeImport</span></a><span>
</span><a name="line-2433"></a><span>            </span><span class="hs-comment">-- ^ Was this module imported as a safe import</span><span>
</span><a name="line-2434"></a><span>    </span><span class="hs-special">}</span><span>                                           </span><span class="hs-comment">-- ^ Module from the current package</span><span>
</span><a name="line-2435"></a><span>  </span><span class="hs-comment">-- | A file upon which the module depends, e.g. a CPP #include, or using TH's</span><span>
</span><a name="line-2436"></a><span>  </span><span class="hs-comment">-- 'addDependentFile'</span><span>
</span><a name="line-2437"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UsageFile"><a href="HscTypes.html#UsageFile"><span class="hs-identifier">UsageFile</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2438"></a><span>        </span><a name="usg_file_path"><a href="HscTypes.html#usg_file_path"><span class="hs-identifier">usg_file_path</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span>
</span><a name="line-2439"></a><span>        </span><span class="hs-comment">-- ^ External file dependency. From a CPP #include or TH</span><span>
</span><a name="line-2440"></a><span>        </span><span class="hs-comment">-- addDependentFile. Should be absolute.</span><span>
</span><a name="line-2441"></a><span>        </span><a name="usg_file_hash"><a href="HscTypes.html#usg_file_hash"><span class="hs-identifier">usg_file_hash</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span>
</span><a name="line-2442"></a><span>        </span><span class="hs-comment">-- ^ 'Fingerprint' of the file contents.</span><span>
</span><a name="line-2443"></a><span>
</span><a name="line-2444"></a><span>        </span><span class="hs-comment">-- Note: We don't consider things like modification timestamps</span><span>
</span><a name="line-2445"></a><span>        </span><span class="hs-comment">-- here, because there's no reason to recompile if the actual</span><span>
</span><a name="line-2446"></a><span>        </span><span class="hs-comment">-- contents don't change.  This previously lead to odd</span><span>
</span><a name="line-2447"></a><span>        </span><span class="hs-comment">-- recompilation behaviors; see #8114</span><span>
</span><a name="line-2448"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-2449"></a><span>  </span><span class="hs-comment">-- | A requirement which was merged into this one.</span><span>
</span><a name="line-2450"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="UsageMergedRequirement"><a href="HscTypes.html#UsageMergedRequirement"><span class="hs-identifier">UsageMergedRequirement</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2451"></a><span>        </span><a name="usg_mod"><a href="HscTypes.html#usg_mod"><span class="hs-identifier">usg_mod</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>
</span><a name="line-2452"></a><span>        </span><a name="usg_mod_hash"><a href="HscTypes.html#usg_mod_hash"><span class="hs-identifier">usg_mod_hash</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Fingerprint</span><span>
</span><a name="line-2453"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-2454"></a><span>    </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2455"></a><span>        </span><span class="hs-comment">-- The export list field is (Just v) if we depend on the export list:</span><span>
</span><a name="line-2456"></a><span>        </span><span class="hs-comment">--      i.e. we imported the module directly, whether or not we</span><span>
</span><a name="line-2457"></a><span>        </span><span class="hs-comment">--           enumerated the things we imported, or just imported</span><span>
</span><a name="line-2458"></a><span>        </span><span class="hs-comment">--           everything</span><span>
</span><a name="line-2459"></a><span>        </span><span class="hs-comment">-- We need to recompile if M's exports change, because</span><span>
</span><a name="line-2460"></a><span>        </span><span class="hs-comment">-- if the import was    import M,       we might now have a name clash</span><span>
</span><a name="line-2461"></a><span>        </span><span class="hs-comment">--                                      in the importing module.</span><span>
</span><a name="line-2462"></a><span>        </span><span class="hs-comment">-- if the import was    import M(x)     M might no longer export x</span><span>
</span><a name="line-2463"></a><span>        </span><span class="hs-comment">-- The only way we don't depend on the export list is if we have</span><span>
</span><a name="line-2464"></a><span>        </span><span class="hs-comment">--                      import M()</span><span>
</span><a name="line-2465"></a><span>        </span><span class="hs-comment">-- And of course, for modules that aren't imported directly we don't</span><span>
</span><a name="line-2466"></a><span>        </span><span class="hs-comment">-- depend on their export lists</span><span>
</span><a name="line-2467"></a><span>
</span><a name="line-2468"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="HscTypes.html#Usage"><span class="hs-identifier hs-type">Usage</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2469"></a><span>    </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621684063037"><a href="#local-6989586621684063037"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621684063038"><a href="#local-6989586621684063038"><span class="hs-identifier">usg</span></a></a><span class="hs-glyph">@</span><a href="HscTypes.html#UsagePackageModule"><span class="hs-identifier hs-var">UsagePackageModule</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2470"></a><span>        </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621684063037"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2471"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063037"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_mod</span><span> </span><a href="#local-6989586621684063038"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2472"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063037"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_mod_hash</span><span> </span><a href="#local-6989586621684063038"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2473"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063037"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_safe</span><span>     </span><a href="#local-6989586621684063038"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2474"></a><span>
</span><a name="line-2475"></a><span>    </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621684063039"><a href="#local-6989586621684063039"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621684063040"><a href="#local-6989586621684063040"><span class="hs-identifier">usg</span></a></a><span class="hs-glyph">@</span><a href="HscTypes.html#UsageHomeModule"><span class="hs-identifier hs-var">UsageHomeModule</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2476"></a><span>        </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621684063039"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2477"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063039"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_mod_name</span><span> </span><a href="#local-6989586621684063040"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2478"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063039"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_mod_hash</span><span> </span><a href="#local-6989586621684063040"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2479"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063039"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_exports</span><span>  </span><a href="#local-6989586621684063040"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2480"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063039"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_entities</span><span> </span><a href="#local-6989586621684063040"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2481"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063039"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_safe</span><span>     </span><a href="#local-6989586621684063040"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2482"></a><span>
</span><a name="line-2483"></a><span>    </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621684063041"><a href="#local-6989586621684063041"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621684063042"><a href="#local-6989586621684063042"><span class="hs-identifier">usg</span></a></a><span class="hs-glyph">@</span><a href="HscTypes.html#UsageFile"><span class="hs-identifier hs-var">UsageFile</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2484"></a><span>        </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621684063041"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-2485"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063041"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_file_path</span><span> </span><a href="#local-6989586621684063042"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2486"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063041"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_file_hash</span><span> </span><a href="#local-6989586621684063042"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2487"></a><span>
</span><a name="line-2488"></a><span>    </span><span class="hs-identifier">put_</span><span> </span><a name="local-6989586621684063043"><a href="#local-6989586621684063043"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621684063044"><a href="#local-6989586621684063044"><span class="hs-identifier">usg</span></a></a><span class="hs-glyph">@</span><a href="HscTypes.html#UsageMergedRequirement"><span class="hs-identifier hs-var">UsageMergedRequirement</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2489"></a><span>        </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621684063043"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-number">3</span><span>
</span><a name="line-2490"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063043"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_mod</span><span>      </span><a href="#local-6989586621684063044"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2491"></a><span>        </span><a href="Binary.html#put_"><span class="hs-identifier hs-var">put_</span></a><span> </span><a href="#local-6989586621684063043"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">usg_mod_hash</span><span> </span><a href="#local-6989586621684063044"><span class="hs-identifier hs-var">usg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2492"></a><span>
</span><a name="line-2493"></a><span>    </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621684063045"><a href="#local-6989586621684063045"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2494"></a><span>        </span><a name="local-6989586621684063046"><a href="#local-6989586621684063046"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2495"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684063046"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2496"></a><span>          </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2497"></a><span>            </span><a name="local-6989586621684063047"><a href="#local-6989586621684063047"><span class="hs-identifier">nm</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2498"></a><span>            </span><a name="local-6989586621684063048"><a href="#local-6989586621684063048"><span class="hs-identifier">mod</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2499"></a><span>            </span><span class="hs-keyword">safe</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2500"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HscTypes.html#UsagePackageModule"><span class="hs-identifier hs-var">UsagePackageModule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">usg_mod</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063047"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">usg_mod_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063048"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">usg_safe</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">safe</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2501"></a><span>          </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2502"></a><span>            </span><a name="local-6989586621684063050"><a href="#local-6989586621684063050"><span class="hs-identifier">nm</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2503"></a><span>            </span><a name="local-6989586621684063051"><a href="#local-6989586621684063051"><span class="hs-identifier">mod</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2504"></a><span>            </span><a name="local-6989586621684063052"><a href="#local-6989586621684063052"><span class="hs-identifier">exps</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2505"></a><span>            </span><a name="local-6989586621684063053"><a href="#local-6989586621684063053"><span class="hs-identifier">ents</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2506"></a><span>            </span><span class="hs-keyword">safe</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2507"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HscTypes.html#UsageHomeModule"><span class="hs-identifier hs-var">UsageHomeModule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">usg_mod_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063050"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">usg_mod_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063051"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span>
</span><a name="line-2508"></a><span>                     </span><span class="hs-identifier">usg_exports</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063052"><span class="hs-identifier hs-var">exps</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">usg_entities</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063053"><span class="hs-identifier hs-var">ents</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">usg_safe</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">safe</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2509"></a><span>          </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2510"></a><span>            </span><a name="local-6989586621684063055"><a href="#local-6989586621684063055"><span class="hs-identifier">fp</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2511"></a><span>            </span><a name="local-6989586621684063056"><a href="#local-6989586621684063056"><span class="hs-identifier">hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2512"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HscTypes.html#UsageFile"><span class="hs-identifier hs-var">UsageFile</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">usg_file_path</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063055"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">usg_file_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063056"><span class="hs-identifier hs-var">hash</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2513"></a><span>          </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2514"></a><span>            </span><a name="local-6989586621684063057"><a href="#local-6989586621684063057"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2515"></a><span>            </span><a name="local-6989586621684063058"><a href="#local-6989586621684063058"><span class="hs-identifier">hash</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Binary.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><a href="#local-6989586621684063045"><span class="hs-identifier hs-var">bh</span></a><span>
</span><a name="line-2516"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><a href="HscTypes.html#UsageMergedRequirement"><span class="hs-identifier hs-var">UsageMergedRequirement</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">usg_mod</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063057"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">usg_mod_hash</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063058"><span class="hs-identifier hs-var">hash</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2517"></a><span>          </span><a name="local-6989586621684063059"><a href="#local-6989586621684063059"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;Binary.get(Usage): &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684063059"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-2518"></a><span>
</span><a name="line-2519"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                The External Package State
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2526"></a><span>
</span><a name="line-2527"></a><span class="hs-keyword">type</span><span> </span><a name="PackageTypeEnv"><a href="HscTypes.html#PackageTypeEnv"><span class="hs-identifier">PackageTypeEnv</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a><span>
</span><a name="line-2528"></a><span class="hs-keyword">type</span><span> </span><a name="PackageRuleBase"><a href="HscTypes.html#PackageRuleBase"><span class="hs-identifier">PackageRuleBase</span></a></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="CoreSyn.html#RuleBase"><span class="hs-identifier hs-type">RuleBase</span></a><span>
</span><a name="line-2529"></a><span class="hs-keyword">type</span><span> </span><a name="PackageInstEnv"><a href="HscTypes.html#PackageInstEnv"><span class="hs-identifier">PackageInstEnv</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="InstEnv.html#InstEnv"><span class="hs-identifier hs-type">InstEnv</span></a><span>
</span><a name="line-2530"></a><span class="hs-keyword">type</span><span> </span><a name="PackageFamInstEnv"><a href="HscTypes.html#PackageFamInstEnv"><span class="hs-identifier">PackageFamInstEnv</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a><span>
</span><a name="line-2531"></a><span class="hs-keyword">type</span><span> </span><a name="PackageAnnEnv"><a href="HscTypes.html#PackageAnnEnv"><span class="hs-identifier">PackageAnnEnv</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Annotations.html#AnnEnv"><span class="hs-identifier hs-type">AnnEnv</span></a><span>
</span><a name="line-2532"></a><span class="hs-keyword">type</span><span> </span><a name="PackageCompleteMatchMap"><a href="HscTypes.html#PackageCompleteMatchMap"><span class="hs-identifier">PackageCompleteMatchMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#CompleteMatchMap"><span class="hs-identifier hs-type">CompleteMatchMap</span></a><span>
</span><a name="line-2533"></a><span>
</span><a name="line-2534"></a><span class="hs-comment">-- | Information about other packages that we have slurped in by reading</span><span>
</span><a name="line-2535"></a><span class="hs-comment">-- their interface files</span><span>
</span><a name="line-2536"></a><span class="hs-keyword">data</span><span> </span><a name="ExternalPackageState"><a href="HscTypes.html#ExternalPackageState"><span class="hs-identifier">ExternalPackageState</span></a></a><span>
</span><a name="line-2537"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="EPS"><a href="HscTypes.html#EPS"><span class="hs-identifier">EPS</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2538"></a><span>        </span><a name="eps_is_boot"><a href="HscTypes.html#eps_is_boot"><span class="hs-identifier">eps_is_boot</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Module.html#ModuleNameEnv"><span class="hs-identifier hs-type">ModuleNameEnv</span></a><span> </span><span class="hs-special">(</span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">,</span><span> </span><a href="HscTypes.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2539"></a><span>                </span><span class="hs-comment">-- ^ In OneShot mode (only), home-package modules</span><span>
</span><a name="line-2540"></a><span>                </span><span class="hs-comment">-- accumulate in the external package state, and are</span><span>
</span><a name="line-2541"></a><span>                </span><span class="hs-comment">-- sucked in lazily.  For these home-pkg modules</span><span>
</span><a name="line-2542"></a><span>                </span><span class="hs-comment">-- (only) we need to record which are boot modules.</span><span>
</span><a name="line-2543"></a><span>                </span><span class="hs-comment">-- We set this field after loading all the</span><span>
</span><a name="line-2544"></a><span>                </span><span class="hs-comment">-- explicitly-imported interfaces, but before doing</span><span>
</span><a name="line-2545"></a><span>                </span><span class="hs-comment">-- anything else</span><span>
</span><a name="line-2546"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-2547"></a><span>                </span><span class="hs-comment">-- The 'ModuleName' part is not necessary, but it's useful for</span><span>
</span><a name="line-2548"></a><span>                </span><span class="hs-comment">-- debug prints, and it's convenient because this field comes</span><span>
</span><a name="line-2549"></a><span>                </span><span class="hs-comment">-- direct from 'TcRnTypes.imp_dep_mods'</span><span>
</span><a name="line-2550"></a><span>
</span><a name="line-2551"></a><span>        </span><a name="eps_PIT"><a href="HscTypes.html#eps_PIT"><span class="hs-identifier">eps_PIT</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#PackageIfaceTable"><span class="hs-identifier hs-type">PackageIfaceTable</span></a><span class="hs-special">,</span><span>
</span><a name="line-2552"></a><span>                </span><span class="hs-comment">-- ^ The 'ModIface's for modules in external packages</span><span>
</span><a name="line-2553"></a><span>                </span><span class="hs-comment">-- whose interfaces we have opened.</span><span>
</span><a name="line-2554"></a><span>                </span><span class="hs-comment">-- The declarations in these interface files are held in the</span><span>
</span><a name="line-2555"></a><span>                </span><span class="hs-comment">-- 'eps_decls', 'eps_inst_env', 'eps_fam_inst_env' and 'eps_rules'</span><span>
</span><a name="line-2556"></a><span>                </span><span class="hs-comment">-- fields of this record, not in the 'mi_decls' fields of the</span><span>
</span><a name="line-2557"></a><span>                </span><span class="hs-comment">-- interface we have sucked in.</span><span>
</span><a name="line-2558"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-2559"></a><span>                </span><span class="hs-comment">-- What /is/ in the PIT is:</span><span>
</span><a name="line-2560"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-2561"></a><span>                </span><span class="hs-comment">-- * The Module</span><span>
</span><a name="line-2562"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-2563"></a><span>                </span><span class="hs-comment">-- * Fingerprint info</span><span>
</span><a name="line-2564"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-2565"></a><span>                </span><span class="hs-comment">-- * Its exports</span><span>
</span><a name="line-2566"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-2567"></a><span>                </span><span class="hs-comment">-- * Fixities</span><span>
</span><a name="line-2568"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-2569"></a><span>                </span><span class="hs-comment">-- * Deprecations and warnings</span><span>
</span><a name="line-2570"></a><span>
</span><a name="line-2571"></a><span>        </span><a name="eps_free_holes"><a href="HscTypes.html#eps_free_holes"><span class="hs-identifier">eps_free_holes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#InstalledModuleEnv"><span class="hs-identifier hs-type">InstalledModuleEnv</span></a><span> </span><span class="hs-special">(</span><a href="UniqDSet.html#UniqDSet"><span class="hs-identifier hs-type">UniqDSet</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2572"></a><span>                </span><span class="hs-comment">-- ^ Cache for 'mi_free_holes'.  Ordinarily, we can rely on</span><span>
</span><a name="line-2573"></a><span>                </span><span class="hs-comment">-- the 'eps_PIT' for this information, EXCEPT that when</span><span>
</span><a name="line-2574"></a><span>                </span><span class="hs-comment">-- we do dependency analysis, we need to look at the</span><span>
</span><a name="line-2575"></a><span>                </span><span class="hs-comment">-- 'Dependencies' of our imports to determine what their</span><span>
</span><a name="line-2576"></a><span>                </span><span class="hs-comment">-- precise free holes are ('moduleFreeHolesPrecise').  We</span><span>
</span><a name="line-2577"></a><span>                </span><span class="hs-comment">-- don't want to repeatedly reread in the interface</span><span>
</span><a name="line-2578"></a><span>                </span><span class="hs-comment">-- for every import, so cache it here.  When the PIT</span><span>
</span><a name="line-2579"></a><span>                </span><span class="hs-comment">-- gets filled in we can drop these entries.</span><span>
</span><a name="line-2580"></a><span>
</span><a name="line-2581"></a><span>        </span><a name="eps_PTE"><a href="HscTypes.html#eps_PTE"><span class="hs-identifier">eps_PTE</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#PackageTypeEnv"><span class="hs-identifier hs-type">PackageTypeEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-2582"></a><span>                </span><span class="hs-comment">-- ^ Result of typechecking all the external package</span><span>
</span><a name="line-2583"></a><span>                </span><span class="hs-comment">-- interface files we have sucked in. The domain of</span><span>
</span><a name="line-2584"></a><span>                </span><span class="hs-comment">-- the mapping is external-package modules</span><span>
</span><a name="line-2585"></a><span>
</span><a name="line-2586"></a><span>        </span><a name="eps_inst_env"><a href="HscTypes.html#eps_inst_env"><span class="hs-identifier">eps_inst_env</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#PackageInstEnv"><span class="hs-identifier hs-type">PackageInstEnv</span></a><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- ^ The total 'InstEnv' accumulated</span><span>
</span><a name="line-2587"></a><span>                                               </span><span class="hs-comment">-- from all the external-package modules</span><span>
</span><a name="line-2588"></a><span>        </span><a name="eps_fam_inst_env"><a href="HscTypes.html#eps_fam_inst_env"><span class="hs-identifier">eps_fam_inst_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#PackageFamInstEnv"><span class="hs-identifier hs-type">PackageFamInstEnv</span></a><span class="hs-special">,</span><span class="hs-comment">-- ^ The total 'FamInstEnv' accumulated</span><span>
</span><a name="line-2589"></a><span>                                               </span><span class="hs-comment">-- from all the external-package modules</span><span>
</span><a name="line-2590"></a><span>        </span><a name="eps_rule_base"><a href="HscTypes.html#eps_rule_base"><span class="hs-identifier">eps_rule_base</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#PackageRuleBase"><span class="hs-identifier hs-type">PackageRuleBase</span></a><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- ^ The total 'RuleEnv' accumulated</span><span>
</span><a name="line-2591"></a><span>                                               </span><span class="hs-comment">-- from all the external-package modules</span><span>
</span><a name="line-2592"></a><span>        </span><a name="eps_ann_env"><a href="HscTypes.html#eps_ann_env"><span class="hs-identifier">eps_ann_env</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#PackageAnnEnv"><span class="hs-identifier hs-type">PackageAnnEnv</span></a><span class="hs-special">,</span><span>    </span><span class="hs-comment">-- ^ The total 'AnnEnv' accumulated</span><span>
</span><a name="line-2593"></a><span>                                               </span><span class="hs-comment">-- from all the external-package modules</span><span>
</span><a name="line-2594"></a><span>        </span><a name="eps_complete_matches"><a href="HscTypes.html#eps_complete_matches"><span class="hs-identifier">eps_complete_matches</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#PackageCompleteMatchMap"><span class="hs-identifier hs-type">PackageCompleteMatchMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-2595"></a><span>                                  </span><span class="hs-comment">-- ^ The total 'CompleteMatchMap' accumulated</span><span>
</span><a name="line-2596"></a><span>                                  </span><span class="hs-comment">-- from all the external-package modules</span><span>
</span><a name="line-2597"></a><span>
</span><a name="line-2598"></a><span>        </span><a name="eps_mod_fam_inst_env"><a href="HscTypes.html#eps_mod_fam_inst_env"><span class="hs-identifier">eps_mod_fam_inst_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="FamInstEnv.html#FamInstEnv"><span class="hs-identifier hs-type">FamInstEnv</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ The family instances accumulated from external</span><span>
</span><a name="line-2599"></a><span>                                                         </span><span class="hs-comment">-- packages, keyed off the module that declared them</span><span>
</span><a name="line-2600"></a><span>
</span><a name="line-2601"></a><span>        </span><a name="eps_stats"><a href="HscTypes.html#eps_stats"><span class="hs-identifier">eps_stats</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="HscTypes.html#EpsStats"><span class="hs-identifier hs-type">EpsStats</span></a><span>                 </span><span class="hs-comment">-- ^ Stastics about what was loaded from external packages</span><span>
</span><a name="line-2602"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-2603"></a><span>
</span><a name="line-2604"></a><span class="hs-comment">-- | Accumulated statistics about what we are putting into the 'ExternalPackageState'.</span><span>
</span><a name="line-2605"></a><span class="hs-comment">-- \&quot;In\&quot; means stuff that is just /read/ from interface files,</span><span>
</span><a name="line-2606"></a><span class="hs-comment">-- \&quot;Out\&quot; means actually sucked in and type-checked</span><span>
</span><a name="line-2607"></a><span class="hs-keyword">data</span><span> </span><a name="EpsStats"><a href="HscTypes.html#EpsStats"><span class="hs-identifier">EpsStats</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="EpsStats"><a href="HscTypes.html#EpsStats"><span class="hs-identifier">EpsStats</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="n_ifaces_in"><a href="HscTypes.html#n_ifaces_in"><span class="hs-identifier">n_ifaces_in</span></a></a><span>
</span><a name="line-2608"></a><span>                         </span><span class="hs-special">,</span><span> </span><a name="n_decls_in"><a href="HscTypes.html#n_decls_in"><span class="hs-identifier">n_decls_in</span></a></a><span class="hs-special">,</span><span> </span><a name="n_decls_out"><a href="HscTypes.html#n_decls_out"><span class="hs-identifier">n_decls_out</span></a></a><span>
</span><a name="line-2609"></a><span>                         </span><span class="hs-special">,</span><span> </span><a name="n_rules_in"><a href="HscTypes.html#n_rules_in"><span class="hs-identifier">n_rules_in</span></a></a><span class="hs-special">,</span><span> </span><a name="n_rules_out"><a href="HscTypes.html#n_rules_out"><span class="hs-identifier">n_rules_out</span></a></a><span>
</span><a name="line-2610"></a><span>                         </span><span class="hs-special">,</span><span> </span><a name="n_insts_in"><a href="HscTypes.html#n_insts_in"><span class="hs-identifier">n_insts_in</span></a></a><span class="hs-special">,</span><span> </span><a name="n_insts_out"><a href="HscTypes.html#n_insts_out"><span class="hs-identifier">n_insts_out</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2611"></a><span>
</span><a name="line-2612"></a><span class="hs-identifier">addEpsInStats</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#EpsStats"><span class="hs-identifier hs-type">EpsStats</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#EpsStats"><span class="hs-identifier hs-type">EpsStats</span></a><span>
</span><a name="line-2613"></a><span class="hs-comment">-- ^ Add stats for one newly-read interface</span><span>
</span><a name="line-2614"></a><a name="addEpsInStats"><a href="HscTypes.html#addEpsInStats"><span class="hs-identifier">addEpsInStats</span></a></a><span> </span><a name="local-6989586621684063463"><a href="#local-6989586621684063463"><span class="hs-identifier">stats</span></a></a><span> </span><a name="local-6989586621684063464"><a href="#local-6989586621684063464"><span class="hs-identifier">n_decls</span></a></a><span> </span><a name="local-6989586621684063465"><a href="#local-6989586621684063465"><span class="hs-identifier">n_insts</span></a></a><span> </span><a name="local-6989586621684063466"><a href="#local-6989586621684063466"><span class="hs-identifier">n_rules</span></a></a><span>
</span><a name="line-2615"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063463"><span class="hs-identifier hs-var">stats</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">n_ifaces_in</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n_ifaces_in</span><span> </span><a href="#local-6989586621684063463"><span class="hs-identifier hs-var">stats</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2616"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">n_decls_in</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n_decls_in</span><span> </span><a href="#local-6989586621684063463"><span class="hs-identifier hs-var">stats</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684063464"><span class="hs-identifier hs-var">n_decls</span></a><span>
</span><a name="line-2617"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">n_insts_in</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n_insts_in</span><span> </span><a href="#local-6989586621684063463"><span class="hs-identifier hs-var">stats</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684063465"><span class="hs-identifier hs-var">n_insts</span></a><span>
</span><a name="line-2618"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">n_rules_in</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">n_rules_in</span><span> </span><a href="#local-6989586621684063463"><span class="hs-identifier hs-var">stats</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684063466"><span class="hs-identifier hs-var">n_rules</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2619"></a><span>
</span><a name="line-2620"></a><span class="hs-comment">{-
Names in a NameCache are always stored as a Global, and have the SrcLoc
of their binding locations.

Actually that's not quite right.  When we first encounter the original
name, we might not be at its binding site (e.g. we are reading an
interface file); so we give it 'noSrcLoc' then.  Later, when we find
its binding site, we fix it up.
-}</span><span>
</span><a name="line-2629"></a><span>
</span><a name="line-2630"></a><span class="hs-identifier">updNameCache</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><a href="NameCache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a><span>
</span><a name="line-2631"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="NameCache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="NameCache.html#NameCache"><span class="hs-identifier hs-type">NameCache</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684063163"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- The updating function</span><span>
</span><a name="line-2632"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621684063163"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-2633"></a><a name="updNameCache"><a href="HscTypes.html#updNameCache"><span class="hs-identifier">updNameCache</span></a></a><span> </span><a name="local-6989586621684063467"><a href="#local-6989586621684063467"><span class="hs-identifier">ncRef</span></a></a><span> </span><a name="local-6989586621684063468"><a href="#local-6989586621684063468"><span class="hs-identifier">upd_fn</span></a></a><span>
</span><a name="line-2634"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">atomicModifyIORef'</span><span> </span><a href="#local-6989586621684063467"><span class="hs-identifier hs-var">ncRef</span></a><span> </span><a href="#local-6989586621684063468"><span class="hs-identifier hs-var">upd_fn</span></a><span>
</span><a name="line-2635"></a><span>
</span><a name="line-2636"></a><span class="hs-identifier">mkSOName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-2637"></a><a name="mkSOName"><a href="HscTypes.html#mkSOName"><span class="hs-identifier">mkSOName</span></a></a><span> </span><a name="local-6989586621684063469"><a href="#local-6989586621684063469"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684063470"><a href="#local-6989586621684063470"><span class="hs-identifier">root</span></a></a><span>
</span><a name="line-2638"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621684063469"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2639"></a><span>      </span><a href="Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>           </span><a href="#local-6989586621684063470"><span class="hs-identifier hs-var">root</span></a><span>  </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="HscTypes.html#soExt"><span class="hs-identifier hs-var">soExt</span></a><span> </span><a href="#local-6989586621684063469"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-2640"></a><span>      </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;lib&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684063470"><span class="hs-identifier hs-var">root</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="HscTypes.html#soExt"><span class="hs-identifier hs-var">soExt</span></a><span> </span><a href="#local-6989586621684063469"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-2641"></a><span>
</span><a name="line-2642"></a><span class="hs-identifier">mkHsSOName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-2643"></a><a name="mkHsSOName"><a href="HscTypes.html#mkHsSOName"><span class="hs-identifier">mkHsSOName</span></a></a><span> </span><a name="local-6989586621684063471"><a href="#local-6989586621684063471"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684063472"><a href="#local-6989586621684063472"><span class="hs-identifier">root</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;lib&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684063472"><span class="hs-identifier hs-var">root</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;.&gt;</span><span> </span><a href="HscTypes.html#soExt"><span class="hs-identifier hs-var">soExt</span></a><span> </span><a href="#local-6989586621684063471"><span class="hs-identifier hs-var">platform</span></a><span>
</span><a name="line-2644"></a><span>
</span><a name="line-2645"></a><span class="hs-identifier">soExt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Platform.html#Platform"><span class="hs-identifier hs-type">Platform</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-2646"></a><a name="soExt"><a href="HscTypes.html#soExt"><span class="hs-identifier">soExt</span></a></a><span> </span><a name="local-6989586621684063473"><a href="#local-6989586621684063473"><span class="hs-identifier">platform</span></a></a><span>
</span><a name="line-2647"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621684063473"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2648"></a><span>      </span><a href="Platform.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;dylib&quot;</span><span>
</span><a name="line-2649"></a><span>      </span><a href="Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;dll&quot;</span><span>
</span><a name="line-2650"></a><span>      </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;so&quot;</span><span>
</span><a name="line-2651"></a><span>
</span><a name="line-2652"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                The module graph and ModSummary type
        A ModSummary is a node in the compilation manager's
        dependency graph, and it's also passed to hscMain
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2661"></a><span>
</span><a name="line-2662"></a><span class="hs-comment">-- | A ModuleGraph contains all the nodes from the home package (only).</span><span>
</span><a name="line-2663"></a><span class="hs-comment">-- There will be a node for each source module, plus a node for each hi-boot</span><span>
</span><a name="line-2664"></a><span class="hs-comment">-- module.</span><span>
</span><a name="line-2665"></a><span class="hs-comment">--</span><span>
</span><a name="line-2666"></a><span class="hs-comment">-- The graph is not necessarily stored in topologically-sorted order.  Use</span><span>
</span><a name="line-2667"></a><span class="hs-comment">-- 'GHC.topSortModuleGraph' and 'Digraph.flattenSCC' to achieve this.</span><span>
</span><a name="line-2668"></a><span class="hs-keyword">data</span><span> </span><a name="ModuleGraph"><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier">ModuleGraph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ModuleGraph"><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier">ModuleGraph</span></a></a><span>
</span><a name="line-2669"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="mg_mss"><a href="HscTypes.html#mg_mss"><span class="hs-identifier">mg_mss</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span class="hs-special">]</span><span>
</span><a name="line-2670"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="mg_non_boot"><a href="HscTypes.html#mg_non_boot"><span class="hs-identifier">mg_non_boot</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleEnv"><span class="hs-identifier hs-type">ModuleEnv</span></a><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span>
</span><a name="line-2671"></a><span>    </span><span class="hs-comment">-- a map of all non-boot ModSummaries keyed by Modules</span><span>
</span><a name="line-2672"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="mg_boot"><a href="HscTypes.html#mg_boot"><span class="hs-identifier">mg_boot</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-2673"></a><span>    </span><span class="hs-comment">-- a set of boot Modules</span><span>
</span><a name="line-2674"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="mg_needs_th_or_qq"><a href="HscTypes.html#mg_needs_th_or_qq"><span class="hs-identifier">mg_needs_th_or_qq</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2675"></a><span>    </span><span class="hs-comment">-- does any of the modules in mg_mss require TemplateHaskell or</span><span>
</span><a name="line-2676"></a><span>    </span><span class="hs-comment">-- QuasiQuotes?</span><span>
</span><a name="line-2677"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-2678"></a><span>
</span><a name="line-2679"></a><span class="hs-comment">-- | Determines whether a set of modules requires Template Haskell or</span><span>
</span><a name="line-2680"></a><span class="hs-comment">-- Quasi Quotes</span><span>
</span><a name="line-2681"></a><span class="hs-comment">--</span><span>
</span><a name="line-2682"></a><span class="hs-comment">-- Note that if the session's 'DynFlags' enabled Template Haskell when</span><span>
</span><a name="line-2683"></a><span class="hs-comment">-- 'depanal' was called, then each module in the returned module graph will</span><span>
</span><a name="line-2684"></a><span class="hs-comment">-- have Template Haskell enabled whether it is actually needed or not.</span><span>
</span><a name="line-2685"></a><span class="hs-identifier">needsTemplateHaskellOrQQ</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2686"></a><a name="needsTemplateHaskellOrQQ"><a href="HscTypes.html#needsTemplateHaskellOrQQ"><span class="hs-identifier">needsTemplateHaskellOrQQ</span></a></a><span> </span><a name="local-6989586621684063474"><a href="#local-6989586621684063474"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mg_needs_th_or_qq</span><span> </span><a href="#local-6989586621684063474"><span class="hs-identifier hs-var">mg</span></a><span>
</span><a name="line-2687"></a><span>
</span><a name="line-2688"></a><span class="hs-comment">-- | Map a function 'f' over all the 'ModSummaries'.</span><span>
</span><a name="line-2689"></a><span class="hs-comment">-- To preserve invariants 'f' can't change the isBoot status.</span><span>
</span><a name="line-2690"></a><span class="hs-identifier">mapMG</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span>
</span><a name="line-2691"></a><a name="mapMG"><a href="HscTypes.html#mapMG"><span class="hs-identifier">mapMG</span></a></a><span> </span><a name="local-6989586621684063475"><a href="#local-6989586621684063475"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621684063476"><a href="#local-6989586621684063476"><span class="hs-identifier">mg</span></a></a><span class="hs-glyph">@</span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-var">ModuleGraph</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063476"><span class="hs-identifier hs-var">mg</span></a><span>
</span><a name="line-2692"></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mg_mss</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621684063475"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684063477"><span class="hs-identifier hs-var">mg_mss</span></a><span>
</span><a name="line-2693"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mg_non_boot</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#mapModuleEnv"><span class="hs-identifier hs-var">mapModuleEnv</span></a><span> </span><a href="#local-6989586621684063475"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684063478"><span class="hs-identifier hs-var">mg_non_boot</span></a><span>
</span><a name="line-2694"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-2695"></a><span>
</span><a name="line-2696"></a><span class="hs-identifier">mgBootModules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleSet"><span class="hs-identifier hs-type">ModuleSet</span></a><span>
</span><a name="line-2697"></a><a name="mgBootModules"><a href="HscTypes.html#mgBootModules"><span class="hs-identifier">mgBootModules</span></a></a><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-var">ModuleGraph</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063483"><span class="hs-identifier hs-var">mg_boot</span></a><span>
</span><a name="line-2698"></a><span>
</span><a name="line-2699"></a><span class="hs-identifier">mgModSummaries</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span class="hs-special">]</span><span>
</span><a name="line-2700"></a><a name="mgModSummaries"><a href="HscTypes.html#mgModSummaries"><span class="hs-identifier">mgModSummaries</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mg_mss</span><span>
</span><a name="line-2701"></a><span>
</span><a name="line-2702"></a><span class="hs-identifier">mgElemModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2703"></a><a name="mgElemModule"><a href="HscTypes.html#mgElemModule"><span class="hs-identifier">mgElemModule</span></a></a><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-var">ModuleGraph</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621684063489"><a href="#local-6989586621684063489"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#elemModuleEnv"><span class="hs-identifier hs-var">elemModuleEnv</span></a><span> </span><a href="#local-6989586621684063489"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621684063486"><span class="hs-identifier hs-var">mg_non_boot</span></a><span>
</span><a name="line-2704"></a><span>
</span><a name="line-2705"></a><span class="hs-comment">-- | Look up a ModSummary in the ModuleGraph</span><span>
</span><a name="line-2706"></a><span class="hs-identifier">mgLookupModule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span>
</span><a name="line-2707"></a><a name="mgLookupModule"><a href="HscTypes.html#mgLookupModule"><span class="hs-identifier">mgLookupModule</span></a></a><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-var">ModuleGraph</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621684063494"><a href="#local-6989586621684063494"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Module.html#lookupModuleEnv"><span class="hs-identifier hs-var">lookupModuleEnv</span></a><span> </span><a href="#local-6989586621684063491"><span class="hs-identifier hs-var">mg_non_boot</span></a><span> </span><a href="#local-6989586621684063494"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-2708"></a><span>
</span><a name="line-2709"></a><span class="hs-identifier">emptyMG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span>
</span><a name="line-2710"></a><a name="emptyMG"><a href="HscTypes.html#emptyMG"><span class="hs-identifier">emptyMG</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-var">ModuleGraph</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="Module.html#emptyModuleEnv"><span class="hs-identifier hs-var">emptyModuleEnv</span></a><span> </span><a href="Module.html#emptyModuleSet"><span class="hs-identifier hs-var">emptyModuleSet</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2711"></a><span>
</span><a name="line-2712"></a><span class="hs-identifier">isTemplateHaskellOrQQNonBoot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2713"></a><a name="isTemplateHaskellOrQQNonBoot"><a href="HscTypes.html#isTemplateHaskellOrQQNonBoot"><span class="hs-identifier">isTemplateHaskellOrQQNonBoot</span></a></a><span> </span><a name="local-6989586621684063495"><a href="#local-6989586621684063495"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2714"></a><span>  </span><span class="hs-special">(</span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="GHC.LanguageExtensions.Type.html#TemplateHaskell"><span class="hs-identifier hs-var">LangExt.TemplateHaskell</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_hspp_opts</span><span> </span><a href="#local-6989586621684063495"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-2715"></a><span>    </span><span class="hs-operator hs-var">||</span><span> </span><a href="DynFlags.html#xopt"><span class="hs-identifier hs-var">xopt</span></a><span> </span><a href="GHC.LanguageExtensions.Type.html#QuasiQuotes"><span class="hs-identifier hs-var">LangExt.QuasiQuotes</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_hspp_opts</span><span> </span><a href="#local-6989586621684063495"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span>
</span><a name="line-2716"></a><span>  </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a><span> </span><a href="#local-6989586621684063495"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-2717"></a><span>
</span><a name="line-2718"></a><span class="hs-comment">-- | Add a ModSummary to ModuleGraph. Assumes that the new ModSummary is</span><span>
</span><a name="line-2719"></a><span class="hs-comment">-- not an element of the ModuleGraph.</span><span>
</span><a name="line-2720"></a><span class="hs-identifier">extendMG</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span>
</span><a name="line-2721"></a><a name="extendMG"><a href="HscTypes.html#extendMG"><span class="hs-identifier">extendMG</span></a></a><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-var">ModuleGraph</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621684063500"><a href="#local-6989586621684063500"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-var">ModuleGraph</span></a><span>
</span><a name="line-2722"></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mg_mss</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063500"><span class="hs-identifier hs-var">ms</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684063496"><span class="hs-identifier hs-var">mg_mss</span></a><span>
</span><a name="line-2723"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mg_non_boot</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="HscTypes.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a><span> </span><a href="#local-6989586621684063500"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-2724"></a><span>      </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621684063497"><span class="hs-identifier hs-var">mg_non_boot</span></a><span>
</span><a name="line-2725"></a><span>      </span><span class="hs-keyword">else</span><span> </span><a href="Module.html#extendModuleEnv"><span class="hs-identifier hs-var">extendModuleEnv</span></a><span> </span><a href="#local-6989586621684063497"><span class="hs-identifier hs-var">mg_non_boot</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_mod</span><span> </span><a href="#local-6989586621684063500"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063500"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-2726"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mg_boot</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="HscTypes.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a><span> </span><a href="#local-6989586621684063500"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-2727"></a><span>      </span><span class="hs-keyword">then</span><span> </span><a href="Module.html#extendModuleSet"><span class="hs-identifier hs-var">extendModuleSet</span></a><span> </span><a href="#local-6989586621684063498"><span class="hs-identifier hs-var">mg_boot</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_mod</span><span> </span><a href="#local-6989586621684063500"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-2728"></a><span>      </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621684063498"><span class="hs-identifier hs-var">mg_boot</span></a><span>
</span><a name="line-2729"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mg_needs_th_or_qq</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063499"><span class="hs-identifier hs-var">mg_needs_th_or_qq</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="HscTypes.html#isTemplateHaskellOrQQNonBoot"><span class="hs-identifier hs-var">isTemplateHaskellOrQQNonBoot</span></a><span> </span><a href="#local-6989586621684063500"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-2730"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-2731"></a><span>
</span><a name="line-2732"></a><span class="hs-identifier">mkModuleGraph</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a><span>
</span><a name="line-2733"></a><a name="mkModuleGraph"><a href="HscTypes.html#mkModuleGraph"><span class="hs-identifier">mkModuleGraph</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><a href="HscTypes.html#extendMG"><span class="hs-identifier hs-var">extendMG</span></a><span class="hs-special">)</span><span> </span><a href="HscTypes.html#emptyMG"><span class="hs-identifier hs-var">emptyMG</span></a><span>
</span><a name="line-2734"></a><span>
</span><a name="line-2735"></a><span class="hs-comment">-- | A single node in a 'ModuleGraph'. The nodes of the module graph</span><span>
</span><a name="line-2736"></a><span class="hs-comment">-- are one of:</span><span>
</span><a name="line-2737"></a><span class="hs-comment">--</span><span>
</span><a name="line-2738"></a><span class="hs-comment">-- * A regular Haskell source module</span><span>
</span><a name="line-2739"></a><span class="hs-comment">-- * A hi-boot source module</span><span>
</span><a name="line-2740"></a><span class="hs-comment">--</span><span>
</span><a name="line-2741"></a><span class="hs-keyword">data</span><span> </span><a name="ModSummary"><a href="HscTypes.html#ModSummary"><span class="hs-identifier">ModSummary</span></a></a><span>
</span><a name="line-2742"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="ModSummary"><a href="HscTypes.html#ModSummary"><span class="hs-identifier">ModSummary</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2743"></a><span>        </span><a name="ms_mod"><a href="HscTypes.html#ms_mod"><span class="hs-identifier">ms_mod</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>
</span><a name="line-2744"></a><span>          </span><span class="hs-comment">-- ^ Identity of the module</span><span>
</span><a name="line-2745"></a><span>        </span><a name="ms_hsc_src"><a href="HscTypes.html#ms_hsc_src"><span class="hs-identifier">ms_hsc_src</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="DriverPhases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a><span class="hs-special">,</span><span>
</span><a name="line-2746"></a><span>          </span><span class="hs-comment">-- ^ The module source either plain Haskell or hs-boot</span><span>
</span><a name="line-2747"></a><span>        </span><a name="ms_location"><a href="HscTypes.html#ms_location"><span class="hs-identifier">ms_location</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a><span class="hs-special">,</span><span>
</span><a name="line-2748"></a><span>          </span><span class="hs-comment">-- ^ Location of the various files belonging to the module</span><span>
</span><a name="line-2749"></a><span>        </span><a name="ms_hs_date"><a href="HscTypes.html#ms_hs_date"><span class="hs-identifier">ms_hs_date</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">UTCTime</span><span class="hs-special">,</span><span>
</span><a name="line-2750"></a><span>          </span><span class="hs-comment">-- ^ Timestamp of source file</span><span>
</span><a name="line-2751"></a><span>        </span><a name="ms_obj_date"><a href="HscTypes.html#ms_obj_date"><span class="hs-identifier">ms_obj_date</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">UTCTime</span><span class="hs-special">,</span><span>
</span><a name="line-2752"></a><span>          </span><span class="hs-comment">-- ^ Timestamp of object, if we have one</span><span>
</span><a name="line-2753"></a><span>        </span><a name="ms_iface_date"><a href="HscTypes.html#ms_iface_date"><span class="hs-identifier">ms_iface_date</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">UTCTime</span><span class="hs-special">,</span><span>
</span><a name="line-2754"></a><span>          </span><span class="hs-comment">-- ^ Timestamp of hi file, if we *only* are typechecking (it is</span><span>
</span><a name="line-2755"></a><span>          </span><span class="hs-comment">-- 'Nothing' otherwise.</span><span>
</span><a name="line-2756"></a><span>          </span><span class="hs-comment">-- See Note [Recompilation checking in -fno-code mode] and #9243</span><span>
</span><a name="line-2757"></a><span>        </span><a name="ms_hie_date"><a href="HscTypes.html#ms_hie_date"><span class="hs-identifier">ms_hie_date</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">UTCTime</span><span class="hs-special">,</span><span>
</span><a name="line-2758"></a><span>          </span><span class="hs-comment">-- ^ Timestamp of hie file, if we have one</span><span>
</span><a name="line-2759"></a><span>        </span><a name="ms_srcimps"><a href="HscTypes.html#ms_srcimps"><span class="hs-identifier">ms_srcimps</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-2760"></a><span>          </span><span class="hs-comment">-- ^ Source imports of the module</span><span>
</span><a name="line-2761"></a><span>        </span><a name="ms_textual_imps"><a href="HscTypes.html#ms_textual_imps"><span class="hs-identifier">ms_textual_imps</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-2762"></a><span>          </span><span class="hs-comment">-- ^ Non-source imports of the module from the module *text*</span><span>
</span><a name="line-2763"></a><span>        </span><a name="ms_parsed_mod"><a href="HscTypes.html#ms_parsed_mod"><span class="hs-identifier">ms_parsed_mod</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="HscTypes.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a><span class="hs-special">,</span><span>
</span><a name="line-2764"></a><span>          </span><span class="hs-comment">-- ^ The parsed, nonrenamed source, if we have it.  This is also</span><span>
</span><a name="line-2765"></a><span>          </span><span class="hs-comment">-- used to support &quot;inline module syntax&quot; in Backpack files.</span><span>
</span><a name="line-2766"></a><span>        </span><a name="ms_hspp_file"><a href="HscTypes.html#ms_hspp_file"><span class="hs-identifier">ms_hspp_file</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">,</span><span>
</span><a name="line-2767"></a><span>          </span><span class="hs-comment">-- ^ Filename of preprocessed source file</span><span>
</span><a name="line-2768"></a><span>        </span><a name="ms_hspp_opts"><a href="HscTypes.html#ms_hspp_opts"><span class="hs-identifier">ms_hspp_opts</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span class="hs-special">,</span><span>
</span><a name="line-2769"></a><span>          </span><span class="hs-comment">-- ^ Cached flags from @OPTIONS@, @INCLUDE@ and @LANGUAGE@</span><span>
</span><a name="line-2770"></a><span>          </span><span class="hs-comment">-- pragmas in the modules source code</span><span>
</span><a name="line-2771"></a><span>        </span><a name="ms_hspp_buf"><a href="HscTypes.html#ms_hspp_buf"><span class="hs-identifier">ms_hspp_buf</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a><span>
</span><a name="line-2772"></a><span>          </span><span class="hs-comment">-- ^ The actual preprocessed source, if we have it</span><span>
</span><a name="line-2773"></a><span>     </span><span class="hs-special">}</span><span>
</span><a name="line-2774"></a><span>
</span><a name="line-2775"></a><span class="hs-identifier">ms_installed_mod</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#InstalledModule"><span class="hs-identifier hs-type">InstalledModule</span></a><span>
</span><a name="line-2776"></a><a name="ms_installed_mod"><a href="HscTypes.html#ms_installed_mod"><span class="hs-identifier">ms_installed_mod</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Module.html#splitModuleInsts"><span class="hs-identifier hs-var">splitModuleInsts</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">ms_mod</span><span>
</span><a name="line-2777"></a><span>
</span><a name="line-2778"></a><span class="hs-identifier">ms_mod_name</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span>
</span><a name="line-2779"></a><a name="ms_mod_name"><a href="HscTypes.html#ms_mod_name"><span class="hs-identifier">ms_mod_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">ms_mod</span><span>
</span><a name="line-2780"></a><span>
</span><a name="line-2781"></a><span class="hs-identifier">ms_imps</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><a href="Module.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2782"></a><a name="ms_imps"><a href="HscTypes.html#ms_imps"><span class="hs-identifier">ms_imps</span></a></a><span> </span><a name="local-6989586621684063501"><a href="#local-6989586621684063501"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2783"></a><span>  </span><span class="hs-identifier">ms_textual_imps</span><span> </span><a href="#local-6989586621684063501"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-2784"></a><span>  </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621684063502"><span class="hs-identifier hs-var">mk_additional_import</span></a><span> </span><span class="hs-special">(</span><a href="DynFlags.html#dynFlagDependencies"><span class="hs-identifier hs-var">dynFlagDependencies</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_hspp_opts</span><span> </span><a href="#local-6989586621684063501"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2785"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2786"></a><span>    </span><a name="local-6989586621684063502"><a href="#local-6989586621684063502"><span class="hs-identifier">mk_additional_import</span></a></a><span> </span><a name="local-6989586621684063503"><a href="#local-6989586621684063503"><span class="hs-identifier">mod_nm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><a href="SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a><span> </span><a href="#local-6989586621684063503"><span class="hs-identifier hs-var">mod_nm</span></a><span class="hs-special">)</span><span>
</span><a name="line-2787"></a><span>
</span><a name="line-2788"></a><span class="hs-comment">-- The ModLocation contains both the original source filename and the</span><span>
</span><a name="line-2789"></a><span class="hs-comment">-- filename of the cleaned-up source file after all preprocessing has been</span><span>
</span><a name="line-2790"></a><span class="hs-comment">-- done.  The point is that the summariser will have to cpp/unlit/whatever</span><span>
</span><a name="line-2791"></a><span class="hs-comment">-- all files anyway, and there's no point in doing this twice -- just</span><span>
</span><a name="line-2792"></a><span class="hs-comment">-- park the result in a temp file, put the name of it in the location,</span><span>
</span><a name="line-2793"></a><span class="hs-comment">-- and let @compile@ read from that file on the way back up.</span><span>
</span><a name="line-2794"></a><span>
</span><a name="line-2795"></a><span class="hs-comment">-- The ModLocation is stable over successive up-sweeps in GHCi, wheres</span><span>
</span><a name="line-2796"></a><span class="hs-comment">-- the ms_hs_date and imports can, of course, change</span><span>
</span><a name="line-2797"></a><span>
</span><a name="line-2798"></a><span class="hs-identifier">msHsFilePath</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">msHiFilePath</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">msObjFilePath</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-2799"></a><a name="msHsFilePath"><a href="HscTypes.html#msHsFilePath"><span class="hs-identifier">msHsFilePath</span></a></a><span>  </span><a name="local-6989586621684063504"><a href="#local-6989586621684063504"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Maybes.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a><span> </span><span class="hs-string">&quot;msHsFilePath&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ml_hs_file</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">ms_location</span><span> </span><a href="#local-6989586621684063504"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2800"></a><a name="msHiFilePath"><a href="HscTypes.html#msHiFilePath"><span class="hs-identifier">msHiFilePath</span></a></a><span>  </span><a name="local-6989586621684063505"><a href="#local-6989586621684063505"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ml_hi_file</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">ms_location</span><span> </span><a href="#local-6989586621684063505"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-2801"></a><a name="msObjFilePath"><a href="HscTypes.html#msObjFilePath"><span class="hs-identifier">msObjFilePath</span></a></a><span> </span><a name="local-6989586621684063506"><a href="#local-6989586621684063506"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ml_obj_file</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_location</span><span> </span><a href="#local-6989586621684063506"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-2802"></a><span>
</span><a name="line-2803"></a><span class="hs-comment">-- | Did this 'ModSummary' originate from a hs-boot file?</span><span>
</span><a name="line-2804"></a><span class="hs-identifier">isBootSummary</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2805"></a><a name="isBootSummary"><a href="HscTypes.html#isBootSummary"><span class="hs-identifier">isBootSummary</span></a></a><span> </span><a name="local-6989586621684063507"><a href="#local-6989586621684063507"><span class="hs-identifier">ms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ms_hsc_src</span><span> </span><a href="#local-6989586621684063507"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="DriverPhases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a><span>
</span><a name="line-2806"></a><span>
</span><a name="line-2807"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2808"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><a name="local-6989586621684063036"><a href="#local-6989586621684063036"><span class="hs-identifier">ms</span></a></a><span>
</span><a name="line-2809"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ModSummary {&quot;</span><span class="hs-special">,</span><span>
</span><a name="line-2810"></a><span>             </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">3</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a><span> </span><span class="hs-special">[</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ms_hs_date = &quot;</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_hs_date</span><span> </span><a href="#local-6989586621684063036"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2811"></a><span>                          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ms_mod =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_mod</span><span> </span><a href="#local-6989586621684063036"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-2812"></a><span>                                </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="DriverPhases.html#hscSourceString"><span class="hs-identifier hs-var">hscSourceString</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_hsc_src</span><span> </span><a href="#local-6989586621684063036"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a><span class="hs-special">,</span><span>
</span><a name="line-2813"></a><span>                          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ms_textual_imps =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_textual_imps</span><span> </span><a href="#local-6989586621684063036"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2814"></a><span>                          </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;ms_srcimps =&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_srcimps</span><span> </span><a href="#local-6989586621684063036"><span class="hs-identifier hs-var">ms</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2815"></a><span>             </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'}'</span><span>
</span><a name="line-2816"></a><span>            </span><span class="hs-special">]</span><span>
</span><a name="line-2817"></a><span>
</span><a name="line-2818"></a><span class="hs-identifier">showModMsg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#HscTarget"><span class="hs-identifier hs-type">HscTarget</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-2819"></a><a name="showModMsg"><a href="HscTypes.html#showModMsg"><span class="hs-identifier">showModMsg</span></a></a><span> </span><a name="local-6989586621684063508"><a href="#local-6989586621684063508"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684063509"><a href="#local-6989586621684063509"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684063510"><a href="#local-6989586621684063510"><span class="hs-identifier">recomp</span></a></a><span> </span><a name="local-6989586621684063511"><a href="#local-6989586621684063511"><span class="hs-identifier">mod_summary</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a><span> </span><a href="#local-6989586621684063508"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-2820"></a><span>   </span><span class="hs-keyword">if</span><span> </span><a href="DynFlags.html#gopt"><span class="hs-identifier hs-var">gopt</span></a><span> </span><a href="DynFlags.html#Opt_HideSourcePaths"><span class="hs-identifier hs-var">Opt_HideSourcePaths</span></a><span> </span><a href="#local-6989586621684063508"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2821"></a><span>      </span><span class="hs-keyword">then</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621684063514"><span class="hs-identifier hs-var">mod_str</span></a><span>
</span><a name="line-2822"></a><span>      </span><span class="hs-keyword">else</span><span> </span><a href="Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a><span>
</span><a name="line-2823"></a><span>         </span><span class="hs-special">[</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063514"><span class="hs-identifier hs-var">mod_str</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-number">16</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684063514"><span class="hs-identifier hs-var">mod_str</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-char">' '</span><span class="hs-special">)</span><span>
</span><a name="line-2824"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">'('</span><span>
</span><a name="line-2825"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063512"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HscTypes.html#msHsFilePath"><span class="hs-identifier hs-var">msHsFilePath</span></a><span> </span><a href="#local-6989586621684063511"><span class="hs-identifier hs-var">mod_summary</span></a><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">','</span><span>
</span><a name="line-2826"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684063509"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2827"></a><span>              </span><a href="DynFlags.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684063510"><span class="hs-identifier hs-var">recomp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;interpreted&quot;</span><span>
</span><a name="line-2828"></a><span>              </span><a href="DynFlags.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;nothing&quot;</span><span>
</span><a name="line-2829"></a><span>              </span><span class="hs-identifier">_</span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684063512"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HscTypes.html#msObjFilePath"><span class="hs-identifier hs-var">msObjFilePath</span></a><span> </span><a href="#local-6989586621684063511"><span class="hs-identifier hs-var">mod_summary</span></a><span class="hs-special">)</span><span>
</span><a name="line-2830"></a><span>         </span><span class="hs-special">,</span><span> </span><a href="Outputable.html#char"><span class="hs-identifier hs-var">char</span></a><span> </span><span class="hs-char">')'</span><span>
</span><a name="line-2831"></a><span>         </span><span class="hs-special">]</span><span>
</span><a name="line-2832"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2833"></a><span>    </span><a name="local-6989586621684063512"><a href="#local-6989586621684063512"><span class="hs-identifier">op</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">normalise</span><span>
</span><a name="line-2834"></a><span>    </span><a name="local-6989586621684063513"><a href="#local-6989586621684063513"><span class="hs-identifier">mod</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_mod</span><span> </span><a href="#local-6989586621684063511"><span class="hs-identifier hs-var">mod_summary</span></a><span class="hs-special">)</span><span>
</span><a name="line-2835"></a><span>    </span><a name="local-6989586621684063514"><a href="#local-6989586621684063514"><span class="hs-identifier">mod_str</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#showPpr"><span class="hs-identifier hs-var">showPpr</span></a><span> </span><a href="#local-6989586621684063508"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684063513"><span class="hs-identifier hs-var">mod</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="DriverPhases.html#hscSourceString"><span class="hs-identifier hs-var">hscSourceString</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ms_hsc_src</span><span> </span><a href="#local-6989586621684063511"><span class="hs-identifier hs-var">mod_summary</span></a><span class="hs-special">)</span><span>
</span><a name="line-2836"></a><span>
</span><a name="line-2837"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Recompilation}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2844"></a><span>
</span><a name="line-2845"></a><span class="hs-comment">-- | Indicates whether a given module's source has been modified since it</span><span>
</span><a name="line-2846"></a><span class="hs-comment">-- was last compiled.</span><span>
</span><a name="line-2847"></a><span class="hs-keyword">data</span><span> </span><a name="SourceModified"><a href="HscTypes.html#SourceModified"><span class="hs-identifier">SourceModified</span></a></a><span>
</span><a name="line-2848"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="SourceModified"><a href="HscTypes.html#SourceModified"><span class="hs-identifier">SourceModified</span></a></a><span>
</span><a name="line-2849"></a><span>       </span><span class="hs-comment">-- ^ the source has been modified</span><span>
</span><a name="line-2850"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SourceUnmodified"><a href="HscTypes.html#SourceUnmodified"><span class="hs-identifier">SourceUnmodified</span></a></a><span>
</span><a name="line-2851"></a><span>       </span><span class="hs-comment">-- ^ the source has not been modified.  Compilation may or may</span><span>
</span><a name="line-2852"></a><span>       </span><span class="hs-comment">-- not be necessary, depending on whether any dependencies have</span><span>
</span><a name="line-2853"></a><span>       </span><span class="hs-comment">-- changed since we last compiled.</span><span>
</span><a name="line-2854"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SourceUnmodifiedAndStable"><a href="HscTypes.html#SourceUnmodifiedAndStable"><span class="hs-identifier">SourceUnmodifiedAndStable</span></a></a><span>
</span><a name="line-2855"></a><span>       </span><span class="hs-comment">-- ^ the source has not been modified, and furthermore all of</span><span>
</span><a name="line-2856"></a><span>       </span><span class="hs-comment">-- its (transitive) dependencies are up to date; it definitely</span><span>
</span><a name="line-2857"></a><span>       </span><span class="hs-comment">-- does not need to be recompiled.  This is important for two</span><span>
</span><a name="line-2858"></a><span>       </span><span class="hs-comment">-- reasons: (a) we can omit the version check in checkOldIface,</span><span>
</span><a name="line-2859"></a><span>       </span><span class="hs-comment">-- and (b) if the module used TH splices we don't need to force</span><span>
</span><a name="line-2860"></a><span>       </span><span class="hs-comment">-- recompilation.</span><span>
</span><a name="line-2861"></a><span>
</span><a name="line-2862"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Hpc Support}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2869"></a><span>
</span><a name="line-2870"></a><span class="hs-comment">-- | Information about a modules use of Haskell Program Coverage</span><span>
</span><a name="line-2871"></a><span class="hs-keyword">data</span><span> </span><a name="HpcInfo"><a href="HscTypes.html#HpcInfo"><span class="hs-identifier">HpcInfo</span></a></a><span>
</span><a name="line-2872"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="HpcInfo"><a href="HscTypes.html#HpcInfo"><span class="hs-identifier">HpcInfo</span></a></a><span>
</span><a name="line-2873"></a><span>     </span><span class="hs-special">{</span><span> </span><a name="hpcInfoTickCount"><a href="HscTypes.html#hpcInfoTickCount"><span class="hs-identifier">hpcInfoTickCount</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-2874"></a><span>     </span><span class="hs-special">,</span><span> </span><a name="hpcInfoHash"><a href="HscTypes.html#hpcInfoHash"><span class="hs-identifier">hpcInfoHash</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-2875"></a><span>     </span><span class="hs-special">}</span><span>
</span><a name="line-2876"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="NoHpcInfo"><a href="HscTypes.html#NoHpcInfo"><span class="hs-identifier">NoHpcInfo</span></a></a><span>
</span><a name="line-2877"></a><span>     </span><span class="hs-special">{</span><span> </span><a name="hpcUsed"><a href="HscTypes.html#hpcUsed"><span class="hs-identifier">hpcUsed</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#AnyHpcUsage"><span class="hs-identifier hs-type">AnyHpcUsage</span></a><span>  </span><span class="hs-comment">-- ^ Is hpc used anywhere on the module \*tree\*?</span><span>
</span><a name="line-2878"></a><span>     </span><span class="hs-special">}</span><span>
</span><a name="line-2879"></a><span>
</span><a name="line-2880"></a><span class="hs-comment">-- | This is used to signal if one of my imports used HPC instrumentation</span><span>
</span><a name="line-2881"></a><span class="hs-comment">-- even if there is no module-local HPC usage</span><span>
</span><a name="line-2882"></a><span class="hs-keyword">type</span><span> </span><a name="AnyHpcUsage"><a href="HscTypes.html#AnyHpcUsage"><span class="hs-identifier">AnyHpcUsage</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2883"></a><span>
</span><a name="line-2884"></a><span class="hs-identifier">emptyHpcInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#AnyHpcUsage"><span class="hs-identifier hs-type">AnyHpcUsage</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#HpcInfo"><span class="hs-identifier hs-type">HpcInfo</span></a><span>
</span><a name="line-2885"></a><a name="emptyHpcInfo"><a href="HscTypes.html#emptyHpcInfo"><span class="hs-identifier">emptyHpcInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#NoHpcInfo"><span class="hs-identifier hs-var">NoHpcInfo</span></a><span>
</span><a name="line-2886"></a><span>
</span><a name="line-2887"></a><span class="hs-comment">-- | Find out if HPC is used by this module or any of the modules</span><span>
</span><a name="line-2888"></a><span class="hs-comment">-- it depends upon</span><span>
</span><a name="line-2889"></a><span class="hs-identifier">isHpcUsed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#HpcInfo"><span class="hs-identifier hs-type">HpcInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#AnyHpcUsage"><span class="hs-identifier hs-type">AnyHpcUsage</span></a><span>
</span><a name="line-2890"></a><a name="isHpcUsed"><a href="HscTypes.html#isHpcUsed"><span class="hs-identifier">isHpcUsed</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#HpcInfo"><span class="hs-identifier hs-var">HpcInfo</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2891"></a><span class="hs-identifier">isHpcUsed</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#NoHpcInfo"><span class="hs-identifier hs-var">NoHpcInfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hpcUsed</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684063515"><a href="#local-6989586621684063515"><span class="hs-identifier">used</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063515"><span class="hs-identifier hs-var">used</span></a><span>
</span><a name="line-2892"></a><span>
</span><a name="line-2893"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Safe Haskell Support}
*                                                                      *
************************************************************************

This stuff here is related to supporting the Safe Haskell extension,
primarily about storing under what trust type a module has been compiled.
-}</span><span>
</span><a name="line-2903"></a><span>
</span><a name="line-2904"></a><span class="hs-comment">-- | Is an import a safe import?</span><span>
</span><a name="line-2905"></a><span class="hs-keyword">type</span><span> </span><a name="IsSafeImport"><a href="HscTypes.html#IsSafeImport"><span class="hs-identifier">IsSafeImport</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2906"></a><span>
</span><a name="line-2907"></a><span class="hs-comment">-- | Safe Haskell information for 'ModIface'</span><span>
</span><a name="line-2908"></a><span class="hs-comment">-- Simply a wrapper around SafeHaskellMode to sepperate iface and flags</span><span>
</span><a name="line-2909"></a><span class="hs-keyword">newtype</span><span> </span><a name="IfaceTrustInfo"><a href="HscTypes.html#IfaceTrustInfo"><span class="hs-identifier">IfaceTrustInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="TrustInfo"><a href="HscTypes.html#TrustInfo"><span class="hs-identifier">TrustInfo</span></a></a><span> </span><a href="DynFlags.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a><span>
</span><a name="line-2910"></a><span>
</span><a name="line-2911"></a><span class="hs-identifier">getSafeMode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#IfaceTrustInfo"><span class="hs-identifier hs-type">IfaceTrustInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DynFlags.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a><span>
</span><a name="line-2912"></a><a name="getSafeMode"><a href="HscTypes.html#getSafeMode"><span class="hs-identifier">getSafeMode</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TrustInfo"><span class="hs-identifier hs-var">TrustInfo</span></a><span> </span><a name="local-6989586621684063516"><a href="#local-6989586621684063516"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063516"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2913"></a><span>
</span><a name="line-2914"></a><span class="hs-identifier">setSafeMode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DynFlags.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#IfaceTrustInfo"><span class="hs-identifier hs-type">IfaceTrustInfo</span></a><span>
</span><a name="line-2915"></a><a name="setSafeMode"><a href="HscTypes.html#setSafeMode"><span class="hs-identifier">setSafeMode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#TrustInfo"><span class="hs-identifier hs-var">TrustInfo</span></a><span>
</span><a name="line-2916"></a><span>
</span><a name="line-2917"></a><span class="hs-identifier">noIfaceTrustInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#IfaceTrustInfo"><span class="hs-identifier hs-type">IfaceTrustInfo</span></a><span>
</span><a name="line-2918"></a><a name="noIfaceTrustInfo"><a href="HscTypes.html#noIfaceTrustInfo"><span class="hs-identifier">noIfaceTrustInfo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#setSafeMode"><span class="hs-identifier hs-var">setSafeMode</span></a><span> </span><a href="DynFlags.html#Sf_None"><span class="hs-identifier hs-var">Sf_None</span></a><span>
</span><a name="line-2919"></a><span>
</span><a name="line-2920"></a><span class="hs-identifier">trustInfoToNum</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#IfaceTrustInfo"><span class="hs-identifier hs-type">IfaceTrustInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>
</span><a name="line-2921"></a><a name="trustInfoToNum"><a href="HscTypes.html#trustInfoToNum"><span class="hs-identifier">trustInfoToNum</span></a></a><span> </span><a name="local-6989586621684063517"><a href="#local-6989586621684063517"><span class="hs-identifier">it</span></a></a><span>
</span><a name="line-2922"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="HscTypes.html#getSafeMode"><span class="hs-identifier hs-var">getSafeMode</span></a><span> </span><a href="#local-6989586621684063517"><span class="hs-identifier hs-var">it</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2923"></a><span>            </span><a href="DynFlags.html#Sf_None"><span class="hs-identifier hs-var">Sf_None</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2924"></a><span>            </span><a href="DynFlags.html#Sf_Unsafe"><span class="hs-identifier hs-var">Sf_Unsafe</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2925"></a><span>            </span><a href="DynFlags.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-2926"></a><span>            </span><a href="DynFlags.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-2927"></a><span>            </span><a href="DynFlags.html#Sf_Ignore"><span class="hs-identifier hs-var">Sf_Ignore</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2928"></a><span>
</span><a name="line-2929"></a><span class="hs-identifier">numToTrustInfo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#IfaceTrustInfo"><span class="hs-identifier hs-type">IfaceTrustInfo</span></a><span>
</span><a name="line-2930"></a><a name="numToTrustInfo"><a href="HscTypes.html#numToTrustInfo"><span class="hs-identifier">numToTrustInfo</span></a></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#setSafeMode"><span class="hs-identifier hs-var">setSafeMode</span></a><span> </span><a href="DynFlags.html#Sf_None"><span class="hs-identifier hs-var">Sf_None</span></a><span>
</span><a name="line-2931"></a><span class="hs-identifier">numToTrustInfo</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#setSafeMode"><span class="hs-identifier hs-var">setSafeMode</span></a><span> </span><a href="DynFlags.html#Sf_Unsafe"><span class="hs-identifier hs-var">Sf_Unsafe</span></a><span>
</span><a name="line-2932"></a><span class="hs-identifier">numToTrustInfo</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#setSafeMode"><span class="hs-identifier hs-var">setSafeMode</span></a><span> </span><a href="DynFlags.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a><span>
</span><a name="line-2933"></a><span class="hs-identifier">numToTrustInfo</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#setSafeMode"><span class="hs-identifier hs-var">setSafeMode</span></a><span> </span><a href="DynFlags.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a><span>
</span><a name="line-2934"></a><span class="hs-identifier">numToTrustInfo</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#setSafeMode"><span class="hs-identifier hs-var">setSafeMode</span></a><span> </span><a href="DynFlags.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a><span> </span><span class="hs-comment">-- retained for backwards compat, used</span><span>
</span><a name="line-2935"></a><span>                                       </span><span class="hs-comment">-- to be Sf_SafeInfered but we no longer</span><span>
</span><a name="line-2936"></a><span>                                       </span><span class="hs-comment">-- differentiate.</span><span>
</span><a name="line-2937"></a><span class="hs-identifier">numToTrustInfo</span><span> </span><a name="local-6989586621684063518"><a href="#local-6989586621684063518"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;numToTrustInfo: bad input number! (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684063518"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-2938"></a><span>
</span><a name="line-2939"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="HscTypes.html#IfaceTrustInfo"><span class="hs-identifier hs-type">IfaceTrustInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2940"></a><span>    </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TrustInfo"><span class="hs-identifier hs-var">TrustInfo</span></a><span> </span><a href="DynFlags.html#Sf_None"><span class="hs-identifier hs-var">Sf_None</span></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;none&quot;</span><span>
</span><a name="line-2941"></a><span>    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TrustInfo"><span class="hs-identifier hs-var">TrustInfo</span></a><span> </span><a href="DynFlags.html#Sf_Ignore"><span class="hs-identifier hs-var">Sf_Ignore</span></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;none&quot;</span><span>
</span><a name="line-2942"></a><span>    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TrustInfo"><span class="hs-identifier hs-var">TrustInfo</span></a><span> </span><a href="DynFlags.html#Sf_Unsafe"><span class="hs-identifier hs-var">Sf_Unsafe</span></a><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;unsafe&quot;</span><span>
</span><a name="line-2943"></a><span>    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TrustInfo"><span class="hs-identifier hs-var">TrustInfo</span></a><span> </span><a href="DynFlags.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;trustworthy&quot;</span><span>
</span><a name="line-2944"></a><span>    </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#TrustInfo"><span class="hs-identifier hs-var">TrustInfo</span></a><span> </span><a href="DynFlags.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;safe&quot;</span><span>
</span><a name="line-2945"></a><span>
</span><a name="line-2946"></a><span class="hs-keyword">instance</span><span> </span><a href="Binary.html#Binary"><span class="hs-identifier hs-type">Binary</span></a><span> </span><a href="HscTypes.html#IfaceTrustInfo"><span class="hs-identifier hs-type">IfaceTrustInfo</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2947"></a><span>    </span><a name="local-8214565720325095592"><a href="Binary.html#put_"><span class="hs-identifier">put_</span></a></a><span> </span><a name="local-6989586621684063033"><a href="#local-6989586621684063033"><span class="hs-identifier">bh</span></a></a><span> </span><a name="local-6989586621684063034"><a href="#local-6989586621684063034"><span class="hs-identifier">iftrust</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#putByte"><span class="hs-identifier hs-var">putByte</span></a><span> </span><a href="#local-6989586621684063033"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HscTypes.html#trustInfoToNum"><span class="hs-identifier hs-var">trustInfoToNum</span></a><span> </span><a href="#local-6989586621684063034"><span class="hs-identifier hs-var">iftrust</span></a><span>
</span><a name="line-2948"></a><span>    </span><a name="local-8214565720325095594"><a href="Binary.html#get"><span class="hs-identifier">get</span></a></a><span> </span><a name="local-6989586621684063035"><a href="#local-6989586621684063035"><span class="hs-identifier">bh</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Binary.html#getByte"><span class="hs-identifier hs-var">getByte</span></a><span> </span><a href="#local-6989586621684063035"><span class="hs-identifier hs-var">bh</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HscTypes.html#numToTrustInfo"><span class="hs-identifier hs-var">numToTrustInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-2949"></a><span>
</span><a name="line-2950"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Parser result}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-2957"></a><span>
</span><a name="line-2958"></a><span class="hs-keyword">data</span><span> </span><a name="HsParsedModule"><a href="HscTypes.html#HsParsedModule"><span class="hs-identifier">HsParsedModule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="HsParsedModule"><a href="HscTypes.html#HsParsedModule"><span class="hs-identifier">HsParsedModule</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2959"></a><span>    </span><a name="hpm_module"><a href="HscTypes.html#hpm_module"><span class="hs-identifier">hpm_module</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a><span> </span><span class="hs-special">(</span><a href="HsSyn.html#HsModule"><span class="hs-identifier hs-type">HsModule</span></a><span> </span><a href="HsExtension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2960"></a><span>    </span><a name="hpm_src_files"><a href="HscTypes.html#hpm_src_files"><span class="hs-identifier">hpm_src_files</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-2961"></a><span>       </span><span class="hs-comment">-- ^ extra source files (e.g. from #includes).  The lexer collects</span><span>
</span><a name="line-2962"></a><span>       </span><span class="hs-comment">-- these from '# &lt;file&gt; &lt;line&gt;' pragmas, which the C preprocessor</span><span>
</span><a name="line-2963"></a><span>       </span><span class="hs-comment">-- leaves behind.  These files and their timestamps are stored in</span><span>
</span><a name="line-2964"></a><span>       </span><span class="hs-comment">-- the .hi file, so that we can force recompilation if any of</span><span>
</span><a name="line-2965"></a><span>       </span><span class="hs-comment">-- them change (#3589)</span><span>
</span><a name="line-2966"></a><span>    </span><a name="hpm_annotations"><a href="HscTypes.html#hpm_annotations"><span class="hs-identifier">hpm_annotations</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="ApiAnnotation.html#ApiAnns"><span class="hs-identifier hs-type">ApiAnns</span></a><span>
</span><a name="line-2967"></a><span>    </span><span class="hs-comment">-- See note [Api annotations] in ApiAnnotation.hs</span><span>
</span><a name="line-2968"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-2969"></a><span>
</span><a name="line-2970"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Linkable stuff}
*                                                                      *
************************************************************************

This stuff is in here, rather than (say) in Linker.hs, because the Linker.hs
stuff is the *dynamic* linker, and isn't present in a stage-1 compiler
-}</span><span>
</span><a name="line-2980"></a><span>
</span><a name="line-2981"></a><span class="hs-comment">-- | Information we can use to dynamically link modules into the compiler</span><span>
</span><a name="line-2982"></a><span class="hs-keyword">data</span><span> </span><a name="Linkable"><a href="HscTypes.html#Linkable"><span class="hs-identifier">Linkable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="LM"><a href="HscTypes.html#LM"><span class="hs-identifier">LM</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2983"></a><span>  </span><a name="linkableTime"><a href="HscTypes.html#linkableTime"><span class="hs-identifier">linkableTime</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">UTCTime</span><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- ^ Time at which this linkable was built</span><span>
</span><a name="line-2984"></a><span>                                        </span><span class="hs-comment">-- (i.e. when the bytecodes were produced,</span><span>
</span><a name="line-2985"></a><span>                                        </span><span class="hs-comment">--       or the mod date on the files)</span><span>
</span><a name="line-2986"></a><span>  </span><a name="linkableModule"><a href="HscTypes.html#linkableModule"><span class="hs-identifier">linkableModule</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Module.html#Module"><span class="hs-identifier hs-type">Module</span></a><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- ^ The linkable module itself</span><span>
</span><a name="line-2987"></a><span>  </span><a name="linkableUnlinked"><a href="HscTypes.html#linkableUnlinked"><span class="hs-identifier">linkableUnlinked</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#Unlinked"><span class="hs-identifier hs-type">Unlinked</span></a><span class="hs-special">]</span><span>
</span><a name="line-2988"></a><span>    </span><span class="hs-comment">-- ^ Those files and chunks of code we have yet to link.</span><span>
</span><a name="line-2989"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-2990"></a><span>    </span><span class="hs-comment">-- INVARIANT: A valid linkable always has at least one 'Unlinked' item.</span><span>
</span><a name="line-2991"></a><span>    </span><span class="hs-comment">-- If this list is empty, the Linkable represents a fake linkable, which</span><span>
</span><a name="line-2992"></a><span>    </span><span class="hs-comment">-- is generated in HscNothing mode to avoid recompiling modules.</span><span>
</span><a name="line-2993"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-2994"></a><span>    </span><span class="hs-comment">-- ToDo: Do items get removed from this list when they get linked?</span><span>
</span><a name="line-2995"></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2996"></a><span>
</span><a name="line-2997"></a><span class="hs-identifier">isObjectLinkable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-2998"></a><a name="isObjectLinkable"><a href="HscTypes.html#isObjectLinkable"><span class="hs-identifier">isObjectLinkable</span></a></a><span> </span><a name="local-6989586621684063519"><a href="#local-6989586621684063519"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621684063520"><span class="hs-identifier hs-var">unlinked</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><a href="HscTypes.html#isObject"><span class="hs-identifier hs-var">isObject</span></a><span> </span><a href="#local-6989586621684063520"><span class="hs-identifier hs-var">unlinked</span></a><span>
</span><a name="line-2999"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684063520"><a href="#local-6989586621684063520"><span class="hs-identifier">unlinked</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">linkableUnlinked</span><span> </span><a href="#local-6989586621684063519"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-3000"></a><span>        </span><span class="hs-comment">-- A linkable with no Unlinked's is treated as a BCO.  We can</span><span>
</span><a name="line-3001"></a><span>        </span><span class="hs-comment">-- generate a linkable with no Unlinked's as a result of</span><span>
</span><a name="line-3002"></a><span>        </span><span class="hs-comment">-- compiling a module in HscNothing mode, and this choice</span><span>
</span><a name="line-3003"></a><span>        </span><span class="hs-comment">-- happens to work well with checkStability in module GHC.</span><span>
</span><a name="line-3004"></a><span>
</span><a name="line-3005"></a><span class="hs-identifier">linkableObjs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">]</span><span>
</span><a name="line-3006"></a><a name="linkableObjs"><a href="HscTypes.html#linkableObjs"><span class="hs-identifier">linkableObjs</span></a></a><span> </span><a name="local-6989586621684063521"><a href="#local-6989586621684063521"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621684063522"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="HscTypes.html#DotO"><span class="hs-identifier hs-var">DotO</span></a><span> </span><a name="local-6989586621684063522"><a href="#local-6989586621684063522"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">linkableUnlinked</span><span> </span><a href="#local-6989586621684063521"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-3007"></a><span>
</span><a name="line-3008"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="HscTypes.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3009"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#LM"><span class="hs-identifier hs-var">LM</span></a><span> </span><a name="local-6989586621684063030"><a href="#local-6989586621684063030"><span class="hs-identifier">when_made</span></a></a><span> </span><a name="local-6989586621684063031"><a href="#local-6989586621684063031"><span class="hs-identifier">mod</span></a></a><span> </span><a name="local-6989586621684063032"><a href="#local-6989586621684063032"><span class="hs-identifier">unlinkeds</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3010"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;LinkableM&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a><span> </span><span class="hs-special">(</span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684063030"><span class="hs-identifier hs-var">when_made</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063031"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span>
</span><a name="line-3011"></a><span>        </span><a href="Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a><span> </span><a href="Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a><span> </span><span class="hs-number">3</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063032"><span class="hs-identifier hs-var">unlinkeds</span></a><span class="hs-special">)</span><span>
</span><a name="line-3012"></a><span>
</span><a name="line-3013"></a><span class="hs-comment">-------------------------------------------</span><span>
</span><a name="line-3014"></a><span>
</span><a name="line-3015"></a><span class="hs-comment">-- | Objects which have yet to be linked by the compiler</span><span>
</span><a name="line-3016"></a><span class="hs-keyword">data</span><span> </span><a name="Unlinked"><a href="HscTypes.html#Unlinked"><span class="hs-identifier">Unlinked</span></a></a><span>
</span><a name="line-3017"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="DotO"><a href="HscTypes.html#DotO"><span class="hs-identifier">DotO</span></a></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>      </span><span class="hs-comment">-- ^ An object file (.o)</span><span>
</span><a name="line-3018"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="DotA"><a href="HscTypes.html#DotA"><span class="hs-identifier">DotA</span></a></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>      </span><span class="hs-comment">-- ^ Static archive file (.a)</span><span>
</span><a name="line-3019"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="DotDLL"><a href="HscTypes.html#DotDLL"><span class="hs-identifier">DotDLL</span></a></a><span> </span><span class="hs-identifier hs-type">FilePath</span><span>    </span><span class="hs-comment">-- ^ Dynamically linked library file (.so, .dll, .dylib)</span><span>
</span><a name="line-3020"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a name="BCOs"><a href="HscTypes.html#BCOs"><span class="hs-identifier">BCOs</span></a></a><span> </span><a href="ByteCodeTypes.html#CompiledByteCode"><span class="hs-identifier hs-type">CompiledByteCode</span></a><span>
</span><a name="line-3021"></a><span>          </span><span class="hs-special">[</span><a href="HscTypes.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ A byte-code object, lives only in memory. Also</span><span>
</span><a name="line-3022"></a><span>                        </span><span class="hs-comment">-- carries some static pointer table entries which</span><span>
</span><a name="line-3023"></a><span>                        </span><span class="hs-comment">-- should be loaded along with the BCOs.</span><span>
</span><a name="line-3024"></a><span>                        </span><span class="hs-comment">-- See Note [Grant plan for static forms] in</span><span>
</span><a name="line-3025"></a><span>                        </span><span class="hs-comment">-- StaticPtrTable.</span><span>
</span><a name="line-3026"></a><span>
</span><a name="line-3027"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="HscTypes.html#Unlinked"><span class="hs-identifier hs-type">Unlinked</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3028"></a><span>   </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#DotO"><span class="hs-identifier hs-var">DotO</span></a><span> </span><a name="local-6989586621684063025"><a href="#local-6989586621684063025"><span class="hs-identifier">path</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;DotO&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621684063025"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-3029"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#DotA"><span class="hs-identifier hs-var">DotA</span></a><span> </span><a name="local-6989586621684063026"><a href="#local-6989586621684063026"><span class="hs-identifier">path</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;DotA&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621684063026"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-3030"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#DotDLL"><span class="hs-identifier hs-var">DotDLL</span></a><span> </span><a name="local-6989586621684063027"><a href="#local-6989586621684063027"><span class="hs-identifier">path</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;DotDLL&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><a href="#local-6989586621684063027"><span class="hs-identifier hs-var">path</span></a><span>
</span><a name="line-3031"></a><span>   </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#BCOs"><span class="hs-identifier hs-var">BCOs</span></a><span> </span><a name="local-6989586621684063028"><a href="#local-6989586621684063028"><span class="hs-identifier">bcos</span></a></a><span> </span><a name="local-6989586621684063029"><a href="#local-6989586621684063029"><span class="hs-identifier">spt</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;BCOs&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063028"><span class="hs-identifier hs-var">bcos</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063029"><span class="hs-identifier hs-var">spt</span></a><span>
</span><a name="line-3032"></a><span>
</span><a name="line-3033"></a><span class="hs-comment">-- | Is this an actual file on disk we can link in somehow?</span><span>
</span><a name="line-3034"></a><span class="hs-identifier">isObject</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Unlinked"><span class="hs-identifier hs-type">Unlinked</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3035"></a><a name="isObject"><a href="HscTypes.html#isObject"><span class="hs-identifier">isObject</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#DotO"><span class="hs-identifier hs-var">DotO</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3036"></a><span class="hs-identifier">isObject</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#DotA"><span class="hs-identifier hs-var">DotA</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3037"></a><span class="hs-identifier">isObject</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#DotDLL"><span class="hs-identifier hs-var">DotDLL</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3038"></a><span class="hs-identifier">isObject</span><span> </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-3039"></a><span>
</span><a name="line-3040"></a><span class="hs-comment">-- | Is this a bytecode linkable with no file on disk?</span><span>
</span><a name="line-3041"></a><span class="hs-identifier">isInterpretable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Unlinked"><span class="hs-identifier hs-type">Unlinked</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3042"></a><a name="isInterpretable"><a href="HscTypes.html#isInterpretable"><span class="hs-identifier">isInterpretable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HscTypes.html#isObject"><span class="hs-identifier hs-var">isObject</span></a><span>
</span><a name="line-3043"></a><span>
</span><a name="line-3044"></a><span class="hs-comment">-- | Retrieve the filename of the linkable if possible. Panic if it is a byte-code object</span><span>
</span><a name="line-3045"></a><span class="hs-identifier">nameOfObject</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Unlinked"><span class="hs-identifier hs-type">Unlinked</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span>
</span><a name="line-3046"></a><a name="nameOfObject"><a href="HscTypes.html#nameOfObject"><span class="hs-identifier">nameOfObject</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#DotO"><span class="hs-identifier hs-var">DotO</span></a><span> </span><a name="local-6989586621684063523"><a href="#local-6989586621684063523"><span class="hs-identifier">fn</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063523"><span class="hs-identifier hs-var">fn</span></a><span>
</span><a name="line-3047"></a><span class="hs-identifier">nameOfObject</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#DotA"><span class="hs-identifier hs-var">DotA</span></a><span> </span><a name="local-6989586621684063524"><a href="#local-6989586621684063524"><span class="hs-identifier">fn</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063524"><span class="hs-identifier hs-var">fn</span></a><span>
</span><a name="line-3048"></a><span class="hs-identifier">nameOfObject</span><span> </span><span class="hs-special">(</span><a href="HscTypes.html#DotDLL"><span class="hs-identifier hs-var">DotDLL</span></a><span> </span><a name="local-6989586621684063525"><a href="#local-6989586621684063525"><span class="hs-identifier">fn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063525"><span class="hs-identifier hs-var">fn</span></a><span>
</span><a name="line-3049"></a><span class="hs-identifier">nameOfObject</span><span> </span><a name="local-6989586621684063526"><a href="#local-6989586621684063526"><span class="hs-identifier">other</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;nameOfObject&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063526"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-3050"></a><span>
</span><a name="line-3051"></a><span class="hs-comment">-- | Retrieve the compiled byte-code if possible. Panic if it is a file-based linkable</span><span>
</span><a name="line-3052"></a><span class="hs-identifier">byteCodeOfObject</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#Unlinked"><span class="hs-identifier hs-type">Unlinked</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="ByteCodeTypes.html#CompiledByteCode"><span class="hs-identifier hs-type">CompiledByteCode</span></a><span>
</span><a name="line-3053"></a><a name="byteCodeOfObject"><a href="HscTypes.html#byteCodeOfObject"><span class="hs-identifier">byteCodeOfObject</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#BCOs"><span class="hs-identifier hs-var">BCOs</span></a><span> </span><a name="local-6989586621684063527"><a href="#local-6989586621684063527"><span class="hs-identifier">bc</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684063527"><span class="hs-identifier hs-var">bc</span></a><span>
</span><a name="line-3054"></a><span class="hs-identifier">byteCodeOfObject</span><span> </span><a name="local-6989586621684063528"><a href="#local-6989586621684063528"><span class="hs-identifier">other</span></a></a><span>       </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a><span> </span><span class="hs-string">&quot;byteCodeOfObject&quot;</span><span> </span><span class="hs-special">(</span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063528"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-3055"></a><span>
</span><a name="line-3056"></a><span>
</span><a name="line-3057"></a><span class="hs-comment">-------------------------------------------</span><span>
</span><a name="line-3058"></a><span>
</span><a name="line-3059"></a><span class="hs-comment">-- | A list of conlikes which represents a complete pattern match.</span><span>
</span><a name="line-3060"></a><span class="hs-comment">-- These arise from @COMPLETE@ signatures.</span><span>
</span><a name="line-3061"></a><span>
</span><a name="line-3062"></a><span class="hs-comment">-- See Note [Implementation of COMPLETE signatures]</span><span>
</span><a name="line-3063"></a><span class="hs-keyword">data</span><span> </span><a name="CompleteMatch"><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier">CompleteMatch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CompleteMatch"><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier">CompleteMatch</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-3064"></a><span>                            </span><a name="completeMatchConLikes"><a href="HscTypes.html#completeMatchConLikes"><span class="hs-identifier">completeMatchConLikes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span>
</span><a name="line-3065"></a><span>                            </span><span class="hs-comment">-- ^ The ConLikes that form a covering family</span><span>
</span><a name="line-3066"></a><span>                            </span><span class="hs-comment">-- (e.g. Nothing, Just)</span><span>
</span><a name="line-3067"></a><span>                          </span><span class="hs-special">,</span><span> </span><a name="completeMatchTyCon"><a href="HscTypes.html#completeMatchTyCon"><span class="hs-identifier">completeMatchTyCon</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-3068"></a><span>                            </span><span class="hs-comment">-- ^ The TyCon that they cover (e.g. Maybe)</span><span>
</span><a name="line-3069"></a><span>                          </span><span class="hs-special">}</span><span>
</span><a name="line-3070"></a><span>
</span><a name="line-3071"></a><span class="hs-keyword">instance</span><span> </span><a href="Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a><span> </span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3072"></a><span>  </span><a name="local-8214565720324887700"><a href="Outputable.html#ppr"><span class="hs-identifier">ppr</span></a></a><span> </span><span class="hs-special">(</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-var">CompleteMatch</span></a><span> </span><a name="local-6989586621684063023"><a href="#local-6989586621684063023"><span class="hs-identifier">cl</span></a></a><span> </span><a name="local-6989586621684063024"><a href="#local-6989586621684063024"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Outputable.html#text"><span class="hs-identifier hs-var">text</span></a><span> </span><span class="hs-string">&quot;CompleteMatch:&quot;</span><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063023"><span class="hs-identifier hs-var">cl</span></a><span>
</span><a name="line-3073"></a><span>                                                    </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a><span> </span><a href="Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a><span> </span><a href="Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a><span> </span><a href="#local-6989586621684063024"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-3074"></a><span>
</span><a name="line-3075"></a><span class="hs-comment">-- | A map keyed by the 'completeMatchTyCon'.</span><span>
</span><a name="line-3076"></a><span>
</span><a name="line-3077"></a><span class="hs-comment">-- See Note [Implementation of COMPLETE signatures]</span><span>
</span><a name="line-3078"></a><span class="hs-keyword">type</span><span> </span><a name="CompleteMatchMap"><a href="HscTypes.html#CompleteMatchMap"><span class="hs-identifier">CompleteMatchMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#UniqFM"><span class="hs-identifier hs-type">UniqFM</span></a><span> </span><span class="hs-special">[</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">]</span><span>
</span><a name="line-3079"></a><span>
</span><a name="line-3080"></a><span class="hs-identifier">mkCompleteMatchMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#CompleteMatchMap"><span class="hs-identifier hs-type">CompleteMatchMap</span></a><span>
</span><a name="line-3081"></a><a name="mkCompleteMatchMap"><a href="HscTypes.html#mkCompleteMatchMap"><span class="hs-identifier">mkCompleteMatchMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HscTypes.html#extendCompleteMatchMap"><span class="hs-identifier hs-var">extendCompleteMatchMap</span></a><span> </span><a href="UniqFM.html#emptyUFM"><span class="hs-identifier hs-var">emptyUFM</span></a><span>
</span><a name="line-3082"></a><span>
</span><a name="line-3083"></a><span class="hs-identifier">extendCompleteMatchMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#CompleteMatchMap"><span class="hs-identifier hs-type">CompleteMatchMap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span class="hs-special">]</span><span>
</span><a name="line-3084"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#CompleteMatchMap"><span class="hs-identifier hs-type">CompleteMatchMap</span></a><span>
</span><a name="line-3085"></a><a name="extendCompleteMatchMap"><a href="HscTypes.html#extendCompleteMatchMap"><span class="hs-identifier">extendCompleteMatchMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><a href="#local-6989586621684063529"><span class="hs-identifier hs-var">insertMatch</span></a><span>
</span><a name="line-3086"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-3087"></a><span>    </span><span class="hs-identifier">insertMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HscTypes.html#CompleteMatchMap"><span class="hs-identifier hs-type">CompleteMatchMap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-type">CompleteMatch</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HscTypes.html#CompleteMatchMap"><span class="hs-identifier hs-type">CompleteMatchMap</span></a><span>
</span><a name="line-3088"></a><span>    </span><a name="local-6989586621684063529"><a href="#local-6989586621684063529"><span class="hs-identifier">insertMatch</span></a></a><span> </span><a name="local-6989586621684063530"><a href="#local-6989586621684063530"><span class="hs-identifier">ufm</span></a></a><span> </span><a name="local-6989586621684063531"><a href="#local-6989586621684063531"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="HscTypes.html#CompleteMatch"><span class="hs-identifier hs-var">CompleteMatch</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684063532"><a href="#local-6989586621684063532"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="UniqFM.html#addToUFM_C"><span class="hs-identifier hs-var">addToUFM_C</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684063530"><span class="hs-identifier hs-var">ufm</span></a><span> </span><a href="#local-6989586621684063532"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684063531"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-3089"></a><span>
</span><a name="line-3090"></a><span class="hs-comment">{-
Note [Implementation of COMPLETE signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
A COMPLETE signature represents a set of conlikes (i.e., constructors or
pattern synonyms) such that if they are all pattern-matched against in a
function, it gives rise to a total function. An example is:

  newtype Boolean = Boolean Int
  pattern F, T :: Boolean
  pattern F = Boolean 0
  pattern T = Boolean 1
  {-# COMPLETE F, T #-}

  -- This is a total function
  booleanToInt :: Boolean -&gt; Int
  booleanToInt F = 0
  booleanToInt T = 1

COMPLETE sets are represented internally in GHC with the CompleteMatch data
type. For example, {-# COMPLETE F, T #-} would be represented as:

  CompleteMatch { complateMatchConLikes = [F, T]
                , completeMatchTyCon    = Boolean }

Note that GHC was able to infer the completeMatchTyCon (Boolean), but for the
cases in which it's ambiguous, you can also explicitly specify it in the source
language by writing this:

  {-# COMPLETE F, T :: Boolean #-}

For efficiency purposes, GHC collects all of the CompleteMatches that it knows
about into a CompleteMatchMap, which is a map that is keyed by the
completeMatchTyCon. In other words, you could have a multiple COMPLETE sets
for the same TyCon:

  {-# COMPLETE F, T1 :: Boolean #-}
  {-# COMPLETE F, T2 :: Boolean #-}

And looking up the values in the CompleteMatchMap associated with Boolean
would give you [CompleteMatch [F, T1] Boolean, CompleteMatch [F, T2] Boolean].
dsGetCompleteMatches in DsMeta accomplishes this lookup.

Also see Note [Typechecking Complete Matches] in TcBinds for a more detailed
explanation for how GHC ensures that all the conlikes in a COMPLETE set are
consistent.
-}</span><span>
</span><a name="line-3136"></a></pre></body></html>