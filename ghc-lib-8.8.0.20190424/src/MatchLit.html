<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998


Pattern-matching literal patterns
-}</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE CPP, ScopedTypeVariables #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">MatchLit</span><span> </span><span class="hs-special">(</span><span> </span><a href="MatchLit.html#dsLit"><span class="hs-identifier hs-var">dsLit</span></a><span class="hs-special">,</span><span> </span><a href="MatchLit.html#dsOverLit"><span class="hs-identifier hs-var">dsOverLit</span></a><span class="hs-special">,</span><span> </span><a href="MatchLit.html#hsLitKey"><span class="hs-identifier hs-var">hsLitKey</span></a><span>
</span><a name="line-13"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="MatchLit.html#tidyLitPat"><span class="hs-identifier hs-var">tidyLitPat</span></a><span class="hs-special">,</span><span> </span><a href="MatchLit.html#tidyNPat"><span class="hs-identifier hs-var">tidyNPat</span></a><span>
</span><a name="line-14"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="MatchLit.html#matchLiterals"><span class="hs-identifier hs-var">matchLiterals</span></a><span class="hs-special">,</span><span> </span><a href="MatchLit.html#matchNPlusKPats"><span class="hs-identifier hs-var">matchNPlusKPats</span></a><span class="hs-special">,</span><span> </span><a href="MatchLit.html#matchNPats"><span class="hs-identifier hs-var">matchNPats</span></a><span>
</span><a name="line-15"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="MatchLit.html#warnAboutIdentities"><span class="hs-identifier hs-var">warnAboutIdentities</span></a><span>
</span><a name="line-16"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="MatchLit.html#warnAboutOverflowedOverLit"><span class="hs-identifier hs-var">warnAboutOverflowedOverLit</span></a><span class="hs-special">,</span><span> </span><a href="MatchLit.html#warnAboutOverflowedLit"><span class="hs-identifier hs-var">warnAboutOverflowedLit</span></a><span>
</span><a name="line-17"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="MatchLit.html#warnAboutEmptyEnumerations"><span class="hs-identifier hs-var">warnAboutEmptyEnumerations</span></a><span>
</span><a name="line-18"></a><span>                </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="Match.html"><span class="hs-identifier">Match</span></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Match.html#match"><span class="hs-identifier hs-var">match</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="DsExpr.html"><span class="hs-identifier">DsExpr</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="DsExpr.html#dsExpr"><span class="hs-identifier hs-var">dsExpr</span></a><span class="hs-special">,</span><span> </span><a href="DsExpr.html#dsSyntaxExpr"><span class="hs-identifier hs-var">dsSyntaxExpr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="DsMonad.html"><span class="hs-identifier">DsMonad</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="DsUtils.html"><span class="hs-identifier">DsUtils</span></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HsSyn</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Id</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreSyn</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">MkCore</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TyCon</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DataCon</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="TcHsSyn.html"><span class="hs-identifier">TcHsSyn</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="TcHsSyn.html#shortCutLit"><span class="hs-identifier hs-var">shortCutLit</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcType</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PrelNames</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysWiredIn</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysPrim</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Literal</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Ratio</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.LanguageExtensions</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Int</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Proxy</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Desugaring literals
        [used to be in DsExpr, but DsMeta needs it,
         and it's nice to avoid a loop]
*                                                                      *
************************************************************************

We give int/float literals type @Integer@ and @Rational@, respectively.
The typechecker will (presumably) have put \tr{from{Integer,Rational}s}
around them.

ToDo: put in range checks for when converting ``@i@''
(or should that be in the typechecker?)

For numeric literals, we try to detect there use at a standard type
(@Int@, @Float@, etc.) are directly put in the right constructor.
[NB: down with the @App@ conversion.]

See also below where we look for @DictApps@ for \tr{plusInt}, etc.
-}</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span class="hs-identifier">dsLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsLit</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span>
</span><a name="line-83"></a><a name="dsLit"><a href="MatchLit.html#dsLit"><span class="hs-identifier">dsLit</span></a></a><span> </span><a name="local-6989586621681865247"><a href="#local-6989586621681865247"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-84"></a><span>  </span><a name="local-6989586621681865248"><a href="#local-6989586621681865248"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-85"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681865247"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-identifier hs-var">HsStringPrim</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865249"><a href="#local-6989586621681865249"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitString</span><span> </span><a href="#local-6989586621681865249"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-identifier hs-var">HsCharPrim</span><span>   </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865250"><a href="#local-6989586621681865250"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitChar</span><span> </span><a href="#local-6989586621681865250"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-identifier hs-var">HsIntPrim</span><span>    </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865251"><a href="#local-6989586621681865251"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkLitIntWrap</span><span> </span><a href="#local-6989586621681865248"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681865251"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-identifier hs-var">HsWordPrim</span><span>   </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865252"><a href="#local-6989586621681865252"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkLitWordWrap</span><span> </span><a href="#local-6989586621681865248"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681865252"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-identifier hs-var">HsInt64Prim</span><span>  </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865253"><a href="#local-6989586621681865253"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkLitInt64Wrap</span><span> </span><a href="#local-6989586621681865248"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681865253"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-identifier hs-var">HsWord64Prim</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865254"><a href="#local-6989586621681865254"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkLitWord64Wrap</span><span> </span><a href="#local-6989586621681865248"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681865254"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-identifier hs-var">HsFloatPrim</span><span>  </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865255"><a href="#local-6989586621681865255"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitFloat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fl_value</span><span> </span><a href="#local-6989586621681865255"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-identifier hs-var">HsDoublePrim</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865256"><a href="#local-6989586621681865256"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitDouble</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fl_value</span><span> </span><a href="#local-6989586621681865256"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>    </span><span class="hs-identifier hs-var">HsChar</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865257"><a href="#local-6989586621681865257"><span class="hs-identifier">c</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCharExpr</span><span> </span><a href="#local-6989586621681865257"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-identifier hs-var">HsString</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865258"><a href="#local-6989586621681865258"><span class="hs-identifier">str</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkStringExprFS</span><span> </span><a href="#local-6989586621681865258"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-96"></a><span>    </span><span class="hs-identifier hs-var">HsInteger</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865259"><a href="#local-6989586621681865259"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkIntegerExpr</span><span> </span><a href="#local-6989586621681865259"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-97"></a><span>    </span><span class="hs-identifier hs-var">HsInt</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865260"><a href="#local-6989586621681865260"><span class="hs-identifier">i</span></a></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkIntExpr</span><span> </span><a href="#local-6989586621681865248"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">il_value</span><span> </span><a href="#local-6989586621681865260"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-identifier hs-var">XLit</span><span> </span><a name="local-6989586621681865261"><a href="#local-6989586621681865261"><span class="hs-identifier">x</span></a></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;dsLit&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681865261"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-identifier hs-var">HsRat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FL</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865262"><a href="#local-6989586621681865262"><span class="hs-identifier">val</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681865263"><a href="#local-6989586621681865263"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-100"></a><span>      </span><a name="local-6989586621681865269"><a href="#local-6989586621681865269"><span class="hs-identifier">num</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mkIntegerExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">numerator</span><span> </span><a href="#local-6989586621681865262"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>      </span><a name="local-6989586621681865270"><a href="#local-6989586621681865270"><span class="hs-identifier">denom</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mkIntegerExpr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">denominator</span><span> </span><a href="#local-6989586621681865262"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCoreConApps</span><span> </span><a href="#local-6989586621681865264"><span class="hs-identifier hs-var">ratio_data_con</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Type</span><span> </span><a href="#local-6989586621681865265"><span class="hs-identifier hs-var">integer_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865269"><span class="hs-identifier hs-var">num</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865270"><span class="hs-identifier hs-var">denom</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-104"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621681865264"><a href="#local-6989586621681865264"><span class="hs-identifier">ratio_data_con</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681865265"><a href="#local-6989586621681865265"><span class="hs-identifier">integer_ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">tcSplitTyConApp</span><span> </span><a href="#local-6989586621681865263"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-106"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621681865266"><a href="#local-6989586621681865266"><span class="hs-identifier">tycon</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621681865267"><a href="#local-6989586621681865267"><span class="hs-identifier">i_ty</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier">isIntegerTy</span><span> </span><span class="hs-identifier">i_ty</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">tycon</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">hasKey</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">ratioTyConKey</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>                                       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyConDataCons</span><span> </span><a href="#local-6989586621681865266"><span class="hs-identifier hs-var">tycon</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865267"><span class="hs-identifier hs-var">i_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>                    </span><a name="local-6989586621681865268"><a href="#local-6989586621681865268"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;dsLit&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681865268"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-identifier">dsOverLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsOverLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span>
</span><a name="line-111"></a><span class="hs-comment">-- ^ Post-typechecker, the 'HsExpr' field of an 'OverLit' contains</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- (an expression for) the literal value itself.</span><span>
</span><a name="line-113"></a><a name="dsOverLit"><a href="MatchLit.html#dsOverLit"><span class="hs-identifier">dsOverLit</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OverLit</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ol_val</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681865271"><a href="#local-6989586621681865271"><span class="hs-identifier">val</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">OverLitTc</span><span> </span><a name="local-6989586621681865272"><a href="#local-6989586621681865272"><span class="hs-identifier">rebindable</span></a></a><span> </span><a name="local-6989586621681865273"><a href="#local-6989586621681865273"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-114"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_witness</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681865274"><a href="#local-6989586621681865274"><span class="hs-identifier">witness</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-115"></a><span>  </span><a name="local-6989586621681865275"><a href="#local-6989586621681865275"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-116"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="TcHsSyn.html#shortCutLit"><span class="hs-identifier hs-var">shortCutLit</span></a><span> </span><a href="#local-6989586621681865275"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681865271"><span class="hs-identifier hs-var">val</span></a><span> </span><a href="#local-6989586621681865273"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-117"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681865276"><a href="#local-6989586621681865276"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621681865272"><span class="hs-identifier hs-var">rebindable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsExpr.html#dsExpr"><span class="hs-identifier hs-var">dsExpr</span></a><span> </span><a href="#local-6989586621681865276"><span class="hs-identifier hs-var">expr</span></a><span>        </span><span class="hs-comment">-- Note [Literal short cut]</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-identifier">_</span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsExpr.html#dsExpr"><span class="hs-identifier hs-var">dsExpr</span></a><span> </span><a href="#local-6989586621681865274"><span class="hs-identifier hs-var">witness</span></a><span>
</span><a name="line-119"></a><span class="hs-identifier">dsOverLit</span><span> </span><span class="hs-identifier hs-var">XOverLit</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;dsOverLit&quot;</span><span>
</span><a name="line-120"></a><span class="hs-comment">{-
Note [Literal short cut]
~~~~~~~~~~~~~~~~~~~~~~~~
The type checker tries to do this short-cutting as early as possible, but
because of unification etc, more information is available to the desugarer.
And where it's possible to generate the correct literal right away, it's
much better to do so.


************************************************************************
*                                                                      *
                 Warnings about overflowed literals
*                                                                      *
************************************************************************

Warn about functions like toInteger, fromIntegral, that convert
between one type and another when the to- and from- types are the
same.  Then it's probably (albeit not definitely) the identity
-}</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-identifier">warnAboutIdentities</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-141"></a><a name="warnAboutIdentities"><a href="MatchLit.html#warnAboutIdentities"><span class="hs-identifier">warnAboutIdentities</span></a></a><span> </span><a name="local-6989586621681865277"><a href="#local-6989586621681865277"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><a name="local-6989586621681865278"><a href="#local-6989586621681865278"><span class="hs-identifier">conv_fn</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681865279"><a href="#local-6989586621681865279"><span class="hs-identifier">type_of_conv</span></a></a><span>
</span><a name="line-142"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">wopt</span><span> </span><span class="hs-identifier hs-var">Opt_WarnIdentities</span><span> </span><a href="#local-6989586621681865277"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-143"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">idName</span><span> </span><a href="#local-6989586621681865278"><span class="hs-identifier hs-var">conv_fn</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="MatchLit.html#conversionNames"><span class="hs-identifier hs-var">conversionNames</span></a><span>
</span><a name="line-144"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681865280"><a href="#local-6989586621681865280"><span class="hs-identifier">arg_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681865281"><a href="#local-6989586621681865281"><span class="hs-identifier">res_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">splitFunTy_maybe</span><span> </span><a href="#local-6989586621681865279"><span class="hs-identifier hs-var">type_of_conv</span></a><span>
</span><a name="line-145"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865280"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681865281"><span class="hs-identifier hs-var">res_ty</span></a><span>  </span><span class="hs-comment">-- So we are converting  ty -&gt; ty</span><span>
</span><a name="line-146"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="DsMonad.html#warnDs"><span class="hs-identifier hs-var">warnDs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Reason</span><span> </span><span class="hs-identifier hs-var">Opt_WarnIdentities</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Call of&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681865278"><span class="hs-identifier hs-var">conv_fn</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">dcolon</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681865279"><span class="hs-identifier hs-var">type_of_conv</span></a><span>
</span><a name="line-148"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;can probably be omitted&quot;</span><span>
</span><a name="line-149"></a><span>           </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span class="hs-identifier">warnAboutIdentities</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span class="hs-identifier">conversionNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-153"></a><a name="conversionNames"><a href="MatchLit.html#conversionNames"><span class="hs-identifier">conversionNames</span></a></a><span>
</span><a name="line-154"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">toIntegerName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toRationalName</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegralName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">realToFracName</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-156"></a><span> </span><span class="hs-comment">-- We can't easily add fromIntegerName, fromRationalName,</span><span>
</span><a name="line-157"></a><span> </span><span class="hs-comment">-- because they are generated by literals</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-comment">-- | Emit warnings on overloaded integral literals which overflow the bounds</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- implied by their type.</span><span>
</span><a name="line-162"></a><span class="hs-identifier">warnAboutOverflowedOverLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsOverLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-163"></a><a name="warnAboutOverflowedOverLit"><a href="MatchLit.html#warnAboutOverflowedOverLit"><span class="hs-identifier">warnAboutOverflowedOverLit</span></a></a><span> </span><a name="local-6989586621681865282"><a href="#local-6989586621681865282"><span class="hs-identifier">hsOverLit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-164"></a><span>  </span><a name="local-6989586621681865283"><a href="#local-6989586621681865283"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-165"></a><span>  </span><a href="MatchLit.html#warnAboutOverflowedLiterals"><span class="hs-identifier hs-var">warnAboutOverflowedLiterals</span></a><span> </span><a href="#local-6989586621681865283"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="MatchLit.html#getIntegralLit"><span class="hs-identifier hs-var">getIntegralLit</span></a><span> </span><a href="#local-6989586621681865282"><span class="hs-identifier hs-var">hsOverLit</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-comment">-- | Emit warnings on integral literals which overflow the boudns implied by</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- their type.</span><span>
</span><a name="line-169"></a><span class="hs-identifier">warnAboutOverflowedLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><a name="warnAboutOverflowedLit"><a href="MatchLit.html#warnAboutOverflowedLit"><span class="hs-identifier">warnAboutOverflowedLit</span></a></a><span> </span><a name="local-6989586621681865284"><a href="#local-6989586621681865284"><span class="hs-identifier">hsLit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-171"></a><span>  </span><a name="local-6989586621681865285"><a href="#local-6989586621681865285"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-172"></a><span>  </span><a href="MatchLit.html#warnAboutOverflowedLiterals"><span class="hs-identifier hs-var">warnAboutOverflowedLiterals</span></a><span> </span><a href="#local-6989586621681865285"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><a href="MatchLit.html#getSimpleIntegralLit"><span class="hs-identifier hs-var">getSimpleIntegralLit</span></a><span> </span><a href="#local-6989586621681865284"><span class="hs-identifier hs-var">hsLit</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">-- | Emit warnings on integral literals which overflow the bounds implied by</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- their type.</span><span>
</span><a name="line-176"></a><span class="hs-identifier">warnAboutOverflowedLiterals</span><span>
</span><a name="line-177"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-178"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ the literal value and name of its tycon</span><span>
</span><a name="line-179"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-180"></a><a name="warnAboutOverflowedLiterals"><a href="MatchLit.html#warnAboutOverflowedLiterals"><span class="hs-identifier">warnAboutOverflowedLiterals</span></a></a><span> </span><a name="local-6989586621681865286"><a href="#local-6989586621681865286"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621681865287"><a href="#local-6989586621681865287"><span class="hs-identifier">lit</span></a></a><span>
</span><a name="line-181"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">wopt</span><span> </span><span class="hs-identifier hs-var">Opt_WarnOverflowedLiterals</span><span> </span><a href="#local-6989586621681865286"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-182"></a><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681865299"><a href="#local-6989586621681865299"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681865300"><a href="#local-6989586621681865300"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681865287"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-183"></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">if</span><span>      </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">intTyConName</span><span>     </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>    </span><span class="hs-comment">-- These only show up via the 'HsOverLit' route</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int8TyConName</span><span>    </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int8</span><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int16TyConName</span><span>   </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int16</span><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int32TyConName</span><span>   </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int32</span><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int64TyConName</span><span>   </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int64</span><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">wordTyConName</span><span>    </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word</span><span class="hs-special">)</span><span>
</span><a name="line-191"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word8TyConName</span><span>   </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word16TyConName</span><span>  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word16</span><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word32TyConName</span><span>  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-194"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word64TyConName</span><span>  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">naturalTyConName</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865288"><span class="hs-identifier hs-var">checkPositive</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>    </span><span class="hs-comment">-- These only show up via the 'HsLit' route</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">intPrimTyConName</span><span>    </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int8PrimTyConName</span><span>   </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int8</span><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int32PrimTyConName</span><span>  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int32</span><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int64PrimTyConName</span><span>  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int64</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">wordPrimTyConName</span><span>   </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word</span><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word8PrimTyConName</span><span>  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word32PrimTyConName</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word64PrimTyConName</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865289"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621681865299"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681865300"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span>    </span><span class="hs-identifier">checkPositive</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>    </span><a name="local-6989586621681865288"><a href="#local-6989586621681865288"><span class="hs-identifier">checkPositive</span></a></a><span> </span><a name="local-6989586621681865291"><a href="#local-6989586621681865291"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621681865292"><a href="#local-6989586621681865292"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-214"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865291"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-215"></a><span>        </span><a href="DsMonad.html#warnDs"><span class="hs-identifier hs-var">warnDs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Reason</span><span> </span><span class="hs-identifier hs-var">Opt_WarnOverflowedLiterals</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Literal&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">integer</span><span> </span><a href="#local-6989586621681865291"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-217"></a><span>                       </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;is negative but&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681865292"><span class="hs-identifier hs-var">tc</span></a><span>
</span><a name="line-218"></a><span>                       </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;only supports positive numbers&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>                     </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621681865290"><a href="#local-6989586621681865290"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bounded</span><span> </span><a href="#local-6989586621681865290"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Integral</span><span> </span><a href="#local-6989586621681865290"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621681865290"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>    </span><a name="local-6989586621681865289"><a href="#local-6989586621681865289"><span class="hs-identifier">check</span></a></a><span> </span><a name="local-6989586621681865293"><a href="#local-6989586621681865293"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621681865294"><a href="#local-6989586621681865294"><span class="hs-identifier">tc</span></a></a><span> </span><a name="local-6989586621681865295"><a href="#local-6989586621681865295"><span class="hs-identifier">_proxy</span></a></a><span>
</span><a name="line-223"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865293"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621681865296"><span class="hs-identifier hs-var">minB</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621681865293"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621681865297"><span class="hs-identifier hs-var">maxB</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-224"></a><span>        </span><a href="DsMonad.html#warnDs"><span class="hs-identifier hs-var">warnDs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Reason</span><span> </span><span class="hs-identifier hs-var">Opt_WarnOverflowedLiterals</span><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Literal&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">integer</span><span> </span><a href="#local-6989586621681865293"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-226"></a><span>                       </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;is out of the&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681865294"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ptext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sLit</span><span> </span><span class="hs-string">&quot;range&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-227"></a><span>                       </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">integer</span><span> </span><a href="#local-6989586621681865296"><span class="hs-identifier hs-var">minB</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;..&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">integer</span><span> </span><a href="#local-6989586621681865297"><span class="hs-identifier hs-var">maxB</span></a><span>
</span><a name="line-228"></a><span>                     </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865298"><span class="hs-identifier hs-var">sug</span></a><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-230"></a><span>        </span><a name="local-6989586621681865296"><a href="#local-6989586621681865296"><span class="hs-identifier">minB</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minBound</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621681865290"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span>        </span><a name="local-6989586621681865297"><a href="#local-6989586621681865297"><span class="hs-identifier">maxB</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toInteger</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621681865290"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>        </span><a name="local-6989586621681865298"><a href="#local-6989586621681865298"><span class="hs-identifier">sug</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681865296"><span class="hs-identifier hs-var">minB</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-glyph">-</span><a href="#local-6989586621681865293"><span class="hs-identifier hs-var">i</span></a><span>   </span><span class="hs-comment">-- Note [Suggest NegativeLiterals]</span><span>
</span><a name="line-233"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865293"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-234"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">xopt</span><span> </span><span class="hs-identifier hs-var">LangExt.NegativeLiterals</span><span> </span><a href="#local-6989586621681865286"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;If you are trying to write a large negative literal, use NegativeLiterals&quot;</span><span>
</span><a name="line-236"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Outputable.empty</span><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span class="hs-comment">{-
Note [Suggest NegativeLiterals]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
If you write
  x :: Int8
  x = -128
it'll parse as (negate 128), and overflow.  In this case, suggest NegativeLiterals.
We get an erroneous suggestion for
  x = 128
but perhaps that does not matter too much.
-}</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-identifier">warnAboutEmptyEnumerations</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-251"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- ^ Warns about @[2,3 .. 1]@ which returns the empty list.</span><span>
</span><a name="line-253"></a><span class="hs-comment">-- Only works for integral types, not floating point.</span><span>
</span><a name="line-254"></a><a name="warnAboutEmptyEnumerations"><a href="MatchLit.html#warnAboutEmptyEnumerations"><span class="hs-identifier">warnAboutEmptyEnumerations</span></a></a><span> </span><a name="local-6989586621681865301"><a href="#local-6989586621681865301"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621681865302"><a href="#local-6989586621681865302"><span class="hs-identifier">fromExpr</span></a></a><span> </span><a name="local-6989586621681865303"><a href="#local-6989586621681865303"><span class="hs-identifier">mThnExpr</span></a></a><span> </span><a name="local-6989586621681865304"><a href="#local-6989586621681865304"><span class="hs-identifier">toExpr</span></a></a><span>
</span><a name="line-255"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">wopt</span><span> </span><span class="hs-identifier hs-var">Opt_WarnEmptyEnumerations</span><span> </span><a href="#local-6989586621681865301"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-256"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681865305"><a href="#local-6989586621681865305"><span class="hs-identifier">from</span></a></a><span class="hs-special">,</span><a name="local-6989586621681865306"><a href="#local-6989586621681865306"><span class="hs-identifier">tc</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MatchLit.html#getLHsIntegralLit"><span class="hs-identifier hs-var">getLHsIntegralLit</span></a><span> </span><a href="#local-6989586621681865302"><span class="hs-identifier hs-var">fromExpr</span></a><span>
</span><a name="line-257"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681865307"><a href="#local-6989586621681865307"><span class="hs-identifier">mThn</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="MatchLit.html#getLHsIntegralLit"><span class="hs-identifier hs-var">getLHsIntegralLit</span></a><span> </span><a href="#local-6989586621681865303"><span class="hs-identifier hs-var">mThnExpr</span></a><span>
</span><a name="line-258"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681865308"><a href="#local-6989586621681865308"><span class="hs-identifier">to</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MatchLit.html#getLHsIntegralLit"><span class="hs-identifier hs-var">getLHsIntegralLit</span></a><span> </span><a href="#local-6989586621681865304"><span class="hs-identifier hs-var">toExpr</span></a><span>
</span><a name="line-259"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">check</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621681865310"><a href="#local-6989586621681865310"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Enum</span><span> </span><a href="#local-6989586621681865310"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Num</span><span> </span><a href="#local-6989586621681865310"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="#local-6989586621681865310"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>        </span><a name="local-6989586621681865309"><a href="#local-6989586621681865309"><span class="hs-identifier">check</span></a></a><span> </span><a name="local-6989586621681865311"><a href="#local-6989586621681865311"><span class="hs-identifier">_proxy</span></a></a><span>
</span><a name="line-261"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621681865312"><span class="hs-identifier hs-var">enumeration</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-262"></a><span>            </span><a href="DsMonad.html#warnDs"><span class="hs-identifier hs-var">warnDs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Reason</span><span> </span><span class="hs-identifier hs-var">Opt_WarnEmptyEnumerations</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Enumeration is empty&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-264"></a><span>            </span><span class="hs-identifier">enumeration</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681865310"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-265"></a><span>            </span><a name="local-6989586621681865312"><a href="#local-6989586621681865312"><span class="hs-identifier">enumeration</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681865307"><span class="hs-identifier hs-var">mThn</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-266"></a><span>                            </span><span class="hs-identifier hs-var">Nothing</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621681865305"><span class="hs-identifier hs-var">from</span></a><span>                    </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621681865308"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">]</span><span>
</span><a name="line-267"></a><span>                            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681865313"><a href="#local-6989586621681865313"><span class="hs-identifier">thn</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621681865305"><span class="hs-identifier hs-var">from</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621681865313"><span class="hs-identifier hs-var">thn</span></a><span>   </span><span class="hs-glyph">..</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621681865308"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">]</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span>      </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">intTyConName</span><span>    </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int8TyConName</span><span>   </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int8</span><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int16TyConName</span><span>  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int16</span><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int32TyConName</span><span>  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int32</span><span class="hs-special">)</span><span>
</span><a name="line-273"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">int64TyConName</span><span>  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Int64</span><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">wordTyConName</span><span>   </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word</span><span class="hs-special">)</span><span>
</span><a name="line-275"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word8TyConName</span><span>  </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word16TyConName</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word16</span><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word32TyConName</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">word64TyConName</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">integerTyConName</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-280"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621681865306"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">naturalTyConName</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621681865309"><span class="hs-identifier hs-var">check</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span>      </span><span class="hs-comment">-- We use 'Integer' because otherwise a negative 'Natural' literal</span><span>
</span><a name="line-282"></a><span>      </span><span class="hs-comment">-- could cause a compile time crash (instead of a runtime one).</span><span>
</span><a name="line-283"></a><span>      </span><span class="hs-comment">-- See the T10930b test case for an example of where this matters.</span><span>
</span><a name="line-284"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span class="hs-identifier">getLHsIntegralLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>
</span><a name="line-289"></a><span class="hs-comment">-- ^ See if the expression is an 'Integral' literal.</span><span>
</span><a name="line-290"></a><span class="hs-comment">-- Remember to look through automatically-added tick-boxes! (Trac #8384)</span><span>
</span><a name="line-291"></a><a name="getLHsIntegralLit"><a href="MatchLit.html#getLHsIntegralLit"><span class="hs-identifier">getLHsIntegralLit</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsPar</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865314"><a href="#local-6989586621681865314"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="MatchLit.html#getLHsIntegralLit"><span class="hs-identifier hs-var">getLHsIntegralLit</span></a><span> </span><a href="#local-6989586621681865314"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-292"></a><span class="hs-identifier">getLHsIntegralLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTick</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865315"><a href="#local-6989586621681865315"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="MatchLit.html#getLHsIntegralLit"><span class="hs-identifier hs-var">getLHsIntegralLit</span></a><span> </span><a href="#local-6989586621681865315"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-293"></a><span class="hs-identifier">getLHsIntegralLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsBinTick</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865316"><a href="#local-6989586621681865316"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="MatchLit.html#getLHsIntegralLit"><span class="hs-identifier hs-var">getLHsIntegralLit</span></a><span> </span><a href="#local-6989586621681865316"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-294"></a><span class="hs-identifier">getLHsIntegralLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsOverLit</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865317"><a href="#local-6989586621681865317"><span class="hs-identifier">over_lit</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MatchLit.html#getIntegralLit"><span class="hs-identifier hs-var">getIntegralLit</span></a><span> </span><a href="#local-6989586621681865317"><span class="hs-identifier hs-var">over_lit</span></a><span>
</span><a name="line-295"></a><span class="hs-identifier">getLHsIntegralLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLit</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865318"><a href="#local-6989586621681865318"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="MatchLit.html#getSimpleIntegralLit"><span class="hs-identifier hs-var">getSimpleIntegralLit</span></a><span> </span><a href="#local-6989586621681865318"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-296"></a><span class="hs-identifier">getLHsIntegralLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-comment">-- | If 'Integral', extract the value and type name of the overloaded literal.</span><span>
</span><a name="line-299"></a><span class="hs-identifier">getIntegralLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsOverLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>
</span><a name="line-300"></a><a name="getIntegralLit"><a href="MatchLit.html#getIntegralLit"><span class="hs-identifier">getIntegralLit</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OverLit</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ol_val</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HsIntegral</span><span> </span><a name="local-6989586621681865319"><a href="#local-6989586621681865319"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">OverLitTc</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865320"><a href="#local-6989586621681865320"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681865321"><a href="#local-6989586621681865321"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span><span> </span><a href="#local-6989586621681865320"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-302"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">il_value</span><span> </span><a href="#local-6989586621681865319"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621681865321"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span class="hs-identifier">getIntegralLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-comment">-- | If 'Integral', extract the value and type name of the non-overloaded</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- literal.</span><span>
</span><a name="line-307"></a><span class="hs-identifier">getSimpleIntegralLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Integer</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">)</span><span>
</span><a name="line-308"></a><a name="getSimpleIntegralLit"><a href="MatchLit.html#getSimpleIntegralLit"><span class="hs-identifier">getSimpleIntegralLit</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">IL</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">il_value</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681865322"><a href="#local-6989586621681865322"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865322"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">intTyConName</span><span class="hs-special">)</span><span>
</span><a name="line-309"></a><span class="hs-identifier">getSimpleIntegralLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIntPrim</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865323"><a href="#local-6989586621681865323"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865323"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">intPrimTyConName</span><span class="hs-special">)</span><span>
</span><a name="line-310"></a><span class="hs-identifier">getSimpleIntegralLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWordPrim</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865324"><a href="#local-6989586621681865324"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865324"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">wordPrimTyConName</span><span class="hs-special">)</span><span>
</span><a name="line-311"></a><span class="hs-identifier">getSimpleIntegralLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInt64Prim</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865325"><a href="#local-6989586621681865325"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865325"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">int64PrimTyConName</span><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span class="hs-identifier">getSimpleIntegralLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWord64Prim</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865326"><a href="#local-6989586621681865326"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865326"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">word64PrimTyConName</span><span class="hs-special">)</span><span>
</span><a name="line-313"></a><span class="hs-identifier">getSimpleIntegralLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInteger</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865327"><a href="#local-6989586621681865327"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621681865328"><a href="#local-6989586621681865328"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-314"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681865329"><a href="#local-6989586621681865329"><span class="hs-identifier">tc</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span><span> </span><a href="#local-6989586621681865328"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-315"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865327"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">tyConName</span><span> </span><a href="#local-6989586621681865329"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-316"></a><span class="hs-identifier">getSimpleIntegralLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Tidying lit pats
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-identifier">tidyLitPat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span>
</span><a name="line-327"></a><span class="hs-comment">-- Result has only the following HsLits:</span><span>
</span><a name="line-328"></a><span class="hs-comment">--      HsIntPrim, HsWordPrim, HsCharPrim, HsFloatPrim</span><span>
</span><a name="line-329"></a><span class="hs-comment">--      HsDoublePrim, HsStringPrim, HsString</span><span>
</span><a name="line-330"></a><span class="hs-comment">--  * HsInteger, HsRat, HsInt can't show up in LitPats</span><span>
</span><a name="line-331"></a><span class="hs-comment">--  * We get rid of HsChar right here</span><span>
</span><a name="line-332"></a><a name="tidyLitPat"><a href="MatchLit.html#tidyLitPat"><span class="hs-identifier">tidyLitPat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsChar</span><span> </span><a name="local-6989586621681865330"><a href="#local-6989586621681865330"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621681865331"><a href="#local-6989586621681865331"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCharLitPat</span><span> </span><a href="#local-6989586621681865330"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621681865331"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-333"></a><span class="hs-identifier">tidyLitPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsString</span><span> </span><a name="local-6989586621681865332"><a href="#local-6989586621681865332"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621681865333"><a href="#local-6989586621681865333"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">lengthFS</span><span> </span><a href="#local-6989586621681865333"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">1</span><span>     </span><span class="hs-comment">-- Short string literals only</span><span>
</span><a name="line-335"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621681865334"><a href="#local-6989586621681865334"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621681865335"><a href="#local-6989586621681865335"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkPrefixConPat</span><span> </span><span class="hs-identifier hs-var">consDataCon</span><span>
</span><a name="line-336"></a><span>                                             </span><span class="hs-special">[</span><span class="hs-identifier hs-var">mkCharLitPat</span><span> </span><a href="#local-6989586621681865332"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621681865334"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865335"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">charTy</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-337"></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkNilPat</span><span> </span><span class="hs-identifier hs-var">charTy</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unpackFS</span><span> </span><a href="#local-6989586621681865333"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-338"></a><span>        </span><span class="hs-comment">-- The stringTy is the type of the whole pattern, not</span><span>
</span><a name="line-339"></a><span>        </span><span class="hs-comment">-- the type to instantiate (:) or [] with!</span><span>
</span><a name="line-340"></a><span class="hs-identifier">tidyLitPat</span><span> </span><a name="local-6989586621681865336"><a href="#local-6989586621681865336"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LitPat</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621681865336"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span class="hs-comment">----------------</span><span>
</span><a name="line-343"></a><span class="hs-identifier">tidyNPat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsOverLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SyntaxExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SyntaxExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span>
</span><a name="line-344"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-345"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span>
</span><a name="line-346"></a><a name="tidyNPat"><a href="MatchLit.html#tidyNPat"><span class="hs-identifier">tidyNPat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OverLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OverLitTc</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a name="local-6989586621681865337"><a href="#local-6989586621681865337"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681865338"><a href="#local-6989586621681865338"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681865339"><a href="#local-6989586621681865339"><span class="hs-identifier">mb_neg</span></a></a><span> </span><a name="local-6989586621681865340"><a href="#local-6989586621681865340"><span class="hs-identifier">_eq</span></a></a><span> </span><a name="local-6989586621681865341"><a href="#local-6989586621681865341"><span class="hs-identifier">outer_ty</span></a></a><span>
</span><a name="line-347"></a><span>        </span><span class="hs-comment">-- False: Take short cuts only if the literal is not using rebindable syntax</span><span>
</span><a name="line-348"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-349"></a><span>        </span><span class="hs-comment">-- Once that is settled, look for cases where the type of the</span><span>
</span><a name="line-350"></a><span>        </span><span class="hs-comment">-- entire overloaded literal matches the type of the underlying literal,</span><span>
</span><a name="line-351"></a><span>        </span><span class="hs-comment">-- and in that case take the short cut</span><span>
</span><a name="line-352"></a><span>        </span><span class="hs-comment">-- NB: Watch out for weird cases like Trac #3382</span><span>
</span><a name="line-353"></a><span>        </span><span class="hs-comment">--        f :: Int -&gt; Int</span><span>
</span><a name="line-354"></a><span>        </span><span class="hs-comment">--        f &quot;blah&quot; = 4</span><span>
</span><a name="line-355"></a><span>        </span><span class="hs-comment">--     which might be ok if we have 'instance IsString Int'</span><span>
</span><a name="line-356"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-357"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621681865342"><span class="hs-identifier hs-var">type_change</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isIntTy</span><span> </span><a href="#local-6989586621681865337"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681865351"><a href="#local-6989586621681865351"><span class="hs-identifier">int_lit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681865344"><span class="hs-identifier hs-var">mb_int_lit</span></a><span>
</span><a name="line-358"></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681865343"><span class="hs-identifier hs-var">mk_con_pat</span></a><span> </span><span class="hs-identifier hs-var">intDataCon</span><span>    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIntPrim</span><span>    </span><span class="hs-identifier hs-var">NoSourceText</span><span> </span><a href="#local-6989586621681865351"><span class="hs-identifier hs-var">int_lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-359"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621681865342"><span class="hs-identifier hs-var">type_change</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isWordTy</span><span> </span><a href="#local-6989586621681865337"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span>   </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681865352"><a href="#local-6989586621681865352"><span class="hs-identifier">int_lit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681865344"><span class="hs-identifier hs-var">mb_int_lit</span></a><span>
</span><a name="line-360"></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681865343"><span class="hs-identifier hs-var">mk_con_pat</span></a><span> </span><span class="hs-identifier hs-var">wordDataCon</span><span>   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWordPrim</span><span>   </span><span class="hs-identifier hs-var">NoSourceText</span><span> </span><a href="#local-6989586621681865352"><span class="hs-identifier hs-var">int_lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-361"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621681865342"><span class="hs-identifier hs-var">type_change</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isStringTy</span><span> </span><a href="#local-6989586621681865337"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681865353"><a href="#local-6989586621681865353"><span class="hs-identifier">str_lit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681865345"><span class="hs-identifier hs-var">mb_str_lit</span></a><span>
</span><a name="line-362"></a><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="MatchLit.html#tidyLitPat"><span class="hs-identifier hs-var">tidyLitPat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsString</span><span> </span><span class="hs-identifier hs-var">NoSourceText</span><span> </span><a href="#local-6989586621681865353"><span class="hs-identifier hs-var">str_lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-363"></a><span>     </span><span class="hs-comment">-- NB: do /not/ convert Float or Double literals to F# 3.8 or D# 5.3</span><span>
</span><a name="line-364"></a><span>     </span><span class="hs-comment">-- If we do convert to the constructor form, we'll generate a case</span><span>
</span><a name="line-365"></a><span>     </span><span class="hs-comment">-- expression on a Float# or Double# and that's not allowed in Core; see</span><span>
</span><a name="line-366"></a><span>     </span><span class="hs-comment">-- Trac #9238 and Note [Rules for floating-point comparisons] in PrelRules</span><span>
</span><a name="line-367"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-368"></a><span>    </span><span class="hs-comment">-- Sometimes (like in test case</span><span>
</span><a name="line-369"></a><span>    </span><span class="hs-comment">-- overloadedlists/should_run/overloadedlistsrun04), the SyntaxExprs include</span><span>
</span><a name="line-370"></a><span>    </span><span class="hs-comment">-- type-changing wrappers (for example, from Id Int to Int, for the identity</span><span>
</span><a name="line-371"></a><span>    </span><span class="hs-comment">-- type family Id). In these cases, we can't do the short-cut.</span><span>
</span><a name="line-372"></a><span>    </span><a name="local-6989586621681865342"><a href="#local-6989586621681865342"><span class="hs-identifier">type_change</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865341"><span class="hs-identifier hs-var">outer_ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681865337"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-373"></a><span>
</span><a name="line-374"></a><span>    </span><span class="hs-identifier">mk_con_pat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span>
</span><a name="line-375"></a><span>    </span><a name="local-6989586621681865343"><a href="#local-6989586621681865343"><span class="hs-identifier">mk_con_pat</span></a></a><span> </span><a name="local-6989586621681865346"><a href="#local-6989586621681865346"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621681865347"><a href="#local-6989586621681865347"><span class="hs-identifier">lit</span></a></a><span>
</span><a name="line-376"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkPrefixConPat</span><span> </span><a href="#local-6989586621681865346"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">noLoc</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LitPat</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621681865347"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span>    </span><span class="hs-identifier">mb_int_lit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-379"></a><span>    </span><a name="local-6989586621681865344"><a href="#local-6989586621681865344"><span class="hs-identifier">mb_int_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865339"><span class="hs-identifier hs-var">mb_neg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865338"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-380"></a><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">HsIntegral</span><span> </span><a name="local-6989586621681865348"><a href="#local-6989586621681865348"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">il_value</span><span> </span><a href="#local-6989586621681865348"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-381"></a><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>  </span><span class="hs-identifier hs-var">HsIntegral</span><span> </span><a name="local-6989586621681865349"><a href="#local-6989586621681865349"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">(</span><span class="hs-identifier">il_value</span><span> </span><a href="#local-6989586621681865349"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-382"></a><span>                   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span>    </span><span class="hs-identifier">mb_str_lit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FastString</span><span>
</span><a name="line-385"></a><span>    </span><a name="local-6989586621681865345"><a href="#local-6989586621681865345"><span class="hs-identifier">mb_str_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865339"><span class="hs-identifier hs-var">mb_neg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865338"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-386"></a><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">HsIsString</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865350"><a href="#local-6989586621681865350"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681865350"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-387"></a><span>                   </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-identifier">tidyNPat</span><span> </span><a name="local-6989586621681865354"><a href="#local-6989586621681865354"><span class="hs-identifier">over_lit</span></a></a><span> </span><a name="local-6989586621681865355"><a href="#local-6989586621681865355"><span class="hs-identifier">mb_neg</span></a></a><span> </span><a name="local-6989586621681865356"><a href="#local-6989586621681865356"><span class="hs-identifier">eq</span></a></a><span> </span><a name="local-6989586621681865357"><a href="#local-6989586621681865357"><span class="hs-identifier">outer_ty</span></a></a><span>
</span><a name="line-390"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">NPat</span><span> </span><a href="#local-6989586621681865357"><span class="hs-identifier hs-var">outer_ty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><a href="#local-6989586621681865354"><span class="hs-identifier hs-var">over_lit</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681865355"><span class="hs-identifier hs-var">mb_neg</span></a><span> </span><a href="#local-6989586621681865356"><span class="hs-identifier hs-var">eq</span></a><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Pattern matching on LitPat
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-identifier">matchLiterals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span>
</span><a name="line-401"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>                   </span><span class="hs-comment">-- Type of the whole case expression</span><span>
</span><a name="line-402"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><a href="DsMonad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- All PgLits</span><span>
</span><a name="line-403"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="DsMonad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><a name="matchLiterals"><a href="MatchLit.html#matchLiterals"><span class="hs-identifier">matchLiterals</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681865358"><a href="#local-6989586621681865358"><span class="hs-identifier">var</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681865359"><a href="#local-6989586621681865359"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681865360"><a href="#local-6989586621681865360"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681865361"><a href="#local-6989586621681865361"><span class="hs-identifier">sub_groups</span></a></a><span>
</span><a name="line-406"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">notNull</span><span> </span><span class="hs-identifier">sub_groups</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621681865361"><span class="hs-identifier hs-var">all</span></a><span> </span><span class="hs-identifier">notNull</span><span> </span><span class="hs-identifier">sub_groups</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>       </span><span class="hs-comment">-- Deal with each group</span><span>
</span><a name="line-408"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865375"><a href="#local-6989586621681865375"><span class="hs-identifier">alts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681865362"><span class="hs-identifier hs-var">match_group</span></a><span> </span><a href="#local-6989586621681865361"><span class="hs-identifier hs-var">sub_groups</span></a><span>
</span><a name="line-409"></a><span>
</span><a name="line-410"></a><span>                </span><span class="hs-comment">-- Combine results.  For everything except String</span><span>
</span><a name="line-411"></a><span>                </span><span class="hs-comment">-- we can use a case expression; for String we need</span><span>
</span><a name="line-412"></a><span>                </span><span class="hs-comment">-- a chain of if-then-else</span><span>
</span><a name="line-413"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isStringTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621681865358"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-414"></a><span>            </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681865376"><a href="#local-6989586621681865376"><span class="hs-identifier">eq_str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsMonad.html#dsLookupGlobalId"><span class="hs-identifier hs-var">dsLookupGlobalId</span></a><span> </span><span class="hs-identifier hs-var">eqStringName</span><span>
</span><a name="line-415"></a><span>                </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865377"><a href="#local-6989586621681865377"><span class="hs-identifier">mrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865363"><span class="hs-identifier hs-var">wrap_str_guard</span></a><span> </span><a href="#local-6989586621681865376"><span class="hs-identifier hs-var">eq_str</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681865375"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-416"></a><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr1</span><span> </span><a href="DsUtils.html#combineMatchResults"><span class="hs-identifier hs-var">combineMatchResults</span></a><span> </span><a href="#local-6989586621681865377"><span class="hs-identifier hs-var">mrs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-417"></a><span>          </span><span class="hs-keyword">else</span><span>
</span><a name="line-418"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="DsUtils.html#mkCoPrimCaseMatchResult"><span class="hs-identifier hs-var">mkCoPrimCaseMatchResult</span></a><span> </span><a href="#local-6989586621681865358"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621681865360"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681865375"><span class="hs-identifier hs-var">alts</span></a><span class="hs-special">)</span><span>
</span><a name="line-419"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-420"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-421"></a><span>    </span><span class="hs-identifier">match_group</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DsMonad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Literal</span><span class="hs-special">,</span><span> </span><a href="DsMonad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>    </span><a name="local-6989586621681865362"><a href="#local-6989586621681865362"><span class="hs-identifier">match_group</span></a></a><span> </span><a name="local-6989586621681865364"><a href="#local-6989586621681865364"><span class="hs-identifier">eqns</span></a></a><span>
</span><a name="line-423"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681865365"><a href="#local-6989586621681865365"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-424"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">LitPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865366"><a href="#local-6989586621681865366"><span class="hs-identifier">hs_lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DsUtils.html#firstPat"><span class="hs-identifier hs-var">firstPat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621681865364"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span>
</span><a name="line-425"></a><span>             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865367"><a href="#local-6989586621681865367"><span class="hs-identifier">match_result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Match.html#match"><span class="hs-identifier hs-var">match</span></a><span> </span><a href="#local-6989586621681865359"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621681865360"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="DsUtils.html#shiftEqns"><span class="hs-identifier hs-var">shiftEqns</span></a><span> </span><a href="#local-6989586621681865364"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="MatchLit.html#hsLitKey"><span class="hs-identifier hs-var">hsLitKey</span></a><span> </span><a href="#local-6989586621681865365"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681865366"><span class="hs-identifier hs-var">hs_lit</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865367"><span class="hs-identifier hs-var">match_result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span>    </span><span class="hs-identifier">wrap_str_guard</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Id</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Literal</span><span class="hs-special">,</span><a href="DsMonad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="DsMonad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-429"></a><span>        </span><span class="hs-comment">-- Equality check for string literals</span><span>
</span><a name="line-430"></a><span>    </span><a name="local-6989586621681865363"><a href="#local-6989586621681865363"><span class="hs-identifier">wrap_str_guard</span></a></a><span> </span><a name="local-6989586621681865368"><a href="#local-6989586621681865368"><span class="hs-identifier">eq_str</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitString</span><span> </span><a name="local-6989586621681865369"><a href="#local-6989586621681865369"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681865370"><a href="#local-6989586621681865370"><span class="hs-identifier">mr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- We now have to convert back to FastString. Perhaps there</span><span>
</span><a name="line-432"></a><span>               </span><span class="hs-comment">-- should be separate LitBytes and LitString constructors?</span><span>
</span><a name="line-433"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681865371"><a href="#local-6989586621681865371"><span class="hs-identifier">s'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkFastStringByteString</span><span> </span><a href="#local-6989586621681865369"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-434"></a><span>             </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865372"><a href="#local-6989586621681865372"><span class="hs-identifier">lit</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mkStringExprFS</span><span> </span><a href="#local-6989586621681865371"><span class="hs-identifier hs-var">s'</span></a><span>
</span><a name="line-435"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681865373"><a href="#local-6989586621681865373"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkApps</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><a href="#local-6989586621681865368"><span class="hs-identifier hs-var">eq_str</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Var</span><span> </span><a href="#local-6989586621681865358"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865372"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">]</span><span>
</span><a name="line-436"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="DsUtils.html#mkGuardedMatchResult"><span class="hs-identifier hs-var">mkGuardedMatchResult</span></a><span> </span><a href="#local-6989586621681865373"><span class="hs-identifier hs-var">pred</span></a><span> </span><a href="#local-6989586621681865370"><span class="hs-identifier hs-var">mr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-437"></a><span>    </span><span class="hs-identifier">wrap_str_guard</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681865374"><a href="#local-6989586621681865374"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;matchLiterals/wrap_str_guard&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681865374"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span class="hs-identifier">matchLiterals</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;matchLiterals []&quot;</span><span>
</span><a name="line-440"></a><span>
</span><a name="line-441"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-442"></a><span class="hs-identifier">hsLitKey</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Literal</span><span>
</span><a name="line-443"></a><span class="hs-comment">-- Get the Core literal corresponding to a HsLit.</span><span>
</span><a name="line-444"></a><span class="hs-comment">-- It only works for primitive types and strings;</span><span>
</span><a name="line-445"></a><span class="hs-comment">-- others have been removed by tidy</span><span>
</span><a name="line-446"></a><span class="hs-comment">-- For HsString, it produces a LitString, which really represents an _unboxed_</span><span>
</span><a name="line-447"></a><span class="hs-comment">-- string literal; and we deal with it in matchLiterals above. Otherwise, it</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- produces a primitive Literal of type matching the original HsLit.</span><span>
</span><a name="line-449"></a><span class="hs-comment">-- In the case of the fixed-width numeric types, we need to wrap here</span><span>
</span><a name="line-450"></a><span class="hs-comment">-- because Literal has an invariant that the literal is in range, while</span><span>
</span><a name="line-451"></a><span class="hs-comment">-- HsLit does not.</span><span>
</span><a name="line-452"></a><a name="hsLitKey"><a href="MatchLit.html#hsLitKey"><span class="hs-identifier">hsLitKey</span></a></a><span> </span><a name="local-6989586621681865378"><a href="#local-6989586621681865378"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIntPrim</span><span>    </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865379"><a href="#local-6989586621681865379"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLitIntWrap</span><span>  </span><a href="#local-6989586621681865378"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681865379"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-453"></a><span class="hs-identifier">hsLitKey</span><span> </span><a name="local-6989586621681865380"><a href="#local-6989586621681865380"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWordPrim</span><span>   </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865381"><a href="#local-6989586621681865381"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLitWordWrap</span><span> </span><a href="#local-6989586621681865380"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681865381"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-454"></a><span class="hs-identifier">hsLitKey</span><span> </span><a name="local-6989586621681865382"><a href="#local-6989586621681865382"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInt64Prim</span><span>  </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865383"><a href="#local-6989586621681865383"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLitInt64Wrap</span><span>  </span><a href="#local-6989586621681865382"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681865383"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-455"></a><span class="hs-identifier">hsLitKey</span><span> </span><a name="local-6989586621681865384"><a href="#local-6989586621681865384"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWord64Prim</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865385"><a href="#local-6989586621681865385"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLitWord64Wrap</span><span> </span><a href="#local-6989586621681865384"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681865385"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-456"></a><span class="hs-identifier">hsLitKey</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCharPrim</span><span>   </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865386"><a href="#local-6989586621681865386"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLitChar</span><span>            </span><a href="#local-6989586621681865386"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-457"></a><span class="hs-identifier">hsLitKey</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFloatPrim</span><span>  </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865387"><a href="#local-6989586621681865387"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLitFloat</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier">fl_value</span><span> </span><a href="#local-6989586621681865387"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-458"></a><span class="hs-identifier">hsLitKey</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsDoublePrim</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865388"><a href="#local-6989586621681865388"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkLitDouble</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier">fl_value</span><span> </span><a href="#local-6989586621681865388"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span class="hs-identifier">hsLitKey</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsString</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865389"><a href="#local-6989586621681865389"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">LitString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fastStringToByteString</span><span> </span><a href="#local-6989586621681865389"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-460"></a><span class="hs-identifier">hsLitKey</span><span> </span><span class="hs-identifier">_</span><span>      </span><a name="local-6989586621681865390"><a href="#local-6989586621681865390"><span class="hs-identifier">l</span></a></a><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;hsLitKey&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681865390"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-461"></a><span>
</span><a name="line-462"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Pattern matching on NPat
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span class="hs-identifier">matchNPats</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DsMonad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="DsMonad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-471"></a><a name="matchNPats"><a href="MatchLit.html#matchNPats"><span class="hs-identifier">matchNPats</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681865391"><a href="#local-6989586621681865391"><span class="hs-identifier">var</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681865392"><a href="#local-6989586621681865392"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681865393"><a href="#local-6989586621681865393"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681865394"><a href="#local-6989586621681865394"><span class="hs-identifier">eqn1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681865395"><a href="#local-6989586621681865395"><span class="hs-identifier">eqns</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- All for the same literal</span><span>
</span><a name="line-472"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">NPat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865396"><a href="#local-6989586621681865396"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681865397"><a href="#local-6989586621681865397"><span class="hs-identifier">mb_neg</span></a></a><span> </span><a name="local-6989586621681865398"><a href="#local-6989586621681865398"><span class="hs-identifier">eq_chk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DsUtils.html#firstPat"><span class="hs-identifier hs-var">firstPat</span></a><span> </span><a href="#local-6989586621681865394"><span class="hs-identifier hs-var">eqn1</span></a><span>
</span><a name="line-473"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865399"><a href="#local-6989586621681865399"><span class="hs-identifier">lit_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MatchLit.html#dsOverLit"><span class="hs-identifier hs-var">dsOverLit</span></a><span> </span><a href="#local-6989586621681865396"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-474"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865401"><a href="#local-6989586621681865401"><span class="hs-identifier">neg_lit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681865397"><span class="hs-identifier hs-var">mb_neg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-475"></a><span>                            </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681865399"><span class="hs-identifier hs-var">lit_expr</span></a><span>
</span><a name="line-476"></a><span>                            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681865400"><a href="#local-6989586621681865400"><span class="hs-identifier">neg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DsExpr.html#dsSyntaxExpr"><span class="hs-identifier hs-var">dsSyntaxExpr</span></a><span> </span><a href="#local-6989586621681865400"><span class="hs-identifier hs-var">neg</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681865399"><span class="hs-identifier hs-var">lit_expr</span></a><span class="hs-special">]</span><span>
</span><a name="line-477"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865402"><a href="#local-6989586621681865402"><span class="hs-identifier">pred_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsExpr.html#dsSyntaxExpr"><span class="hs-identifier hs-var">dsSyntaxExpr</span></a><span> </span><a href="#local-6989586621681865398"><span class="hs-identifier hs-var">eq_chk</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Var</span><span> </span><a href="#local-6989586621681865391"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865401"><span class="hs-identifier hs-var">neg_lit</span></a><span class="hs-special">]</span><span>
</span><a name="line-478"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865403"><a href="#local-6989586621681865403"><span class="hs-identifier">match_result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Match.html#match"><span class="hs-identifier hs-var">match</span></a><span> </span><a href="#local-6989586621681865392"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621681865393"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">(</span><a href="DsUtils.html#shiftEqns"><span class="hs-identifier hs-var">shiftEqns</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865394"><span class="hs-identifier hs-var">eqn1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681865395"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="DsUtils.html#mkGuardedMatchResult"><span class="hs-identifier hs-var">mkGuardedMatchResult</span></a><span> </span><a href="#local-6989586621681865402"><span class="hs-identifier hs-var">pred_expr</span></a><span> </span><a href="#local-6989586621681865403"><span class="hs-identifier hs-var">match_result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-480"></a><span class="hs-identifier">matchNPats</span><span> </span><a name="local-6989586621681865404"><a href="#local-6989586621681865404"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865405"><a href="#local-6989586621681865405"><span class="hs-identifier">eqns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;matchOneNPat&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865404"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865405"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-481"></a><span>
</span><a name="line-482"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Pattern matching on n+k patterns
*                                                                      *
************************************************************************

For an n+k pattern, we use the various magic expressions we've been given.
We generate:
\begin{verbatim}
    if ge var lit then
        let n = sub var lit
        in  &lt;expr-for-a-successful-match&gt;
    else
        &lt;try-next-pattern-or-whatever&gt;
\end{verbatim}
-}</span><span>
</span><a name="line-499"></a><span>
</span><a name="line-500"></a><span class="hs-identifier">matchNPlusKPats</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DsMonad.html#EquationInfo"><span class="hs-identifier hs-type">EquationInfo</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">DsM</span><span> </span><a href="DsMonad.html#MatchResult"><span class="hs-identifier hs-type">MatchResult</span></a><span>
</span><a name="line-501"></a><span class="hs-comment">-- All NPlusKPats, for the *same* literal k</span><span>
</span><a name="line-502"></a><a name="matchNPlusKPats"><a href="MatchLit.html#matchNPlusKPats"><span class="hs-identifier">matchNPlusKPats</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681865406"><a href="#local-6989586621681865406"><span class="hs-identifier">var</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681865407"><a href="#local-6989586621681865407"><span class="hs-identifier">vars</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681865408"><a href="#local-6989586621681865408"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681865409"><a href="#local-6989586621681865409"><span class="hs-identifier">eqn1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681865410"><a href="#local-6989586621681865410"><span class="hs-identifier">eqns</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-503"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier hs-var">NPlusKPat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865417"><a href="#local-6989586621681865417"><span class="hs-identifier">n1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865418"><a href="#local-6989586621681865418"><span class="hs-identifier">lit1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681865419"><a href="#local-6989586621681865419"><span class="hs-identifier">lit2</span></a></a><span> </span><a name="local-6989586621681865420"><a href="#local-6989586621681865420"><span class="hs-identifier">ge</span></a></a><span> </span><a name="local-6989586621681865421"><a href="#local-6989586621681865421"><span class="hs-identifier">minus</span></a></a><span>
</span><a name="line-504"></a><span>                </span><span class="hs-glyph">=</span><span> </span><a href="DsUtils.html#firstPat"><span class="hs-identifier hs-var">firstPat</span></a><span> </span><a href="#local-6989586621681865409"><span class="hs-identifier hs-var">eqn1</span></a><span>
</span><a name="line-505"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865422"><a href="#local-6989586621681865422"><span class="hs-identifier">lit1_expr</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MatchLit.html#dsOverLit"><span class="hs-identifier hs-var">dsOverLit</span></a><span> </span><a href="#local-6989586621681865418"><span class="hs-identifier hs-var">lit1</span></a><span>
</span><a name="line-506"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865423"><a href="#local-6989586621681865423"><span class="hs-identifier">lit2_expr</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MatchLit.html#dsOverLit"><span class="hs-identifier hs-var">dsOverLit</span></a><span> </span><a href="#local-6989586621681865419"><span class="hs-identifier hs-var">lit2</span></a><span>
</span><a name="line-507"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865424"><a href="#local-6989586621681865424"><span class="hs-identifier">pred_expr</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsExpr.html#dsSyntaxExpr"><span class="hs-identifier hs-var">dsSyntaxExpr</span></a><span> </span><a href="#local-6989586621681865420"><span class="hs-identifier hs-var">ge</span></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Var</span><span> </span><a href="#local-6989586621681865406"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865422"><span class="hs-identifier hs-var">lit1_expr</span></a><span class="hs-special">]</span><span>
</span><a name="line-508"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865425"><a href="#local-6989586621681865425"><span class="hs-identifier">minusk_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DsExpr.html#dsSyntaxExpr"><span class="hs-identifier hs-var">dsSyntaxExpr</span></a><span> </span><a href="#local-6989586621681865421"><span class="hs-identifier hs-var">minus</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">Var</span><span> </span><a href="#local-6989586621681865406"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865423"><span class="hs-identifier hs-var">lit2_expr</span></a><span class="hs-special">]</span><span>
</span><a name="line-509"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681865426"><a href="#local-6989586621681865426"><span class="hs-identifier">wraps</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681865427"><a href="#local-6989586621681865427"><span class="hs-identifier">eqns'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapAndUnzip</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865411"><span class="hs-identifier hs-var">shift</span></a><span> </span><a href="#local-6989586621681865417"><span class="hs-identifier hs-var">n1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865409"><span class="hs-identifier hs-var">eqn1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681865410"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span>
</span><a name="line-510"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681865428"><a href="#local-6989586621681865428"><span class="hs-identifier">match_result</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Match.html#match"><span class="hs-identifier hs-var">match</span></a><span> </span><a href="#local-6989586621681865407"><span class="hs-identifier hs-var">vars</span></a><span> </span><a href="#local-6989586621681865408"><span class="hs-identifier hs-var">ty</span></a><span> </span><a href="#local-6989586621681865427"><span class="hs-identifier hs-var">eqns'</span></a><span>
</span><a name="line-511"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span>  </span><span class="hs-special">(</span><a href="DsUtils.html#mkGuardedMatchResult"><span class="hs-identifier hs-var">mkGuardedMatchResult</span></a><span> </span><a href="#local-6989586621681865424"><span class="hs-identifier hs-var">pred_expr</span></a><span>               </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-512"></a><span>                   </span><a href="DsUtils.html#mkCoLetMatchResult"><span class="hs-identifier hs-var">mkCoLetMatchResult</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NonRec</span><span> </span><a href="#local-6989586621681865417"><span class="hs-identifier hs-var">n1</span></a><span> </span><a href="#local-6989586621681865425"><span class="hs-identifier hs-var">minusk_expr</span></a><span class="hs-special">)</span><span>   </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-513"></a><span>                   </span><a href="DsUtils.html#adjustMatchResult"><span class="hs-identifier hs-var">adjustMatchResult</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldr1</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681865426"><span class="hs-identifier hs-var">wraps</span></a><span class="hs-special">)</span><span>         </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-514"></a><span>                   </span><a href="#local-6989586621681865428"><span class="hs-identifier hs-var">match_result</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-515"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-516"></a><span>    </span><a name="local-6989586621681865411"><a href="#local-6989586621681865411"><span class="hs-identifier">shift</span></a></a><span> </span><a name="local-6989586621681865412"><a href="#local-6989586621681865412"><span class="hs-identifier">n1</span></a></a><span> </span><a name="local-6989586621681865413"><a href="#local-6989586621681865413"><span class="hs-identifier">eqn</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="DsMonad.html#EqnInfo"><span class="hs-identifier hs-var">EqnInfo</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eqn_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">NPlusKPat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865414"><a href="#local-6989586621681865414"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621681865415"><a href="#local-6989586621681865415"><span class="hs-identifier">pats</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-517"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="DsUtils.html#wrapBind"><span class="hs-identifier hs-var">wrapBind</span></a><span> </span><a href="#local-6989586621681865414"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621681865412"><span class="hs-identifier hs-var">n1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865413"><span class="hs-identifier hs-var">eqn</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eqn_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681865415"><span class="hs-identifier hs-var">pats</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-518"></a><span>        </span><span class="hs-comment">-- The wrapBind is a no-op for the first equation</span><span>
</span><a name="line-519"></a><span>    </span><span class="hs-identifier">shift</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865416"><a href="#local-6989586621681865416"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;matchNPlusKPats/shift&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681865416"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-identifier">matchNPlusKPats</span><span> </span><a name="local-6989586621681865429"><a href="#local-6989586621681865429"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681865430"><a href="#local-6989586621681865430"><span class="hs-identifier">eqns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;matchNPlusKPats&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681865429"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681865430"><span class="hs-identifier hs-var">eqns</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-522"></a></pre></body></html>