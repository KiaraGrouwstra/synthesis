<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The AQUA Project, Glasgow University, 1996-1998


TcHsSyn: Specialisations of the @HsSyn@ syntax for the typechecker

This module is an extension of @HsSyn@ syntax, for use in the type
checker.
-}</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE CPP, TupleSections #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-14"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-15"></a><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">TcHsSyn</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-18"></a><span>        </span><span class="hs-comment">-- * Extracting types from HsSyn</span><span>
</span><a name="line-19"></a><span>        </span><a href="TcHsSyn.html#hsLitType"><span class="hs-identifier hs-var">hsLitType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#hsLPatType"><span class="hs-identifier hs-var">hsLPatType</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#hsPatType"><span class="hs-identifier hs-var">hsPatType</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>        </span><span class="hs-comment">-- * Other HsSyn functions</span><span>
</span><a name="line-22"></a><span>        </span><span class="hs-identifier hs-var">mkHsDictLet</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkHsApp</span><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><span class="hs-identifier hs-var">mkHsAppTy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkHsCaseAlt</span><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="TcHsSyn.html#shortCutLit"><span class="hs-identifier hs-var">shortCutLit</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#hsOverLitName"><span class="hs-identifier hs-var">hsOverLitName</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>        </span><span class="hs-identifier hs-var">conLikeResTy</span><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span>        </span><span class="hs-comment">-- * re-exported from TcMonad</span><span>
</span><a name="line-28"></a><span>        </span><span class="hs-identifier hs-type">TcId</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TcIdSet</span><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span>        </span><span class="hs-comment">-- * Zonking</span><span>
</span><a name="line-31"></a><span>        </span><span class="hs-comment">-- | For a description of &quot;zonking&quot;, see Note [What is zonking?]</span><span>
</span><a name="line-32"></a><span>        </span><span class="hs-comment">-- in TcMType</span><span>
</span><a name="line-33"></a><span>        </span><a href="TcHsSyn.html#zonkTopDecls"><span class="hs-identifier hs-var">zonkTopDecls</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#zonkTopExpr"><span class="hs-identifier hs-var">zonkTopExpr</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#zonkTopLExpr"><span class="hs-identifier hs-var">zonkTopLExpr</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>        </span><a href="TcHsSyn.html#zonkTopBndrs"><span class="hs-identifier hs-var">zonkTopBndrs</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>        </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#ZonkFlexi"><span class="hs-identifier hs-type">ZonkFlexi</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#emptyZonkEnv"><span class="hs-identifier hs-var">emptyZonkEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#mkEmptyZonkEnv"><span class="hs-identifier hs-var">mkEmptyZonkEnv</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>        </span><a href="TcHsSyn.html#zonkTyVarBinders"><span class="hs-identifier hs-var">zonkTyVarBinders</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#zonkTyVarBindersX"><span class="hs-identifier hs-var">zonkTyVarBindersX</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#zonkTyVarBinderX"><span class="hs-identifier hs-var">zonkTyVarBinderX</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>        </span><a href="TcHsSyn.html#zonkTyBndrs"><span class="hs-identifier hs-var">zonkTyBndrs</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#zonkTyBndrsX"><span class="hs-identifier hs-var">zonkTyBndrsX</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>        </span><a href="TcHsSyn.html#zonkTcTypeToType"><span class="hs-identifier hs-var">zonkTcTypeToType</span></a><span class="hs-special">,</span><span>  </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>        </span><a href="TcHsSyn.html#zonkTcTypesToTypes"><span class="hs-identifier hs-var">zonkTcTypesToTypes</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#zonkTcTypesToTypesX"><span class="hs-identifier hs-var">zonkTcTypesToTypesX</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>        </span><a href="TcHsSyn.html#zonkTyVarOcc"><span class="hs-identifier hs-var">zonkTyVarOcc</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>        </span><a href="TcHsSyn.html#zonkCoToCo"><span class="hs-identifier hs-var">zonkCoToCo</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>        </span><a href="TcHsSyn.html#zonkEvBinds"><span class="hs-identifier hs-var">zonkEvBinds</span></a><span class="hs-special">,</span><span> </span><a href="TcHsSyn.html#zonkTcEvBinds"><span class="hs-identifier hs-var">zonkTcEvBinds</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>        </span><a href="TcHsSyn.html#zonkTcMethInfoToMethInfoX"><span class="hs-identifier hs-var">zonkTcMethInfoToMethInfoX</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>        </span><a href="TcHsSyn.html#lookupTyVarOcc"><span class="hs-identifier hs-var">lookupTyVarOcc</span></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-50"></a><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HsSyn</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Id</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">IdInfo</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">PrelNames</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="BuildTyCl.html"><span class="hs-identifier">BuildTyCl</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span class="hs-special">,</span><span> </span><a href="BuildTyCl.html#MethInfo"><span class="hs-identifier hs-type">MethInfo</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcType</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="TcMType.html"><span class="hs-identifier">TcMType</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="TcEnv.html"><span class="hs-identifier">TcEnv</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="TcEnv.html#tcLookupGlobalOnly"><span class="hs-identifier hs-var">tcLookupGlobalOnly</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcEvidence</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysPrim</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TyCon</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TysWiredIn</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Coercion</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ConLike</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DataCon</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HscTypes</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">NameEnv</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Var</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">VarEnv</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Literal</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Maybes</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Bag</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">UniqFM</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreSyn</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="TcSplice.html"><span class="hs-identifier">TcSplice</span></a><span> </span><span class="hs-special">(</span><a href="TcSplice.html#runTopSplice"><span class="hs-identifier hs-var">runTopSplice</span></a><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Arrow</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
       Extracting the type from HsSyn
*                                                                      *
************************************************************************

-}</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-identifier">hsLPatType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OutPat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-100"></a><a name="hsLPatType"><a href="TcHsSyn.html#hsLPatType"><span class="hs-identifier">hsLPatType</span></a></a><span> </span><a name="local-6989586621681789457"><a href="#local-6989586621681789457"><span class="hs-identifier">lpat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#hsPatType"><span class="hs-identifier hs-var">hsPatType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621681789457"><span class="hs-identifier hs-var">lpat</span></a><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-103"></a><a name="hsPatType"><a href="TcHsSyn.html#hsPatType"><span class="hs-identifier">hsPatType</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789458"><a href="#local-6989586621681789458"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#hsLPatType"><span class="hs-identifier hs-var">hsLPatType</span></a><span> </span><a href="#local-6989586621681789458"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-104"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WildPat</span><span> </span><a name="local-6989586621681789459"><a href="#local-6989586621681789459"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789459"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-105"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789460"><a href="#local-6989586621681789460"><span class="hs-identifier">lvar</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">idType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621681789460"><span class="hs-identifier hs-var">lvar</span></a><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BangPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789461"><a href="#local-6989586621681789461"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#hsLPatType"><span class="hs-identifier hs-var">hsLPatType</span></a><span> </span><a href="#local-6989586621681789461"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-107"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LazyPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789462"><a href="#local-6989586621681789462"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#hsLPatType"><span class="hs-identifier hs-var">hsLPatType</span></a><span> </span><a href="#local-6989586621681789462"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-108"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789463"><a href="#local-6989586621681789463"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#hsLitType"><span class="hs-identifier hs-var">hsLitType</span></a><span> </span><a href="#local-6989586621681789463"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-109"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AsPat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789464"><a href="#local-6989586621681789464"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">idType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621681789464"><span class="hs-identifier hs-var">var</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ViewPat</span><span> </span><a name="local-6989586621681789465"><a href="#local-6989586621681789465"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789465"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-111"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPatTc</span><span> </span><a name="local-6989586621681789466"><a href="#local-6989586621681789466"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkListTy</span><span> </span><a href="#local-6989586621681789466"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-112"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPatTc</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789467"><a href="#local-6989586621681789467"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789467"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-113"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TuplePat</span><span> </span><a name="local-6989586621681789468"><a href="#local-6989586621681789468"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789469"><a href="#local-6989586621681789469"><span class="hs-identifier">bx</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTupleTy</span><span> </span><a href="#local-6989586621681789469"><span class="hs-identifier hs-var">bx</span></a><span> </span><a href="#local-6989586621681789468"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-114"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SumPat</span><span> </span><a name="local-6989586621681789470"><a href="#local-6989586621681789470"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkSumTy</span><span> </span><a href="#local-6989586621681789470"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-115"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatOut</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_con</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789471"><a href="#local-6989586621681789471"><span class="hs-identifier">lcon</span></a></a><span>
</span><a name="line-116"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789472"><a href="#local-6989586621681789472"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>                                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">conLikeResTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621681789471"><span class="hs-identifier hs-var">lcon</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789472"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-118"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigPat</span><span> </span><a name="local-6989586621681789473"><a href="#local-6989586621681789473"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789473"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-119"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NPat</span><span> </span><a name="local-6989586621681789474"><a href="#local-6989586621681789474"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789474"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-120"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NPlusKPat</span><span> </span><a name="local-6989586621681789475"><a href="#local-6989586621681789475"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789475"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-121"></a><span class="hs-identifier">hsPatType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoPat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789476"><a href="#local-6989586621681789476"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789476"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-122"></a><span class="hs-identifier">hsPatType</span><span> </span><a name="local-6989586621681789477"><a href="#local-6989586621681789477"><span class="hs-identifier">p</span></a></a><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;hsPatType&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681789477"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsLit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GhcPass</span><span> </span><a href="#local-6989586621681789456"><span class="hs-identifier hs-type">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcType</span><span>
</span><a name="line-125"></a><a name="hsLitType"><a href="TcHsSyn.html#hsLitType"><span class="hs-identifier">hsLitType</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsChar</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">charTy</span><span>
</span><a name="line-126"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCharPrim</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">charPrimTy</span><span>
</span><a name="line-127"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsString</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">stringTy</span><span>
</span><a name="line-128"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsStringPrim</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">addrPrimTy</span><span>
</span><a name="line-129"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">intTy</span><span>
</span><a name="line-130"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIntPrim</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">intPrimTy</span><span>
</span><a name="line-131"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWordPrim</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">wordPrimTy</span><span>
</span><a name="line-132"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInt64Prim</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">int64PrimTy</span><span>
</span><a name="line-133"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWord64Prim</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">word64PrimTy</span><span>
</span><a name="line-134"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInteger</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789478"><a href="#local-6989586621681789478"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789478"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-135"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789479"><a href="#local-6989586621681789479"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789479"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-136"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFloatPrim</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">floatPrimTy</span><span>
</span><a name="line-137"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsDoublePrim</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">doublePrimTy</span><span>
</span><a name="line-138"></a><span class="hs-identifier">hsLitType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XLit</span><span> </span><a name="local-6989586621681789480"><a href="#local-6989586621681789480"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;hsLitType&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681789480"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">-- Overloaded literals. Here mainly because it uses isIntTy etc</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-identifier">shortCutLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OverLitVal</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span>
</span><a name="line-143"></a><a name="shortCutLit"><a href="TcHsSyn.html#shortCutLit"><span class="hs-identifier">shortCutLit</span></a></a><span> </span><a name="local-6989586621681789481"><a href="#local-6989586621681789481"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIntegral</span><span> </span><a name="local-6989586621681789482"><a href="#local-6989586621681789482"><span class="hs-identifier">int</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">IL</span><span> </span><a name="local-6989586621681789483"><a href="#local-6989586621681789483"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621681789484"><a href="#local-6989586621681789484"><span class="hs-identifier">neg</span></a></a><span> </span><a name="local-6989586621681789485"><a href="#local-6989586621681789485"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681789486"><a href="#local-6989586621681789486"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-144"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isIntTy</span><span> </span><a href="#local-6989586621681789486"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">inIntRange</span><span>  </span><a href="#local-6989586621681789481"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681789485"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLit</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInt</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621681789482"><span class="hs-identifier hs-var">int</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWordTy</span><span> </span><a href="#local-6989586621681789486"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">inWordRange</span><span> </span><a href="#local-6989586621681789481"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621681789485"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#mkLit"><span class="hs-identifier hs-var">mkLit</span></a><span> </span><span class="hs-identifier hs-var">wordDataCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWordPrim</span><span> </span><a href="#local-6989586621681789483"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621681789485"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-146"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isIntegerTy</span><span> </span><a href="#local-6989586621681789486"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLit</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsInteger</span><span> </span><a href="#local-6989586621681789483"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621681789485"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621681789486"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#shortCutLit"><span class="hs-identifier hs-var">shortCutLit</span></a><span> </span><a href="#local-6989586621681789481"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFractional</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">integralFractionalLit</span><span> </span><a href="#local-6989586621681789484"><span class="hs-identifier hs-var">neg</span></a><span> </span><a href="#local-6989586621681789485"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789486"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-148"></a><span>        </span><span class="hs-comment">-- The 'otherwise' case is important</span><span>
</span><a name="line-149"></a><span>        </span><span class="hs-comment">-- Consider (3 :: Float).  Syntactically it looks like an IntLit,</span><span>
</span><a name="line-150"></a><span>        </span><span class="hs-comment">-- so we'll call shortCutIntLit, but of course it's a float</span><span>
</span><a name="line-151"></a><span>        </span><span class="hs-comment">-- This can make a big difference for programs with a lot of</span><span>
</span><a name="line-152"></a><span>        </span><span class="hs-comment">-- literals, compiled without -O</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-identifier">shortCutLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFractional</span><span> </span><a name="local-6989586621681789487"><a href="#local-6989586621681789487"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681789488"><a href="#local-6989586621681789488"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-155"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatTy</span><span> </span><a href="#local-6989586621681789488"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#mkLit"><span class="hs-identifier hs-var">mkLit</span></a><span> </span><span class="hs-identifier hs-var">floatDataCon</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFloatPrim</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621681789487"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isDoubleTy</span><span> </span><a href="#local-6989586621681789488"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#mkLit"><span class="hs-identifier hs-var">mkLit</span></a><span> </span><span class="hs-identifier hs-var">doubleDataCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsDoublePrim</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621681789487"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span class="hs-identifier">shortCutLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIsString</span><span> </span><a name="local-6989586621681789489"><a href="#local-6989586621681789489"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621681789490"><a href="#local-6989586621681789490"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681789491"><a href="#local-6989586621681789491"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-160"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isStringTy</span><span> </span><a href="#local-6989586621681789491"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLit</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsString</span><span> </span><a href="#local-6989586621681789489"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621681789490"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-identifier">mkLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DataCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span>
</span><a name="line-164"></a><a name="mkLit"><a href="TcHsSyn.html#mkLit"><span class="hs-identifier">mkLit</span></a></a><span> </span><a name="local-6989586621681789492"><a href="#local-6989586621681789492"><span class="hs-identifier">con</span></a></a><span> </span><a name="local-6989586621681789493"><a href="#local-6989586621681789493"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HsApp</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsDataCon</span><span> </span><a href="#local-6989586621681789492"><span class="hs-identifier hs-var">con</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nlHsLit</span><span> </span><a href="#local-6989586621681789493"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-167"></a><span class="hs-identifier">hsOverLitName</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">OverLitVal</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- Get the canonical 'fromX' name for a particular OverLitVal</span><span>
</span><a name="line-169"></a><a name="hsOverLitName"><a href="TcHsSyn.html#hsOverLitName"><span class="hs-identifier">hsOverLitName</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIntegral</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegerName</span><span>
</span><a name="line-170"></a><span class="hs-identifier">hsOverLitName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsFractional</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromRationalName</span><span>
</span><a name="line-171"></a><span class="hs-identifier">hsOverLitName</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIsString</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromStringName</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[BackSubst-HsBinds]{Running a substitution over @HsBinds@}
*                                                                      *
************************************************************************

The rest of the zonking is done *after* typechecking.
The main zonking pass runs over the bindings

 a) to convert TcTyVars to TyVars etc, dereferencing any bindings etc
 b) convert unbound TcTyVar to Void
 c) convert each TcId to an Id by zonking its type

The type variables are converted by binding mutable tyvars to immutable ones
and then zonking as normal.

The Ids are converted by binding them in the normal Tc envt; that
way we maintain sharing; eg an Id is zonked at its binding site and they
all occurrences of that Id point to the common zonked copy

It's all pretty boring stuff, because HsSyn is such a large type, and
the environment manipulation is tiresome.
-}</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">-- Confused by zonking? See Note [What is zonking?] in TcMType.</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">-- | See Note [The ZonkEnv]</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- Confused by zonking? See Note [What is zonking?] in TcMType.</span><span>
</span><a name="line-202"></a><span class="hs-keyword">data</span><span> </span><a name="ZonkEnv"><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier">ZonkEnv</span></a></a><span>  </span><span class="hs-comment">-- See Note [The ZonkEnv]</span><span>
</span><a name="line-203"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="ZonkEnv"><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier">ZonkEnv</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="ze_flexi"><a href="TcHsSyn.html#ze_flexi"><span class="hs-identifier">ze_flexi</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkFlexi"><span class="hs-identifier hs-type">ZonkFlexi</span></a><span>
</span><a name="line-204"></a><span>            </span><span class="hs-special">,</span><span> </span><a name="ze_tv_env"><a href="TcHsSyn.html#ze_tv_env"><span class="hs-identifier">ze_tv_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyCoVarEnv</span><span> </span><span class="hs-identifier hs-type">TyCoVar</span><span>
</span><a name="line-205"></a><span>            </span><span class="hs-special">,</span><span> </span><a name="ze_id_env"><a href="TcHsSyn.html#ze_id_env"><span class="hs-identifier">ze_id_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IdEnv</span><span>      </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-206"></a><span>            </span><span class="hs-special">,</span><span> </span><a name="ze_meta_tv_env"><a href="TcHsSyn.html#ze_meta_tv_env"><span class="hs-identifier">ze_meta_tv_env</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TcRef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TyVarEnv</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-207"></a><span class="hs-comment">{- Note [The ZonkEnv]
~~~~~~~~~~~~~~~~~~~~~
* ze_flexi :: ZonkFlexi says what to do with a
  unification variable that is still un-unified.
  See Note [Un-unified unification variables]

* ze_tv_env :: TyCoVarEnv TyCoVar promotes sharing. At a binding site
  of a tyvar or covar, we zonk the kind right away and add a mapping
  to the env. This prevents re-zonking the kind at every
  occurrence. But this is *just* an optimisation.

* ze_id_env : IdEnv Id promotes sharing among Ids, by making all
  occurrences of the Id point to a single zonked copy, built at the
  binding site.

  Unlike ze_tv_env, it is knot-tied: see extendIdZonkEnvRec.
  In a mutually recusive group
     rec { f = ...g...; g = ...f... }
  we want the occurrence of g to point to the one zonked Id for g,
  and the same for f.

  Because it is knot-tied, we must be careful to consult it lazily.
  Specifically, zonkIdOcc is not monadic.

* ze_meta_tv_env: see Note [Sharing when zonking to Type]


Notes:
  * We must be careful never to put coercion variables (which are Ids,
    after all) in the knot-tied ze_id_env, because coercions can
    appear in types, and we sometimes inspect a zonked type in this
    module.  [Question: where, precisely?]

  * In zonkTyVarOcc we consult ze_tv_env in a monadic context,
    a second reason that ze_tv_env can't be monadic.

  * An obvious suggestion would be to have one VarEnv Var to
    replace both ze_id_env and ze_tv_env, but that doesn't work
    because of the knot-tying stuff mentioned above.

Note [Un-unified unification variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
What should we do if we find a Flexi unification variable?
There are three possibilities:

* DefaultFlexi: this is the common case, in situations like
     length @alpha ([] @alpha)
  It really doesn't matter what type we choose for alpha.  But
  we must choose a type!  We can't leae mutable unification
  variables floating around: after typecheck is complete, every
  type variable occurrence must have a bindign site.

  So we default it to 'Any' of the right kind.

  All this works for both type and kind variables (indeed
  the two are the same thign).

* SkolemiseFlexi: is a special case for the LHS of RULES.
  See Note [Zonking the LHS of a RULE]

* RuntimeUnkFlexi: is a special case for the GHCi debugger.
  It's a way to have a variable that is not a mutuable
  unification variable, but doesn't have a binding site
  either.
-}</span><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span class="hs-keyword">data</span><span> </span><a name="ZonkFlexi"><a href="TcHsSyn.html#ZonkFlexi"><span class="hs-identifier">ZonkFlexi</span></a></a><span>   </span><span class="hs-comment">-- See Note [Un-unified unification variables]</span><span>
</span><a name="line-274"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="DefaultFlexi"><a href="TcHsSyn.html#DefaultFlexi"><span class="hs-identifier">DefaultFlexi</span></a></a><span>    </span><span class="hs-comment">-- Default unbound unificaiton variables to Any</span><span>
</span><a name="line-275"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SkolemiseFlexi"><a href="TcHsSyn.html#SkolemiseFlexi"><span class="hs-identifier">SkolemiseFlexi</span></a></a><span>  </span><span class="hs-comment">-- Skolemise unbound unification variables</span><span>
</span><a name="line-276"></a><span>                    </span><span class="hs-comment">-- See Note [Zonking the LHS of a RULE]</span><span>
</span><a name="line-277"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RuntimeUnkFlexi"><a href="TcHsSyn.html#RuntimeUnkFlexi"><span class="hs-identifier">RuntimeUnkFlexi</span></a></a><span> </span><span class="hs-comment">-- Used in the GHCi debugger</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-280"></a><span>  </span><a name="local-8214565720323806217"><span class="hs-identifier">ppr</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_id_env</span><span> </span><span class="hs-glyph">=</span><span>  </span><a name="local-6989586621681789442"><a href="#local-6989586621681789442"><span class="hs-identifier">var_env</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprUFM</span><span> </span><a href="#local-6989586621681789442"><span class="hs-identifier hs-var">var_env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">ppr</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-comment">-- The EvBinds have to already be zonked, but that's usually the case.</span><span>
</span><a name="line-283"></a><span class="hs-identifier">emptyZonkEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-284"></a><a name="emptyZonkEnv"><a href="TcHsSyn.html#emptyZonkEnv"><span class="hs-identifier">emptyZonkEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#mkEmptyZonkEnv"><span class="hs-identifier hs-var">mkEmptyZonkEnv</span></a><span> </span><a href="TcHsSyn.html#DefaultFlexi"><span class="hs-identifier hs-var">DefaultFlexi</span></a><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-identifier">mkEmptyZonkEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkFlexi"><span class="hs-identifier hs-type">ZonkFlexi</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-287"></a><a name="mkEmptyZonkEnv"><a href="TcHsSyn.html#mkEmptyZonkEnv"><span class="hs-identifier">mkEmptyZonkEnv</span></a></a><span> </span><a name="local-6989586621681789494"><a href="#local-6989586621681789494"><span class="hs-identifier">flexi</span></a></a><span>
</span><a name="line-288"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789495"><a href="#local-6989586621681789495"><span class="hs-identifier">mtv_env_ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a><span> </span><span class="hs-identifier hs-var">emptyVarEnv</span><span>
</span><a name="line-289"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_flexi</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789494"><span class="hs-identifier hs-var">flexi</span></a><span>
</span><a name="line-290"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ze_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyVarEnv</span><span>
</span><a name="line-291"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ze_id_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">emptyVarEnv</span><span>
</span><a name="line-292"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ze_meta_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789495"><span class="hs-identifier hs-var">mtv_env_ref</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span class="hs-identifier">initZonkEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681789454"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><a href="#local-6989586621681789455"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681789454"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><a href="#local-6989586621681789455"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-295"></a><a name="initZonkEnv"><a href="TcHsSyn.html#initZonkEnv"><span class="hs-identifier">initZonkEnv</span></a></a><span> </span><a name="local-6989586621681789496"><a href="#local-6989586621681789496"><span class="hs-identifier">do_it</span></a></a><span> </span><a name="local-6989586621681789497"><a href="#local-6989586621681789497"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789498"><a href="#local-6989586621681789498"><span class="hs-identifier">ze</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#mkEmptyZonkEnv"><span class="hs-identifier hs-var">mkEmptyZonkEnv</span></a><span> </span><a href="TcHsSyn.html#DefaultFlexi"><span class="hs-identifier hs-var">DefaultFlexi</span></a><span>
</span><a name="line-296"></a><span>                         </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621681789496"><span class="hs-identifier hs-var">do_it</span></a><span> </span><a href="#local-6989586621681789498"><span class="hs-identifier hs-var">ze</span></a><span> </span><a href="#local-6989586621681789497"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-comment">-- | Extend the knot-tied environment.</span><span>
</span><a name="line-299"></a><span class="hs-identifier">extendIdZonkEnvRec</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-300"></a><a name="extendIdZonkEnvRec"><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier">extendIdZonkEnvRec</span></a></a><span> </span><a name="local-6989586621681789499"><a href="#local-6989586621681789499"><span class="hs-identifier">ze</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_id_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789500"><a href="#local-6989586621681789500"><span class="hs-identifier">id_env</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681789501"><a href="#local-6989586621681789501"><span class="hs-identifier">ids</span></a></a><span>
</span><a name="line-301"></a><span>    </span><span class="hs-comment">-- NB: Don't look at the var to decide which env't to put it in. That</span><span>
</span><a name="line-302"></a><span>    </span><span class="hs-comment">-- would end up knot-tying all the env'ts.</span><span>
</span><a name="line-303"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789499"><span class="hs-identifier hs-var">ze</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_id_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">extendVarEnvList</span><span> </span><a href="#local-6989586621681789500"><span class="hs-identifier hs-var">id_env</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621681789502"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><a href="#local-6989586621681789502"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681789502"><a href="#local-6989586621681789502"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681789501"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-304"></a><span>  </span><span class="hs-comment">-- Given coercion variables will actually end up here. That's OK though:</span><span>
</span><a name="line-305"></a><span>  </span><span class="hs-comment">-- coercion variables are never looked up in the knot-tied env't, so zonking</span><span>
</span><a name="line-306"></a><span>  </span><span class="hs-comment">-- them simply doesn't get optimised. No one gets hurt. An improvement (?)</span><span>
</span><a name="line-307"></a><span>  </span><span class="hs-comment">-- would be to do SCC analysis in zonkEvBinds and then only knot-tie the</span><span>
</span><a name="line-308"></a><span>  </span><span class="hs-comment">-- recursive groups. But perhaps the time it takes to do the analysis is</span><span>
</span><a name="line-309"></a><span>  </span><span class="hs-comment">-- more than the savings.</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span class="hs-identifier">extendZonkEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-312"></a><a name="extendZonkEnv"><a href="TcHsSyn.html#extendZonkEnv"><span class="hs-identifier">extendZonkEnv</span></a></a><span> </span><a name="local-6989586621681789503"><a href="#local-6989586621681789503"><span class="hs-identifier">ze</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789504"><a href="#local-6989586621681789504"><span class="hs-identifier">tyco_env</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ze_id_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789505"><a href="#local-6989586621681789505"><span class="hs-identifier">id_env</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681789506"><a href="#local-6989586621681789506"><span class="hs-identifier">vars</span></a></a><span>
</span><a name="line-313"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789503"><span class="hs-identifier hs-var">ze</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">extendVarEnvList</span><span> </span><a href="#local-6989586621681789504"><span class="hs-identifier hs-var">tyco_env</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621681789509"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">,</span><a href="#local-6989586621681789509"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681789509"><a href="#local-6989586621681789509"><span class="hs-identifier">tv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681789507"><span class="hs-identifier hs-var">tycovars</span></a><span class="hs-special">]</span><span>
</span><a name="line-314"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ze_id_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">extendVarEnvList</span><span> </span><a href="#local-6989586621681789505"><span class="hs-identifier hs-var">id_env</span></a><span>   </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621681789510"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><a href="#local-6989586621681789510"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681789510"><a href="#local-6989586621681789510"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681789508"><span class="hs-identifier hs-var">ids</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-315"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-316"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621681789507"><a href="#local-6989586621681789507"><span class="hs-identifier">tycovars</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789508"><a href="#local-6989586621681789508"><span class="hs-identifier">ids</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-identifier hs-var">isTyCoVar</span><span> </span><a href="#local-6989586621681789506"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-identifier">extendIdZonkEnv1</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-319"></a><a name="extendIdZonkEnv1"><a href="TcHsSyn.html#extendIdZonkEnv1"><span class="hs-identifier">extendIdZonkEnv1</span></a></a><span> </span><a name="local-6989586621681789511"><a href="#local-6989586621681789511"><span class="hs-identifier">ze</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_id_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789512"><a href="#local-6989586621681789512"><span class="hs-identifier">id_env</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681789513"><a href="#local-6989586621681789513"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-320"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789511"><span class="hs-identifier hs-var">ze</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_id_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">extendVarEnv</span><span> </span><a href="#local-6989586621681789512"><span class="hs-identifier hs-var">id_env</span></a><span> </span><a href="#local-6989586621681789513"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621681789513"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-identifier">extendTyZonkEnv1</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-323"></a><a name="extendTyZonkEnv1"><a href="TcHsSyn.html#extendTyZonkEnv1"><span class="hs-identifier">extendTyZonkEnv1</span></a></a><span> </span><a name="local-6989586621681789514"><a href="#local-6989586621681789514"><span class="hs-identifier">ze</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789515"><a href="#local-6989586621681789515"><span class="hs-identifier">ty_env</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681789516"><a href="#local-6989586621681789516"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-324"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789514"><span class="hs-identifier hs-var">ze</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">extendVarEnv</span><span> </span><a href="#local-6989586621681789515"><span class="hs-identifier hs-var">ty_env</span></a><span> </span><a href="#local-6989586621681789516"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681789516"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span class="hs-identifier">setZonkType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsSyn.html#ZonkFlexi"><span class="hs-identifier hs-type">ZonkFlexi</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-327"></a><a name="setZonkType"><a href="TcHsSyn.html#setZonkType"><span class="hs-identifier">setZonkType</span></a></a><span> </span><a name="local-6989586621681789517"><a href="#local-6989586621681789517"><span class="hs-identifier">ze</span></a></a><span> </span><a name="local-6989586621681789518"><a href="#local-6989586621681789518"><span class="hs-identifier">flexi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789517"><span class="hs-identifier hs-var">ze</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_flexi</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789518"><span class="hs-identifier hs-var">flexi</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span class="hs-identifier">zonkEnvIds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TypeEnv</span><span>
</span><a name="line-330"></a><a name="zonkEnvIds"><a href="TcHsSyn.html#zonkEnvIds"><span class="hs-identifier">zonkEnvIds</span></a></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_id_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789519"><a href="#local-6989586621681789519"><span class="hs-identifier">id_env</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNameEnv</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">getName</span><span> </span><a href="#local-6989586621681789520"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">AnId</span><span> </span><a href="#local-6989586621681789520"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621681789520"><a href="#local-6989586621681789520"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">nonDetEltsUFM</span><span> </span><a href="#local-6989586621681789519"><span class="hs-identifier hs-var">id_env</span></a><span class="hs-special">]</span><span>
</span><a name="line-332"></a><span>  </span><span class="hs-comment">-- It's OK to use nonDetEltsUFM here because we forget the ordering</span><span>
</span><a name="line-333"></a><span>  </span><span class="hs-comment">-- immediately by creating a TypeEnv</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-identifier">zonkLIdOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">TcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-336"></a><a name="zonkLIdOcc"><a href="TcHsSyn.html#zonkLIdOcc"><span class="hs-identifier">zonkLIdOcc</span></a></a><span> </span><a name="local-6989586621681789521"><a href="#local-6989586621681789521"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">onHasSrcSpan</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkIdOcc"><span class="hs-identifier hs-var">zonkIdOcc</span></a><span> </span><a href="#local-6989586621681789521"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-identifier">zonkIdOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-339"></a><span class="hs-comment">-- Ids defined in this module should be in the envt;</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- ignore others.  (Actually, data constructors are also</span><span>
</span><a name="line-341"></a><span class="hs-comment">-- not LocalVars, even when locally defined, but that is fine.)</span><span>
</span><a name="line-342"></a><span class="hs-comment">-- (Also foreign-imported things aren't currently in the ZonkEnv;</span><span>
</span><a name="line-343"></a><span class="hs-comment">--  that's ok because they don't need zonking.)</span><span>
</span><a name="line-344"></a><span class="hs-comment">--</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- Actually, Template Haskell works in 'chunks' of declarations, and</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- an earlier chunk won't be in the 'env' that the zonking phase</span><span>
</span><a name="line-347"></a><span class="hs-comment">-- carries around.  Instead it'll be in the tcg_gbl_env, already fully</span><span>
</span><a name="line-348"></a><span class="hs-comment">-- zonked.  There's no point in looking it up there (except for error</span><span>
</span><a name="line-349"></a><span class="hs-comment">-- checking), and it's not conveniently to hand; hence the simple</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- 'orElse' case in the LocalVar branch.</span><span>
</span><a name="line-351"></a><span class="hs-comment">--</span><span>
</span><a name="line-352"></a><span class="hs-comment">-- Even without template splices, in module Main, the checking of</span><span>
</span><a name="line-353"></a><span class="hs-comment">-- 'main' is done as a separate chunk.</span><span>
</span><a name="line-354"></a><a name="zonkIdOcc"><a href="TcHsSyn.html#zonkIdOcc"><span class="hs-identifier">zonkIdOcc</span></a></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_id_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789522"><a href="#local-6989586621681789522"><span class="hs-identifier">id_env</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681789523"><a href="#local-6989586621681789523"><span class="hs-identifier">id</span></a></a><span>
</span><a name="line-355"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isLocalVar</span><span> </span><a href="#local-6989586621681789523"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lookupVarEnv</span><span> </span><a href="#local-6989586621681789522"><span class="hs-identifier hs-var">id_env</span></a><span> </span><a href="#local-6989586621681789523"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">orElse</span><span class="hs-special">`</span><span>
</span><a name="line-356"></a><span>                    </span><a href="#local-6989586621681789523"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-357"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789523"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span class="hs-identifier">zonkIdOccs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TcId</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span>
</span><a name="line-360"></a><a name="zonkIdOccs"><a href="TcHsSyn.html#zonkIdOccs"><span class="hs-identifier">zonkIdOccs</span></a></a><span> </span><a name="local-6989586621681789524"><a href="#local-6989586621681789524"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789525"><a href="#local-6989586621681789525"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkIdOcc"><span class="hs-identifier hs-var">zonkIdOcc</span></a><span> </span><a href="#local-6989586621681789524"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789525"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span class="hs-comment">-- zonkIdBndr is used *after* typechecking to get the Id's type</span><span>
</span><a name="line-363"></a><span class="hs-comment">-- to its final form.  The TyVarEnv give</span><span>
</span><a name="line-364"></a><span class="hs-identifier">zonkIdBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">Id</span><span>
</span><a name="line-365"></a><a name="zonkIdBndr"><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier">zonkIdBndr</span></a></a><span> </span><a name="local-6989586621681789526"><a href="#local-6989586621681789526"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789527"><a href="#local-6989586621681789527"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-366"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789528"><a href="#local-6989586621681789528"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789526"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621681789527"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-367"></a><span>       </span><a href="TcMType.html#ensureNotLevPoly"><span class="hs-identifier hs-var">ensureNotLevPoly</span></a><span> </span><a href="#local-6989586621681789528"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-368"></a><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In the type of binder&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681789527"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">modifyIdInfo</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">setLevityInfoWithType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681789528"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">setIdType</span><span> </span><a href="#local-6989586621681789527"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621681789528"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-371"></a><span>
</span><a name="line-372"></a><span class="hs-identifier">zonkIdBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TcId</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span>
</span><a name="line-373"></a><a name="zonkIdBndrs"><a href="TcHsSyn.html#zonkIdBndrs"><span class="hs-identifier">zonkIdBndrs</span></a></a><span> </span><a name="local-6989586621681789529"><a href="#local-6989586621681789529"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789530"><a href="#local-6989586621681789530"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681789529"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789530"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span class="hs-identifier">zonkTopBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TcId</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Id</span><span class="hs-special">]</span><span>
</span><a name="line-376"></a><a name="zonkTopBndrs"><a href="TcHsSyn.html#zonkTopBndrs"><span class="hs-identifier">zonkTopBndrs</span></a></a><span> </span><a name="local-6989586621681789531"><a href="#local-6989586621681789531"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a><span> </span><a href="TcHsSyn.html#zonkIdBndrs"><span class="hs-identifier hs-var">zonkIdBndrs</span></a><span> </span><a href="#local-6989586621681789531"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-377"></a><span>
</span><a name="line-378"></a><span class="hs-identifier">zonkFieldOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FieldOcc</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FieldOcc</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-379"></a><a name="zonkFieldOcc"><a href="TcHsSyn.html#zonkFieldOcc"><span class="hs-identifier">zonkFieldOcc</span></a></a><span> </span><a name="local-6989586621681789532"><a href="#local-6989586621681789532"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FieldOcc</span><span> </span><a name="local-6989586621681789533"><a href="#local-6989586621681789533"><span class="hs-identifier">sel</span></a></a><span> </span><a name="local-6989586621681789534"><a href="#local-6989586621681789534"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">FieldOcc</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789534"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681789532"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789533"><span class="hs-identifier hs-var">sel</span></a><span>
</span><a name="line-381"></a><span class="hs-identifier">zonkFieldOcc</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XFieldOcc</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkFieldOcc&quot;</span><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-identifier">zonkEvBndrsX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">EvVar</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-384"></a><a name="zonkEvBndrsX"><a href="TcHsSyn.html#zonkEvBndrsX"><span class="hs-identifier">zonkEvBndrsX</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapAccumLM</span><span> </span><a href="TcHsSyn.html#zonkEvBndrX"><span class="hs-identifier hs-var">zonkEvBndrX</span></a><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-identifier">zonkEvBndrX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span class="hs-comment">-- Works for dictionaries and coercions</span><span>
</span><a name="line-388"></a><a name="zonkEvBndrX"><a href="TcHsSyn.html#zonkEvBndrX"><span class="hs-identifier">zonkEvBndrX</span></a></a><span> </span><a name="local-6989586621681789535"><a href="#local-6989586621681789535"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789536"><a href="#local-6989586621681789536"><span class="hs-identifier">var</span></a></a><span>
</span><a name="line-389"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789537"><a href="#local-6989586621681789537"><span class="hs-identifier">var'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvBndr"><span class="hs-identifier hs-var">zonkEvBndr</span></a><span> </span><a href="#local-6989586621681789535"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789536"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-390"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#extendZonkEnv"><span class="hs-identifier hs-var">extendZonkEnv</span></a><span> </span><a href="#local-6989586621681789535"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681789537"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681789537"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-identifier">zonkEvBndr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">EvVar</span><span>
</span><a name="line-393"></a><span class="hs-comment">-- Works for dictionaries and coercions</span><span>
</span><a name="line-394"></a><span class="hs-comment">-- Does not extend the ZonkEnv</span><span>
</span><a name="line-395"></a><a name="zonkEvBndr"><a href="TcHsSyn.html#zonkEvBndr"><span class="hs-identifier">zonkEvBndr</span></a></a><span> </span><a name="local-6989586621681789538"><a href="#local-6989586621681789538"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789539"><a href="#local-6989586621681789539"><span class="hs-identifier">var</span></a></a><span>
</span><a name="line-396"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681789540"><a href="#local-6989586621681789540"><span class="hs-identifier">var_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">varType</span><span> </span><a href="#local-6989586621681789539"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-397"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789541"><a href="#local-6989586621681789541"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-398"></a><span>           </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;zonkEvBndr_zonkTcTypeToType&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-399"></a><span>           </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789538"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789540"><span class="hs-identifier hs-var">var_ty</span></a><span>
</span><a name="line-400"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">setVarType</span><span> </span><a href="#local-6989586621681789539"><span class="hs-identifier hs-var">var</span></a><span> </span><a href="#local-6989586621681789541"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-401"></a><span>
</span><a name="line-402"></a><span class="hs-comment">{-
zonkEvVarOcc :: ZonkEnv -&gt; EvVar -&gt; TcM EvTerm
zonkEvVarOcc env v
  | isCoVar v
  = EvCoercion &lt;$&gt; zonkCoVarOcc env v
  | otherwise
  = return (EvId $ zonkIdOcc env v)
-}</span><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span class="hs-identifier">zonkCoreBndrX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Var</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Var</span><span class="hs-special">)</span><span>
</span><a name="line-412"></a><a name="zonkCoreBndrX"><a href="TcHsSyn.html#zonkCoreBndrX"><span class="hs-identifier">zonkCoreBndrX</span></a></a><span> </span><a name="local-6989586621681789542"><a href="#local-6989586621681789542"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789543"><a href="#local-6989586621681789543"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-413"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isId</span><span> </span><a href="#local-6989586621681789543"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789544"><a href="#local-6989586621681789544"><span class="hs-identifier">v'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681789542"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789543"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-414"></a><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#extendIdZonkEnv1"><span class="hs-identifier hs-var">extendIdZonkEnv1</span></a><span> </span><a href="#local-6989586621681789542"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789544"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681789544"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-415"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkTyBndrX"><span class="hs-identifier hs-var">zonkTyBndrX</span></a><span> </span><a href="#local-6989586621681789542"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789543"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-identifier">zonkCoreBndrsX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Var</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-418"></a><a name="zonkCoreBndrsX"><a href="TcHsSyn.html#zonkCoreBndrsX"><span class="hs-identifier">zonkCoreBndrsX</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapAccumLM</span><span> </span><a href="TcHsSyn.html#zonkCoreBndrX"><span class="hs-identifier hs-var">zonkCoreBndrX</span></a><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span class="hs-identifier">zonkTyBndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TcTyVar</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-421"></a><a name="zonkTyBndrs"><a href="TcHsSyn.html#zonkTyBndrs"><span class="hs-identifier">zonkTyBndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a><span> </span><a href="TcHsSyn.html#zonkTyBndrsX"><span class="hs-identifier hs-var">zonkTyBndrsX</span></a><span>
</span><a name="line-422"></a><span>
</span><a name="line-423"></a><span class="hs-identifier">zonkTyBndrsX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TcTyVar</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-424"></a><a name="zonkTyBndrsX"><a href="TcHsSyn.html#zonkTyBndrsX"><span class="hs-identifier">zonkTyBndrsX</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapAccumLM</span><span> </span><a href="TcHsSyn.html#zonkTyBndrX"><span class="hs-identifier hs-var">zonkTyBndrX</span></a><span>
</span><a name="line-425"></a><span>
</span><a name="line-426"></a><span class="hs-identifier">zonkTyBndrX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcTyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span class="hs-special">)</span><span>
</span><a name="line-427"></a><span class="hs-comment">-- This guarantees to return a TyVar (not a TcTyVar)</span><span>
</span><a name="line-428"></a><span class="hs-comment">-- then we add it to the envt, so all occurrences are replaced</span><span>
</span><a name="line-429"></a><a name="zonkTyBndrX"><a href="TcHsSyn.html#zonkTyBndrX"><span class="hs-identifier">zonkTyBndrX</span></a></a><span> </span><a name="local-6989586621681789545"><a href="#local-6989586621681789545"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789546"><a href="#local-6989586621681789546"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-430"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isImmutableTyVar</span><span> </span><span class="hs-identifier hs-var">tv</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-identifier hs-var">tv</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">dcolon</span><span> </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tyVarKind</span><span> </span><span class="hs-identifier">tv</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789547"><a href="#local-6989586621681789547"><span class="hs-identifier">ki</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789545"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyVarKind</span><span> </span><a href="#local-6989586621681789546"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-432"></a><span>               </span><span class="hs-comment">-- Internal names tidy up better, for iface files.</span><span>
</span><a name="line-433"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681789548"><a href="#local-6989586621681789548"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkTyVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyVarName</span><span> </span><a href="#local-6989586621681789546"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789547"><span class="hs-identifier hs-var">ki</span></a><span>
</span><a name="line-434"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#extendTyZonkEnv1"><span class="hs-identifier hs-var">extendTyZonkEnv1</span></a><span> </span><a href="#local-6989586621681789545"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789548"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681789548"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-435"></a><span>
</span><a name="line-436"></a><span class="hs-identifier">zonkTyVarBinders</span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">[</span><span class="hs-identifier hs-type">VarBndr</span><span> </span><span class="hs-identifier hs-type">TcTyVar</span><span> </span><a href="#local-6989586621681789453"><span class="hs-identifier hs-type">vis</span></a><span class="hs-special">]</span><span>
</span><a name="line-437"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">VarBndr</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span> </span><a href="#local-6989586621681789453"><span class="hs-identifier hs-type">vis</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-438"></a><a name="zonkTyVarBinders"><a href="TcHsSyn.html#zonkTyVarBinders"><span class="hs-identifier">zonkTyVarBinders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a><span> </span><a href="TcHsSyn.html#zonkTyVarBindersX"><span class="hs-identifier hs-var">zonkTyVarBindersX</span></a><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-identifier">zonkTyVarBindersX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">VarBndr</span><span> </span><span class="hs-identifier hs-type">TcTyVar</span><span> </span><a href="#local-6989586621681789452"><span class="hs-identifier hs-type">vis</span></a><span class="hs-special">]</span><span>
</span><a name="line-441"></a><span>                             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">VarBndr</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span> </span><a href="#local-6989586621681789452"><span class="hs-identifier hs-type">vis</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-442"></a><a name="zonkTyVarBindersX"><a href="TcHsSyn.html#zonkTyVarBindersX"><span class="hs-identifier">zonkTyVarBindersX</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapAccumLM</span><span> </span><a href="TcHsSyn.html#zonkTyVarBinderX"><span class="hs-identifier hs-var">zonkTyVarBinderX</span></a><span>
</span><a name="line-443"></a><span>
</span><a name="line-444"></a><span class="hs-identifier">zonkTyVarBinderX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">VarBndr</span><span> </span><span class="hs-identifier hs-type">TcTyVar</span><span> </span><a href="#local-6989586621681789451"><span class="hs-identifier hs-type">vis</span></a><span>
</span><a name="line-445"></a><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">VarBndr</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span> </span><a href="#local-6989586621681789451"><span class="hs-identifier hs-type">vis</span></a><span class="hs-special">)</span><span>
</span><a name="line-446"></a><span class="hs-comment">-- Takes a TcTyVar and guarantees to return a TyVar</span><span>
</span><a name="line-447"></a><a name="zonkTyVarBinderX"><a href="TcHsSyn.html#zonkTyVarBinderX"><span class="hs-identifier">zonkTyVarBinderX</span></a></a><span> </span><a name="local-6989586621681789549"><a href="#local-6989586621681789549"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Bndr</span><span> </span><a name="local-6989586621681789550"><a href="#local-6989586621681789550"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681789551"><a href="#local-6989586621681789551"><span class="hs-identifier">vis</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789552"><a href="#local-6989586621681789552"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789553"><a href="#local-6989586621681789553"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTyBndrX"><span class="hs-identifier hs-var">zonkTyBndrX</span></a><span> </span><a href="#local-6989586621681789549"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789550"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-449"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789552"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Bndr</span><span> </span><a href="#local-6989586621681789553"><span class="hs-identifier hs-var">tv'</span></a><span> </span><a href="#local-6989586621681789551"><span class="hs-identifier hs-var">vis</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span class="hs-identifier">zonkTopExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-452"></a><a name="zonkTopExpr"><a href="TcHsSyn.html#zonkTopExpr"><span class="hs-identifier">zonkTopExpr</span></a></a><span> </span><a name="local-6989586621681789554"><a href="#local-6989586621681789554"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a><span> </span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681789554"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-453"></a><span>
</span><a name="line-454"></a><span class="hs-identifier">zonkTopLExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-455"></a><a name="zonkTopLExpr"><a href="TcHsSyn.html#zonkTopLExpr"><span class="hs-identifier">zonkTopLExpr</span></a></a><span> </span><a name="local-6989586621681789555"><a href="#local-6989586621681789555"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789555"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-456"></a><span>
</span><a name="line-457"></a><span class="hs-identifier">zonkTopDecls</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvBind</span><span>
</span><a name="line-458"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span>
</span><a name="line-459"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LRuleDecl</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LTcSpecPrag</span><span class="hs-special">]</span><span>
</span><a name="line-460"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LForeignDecl</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">]</span><span>
</span><a name="line-461"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TypeEnv</span><span class="hs-special">,</span><span>
</span><a name="line-462"></a><span>                     </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvBind</span><span class="hs-special">,</span><span>
</span><a name="line-463"></a><span>                     </span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">,</span><span>
</span><a name="line-464"></a><span>                     </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LForeignDecl</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-465"></a><span>                     </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LTcSpecPrag</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-466"></a><span>                     </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LRuleDecl</span><span>    </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-467"></a><a name="zonkTopDecls"><a href="TcHsSyn.html#zonkTopDecls"><span class="hs-identifier">zonkTopDecls</span></a></a><span> </span><a name="local-6989586621681789556"><a href="#local-6989586621681789556"><span class="hs-identifier">ev_binds</span></a></a><span> </span><a name="local-6989586621681789557"><a href="#local-6989586621681789557"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-6989586621681789558"><a href="#local-6989586621681789558"><span class="hs-identifier">rules</span></a></a><span> </span><a name="local-6989586621681789559"><a href="#local-6989586621681789559"><span class="hs-identifier">imp_specs</span></a></a><span> </span><a name="local-6989586621681789560"><a href="#local-6989586621681789560"><span class="hs-identifier">fords</span></a></a><span>
</span><a name="line-468"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789561"><a href="#local-6989586621681789561"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789562"><a href="#local-6989586621681789562"><span class="hs-identifier">ev_binds'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a><span> </span><a href="TcHsSyn.html#zonkEvBinds"><span class="hs-identifier hs-var">zonkEvBinds</span></a><span> </span><a href="#local-6989586621681789556"><span class="hs-identifier hs-var">ev_binds</span></a><span>
</span><a name="line-469"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789563"><a href="#local-6989586621681789563"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789564"><a href="#local-6989586621681789564"><span class="hs-identifier">binds'</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkRecMonoBinds"><span class="hs-identifier hs-var">zonkRecMonoBinds</span></a><span> </span><a href="#local-6989586621681789561"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789557"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-470"></a><span>                        </span><span class="hs-comment">-- Top level is implicitly recursive</span><span>
</span><a name="line-471"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789565"><a href="#local-6989586621681789565"><span class="hs-identifier">rules'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkRules"><span class="hs-identifier hs-var">zonkRules</span></a><span> </span><a href="#local-6989586621681789563"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681789558"><span class="hs-identifier hs-var">rules</span></a><span>
</span><a name="line-472"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789566"><a href="#local-6989586621681789566"><span class="hs-identifier">specs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLTcSpecPrags"><span class="hs-identifier hs-var">zonkLTcSpecPrags</span></a><span> </span><a href="#local-6989586621681789563"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681789559"><span class="hs-identifier hs-var">imp_specs</span></a><span>
</span><a name="line-473"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789567"><a href="#local-6989586621681789567"><span class="hs-identifier">fords'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkForeignExports"><span class="hs-identifier hs-var">zonkForeignExports</span></a><span> </span><a href="#local-6989586621681789563"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681789560"><span class="hs-identifier hs-var">fords</span></a><span>
</span><a name="line-474"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkEnvIds"><span class="hs-identifier hs-var">zonkEnvIds</span></a><span> </span><a href="#local-6989586621681789563"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681789562"><span class="hs-identifier hs-var">ev_binds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681789564"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681789567"><span class="hs-identifier hs-var">fords'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681789566"><span class="hs-identifier hs-var">specs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681789565"><span class="hs-identifier hs-var">rules'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-475"></a><span>
</span><a name="line-476"></a><span class="hs-comment">---------------------------------------------</span><span>
</span><a name="line-477"></a><span class="hs-identifier">zonkLocalBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsLocalBinds</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span>
</span><a name="line-478"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">HsLocalBinds</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-479"></a><a name="zonkLocalBinds"><a href="TcHsSyn.html#zonkLocalBinds"><span class="hs-identifier">zonkLocalBinds</span></a></a><span> </span><a name="local-6989586621681789568"><a href="#local-6989586621681789568"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EmptyLocalBinds</span><span> </span><a name="local-6989586621681789569"><a href="#local-6989586621681789569"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-480"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789568"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EmptyLocalBinds</span><span> </span><a href="#local-6989586621681789569"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-481"></a><span>
</span><a name="line-482"></a><span class="hs-identifier">zonkLocalBinds</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsValBinds</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ValBinds</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-483"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkLocalBinds&quot;</span><span> </span><span class="hs-comment">-- Not in typechecker output</span><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-identifier">zonkLocalBinds</span><span> </span><a name="local-6989586621681789570"><a href="#local-6989586621681789570"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsValBinds</span><span> </span><a name="local-6989586621681789571"><a href="#local-6989586621681789571"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XValBindsLR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NValBinds</span><span> </span><a name="local-6989586621681789572"><a href="#local-6989586621681789572"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-6989586621681789573"><a href="#local-6989586621681789573"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-486"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789584"><a href="#local-6989586621681789584"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789585"><a href="#local-6989586621681789585"><span class="hs-identifier">new_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681789574"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681789570"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789572"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-487"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789584"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">HsValBinds</span><span> </span><a href="#local-6989586621681789571"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XValBindsLR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NValBinds</span><span> </span><a href="#local-6989586621681789585"><span class="hs-identifier hs-var">new_binds</span></a><span> </span><a href="#local-6989586621681789573"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-488"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-489"></a><span>    </span><a name="local-6989586621681789574"><a href="#local-6989586621681789574"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621681789575"><a href="#local-6989586621681789575"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-490"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789575"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-491"></a><span>    </span><span class="hs-identifier">go</span><span> </span><a name="local-6989586621681789576"><a href="#local-6989586621681789576"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621681789577"><a href="#local-6989586621681789577"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621681789578"><a href="#local-6989586621681789578"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621681789579"><a href="#local-6989586621681789579"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-492"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789580"><a href="#local-6989586621681789580"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789581"><a href="#local-6989586621681789581"><span class="hs-identifier">b'</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkRecMonoBinds"><span class="hs-identifier hs-var">zonkRecMonoBinds</span></a><span> </span><a href="#local-6989586621681789576"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789578"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-493"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789582"><a href="#local-6989586621681789582"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789583"><a href="#local-6989586621681789583"><span class="hs-identifier">bs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681789574"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621681789580"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789579"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-494"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789582"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789577"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><a href="#local-6989586621681789581"><span class="hs-identifier hs-var">b'</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621681789583"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span class="hs-identifier">zonkLocalBinds</span><span> </span><a name="local-6989586621681789586"><a href="#local-6989586621681789586"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIPBinds</span><span> </span><a name="local-6989586621681789587"><a href="#local-6989586621681789587"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IPBinds</span><span> </span><a name="local-6989586621681789588"><a href="#local-6989586621681789588"><span class="hs-identifier">dict_binds</span></a></a><span> </span><a name="local-6989586621681789589"><a href="#local-6989586621681789589"><span class="hs-identifier">binds</span></a></a><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-497"></a><span>    </span><a name="local-6989586621681789596"><a href="#local-6989586621681789596"><span class="hs-identifier">new_binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="#local-6989586621681789590"><span class="hs-identifier hs-var">zonk_ip_bind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789589"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-498"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-499"></a><span>        </span><a name="local-6989586621681789597"><a href="#local-6989586621681789597"><span class="hs-identifier">env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier hs-var">extendIdZonkEnvRec</span></a><span> </span><a href="#local-6989586621681789586"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-500"></a><span>                 </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621681789598"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IPBind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621681789598"><a href="#local-6989586621681789598"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681789596"><span class="hs-identifier hs-var">new_binds</span></a><span class="hs-special">]</span><span>
</span><a name="line-501"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621681789599"><a href="#local-6989586621681789599"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789600"><a href="#local-6989586621681789600"><span class="hs-identifier">new_dict_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcEvBinds"><span class="hs-identifier hs-var">zonkTcEvBinds</span></a><span> </span><a href="#local-6989586621681789597"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789588"><span class="hs-identifier hs-var">dict_binds</span></a><span>
</span><a name="line-502"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789599"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">HsIPBinds</span><span> </span><a href="#local-6989586621681789587"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IPBinds</span><span> </span><a href="#local-6989586621681789600"><span class="hs-identifier hs-var">new_dict_binds</span></a><span> </span><a href="#local-6989586621681789596"><span class="hs-identifier hs-var">new_binds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-503"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-504"></a><span>    </span><a name="local-6989586621681789590"><a href="#local-6989586621681789590"><span class="hs-identifier">zonk_ip_bind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IPBind</span><span> </span><a name="local-6989586621681789591"><a href="#local-6989586621681789591"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789592"><a href="#local-6989586621681789592"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681789593"><a href="#local-6989586621681789593"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-505"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789594"><a href="#local-6989586621681789594"><span class="hs-identifier">n'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#mapIPNameTc"><span class="hs-identifier hs-var">mapIPNameTc</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681789586"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789592"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-506"></a><span>             </span><a name="local-6989586621681789595"><a href="#local-6989586621681789595"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789586"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789593"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-507"></a><span>             </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IPBind</span><span> </span><a href="#local-6989586621681789591"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789594"><span class="hs-identifier hs-var">n'</span></a><span> </span><a href="#local-6989586621681789595"><span class="hs-identifier hs-var">e'</span></a><span class="hs-special">)</span><span>
</span><a name="line-508"></a><span>    </span><span class="hs-identifier">zonk_ip_bind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XIPBind</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkLocalBinds : XCIPBind&quot;</span><span>
</span><a name="line-509"></a><span>
</span><a name="line-510"></a><span class="hs-identifier">zonkLocalBinds</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIPBinds</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsIPBinds</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkLocalBinds&quot;</span><span> </span><span class="hs-comment">-- Not in typechecker output</span><span>
</span><a name="line-512"></a><span class="hs-identifier">zonkLocalBinds</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsLocalBindsLR</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-513"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkLocalBinds&quot;</span><span> </span><span class="hs-comment">-- Not in typechecker output</span><span>
</span><a name="line-514"></a><span>
</span><a name="line-515"></a><span class="hs-comment">---------------------------------------------</span><span>
</span><a name="line-516"></a><span class="hs-identifier">zonkRecMonoBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-517"></a><a name="zonkRecMonoBinds"><a href="TcHsSyn.html#zonkRecMonoBinds"><span class="hs-identifier">zonkRecMonoBinds</span></a></a><span> </span><a name="local-6989586621681789601"><a href="#local-6989586621681789601"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789602"><a href="#local-6989586621681789602"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-518"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fixM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681789603"><a href="#local-6989586621681789603"><span class="hs-identifier">new_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-519"></a><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681789604"><a href="#local-6989586621681789604"><span class="hs-identifier">env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier hs-var">extendIdZonkEnvRec</span></a><span> </span><a href="#local-6989586621681789601"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">collectHsBindsBinders</span><span> </span><a href="#local-6989586621681789603"><span class="hs-identifier hs-var">new_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-520"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789605"><a href="#local-6989586621681789605"><span class="hs-identifier">binds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkMonoBinds"><span class="hs-identifier hs-var">zonkMonoBinds</span></a><span> </span><a href="#local-6989586621681789604"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789602"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-521"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789604"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681789605"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-522"></a><span>
</span><a name="line-523"></a><span class="hs-comment">---------------------------------------------</span><span>
</span><a name="line-524"></a><span class="hs-identifier">zonkMonoBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-525"></a><a name="zonkMonoBinds"><a href="TcHsSyn.html#zonkMonoBinds"><span class="hs-identifier">zonkMonoBinds</span></a></a><span> </span><a name="local-6989586621681789606"><a href="#local-6989586621681789606"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789607"><a href="#local-6989586621681789607"><span class="hs-identifier">binds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapBagM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonk_lbind"><span class="hs-identifier hs-var">zonk_lbind</span></a><span> </span><a href="#local-6989586621681789606"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789607"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span class="hs-identifier">zonk_lbind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-528"></a><a name="zonk_lbind"><a href="TcHsSyn.html#zonk_lbind"><span class="hs-identifier">zonk_lbind</span></a></a><span> </span><a name="local-6989586621681789608"><a href="#local-6989586621681789608"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonk_bind"><span class="hs-identifier hs-var">zonk_bind</span></a><span> </span><a href="#local-6989586621681789608"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span class="hs-identifier">zonk_bind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsBind</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsBind</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-531"></a><a name="zonk_bind"><a href="TcHsSyn.html#zonk_bind"><span class="hs-identifier">zonk_bind</span></a></a><span> </span><a name="local-6989586621681789609"><a href="#local-6989586621681789609"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789610"><a href="#local-6989586621681789610"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789611"><a href="#local-6989586621681789611"><span class="hs-identifier">pat</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789612"><a href="#local-6989586621681789612"><span class="hs-identifier">grhss</span></a></a><span>
</span><a name="line-532"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">NPatBindTc</span><span> </span><a name="local-6989586621681789613"><a href="#local-6989586621681789613"><span class="hs-identifier">fvs</span></a></a><span> </span><a name="local-6989586621681789614"><a href="#local-6989586621681789614"><span class="hs-identifier">ty</span></a></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-533"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789615"><a href="#local-6989586621681789615"><span class="hs-identifier">_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789616"><a href="#local-6989586621681789616"><span class="hs-identifier">new_pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681789609"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789611"><span class="hs-identifier hs-var">pat</span></a><span>            </span><span class="hs-comment">-- Env already extended</span><span>
</span><a name="line-534"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789617"><a href="#local-6989586621681789617"><span class="hs-identifier">new_grhss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkGRHSs"><span class="hs-identifier hs-var">zonkGRHSs</span></a><span> </span><a href="#local-6989586621681789609"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789612"><span class="hs-identifier hs-var">grhss</span></a><span>
</span><a name="line-535"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789618"><a href="#local-6989586621681789618"><span class="hs-identifier">new_ty</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789609"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789614"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-536"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789610"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789616"><span class="hs-identifier hs-var">new_pat</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789617"><span class="hs-identifier hs-var">new_grhss</span></a><span>
</span><a name="line-537"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">NPatBindTc</span><span> </span><a href="#local-6989586621681789613"><span class="hs-identifier hs-var">fvs</span></a><span> </span><a href="#local-6989586621681789618"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-538"></a><span>
</span><a name="line-539"></a><span class="hs-identifier">zonk_bind</span><span> </span><a name="local-6989586621681789619"><a href="#local-6989586621681789619"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">var_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789620"><a href="#local-6989586621681789620"><span class="hs-identifier">x</span></a></a><span>
</span><a name="line-540"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">var_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789621"><a href="#local-6989586621681789621"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">var_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789622"><a href="#local-6989586621681789622"><span class="hs-identifier">expr</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">var_inline</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789623"><a href="#local-6989586621681789623"><span class="hs-identifier">inl</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789624"><a href="#local-6989586621681789624"><span class="hs-identifier">new_var</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681789619"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789621"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-542"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789625"><a href="#local-6989586621681789625"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789619"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789622"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-543"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">var_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789620"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-544"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">var_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789624"><span class="hs-identifier hs-var">new_var</span></a><span>
</span><a name="line-545"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">var_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789625"><span class="hs-identifier hs-var">new_expr</span></a><span>
</span><a name="line-546"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">var_inline</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789623"><span class="hs-identifier hs-var">inl</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span class="hs-identifier">zonk_bind</span><span> </span><a name="local-6989586621681789626"><a href="#local-6989586621681789626"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789627"><a href="#local-6989586621681789627"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789628"><a href="#local-6989586621681789628"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621681789629"><a href="#local-6989586621681789629"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-549"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789630"><a href="#local-6989586621681789630"><span class="hs-identifier">ms</span></a></a><span>
</span><a name="line-550"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_co_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789631"><a href="#local-6989586621681789631"><span class="hs-identifier">co_fn</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-551"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789632"><a href="#local-6989586621681789632"><span class="hs-identifier">new_var</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681789626"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789629"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-552"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789633"><a href="#local-6989586621681789633"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789634"><a href="#local-6989586621681789634"><span class="hs-identifier">new_co_fn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681789626"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789631"><span class="hs-identifier hs-var">co_fn</span></a><span>
</span><a name="line-553"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789635"><a href="#local-6989586621681789635"><span class="hs-identifier">new_ms</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkMatchGroup"><span class="hs-identifier hs-var">zonkMatchGroup</span></a><span> </span><a href="#local-6989586621681789633"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789630"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-554"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789627"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789628"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621681789632"><span class="hs-identifier hs-var">new_var</span></a><span>
</span><a name="line-555"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789635"><span class="hs-identifier hs-var">new_ms</span></a><span>
</span><a name="line-556"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_co_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789634"><span class="hs-identifier hs-var">new_co_fn</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-557"></a><span>
</span><a name="line-558"></a><span class="hs-identifier">zonk_bind</span><span> </span><a name="local-6989586621681789636"><a href="#local-6989586621681789636"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AbsBinds</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">abs_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789637"><a href="#local-6989586621681789637"><span class="hs-identifier">tyvars</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_ev_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789638"><a href="#local-6989586621681789638"><span class="hs-identifier">evs</span></a></a><span>
</span><a name="line-559"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_ev_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789639"><a href="#local-6989586621681789639"><span class="hs-identifier">ev_binds</span></a></a><span>
</span><a name="line-560"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_exports</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789640"><a href="#local-6989586621681789640"><span class="hs-identifier">exports</span></a></a><span>
</span><a name="line-561"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789641"><a href="#local-6989586621681789641"><span class="hs-identifier">val_binds</span></a></a><span>
</span><a name="line-562"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_sig</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789642"><a href="#local-6989586621681789642"><span class="hs-identifier">has_sig</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-563"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier">isImmutableTyVar</span><span> </span><span class="hs-identifier hs-var">tyvars</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-564"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789666"><a href="#local-6989586621681789666"><span class="hs-identifier">env0</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789667"><a href="#local-6989586621681789667"><span class="hs-identifier">new_tyvars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTyBndrsX"><span class="hs-identifier hs-var">zonkTyBndrsX</span></a><span> </span><a href="#local-6989586621681789636"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789637"><span class="hs-identifier hs-var">tyvars</span></a><span>
</span><a name="line-565"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789668"><a href="#local-6989586621681789668"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789669"><a href="#local-6989586621681789669"><span class="hs-identifier">new_evs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvBndrsX"><span class="hs-identifier hs-var">zonkEvBndrsX</span></a><span> </span><a href="#local-6989586621681789666"><span class="hs-identifier hs-var">env0</span></a><span> </span><a href="#local-6989586621681789638"><span class="hs-identifier hs-var">evs</span></a><span>
</span><a name="line-566"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789670"><a href="#local-6989586621681789670"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789671"><a href="#local-6989586621681789671"><span class="hs-identifier">new_ev_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcEvBinds_s"><span class="hs-identifier hs-var">zonkTcEvBinds_s</span></a><span> </span><a href="#local-6989586621681789668"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789639"><span class="hs-identifier hs-var">ev_binds</span></a><span>
</span><a name="line-567"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789676"><a href="#local-6989586621681789676"><span class="hs-identifier">new_val_bind</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789677"><a href="#local-6989586621681789677"><span class="hs-identifier">new_exports</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fixM</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><a name="local-6989586621681789672"><a href="#local-6989586621681789672"><span class="hs-identifier">new_val_binds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-568"></a><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681789673"><a href="#local-6989586621681789673"><span class="hs-identifier">env3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier hs-var">extendIdZonkEnvRec</span></a><span> </span><a href="#local-6989586621681789670"><span class="hs-identifier hs-var">env2</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-569"></a><span>                         </span><span class="hs-identifier hs-var">collectHsBindsBinders</span><span> </span><a href="#local-6989586621681789672"><span class="hs-identifier hs-var">new_val_binds</span></a><span>
</span><a name="line-570"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789674"><a href="#local-6989586621681789674"><span class="hs-identifier">new_val_binds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapBagM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789643"><span class="hs-identifier hs-var">zonk_val_bind</span></a><span> </span><a href="#local-6989586621681789673"><span class="hs-identifier hs-var">env3</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789641"><span class="hs-identifier hs-var">val_binds</span></a><span>
</span><a name="line-571"></a><span>            </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789675"><a href="#local-6989586621681789675"><span class="hs-identifier">new_exports</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789644"><span class="hs-identifier hs-var">zonk_export</span></a><span> </span><a href="#local-6989586621681789673"><span class="hs-identifier hs-var">env3</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789640"><span class="hs-identifier hs-var">exports</span></a><span>
</span><a name="line-572"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789674"><span class="hs-identifier hs-var">new_val_binds</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681789675"><span class="hs-identifier hs-var">new_exports</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-573"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AbsBinds</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">abs_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span>
</span><a name="line-574"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789667"><span class="hs-identifier hs-var">new_tyvars</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_ev_vars</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789669"><span class="hs-identifier hs-var">new_evs</span></a><span>
</span><a name="line-575"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_ev_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789671"><span class="hs-identifier hs-var">new_ev_binds</span></a><span>
</span><a name="line-576"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_exports</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789677"><span class="hs-identifier hs-var">new_exports</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789676"><span class="hs-identifier hs-var">new_val_bind</span></a><span>
</span><a name="line-577"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abs_sig</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789642"><span class="hs-identifier hs-var">has_sig</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-578"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-579"></a><span>    </span><a name="local-6989586621681789643"><a href="#local-6989586621681789643"><span class="hs-identifier">zonk_val_bind</span></a></a><span> </span><a name="local-6989586621681789645"><a href="#local-6989586621681789645"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789646"><a href="#local-6989586621681789646"><span class="hs-identifier">lbind</span></a></a><span>
</span><a name="line-580"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681789642"><span class="hs-identifier hs-var">has_sig</span></a><span>
</span><a name="line-581"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789647"><a href="#local-6989586621681789647"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621681789648"><a href="#local-6989586621681789648"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789649"><a href="#local-6989586621681789649"><span class="hs-identifier">mloc</span></a></a><span> </span><a name="local-6989586621681789650"><a href="#local-6989586621681789650"><span class="hs-identifier">mono_id</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-582"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789651"><a href="#local-6989586621681789651"><span class="hs-identifier">ms</span></a></a><span>
</span><a name="line-583"></a><span>                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_co_fn</span><span>   </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789652"><a href="#local-6989586621681789652"><span class="hs-identifier">co_fn</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681789646"><span class="hs-identifier hs-var">lbind</span></a><span>
</span><a name="line-584"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789653"><a href="#local-6989586621681789653"><span class="hs-identifier">new_mono_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">updateVarTypeM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789645"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789650"><span class="hs-identifier hs-var">mono_id</span></a><span>
</span><a name="line-585"></a><span>                            </span><span class="hs-comment">-- Specifically /not/ zonkIdBndr; we do not</span><span>
</span><a name="line-586"></a><span>                            </span><span class="hs-comment">-- want to complain about a levity-polymorphic binder</span><span>
</span><a name="line-587"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789654"><a href="#local-6989586621681789654"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789655"><a href="#local-6989586621681789655"><span class="hs-identifier">new_co_fn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681789645"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789652"><span class="hs-identifier hs-var">co_fn</span></a><span>
</span><a name="line-588"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789656"><a href="#local-6989586621681789656"><span class="hs-identifier">new_ms</span></a></a><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkMatchGroup"><span class="hs-identifier hs-var">zonkMatchGroup</span></a><span> </span><a href="#local-6989586621681789654"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789651"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-589"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789647"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-590"></a><span>             </span><a href="#local-6989586621681789648"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789649"><span class="hs-identifier hs-var">mloc</span></a><span> </span><a href="#local-6989586621681789653"><span class="hs-identifier hs-var">new_mono_id</span></a><span>
</span><a name="line-591"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789656"><span class="hs-identifier hs-var">new_ms</span></a><span>
</span><a name="line-592"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_co_fn</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789655"><span class="hs-identifier hs-var">new_co_fn</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-593"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-594"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonk_lbind"><span class="hs-identifier hs-var">zonk_lbind</span></a><span> </span><a href="#local-6989586621681789645"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789646"><span class="hs-identifier hs-var">lbind</span></a><span>   </span><span class="hs-comment">-- The normal case</span><span>
</span><a name="line-595"></a><span>
</span><a name="line-596"></a><span>    </span><a name="local-6989586621681789644"><a href="#local-6989586621681789644"><span class="hs-identifier">zonk_export</span></a></a><span> </span><a name="local-6989586621681789657"><a href="#local-6989586621681789657"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ABE</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">abe_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789658"><a href="#local-6989586621681789658"><span class="hs-identifier">x</span></a></a><span>
</span><a name="line-597"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_wrap</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789659"><a href="#local-6989586621681789659"><span class="hs-identifier">wrap</span></a></a><span>
</span><a name="line-598"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_poly</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789660"><a href="#local-6989586621681789660"><span class="hs-identifier">poly_id</span></a></a><span>
</span><a name="line-599"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_mono</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789661"><a href="#local-6989586621681789661"><span class="hs-identifier">mono_id</span></a></a><span>
</span><a name="line-600"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_prags</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789662"><a href="#local-6989586621681789662"><span class="hs-identifier">prags</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789663"><a href="#local-6989586621681789663"><span class="hs-identifier">new_poly_id</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681789657"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789660"><span class="hs-identifier hs-var">poly_id</span></a><span>
</span><a name="line-602"></a><span>             </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681789664"><a href="#local-6989586621681789664"><span class="hs-identifier">new_wrap</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681789657"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789659"><span class="hs-identifier hs-var">wrap</span></a><span>
</span><a name="line-603"></a><span>             </span><a name="local-6989586621681789665"><a href="#local-6989586621681789665"><span class="hs-identifier">new_prags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSpecPrags"><span class="hs-identifier hs-var">zonkSpecPrags</span></a><span> </span><a href="#local-6989586621681789657"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789662"><span class="hs-identifier hs-var">prags</span></a><span>
</span><a name="line-604"></a><span>             </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ABE</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">abe_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789658"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-605"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_wrap</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789664"><span class="hs-identifier hs-var">new_wrap</span></a><span>
</span><a name="line-606"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_poly</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789663"><span class="hs-identifier hs-var">new_poly_id</span></a><span>
</span><a name="line-607"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_mono</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkIdOcc"><span class="hs-identifier hs-var">zonkIdOcc</span></a><span> </span><a href="#local-6989586621681789657"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789661"><span class="hs-identifier hs-var">mono_id</span></a><span>
</span><a name="line-608"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">abe_prags</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789665"><span class="hs-identifier hs-var">new_prags</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-609"></a><span>    </span><span class="hs-identifier">zonk_export</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XABExport</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonk_bind: XABExport&quot;</span><span>
</span><a name="line-610"></a><span>
</span><a name="line-611"></a><span class="hs-identifier">zonk_bind</span><span> </span><a name="local-6989586621681789678"><a href="#local-6989586621681789678"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynBind</span><span> </span><a name="local-6989586621681789679"><a href="#local-6989586621681789679"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789680"><a href="#local-6989586621681789680"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PSB</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789681"><a href="#local-6989586621681789681"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621681789682"><a href="#local-6989586621681789682"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-612"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789683"><a href="#local-6989586621681789683"><span class="hs-identifier">details</span></a></a><span>
</span><a name="line-613"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_def</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789684"><a href="#local-6989586621681789684"><span class="hs-identifier">lpat</span></a></a><span>
</span><a name="line-614"></a><span>                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_dir</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789685"><a href="#local-6989586621681789685"><span class="hs-identifier">dir</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-615"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789686"><a href="#local-6989586621681789686"><span class="hs-identifier">id'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681789678"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789682"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-616"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789687"><a href="#local-6989586621681789687"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789688"><a href="#local-6989586621681789688"><span class="hs-identifier">lpat'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681789678"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789684"><span class="hs-identifier hs-var">lpat</span></a><span>
</span><a name="line-617"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681789689"><a href="#local-6989586621681789689"><span class="hs-identifier">details'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkPatSynDetails"><span class="hs-identifier hs-var">zonkPatSynDetails</span></a><span> </span><a href="#local-6989586621681789687"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789683"><span class="hs-identifier hs-var">details</span></a><span>
</span><a name="line-618"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789690"><a href="#local-6989586621681789690"><span class="hs-identifier">_env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789691"><a href="#local-6989586621681789691"><span class="hs-identifier">dir'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPatSynDir"><span class="hs-identifier hs-var">zonkPatSynDir</span></a><span> </span><a href="#local-6989586621681789687"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789685"><span class="hs-identifier hs-var">dir</span></a><span>
</span><a name="line-619"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">PatSynBind</span><span> </span><a href="#local-6989586621681789679"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-620"></a><span>                  </span><a href="#local-6989586621681789680"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789681"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621681789686"><span class="hs-identifier hs-var">id'</span></a><span>
</span><a name="line-621"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789689"><span class="hs-identifier hs-var">details'</span></a><span>
</span><a name="line-622"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_def</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789688"><span class="hs-identifier hs-var">lpat'</span></a><span>
</span><a name="line-623"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_dir</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789691"><span class="hs-identifier hs-var">dir'</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-624"></a><span>
</span><a name="line-625"></a><span class="hs-identifier">zonk_bind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynBind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XPatSynBind</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonk_bind&quot;</span><span>
</span><a name="line-626"></a><span class="hs-identifier">zonk_bind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsBindsLR</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonk_bind&quot;</span><span>
</span><a name="line-627"></a><span>
</span><a name="line-628"></a><span class="hs-identifier">zonkPatSynDetails</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-629"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsPatSynDetails</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">TcId</span><span class="hs-special">)</span><span>
</span><a name="line-630"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsPatSynDetails</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Id</span><span class="hs-special">)</span><span>
</span><a name="line-631"></a><a name="zonkPatSynDetails"><a href="TcHsSyn.html#zonkPatSynDetails"><span class="hs-identifier">zonkPatSynDetails</span></a></a><span> </span><a name="local-6989586621681789692"><a href="#local-6989586621681789692"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PrefixCon</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-632"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">PrefixCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkLIdOcc"><span class="hs-identifier hs-var">zonkLIdOcc</span></a><span> </span><a href="#local-6989586621681789692"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span>
</span><a name="line-633"></a><span class="hs-identifier">zonkPatSynDetails</span><span> </span><a name="local-6989586621681789694"><a href="#local-6989586621681789694"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a name="local-6989586621681789695"><a href="#local-6989586621681789695"><span class="hs-identifier">a1</span></a></a><span> </span><a name="local-6989586621681789696"><a href="#local-6989586621681789696"><span class="hs-identifier">a2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-634"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">InfixCon</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkLIdOcc"><span class="hs-identifier hs-var">zonkLIdOcc</span></a><span> </span><a href="#local-6989586621681789694"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789695"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkLIdOcc"><span class="hs-identifier hs-var">zonkLIdOcc</span></a><span> </span><a href="#local-6989586621681789694"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789696"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span>
</span><a name="line-635"></a><span class="hs-identifier">zonkPatSynDetails</span><span> </span><a name="local-6989586621681789697"><a href="#local-6989586621681789697"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecCon</span><span> </span><a name="local-6989586621681789698"><a href="#local-6989586621681789698"><span class="hs-identifier">flds</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-636"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RecCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkLIdOcc"><span class="hs-identifier hs-var">zonkLIdOcc</span></a><span> </span><a href="#local-6989586621681789697"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789698"><span class="hs-identifier hs-var">flds</span></a><span class="hs-special">)</span><span>
</span><a name="line-637"></a><span>
</span><a name="line-638"></a><span class="hs-identifier">zonkPatSynDir</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsPatSynDir</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span>
</span><a name="line-639"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">HsPatSynDir</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-640"></a><a name="zonkPatSynDir"><a href="TcHsSyn.html#zonkPatSynDir"><span class="hs-identifier">zonkPatSynDir</span></a></a><span> </span><a name="local-6989586621681789699"><a href="#local-6989586621681789699"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier hs-var">Unidirectional</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789699"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Unidirectional</span><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span class="hs-identifier">zonkPatSynDir</span><span> </span><a name="local-6989586621681789700"><a href="#local-6989586621681789700"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier hs-var">ImplicitBidirectional</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789700"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ImplicitBidirectional</span><span class="hs-special">)</span><span>
</span><a name="line-642"></a><span class="hs-identifier">zonkPatSynDir</span><span> </span><a name="local-6989586621681789701"><a href="#local-6989586621681789701"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExplicitBidirectional</span><span> </span><a name="local-6989586621681789702"><a href="#local-6989586621681789702"><span class="hs-identifier">mg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-643"></a><span>    </span><a name="local-6989586621681789703"><a href="#local-6989586621681789703"><span class="hs-identifier">mg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkMatchGroup"><span class="hs-identifier hs-var">zonkMatchGroup</span></a><span> </span><a href="#local-6989586621681789701"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789702"><span class="hs-identifier hs-var">mg</span></a><span>
</span><a name="line-644"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789701"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ExplicitBidirectional</span><span> </span><a href="#local-6989586621681789703"><span class="hs-identifier hs-var">mg'</span></a><span class="hs-special">)</span><span>
</span><a name="line-645"></a><span>
</span><a name="line-646"></a><span class="hs-identifier">zonkSpecPrags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcSpecPrags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">TcSpecPrags</span><span>
</span><a name="line-647"></a><a name="zonkSpecPrags"><a href="TcHsSyn.html#zonkSpecPrags"><span class="hs-identifier">zonkSpecPrags</span></a></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-identifier hs-var">IsDefaultMethod</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">IsDefaultMethod</span><span>
</span><a name="line-648"></a><span class="hs-identifier">zonkSpecPrags</span><span> </span><a name="local-6989586621681789704"><a href="#local-6989586621681789704"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecPrags</span><span> </span><a name="local-6989586621681789705"><a href="#local-6989586621681789705"><span class="hs-identifier">ps</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789706"><a href="#local-6989586621681789706"><span class="hs-identifier">ps'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLTcSpecPrags"><span class="hs-identifier hs-var">zonkLTcSpecPrags</span></a><span> </span><a href="#local-6989586621681789704"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789705"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-649"></a><span>                                       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecPrags</span><span> </span><a href="#local-6989586621681789706"><span class="hs-identifier hs-var">ps'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-650"></a><span>
</span><a name="line-651"></a><span class="hs-identifier">zonkLTcSpecPrags</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LTcSpecPrag</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LTcSpecPrag</span><span class="hs-special">]</span><span>
</span><a name="line-652"></a><a name="zonkLTcSpecPrags"><a href="TcHsSyn.html#zonkLTcSpecPrags"><span class="hs-identifier">zonkLTcSpecPrags</span></a></a><span> </span><a name="local-6989586621681789707"><a href="#local-6989586621681789707"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789708"><a href="#local-6989586621681789708"><span class="hs-identifier">ps</span></a></a><span>
</span><a name="line-653"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681789709"><span class="hs-identifier hs-var">zonk_prag</span></a><span> </span><a href="#local-6989586621681789708"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-654"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-655"></a><span>    </span><a name="local-6989586621681789709"><a href="#local-6989586621681789709"><span class="hs-identifier">zonk_prag</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789710"><a href="#local-6989586621681789710"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecPrag</span><span> </span><a name="local-6989586621681789711"><a href="#local-6989586621681789711"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621681789712"><a href="#local-6989586621681789712"><span class="hs-identifier">co_fn</span></a></a><span> </span><a name="local-6989586621681789713"><a href="#local-6989586621681789713"><span class="hs-identifier">inl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-656"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681789714"><a href="#local-6989586621681789714"><span class="hs-identifier">co_fn'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681789707"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789712"><span class="hs-identifier hs-var">co_fn</span></a><span>
</span><a name="line-657"></a><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789710"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecPrag</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkIdOcc"><span class="hs-identifier hs-var">zonkIdOcc</span></a><span> </span><a href="#local-6989586621681789707"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789711"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789714"><span class="hs-identifier hs-var">co_fn'</span></a><span> </span><a href="#local-6989586621681789713"><span class="hs-identifier hs-var">inl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-658"></a><span>
</span><a name="line-659"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[BackSubst-Match-GRHSs]{Match and GRHSs}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-identifier">zonkMatchGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-668"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789450"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789450"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-669"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MatchGroup</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789450"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-670"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MatchGroup</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789450"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-671"></a><a name="zonkMatchGroup"><a href="TcHsSyn.html#zonkMatchGroup"><span class="hs-identifier">zonkMatchGroup</span></a></a><span> </span><a name="local-6989586621681789715"><a href="#local-6989586621681789715"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789716"><a href="#local-6989586621681789716"><span class="hs-identifier">zBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MG</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mg_alts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789717"><a href="#local-6989586621681789717"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681789718"><a href="#local-6989586621681789718"><span class="hs-identifier">ms</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-672"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mg_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MatchGroupTc</span><span> </span><a name="local-6989586621681789719"><a href="#local-6989586621681789719"><span class="hs-identifier">arg_tys</span></a></a><span> </span><a name="local-6989586621681789720"><a href="#local-6989586621681789720"><span class="hs-identifier">res_ty</span></a></a><span>
</span><a name="line-673"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mg_origin</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789721"><a href="#local-6989586621681789721"><span class="hs-identifier">origin</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-674"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789722"><a href="#local-6989586621681789722"><span class="hs-identifier">ms'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkMatch"><span class="hs-identifier hs-var">zonkMatch</span></a><span> </span><a href="#local-6989586621681789715"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789716"><span class="hs-identifier hs-var">zBody</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789718"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-675"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789723"><a href="#local-6989586621681789723"><span class="hs-identifier">arg_tys'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypesToTypesX"><span class="hs-identifier hs-var">zonkTcTypesToTypesX</span></a><span> </span><a href="#local-6989586621681789715"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789719"><span class="hs-identifier hs-var">arg_tys</span></a><span>
</span><a name="line-676"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789724"><a href="#local-6989586621681789724"><span class="hs-identifier">res_ty'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789715"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789720"><span class="hs-identifier hs-var">res_ty</span></a><span>
</span><a name="line-677"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MG</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mg_alts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789717"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681789722"><span class="hs-identifier hs-var">ms'</span></a><span>
</span><a name="line-678"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mg_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">MatchGroupTc</span><span> </span><a href="#local-6989586621681789723"><span class="hs-identifier hs-var">arg_tys'</span></a><span> </span><a href="#local-6989586621681789724"><span class="hs-identifier hs-var">res_ty'</span></a><span>
</span><a name="line-679"></a><span>                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mg_origin</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789721"><span class="hs-identifier hs-var">origin</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-680"></a><span class="hs-identifier">zonkMatchGroup</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XMatchGroup</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkMatchGroup&quot;</span><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span class="hs-identifier">zonkMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-683"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789449"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789449"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-684"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789449"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-685"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789449"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-686"></a><a name="zonkMatch"><a href="TcHsSyn.html#zonkMatch"><span class="hs-identifier">zonkMatch</span></a></a><span> </span><a name="local-6989586621681789725"><a href="#local-6989586621681789725"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789726"><a href="#local-6989586621681789726"><span class="hs-identifier">zBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789727"><a href="#local-6989586621681789727"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621681789728"><a href="#local-6989586621681789728"><span class="hs-identifier">match</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Match</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789729"><a href="#local-6989586621681789729"><span class="hs-identifier">pats</span></a></a><span>
</span><a name="line-687"></a><span>                                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_grhss</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789730"><a href="#local-6989586621681789730"><span class="hs-identifier">grhss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-688"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789731"><a href="#local-6989586621681789731"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789732"><a href="#local-6989586621681789732"><span class="hs-identifier">new_pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPats"><span class="hs-identifier hs-var">zonkPats</span></a><span> </span><a href="#local-6989586621681789725"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789729"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-689"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789733"><a href="#local-6989586621681789733"><span class="hs-identifier">new_grhss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkGRHSs"><span class="hs-identifier hs-var">zonkGRHSs</span></a><span> </span><a href="#local-6989586621681789731"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789726"><span class="hs-identifier hs-var">zBody</span></a><span> </span><a href="#local-6989586621681789730"><span class="hs-identifier hs-var">grhss</span></a><span>
</span><a name="line-690"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789727"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789728"><span class="hs-identifier hs-var">match</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789732"><span class="hs-identifier hs-var">new_pats</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_grhss</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789733"><span class="hs-identifier hs-var">new_grhss</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-691"></a><span class="hs-identifier">zonkMatch</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XMatch</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkMatch&quot;</span><span>
</span><a name="line-692"></a><span class="hs-identifier">zonkMatch</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkMatch: Impossible Match&quot;</span><span>
</span><a name="line-693"></a><span>                             </span><span class="hs-comment">-- due to #15884</span><span>
</span><a name="line-694"></a><span>
</span><a name="line-695"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-696"></a><span class="hs-identifier">zonkGRHSs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-697"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789448"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789448"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-698"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GRHSs</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789448"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-699"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GRHSs</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789448"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-700"></a><span>
</span><a name="line-701"></a><a name="zonkGRHSs"><a href="TcHsSyn.html#zonkGRHSs"><span class="hs-identifier">zonkGRHSs</span></a></a><span> </span><a name="local-6989586621681789734"><a href="#local-6989586621681789734"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789735"><a href="#local-6989586621681789735"><span class="hs-identifier">zBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHSs</span><span> </span><a name="local-6989586621681789736"><a href="#local-6989586621681789736"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789737"><a href="#local-6989586621681789737"><span class="hs-identifier">grhss</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789738"><a href="#local-6989586621681789738"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681789739"><a href="#local-6989586621681789739"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-702"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621681789740"><a href="#local-6989586621681789740"><span class="hs-identifier">new_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789741"><a href="#local-6989586621681789741"><span class="hs-identifier">new_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLocalBinds"><span class="hs-identifier hs-var">zonkLocalBinds</span></a><span> </span><a href="#local-6989586621681789734"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789739"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-703"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-704"></a><span>        </span><a name="local-6989586621681789742"><a href="#local-6989586621681789742"><span class="hs-identifier">zonk_grhs</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHS</span><span> </span><a name="local-6989586621681789743"><a href="#local-6989586621681789743"><span class="hs-identifier">xx</span></a></a><span> </span><a name="local-6989586621681789744"><a href="#local-6989586621681789744"><span class="hs-identifier">guarded</span></a></a><span> </span><a name="local-6989586621681789745"><a href="#local-6989586621681789745"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-705"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789746"><a href="#local-6989586621681789746"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789747"><a href="#local-6989586621681789747"><span class="hs-identifier">new_guarded</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkStmts"><span class="hs-identifier hs-var">zonkStmts</span></a><span> </span><a href="#local-6989586621681789740"><span class="hs-identifier hs-var">new_env</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789744"><span class="hs-identifier hs-var">guarded</span></a><span>
</span><a name="line-706"></a><span>               </span><a name="local-6989586621681789748"><a href="#local-6989586621681789748"><span class="hs-identifier">new_rhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681789735"><span class="hs-identifier hs-var">zBody</span></a><span> </span><a href="#local-6989586621681789746"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681789745"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-707"></a><span>               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHS</span><span> </span><a href="#local-6989586621681789743"><span class="hs-identifier hs-var">xx</span></a><span> </span><a href="#local-6989586621681789747"><span class="hs-identifier hs-var">new_guarded</span></a><span> </span><a href="#local-6989586621681789748"><span class="hs-identifier hs-var">new_rhs</span></a><span class="hs-special">)</span><span>
</span><a name="line-708"></a><span>        </span><span class="hs-identifier">zonk_grhs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XGRHS</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkGRHSs&quot;</span><span>
</span><a name="line-709"></a><span>    </span><a name="local-6989586621681789749"><a href="#local-6989586621681789749"><span class="hs-identifier">new_grhss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="#local-6989586621681789742"><span class="hs-identifier hs-var">zonk_grhs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789737"><span class="hs-identifier hs-var">grhss</span></a><span>
</span><a name="line-710"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHSs</span><span> </span><a href="#local-6989586621681789736"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789749"><span class="hs-identifier hs-var">new_grhss</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789738"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681789741"><span class="hs-identifier hs-var">new_binds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-711"></a><span class="hs-identifier">zonkGRHSs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XGRHSs</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkGRHSs&quot;</span><span>
</span><a name="line-712"></a><span>
</span><a name="line-713"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[BackSubst-HsExpr]{Running a zonkitution over a TypeCheckedExpr}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-720"></a><span>
</span><a name="line-721"></a><span class="hs-identifier">zonkLExprs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span>
</span><a name="line-722"></a><span class="hs-identifier">zonkLExpr</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-723"></a><span class="hs-identifier">zonkExpr</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-724"></a><span>
</span><a name="line-725"></a><a name="zonkLExprs"><a href="TcHsSyn.html#zonkLExprs"><span class="hs-identifier">zonkLExprs</span></a></a><span> </span><a name="local-6989586621681789750"><a href="#local-6989586621681789750"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789751"><a href="#local-6989586621681789751"><span class="hs-identifier">exprs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789750"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789751"><span class="hs-identifier hs-var">exprs</span></a><span>
</span><a name="line-726"></a><a name="zonkLExpr"><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier">zonkLExpr</span></a></a><span>  </span><a name="local-6989586621681789752"><a href="#local-6989586621681789752"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789753"><a href="#local-6989586621681789753"><span class="hs-identifier">expr</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681789752"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789753"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-727"></a><span>
</span><a name="line-728"></a><a name="zonkExpr"><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier">zonkExpr</span></a></a><span> </span><a name="local-6989586621681789754"><a href="#local-6989586621681789754"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsVar</span><span> </span><a name="local-6989586621681789755"><a href="#local-6989586621681789755"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789756"><a href="#local-6989586621681789756"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681789757"><a href="#local-6989586621681789757"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-729"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isNothing</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">isDataConId_maybe</span><span> </span><span class="hs-identifier hs-var">id</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-730"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsVar</span><span> </span><a href="#local-6989586621681789755"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789756"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkIdOcc"><span class="hs-identifier hs-var">zonkIdOcc</span></a><span> </span><a href="#local-6989586621681789754"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789757"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-731"></a><span>
</span><a name="line-732"></a><span class="hs-identifier">zonkExpr</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789758"><a href="#local-6989586621681789758"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsConLikeOut</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681789758"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-733"></a><span>
</span><a name="line-734"></a><span class="hs-identifier">zonkExpr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIPVar</span><span> </span><a name="local-6989586621681789759"><a href="#local-6989586621681789759"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789760"><a href="#local-6989586621681789760"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-735"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIPVar</span><span> </span><a href="#local-6989586621681789759"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789760"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">)</span><span>
</span><a name="line-736"></a><span>
</span><a name="line-737"></a><span class="hs-identifier">zonkExpr</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789761"><a href="#local-6989586621681789761"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-identifier hs-var">HsOverLabel</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681789761"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-738"></a><span>
</span><a name="line-739"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789762"><a href="#local-6989586621681789762"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLit</span><span> </span><a name="local-6989586621681789763"><a href="#local-6989586621681789763"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRat</span><span> </span><a name="local-6989586621681789764"><a href="#local-6989586621681789764"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621681789765"><a href="#local-6989586621681789765"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621681789766"><a href="#local-6989586621681789766"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-740"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789767"><a href="#local-6989586621681789767"><span class="hs-identifier">new_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789762"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789766"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-741"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLit</span><span> </span><a href="#local-6989586621681789763"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRat</span><span> </span><a href="#local-6989586621681789764"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621681789765"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621681789767"><span class="hs-identifier hs-var">new_ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-742"></a><span>
</span><a name="line-743"></a><span class="hs-identifier">zonkExpr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLit</span><span> </span><a name="local-6989586621681789768"><a href="#local-6989586621681789768"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789769"><a href="#local-6989586621681789769"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-744"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLit</span><span> </span><a href="#local-6989586621681789768"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789769"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-745"></a><span>
</span><a name="line-746"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789770"><a href="#local-6989586621681789770"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsOverLit</span><span> </span><a name="local-6989586621681789771"><a href="#local-6989586621681789771"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789772"><a href="#local-6989586621681789772"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-747"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789773"><a href="#local-6989586621681789773"><span class="hs-identifier">lit'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkOverLit"><span class="hs-identifier hs-var">zonkOverLit</span></a><span> </span><a href="#local-6989586621681789770"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789772"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-748"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsOverLit</span><span> </span><a href="#local-6989586621681789771"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789773"><span class="hs-identifier hs-var">lit'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-749"></a><span>
</span><a name="line-750"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789774"><a href="#local-6989586621681789774"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLam</span><span> </span><a name="local-6989586621681789775"><a href="#local-6989586621681789775"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789776"><a href="#local-6989586621681789776"><span class="hs-identifier">matches</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-751"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789777"><a href="#local-6989586621681789777"><span class="hs-identifier">new_matches</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkMatchGroup"><span class="hs-identifier hs-var">zonkMatchGroup</span></a><span> </span><a href="#local-6989586621681789774"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789776"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-752"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLam</span><span> </span><a href="#local-6989586621681789775"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789777"><span class="hs-identifier hs-var">new_matches</span></a><span class="hs-special">)</span><span>
</span><a name="line-753"></a><span>
</span><a name="line-754"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789778"><a href="#local-6989586621681789778"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLamCase</span><span> </span><a name="local-6989586621681789779"><a href="#local-6989586621681789779"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789780"><a href="#local-6989586621681789780"><span class="hs-identifier">matches</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-755"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789781"><a href="#local-6989586621681789781"><span class="hs-identifier">new_matches</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkMatchGroup"><span class="hs-identifier hs-var">zonkMatchGroup</span></a><span> </span><a href="#local-6989586621681789778"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789780"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-756"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLamCase</span><span> </span><a href="#local-6989586621681789779"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789781"><span class="hs-identifier hs-var">new_matches</span></a><span class="hs-special">)</span><span>
</span><a name="line-757"></a><span>
</span><a name="line-758"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789782"><a href="#local-6989586621681789782"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsApp</span><span> </span><a name="local-6989586621681789783"><a href="#local-6989586621681789783"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789784"><a href="#local-6989586621681789784"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621681789785"><a href="#local-6989586621681789785"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-759"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789786"><a href="#local-6989586621681789786"><span class="hs-identifier">new_e1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789782"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789784"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-760"></a><span>       </span><a name="local-6989586621681789787"><a href="#local-6989586621681789787"><span class="hs-identifier">new_e2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789782"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789785"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-761"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsApp</span><span> </span><a href="#local-6989586621681789783"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789786"><span class="hs-identifier hs-var">new_e1</span></a><span> </span><a href="#local-6989586621681789787"><span class="hs-identifier hs-var">new_e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-762"></a><span>
</span><a name="line-763"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789788"><a href="#local-6989586621681789788"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsAppType</span><span> </span><a name="local-6989586621681789789"><a href="#local-6989586621681789789"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789790"><a href="#local-6989586621681789790"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621681789791"><a href="#local-6989586621681789791"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-764"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789792"><a href="#local-6989586621681789792"><span class="hs-identifier">new_e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789788"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789790"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-765"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsAppType</span><span> </span><a href="#local-6989586621681789789"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789792"><span class="hs-identifier hs-var">new_e</span></a><span> </span><a href="#local-6989586621681789791"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span>
</span><a name="line-766"></a><span>       </span><span class="hs-comment">-- NB: the type is an HsType; can't zonk that!</span><span>
</span><a name="line-767"></a><span>
</span><a name="line-768"></a><span class="hs-identifier">zonkExpr</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789793"><a href="#local-6989586621681789793"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRnBracketOut</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-769"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;zonkExpr: HsRnBracketOut&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681789793"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-770"></a><span>
</span><a name="line-771"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789794"><a href="#local-6989586621681789794"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTcBracketOut</span><span> </span><a name="local-6989586621681789795"><a href="#local-6989586621681789795"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789796"><a href="#local-6989586621681789796"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621681789797"><a href="#local-6989586621681789797"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-772"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789802"><a href="#local-6989586621681789802"><span class="hs-identifier">bs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681789798"><span class="hs-identifier hs-var">zonk_b</span></a><span> </span><a href="#local-6989586621681789797"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-773"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTcBracketOut</span><span> </span><a href="#local-6989586621681789795"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789796"><span class="hs-identifier hs-var">body</span></a><span> </span><a href="#local-6989586621681789802"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-774"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-775"></a><span>    </span><a name="local-6989586621681789798"><a href="#local-6989586621681789798"><span class="hs-identifier">zonk_b</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PendingTcSplice</span><span> </span><a name="local-6989586621681789799"><a href="#local-6989586621681789799"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621681789800"><a href="#local-6989586621681789800"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789801"><a href="#local-6989586621681789801"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789794"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789800"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-776"></a><span>                                      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PendingTcSplice</span><span> </span><a href="#local-6989586621681789799"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621681789801"><span class="hs-identifier hs-var">e'</span></a><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>
</span><a name="line-778"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789803"><a href="#local-6989586621681789803"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSpliceE</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSplicedT</span><span> </span><a name="local-6989586621681789804"><a href="#local-6989586621681789804"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-779"></a><span>  </span><a href="TcSplice.html#runTopSplice"><span class="hs-identifier hs-var">runTopSplice</span></a><span> </span><a href="#local-6989586621681789804"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681789803"><span class="hs-identifier hs-var">env</span></a><span>
</span><a name="line-780"></a><span>
</span><a name="line-781"></a><span class="hs-identifier">zonkExpr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSpliceE</span><span> </span><a name="local-6989586621681789805"><a href="#local-6989586621681789805"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789806"><a href="#local-6989586621681789806"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">WARN</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier hs-var">s</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Should not happen</span><span>
</span><a name="line-782"></a><span>                           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSpliceE</span><span> </span><a href="#local-6989586621681789805"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789806"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-783"></a><span>
</span><a name="line-784"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789807"><a href="#local-6989586621681789807"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpApp</span><span> </span><a name="local-6989586621681789808"><a href="#local-6989586621681789808"><span class="hs-identifier">fixity</span></a></a><span> </span><a name="local-6989586621681789809"><a href="#local-6989586621681789809"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621681789810"><a href="#local-6989586621681789810"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621681789811"><a href="#local-6989586621681789811"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-785"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789812"><a href="#local-6989586621681789812"><span class="hs-identifier">new_e1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789807"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789809"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-786"></a><span>       </span><a name="local-6989586621681789813"><a href="#local-6989586621681789813"><span class="hs-identifier">new_op</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789807"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789810"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-787"></a><span>       </span><a name="local-6989586621681789814"><a href="#local-6989586621681789814"><span class="hs-identifier">new_e2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789807"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789811"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-788"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">OpApp</span><span> </span><a href="#local-6989586621681789808"><span class="hs-identifier hs-var">fixity</span></a><span> </span><a href="#local-6989586621681789812"><span class="hs-identifier hs-var">new_e1</span></a><span> </span><a href="#local-6989586621681789813"><span class="hs-identifier hs-var">new_op</span></a><span> </span><a href="#local-6989586621681789814"><span class="hs-identifier hs-var">new_e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-789"></a><span>
</span><a name="line-790"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789815"><a href="#local-6989586621681789815"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NegApp</span><span> </span><a name="local-6989586621681789816"><a href="#local-6989586621681789816"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789817"><a href="#local-6989586621681789817"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621681789818"><a href="#local-6989586621681789818"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-791"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789819"><a href="#local-6989586621681789819"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789820"><a href="#local-6989586621681789820"><span class="hs-identifier">new_op</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681789815"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789818"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-792"></a><span>       </span><a name="local-6989586621681789821"><a href="#local-6989586621681789821"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789819"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-6989586621681789817"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-793"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NegApp</span><span> </span><a href="#local-6989586621681789816"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789821"><span class="hs-identifier hs-var">new_expr</span></a><span> </span><a href="#local-6989586621681789820"><span class="hs-identifier hs-var">new_op</span></a><span class="hs-special">)</span><span>
</span><a name="line-794"></a><span>
</span><a name="line-795"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789822"><a href="#local-6989586621681789822"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsPar</span><span> </span><a name="local-6989586621681789823"><a href="#local-6989586621681789823"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789824"><a href="#local-6989586621681789824"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-796"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789825"><a href="#local-6989586621681789825"><span class="hs-identifier">new_e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789822"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789824"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-797"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsPar</span><span> </span><a href="#local-6989586621681789823"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789825"><span class="hs-identifier hs-var">new_e</span></a><span class="hs-special">)</span><span>
</span><a name="line-798"></a><span>
</span><a name="line-799"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789826"><a href="#local-6989586621681789826"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SectionL</span><span> </span><a name="local-6989586621681789827"><a href="#local-6989586621681789827"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789828"><a href="#local-6989586621681789828"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621681789829"><a href="#local-6989586621681789829"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-800"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789830"><a href="#local-6989586621681789830"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789826"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789828"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-801"></a><span>       </span><a name="local-6989586621681789831"><a href="#local-6989586621681789831"><span class="hs-identifier">new_op</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789826"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789829"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-802"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SectionL</span><span> </span><a href="#local-6989586621681789827"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789830"><span class="hs-identifier hs-var">new_expr</span></a><span> </span><a href="#local-6989586621681789831"><span class="hs-identifier hs-var">new_op</span></a><span class="hs-special">)</span><span>
</span><a name="line-803"></a><span>
</span><a name="line-804"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789832"><a href="#local-6989586621681789832"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SectionR</span><span> </span><a name="local-6989586621681789833"><a href="#local-6989586621681789833"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789834"><a href="#local-6989586621681789834"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621681789835"><a href="#local-6989586621681789835"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-805"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789836"><a href="#local-6989586621681789836"><span class="hs-identifier">new_op</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789832"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789834"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-806"></a><span>       </span><a name="local-6989586621681789837"><a href="#local-6989586621681789837"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789832"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789835"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-807"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SectionR</span><span> </span><a href="#local-6989586621681789833"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789836"><span class="hs-identifier hs-var">new_op</span></a><span> </span><a href="#local-6989586621681789837"><span class="hs-identifier hs-var">new_expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-808"></a><span>
</span><a name="line-809"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789838"><a href="#local-6989586621681789838"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExplicitTuple</span><span> </span><a name="local-6989586621681789839"><a href="#local-6989586621681789839"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789840"><a href="#local-6989586621681789840"><span class="hs-identifier">tup_args</span></a></a><span> </span><a name="local-6989586621681789841"><a href="#local-6989586621681789841"><span class="hs-identifier">boxed</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-810"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789850"><a href="#local-6989586621681789850"><span class="hs-identifier">new_tup_args</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681789842"><span class="hs-identifier hs-var">zonk_tup_arg</span></a><span> </span><a href="#local-6989586621681789840"><span class="hs-identifier hs-var">tup_args</span></a><span>
</span><a name="line-811"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExplicitTuple</span><span> </span><a href="#local-6989586621681789839"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789850"><span class="hs-identifier hs-var">new_tup_args</span></a><span> </span><a href="#local-6989586621681789841"><span class="hs-identifier hs-var">boxed</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-812"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-813"></a><span>    </span><a name="local-6989586621681789842"><a href="#local-6989586621681789842"><span class="hs-identifier">zonk_tup_arg</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789843"><a href="#local-6989586621681789843"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Present</span><span> </span><a name="local-6989586621681789844"><a href="#local-6989586621681789844"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789845"><a href="#local-6989586621681789845"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789846"><a href="#local-6989586621681789846"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789838"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789845"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-814"></a><span>                                              </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789843"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Present</span><span> </span><a href="#local-6989586621681789844"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789846"><span class="hs-identifier hs-var">e'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-815"></a><span>    </span><span class="hs-identifier">zonk_tup_arg</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789847"><a href="#local-6989586621681789847"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Missing</span><span> </span><a name="local-6989586621681789848"><a href="#local-6989586621681789848"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789849"><a href="#local-6989586621681789849"><span class="hs-identifier">t'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789838"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789848"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-816"></a><span>                                            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789847"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Missing</span><span> </span><a href="#local-6989586621681789849"><span class="hs-identifier hs-var">t'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-817"></a><span>    </span><span class="hs-identifier">zonk_tup_arg</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XTupArg</span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkExpr.XTupArg&quot;</span><span>
</span><a name="line-818"></a><span>    </span><span class="hs-identifier">zonk_tup_arg</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonk_tup_arg: Impossible Match&quot;</span><span>
</span><a name="line-819"></a><span>                             </span><span class="hs-comment">-- due to #15884</span><span>
</span><a name="line-820"></a><span>
</span><a name="line-821"></a><span>
</span><a name="line-822"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789851"><a href="#local-6989586621681789851"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExplicitSum</span><span> </span><a name="local-6989586621681789852"><a href="#local-6989586621681789852"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621681789853"><a href="#local-6989586621681789853"><span class="hs-identifier">alt</span></a></a><span> </span><a name="local-6989586621681789854"><a href="#local-6989586621681789854"><span class="hs-identifier">arity</span></a></a><span> </span><a name="local-6989586621681789855"><a href="#local-6989586621681789855"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-823"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789856"><a href="#local-6989586621681789856"><span class="hs-identifier">new_args</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789851"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789852"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-824"></a><span>       </span><a name="local-6989586621681789857"><a href="#local-6989586621681789857"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789851"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789855"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-825"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExplicitSum</span><span> </span><a href="#local-6989586621681789856"><span class="hs-identifier hs-var">new_args</span></a><span> </span><a href="#local-6989586621681789853"><span class="hs-identifier hs-var">alt</span></a><span> </span><a href="#local-6989586621681789854"><span class="hs-identifier hs-var">arity</span></a><span> </span><a href="#local-6989586621681789857"><span class="hs-identifier hs-var">new_expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789858"><a href="#local-6989586621681789858"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCase</span><span> </span><a name="local-6989586621681789859"><a href="#local-6989586621681789859"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789860"><a href="#local-6989586621681789860"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621681789861"><a href="#local-6989586621681789861"><span class="hs-identifier">ms</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-828"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789862"><a href="#local-6989586621681789862"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789858"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789860"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-829"></a><span>       </span><a name="local-6989586621681789863"><a href="#local-6989586621681789863"><span class="hs-identifier">new_ms</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkMatchGroup"><span class="hs-identifier hs-var">zonkMatchGroup</span></a><span> </span><a href="#local-6989586621681789858"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789861"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-830"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCase</span><span> </span><a href="#local-6989586621681789859"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789862"><span class="hs-identifier hs-var">new_expr</span></a><span> </span><a href="#local-6989586621681789863"><span class="hs-identifier hs-var">new_ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-831"></a><span>
</span><a name="line-832"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789864"><a href="#local-6989586621681789864"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIf</span><span> </span><a name="local-6989586621681789865"><a href="#local-6989586621681789865"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621681789866"><a href="#local-6989586621681789866"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621681789867"><a href="#local-6989586621681789867"><span class="hs-identifier">e2</span></a></a><span> </span><a name="local-6989586621681789868"><a href="#local-6989586621681789868"><span class="hs-identifier">e3</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-833"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789869"><a href="#local-6989586621681789869"><span class="hs-identifier">new_e1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789864"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789866"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-834"></a><span>       </span><a name="local-6989586621681789870"><a href="#local-6989586621681789870"><span class="hs-identifier">new_e2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789864"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789867"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-835"></a><span>       </span><a name="local-6989586621681789871"><a href="#local-6989586621681789871"><span class="hs-identifier">new_e3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789864"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789868"><span class="hs-identifier hs-var">e3</span></a><span>
</span><a name="line-836"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIf</span><span> </span><a href="#local-6989586621681789865"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621681789869"><span class="hs-identifier hs-var">new_e1</span></a><span> </span><a href="#local-6989586621681789870"><span class="hs-identifier hs-var">new_e2</span></a><span> </span><a href="#local-6989586621681789871"><span class="hs-identifier hs-var">new_e3</span></a><span class="hs-special">)</span><span>
</span><a name="line-837"></a><span>
</span><a name="line-838"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789872"><a href="#local-6989586621681789872"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIf</span><span> </span><a name="local-6989586621681789873"><a href="#local-6989586621681789873"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681789874"><a href="#local-6989586621681789874"><span class="hs-identifier">fun</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681789875"><a href="#local-6989586621681789875"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621681789876"><a href="#local-6989586621681789876"><span class="hs-identifier">e2</span></a></a><span> </span><a name="local-6989586621681789877"><a href="#local-6989586621681789877"><span class="hs-identifier">e3</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-839"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789878"><a href="#local-6989586621681789878"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789879"><a href="#local-6989586621681789879"><span class="hs-identifier">new_fun</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681789872"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789874"><span class="hs-identifier hs-var">fun</span></a><span>
</span><a name="line-840"></a><span>       </span><a name="local-6989586621681789880"><a href="#local-6989586621681789880"><span class="hs-identifier">new_e1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789878"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789875"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-841"></a><span>       </span><a name="local-6989586621681789881"><a href="#local-6989586621681789881"><span class="hs-identifier">new_e2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789878"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789876"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-842"></a><span>       </span><a name="local-6989586621681789882"><a href="#local-6989586621681789882"><span class="hs-identifier">new_e3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789878"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789877"><span class="hs-identifier hs-var">e3</span></a><span>
</span><a name="line-843"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIf</span><span> </span><a href="#local-6989586621681789873"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621681789879"><span class="hs-identifier hs-var">new_fun</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789880"><span class="hs-identifier hs-var">new_e1</span></a><span> </span><a href="#local-6989586621681789881"><span class="hs-identifier hs-var">new_e2</span></a><span> </span><a href="#local-6989586621681789882"><span class="hs-identifier hs-var">new_e3</span></a><span class="hs-special">)</span><span>
</span><a name="line-844"></a><span>
</span><a name="line-845"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789883"><a href="#local-6989586621681789883"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsMultiIf</span><span> </span><a name="local-6989586621681789884"><a href="#local-6989586621681789884"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681789885"><a href="#local-6989586621681789885"><span class="hs-identifier">alts</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-846"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789893"><a href="#local-6989586621681789893"><span class="hs-identifier">alts'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="#local-6989586621681789886"><span class="hs-identifier hs-var">zonk_alt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789885"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-847"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789894"><a href="#local-6989586621681789894"><span class="hs-identifier">ty'</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789883"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789884"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-848"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">HsMultiIf</span><span> </span><a href="#local-6989586621681789894"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681789893"><span class="hs-identifier hs-var">alts'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-849"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681789886"><a href="#local-6989586621681789886"><span class="hs-identifier">zonk_alt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHS</span><span> </span><a name="local-6989586621681789887"><a href="#local-6989586621681789887"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789888"><a href="#local-6989586621681789888"><span class="hs-identifier">guard</span></a></a><span> </span><a name="local-6989586621681789889"><a href="#local-6989586621681789889"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-850"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789890"><a href="#local-6989586621681789890"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789891"><a href="#local-6989586621681789891"><span class="hs-identifier">guard'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkStmts"><span class="hs-identifier hs-var">zonkStmts</span></a><span> </span><a href="#local-6989586621681789883"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789888"><span class="hs-identifier hs-var">guard</span></a><span>
</span><a name="line-851"></a><span>               </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789892"><a href="#local-6989586621681789892"><span class="hs-identifier">expr'</span></a></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789890"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-6989586621681789889"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-852"></a><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">GRHS</span><span> </span><a href="#local-6989586621681789887"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789891"><span class="hs-identifier hs-var">guard'</span></a><span> </span><a href="#local-6989586621681789892"><span class="hs-identifier hs-var">expr'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-853"></a><span>        </span><span class="hs-identifier">zonk_alt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XGRHS</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkExpr.HsMultiIf&quot;</span><span>
</span><a name="line-854"></a><span>
</span><a name="line-855"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789895"><a href="#local-6989586621681789895"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLet</span><span> </span><a name="local-6989586621681789896"><a href="#local-6989586621681789896"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789897"><a href="#local-6989586621681789897"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681789898"><a href="#local-6989586621681789898"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681789899"><a href="#local-6989586621681789899"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-856"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789900"><a href="#local-6989586621681789900"><span class="hs-identifier">new_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789901"><a href="#local-6989586621681789901"><span class="hs-identifier">new_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLocalBinds"><span class="hs-identifier hs-var">zonkLocalBinds</span></a><span> </span><a href="#local-6989586621681789895"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789898"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-857"></a><span>       </span><a name="local-6989586621681789902"><a href="#local-6989586621681789902"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789900"><span class="hs-identifier hs-var">new_env</span></a><span> </span><a href="#local-6989586621681789899"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-858"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsLet</span><span> </span><a href="#local-6989586621681789896"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789897"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681789901"><span class="hs-identifier hs-var">new_binds</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789902"><span class="hs-identifier hs-var">new_expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-859"></a><span>
</span><a name="line-860"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789903"><a href="#local-6989586621681789903"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsDo</span><span> </span><a name="local-6989586621681789904"><a href="#local-6989586621681789904"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681789905"><a href="#local-6989586621681789905"><span class="hs-identifier">do_or_lc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681789906"><a href="#local-6989586621681789906"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681789907"><a href="#local-6989586621681789907"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-861"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681789908"><a href="#local-6989586621681789908"><span class="hs-identifier">new_stmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkStmts"><span class="hs-identifier hs-var">zonkStmts</span></a><span> </span><a href="#local-6989586621681789903"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789907"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-862"></a><span>       </span><a name="local-6989586621681789909"><a href="#local-6989586621681789909"><span class="hs-identifier">new_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789903"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789904"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-863"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsDo</span><span> </span><a href="#local-6989586621681789909"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><a href="#local-6989586621681789905"><span class="hs-identifier hs-var">do_or_lc</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681789906"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681789908"><span class="hs-identifier hs-var">new_stmts</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-864"></a><span>
</span><a name="line-865"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789910"><a href="#local-6989586621681789910"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExplicitList</span><span> </span><a name="local-6989586621681789911"><a href="#local-6989586621681789911"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681789912"><a href="#local-6989586621681789912"><span class="hs-identifier">wit</span></a></a><span> </span><a name="local-6989586621681789913"><a href="#local-6989586621681789913"><span class="hs-identifier">exprs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-866"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789918"><a href="#local-6989586621681789918"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789919"><a href="#local-6989586621681789919"><span class="hs-identifier">new_wit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681789914"><span class="hs-identifier hs-var">zonkWit</span></a><span> </span><a href="#local-6989586621681789910"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789912"><span class="hs-identifier hs-var">wit</span></a><span>
</span><a name="line-867"></a><span>       </span><a name="local-6989586621681789920"><a href="#local-6989586621681789920"><span class="hs-identifier">new_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789918"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789911"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-868"></a><span>       </span><a name="local-6989586621681789921"><a href="#local-6989586621681789921"><span class="hs-identifier">new_exprs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExprs"><span class="hs-identifier hs-var">zonkLExprs</span></a><span> </span><a href="#local-6989586621681789918"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789913"><span class="hs-identifier hs-var">exprs</span></a><span>
</span><a name="line-869"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExplicitList</span><span> </span><a href="#local-6989586621681789920"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><a href="#local-6989586621681789919"><span class="hs-identifier hs-var">new_wit</span></a><span> </span><a href="#local-6989586621681789921"><span class="hs-identifier hs-var">new_exprs</span></a><span class="hs-special">)</span><span>
</span><a name="line-870"></a><span>   </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681789914"><a href="#local-6989586621681789914"><span class="hs-identifier">zonkWit</span></a></a><span> </span><a name="local-6989586621681789915"><a href="#local-6989586621681789915"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789915"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-871"></a><span>         </span><span class="hs-identifier">zonkWit</span><span> </span><a name="local-6989586621681789916"><a href="#local-6989586621681789916"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681789917"><a href="#local-6989586621681789917"><span class="hs-identifier">fln</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681789916"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789917"><span class="hs-identifier hs-var">fln</span></a><span>
</span><a name="line-872"></a><span>
</span><a name="line-873"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789922"><a href="#local-6989586621681789922"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681789923"><a href="#local-6989586621681789923"><span class="hs-identifier">expr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecordCon</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rcon_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789924"><a href="#local-6989586621681789924"><span class="hs-identifier">ext</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rcon_flds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789925"><a href="#local-6989586621681789925"><span class="hs-identifier">rbinds</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-874"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789926"><a href="#local-6989586621681789926"><span class="hs-identifier">new_con_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681789922"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">rcon_con_expr</span><span> </span><a href="#local-6989586621681789924"><span class="hs-identifier hs-var">ext</span></a><span class="hs-special">)</span><span>
</span><a name="line-875"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789927"><a href="#local-6989586621681789927"><span class="hs-identifier">new_rbinds</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkRecFields"><span class="hs-identifier hs-var">zonkRecFields</span></a><span> </span><a href="#local-6989586621681789922"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789925"><span class="hs-identifier hs-var">rbinds</span></a><span>
</span><a name="line-876"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789923"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rcon_ext</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789924"><span class="hs-identifier hs-var">ext</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rcon_con_expr</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789926"><span class="hs-identifier hs-var">new_con_expr</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-877"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rcon_flds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789927"><span class="hs-identifier hs-var">new_rbinds</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-878"></a><span>
</span><a name="line-879"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789928"><a href="#local-6989586621681789928"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecordUpd</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rupd_flds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789929"><a href="#local-6989586621681789929"><span class="hs-identifier">rbinds</span></a></a><span>
</span><a name="line-880"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rupd_expr</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789930"><a href="#local-6989586621681789930"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-881"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rupd_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RecordUpdTc</span><span>
</span><a name="line-882"></a><span>                            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rupd_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789931"><a href="#local-6989586621681789931"><span class="hs-identifier">cons</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rupd_in_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789932"><a href="#local-6989586621681789932"><span class="hs-identifier">in_tys</span></a></a><span>
</span><a name="line-883"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rupd_out_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789933"><a href="#local-6989586621681789933"><span class="hs-identifier">out_tys</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rupd_wrap</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789934"><a href="#local-6989586621681789934"><span class="hs-identifier">req_wrap</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-884"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789935"><a href="#local-6989586621681789935"><span class="hs-identifier">new_expr</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789928"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789930"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-885"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789936"><a href="#local-6989586621681789936"><span class="hs-identifier">new_in_tys</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789928"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789932"><span class="hs-identifier hs-var">in_tys</span></a><span>
</span><a name="line-886"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789937"><a href="#local-6989586621681789937"><span class="hs-identifier">new_out_tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681789928"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789933"><span class="hs-identifier hs-var">out_tys</span></a><span>
</span><a name="line-887"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789938"><a href="#local-6989586621681789938"><span class="hs-identifier">new_rbinds</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkRecUpdFields"><span class="hs-identifier hs-var">zonkRecUpdFields</span></a><span> </span><a href="#local-6989586621681789928"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789929"><span class="hs-identifier hs-var">rbinds</span></a><span>
</span><a name="line-888"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681789939"><a href="#local-6989586621681789939"><span class="hs-identifier">new_recwrap</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681789928"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789934"><span class="hs-identifier hs-var">req_wrap</span></a><span>
</span><a name="line-889"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecordUpd</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rupd_expr</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789935"><span class="hs-identifier hs-var">new_expr</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rupd_flds</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621681789938"><span class="hs-identifier hs-var">new_rbinds</span></a><span>
</span><a name="line-890"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rupd_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RecordUpdTc</span><span>
</span><a name="line-891"></a><span>                                </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rupd_cons</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789931"><span class="hs-identifier hs-var">cons</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">rupd_in_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789936"><span class="hs-identifier hs-var">new_in_tys</span></a><span>
</span><a name="line-892"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rupd_out_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789937"><span class="hs-identifier hs-var">new_out_tys</span></a><span>
</span><a name="line-893"></a><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rupd_wrap</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789939"><span class="hs-identifier hs-var">new_recwrap</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-894"></a><span>
</span><a name="line-895"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789940"><a href="#local-6989586621681789940"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExprWithTySig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789941"><a href="#local-6989586621681789941"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621681789942"><a href="#local-6989586621681789942"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-896"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681789943"><a href="#local-6989586621681789943"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789940"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789941"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-897"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExprWithTySig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621681789943"><span class="hs-identifier hs-var">e'</span></a><span> </span><a href="#local-6989586621681789942"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-898"></a><span>
</span><a name="line-899"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789944"><a href="#local-6989586621681789944"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ArithSeq</span><span> </span><a name="local-6989586621681789945"><a href="#local-6989586621681789945"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621681789946"><a href="#local-6989586621681789946"><span class="hs-identifier">wit</span></a></a><span> </span><a name="local-6989586621681789947"><a href="#local-6989586621681789947"><span class="hs-identifier">info</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-900"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789952"><a href="#local-6989586621681789952"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789953"><a href="#local-6989586621681789953"><span class="hs-identifier">new_wit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681789948"><span class="hs-identifier hs-var">zonkWit</span></a><span> </span><a href="#local-6989586621681789944"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789946"><span class="hs-identifier hs-var">wit</span></a><span>
</span><a name="line-901"></a><span>       </span><a name="local-6989586621681789954"><a href="#local-6989586621681789954"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681789944"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789945"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-902"></a><span>       </span><a name="local-6989586621681789955"><a href="#local-6989586621681789955"><span class="hs-identifier">new_info</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkArithSeq"><span class="hs-identifier hs-var">zonkArithSeq</span></a><span> </span><a href="#local-6989586621681789952"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789947"><span class="hs-identifier hs-var">info</span></a><span>
</span><a name="line-903"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ArithSeq</span><span> </span><a href="#local-6989586621681789954"><span class="hs-identifier hs-var">new_expr</span></a><span> </span><a href="#local-6989586621681789953"><span class="hs-identifier hs-var">new_wit</span></a><span> </span><a href="#local-6989586621681789955"><span class="hs-identifier hs-var">new_info</span></a><span class="hs-special">)</span><span>
</span><a name="line-904"></a><span>   </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621681789948"><a href="#local-6989586621681789948"><span class="hs-identifier">zonkWit</span></a></a><span> </span><a name="local-6989586621681789949"><a href="#local-6989586621681789949"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789949"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-905"></a><span>         </span><span class="hs-identifier">zonkWit</span><span> </span><a name="local-6989586621681789950"><a href="#local-6989586621681789950"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681789951"><a href="#local-6989586621681789951"><span class="hs-identifier">fln</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681789950"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789951"><span class="hs-identifier hs-var">fln</span></a><span>
</span><a name="line-906"></a><span>
</span><a name="line-907"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789956"><a href="#local-6989586621681789956"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSCC</span><span> </span><a name="local-6989586621681789957"><a href="#local-6989586621681789957"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789958"><a href="#local-6989586621681789958"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621681789959"><a href="#local-6989586621681789959"><span class="hs-identifier">lbl</span></a></a><span> </span><a name="local-6989586621681789960"><a href="#local-6989586621681789960"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-908"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789961"><a href="#local-6989586621681789961"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789956"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789960"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-909"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsSCC</span><span> </span><a href="#local-6989586621681789957"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789958"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621681789959"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621681789961"><span class="hs-identifier hs-var">new_expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-910"></a><span>
</span><a name="line-911"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789962"><a href="#local-6989586621681789962"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTickPragma</span><span> </span><a name="local-6989586621681789963"><a href="#local-6989586621681789963"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789964"><a href="#local-6989586621681789964"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621681789965"><a href="#local-6989586621681789965"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621681789966"><a href="#local-6989586621681789966"><span class="hs-identifier">srcInfo</span></a></a><span> </span><a name="local-6989586621681789967"><a href="#local-6989586621681789967"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-912"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789968"><a href="#local-6989586621681789968"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789962"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789967"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-913"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsTickPragma</span><span> </span><a href="#local-6989586621681789963"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789964"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621681789965"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621681789966"><span class="hs-identifier hs-var">srcInfo</span></a><span> </span><a href="#local-6989586621681789968"><span class="hs-identifier hs-var">new_expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-914"></a><span>
</span><a name="line-915"></a><span class="hs-comment">-- hdaume: core annotations</span><span>
</span><a name="line-916"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789969"><a href="#local-6989586621681789969"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCoreAnn</span><span> </span><a name="local-6989586621681789970"><a href="#local-6989586621681789970"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789971"><a href="#local-6989586621681789971"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621681789972"><a href="#local-6989586621681789972"><span class="hs-identifier">lbl</span></a></a><span> </span><a name="local-6989586621681789973"><a href="#local-6989586621681789973"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-917"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681789974"><a href="#local-6989586621681789974"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789969"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789973"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-918"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCoreAnn</span><span> </span><a href="#local-6989586621681789970"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789971"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621681789972"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621681789974"><span class="hs-identifier hs-var">new_expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-919"></a><span>
</span><a name="line-920"></a><span class="hs-comment">-- arrow notation extensions</span><span>
</span><a name="line-921"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789975"><a href="#local-6989586621681789975"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsProc</span><span> </span><a name="local-6989586621681789976"><a href="#local-6989586621681789976"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789977"><a href="#local-6989586621681789977"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621681789978"><a href="#local-6989586621681789978"><span class="hs-identifier">body</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-922"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789979"><a href="#local-6989586621681789979"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789980"><a href="#local-6989586621681789980"><span class="hs-identifier">new_pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681789975"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789977"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-923"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681789981"><a href="#local-6989586621681789981"><span class="hs-identifier">new_body</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCmdTop"><span class="hs-identifier hs-var">zonkCmdTop</span></a><span> </span><a href="#local-6989586621681789979"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789978"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-924"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsProc</span><span> </span><a href="#local-6989586621681789976"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789980"><span class="hs-identifier hs-var">new_pat</span></a><span> </span><a href="#local-6989586621681789981"><span class="hs-identifier hs-var">new_body</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-925"></a><span>
</span><a name="line-926"></a><span class="hs-comment">-- StaticPointers extension</span><span>
</span><a name="line-927"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789982"><a href="#local-6989586621681789982"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsStatic</span><span> </span><a name="local-6989586621681789983"><a href="#local-6989586621681789983"><span class="hs-identifier">fvs</span></a></a><span> </span><a name="local-6989586621681789984"><a href="#local-6989586621681789984"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-928"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">HsStatic</span><span> </span><a href="#local-6989586621681789983"><span class="hs-identifier hs-var">fvs</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681789982"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789984"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-929"></a><span>
</span><a name="line-930"></a><span class="hs-identifier">zonkExpr</span><span> </span><a name="local-6989586621681789985"><a href="#local-6989586621681789985"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWrap</span><span> </span><a name="local-6989586621681789986"><a href="#local-6989586621681789986"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681789987"><a href="#local-6989586621681789987"><span class="hs-identifier">co_fn</span></a></a><span> </span><a name="local-6989586621681789988"><a href="#local-6989586621681789988"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-931"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789989"><a href="#local-6989586621681789989"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789990"><a href="#local-6989586621681789990"><span class="hs-identifier">new_co_fn</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681789985"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789987"><span class="hs-identifier hs-var">co_fn</span></a><span>
</span><a name="line-932"></a><span>       </span><a name="local-6989586621681789991"><a href="#local-6989586621681789991"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681789989"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681789988"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-933"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsWrap</span><span> </span><a href="#local-6989586621681789986"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681789990"><span class="hs-identifier hs-var">new_co_fn</span></a><span> </span><a href="#local-6989586621681789991"><span class="hs-identifier hs-var">new_expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-934"></a><span>
</span><a name="line-935"></a><span class="hs-identifier">zonkExpr</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789992"><a href="#local-6989586621681789992"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsUnboundVar</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681789992"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-936"></a><span>
</span><a name="line-937"></a><span class="hs-identifier">zonkExpr</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681789993"><a href="#local-6989586621681789993"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;zonkExpr&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681789993"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-938"></a><span>
</span><a name="line-939"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-940"></a><span class="hs-comment">{-
Note [Skolems in zonkSyntaxExpr]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider rebindable syntax with something like

  (&gt;&gt;=) :: (forall x. blah) -&gt; (forall y. blah') -&gt; blah''

The x and y become skolems that are in scope when type-checking the
arguments to the bind. This means that we must extend the ZonkEnv with
these skolems when zonking the arguments to the bind. But the skolems
are different between the two arguments, and so we should theoretically
carry around different environments to use for the different arguments.

However, this becomes a logistical nightmare, especially in dealing with
the more exotic Stmt forms. So, we simplify by making the critical
assumption that the uniques of the skolems are different. (This assumption
is justified by the use of newUnique in TcMType.instSkolTyCoVarX.)
Now, we can safely just extend one environment.
-}</span><span>
</span><a name="line-959"></a><span>
</span><a name="line-960"></a><span class="hs-comment">-- See Note [Skolems in zonkSyntaxExpr]</span><span>
</span><a name="line-961"></a><span class="hs-identifier">zonkSyntaxExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SyntaxExpr</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span>
</span><a name="line-962"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SyntaxExpr</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-963"></a><a name="zonkSyntaxExpr"><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier">zonkSyntaxExpr</span></a></a><span> </span><a name="local-6989586621681789994"><a href="#local-6989586621681789994"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SyntaxExpr</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">syn_expr</span><span>      </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789995"><a href="#local-6989586621681789995"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-964"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">syn_arg_wraps</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789996"><a href="#local-6989586621681789996"><span class="hs-identifier">arg_wraps</span></a></a><span>
</span><a name="line-965"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">syn_res_wrap</span><span>  </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681789997"><a href="#local-6989586621681789997"><span class="hs-identifier">res_wrap</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-966"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681789998"><a href="#local-6989586621681789998"><span class="hs-identifier">env0</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681789999"><a href="#local-6989586621681789999"><span class="hs-identifier">res_wrap'</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681789994"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681789997"><span class="hs-identifier hs-var">res_wrap</span></a><span>
</span><a name="line-967"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790000"><a href="#local-6989586621681790000"><span class="hs-identifier">expr'</span></a></a><span>              </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681789998"><span class="hs-identifier hs-var">env0</span></a><span> </span><a href="#local-6989586621681789995"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-968"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790001"><a href="#local-6989586621681790001"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790002"><a href="#local-6989586621681790002"><span class="hs-identifier">arg_wraps'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapAccumLM</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681789998"><span class="hs-identifier hs-var">env0</span></a><span> </span><a href="#local-6989586621681789996"><span class="hs-identifier hs-var">arg_wraps</span></a><span>
</span><a name="line-969"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790001"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">SyntaxExpr</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">syn_expr</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790000"><span class="hs-identifier hs-var">expr'</span></a><span>
</span><a name="line-970"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">syn_arg_wraps</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790002"><span class="hs-identifier hs-var">arg_wraps'</span></a><span>
</span><a name="line-971"></a><span>                                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">syn_res_wrap</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681789999"><span class="hs-identifier hs-var">res_wrap'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-972"></a><span>
</span><a name="line-973"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-974"></a><span>
</span><a name="line-975"></a><span class="hs-identifier">zonkLCmd</span><span>  </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsCmd</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsCmd</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-976"></a><span class="hs-identifier">zonkCmd</span><span>   </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsCmd</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsCmd</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span>
</span><a name="line-978"></a><a name="zonkLCmd"><a href="TcHsSyn.html#zonkLCmd"><span class="hs-identifier">zonkLCmd</span></a></a><span>  </span><a name="local-6989586621681790003"><a href="#local-6989586621681790003"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790004"><a href="#local-6989586621681790004"><span class="hs-identifier">cmd</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkCmd"><span class="hs-identifier hs-var">zonkCmd</span></a><span> </span><a href="#local-6989586621681790003"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790004"><span class="hs-identifier hs-var">cmd</span></a><span>
</span><a name="line-979"></a><span>
</span><a name="line-980"></a><a name="zonkCmd"><a href="TcHsSyn.html#zonkCmd"><span class="hs-identifier">zonkCmd</span></a></a><span> </span><a name="local-6989586621681790005"><a href="#local-6989586621681790005"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdWrap</span><span> </span><a name="local-6989586621681790006"><a href="#local-6989586621681790006"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790007"><a href="#local-6989586621681790007"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621681790008"><a href="#local-6989586621681790008"><span class="hs-identifier">cmd</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-981"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790009"><a href="#local-6989586621681790009"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790010"><a href="#local-6989586621681790010"><span class="hs-identifier">w'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681790005"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790007"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-982"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790011"><a href="#local-6989586621681790011"><span class="hs-identifier">cmd'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCmd"><span class="hs-identifier hs-var">zonkCmd</span></a><span> </span><a href="#local-6989586621681790009"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790008"><span class="hs-identifier hs-var">cmd</span></a><span>
</span><a name="line-983"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdWrap</span><span> </span><a href="#local-6989586621681790006"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790010"><span class="hs-identifier hs-var">w'</span></a><span> </span><a href="#local-6989586621681790011"><span class="hs-identifier hs-var">cmd'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-984"></a><span class="hs-identifier">zonkCmd</span><span> </span><a name="local-6989586621681790012"><a href="#local-6989586621681790012"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdArrApp</span><span> </span><a name="local-6989586621681790013"><a href="#local-6989586621681790013"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681790014"><a href="#local-6989586621681790014"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621681790015"><a href="#local-6989586621681790015"><span class="hs-identifier">e2</span></a></a><span> </span><a name="local-6989586621681790016"><a href="#local-6989586621681790016"><span class="hs-identifier">ho</span></a></a><span> </span><a name="local-6989586621681790017"><a href="#local-6989586621681790017"><span class="hs-identifier">rl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-985"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790018"><a href="#local-6989586621681790018"><span class="hs-identifier">new_e1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790012"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790014"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-986"></a><span>       </span><a name="local-6989586621681790019"><a href="#local-6989586621681790019"><span class="hs-identifier">new_e2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790012"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790015"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-987"></a><span>       </span><a name="local-6989586621681790020"><a href="#local-6989586621681790020"><span class="hs-identifier">new_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790012"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790013"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-988"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdArrApp</span><span> </span><a href="#local-6989586621681790020"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><a href="#local-6989586621681790018"><span class="hs-identifier hs-var">new_e1</span></a><span> </span><a href="#local-6989586621681790019"><span class="hs-identifier hs-var">new_e2</span></a><span> </span><a href="#local-6989586621681790016"><span class="hs-identifier hs-var">ho</span></a><span> </span><a href="#local-6989586621681790017"><span class="hs-identifier hs-var">rl</span></a><span class="hs-special">)</span><span>
</span><a name="line-989"></a><span>
</span><a name="line-990"></a><span class="hs-identifier">zonkCmd</span><span> </span><a name="local-6989586621681790021"><a href="#local-6989586621681790021"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdArrForm</span><span> </span><a name="local-6989586621681790022"><a href="#local-6989586621681790022"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790023"><a href="#local-6989586621681790023"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621681790024"><a href="#local-6989586621681790024"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621681790025"><a href="#local-6989586621681790025"><span class="hs-identifier">fixity</span></a></a><span> </span><a name="local-6989586621681790026"><a href="#local-6989586621681790026"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-991"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790027"><a href="#local-6989586621681790027"><span class="hs-identifier">new_op</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790021"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790023"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-992"></a><span>       </span><a name="local-6989586621681790028"><a href="#local-6989586621681790028"><span class="hs-identifier">new_args</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkCmdTop"><span class="hs-identifier hs-var">zonkCmdTop</span></a><span> </span><a href="#local-6989586621681790021"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790026"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-993"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdArrForm</span><span> </span><a href="#local-6989586621681790022"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790027"><span class="hs-identifier hs-var">new_op</span></a><span> </span><a href="#local-6989586621681790024"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621681790025"><span class="hs-identifier hs-var">fixity</span></a><span> </span><a href="#local-6989586621681790028"><span class="hs-identifier hs-var">new_args</span></a><span class="hs-special">)</span><span>
</span><a name="line-994"></a><span>
</span><a name="line-995"></a><span class="hs-identifier">zonkCmd</span><span> </span><a name="local-6989586621681790029"><a href="#local-6989586621681790029"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdApp</span><span> </span><a name="local-6989586621681790030"><a href="#local-6989586621681790030"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790031"><a href="#local-6989586621681790031"><span class="hs-identifier">c</span></a></a><span> </span><a name="local-6989586621681790032"><a href="#local-6989586621681790032"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-996"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790033"><a href="#local-6989586621681790033"><span class="hs-identifier">new_c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLCmd"><span class="hs-identifier hs-var">zonkLCmd</span></a><span> </span><a href="#local-6989586621681790029"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790031"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-997"></a><span>       </span><a name="local-6989586621681790034"><a href="#local-6989586621681790034"><span class="hs-identifier">new_e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790029"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790032"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-998"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdApp</span><span> </span><a href="#local-6989586621681790030"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790033"><span class="hs-identifier hs-var">new_c</span></a><span> </span><a href="#local-6989586621681790034"><span class="hs-identifier hs-var">new_e</span></a><span class="hs-special">)</span><span>
</span><a name="line-999"></a><span>
</span><a name="line-1000"></a><span class="hs-identifier">zonkCmd</span><span> </span><a name="local-6989586621681790035"><a href="#local-6989586621681790035"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdLam</span><span> </span><a name="local-6989586621681790036"><a href="#local-6989586621681790036"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790037"><a href="#local-6989586621681790037"><span class="hs-identifier">matches</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1001"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790038"><a href="#local-6989586621681790038"><span class="hs-identifier">new_matches</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkMatchGroup"><span class="hs-identifier hs-var">zonkMatchGroup</span></a><span> </span><a href="#local-6989586621681790035"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLCmd"><span class="hs-identifier hs-var">zonkLCmd</span></a><span> </span><a href="#local-6989586621681790037"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-1002"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdLam</span><span> </span><a href="#local-6989586621681790036"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790038"><span class="hs-identifier hs-var">new_matches</span></a><span class="hs-special">)</span><span>
</span><a name="line-1003"></a><span>
</span><a name="line-1004"></a><span class="hs-identifier">zonkCmd</span><span> </span><a name="local-6989586621681790039"><a href="#local-6989586621681790039"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdPar</span><span> </span><a name="local-6989586621681790040"><a href="#local-6989586621681790040"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790041"><a href="#local-6989586621681790041"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1005"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790042"><a href="#local-6989586621681790042"><span class="hs-identifier">new_c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLCmd"><span class="hs-identifier hs-var">zonkLCmd</span></a><span> </span><a href="#local-6989586621681790039"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790041"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1006"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdPar</span><span> </span><a href="#local-6989586621681790040"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790042"><span class="hs-identifier hs-var">new_c</span></a><span class="hs-special">)</span><span>
</span><a name="line-1007"></a><span>
</span><a name="line-1008"></a><span class="hs-identifier">zonkCmd</span><span> </span><a name="local-6989586621681790043"><a href="#local-6989586621681790043"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdCase</span><span> </span><a name="local-6989586621681790044"><a href="#local-6989586621681790044"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790045"><a href="#local-6989586621681790045"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621681790046"><a href="#local-6989586621681790046"><span class="hs-identifier">ms</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1009"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790047"><a href="#local-6989586621681790047"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790043"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790045"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1010"></a><span>       </span><a name="local-6989586621681790048"><a href="#local-6989586621681790048"><span class="hs-identifier">new_ms</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkMatchGroup"><span class="hs-identifier hs-var">zonkMatchGroup</span></a><span> </span><a href="#local-6989586621681790043"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLCmd"><span class="hs-identifier hs-var">zonkLCmd</span></a><span> </span><a href="#local-6989586621681790046"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-1011"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdCase</span><span> </span><a href="#local-6989586621681790044"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790047"><span class="hs-identifier hs-var">new_expr</span></a><span> </span><a href="#local-6989586621681790048"><span class="hs-identifier hs-var">new_ms</span></a><span class="hs-special">)</span><span>
</span><a name="line-1012"></a><span>
</span><a name="line-1013"></a><span class="hs-identifier">zonkCmd</span><span> </span><a name="local-6989586621681790049"><a href="#local-6989586621681790049"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdIf</span><span> </span><a name="local-6989586621681790050"><a href="#local-6989586621681790050"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790051"><a href="#local-6989586621681790051"><span class="hs-identifier">eCond</span></a></a><span> </span><a name="local-6989586621681790052"><a href="#local-6989586621681790052"><span class="hs-identifier">ePred</span></a></a><span> </span><a name="local-6989586621681790053"><a href="#local-6989586621681790053"><span class="hs-identifier">cThen</span></a></a><span> </span><a name="local-6989586621681790054"><a href="#local-6989586621681790054"><span class="hs-identifier">cElse</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1014"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790059"><a href="#local-6989586621681790059"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790060"><a href="#local-6989586621681790060"><span class="hs-identifier">new_eCond</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790055"><span class="hs-identifier hs-var">zonkWit</span></a><span> </span><a href="#local-6989586621681790049"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790051"><span class="hs-identifier hs-var">eCond</span></a><span>
</span><a name="line-1015"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790061"><a href="#local-6989586621681790061"><span class="hs-identifier">new_ePred</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790059"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790052"><span class="hs-identifier hs-var">ePred</span></a><span>
</span><a name="line-1016"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790062"><a href="#local-6989586621681790062"><span class="hs-identifier">new_cThen</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLCmd"><span class="hs-identifier hs-var">zonkLCmd</span></a><span> </span><a href="#local-6989586621681790059"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790053"><span class="hs-identifier hs-var">cThen</span></a><span>
</span><a name="line-1017"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790063"><a href="#local-6989586621681790063"><span class="hs-identifier">new_cElse</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLCmd"><span class="hs-identifier hs-var">zonkLCmd</span></a><span> </span><a href="#local-6989586621681790059"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790054"><span class="hs-identifier hs-var">cElse</span></a><span>
</span><a name="line-1018"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdIf</span><span> </span><a href="#local-6989586621681790050"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790060"><span class="hs-identifier hs-var">new_eCond</span></a><span> </span><a href="#local-6989586621681790061"><span class="hs-identifier hs-var">new_ePred</span></a><span> </span><a href="#local-6989586621681790062"><span class="hs-identifier hs-var">new_cThen</span></a><span> </span><a href="#local-6989586621681790063"><span class="hs-identifier hs-var">new_cElse</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1019"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1020"></a><span>    </span><a name="local-6989586621681790055"><a href="#local-6989586621681790055"><span class="hs-identifier">zonkWit</span></a></a><span> </span><a name="local-6989586621681790056"><a href="#local-6989586621681790056"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790056"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-1021"></a><span>    </span><span class="hs-identifier">zonkWit</span><span> </span><a name="local-6989586621681790057"><a href="#local-6989586621681790057"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681790058"><a href="#local-6989586621681790058"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790057"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790058"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-1022"></a><span>
</span><a name="line-1023"></a><span class="hs-identifier">zonkCmd</span><span> </span><a name="local-6989586621681790064"><a href="#local-6989586621681790064"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdLet</span><span> </span><a name="local-6989586621681790065"><a href="#local-6989586621681790065"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790066"><a href="#local-6989586621681790066"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681790067"><a href="#local-6989586621681790067"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681790068"><a href="#local-6989586621681790068"><span class="hs-identifier">cmd</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1024"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790069"><a href="#local-6989586621681790069"><span class="hs-identifier">new_env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790070"><a href="#local-6989586621681790070"><span class="hs-identifier">new_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLocalBinds"><span class="hs-identifier hs-var">zonkLocalBinds</span></a><span> </span><a href="#local-6989586621681790064"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790067"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-1025"></a><span>       </span><a name="local-6989586621681790071"><a href="#local-6989586621681790071"><span class="hs-identifier">new_cmd</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLCmd"><span class="hs-identifier hs-var">zonkLCmd</span></a><span> </span><a href="#local-6989586621681790069"><span class="hs-identifier hs-var">new_env</span></a><span> </span><a href="#local-6989586621681790068"><span class="hs-identifier hs-var">cmd</span></a><span>
</span><a name="line-1026"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdLet</span><span> </span><a href="#local-6989586621681790065"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790066"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681790070"><span class="hs-identifier hs-var">new_binds</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790071"><span class="hs-identifier hs-var">new_cmd</span></a><span class="hs-special">)</span><span>
</span><a name="line-1027"></a><span>
</span><a name="line-1028"></a><span class="hs-identifier">zonkCmd</span><span> </span><a name="local-6989586621681790072"><a href="#local-6989586621681790072"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdDo</span><span> </span><a name="local-6989586621681790073"><a href="#local-6989586621681790073"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790074"><a href="#local-6989586621681790074"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681790075"><a href="#local-6989586621681790075"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1029"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681790076"><a href="#local-6989586621681790076"><span class="hs-identifier">new_stmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkStmts"><span class="hs-identifier hs-var">zonkStmts</span></a><span> </span><a href="#local-6989586621681790072"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLCmd"><span class="hs-identifier hs-var">zonkLCmd</span></a><span> </span><a href="#local-6989586621681790075"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-1030"></a><span>       </span><a name="local-6989586621681790077"><a href="#local-6989586621681790077"><span class="hs-identifier">new_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790072"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790073"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1031"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdDo</span><span> </span><a href="#local-6989586621681790077"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790074"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681790076"><span class="hs-identifier hs-var">new_stmts</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1032"></a><span>
</span><a name="line-1033"></a><span class="hs-identifier">zonkCmd</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XCmd</span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkCmd&quot;</span><span>
</span><a name="line-1034"></a><span>
</span><a name="line-1035"></a><span>
</span><a name="line-1036"></a><span>
</span><a name="line-1037"></a><span class="hs-identifier">zonkCmdTop</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsCmdTop</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsCmdTop</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-1038"></a><a name="zonkCmdTop"><a href="TcHsSyn.html#zonkCmdTop"><span class="hs-identifier">zonkCmdTop</span></a></a><span> </span><a name="local-6989586621681790078"><a href="#local-6989586621681790078"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790079"><a href="#local-6989586621681790079"><span class="hs-identifier">cmd</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonk_cmd_top"><span class="hs-identifier hs-var">zonk_cmd_top</span></a><span> </span><a href="#local-6989586621681790078"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790079"><span class="hs-identifier hs-var">cmd</span></a><span>
</span><a name="line-1039"></a><span>
</span><a name="line-1040"></a><span class="hs-identifier">zonk_cmd_top</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsCmdTop</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsCmdTop</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-1041"></a><a name="zonk_cmd_top"><a href="TcHsSyn.html#zonk_cmd_top"><span class="hs-identifier">zonk_cmd_top</span></a></a><span> </span><a name="local-6989586621681790080"><a href="#local-6989586621681790080"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdTop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CmdTopTc</span><span> </span><a name="local-6989586621681790081"><a href="#local-6989586621681790081"><span class="hs-identifier">stack_tys</span></a></a><span> </span><a name="local-6989586621681790082"><a href="#local-6989586621681790082"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681790083"><a href="#local-6989586621681790083"><span class="hs-identifier">ids</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681790084"><a href="#local-6989586621681790084"><span class="hs-identifier">cmd</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1042"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790085"><a href="#local-6989586621681790085"><span class="hs-identifier">new_cmd</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLCmd"><span class="hs-identifier hs-var">zonkLCmd</span></a><span> </span><a href="#local-6989586621681790080"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790084"><span class="hs-identifier hs-var">cmd</span></a><span>
</span><a name="line-1043"></a><span>       </span><a name="local-6989586621681790086"><a href="#local-6989586621681790086"><span class="hs-identifier">new_stack_tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790080"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790081"><span class="hs-identifier hs-var">stack_tys</span></a><span>
</span><a name="line-1044"></a><span>       </span><a name="local-6989586621681790087"><a href="#local-6989586621681790087"><span class="hs-identifier">new_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790080"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790082"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1045"></a><span>       </span><a name="local-6989586621681790088"><a href="#local-6989586621681790088"><span class="hs-identifier">new_ids</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapSndM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681790080"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790083"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-1046"></a><span>
</span><a name="line-1047"></a><span>       </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isLiftedTypeKind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tcTypeKind</span><span> </span><span class="hs-identifier">new_stack_tys</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1048"></a><span>         </span><span class="hs-comment">-- desugarer assumes that this is not levity polymorphic...</span><span>
</span><a name="line-1049"></a><span>         </span><span class="hs-comment">-- but indeed it should always be lifted due to the typing</span><span>
</span><a name="line-1050"></a><span>         </span><span class="hs-comment">-- rules for arrows</span><span>
</span><a name="line-1051"></a><span>
</span><a name="line-1052"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsCmdTop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CmdTopTc</span><span> </span><a href="#local-6989586621681790086"><span class="hs-identifier hs-var">new_stack_tys</span></a><span> </span><a href="#local-6989586621681790087"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><a href="#local-6989586621681790088"><span class="hs-identifier hs-var">new_ids</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790085"><span class="hs-identifier hs-var">new_cmd</span></a><span class="hs-special">)</span><span>
</span><a name="line-1053"></a><span class="hs-identifier">zonk_cmd_top</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XCmdTop</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonk_cmd_top&quot;</span><span>
</span><a name="line-1054"></a><span>
</span><a name="line-1055"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-1056"></a><span class="hs-identifier">zonkCoFn</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsWrapper</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">HsWrapper</span><span class="hs-special">)</span><span>
</span><a name="line-1057"></a><a name="zonkCoFn"><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier">zonkCoFn</span></a></a><span> </span><a name="local-6989586621681790089"><a href="#local-6989586621681790089"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier hs-var">WpHole</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790089"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">WpHole</span><span class="hs-special">)</span><span>
</span><a name="line-1058"></a><span class="hs-identifier">zonkCoFn</span><span> </span><a name="local-6989586621681790090"><a href="#local-6989586621681790090"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WpCompose</span><span> </span><a name="local-6989586621681790091"><a href="#local-6989586621681790091"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681790092"><a href="#local-6989586621681790092"><span class="hs-identifier">c2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790093"><a href="#local-6989586621681790093"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790094"><a href="#local-6989586621681790094"><span class="hs-identifier">c1'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681790090"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790091"><span class="hs-identifier hs-var">c1</span></a><span>
</span><a name="line-1059"></a><span>                                    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790095"><a href="#local-6989586621681790095"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790096"><a href="#local-6989586621681790096"><span class="hs-identifier">c2'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681790093"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790092"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-1060"></a><span>                                    </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790095"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">WpCompose</span><span> </span><a href="#local-6989586621681790094"><span class="hs-identifier hs-var">c1'</span></a><span> </span><a href="#local-6989586621681790096"><span class="hs-identifier hs-var">c2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1061"></a><span class="hs-identifier">zonkCoFn</span><span> </span><a name="local-6989586621681790097"><a href="#local-6989586621681790097"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WpFun</span><span> </span><a name="local-6989586621681790098"><a href="#local-6989586621681790098"><span class="hs-identifier">c1</span></a></a><span> </span><a name="local-6989586621681790099"><a href="#local-6989586621681790099"><span class="hs-identifier">c2</span></a></a><span> </span><a name="local-6989586621681790100"><a href="#local-6989586621681790100"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681790101"><a href="#local-6989586621681790101"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790102"><a href="#local-6989586621681790102"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790103"><a href="#local-6989586621681790103"><span class="hs-identifier">c1'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681790097"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790098"><span class="hs-identifier hs-var">c1</span></a><span>
</span><a name="line-1062"></a><span>                                     </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790104"><a href="#local-6989586621681790104"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790105"><a href="#local-6989586621681790105"><span class="hs-identifier">c2'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681790102"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790099"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-1063"></a><span>                                     </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790106"><a href="#local-6989586621681790106"><span class="hs-identifier">t1'</span></a></a><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790104"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790100"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1064"></a><span>                                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790104"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">WpFun</span><span> </span><a href="#local-6989586621681790103"><span class="hs-identifier hs-var">c1'</span></a><span> </span><a href="#local-6989586621681790105"><span class="hs-identifier hs-var">c2'</span></a><span> </span><a href="#local-6989586621681790106"><span class="hs-identifier hs-var">t1'</span></a><span> </span><a href="#local-6989586621681790101"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1065"></a><span class="hs-identifier">zonkCoFn</span><span> </span><a name="local-6989586621681790107"><a href="#local-6989586621681790107"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WpCast</span><span> </span><a name="local-6989586621681790108"><a href="#local-6989586621681790108"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790109"><a href="#local-6989586621681790109"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoToCo"><span class="hs-identifier hs-var">zonkCoToCo</span></a><span> </span><a href="#local-6989586621681790107"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790108"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1066"></a><span>                              </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790107"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">WpCast</span><span> </span><a href="#local-6989586621681790109"><span class="hs-identifier hs-var">co'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1067"></a><span class="hs-identifier">zonkCoFn</span><span> </span><a name="local-6989586621681790110"><a href="#local-6989586621681790110"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WpEvLam</span><span> </span><a name="local-6989586621681790111"><a href="#local-6989586621681790111"><span class="hs-identifier">ev</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790112"><a href="#local-6989586621681790112"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790113"><a href="#local-6989586621681790113"><span class="hs-identifier">ev'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvBndrX"><span class="hs-identifier hs-var">zonkEvBndrX</span></a><span> </span><a href="#local-6989586621681790110"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790111"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1068"></a><span>                                 </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790112"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">WpEvLam</span><span> </span><a href="#local-6989586621681790113"><span class="hs-identifier hs-var">ev'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1069"></a><span class="hs-identifier">zonkCoFn</span><span> </span><a name="local-6989586621681790114"><a href="#local-6989586621681790114"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WpEvApp</span><span> </span><a name="local-6989586621681790115"><a href="#local-6989586621681790115"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790116"><a href="#local-6989586621681790116"><span class="hs-identifier">arg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvTerm"><span class="hs-identifier hs-var">zonkEvTerm</span></a><span> </span><a href="#local-6989586621681790114"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790115"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1070"></a><span>                                 </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790114"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">WpEvApp</span><span> </span><a href="#local-6989586621681790116"><span class="hs-identifier hs-var">arg'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1071"></a><span class="hs-identifier">zonkCoFn</span><span> </span><a name="local-6989586621681790117"><a href="#local-6989586621681790117"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WpTyLam</span><span> </span><a name="local-6989586621681790118"><a href="#local-6989586621681790118"><span class="hs-identifier">tv</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isImmutableTyVar</span><span> </span><span class="hs-identifier hs-var">tv</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1072"></a><span>                              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790119"><a href="#local-6989586621681790119"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790120"><a href="#local-6989586621681790120"><span class="hs-identifier">tv'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTyBndrX"><span class="hs-identifier hs-var">zonkTyBndrX</span></a><span> </span><a href="#local-6989586621681790117"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790118"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1073"></a><span>                                 </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790119"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">WpTyLam</span><span> </span><a href="#local-6989586621681790120"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1074"></a><span class="hs-identifier">zonkCoFn</span><span> </span><a name="local-6989586621681790121"><a href="#local-6989586621681790121"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WpTyApp</span><span> </span><a name="local-6989586621681790122"><a href="#local-6989586621681790122"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790123"><a href="#local-6989586621681790123"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790121"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790122"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1075"></a><span>                                 </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790121"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">WpTyApp</span><span> </span><a href="#local-6989586621681790123"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1076"></a><span class="hs-identifier">zonkCoFn</span><span> </span><a name="local-6989586621681790124"><a href="#local-6989586621681790124"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WpLet</span><span> </span><a name="local-6989586621681790125"><a href="#local-6989586621681790125"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790126"><a href="#local-6989586621681790126"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790127"><a href="#local-6989586621681790127"><span class="hs-identifier">bs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcEvBinds"><span class="hs-identifier hs-var">zonkTcEvBinds</span></a><span> </span><a href="#local-6989586621681790124"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790125"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-1077"></a><span>                                 </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790126"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">WpLet</span><span> </span><a href="#local-6989586621681790127"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1078"></a><span>
</span><a name="line-1079"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-1080"></a><span class="hs-identifier">zonkOverLit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsOverLit</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsOverLit</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-1081"></a><a name="zonkOverLit"><a href="TcHsSyn.html#zonkOverLit"><span class="hs-identifier">zonkOverLit</span></a></a><span> </span><a name="local-6989586621681790128"><a href="#local-6989586621681790128"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790129"><a href="#local-6989586621681790129"><span class="hs-identifier">lit</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">OverLit</span><span> </span><span class="hs-special">{</span><span class="hs-identifier">ol_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">OverLitTc</span><span> </span><a name="local-6989586621681790130"><a href="#local-6989586621681790130"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621681790131"><a href="#local-6989586621681790131"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_witness</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790132"><a href="#local-6989586621681790132"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1082"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790133"><a href="#local-6989586621681790133"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790128"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790131"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1083"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790134"><a href="#local-6989586621681790134"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681790128"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790132"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1084"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790129"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ol_witness</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790134"><span class="hs-identifier hs-var">e'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ol_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">OverLitTc</span><span> </span><a href="#local-6989586621681790130"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681790133"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1085"></a><span>
</span><a name="line-1086"></a><span class="hs-identifier">zonkOverLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">XOverLit</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkOverLit&quot;</span><span>
</span><a name="line-1087"></a><span>
</span><a name="line-1088"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-1089"></a><span class="hs-identifier">zonkArithSeq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ArithSeqInfo</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ArithSeqInfo</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-1090"></a><span>
</span><a name="line-1091"></a><a name="zonkArithSeq"><a href="TcHsSyn.html#zonkArithSeq"><span class="hs-identifier">zonkArithSeq</span></a></a><span> </span><a name="local-6989586621681790135"><a href="#local-6989586621681790135"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">From</span><span> </span><a name="local-6989586621681790136"><a href="#local-6989586621681790136"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1092"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790137"><a href="#local-6989586621681790137"><span class="hs-identifier">new_e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790135"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790136"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1093"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">From</span><span> </span><a href="#local-6989586621681790137"><span class="hs-identifier hs-var">new_e</span></a><span class="hs-special">)</span><span>
</span><a name="line-1094"></a><span>
</span><a name="line-1095"></a><span class="hs-identifier">zonkArithSeq</span><span> </span><a name="local-6989586621681790138"><a href="#local-6989586621681790138"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromThen</span><span> </span><a name="local-6989586621681790139"><a href="#local-6989586621681790139"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621681790140"><a href="#local-6989586621681790140"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1096"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790141"><a href="#local-6989586621681790141"><span class="hs-identifier">new_e1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790138"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790139"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-1097"></a><span>       </span><a name="local-6989586621681790142"><a href="#local-6989586621681790142"><span class="hs-identifier">new_e2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790138"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790140"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1098"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromThen</span><span> </span><a href="#local-6989586621681790141"><span class="hs-identifier hs-var">new_e1</span></a><span> </span><a href="#local-6989586621681790142"><span class="hs-identifier hs-var">new_e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1099"></a><span>
</span><a name="line-1100"></a><span class="hs-identifier">zonkArithSeq</span><span> </span><a name="local-6989586621681790143"><a href="#local-6989586621681790143"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromTo</span><span> </span><a name="local-6989586621681790144"><a href="#local-6989586621681790144"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621681790145"><a href="#local-6989586621681790145"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1101"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790146"><a href="#local-6989586621681790146"><span class="hs-identifier">new_e1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790143"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790144"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-1102"></a><span>       </span><a name="local-6989586621681790147"><a href="#local-6989586621681790147"><span class="hs-identifier">new_e2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790143"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790145"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1103"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromTo</span><span> </span><a href="#local-6989586621681790146"><span class="hs-identifier hs-var">new_e1</span></a><span> </span><a href="#local-6989586621681790147"><span class="hs-identifier hs-var">new_e2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1104"></a><span>
</span><a name="line-1105"></a><span class="hs-identifier">zonkArithSeq</span><span> </span><a name="local-6989586621681790148"><a href="#local-6989586621681790148"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromThenTo</span><span> </span><a name="local-6989586621681790149"><a href="#local-6989586621681790149"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621681790150"><a href="#local-6989586621681790150"><span class="hs-identifier">e2</span></a></a><span> </span><a name="local-6989586621681790151"><a href="#local-6989586621681790151"><span class="hs-identifier">e3</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1106"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790152"><a href="#local-6989586621681790152"><span class="hs-identifier">new_e1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790148"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790149"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-1107"></a><span>       </span><a name="local-6989586621681790153"><a href="#local-6989586621681790153"><span class="hs-identifier">new_e2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790148"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790150"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1108"></a><span>       </span><a name="local-6989586621681790154"><a href="#local-6989586621681790154"><span class="hs-identifier">new_e3</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790148"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790151"><span class="hs-identifier hs-var">e3</span></a><span>
</span><a name="line-1109"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FromThenTo</span><span> </span><a href="#local-6989586621681790152"><span class="hs-identifier hs-var">new_e1</span></a><span> </span><a href="#local-6989586621681790153"><span class="hs-identifier hs-var">new_e2</span></a><span> </span><a href="#local-6989586621681790154"><span class="hs-identifier hs-var">new_e3</span></a><span class="hs-special">)</span><span>
</span><a name="line-1110"></a><span>
</span><a name="line-1111"></a><span>
</span><a name="line-1112"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-1113"></a><span class="hs-identifier">zonkStmts</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-1114"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789447"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789447"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1115"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LStmt</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789447"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1116"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LStmt</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789447"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1117"></a><a name="zonkStmts"><a href="TcHsSyn.html#zonkStmts"><span class="hs-identifier">zonkStmts</span></a></a><span> </span><a name="local-6989586621681790155"><a href="#local-6989586621681790155"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790155"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1118"></a><span class="hs-identifier">zonkStmts</span><span> </span><a name="local-6989586621681790156"><a href="#local-6989586621681790156"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790157"><a href="#local-6989586621681790157"><span class="hs-identifier">zBody</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681790158"><a href="#local-6989586621681790158"><span class="hs-identifier">s</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681790159"><a href="#local-6989586621681790159"><span class="hs-identifier">ss</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790160"><a href="#local-6989586621681790160"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790161"><a href="#local-6989586621681790161"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#wrapLocSndM"><span class="hs-identifier hs-var">wrapLocSndM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkStmt"><span class="hs-identifier hs-var">zonkStmt</span></a><span> </span><a href="#local-6989586621681790156"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790157"><span class="hs-identifier hs-var">zBody</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790158"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-1119"></a><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790162"><a href="#local-6989586621681790162"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790163"><a href="#local-6989586621681790163"><span class="hs-identifier">ss'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkStmts"><span class="hs-identifier hs-var">zonkStmts</span></a><span> </span><a href="#local-6989586621681790160"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790157"><span class="hs-identifier hs-var">zBody</span></a><span> </span><a href="#local-6989586621681790159"><span class="hs-identifier hs-var">ss</span></a><span>
</span><a name="line-1120"></a><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790162"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790161"><span class="hs-identifier hs-var">s'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681790163"><span class="hs-identifier hs-var">ss'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1121"></a><span>
</span><a name="line-1122"></a><span class="hs-identifier">zonkStmt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-1123"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789446"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789446"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1124"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Stmt</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789446"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1125"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Stmt</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789446"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1126"></a><a name="zonkStmt"><a href="TcHsSyn.html#zonkStmt"><span class="hs-identifier">zonkStmt</span></a></a><span> </span><a name="local-6989586621681790164"><a href="#local-6989586621681790164"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParStmt</span><span> </span><a name="local-6989586621681790165"><a href="#local-6989586621681790165"><span class="hs-identifier">bind_ty</span></a></a><span> </span><a name="local-6989586621681790166"><a href="#local-6989586621681790166"><span class="hs-identifier">stmts_w_bndrs</span></a></a><span> </span><a name="local-6989586621681790167"><a href="#local-6989586621681790167"><span class="hs-identifier">mzip_op</span></a></a><span> </span><a name="local-6989586621681790168"><a href="#local-6989586621681790168"><span class="hs-identifier">bind_op</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1127"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790179"><a href="#local-6989586621681790179"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790180"><a href="#local-6989586621681790180"><span class="hs-identifier">new_bind_op</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790164"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790168"><span class="hs-identifier hs-var">bind_op</span></a><span>
</span><a name="line-1128"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790181"><a href="#local-6989586621681790181"><span class="hs-identifier">new_bind_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790179"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790165"><span class="hs-identifier hs-var">bind_ty</span></a><span>
</span><a name="line-1129"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790182"><a href="#local-6989586621681790182"><span class="hs-identifier">new_stmts_w_bndrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790169"><span class="hs-identifier hs-var">zonk_branch</span></a><span> </span><a href="#local-6989586621681790179"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790166"><span class="hs-identifier hs-var">stmts_w_bndrs</span></a><span>
</span><a name="line-1130"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790183"><a href="#local-6989586621681790183"><span class="hs-identifier">new_binders</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621681790186"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">ParStmtBlock</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681790185"><a href="#local-6989586621681790185"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790182"><span class="hs-identifier hs-var">new_stmts_w_bndrs</span></a><span>
</span><a name="line-1131"></a><span>                              </span><span class="hs-special">,</span><span> </span><a name="local-6989586621681790186"><a href="#local-6989586621681790186"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790185"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">]</span><span>
</span><a name="line-1132"></a><span>             </span><a name="local-6989586621681790184"><a href="#local-6989586621681790184"><span class="hs-identifier">env2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier hs-var">extendIdZonkEnvRec</span></a><span> </span><a href="#local-6989586621681790179"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790183"><span class="hs-identifier hs-var">new_binders</span></a><span>
</span><a name="line-1133"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790187"><a href="#local-6989586621681790187"><span class="hs-identifier">new_mzip</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681790184"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790167"><span class="hs-identifier hs-var">mzip_op</span></a><span>
</span><a name="line-1134"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790184"><span class="hs-identifier hs-var">env2</span></a><span>
</span><a name="line-1135"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ParStmt</span><span> </span><a href="#local-6989586621681790181"><span class="hs-identifier hs-var">new_bind_ty</span></a><span> </span><a href="#local-6989586621681790182"><span class="hs-identifier hs-var">new_stmts_w_bndrs</span></a><span> </span><a href="#local-6989586621681790187"><span class="hs-identifier hs-var">new_mzip</span></a><span> </span><a href="#local-6989586621681790180"><span class="hs-identifier hs-var">new_bind_op</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-1136"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1137"></a><span>    </span><a name="local-6989586621681790169"><a href="#local-6989586621681790169"><span class="hs-identifier">zonk_branch</span></a></a><span> </span><a name="local-6989586621681790170"><a href="#local-6989586621681790170"><span class="hs-identifier">env1</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParStmtBlock</span><span> </span><a name="local-6989586621681790171"><a href="#local-6989586621681790171"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790172"><a href="#local-6989586621681790172"><span class="hs-identifier">stmts</span></a></a><span> </span><a name="local-6989586621681790173"><a href="#local-6989586621681790173"><span class="hs-identifier">bndrs</span></a></a><span> </span><a name="local-6989586621681790174"><a href="#local-6989586621681790174"><span class="hs-identifier">return_op</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1138"></a><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790175"><a href="#local-6989586621681790175"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790176"><a href="#local-6989586621681790176"><span class="hs-identifier">new_stmts</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkStmts"><span class="hs-identifier hs-var">zonkStmts</span></a><span> </span><a href="#local-6989586621681790170"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790172"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-1139"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790177"><a href="#local-6989586621681790177"><span class="hs-identifier">env3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790178"><a href="#local-6989586621681790178"><span class="hs-identifier">new_return</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790175"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790174"><span class="hs-identifier hs-var">return_op</span></a><span>
</span><a name="line-1140"></a><span>            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParStmtBlock</span><span> </span><a href="#local-6989586621681790171"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790176"><span class="hs-identifier hs-var">new_stmts</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkIdOccs"><span class="hs-identifier hs-var">zonkIdOccs</span></a><span> </span><a href="#local-6989586621681790177"><span class="hs-identifier hs-var">env3</span></a><span> </span><a href="#local-6989586621681790173"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1141"></a><span>                                                                   </span><a href="#local-6989586621681790178"><span class="hs-identifier hs-var">new_return</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1142"></a><span>    </span><span class="hs-identifier">zonk_branch</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XParStmtBlock</span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkStmt&quot;</span><span>
</span><a name="line-1143"></a><span>
</span><a name="line-1144"></a><span class="hs-identifier">zonkStmt</span><span> </span><a name="local-6989586621681790188"><a href="#local-6989586621681790188"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790189"><a href="#local-6989586621681790189"><span class="hs-identifier">zBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecStmt</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">recS_stmts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790190"><a href="#local-6989586621681790190"><span class="hs-identifier">segStmts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_later_ids</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790191"><a href="#local-6989586621681790191"><span class="hs-identifier">lvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_rec_ids</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790192"><a href="#local-6989586621681790192"><span class="hs-identifier">rvs</span></a></a><span>
</span><a name="line-1145"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_ret_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790193"><a href="#local-6989586621681790193"><span class="hs-identifier">ret_id</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_mfix_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790194"><a href="#local-6989586621681790194"><span class="hs-identifier">mfix_id</span></a></a><span>
</span><a name="line-1146"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_bind_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790195"><a href="#local-6989586621681790195"><span class="hs-identifier">bind_id</span></a></a><span>
</span><a name="line-1147"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_ext</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1148"></a><span>                                       </span><span class="hs-identifier hs-var">RecStmtTc</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">recS_bind_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790196"><a href="#local-6989586621681790196"><span class="hs-identifier">bind_ty</span></a></a><span>
</span><a name="line-1149"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_later_rets</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790197"><a href="#local-6989586621681790197"><span class="hs-identifier">later_rets</span></a></a><span>
</span><a name="line-1150"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_rec_rets</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790198"><a href="#local-6989586621681790198"><span class="hs-identifier">rec_rets</span></a></a><span>
</span><a name="line-1151"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_ret_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790199"><a href="#local-6989586621681790199"><span class="hs-identifier">ret_ty</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1152"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790200"><a href="#local-6989586621681790200"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790201"><a href="#local-6989586621681790201"><span class="hs-identifier">new_bind_id</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790188"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790195"><span class="hs-identifier hs-var">bind_id</span></a><span>
</span><a name="line-1153"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790202"><a href="#local-6989586621681790202"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790203"><a href="#local-6989586621681790203"><span class="hs-identifier">new_mfix_id</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790200"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790194"><span class="hs-identifier hs-var">mfix_id</span></a><span>
</span><a name="line-1154"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790204"><a href="#local-6989586621681790204"><span class="hs-identifier">env3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790205"><a href="#local-6989586621681790205"><span class="hs-identifier">new_ret_id</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790202"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790193"><span class="hs-identifier hs-var">ret_id</span></a><span>
</span><a name="line-1155"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790206"><a href="#local-6989586621681790206"><span class="hs-identifier">new_bind_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790204"><span class="hs-identifier hs-var">env3</span></a><span> </span><a href="#local-6989586621681790196"><span class="hs-identifier hs-var">bind_ty</span></a><span>
</span><a name="line-1156"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790207"><a href="#local-6989586621681790207"><span class="hs-identifier">new_rvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndrs"><span class="hs-identifier hs-var">zonkIdBndrs</span></a><span> </span><a href="#local-6989586621681790204"><span class="hs-identifier hs-var">env3</span></a><span> </span><a href="#local-6989586621681790192"><span class="hs-identifier hs-var">rvs</span></a><span>
</span><a name="line-1157"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790208"><a href="#local-6989586621681790208"><span class="hs-identifier">new_lvs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndrs"><span class="hs-identifier hs-var">zonkIdBndrs</span></a><span> </span><a href="#local-6989586621681790204"><span class="hs-identifier hs-var">env3</span></a><span> </span><a href="#local-6989586621681790191"><span class="hs-identifier hs-var">lvs</span></a><span>
</span><a name="line-1158"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790209"><a href="#local-6989586621681790209"><span class="hs-identifier">new_ret_ty</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790204"><span class="hs-identifier hs-var">env3</span></a><span> </span><a href="#local-6989586621681790199"><span class="hs-identifier hs-var">ret_ty</span></a><span>
</span><a name="line-1159"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790210"><a href="#local-6989586621681790210"><span class="hs-identifier">env4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier hs-var">extendIdZonkEnvRec</span></a><span> </span><a href="#local-6989586621681790204"><span class="hs-identifier hs-var">env3</span></a><span> </span><a href="#local-6989586621681790207"><span class="hs-identifier hs-var">new_rvs</span></a><span>
</span><a name="line-1160"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790211"><a href="#local-6989586621681790211"><span class="hs-identifier">env5</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790212"><a href="#local-6989586621681790212"><span class="hs-identifier">new_segStmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkStmts"><span class="hs-identifier hs-var">zonkStmts</span></a><span> </span><a href="#local-6989586621681790210"><span class="hs-identifier hs-var">env4</span></a><span> </span><a href="#local-6989586621681790189"><span class="hs-identifier hs-var">zBody</span></a><span> </span><a href="#local-6989586621681790190"><span class="hs-identifier hs-var">segStmts</span></a><span>
</span><a name="line-1161"></a><span>        </span><span class="hs-comment">-- Zonk the ret-expressions in an envt that</span><span>
</span><a name="line-1162"></a><span>        </span><span class="hs-comment">-- has the polymorphic bindings in the envt</span><span>
</span><a name="line-1163"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790213"><a href="#local-6989586621681790213"><span class="hs-identifier">new_later_rets</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681790211"><span class="hs-identifier hs-var">env5</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790197"><span class="hs-identifier hs-var">later_rets</span></a><span>
</span><a name="line-1164"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790214"><a href="#local-6989586621681790214"><span class="hs-identifier">new_rec_rets</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681790211"><span class="hs-identifier hs-var">env5</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790198"><span class="hs-identifier hs-var">rec_rets</span></a><span>
</span><a name="line-1165"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier hs-var">extendIdZonkEnvRec</span></a><span> </span><a href="#local-6989586621681790204"><span class="hs-identifier hs-var">env3</span></a><span> </span><a href="#local-6989586621681790208"><span class="hs-identifier hs-var">new_lvs</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- Only the lvs are needed</span><span>
</span><a name="line-1166"></a><span>                 </span><span class="hs-identifier hs-var">RecStmt</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">recS_stmts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790212"><span class="hs-identifier hs-var">new_segStmts</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_later_ids</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790208"><span class="hs-identifier hs-var">new_lvs</span></a><span>
</span><a name="line-1167"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_rec_ids</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790207"><span class="hs-identifier hs-var">new_rvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_ret_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790205"><span class="hs-identifier hs-var">new_ret_id</span></a><span>
</span><a name="line-1168"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_mfix_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790203"><span class="hs-identifier hs-var">new_mfix_id</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_bind_fn</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790201"><span class="hs-identifier hs-var">new_bind_id</span></a><span>
</span><a name="line-1169"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">RecStmtTc</span><span>
</span><a name="line-1170"></a><span>                             </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">recS_bind_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790206"><span class="hs-identifier hs-var">new_bind_ty</span></a><span>
</span><a name="line-1171"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_later_rets</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790213"><span class="hs-identifier hs-var">new_later_rets</span></a><span>
</span><a name="line-1172"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_rec_rets</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790214"><span class="hs-identifier hs-var">new_rec_rets</span></a><span>
</span><a name="line-1173"></a><span>                             </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recS_ret_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790209"><span class="hs-identifier hs-var">new_ret_ty</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1174"></a><span>
</span><a name="line-1175"></a><span class="hs-identifier">zonkStmt</span><span> </span><a name="local-6989586621681790215"><a href="#local-6989586621681790215"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790216"><a href="#local-6989586621681790216"><span class="hs-identifier">zBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BodyStmt</span><span> </span><a name="local-6989586621681790217"><a href="#local-6989586621681790217"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681790218"><a href="#local-6989586621681790218"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621681790219"><a href="#local-6989586621681790219"><span class="hs-identifier">then_op</span></a></a><span> </span><a name="local-6989586621681790220"><a href="#local-6989586621681790220"><span class="hs-identifier">guard_op</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1176"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790221"><a href="#local-6989586621681790221"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790222"><a href="#local-6989586621681790222"><span class="hs-identifier">new_then_op</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790215"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790219"><span class="hs-identifier hs-var">then_op</span></a><span>
</span><a name="line-1177"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621681790223"><a href="#local-6989586621681790223"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790224"><a href="#local-6989586621681790224"><span class="hs-identifier">new_guard_op</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790221"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790220"><span class="hs-identifier hs-var">guard_op</span></a><span>
</span><a name="line-1178"></a><span>       </span><a name="local-6989586621681790225"><a href="#local-6989586621681790225"><span class="hs-identifier">new_body</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790216"><span class="hs-identifier hs-var">zBody</span></a><span> </span><a href="#local-6989586621681790223"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790218"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-1179"></a><span>       </span><a name="local-6989586621681790226"><a href="#local-6989586621681790226"><span class="hs-identifier">new_ty</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790223"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790217"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1180"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790223"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">BodyStmt</span><span> </span><a href="#local-6989586621681790226"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><a href="#local-6989586621681790225"><span class="hs-identifier hs-var">new_body</span></a><span> </span><a href="#local-6989586621681790222"><span class="hs-identifier hs-var">new_then_op</span></a><span> </span><a href="#local-6989586621681790224"><span class="hs-identifier hs-var">new_guard_op</span></a><span class="hs-special">)</span><span>
</span><a name="line-1181"></a><span>
</span><a name="line-1182"></a><span class="hs-identifier">zonkStmt</span><span> </span><a name="local-6989586621681790227"><a href="#local-6989586621681790227"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790228"><a href="#local-6989586621681790228"><span class="hs-identifier">zBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LastStmt</span><span> </span><a name="local-6989586621681790229"><a href="#local-6989586621681790229"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790230"><a href="#local-6989586621681790230"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621681790231"><a href="#local-6989586621681790231"><span class="hs-identifier">noret</span></a></a><span> </span><a name="local-6989586621681790232"><a href="#local-6989586621681790232"><span class="hs-identifier">ret_op</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1183"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790233"><a href="#local-6989586621681790233"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790234"><a href="#local-6989586621681790234"><span class="hs-identifier">new_ret</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790227"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790232"><span class="hs-identifier hs-var">ret_op</span></a><span>
</span><a name="line-1184"></a><span>       </span><a name="local-6989586621681790235"><a href="#local-6989586621681790235"><span class="hs-identifier">new_body</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790228"><span class="hs-identifier hs-var">zBody</span></a><span> </span><a href="#local-6989586621681790233"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790230"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-1185"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790227"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">LastStmt</span><span> </span><a href="#local-6989586621681790229"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790235"><span class="hs-identifier hs-var">new_body</span></a><span> </span><a href="#local-6989586621681790231"><span class="hs-identifier hs-var">noret</span></a><span> </span><a href="#local-6989586621681790234"><span class="hs-identifier hs-var">new_ret</span></a><span class="hs-special">)</span><span>
</span><a name="line-1186"></a><span>
</span><a name="line-1187"></a><span class="hs-identifier">zonkStmt</span><span> </span><a name="local-6989586621681790236"><a href="#local-6989586621681790236"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TransStmt</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">trS_stmts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790237"><a href="#local-6989586621681790237"><span class="hs-identifier">stmts</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790238"><a href="#local-6989586621681790238"><span class="hs-identifier">binderMap</span></a></a><span>
</span><a name="line-1188"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_by</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790239"><a href="#local-6989586621681790239"><span class="hs-identifier">by</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_form</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790240"><a href="#local-6989586621681790240"><span class="hs-identifier">form</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_using</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790241"><a href="#local-6989586621681790241"><span class="hs-identifier">using</span></a></a><span>
</span><a name="line-1189"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_ret</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790242"><a href="#local-6989586621681790242"><span class="hs-identifier">return_op</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_bind</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790243"><a href="#local-6989586621681790243"><span class="hs-identifier">bind_op</span></a></a><span>
</span><a name="line-1190"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790244"><a href="#local-6989586621681790244"><span class="hs-identifier">bind_arg_ty</span></a></a><span>
</span><a name="line-1191"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_fmap</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790245"><a href="#local-6989586621681790245"><span class="hs-identifier">liftM_op</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1192"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-1193"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790252"><a href="#local-6989586621681790252"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790253"><a href="#local-6989586621681790253"><span class="hs-identifier">bind_op'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790236"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790243"><span class="hs-identifier hs-var">bind_op</span></a><span>
</span><a name="line-1194"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790254"><a href="#local-6989586621681790254"><span class="hs-identifier">bind_arg_ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790252"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790244"><span class="hs-identifier hs-var">bind_arg_ty</span></a><span>
</span><a name="line-1195"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790255"><a href="#local-6989586621681790255"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790256"><a href="#local-6989586621681790256"><span class="hs-identifier">stmts'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkStmts"><span class="hs-identifier hs-var">zonkStmts</span></a><span> </span><a href="#local-6989586621681790252"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790237"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-1196"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790257"><a href="#local-6989586621681790257"><span class="hs-identifier">by'</span></a></a><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmapMaybeM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790255"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790239"><span class="hs-identifier hs-var">by</span></a><span>
</span><a name="line-1197"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790258"><a href="#local-6989586621681790258"><span class="hs-identifier">using'</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790255"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790241"><span class="hs-identifier hs-var">using</span></a><span>
</span><a name="line-1198"></a><span>
</span><a name="line-1199"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790259"><a href="#local-6989586621681790259"><span class="hs-identifier">env3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790260"><a href="#local-6989586621681790260"><span class="hs-identifier">return_op'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790255"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790242"><span class="hs-identifier hs-var">return_op</span></a><span>
</span><a name="line-1200"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790261"><a href="#local-6989586621681790261"><span class="hs-identifier">binderMap'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790246"><span class="hs-identifier hs-var">zonkBinderMapEntry</span></a><span> </span><a href="#local-6989586621681790259"><span class="hs-identifier hs-var">env3</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790238"><span class="hs-identifier hs-var">binderMap</span></a><span>
</span><a name="line-1201"></a><span>    </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790262"><a href="#local-6989586621681790262"><span class="hs-identifier">liftM_op'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681790259"><span class="hs-identifier hs-var">env3</span></a><span> </span><a href="#local-6989586621681790245"><span class="hs-identifier hs-var">liftM_op</span></a><span>
</span><a name="line-1202"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790263"><a href="#local-6989586621681790263"><span class="hs-identifier">env3'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier hs-var">extendIdZonkEnvRec</span></a><span> </span><a href="#local-6989586621681790259"><span class="hs-identifier hs-var">env3</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621681790261"><span class="hs-identifier hs-var">binderMap'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1203"></a><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790263"><span class="hs-identifier hs-var">env3'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">TransStmt</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">trS_stmts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790256"><span class="hs-identifier hs-var">stmts'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_bndrs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790261"><span class="hs-identifier hs-var">binderMap'</span></a><span>
</span><a name="line-1204"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_by</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790257"><span class="hs-identifier hs-var">by'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_form</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790240"><span class="hs-identifier hs-var">form</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_using</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790258"><span class="hs-identifier hs-var">using'</span></a><span>
</span><a name="line-1205"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_ret</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790260"><span class="hs-identifier hs-var">return_op'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_bind</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790253"><span class="hs-identifier hs-var">bind_op'</span></a><span>
</span><a name="line-1206"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790254"><span class="hs-identifier hs-var">bind_arg_ty'</span></a><span>
</span><a name="line-1207"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">trS_fmap</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790262"><span class="hs-identifier hs-var">liftM_op'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1208"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1209"></a><span>    </span><a name="local-6989586621681790246"><a href="#local-6989586621681790246"><span class="hs-identifier">zonkBinderMapEntry</span></a></a><span> </span><a name="local-6989586621681790247"><a href="#local-6989586621681790247"><span class="hs-identifier">env</span></a></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621681790248"><a href="#local-6989586621681790248"><span class="hs-identifier">oldBinder</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790249"><a href="#local-6989586621681790249"><span class="hs-identifier">newBinder</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1210"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790250"><a href="#local-6989586621681790250"><span class="hs-identifier">oldBinder'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkIdOcc"><span class="hs-identifier hs-var">zonkIdOcc</span></a><span> </span><a href="#local-6989586621681790247"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790248"><span class="hs-identifier hs-var">oldBinder</span></a><span>
</span><a name="line-1211"></a><span>        </span><a name="local-6989586621681790251"><a href="#local-6989586621681790251"><span class="hs-identifier">newBinder'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681790247"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790249"><span class="hs-identifier hs-var">newBinder</span></a><span>
</span><a name="line-1212"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790250"><span class="hs-identifier hs-var">oldBinder'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790251"><span class="hs-identifier hs-var">newBinder'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1213"></a><span>
</span><a name="line-1214"></a><span class="hs-identifier">zonkStmt</span><span> </span><a name="local-6989586621681790264"><a href="#local-6989586621681790264"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LetStmt</span><span> </span><a name="local-6989586621681790265"><a href="#local-6989586621681790265"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790266"><a href="#local-6989586621681790266"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681790267"><a href="#local-6989586621681790267"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1215"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790268"><a href="#local-6989586621681790268"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790269"><a href="#local-6989586621681790269"><span class="hs-identifier">new_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLocalBinds"><span class="hs-identifier hs-var">zonkLocalBinds</span></a><span> </span><a href="#local-6989586621681790264"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790267"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-1216"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790268"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">LetStmt</span><span> </span><a href="#local-6989586621681790265"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790266"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681790269"><span class="hs-identifier hs-var">new_binds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span>
</span><a name="line-1218"></a><span class="hs-identifier">zonkStmt</span><span> </span><a name="local-6989586621681790270"><a href="#local-6989586621681790270"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790271"><a href="#local-6989586621681790271"><span class="hs-identifier">zBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BindStmt</span><span> </span><a name="local-6989586621681790272"><a href="#local-6989586621681790272"><span class="hs-identifier">bind_ty</span></a></a><span> </span><a name="local-6989586621681790273"><a href="#local-6989586621681790273"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621681790274"><a href="#local-6989586621681790274"><span class="hs-identifier">body</span></a></a><span> </span><a name="local-6989586621681790275"><a href="#local-6989586621681790275"><span class="hs-identifier">bind_op</span></a></a><span> </span><a name="local-6989586621681790276"><a href="#local-6989586621681790276"><span class="hs-identifier">fail_op</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1219"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790277"><a href="#local-6989586621681790277"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790278"><a href="#local-6989586621681790278"><span class="hs-identifier">new_bind</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790270"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790275"><span class="hs-identifier hs-var">bind_op</span></a><span>
</span><a name="line-1220"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790279"><a href="#local-6989586621681790279"><span class="hs-identifier">new_bind_ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790277"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790272"><span class="hs-identifier hs-var">bind_ty</span></a><span>
</span><a name="line-1221"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790280"><a href="#local-6989586621681790280"><span class="hs-identifier">new_body</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790271"><span class="hs-identifier hs-var">zBody</span></a><span> </span><a href="#local-6989586621681790277"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790274"><span class="hs-identifier hs-var">body</span></a><span>
</span><a name="line-1222"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790281"><a href="#local-6989586621681790281"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790282"><a href="#local-6989586621681790282"><span class="hs-identifier">new_pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790277"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790273"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1223"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681790283"><a href="#local-6989586621681790283"><span class="hs-identifier">new_fail</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790277"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790276"><span class="hs-identifier hs-var">fail_op</span></a><span>
</span><a name="line-1224"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621681790281"><span class="hs-identifier hs-var">env2</span></a><span>
</span><a name="line-1225"></a><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">BindStmt</span><span> </span><a href="#local-6989586621681790279"><span class="hs-identifier hs-var">new_bind_ty</span></a><span> </span><a href="#local-6989586621681790282"><span class="hs-identifier hs-var">new_pat</span></a><span> </span><a href="#local-6989586621681790280"><span class="hs-identifier hs-var">new_body</span></a><span> </span><a href="#local-6989586621681790278"><span class="hs-identifier hs-var">new_bind</span></a><span> </span><a href="#local-6989586621681790283"><span class="hs-identifier hs-var">new_fail</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1226"></a><span>
</span><a name="line-1227"></a><span class="hs-comment">-- Scopes: join &gt; ops (in reverse order) &gt; pats (in forward order)</span><span>
</span><a name="line-1228"></a><span class="hs-comment">--              &gt; rest of stmts</span><span>
</span><a name="line-1229"></a><span class="hs-identifier">zonkStmt</span><span> </span><a name="local-6989586621681790284"><a href="#local-6989586621681790284"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790285"><a href="#local-6989586621681790285"><span class="hs-identifier">_zBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApplicativeStmt</span><span> </span><a name="local-6989586621681790286"><a href="#local-6989586621681790286"><span class="hs-identifier">body_ty</span></a></a><span> </span><a name="local-6989586621681790287"><a href="#local-6989586621681790287"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621681790288"><a href="#local-6989586621681790288"><span class="hs-identifier">mb_join</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1230"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790340"><a href="#local-6989586621681790340"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790341"><a href="#local-6989586621681790341"><span class="hs-identifier">new_mb_join</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790289"><span class="hs-identifier hs-var">zonk_join</span></a><span> </span><a href="#local-6989586621681790284"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790288"><span class="hs-identifier hs-var">mb_join</span></a><span>
</span><a name="line-1231"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790342"><a href="#local-6989586621681790342"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790343"><a href="#local-6989586621681790343"><span class="hs-identifier">new_args</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790292"><span class="hs-identifier hs-var">zonk_args</span></a><span> </span><a href="#local-6989586621681790340"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790287"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1232"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790344"><a href="#local-6989586621681790344"><span class="hs-identifier">new_body_ty</span></a></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790342"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790286"><span class="hs-identifier hs-var">body_ty</span></a><span>
</span><a name="line-1233"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790342"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ApplicativeStmt</span><span> </span><a href="#local-6989586621681790344"><span class="hs-identifier hs-var">new_body_ty</span></a><span> </span><a href="#local-6989586621681790343"><span class="hs-identifier hs-var">new_args</span></a><span> </span><a href="#local-6989586621681790341"><span class="hs-identifier hs-var">new_mb_join</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1234"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1235"></a><span>    </span><a name="local-6989586621681790289"><a href="#local-6989586621681790289"><span class="hs-identifier">zonk_join</span></a></a><span> </span><a name="local-6989586621681790295"><a href="#local-6989586621681790295"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790295"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-1236"></a><span>    </span><span class="hs-identifier">zonk_join</span><span> </span><a name="local-6989586621681790296"><a href="#local-6989586621681790296"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681790297"><a href="#local-6989586621681790297"><span class="hs-identifier">j</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790296"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790297"><span class="hs-identifier hs-var">j</span></a><span>
</span><a name="line-1237"></a><span>
</span><a name="line-1238"></a><span>    </span><a name="local-6989586621681790290"><a href="#local-6989586621681790290"><span class="hs-identifier">get_pat</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ApplicativeArgOne</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681790298"><a href="#local-6989586621681790298"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790298"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1239"></a><span>    </span><span class="hs-identifier">get_pat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ApplicativeArgMany</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681790299"><a href="#local-6989586621681790299"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790299"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1240"></a><span>    </span><span class="hs-identifier">get_pat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">XApplicativeArg</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkStmt&quot;</span><span>
</span><a name="line-1241"></a><span>
</span><a name="line-1242"></a><span>    </span><a name="local-6989586621681790291"><a href="#local-6989586621681790291"><span class="hs-identifier">replace_pat</span></a></a><span> </span><a name="local-6989586621681790300"><a href="#local-6989586621681790300"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681790301"><a href="#local-6989586621681790301"><span class="hs-identifier">op</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ApplicativeArgOne</span><span> </span><a name="local-6989586621681790302"><a href="#local-6989586621681790302"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681790303"><a href="#local-6989586621681790303"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621681790304"><a href="#local-6989586621681790304"><span class="hs-identifier">isBody</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1243"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790301"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ApplicativeArgOne</span><span> </span><a href="#local-6989586621681790302"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790300"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621681790303"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621681790304"><span class="hs-identifier hs-var">isBody</span></a><span class="hs-special">)</span><span>
</span><a name="line-1244"></a><span>    </span><span class="hs-identifier">replace_pat</span><span> </span><a name="local-6989586621681790305"><a href="#local-6989586621681790305"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681790306"><a href="#local-6989586621681790306"><span class="hs-identifier">op</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ApplicativeArgMany</span><span> </span><a name="local-6989586621681790307"><a href="#local-6989586621681790307"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790308"><a href="#local-6989586621681790308"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621681790309"><a href="#local-6989586621681790309"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1245"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790306"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ApplicativeArgMany</span><span> </span><a href="#local-6989586621681790307"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790308"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621681790309"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621681790305"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>
</span><a name="line-1246"></a><span>    </span><span class="hs-identifier">replace_pat</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">XApplicativeArg</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkStmt&quot;</span><span>
</span><a name="line-1247"></a><span>
</span><a name="line-1248"></a><span>    </span><a name="local-6989586621681790292"><a href="#local-6989586621681790292"><span class="hs-identifier">zonk_args</span></a></a><span> </span><a name="local-6989586621681790310"><a href="#local-6989586621681790310"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790311"><a href="#local-6989586621681790311"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-1249"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790312"><a href="#local-6989586621681790312"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790313"><a href="#local-6989586621681790313"><span class="hs-identifier">new_args_rev</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790293"><span class="hs-identifier hs-var">zonk_args_rev</span></a><span> </span><a href="#local-6989586621681790310"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681790311"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1250"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790314"><a href="#local-6989586621681790314"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790315"><a href="#local-6989586621681790315"><span class="hs-identifier">new_pats</span></a></a><span class="hs-special">)</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPats"><span class="hs-identifier hs-var">zonkPats</span></a><span> </span><a href="#local-6989586621681790312"><span class="hs-identifier hs-var">env1</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621681790290"><span class="hs-identifier hs-var">get_pat</span></a><span> </span><a href="#local-6989586621681790311"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-1251"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790314"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621681790291"><span class="hs-identifier hs-var">replace_pat</span></a><span> </span><a href="#local-6989586621681790315"><span class="hs-identifier hs-var">new_pats</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621681790313"><span class="hs-identifier hs-var">new_args_rev</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1252"></a><span>
</span><a name="line-1253"></a><span>     </span><span class="hs-comment">-- these need to go backward, because if any operators are higher-rank,</span><span>
</span><a name="line-1254"></a><span>     </span><span class="hs-comment">-- later operators may introduce skolems that are in scope for earlier</span><span>
</span><a name="line-1255"></a><span>     </span><span class="hs-comment">-- arguments</span><span>
</span><a name="line-1256"></a><span>    </span><a name="local-6989586621681790293"><a href="#local-6989586621681790293"><span class="hs-identifier">zonk_args_rev</span></a></a><span> </span><a name="local-6989586621681790316"><a href="#local-6989586621681790316"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621681790317"><a href="#local-6989586621681790317"><span class="hs-identifier">op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790318"><a href="#local-6989586621681790318"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621681790319"><a href="#local-6989586621681790319"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1257"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790320"><a href="#local-6989586621681790320"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790321"><a href="#local-6989586621681790321"><span class="hs-identifier">new_op</span></a></a><span class="hs-special">)</span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790316"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790317"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-1258"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790322"><a href="#local-6989586621681790322"><span class="hs-identifier">new_arg</span></a></a><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790294"><span class="hs-identifier hs-var">zonk_arg</span></a><span> </span><a href="#local-6989586621681790320"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790318"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-1259"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790323"><a href="#local-6989586621681790323"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790324"><a href="#local-6989586621681790324"><span class="hs-identifier">new_args</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790293"><span class="hs-identifier hs-var">zonk_args_rev</span></a><span> </span><a href="#local-6989586621681790320"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790319"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1260"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790323"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790321"><span class="hs-identifier hs-var">new_op</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790322"><span class="hs-identifier hs-var">new_arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681790324"><span class="hs-identifier hs-var">new_args</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1261"></a><span>    </span><span class="hs-identifier">zonk_args_rev</span><span> </span><a name="local-6989586621681790325"><a href="#local-6989586621681790325"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790325"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1262"></a><span>
</span><a name="line-1263"></a><span>    </span><a name="local-6989586621681790294"><a href="#local-6989586621681790294"><span class="hs-identifier">zonk_arg</span></a></a><span> </span><a name="local-6989586621681790326"><a href="#local-6989586621681790326"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApplicativeArgOne</span><span> </span><a name="local-6989586621681790327"><a href="#local-6989586621681790327"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790328"><a href="#local-6989586621681790328"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621681790329"><a href="#local-6989586621681790329"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621681790330"><a href="#local-6989586621681790330"><span class="hs-identifier">isBody</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1264"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790331"><a href="#local-6989586621681790331"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790326"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790329"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1265"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApplicativeArgOne</span><span> </span><a href="#local-6989586621681790327"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790328"><span class="hs-identifier hs-var">pat</span></a><span> </span><a href="#local-6989586621681790331"><span class="hs-identifier hs-var">new_expr</span></a><span> </span><a href="#local-6989586621681790330"><span class="hs-identifier hs-var">isBody</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1266"></a><span>    </span><span class="hs-identifier">zonk_arg</span><span> </span><a name="local-6989586621681790332"><a href="#local-6989586621681790332"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApplicativeArgMany</span><span> </span><a name="local-6989586621681790333"><a href="#local-6989586621681790333"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790334"><a href="#local-6989586621681790334"><span class="hs-identifier">stmts</span></a></a><span> </span><a name="local-6989586621681790335"><a href="#local-6989586621681790335"><span class="hs-identifier">ret</span></a></a><span> </span><a name="local-6989586621681790336"><a href="#local-6989586621681790336"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1267"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790337"><a href="#local-6989586621681790337"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790338"><a href="#local-6989586621681790338"><span class="hs-identifier">new_stmts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkStmts"><span class="hs-identifier hs-var">zonkStmts</span></a><span> </span><a href="#local-6989586621681790332"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790334"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-1268"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790339"><a href="#local-6989586621681790339"><span class="hs-identifier">new_ret</span></a></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkExpr"><span class="hs-identifier hs-var">zonkExpr</span></a><span> </span><a href="#local-6989586621681790337"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790335"><span class="hs-identifier hs-var">ret</span></a><span>
</span><a name="line-1269"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ApplicativeArgMany</span><span> </span><a href="#local-6989586621681790333"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790338"><span class="hs-identifier hs-var">new_stmts</span></a><span> </span><a href="#local-6989586621681790339"><span class="hs-identifier hs-var">new_ret</span></a><span> </span><a href="#local-6989586621681790336"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1270"></a><span>    </span><span class="hs-identifier">zonk_arg</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XApplicativeArg</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkStmt.XApplicativeArg&quot;</span><span>
</span><a name="line-1271"></a><span>
</span><a name="line-1272"></a><span class="hs-identifier">zonkStmt</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XStmtLR</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkStmt&quot;</span><span>
</span><a name="line-1273"></a><span>
</span><a name="line-1274"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-1275"></a><span class="hs-identifier">zonkRecFields</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsRecordBinds</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsRecordBinds</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span>
</span><a name="line-1276"></a><a name="zonkRecFields"><a href="TcHsSyn.html#zonkRecFields"><span class="hs-identifier">zonkRecFields</span></a></a><span> </span><a name="local-6989586621681790345"><a href="#local-6989586621681790345"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFields</span><span> </span><a name="local-6989586621681790346"><a href="#local-6989586621681790346"><span class="hs-identifier">flds</span></a></a><span> </span><a name="local-6989586621681790347"><a href="#local-6989586621681790347"><span class="hs-identifier">dd</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1277"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790353"><a href="#local-6989586621681790353"><span class="hs-identifier">flds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681790348"><span class="hs-identifier hs-var">zonk_rbind</span></a><span> </span><a href="#local-6989586621681790346"><span class="hs-identifier hs-var">flds</span></a><span>
</span><a name="line-1278"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFields</span><span> </span><a href="#local-6989586621681790353"><span class="hs-identifier hs-var">flds'</span></a><span> </span><a href="#local-6989586621681790347"><span class="hs-identifier hs-var">dd</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1279"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1280"></a><span>    </span><a name="local-6989586621681790348"><a href="#local-6989586621681790348"><span class="hs-identifier">zonk_rbind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790349"><a href="#local-6989586621681790349"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681790350"><a href="#local-6989586621681790350"><span class="hs-identifier">fld</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1281"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790351"><a href="#local-6989586621681790351"><span class="hs-identifier">new_id</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkFieldOcc"><span class="hs-identifier hs-var">zonkFieldOcc</span></a><span> </span><a href="#local-6989586621681790345"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsRecFieldLbl</span><span> </span><a href="#local-6989586621681790350"><span class="hs-identifier hs-var">fld</span></a><span class="hs-special">)</span><span>
</span><a name="line-1282"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790352"><a href="#local-6989586621681790352"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790345"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsRecFieldArg</span><span> </span><a href="#local-6989586621681790350"><span class="hs-identifier hs-var">fld</span></a><span class="hs-special">)</span><span>
</span><a name="line-1283"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790349"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790350"><span class="hs-identifier hs-var">fld</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsRecFieldLbl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790351"><span class="hs-identifier hs-var">new_id</span></a><span>
</span><a name="line-1284"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecFieldArg</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790352"><span class="hs-identifier hs-var">new_expr</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1285"></a><span>
</span><a name="line-1286"></a><span class="hs-identifier">zonkRecUpdFields</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsRecUpdField</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">]</span><span>
</span><a name="line-1287"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LHsRecUpdField</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">]</span><span>
</span><a name="line-1288"></a><a name="zonkRecUpdFields"><a href="TcHsSyn.html#zonkRecUpdFields"><span class="hs-identifier">zonkRecUpdFields</span></a></a><span> </span><a name="local-6989586621681790354"><a href="#local-6989586621681790354"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621681790355"><span class="hs-identifier hs-var">zonk_rbind</span></a><span>
</span><a name="line-1289"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1290"></a><span>    </span><a name="local-6989586621681790355"><a href="#local-6989586621681790355"><span class="hs-identifier">zonk_rbind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790356"><a href="#local-6989586621681790356"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681790357"><a href="#local-6989586621681790357"><span class="hs-identifier">fld</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1291"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790358"><a href="#local-6989586621681790358"><span class="hs-identifier">new_id</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkFieldOcc"><span class="hs-identifier hs-var">zonkFieldOcc</span></a><span> </span><a href="#local-6989586621681790354"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hsRecUpdFieldOcc</span><span> </span><a href="#local-6989586621681790357"><span class="hs-identifier hs-var">fld</span></a><span class="hs-special">)</span><span>
</span><a name="line-1292"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790359"><a href="#local-6989586621681790359"><span class="hs-identifier">new_expr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790354"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsRecFieldArg</span><span> </span><a href="#local-6989586621681790357"><span class="hs-identifier hs-var">fld</span></a><span class="hs-special">)</span><span>
</span><a name="line-1293"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790356"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790357"><span class="hs-identifier hs-var">fld</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsRecFieldLbl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">ambiguousFieldOcc</span><span> </span><a href="#local-6989586621681790358"><span class="hs-identifier hs-var">new_id</span></a><span>
</span><a name="line-1294"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">hsRecFieldArg</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790359"><span class="hs-identifier hs-var">new_expr</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1295"></a><span>
</span><a name="line-1296"></a><span class="hs-comment">-------------------------------------------------------------------------</span><span>
</span><a name="line-1297"></a><span class="hs-identifier">mapIPNameTc</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681789444"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><a href="#local-6989586621681789445"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">HsIPName</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789444"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1298"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">HsIPName</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681789445"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-1299"></a><a name="mapIPNameTc"><a href="TcHsSyn.html#mapIPNameTc"><span class="hs-identifier">mapIPNameTc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621681790360"><a href="#local-6989586621681790360"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621681790360"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-1300"></a><span class="hs-identifier">mapIPNameTc</span><span> </span><a name="local-6989586621681790361"><a href="#local-6989586621681790361"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621681790362"><a href="#local-6989586621681790362"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790363"><a href="#local-6989586621681790363"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790361"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621681790362"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1301"></a><span>                             </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621681790363"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1302"></a><span>
</span><a name="line-1303"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[BackSubst-Pats]{Patterns}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1310"></a><span>
</span><a name="line-1311"></a><span class="hs-identifier">zonkPat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OutPat</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">OutPat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-1312"></a><span class="hs-comment">-- Extend the environment as we go, because it's possible for one</span><span>
</span><a name="line-1313"></a><span class="hs-comment">-- pattern to bind something that is used in another (inside or</span><span>
</span><a name="line-1314"></a><span class="hs-comment">-- to the right)</span><span>
</span><a name="line-1315"></a><a name="zonkPat"><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier">zonkPat</span></a></a><span> </span><a name="local-6989586621681790364"><a href="#local-6989586621681790364"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790365"><a href="#local-6989586621681790365"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#wrapLocSndM"><span class="hs-identifier hs-var">wrapLocSndM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonk_pat"><span class="hs-identifier hs-var">zonk_pat</span></a><span> </span><a href="#local-6989586621681790364"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790365"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1316"></a><span>
</span><a name="line-1317"></a><span class="hs-identifier">zonk_pat</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Pat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-1318"></a><a name="zonk_pat"><a href="TcHsSyn.html#zonk_pat"><span class="hs-identifier">zonk_pat</span></a></a><span> </span><a name="local-6989586621681790366"><a href="#local-6989586621681790366"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ParPat</span><span> </span><a name="local-6989586621681790367"><a href="#local-6989586621681790367"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790368"><a href="#local-6989586621681790368"><span class="hs-identifier">p</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1319"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790369"><a href="#local-6989586621681790369"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790370"><a href="#local-6989586621681790370"><span class="hs-identifier">p'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790366"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790368"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1320"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790369"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ParPat</span><span> </span><a href="#local-6989586621681790367"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790370"><span class="hs-identifier hs-var">p'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1321"></a><span>
</span><a name="line-1322"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790371"><a href="#local-6989586621681790371"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">WildPat</span><span> </span><a name="local-6989586621681790372"><a href="#local-6989586621681790372"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1323"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790373"><a href="#local-6989586621681790373"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790371"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790372"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1324"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#ensureNotLevPoly"><span class="hs-identifier hs-var">ensureNotLevPoly</span></a><span> </span><a href="#local-6989586621681790373"><span class="hs-identifier hs-var">ty'</span></a><span>
</span><a name="line-1325"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In a wildcard pattern&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1326"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790371"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">WildPat</span><span> </span><a href="#local-6989586621681790373"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1327"></a><span>
</span><a name="line-1328"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790374"><a href="#local-6989586621681790374"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">VarPat</span><span> </span><a name="local-6989586621681790375"><a href="#local-6989586621681790375"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790376"><a href="#local-6989586621681790376"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681790377"><a href="#local-6989586621681790377"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1329"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790378"><a href="#local-6989586621681790378"><span class="hs-identifier">v'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681790374"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790377"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1330"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#extendIdZonkEnv1"><span class="hs-identifier hs-var">extendIdZonkEnv1</span></a><span> </span><a href="#local-6989586621681790374"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790378"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">VarPat</span><span> </span><a href="#local-6989586621681790375"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790376"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681790378"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1331"></a><span>
</span><a name="line-1332"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790379"><a href="#local-6989586621681790379"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LazyPat</span><span> </span><a name="local-6989586621681790380"><a href="#local-6989586621681790380"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790381"><a href="#local-6989586621681790381"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1333"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790382"><a href="#local-6989586621681790382"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790383"><a href="#local-6989586621681790383"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790379"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790381"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1334"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790382"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier hs-var">LazyPat</span><span> </span><a href="#local-6989586621681790380"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790383"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1335"></a><span>
</span><a name="line-1336"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790384"><a href="#local-6989586621681790384"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BangPat</span><span> </span><a name="local-6989586621681790385"><a href="#local-6989586621681790385"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790386"><a href="#local-6989586621681790386"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1337"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790387"><a href="#local-6989586621681790387"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790388"><a href="#local-6989586621681790388"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790384"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790386"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1338"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790387"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span>  </span><span class="hs-identifier hs-var">BangPat</span><span> </span><a href="#local-6989586621681790385"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790388"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1339"></a><span>
</span><a name="line-1340"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790389"><a href="#local-6989586621681790389"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AsPat</span><span> </span><a name="local-6989586621681790390"><a href="#local-6989586621681790390"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790391"><a href="#local-6989586621681790391"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621681790392"><a href="#local-6989586621681790392"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681790393"><a href="#local-6989586621681790393"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1341"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790394"><a href="#local-6989586621681790394"><span class="hs-identifier">v'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681790389"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790392"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1342"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790395"><a href="#local-6989586621681790395"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790396"><a href="#local-6989586621681790396"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#extendIdZonkEnv1"><span class="hs-identifier hs-var">extendIdZonkEnv1</span></a><span> </span><a href="#local-6989586621681790389"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790394"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790393"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1343"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790395"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">AsPat</span><span> </span><a href="#local-6989586621681790390"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790391"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621681790394"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790396"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1344"></a><span>
</span><a name="line-1345"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790397"><a href="#local-6989586621681790397"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ViewPat</span><span> </span><a name="local-6989586621681790398"><a href="#local-6989586621681790398"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681790399"><a href="#local-6989586621681790399"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621681790400"><a href="#local-6989586621681790400"><span class="hs-identifier">pat</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1346"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790401"><a href="#local-6989586621681790401"><span class="hs-identifier">expr'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790397"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790399"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1347"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790402"><a href="#local-6989586621681790402"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790403"><a href="#local-6989586621681790403"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790397"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790400"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1348"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790404"><a href="#local-6989586621681790404"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790397"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790398"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1349"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790402"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ViewPat</span><span> </span><a href="#local-6989586621681790404"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681790401"><span class="hs-identifier hs-var">expr'</span></a><span> </span><a href="#local-6989586621681790403"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1350"></a><span>
</span><a name="line-1351"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790405"><a href="#local-6989586621681790405"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPatTc</span><span> </span><a name="local-6989586621681790406"><a href="#local-6989586621681790406"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681790407"><a href="#local-6989586621681790407"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1352"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790408"><a href="#local-6989586621681790408"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790405"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790406"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1353"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790409"><a href="#local-6989586621681790409"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790410"><a href="#local-6989586621681790410"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPats"><span class="hs-identifier hs-var">zonkPats</span></a><span> </span><a href="#local-6989586621681790405"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790407"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-1354"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790409"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPatTc</span><span> </span><a href="#local-6989586621681790408"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790410"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1355"></a><span>
</span><a name="line-1356"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790411"><a href="#local-6989586621681790411"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPatTc</span><span> </span><a name="local-6989586621681790412"><a href="#local-6989586621681790412"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790413"><a href="#local-6989586621681790413"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">,</span><a name="local-6989586621681790414"><a href="#local-6989586621681790414"><span class="hs-identifier">wit</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681790415"><a href="#local-6989586621681790415"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1357"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790416"><a href="#local-6989586621681790416"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790417"><a href="#local-6989586621681790417"><span class="hs-identifier">wit'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790411"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790414"><span class="hs-identifier hs-var">wit</span></a><span>
</span><a name="line-1358"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790418"><a href="#local-6989586621681790418"><span class="hs-identifier">ty2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790416"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-6989586621681790413"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1359"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790419"><a href="#local-6989586621681790419"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790416"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-6989586621681790412"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1360"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790420"><a href="#local-6989586621681790420"><span class="hs-identifier">env''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790421"><a href="#local-6989586621681790421"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPats"><span class="hs-identifier hs-var">zonkPats</span></a><span> </span><a href="#local-6989586621681790416"><span class="hs-identifier hs-var">env'</span></a><span> </span><a href="#local-6989586621681790415"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-1361"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790420"><span class="hs-identifier hs-var">env''</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ListPat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ListPatTc</span><span> </span><a href="#local-6989586621681790419"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790418"><span class="hs-identifier hs-var">ty2'</span></a><span class="hs-special">,</span><a href="#local-6989586621681790417"><span class="hs-identifier hs-var">wit'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790421"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1362"></a><span>
</span><a name="line-1363"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790422"><a href="#local-6989586621681790422"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TuplePat</span><span> </span><a name="local-6989586621681790423"><a href="#local-6989586621681790423"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621681790424"><a href="#local-6989586621681790424"><span class="hs-identifier">pats</span></a></a><span> </span><a name="local-6989586621681790425"><a href="#local-6989586621681790425"><span class="hs-identifier">boxed</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1364"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790426"><a href="#local-6989586621681790426"><span class="hs-identifier">tys'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790422"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790423"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1365"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790427"><a href="#local-6989586621681790427"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790428"><a href="#local-6989586621681790428"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPats"><span class="hs-identifier hs-var">zonkPats</span></a><span> </span><a href="#local-6989586621681790422"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790424"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-1366"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790427"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">TuplePat</span><span> </span><a href="#local-6989586621681790426"><span class="hs-identifier hs-var">tys'</span></a><span> </span><a href="#local-6989586621681790428"><span class="hs-identifier hs-var">pats'</span></a><span> </span><a href="#local-6989586621681790425"><span class="hs-identifier hs-var">boxed</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1367"></a><span>
</span><a name="line-1368"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790429"><a href="#local-6989586621681790429"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SumPat</span><span> </span><a name="local-6989586621681790430"><a href="#local-6989586621681790430"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621681790431"><a href="#local-6989586621681790431"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621681790432"><a href="#local-6989586621681790432"><span class="hs-identifier">alt</span></a></a><span> </span><a name="local-6989586621681790433"><a href="#local-6989586621681790433"><span class="hs-identifier">arity</span></a></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1369"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790434"><a href="#local-6989586621681790434"><span class="hs-identifier">tys'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790429"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790430"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1370"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790435"><a href="#local-6989586621681790435"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790436"><a href="#local-6989586621681790436"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790429"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790431"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1371"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790435"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">SumPat</span><span> </span><a href="#local-6989586621681790434"><span class="hs-identifier hs-var">tys'</span></a><span> </span><a href="#local-6989586621681790436"><span class="hs-identifier hs-var">pat'</span></a><span> </span><a href="#local-6989586621681790432"><span class="hs-identifier hs-var">alt</span></a><span> </span><a href="#local-6989586621681790433"><span class="hs-identifier hs-var">arity</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1372"></a><span>
</span><a name="line-1373"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790437"><a href="#local-6989586621681790437"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790438"><a href="#local-6989586621681790438"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ConPatOut</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790439"><a href="#local-6989586621681790439"><span class="hs-identifier">tys</span></a></a><span>
</span><a name="line-1374"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790440"><a href="#local-6989586621681790440"><span class="hs-identifier">tyvars</span></a></a><span>
</span><a name="line-1375"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790441"><a href="#local-6989586621681790441"><span class="hs-identifier">evs</span></a></a><span>
</span><a name="line-1376"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790442"><a href="#local-6989586621681790442"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-1377"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790443"><a href="#local-6989586621681790443"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-1378"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_wrap</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790444"><a href="#local-6989586621681790444"><span class="hs-identifier">wrapper</span></a></a><span>
</span><a name="line-1379"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_con</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681790445"><a href="#local-6989586621681790445"><span class="hs-identifier">con</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1380"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-identifier">isImmutableTyVar</span><span> </span><span class="hs-identifier hs-var">tyvars</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1381"></a><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790447"><a href="#local-6989586621681790447"><span class="hs-identifier">new_tys</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790437"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790439"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1382"></a><span>
</span><a name="line-1383"></a><span>          </span><span class="hs-comment">-- an unboxed tuple pattern (but only an unboxed tuple pattern)</span><span>
</span><a name="line-1384"></a><span>          </span><span class="hs-comment">-- might have levity-polymorphic arguments. Check for this badness.</span><span>
</span><a name="line-1385"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681790445"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1386"></a><span>            </span><span class="hs-identifier hs-var">RealDataCon</span><span> </span><a name="local-6989586621681790448"><a href="#local-6989586621681790448"><span class="hs-identifier">dc</span></a></a><span>
</span><a name="line-1387"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isUnboxedTupleTyCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dataConTyCon</span><span> </span><a href="#local-6989586621681790448"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1388"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="TcMType.html#checkForLevPoly"><span class="hs-identifier hs-var">checkForLevPoly</span></a><span> </span><a href="#local-6989586621681790446"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dropRuntimeRepArgs</span><span> </span><a href="#local-6989586621681790447"><span class="hs-identifier hs-var">new_tys</span></a><span class="hs-special">)</span><span>
</span><a name="line-1389"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1390"></a><span>
</span><a name="line-1391"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790449"><a href="#local-6989586621681790449"><span class="hs-identifier">env0</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790450"><a href="#local-6989586621681790450"><span class="hs-identifier">new_tyvars</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTyBndrsX"><span class="hs-identifier hs-var">zonkTyBndrsX</span></a><span> </span><a href="#local-6989586621681790437"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790440"><span class="hs-identifier hs-var">tyvars</span></a><span>
</span><a name="line-1392"></a><span>          </span><span class="hs-comment">-- Must zonk the existential variables, because their</span><span>
</span><a name="line-1393"></a><span>          </span><span class="hs-comment">-- /kind/ need potential zonking.</span><span>
</span><a name="line-1394"></a><span>          </span><span class="hs-comment">-- cf typecheck/should_compile/tc221.hs</span><span>
</span><a name="line-1395"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790451"><a href="#local-6989586621681790451"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790452"><a href="#local-6989586621681790452"><span class="hs-identifier">new_evs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvBndrsX"><span class="hs-identifier hs-var">zonkEvBndrsX</span></a><span> </span><a href="#local-6989586621681790449"><span class="hs-identifier hs-var">env0</span></a><span> </span><a href="#local-6989586621681790441"><span class="hs-identifier hs-var">evs</span></a><span>
</span><a name="line-1396"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790453"><a href="#local-6989586621681790453"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790454"><a href="#local-6989586621681790454"><span class="hs-identifier">new_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcEvBinds"><span class="hs-identifier hs-var">zonkTcEvBinds</span></a><span> </span><a href="#local-6989586621681790451"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790442"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-1397"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790455"><a href="#local-6989586621681790455"><span class="hs-identifier">env3</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790456"><a href="#local-6989586621681790456"><span class="hs-identifier">new_wrapper</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681790453"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790444"><span class="hs-identifier hs-var">wrapper</span></a><span>
</span><a name="line-1398"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790457"><a href="#local-6989586621681790457"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790458"><a href="#local-6989586621681790458"><span class="hs-identifier">new_args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkConStuff"><span class="hs-identifier hs-var">zonkConStuff</span></a><span> </span><a href="#local-6989586621681790455"><span class="hs-identifier hs-var">env3</span></a><span> </span><a href="#local-6989586621681790443"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-1399"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790457"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790438"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_arg_tys</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790447"><span class="hs-identifier hs-var">new_tys</span></a><span class="hs-special">,</span><span>
</span><a name="line-1400"></a><span>                            </span><span class="hs-identifier">pat_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790450"><span class="hs-identifier hs-var">new_tyvars</span></a><span class="hs-special">,</span><span>
</span><a name="line-1401"></a><span>                            </span><span class="hs-identifier">pat_dicts</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790452"><span class="hs-identifier hs-var">new_evs</span></a><span class="hs-special">,</span><span>
</span><a name="line-1402"></a><span>                            </span><span class="hs-identifier">pat_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790454"><span class="hs-identifier hs-var">new_binds</span></a><span class="hs-special">,</span><span>
</span><a name="line-1403"></a><span>                            </span><span class="hs-identifier">pat_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790458"><span class="hs-identifier hs-var">new_args</span></a><span class="hs-special">,</span><span>
</span><a name="line-1404"></a><span>                            </span><span class="hs-identifier">pat_wrap</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790456"><span class="hs-identifier hs-var">new_wrapper</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1405"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1406"></a><span>    </span><a name="local-6989586621681790446"><a href="#local-6989586621681790446"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In the type of an element of an unboxed tuple pattern:&quot;</span><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681790438"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-1407"></a><span>
</span><a name="line-1408"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790459"><a href="#local-6989586621681790459"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LitPat</span><span> </span><a name="local-6989586621681790460"><a href="#local-6989586621681790460"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790461"><a href="#local-6989586621681790461"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790459"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">LitPat</span><span> </span><a href="#local-6989586621681790460"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790461"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-1409"></a><span>
</span><a name="line-1410"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790462"><a href="#local-6989586621681790462"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SigPat</span><span> </span><a name="local-6989586621681790463"><a href="#local-6989586621681790463"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681790464"><a href="#local-6989586621681790464"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621681790465"><a href="#local-6989586621681790465"><span class="hs-identifier">hs_ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1411"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790466"><a href="#local-6989586621681790466"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790462"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790463"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1412"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790467"><a href="#local-6989586621681790467"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790468"><a href="#local-6989586621681790468"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790462"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790464"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1413"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790467"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">SigPat</span><span> </span><a href="#local-6989586621681790466"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681790468"><span class="hs-identifier hs-var">pat'</span></a><span> </span><a href="#local-6989586621681790465"><span class="hs-identifier hs-var">hs_ty</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1414"></a><span>
</span><a name="line-1415"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790469"><a href="#local-6989586621681790469"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NPat</span><span> </span><a name="local-6989586621681790470"><a href="#local-6989586621681790470"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790471"><a href="#local-6989586621681790471"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681790472"><a href="#local-6989586621681790472"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681790473"><a href="#local-6989586621681790473"><span class="hs-identifier">mb_neg</span></a></a><span> </span><a name="local-6989586621681790474"><a href="#local-6989586621681790474"><span class="hs-identifier">eq_expr</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1416"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790475"><a href="#local-6989586621681790475"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790476"><a href="#local-6989586621681790476"><span class="hs-identifier">eq_expr'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790469"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790474"><span class="hs-identifier hs-var">eq_expr</span></a><span>
</span><a name="line-1417"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790478"><a href="#local-6989586621681790478"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790479"><a href="#local-6989586621681790479"><span class="hs-identifier">mb_neg'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681790473"><span class="hs-identifier hs-var">mb_neg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1418"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790475"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-1419"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681790477"><a href="#local-6989586621681790477"><span class="hs-identifier">n</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790475"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790477"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1420"></a><span>
</span><a name="line-1421"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790480"><a href="#local-6989586621681790480"><span class="hs-identifier">lit'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkOverLit"><span class="hs-identifier hs-var">zonkOverLit</span></a><span> </span><a href="#local-6989586621681790478"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790472"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1422"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790481"><a href="#local-6989586621681790481"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790478"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790470"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1423"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790478"><span class="hs-identifier hs-var">env2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">NPat</span><span> </span><a href="#local-6989586621681790481"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790471"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681790480"><span class="hs-identifier hs-var">lit'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790479"><span class="hs-identifier hs-var">mb_neg'</span></a><span> </span><a href="#local-6989586621681790476"><span class="hs-identifier hs-var">eq_expr'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1424"></a><span>
</span><a name="line-1425"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790482"><a href="#local-6989586621681790482"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NPlusKPat</span><span> </span><a name="local-6989586621681790483"><a href="#local-6989586621681790483"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790484"><a href="#local-6989586621681790484"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621681790485"><a href="#local-6989586621681790485"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790486"><a href="#local-6989586621681790486"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681790487"><a href="#local-6989586621681790487"><span class="hs-identifier">lit1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681790488"><a href="#local-6989586621681790488"><span class="hs-identifier">lit2</span></a></a><span> </span><a name="local-6989586621681790489"><a href="#local-6989586621681790489"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621681790490"><a href="#local-6989586621681790490"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1426"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790491"><a href="#local-6989586621681790491"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790492"><a href="#local-6989586621681790492"><span class="hs-identifier">e1'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790482"><span class="hs-identifier hs-var">env</span></a><span>  </span><a href="#local-6989586621681790489"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-1427"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790493"><a href="#local-6989586621681790493"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790494"><a href="#local-6989586621681790494"><span class="hs-identifier">e2'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkSyntaxExpr"><span class="hs-identifier hs-var">zonkSyntaxExpr</span></a><span> </span><a href="#local-6989586621681790491"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790490"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1428"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790495"><a href="#local-6989586621681790495"><span class="hs-identifier">n'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681790493"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790485"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1429"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790496"><a href="#local-6989586621681790496"><span class="hs-identifier">lit1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkOverLit"><span class="hs-identifier hs-var">zonkOverLit</span></a><span> </span><a href="#local-6989586621681790493"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790487"><span class="hs-identifier hs-var">lit1</span></a><span>
</span><a name="line-1430"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790497"><a href="#local-6989586621681790497"><span class="hs-identifier">lit2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkOverLit"><span class="hs-identifier hs-var">zonkOverLit</span></a><span> </span><a href="#local-6989586621681790493"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790488"><span class="hs-identifier hs-var">lit2</span></a><span>
</span><a name="line-1431"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790498"><a href="#local-6989586621681790498"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790493"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790483"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1432"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#extendIdZonkEnv1"><span class="hs-identifier hs-var">extendIdZonkEnv1</span></a><span> </span><a href="#local-6989586621681790493"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790495"><span class="hs-identifier hs-var">n'</span></a><span class="hs-special">,</span><span>
</span><a name="line-1433"></a><span>                  </span><span class="hs-identifier hs-var">NPlusKPat</span><span> </span><a href="#local-6989586621681790498"><span class="hs-identifier hs-var">ty'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790484"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621681790495"><span class="hs-identifier hs-var">n'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790486"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621681790496"><span class="hs-identifier hs-var">lit1'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790497"><span class="hs-identifier hs-var">lit2'</span></a><span> </span><a href="#local-6989586621681790492"><span class="hs-identifier hs-var">e1'</span></a><span> </span><a href="#local-6989586621681790494"><span class="hs-identifier hs-var">e2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1434"></a><span>
</span><a name="line-1435"></a><span class="hs-identifier">zonk_pat</span><span> </span><a name="local-6989586621681790499"><a href="#local-6989586621681790499"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoPat</span><span> </span><a name="local-6989586621681790500"><a href="#local-6989586621681790500"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621681790501"><a href="#local-6989586621681790501"><span class="hs-identifier">co_fn</span></a></a><span> </span><a name="local-6989586621681790502"><a href="#local-6989586621681790502"><span class="hs-identifier">pat</span></a></a><span> </span><a name="local-6989586621681790503"><a href="#local-6989586621681790503"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1436"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790504"><a href="#local-6989586621681790504"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790505"><a href="#local-6989586621681790505"><span class="hs-identifier">co_fn'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoFn"><span class="hs-identifier hs-var">zonkCoFn</span></a><span> </span><a href="#local-6989586621681790499"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790501"><span class="hs-identifier hs-var">co_fn</span></a><span>
</span><a name="line-1437"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790506"><a href="#local-6989586621681790506"><span class="hs-identifier">env''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790507"><a href="#local-6989586621681790507"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790504"><span class="hs-identifier hs-var">env'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">noLoc</span><span> </span><a href="#local-6989586621681790502"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>
</span><a name="line-1438"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790508"><a href="#local-6989586621681790508"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790506"><span class="hs-identifier hs-var">env''</span></a><span> </span><a href="#local-6989586621681790503"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1439"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790506"><span class="hs-identifier hs-var">env''</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">CoPat</span><span> </span><a href="#local-6989586621681790500"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621681790505"><span class="hs-identifier hs-var">co_fn'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621681790507"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790508"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1440"></a><span>
</span><a name="line-1441"></a><span class="hs-identifier">zonk_pat</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681790509"><a href="#local-6989586621681790509"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;zonk_pat&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681790509"><span class="hs-identifier hs-var">pat</span></a><span class="hs-special">)</span><span>
</span><a name="line-1442"></a><span>
</span><a name="line-1443"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1444"></a><span class="hs-identifier">zonkConStuff</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span>
</span><a name="line-1445"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsConDetails</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OutPat</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsRecFields</span><span> </span><a href="#local-6989586621681789443"><span class="hs-identifier hs-type">id</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OutPat</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1446"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-1447"></a><span>                    </span><span class="hs-identifier hs-type">HsConDetails</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OutPat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsRecFields</span><span> </span><a href="#local-6989586621681789443"><span class="hs-identifier hs-type">id</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OutPat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1448"></a><a name="zonkConStuff"><a href="TcHsSyn.html#zonkConStuff"><span class="hs-identifier">zonkConStuff</span></a></a><span> </span><a name="local-6989586621681790510"><a href="#local-6989586621681790510"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PrefixCon</span><span> </span><a name="local-6989586621681790511"><a href="#local-6989586621681790511"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1449"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790512"><a href="#local-6989586621681790512"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790513"><a href="#local-6989586621681790513"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPats"><span class="hs-identifier hs-var">zonkPats</span></a><span> </span><a href="#local-6989586621681790510"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790511"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-1450"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790512"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">PrefixCon</span><span> </span><a href="#local-6989586621681790513"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1451"></a><span>
</span><a name="line-1452"></a><span class="hs-identifier">zonkConStuff</span><span> </span><a name="local-6989586621681790514"><a href="#local-6989586621681790514"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a name="local-6989586621681790515"><a href="#local-6989586621681790515"><span class="hs-identifier">p1</span></a></a><span> </span><a name="local-6989586621681790516"><a href="#local-6989586621681790516"><span class="hs-identifier">p2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1453"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790517"><a href="#local-6989586621681790517"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790518"><a href="#local-6989586621681790518"><span class="hs-identifier">p1'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790514"><span class="hs-identifier hs-var">env</span></a><span>  </span><a href="#local-6989586621681790515"><span class="hs-identifier hs-var">p1</span></a><span>
</span><a name="line-1454"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790519"><a href="#local-6989586621681790519"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790520"><a href="#local-6989586621681790520"><span class="hs-identifier">p2'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790517"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790516"><span class="hs-identifier hs-var">p2</span></a><span>
</span><a name="line-1455"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790519"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a href="#local-6989586621681790518"><span class="hs-identifier hs-var">p1'</span></a><span> </span><a href="#local-6989586621681790520"><span class="hs-identifier hs-var">p2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1456"></a><span>
</span><a name="line-1457"></a><span class="hs-identifier">zonkConStuff</span><span> </span><a name="local-6989586621681790521"><a href="#local-6989586621681790521"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFields</span><span> </span><a name="local-6989586621681790522"><a href="#local-6989586621681790522"><span class="hs-identifier">rpats</span></a></a><span> </span><a name="local-6989586621681790523"><a href="#local-6989586621681790523"><span class="hs-identifier">dd</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1458"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790524"><a href="#local-6989586621681790524"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790525"><a href="#local-6989586621681790525"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPats"><span class="hs-identifier hs-var">zonkPats</span></a><span> </span><a href="#local-6989586621681790521"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">hsRecFieldArg</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790522"><span class="hs-identifier hs-var">rpats</span></a><span class="hs-special">)</span><span>
</span><a name="line-1459"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790526"><a href="#local-6989586621681790526"><span class="hs-identifier">rpats'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790527"><a href="#local-6989586621681790527"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621681790528"><a href="#local-6989586621681790528"><span class="hs-identifier">rp</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621681790529"><a href="#local-6989586621681790529"><span class="hs-identifier">p'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1460"></a><span>                                  </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790527"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790528"><span class="hs-identifier hs-var">rp</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsRecFieldArg</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790529"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1461"></a><span>                               </span><a href="#local-6989586621681790522"><span class="hs-identifier hs-var">rpats</span></a><span> </span><a href="#local-6989586621681790525"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-1462"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790524"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">RecCon</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRecFields</span><span> </span><a href="#local-6989586621681790526"><span class="hs-identifier hs-var">rpats'</span></a><span> </span><a href="#local-6989586621681790523"><span class="hs-identifier hs-var">dd</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1463"></a><span>        </span><span class="hs-comment">-- Field selectors have declared types; hence no zonking</span><span>
</span><a name="line-1464"></a><span>
</span><a name="line-1465"></a><span class="hs-comment">---------------------------</span><span>
</span><a name="line-1466"></a><span class="hs-identifier">zonkPats</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">OutPat</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">OutPat</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1467"></a><a name="zonkPats"><a href="TcHsSyn.html#zonkPats"><span class="hs-identifier">zonkPats</span></a></a><span> </span><a name="local-6989586621681790530"><a href="#local-6989586621681790530"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790530"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1468"></a><span class="hs-identifier">zonkPats</span><span> </span><a name="local-6989586621681790531"><a href="#local-6989586621681790531"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681790532"><a href="#local-6989586621681790532"><span class="hs-identifier">pat</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621681790533"><a href="#local-6989586621681790533"><span class="hs-identifier">pats</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790534"><a href="#local-6989586621681790534"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790535"><a href="#local-6989586621681790535"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPat"><span class="hs-identifier hs-var">zonkPat</span></a><span> </span><a href="#local-6989586621681790531"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790532"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-1469"></a><span>                             </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790536"><a href="#local-6989586621681790536"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790537"><a href="#local-6989586621681790537"><span class="hs-identifier">pats'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkPats"><span class="hs-identifier hs-var">zonkPats</span></a><span> </span><a href="#local-6989586621681790534"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790533"><span class="hs-identifier hs-var">pats</span></a><span>
</span><a name="line-1470"></a><span>                             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790536"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790535"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-glyph">:</span><a href="#local-6989586621681790537"><span class="hs-identifier hs-var">pats'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1471"></a><span>
</span><a name="line-1472"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection[BackSubst-Foreign]{Foreign exports}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1479"></a><span>
</span><a name="line-1480"></a><span class="hs-identifier">zonkForeignExports</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LForeignDecl</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">]</span><span>
</span><a name="line-1481"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LForeignDecl</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span>
</span><a name="line-1482"></a><a name="zonkForeignExports"><a href="TcHsSyn.html#zonkForeignExports"><span class="hs-identifier">zonkForeignExports</span></a></a><span> </span><a name="local-6989586621681790538"><a href="#local-6989586621681790538"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790539"><a href="#local-6989586621681790539"><span class="hs-identifier">ls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkForeignExport"><span class="hs-identifier hs-var">zonkForeignExport</span></a><span> </span><a href="#local-6989586621681790538"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790539"><span class="hs-identifier hs-var">ls</span></a><span>
</span><a name="line-1483"></a><span>
</span><a name="line-1484"></a><span class="hs-identifier">zonkForeignExport</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ForeignDecl</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ForeignDecl</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-1485"></a><a name="zonkForeignExport"><a href="TcHsSyn.html#zonkForeignExport"><span class="hs-identifier">zonkForeignExport</span></a></a><span> </span><a name="local-6989586621681790540"><a href="#local-6989586621681790540"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForeignExport</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fd_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790541"><a href="#local-6989586621681790541"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_e_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790542"><a href="#local-6989586621681790542"><span class="hs-identifier">co</span></a></a><span>
</span><a name="line-1486"></a><span>                                     </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_fe</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790543"><a href="#local-6989586621681790543"><span class="hs-identifier">spec</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1487"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ForeignExport</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fd_name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkLIdOcc"><span class="hs-identifier hs-var">zonkLIdOcc</span></a><span> </span><a href="#local-6989586621681790540"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790541"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-1488"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_sig_ty</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_e_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790542"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1489"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fd_fe</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790543"><span class="hs-identifier hs-var">spec</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1490"></a><span class="hs-identifier">zonkForeignExport</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621681790544"><a href="#local-6989586621681790544"><span class="hs-identifier">for_imp</span></a></a><span>
</span><a name="line-1491"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681790544"><span class="hs-identifier hs-var">for_imp</span></a><span>     </span><span class="hs-comment">-- Foreign imports don't need zonking</span><span>
</span><a name="line-1492"></a><span>
</span><a name="line-1493"></a><span class="hs-identifier">zonkRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LRuleDecl</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LRuleDecl</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">]</span><span>
</span><a name="line-1494"></a><a name="zonkRules"><a href="TcHsSyn.html#zonkRules"><span class="hs-identifier">zonkRules</span></a></a><span> </span><a name="local-6989586621681790545"><a href="#local-6989586621681790545"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790546"><a href="#local-6989586621681790546"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkRule"><span class="hs-identifier hs-var">zonkRule</span></a><span> </span><a href="#local-6989586621681790545"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790546"><span class="hs-identifier hs-var">rs</span></a><span>
</span><a name="line-1495"></a><span>
</span><a name="line-1496"></a><span class="hs-identifier">zonkRule</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RuleDecl</span><span> </span><span class="hs-identifier hs-type">GhcTcId</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">RuleDecl</span><span> </span><span class="hs-identifier hs-type">GhcTc</span><span class="hs-special">)</span><span>
</span><a name="line-1497"></a><a name="zonkRule"><a href="TcHsSyn.html#zonkRule"><span class="hs-identifier">zonkRule</span></a></a><span> </span><a name="local-6989586621681790547"><a href="#local-6989586621681790547"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790548"><a href="#local-6989586621681790548"><span class="hs-identifier">rule</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsRule</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rd_tmvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790549"><a href="#local-6989586621681790549"><span class="hs-identifier">tm_bndrs</span></a></a><span class="hs-comment">{-::[RuleBndr TcId]-}</span><span>
</span><a name="line-1498"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rd_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790550"><a href="#local-6989586621681790550"><span class="hs-identifier">lhs</span></a></a><span>
</span><a name="line-1499"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rd_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790551"><a href="#local-6989586621681790551"><span class="hs-identifier">rhs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1500"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790564"><a href="#local-6989586621681790564"><span class="hs-identifier">env_inside</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790565"><a href="#local-6989586621681790565"><span class="hs-identifier">new_tm_bndrs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapAccumLM</span><span> </span><a href="#local-6989586621681790552"><span class="hs-identifier hs-var">zonk_tm_bndr</span></a><span> </span><a href="#local-6989586621681790547"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790549"><span class="hs-identifier hs-var">tm_bndrs</span></a><span>
</span><a name="line-1501"></a><span>
</span><a name="line-1502"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790566"><a href="#local-6989586621681790566"><span class="hs-identifier">env_lhs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#setZonkType"><span class="hs-identifier hs-var">setZonkType</span></a><span> </span><a href="#local-6989586621681790564"><span class="hs-identifier hs-var">env_inside</span></a><span> </span><a href="TcHsSyn.html#SkolemiseFlexi"><span class="hs-identifier hs-var">SkolemiseFlexi</span></a><span>
</span><a name="line-1503"></a><span>              </span><span class="hs-comment">-- See Note [Zonking the LHS of a RULE]</span><span>
</span><a name="line-1504"></a><span>
</span><a name="line-1505"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790567"><a href="#local-6989586621681790567"><span class="hs-identifier">new_lhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790566"><span class="hs-identifier hs-var">env_lhs</span></a><span>    </span><a href="#local-6989586621681790550"><span class="hs-identifier hs-var">lhs</span></a><span>
</span><a name="line-1506"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790568"><a href="#local-6989586621681790568"><span class="hs-identifier">new_rhs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkLExpr"><span class="hs-identifier hs-var">zonkLExpr</span></a><span> </span><a href="#local-6989586621681790564"><span class="hs-identifier hs-var">env_inside</span></a><span> </span><a href="#local-6989586621681790551"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1507"></a><span>
</span><a name="line-1508"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621681790548"><span class="hs-identifier hs-var">rule</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rd_tmvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790565"><span class="hs-identifier hs-var">new_tm_bndrs</span></a><span>
</span><a name="line-1509"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rd_lhs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790567"><span class="hs-identifier hs-var">new_lhs</span></a><span>
</span><a name="line-1510"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">rd_rhs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790568"><span class="hs-identifier hs-var">new_rhs</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1511"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1512"></a><span>   </span><a name="local-6989586621681790552"><a href="#local-6989586621681790552"><span class="hs-identifier">zonk_tm_bndr</span></a></a><span> </span><a name="local-6989586621681790554"><a href="#local-6989586621681790554"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790555"><a href="#local-6989586621681790555"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RuleBndr</span><span> </span><a name="local-6989586621681790556"><a href="#local-6989586621681790556"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621681790557"><a href="#local-6989586621681790557"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621681790558"><a href="#local-6989586621681790558"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1513"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790559"><a href="#local-6989586621681790559"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790560"><a href="#local-6989586621681790560"><span class="hs-identifier">v'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790553"><span class="hs-identifier hs-var">zonk_it</span></a><span> </span><a href="#local-6989586621681790554"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790558"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1514"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790559"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790555"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RuleBndr</span><span> </span><a href="#local-6989586621681790556"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cL</span><span> </span><a href="#local-6989586621681790557"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621681790560"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1515"></a><span>   </span><span class="hs-identifier">zonk_tm_bndr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RuleBndrSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonk_tm_bndr RuleBndrSig&quot;</span><span>
</span><a name="line-1516"></a><span>   </span><span class="hs-identifier">zonk_tm_bndr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dL</span><span class="hs-glyph">-&gt;</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XRuleBndr</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonk_tm_bndr XRuleBndr&quot;</span><span>
</span><a name="line-1517"></a><span>   </span><span class="hs-identifier">zonk_tm_bndr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonk_tm_bndr: Impossible Match&quot;</span><span>
</span><a name="line-1518"></a><span>                            </span><span class="hs-comment">-- due to #15884</span><span>
</span><a name="line-1519"></a><span>
</span><a name="line-1520"></a><span>   </span><a name="local-6989586621681790553"><a href="#local-6989586621681790553"><span class="hs-identifier">zonk_it</span></a></a><span> </span><a name="local-6989586621681790561"><a href="#local-6989586621681790561"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790562"><a href="#local-6989586621681790562"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-1521"></a><span>     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isId</span><span> </span><a href="#local-6989586621681790562"><span class="hs-identifier hs-var">v</span></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790563"><a href="#local-6989586621681790563"><span class="hs-identifier">v'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681790561"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790562"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1522"></a><span>                       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier hs-var">extendIdZonkEnvRec</span></a><span> </span><a href="#local-6989586621681790561"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621681790563"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790563"><span class="hs-identifier hs-var">v'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1523"></a><span>     </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isImmutableTyVar</span><span> </span><span class="hs-identifier hs-var">v</span><span class="hs-special">)</span><span>
</span><a name="line-1524"></a><span>                    </span><a href="TcHsSyn.html#zonkTyBndrX"><span class="hs-identifier hs-var">zonkTyBndrX</span></a><span> </span><a href="#local-6989586621681790561"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790562"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1525"></a><span>                    </span><span class="hs-comment">-- DV: used to be return (env,v) but that is plain</span><span>
</span><a name="line-1526"></a><span>                    </span><span class="hs-comment">-- wrong because we may need to go inside the kind</span><span>
</span><a name="line-1527"></a><span>                    </span><span class="hs-comment">-- of v and zonk there!</span><span>
</span><a name="line-1528"></a><span class="hs-identifier">zonkRule</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XRuleDecl</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;zonkRule&quot;</span><span>
</span><a name="line-1529"></a><span>
</span><a name="line-1530"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
              Constraints and evidence
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1537"></a><span>
</span><a name="line-1538"></a><span class="hs-identifier">zonkEvTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EvTerm</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">EvTerm</span><span>
</span><a name="line-1539"></a><a name="zonkEvTerm"><a href="TcHsSyn.html#zonkEvTerm"><span class="hs-identifier">zonkEvTerm</span></a></a><span> </span><a name="local-6989586621681790569"><a href="#local-6989586621681790569"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvExpr</span><span> </span><a name="local-6989586621681790570"><a href="#local-6989586621681790570"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1540"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EvExpr</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790569"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790570"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1541"></a><span class="hs-identifier">zonkEvTerm</span><span> </span><a name="local-6989586621681790571"><a href="#local-6989586621681790571"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvTypeable</span><span> </span><a name="local-6989586621681790572"><a href="#local-6989586621681790572"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681790573"><a href="#local-6989586621681790573"><span class="hs-identifier">ev</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1542"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">EvTypeable</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790571"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790572"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="TcHsSyn.html#zonkEvTypeable"><span class="hs-identifier hs-var">zonkEvTypeable</span></a><span> </span><a href="#local-6989586621681790571"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790573"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-1543"></a><span class="hs-identifier">zonkEvTerm</span><span> </span><a name="local-6989586621681790574"><a href="#local-6989586621681790574"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvFun</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">et_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790575"><a href="#local-6989586621681790575"><span class="hs-identifier">tvs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">et_given</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790576"><a href="#local-6989586621681790576"><span class="hs-identifier">evs</span></a></a><span>
</span><a name="line-1544"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">et_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790577"><a href="#local-6989586621681790577"><span class="hs-identifier">ev_binds</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">et_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790578"><a href="#local-6989586621681790578"><span class="hs-identifier">body_id</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1545"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790579"><a href="#local-6989586621681790579"><span class="hs-identifier">env0</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790580"><a href="#local-6989586621681790580"><span class="hs-identifier">new_tvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTyBndrsX"><span class="hs-identifier hs-var">zonkTyBndrsX</span></a><span> </span><a href="#local-6989586621681790574"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790575"><span class="hs-identifier hs-var">tvs</span></a><span>
</span><a name="line-1546"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790581"><a href="#local-6989586621681790581"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790582"><a href="#local-6989586621681790582"><span class="hs-identifier">new_evs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvBndrsX"><span class="hs-identifier hs-var">zonkEvBndrsX</span></a><span> </span><a href="#local-6989586621681790579"><span class="hs-identifier hs-var">env0</span></a><span> </span><a href="#local-6989586621681790576"><span class="hs-identifier hs-var">evs</span></a><span>
</span><a name="line-1547"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790583"><a href="#local-6989586621681790583"><span class="hs-identifier">env2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790584"><a href="#local-6989586621681790584"><span class="hs-identifier">new_ev_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcEvBinds"><span class="hs-identifier hs-var">zonkTcEvBinds</span></a><span> </span><a href="#local-6989586621681790581"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790577"><span class="hs-identifier hs-var">ev_binds</span></a><span>
</span><a name="line-1548"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790585"><a href="#local-6989586621681790585"><span class="hs-identifier">new_body_id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkIdOcc"><span class="hs-identifier hs-var">zonkIdOcc</span></a><span> </span><a href="#local-6989586621681790583"><span class="hs-identifier hs-var">env2</span></a><span> </span><a href="#local-6989586621681790578"><span class="hs-identifier hs-var">body_id</span></a><span>
</span><a name="line-1549"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvFun</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">et_tvs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790580"><span class="hs-identifier hs-var">new_tvs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">et_given</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790582"><span class="hs-identifier hs-var">new_evs</span></a><span>
</span><a name="line-1550"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">et_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790584"><span class="hs-identifier hs-var">new_ev_binds</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">et_body</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790585"><span class="hs-identifier hs-var">new_body_id</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1551"></a><span>
</span><a name="line-1552"></a><span class="hs-identifier">zonkCoreExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span>
</span><a name="line-1553"></a><a name="zonkCoreExpr"><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier">zonkCoreExpr</span></a></a><span> </span><a name="local-6989586621681790586"><a href="#local-6989586621681790586"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><a name="local-6989586621681790587"><a href="#local-6989586621681790587"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1554"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isCoVar</span><span> </span><a href="#local-6989586621681790587"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1555"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Coercion</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoVarOcc"><span class="hs-identifier hs-var">zonkCoVarOcc</span></a><span> </span><a href="#local-6989586621681790586"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790587"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1556"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1557"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Var</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcHsSyn.html#zonkIdOcc"><span class="hs-identifier hs-var">zonkIdOcc</span></a><span> </span><a href="#local-6989586621681790586"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790587"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-1558"></a><span class="hs-identifier">zonkCoreExpr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lit</span><span> </span><a name="local-6989586621681790588"><a href="#local-6989586621681790588"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1559"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Lit</span><span> </span><a href="#local-6989586621681790588"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-1560"></a><span class="hs-identifier">zonkCoreExpr</span><span> </span><a name="local-6989586621681790589"><a href="#local-6989586621681790589"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Coercion</span><span> </span><a name="local-6989586621681790590"><a href="#local-6989586621681790590"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1561"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Coercion</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoToCo"><span class="hs-identifier hs-var">zonkCoToCo</span></a><span> </span><a href="#local-6989586621681790589"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790590"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1562"></a><span class="hs-identifier">zonkCoreExpr</span><span> </span><a name="local-6989586621681790591"><a href="#local-6989586621681790591"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Type</span><span> </span><a name="local-6989586621681790592"><a href="#local-6989586621681790592"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1563"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Type</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790591"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790592"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1564"></a><span>
</span><a name="line-1565"></a><span class="hs-identifier">zonkCoreExpr</span><span> </span><a name="local-6989586621681790593"><a href="#local-6989586621681790593"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Cast</span><span> </span><a name="local-6989586621681790594"><a href="#local-6989586621681790594"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621681790595"><a href="#local-6989586621681790595"><span class="hs-identifier">co</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1566"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Cast</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790593"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790594"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoToCo"><span class="hs-identifier hs-var">zonkCoToCo</span></a><span> </span><a href="#local-6989586621681790593"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790595"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1567"></a><span class="hs-identifier">zonkCoreExpr</span><span> </span><a name="local-6989586621681790596"><a href="#local-6989586621681790596"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Tick</span><span> </span><a name="local-6989586621681790597"><a href="#local-6989586621681790597"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621681790598"><a href="#local-6989586621681790598"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1568"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Tick</span><span> </span><a href="#local-6989586621681790597"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790596"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790598"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-comment">-- Do we need to zonk in ticks?</span><span>
</span><a name="line-1569"></a><span>
</span><a name="line-1570"></a><span class="hs-identifier">zonkCoreExpr</span><span> </span><a name="local-6989586621681790599"><a href="#local-6989586621681790599"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">App</span><span> </span><a name="local-6989586621681790600"><a href="#local-6989586621681790600"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621681790601"><a href="#local-6989586621681790601"><span class="hs-identifier">e2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1571"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">App</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790599"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790600"><span class="hs-identifier hs-var">e1</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790599"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790601"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1572"></a><span class="hs-identifier">zonkCoreExpr</span><span> </span><a name="local-6989586621681790602"><a href="#local-6989586621681790602"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Lam</span><span> </span><a name="local-6989586621681790603"><a href="#local-6989586621681790603"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621681790604"><a href="#local-6989586621681790604"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1573"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790605"><a href="#local-6989586621681790605"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790606"><a href="#local-6989586621681790606"><span class="hs-identifier">v'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoreBndrX"><span class="hs-identifier hs-var">zonkCoreBndrX</span></a><span> </span><a href="#local-6989586621681790602"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790603"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1574"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">Lam</span><span> </span><a href="#local-6989586621681790606"><span class="hs-identifier hs-var">v'</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790605"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790604"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1575"></a><span class="hs-identifier">zonkCoreExpr</span><span> </span><a name="local-6989586621681790607"><a href="#local-6989586621681790607"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Let</span><span> </span><a name="local-6989586621681790608"><a href="#local-6989586621681790608"><span class="hs-identifier">bind</span></a></a><span> </span><a name="local-6989586621681790609"><a href="#local-6989586621681790609"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1576"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790610"><a href="#local-6989586621681790610"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790611"><a href="#local-6989586621681790611"><span class="hs-identifier">bind'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoreBind"><span class="hs-identifier hs-var">zonkCoreBind</span></a><span> </span><a href="#local-6989586621681790607"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790608"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-1577"></a><span>         </span><span class="hs-identifier hs-var">Let</span><span> </span><a href="#local-6989586621681790611"><span class="hs-identifier hs-var">bind'</span></a><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790610"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790609"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1578"></a><span class="hs-identifier">zonkCoreExpr</span><span> </span><a name="local-6989586621681790612"><a href="#local-6989586621681790612"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Case</span><span> </span><a name="local-6989586621681790613"><a href="#local-6989586621681790613"><span class="hs-identifier">scrut</span></a></a><span> </span><a name="local-6989586621681790614"><a href="#local-6989586621681790614"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621681790615"><a href="#local-6989586621681790615"><span class="hs-identifier">ty</span></a></a><span> </span><a name="local-6989586621681790616"><a href="#local-6989586621681790616"><span class="hs-identifier">alts</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1579"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790617"><a href="#local-6989586621681790617"><span class="hs-identifier">scrut'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790612"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790613"><span class="hs-identifier hs-var">scrut</span></a><span>
</span><a name="line-1580"></a><span>         </span><a name="local-6989586621681790618"><a href="#local-6989586621681790618"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790612"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790615"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1581"></a><span>         </span><a name="local-6989586621681790619"><a href="#local-6989586621681790619"><span class="hs-identifier">b'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681790612"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790614"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-1582"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790620"><a href="#local-6989586621681790620"><span class="hs-identifier">env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#extendIdZonkEnv1"><span class="hs-identifier hs-var">extendIdZonkEnv1</span></a><span> </span><a href="#local-6989586621681790612"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790619"><span class="hs-identifier hs-var">b'</span></a><span>
</span><a name="line-1583"></a><span>         </span><a name="local-6989586621681790621"><a href="#local-6989586621681790621"><span class="hs-identifier">alts'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkCoreAlt"><span class="hs-identifier hs-var">zonkCoreAlt</span></a><span> </span><a href="#local-6989586621681790620"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790616"><span class="hs-identifier hs-var">alts</span></a><span>
</span><a name="line-1584"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Case</span><span> </span><a href="#local-6989586621681790617"><span class="hs-identifier hs-var">scrut'</span></a><span> </span><a href="#local-6989586621681790619"><span class="hs-identifier hs-var">b'</span></a><span> </span><a href="#local-6989586621681790618"><span class="hs-identifier hs-var">ty'</span></a><span> </span><a href="#local-6989586621681790621"><span class="hs-identifier hs-var">alts'</span></a><span>
</span><a name="line-1585"></a><span>
</span><a name="line-1586"></a><span class="hs-identifier">zonkCoreAlt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreAlt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">CoreAlt</span><span>
</span><a name="line-1587"></a><a name="zonkCoreAlt"><a href="TcHsSyn.html#zonkCoreAlt"><span class="hs-identifier">zonkCoreAlt</span></a></a><span> </span><a name="local-6989586621681790622"><a href="#local-6989586621681790622"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681790623"><a href="#local-6989586621681790623"><span class="hs-identifier">dc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790624"><a href="#local-6989586621681790624"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790625"><a href="#local-6989586621681790625"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1588"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790626"><a href="#local-6989586621681790626"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790627"><a href="#local-6989586621681790627"><span class="hs-identifier">bndrs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoreBndrsX"><span class="hs-identifier hs-var">zonkCoreBndrsX</span></a><span> </span><a href="#local-6989586621681790622"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790624"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-1589"></a><span>         </span><a name="local-6989586621681790628"><a href="#local-6989586621681790628"><span class="hs-identifier">rhs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790626"><span class="hs-identifier hs-var">env1</span></a><span> </span><a href="#local-6989586621681790625"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1590"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790623"><span class="hs-identifier hs-var">dc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790627"><span class="hs-identifier hs-var">bndrs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790628"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1591"></a><span>
</span><a name="line-1592"></a><span class="hs-identifier">zonkCoreBind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoreBind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CoreBind</span><span class="hs-special">)</span><span>
</span><a name="line-1593"></a><a name="zonkCoreBind"><a href="TcHsSyn.html#zonkCoreBind"><span class="hs-identifier">zonkCoreBind</span></a></a><span> </span><a name="local-6989586621681790629"><a href="#local-6989586621681790629"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NonRec</span><span> </span><a name="local-6989586621681790630"><a href="#local-6989586621681790630"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621681790631"><a href="#local-6989586621681790631"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1594"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621681790632"><a href="#local-6989586621681790632"><span class="hs-identifier">v'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681790629"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790630"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1595"></a><span>         </span><a name="local-6989586621681790633"><a href="#local-6989586621681790633"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790629"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790631"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1596"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790634"><a href="#local-6989586621681790634"><span class="hs-identifier">env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#extendIdZonkEnv1"><span class="hs-identifier hs-var">extendIdZonkEnv1</span></a><span> </span><a href="#local-6989586621681790629"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790632"><span class="hs-identifier hs-var">v'</span></a><span>
</span><a name="line-1597"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790634"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">NonRec</span><span> </span><a href="#local-6989586621681790632"><span class="hs-identifier hs-var">v'</span></a><span> </span><a href="#local-6989586621681790633"><span class="hs-identifier hs-var">e'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1598"></a><span class="hs-identifier">zonkCoreBind</span><span> </span><a name="local-6989586621681790635"><a href="#local-6989586621681790635"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Rec</span><span> </span><a name="local-6989586621681790636"><a href="#local-6989586621681790636"><span class="hs-identifier">pairs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1599"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790641"><a href="#local-6989586621681790641"><span class="hs-identifier">env1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790642"><a href="#local-6989586621681790642"><span class="hs-identifier">pairs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fixM</span><span> </span><a href="#local-6989586621681790637"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-1600"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790641"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Rec</span><span> </span><a href="#local-6989586621681790642"><span class="hs-identifier hs-var">pairs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1601"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1602"></a><span>    </span><a name="local-6989586621681790637"><a href="#local-6989586621681790637"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681790638"><a href="#local-6989586621681790638"><span class="hs-identifier">new_pairs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1603"></a><span>         </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790639"><a href="#local-6989586621681790639"><span class="hs-identifier">env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier hs-var">extendIdZonkEnvRec</span></a><span> </span><a href="#local-6989586621681790635"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621681790638"><span class="hs-identifier hs-var">new_pairs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1604"></a><span>         </span><a name="local-6989586621681790640"><a href="#local-6989586621681790640"><span class="hs-identifier">pairs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkCorePair"><span class="hs-identifier hs-var">zonkCorePair</span></a><span> </span><a href="#local-6989586621681790639"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790636"><span class="hs-identifier hs-var">pairs</span></a><span>
</span><a name="line-1605"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790639"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790640"><span class="hs-identifier hs-var">pairs'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1606"></a><span>
</span><a name="line-1607"></a><span class="hs-identifier">zonkCorePair</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CoreBndr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">CoreBndr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">CoreExpr</span><span class="hs-special">)</span><span>
</span><a name="line-1608"></a><a name="zonkCorePair"><a href="TcHsSyn.html#zonkCorePair"><span class="hs-identifier">zonkCorePair</span></a></a><span> </span><a name="local-6989586621681790643"><a href="#local-6989586621681790643"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681790644"><a href="#local-6989586621681790644"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><a name="local-6989586621681790645"><a href="#local-6989586621681790645"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="TcHsSyn.html#zonkIdBndr"><span class="hs-identifier hs-var">zonkIdBndr</span></a><span> </span><a href="#local-6989586621681790643"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790644"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="TcHsSyn.html#zonkCoreExpr"><span class="hs-identifier hs-var">zonkCoreExpr</span></a><span> </span><a href="#local-6989586621681790643"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790645"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1609"></a><span>
</span><a name="line-1610"></a><span class="hs-identifier">zonkEvTypeable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EvTypeable</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">EvTypeable</span><span>
</span><a name="line-1611"></a><a name="zonkEvTypeable"><a href="TcHsSyn.html#zonkEvTypeable"><span class="hs-identifier">zonkEvTypeable</span></a></a><span> </span><a name="local-6989586621681790646"><a href="#local-6989586621681790646"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvTypeableTyCon</span><span> </span><a name="local-6989586621681790647"><a href="#local-6989586621681790647"><span class="hs-identifier">tycon</span></a></a><span> </span><a name="local-6989586621681790648"><a href="#local-6989586621681790648"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1612"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790649"><a href="#local-6989586621681790649"><span class="hs-identifier">e'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkEvTerm"><span class="hs-identifier hs-var">zonkEvTerm</span></a><span> </span><a href="#local-6989586621681790646"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790648"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1613"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">EvTypeableTyCon</span><span> </span><a href="#local-6989586621681790647"><span class="hs-identifier hs-var">tycon</span></a><span> </span><a href="#local-6989586621681790649"><span class="hs-identifier hs-var">e'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1614"></a><span class="hs-identifier">zonkEvTypeable</span><span> </span><a name="local-6989586621681790650"><a href="#local-6989586621681790650"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvTypeableTyApp</span><span> </span><a name="local-6989586621681790651"><a href="#local-6989586621681790651"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681790652"><a href="#local-6989586621681790652"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1615"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790653"><a href="#local-6989586621681790653"><span class="hs-identifier">t1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvTerm"><span class="hs-identifier hs-var">zonkEvTerm</span></a><span> </span><a href="#local-6989586621681790650"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790651"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1616"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790654"><a href="#local-6989586621681790654"><span class="hs-identifier">t2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvTerm"><span class="hs-identifier hs-var">zonkEvTerm</span></a><span> </span><a href="#local-6989586621681790650"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790652"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1617"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvTypeableTyApp</span><span> </span><a href="#local-6989586621681790653"><span class="hs-identifier hs-var">t1'</span></a><span> </span><a href="#local-6989586621681790654"><span class="hs-identifier hs-var">t2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1618"></a><span class="hs-identifier">zonkEvTypeable</span><span> </span><a name="local-6989586621681790655"><a href="#local-6989586621681790655"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvTypeableTrFun</span><span> </span><a name="local-6989586621681790656"><a href="#local-6989586621681790656"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621681790657"><a href="#local-6989586621681790657"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1619"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790658"><a href="#local-6989586621681790658"><span class="hs-identifier">t1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvTerm"><span class="hs-identifier hs-var">zonkEvTerm</span></a><span> </span><a href="#local-6989586621681790655"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790656"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1620"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790659"><a href="#local-6989586621681790659"><span class="hs-identifier">t2'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvTerm"><span class="hs-identifier hs-var">zonkEvTerm</span></a><span> </span><a href="#local-6989586621681790655"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790657"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-1621"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvTypeableTrFun</span><span> </span><a href="#local-6989586621681790658"><span class="hs-identifier hs-var">t1'</span></a><span> </span><a href="#local-6989586621681790659"><span class="hs-identifier hs-var">t2'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1622"></a><span class="hs-identifier">zonkEvTypeable</span><span> </span><a name="local-6989586621681790660"><a href="#local-6989586621681790660"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvTypeableTyLit</span><span> </span><a name="local-6989586621681790661"><a href="#local-6989586621681790661"><span class="hs-identifier">t1</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1623"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790662"><a href="#local-6989586621681790662"><span class="hs-identifier">t1'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkEvTerm"><span class="hs-identifier hs-var">zonkEvTerm</span></a><span> </span><a href="#local-6989586621681790660"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790661"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-1624"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvTypeableTyLit</span><span> </span><a href="#local-6989586621681790662"><span class="hs-identifier hs-var">t1'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1625"></a><span>
</span><a name="line-1626"></a><span class="hs-identifier">zonkTcEvBinds_s</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TcEvBinds</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TcEvBinds</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1627"></a><a name="zonkTcEvBinds_s"><a href="TcHsSyn.html#zonkTcEvBinds_s"><span class="hs-identifier">zonkTcEvBinds_s</span></a></a><span> </span><a name="local-6989586621681790663"><a href="#local-6989586621681790663"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790664"><a href="#local-6989586621681790664"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790665"><a href="#local-6989586621681790665"><span class="hs-identifier">env</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790666"><a href="#local-6989586621681790666"><span class="hs-identifier">bs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapAccumLM</span><span> </span><a href="TcHsSyn.html#zonk_tc_ev_binds"><span class="hs-identifier hs-var">zonk_tc_ev_binds</span></a><span> </span><a href="#local-6989586621681790663"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790664"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-1628"></a><span>                            </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790665"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">EvBinds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unionManyBags</span><span> </span><a href="#local-6989586621681790666"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1629"></a><span>
</span><a name="line-1630"></a><span class="hs-identifier">zonkTcEvBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcEvBinds</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TcEvBinds</span><span class="hs-special">)</span><span>
</span><a name="line-1631"></a><a name="zonkTcEvBinds"><a href="TcHsSyn.html#zonkTcEvBinds"><span class="hs-identifier">zonkTcEvBinds</span></a></a><span> </span><a name="local-6989586621681790667"><a href="#local-6989586621681790667"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790668"><a href="#local-6989586621681790668"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790669"><a href="#local-6989586621681790669"><span class="hs-identifier">env'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790670"><a href="#local-6989586621681790670"><span class="hs-identifier">bs'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonk_tc_ev_binds"><span class="hs-identifier hs-var">zonk_tc_ev_binds</span></a><span> </span><a href="#local-6989586621681790667"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790668"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-1632"></a><span>                          </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790669"><span class="hs-identifier hs-var">env'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">EvBinds</span><span> </span><a href="#local-6989586621681790670"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1633"></a><span>
</span><a name="line-1634"></a><span class="hs-identifier">zonk_tc_ev_binds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcEvBinds</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvBind</span><span class="hs-special">)</span><span>
</span><a name="line-1635"></a><a name="zonk_tc_ev_binds"><a href="TcHsSyn.html#zonk_tc_ev_binds"><span class="hs-identifier">zonk_tc_ev_binds</span></a></a><span> </span><a name="local-6989586621681790671"><a href="#local-6989586621681790671"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TcEvBinds</span><span> </span><a name="local-6989586621681790672"><a href="#local-6989586621681790672"><span class="hs-identifier">var</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkEvBindsVar"><span class="hs-identifier hs-var">zonkEvBindsVar</span></a><span> </span><a href="#local-6989586621681790671"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790672"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-1636"></a><span class="hs-identifier">zonk_tc_ev_binds</span><span> </span><a name="local-6989586621681790673"><a href="#local-6989586621681790673"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvBinds</span><span> </span><a name="local-6989586621681790674"><a href="#local-6989586621681790674"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkEvBinds"><span class="hs-identifier hs-var">zonkEvBinds</span></a><span> </span><a href="#local-6989586621681790673"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790674"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-1637"></a><span>
</span><a name="line-1638"></a><span class="hs-identifier">zonkEvBindsVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EvBindsVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvBind</span><span class="hs-special">)</span><span>
</span><a name="line-1639"></a><a name="zonkEvBindsVar"><a href="TcHsSyn.html#zonkEvBindsVar"><span class="hs-identifier">zonkEvBindsVar</span></a></a><span> </span><a name="local-6989586621681790675"><a href="#local-6989586621681790675"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvBindsVar</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ebv_binds</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790676"><a href="#local-6989586621681790676"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1640"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790677"><a href="#local-6989586621681790677"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readMutVar</span><span> </span><a href="#local-6989586621681790676"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-1641"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="TcHsSyn.html#zonkEvBinds"><span class="hs-identifier hs-var">zonkEvBinds</span></a><span> </span><a href="#local-6989586621681790675"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">evBindMapBinds</span><span> </span><a href="#local-6989586621681790677"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1642"></a><span class="hs-identifier">zonkEvBindsVar</span><span> </span><a name="local-6989586621681790678"><a href="#local-6989586621681790678"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoEvBindsVar</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790678"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span class="hs-special">)</span><span>
</span><a name="line-1643"></a><span>
</span><a name="line-1644"></a><span class="hs-identifier">zonkEvBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvBind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvBind</span><span class="hs-special">)</span><span>
</span><a name="line-1645"></a><a name="zonkEvBinds"><a href="TcHsSyn.html#zonkEvBinds"><span class="hs-identifier">zonkEvBinds</span></a></a><span> </span><a name="local-6989586621681790679"><a href="#local-6989586621681790679"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790680"><a href="#local-6989586621681790680"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-1646"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;zonkEvBinds&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1647"></a><span>    </span><span class="hs-identifier hs-var">fixM</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621681790685"><a href="#local-6989586621681790685"><span class="hs-identifier">new_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1648"></a><span>         </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790686"><a href="#local-6989586621681790686"><span class="hs-identifier">env1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#extendIdZonkEnvRec"><span class="hs-identifier hs-var">extendIdZonkEnvRec</span></a><span> </span><a href="#local-6989586621681790679"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790681"><span class="hs-identifier hs-var">collect_ev_bndrs</span></a><span> </span><a href="#local-6989586621681790685"><span class="hs-identifier hs-var">new_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1649"></a><span>         </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790687"><a href="#local-6989586621681790687"><span class="hs-identifier">binds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapBagM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkEvBind"><span class="hs-identifier hs-var">zonkEvBind</span></a><span> </span><a href="#local-6989586621681790686"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790680"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-1650"></a><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790686"><span class="hs-identifier hs-var">env1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790687"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1651"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1652"></a><span>    </span><span class="hs-identifier">collect_ev_bndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-identifier hs-type">EvBind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">EvVar</span><span class="hs-special">]</span><span>
</span><a name="line-1653"></a><span>    </span><a name="local-6989586621681790681"><a href="#local-6989586621681790681"><span class="hs-identifier">collect_ev_bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldrBag</span><span> </span><a href="#local-6989586621681790682"><span class="hs-identifier hs-var">add</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1654"></a><span>    </span><a name="local-6989586621681790682"><a href="#local-6989586621681790682"><span class="hs-identifier">add</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eb_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790683"><a href="#local-6989586621681790683"><span class="hs-identifier">var</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681790684"><a href="#local-6989586621681790684"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790683"><span class="hs-identifier hs-var">var</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621681790684"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-1655"></a><span>
</span><a name="line-1656"></a><span class="hs-identifier">zonkEvBind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">EvBind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">EvBind</span><span>
</span><a name="line-1657"></a><a name="zonkEvBind"><a href="TcHsSyn.html#zonkEvBind"><span class="hs-identifier">zonkEvBind</span></a></a><span> </span><a name="local-6989586621681790688"><a href="#local-6989586621681790688"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790689"><a href="#local-6989586621681790689"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">EvBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eb_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790690"><a href="#local-6989586621681790690"><span class="hs-identifier">var</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">eb_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790691"><a href="#local-6989586621681790691"><span class="hs-identifier">term</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1658"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790692"><a href="#local-6989586621681790692"><span class="hs-identifier">var'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;zonkEvBndr&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="TcHsSyn.html#zonkEvBndr"><span class="hs-identifier hs-var">zonkEvBndr</span></a><span> </span><a href="#local-6989586621681790688"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790690"><span class="hs-identifier hs-var">var</span></a><span>
</span><a name="line-1659"></a><span>
</span><a name="line-1660"></a><span>         </span><span class="hs-comment">-- Optimise the common case of Refl coercions</span><span>
</span><a name="line-1661"></a><span>         </span><span class="hs-comment">-- See Note [Optimise coercion zonking]</span><span>
</span><a name="line-1662"></a><span>         </span><span class="hs-comment">-- This has a very big effect on some programs (eg Trac #5030)</span><span>
</span><a name="line-1663"></a><span>
</span><a name="line-1664"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790697"><a href="#local-6989586621681790697"><span class="hs-identifier">term'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">getEqPredTys_maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">idType</span><span> </span><a href="#local-6989586621681790692"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1665"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790693"><a href="#local-6989586621681790693"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790694"><a href="#local-6989586621681790694"><span class="hs-identifier">ty1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790695"><a href="#local-6989586621681790695"><span class="hs-identifier">ty2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621681790694"><span class="hs-identifier hs-var">ty1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">eqType</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621681790695"><span class="hs-identifier hs-var">ty2</span></a><span>
</span><a name="line-1666"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">evCoercion</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTcReflCo</span><span> </span><a href="#local-6989586621681790693"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621681790694"><span class="hs-identifier hs-var">ty1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1667"></a><span>           </span><a name="local-6989586621681790696"><a href="#local-6989586621681790696"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsSyn.html#zonkEvTerm"><span class="hs-identifier hs-var">zonkEvTerm</span></a><span> </span><a href="#local-6989586621681790688"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790691"><span class="hs-identifier hs-var">term</span></a><span>
</span><a name="line-1668"></a><span>
</span><a name="line-1669"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790689"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eb_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790692"><span class="hs-identifier hs-var">var'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">eb_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790697"><span class="hs-identifier hs-var">term'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1670"></a><span>
</span><a name="line-1671"></a><span class="hs-comment">{- Note [Optimise coercion zonking]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When optimising evidence binds we may come across situations where
a coercion looks like
      cv = ReflCo ty
or    cv1 = cv2
where the type 'ty' is big.  In such cases it is a waste of time to zonk both
  * The variable on the LHS
  * The coercion on the RHS
Rather, we can zonk the variable, and if its type is (ty ~ ty), we can just
use Refl on the right, ignoring the actual coercion on the RHS.

This can have a very big effect, because the constraint solver sometimes does go
to a lot of effort to prove Refl!  (Eg when solving  10+3 = 10+3; cf Trac #5030)


************************************************************************
*                                                                      *
                         Zonking types
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1693"></a><span>
</span><a name="line-1694"></a><span class="hs-comment">{- Note [Sharing when zonking to Type]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Problem:

    In TcMType.zonkTcTyVar, we short-circuit (Indirect ty) to
    (Indirect zty), see Note [Sharing in zonking] in TcMType. But we
    /can't/ do this when zonking a TcType to a Type (Trac #15552, esp
    comment:3).  Suppose we have

       alpha -&gt; alpha
         where
            alpha is already unified:
             alpha := T{tc-tycon} Int -&gt; Int
         and T is knot-tied

    By &quot;knot-tied&quot; I mean that the occurrence of T is currently a TcTyCon,
    but the global env contains a mapping &quot;T&quot; :-&gt; T{knot-tied-tc}. See
    Note [Type checking recursive type and class declarations] in
    TcTyClsDecls.

    Now we call zonkTcTypeToType on that (alpha -&gt; alpha). If we follow
    the same path as Note [Sharing in zonking] in TcMType, we'll
    update alpha to
       alpha := T{knot-tied-tc} Int -&gt; Int

    But alas, if we encounter alpha for a /second/ time, we end up
    looking at T{knot-tied-tc} and fall into a black hole. The whole
    point of zonkTcTypeToType is that it produces a type full of
    knot-tied tycons, and you must not look at the result!!

    To put it another way (zonkTcTypeToType . zonkTcTypeToType) is not
    the same as zonkTcTypeToType. (If we distinguished TcType from
    Type, this issue would have been a type error!)

Solution: (see Trac #15552 for other variants)

    One possible solution is simply not to do the short-circuiting.
    That has less sharing, but maybe sharing is rare. And indeed,
    that turns out to be viable from a perf point of view

    But the code implements something a bit better

    * ZonkEnv contains ze_meta_tv_env, which maps
          from a MetaTyVar (unificaion variable)
          to a Type (not a TcType)

    * In zonkTyVarOcc, we check this map to see if we have zonked
      this variable before. If so, use the previous answer; if not
      zonk it, and extend the map.

    * The map is of course stateful, held in a TcRef. (That is unlike
      the treatment of lexically-scoped variables in ze_tv_env and
      ze_id_env.

    Is the extra work worth it.  Some non-sytematic perf measurements
    suggest that compiler allocation is reduced overall (by 0.5% or so)
    but compile time really doesn't change.
-}</span><span>
</span><a name="line-1752"></a><span>
</span><a name="line-1753"></a><span class="hs-identifier">zonkTyVarOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">TcType</span><span>
</span><a name="line-1754"></a><a name="zonkTyVarOcc"><a href="TcHsSyn.html#zonkTyVarOcc"><span class="hs-identifier">zonkTyVarOcc</span></a></a><span> </span><a name="local-6989586621681790698"><a href="#local-6989586621681790698"><span class="hs-identifier">env</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_flexi</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790699"><a href="#local-6989586621681790699"><span class="hs-identifier">flexi</span></a></a><span>
</span><a name="line-1755"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ze_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790700"><a href="#local-6989586621681790700"><span class="hs-identifier">tv_env</span></a></a><span>
</span><a name="line-1756"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ze_meta_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790701"><a href="#local-6989586621681790701"><span class="hs-identifier">mtv_env_ref</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681790702"><a href="#local-6989586621681790702"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1757"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isTcTyVar</span><span> </span><a href="#local-6989586621681790702"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1758"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">tcTyVarDetails</span><span> </span><a href="#local-6989586621681790702"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1759"></a><span>      </span><span class="hs-identifier hs-var">SkolemTv</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681790703"><span class="hs-identifier hs-var">lookup_in_tv_env</span></a><span>
</span><a name="line-1760"></a><span>      </span><span class="hs-identifier hs-var">RuntimeUnk</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621681790703"><span class="hs-identifier hs-var">lookup_in_tv_env</span></a><span>
</span><a name="line-1761"></a><span>      </span><span class="hs-identifier hs-var">MetaTv</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mtv_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790717"><a href="#local-6989586621681790717"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1762"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790718"><a href="#local-6989586621681790718"><span class="hs-identifier">mtv_env</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-6989586621681790701"><span class="hs-identifier hs-var">mtv_env_ref</span></a><span>
</span><a name="line-1763"></a><span>                </span><span class="hs-comment">-- See Note [Sharing when zonking to Type]</span><span>
</span><a name="line-1764"></a><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookupVarEnv</span><span> </span><a href="#local-6989586621681790718"><span class="hs-identifier hs-var">mtv_env</span></a><span> </span><a href="#local-6989586621681790702"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1765"></a><span>                  </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681790719"><a href="#local-6989586621681790719"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681790719"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1766"></a><span>                  </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790720"><a href="#local-6989586621681790720"><span class="hs-identifier">mtv_details</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-6989586621681790717"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-1767"></a><span>                                </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621681790704"><span class="hs-identifier hs-var">zonk_meta</span></a><span> </span><a href="#local-6989586621681790718"><span class="hs-identifier hs-var">mtv_env</span></a><span> </span><a href="#local-6989586621681790717"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="#local-6989586621681790720"><span class="hs-identifier hs-var">mtv_details</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1768"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1769"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621681790703"><span class="hs-identifier hs-var">lookup_in_tv_env</span></a><span>
</span><a name="line-1770"></a><span>
</span><a name="line-1771"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1772"></a><span>    </span><a name="local-6989586621681790703"><a href="#local-6989586621681790703"><span class="hs-identifier">lookup_in_tv_env</span></a></a><span>    </span><span class="hs-comment">-- Look up in the env just as we do for Ids</span><span>
</span><a name="line-1773"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookupVarEnv</span><span> </span><a href="#local-6989586621681790700"><span class="hs-identifier hs-var">tv_env</span></a><span> </span><a href="#local-6989586621681790702"><span class="hs-identifier hs-var">tv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1774"></a><span>          </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkTyVarTy</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">updateTyVarKindM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790698"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790702"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1775"></a><span>          </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681790706"><a href="#local-6989586621681790706"><span class="hs-identifier">tv'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyVarTy</span><span> </span><a href="#local-6989586621681790706"><span class="hs-identifier hs-var">tv'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1776"></a><span>
</span><a name="line-1777"></a><span>    </span><a name="local-6989586621681790704"><a href="#local-6989586621681790704"><span class="hs-identifier">zonk_meta</span></a></a><span> </span><a name="local-6989586621681790707"><a href="#local-6989586621681790707"><span class="hs-identifier">mtv_env</span></a></a><span> </span><a name="local-6989586621681790708"><a href="#local-6989586621681790708"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-identifier hs-var">Flexi</span><span>
</span><a name="line-1778"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790709"><a href="#local-6989586621681790709"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790698"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">tyVarKind</span><span> </span><a href="#local-6989586621681790702"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1779"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790710"><a href="#local-6989586621681790710"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#commitFlexi"><span class="hs-identifier hs-var">commitFlexi</span></a><span> </span><a href="#local-6989586621681790699"><span class="hs-identifier hs-var">flexi</span></a><span> </span><a href="#local-6989586621681790702"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681790709"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-1780"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#writeMetaTyVarRef"><span class="hs-identifier hs-var">writeMetaTyVarRef</span></a><span> </span><a href="#local-6989586621681790702"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681790708"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="#local-6989586621681790710"><span class="hs-identifier hs-var">ty</span></a><span>  </span><span class="hs-comment">-- Belt and braces</span><span>
</span><a name="line-1781"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621681790705"><span class="hs-identifier hs-var">finish_meta</span></a><span> </span><a href="#local-6989586621681790707"><span class="hs-identifier hs-var">mtv_env</span></a><span> </span><a href="#local-6989586621681790710"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1782"></a><span>
</span><a name="line-1783"></a><span>    </span><span class="hs-identifier">zonk_meta</span><span> </span><a name="local-6989586621681790711"><a href="#local-6989586621681790711"><span class="hs-identifier">mtv_env</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Indirect</span><span> </span><a name="local-6989586621681790712"><a href="#local-6989586621681790712"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1784"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790713"><a href="#local-6989586621681790713"><span class="hs-identifier">zty</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790698"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790712"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1785"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621681790705"><span class="hs-identifier hs-var">finish_meta</span></a><span> </span><a href="#local-6989586621681790711"><span class="hs-identifier hs-var">mtv_env</span></a><span> </span><a href="#local-6989586621681790713"><span class="hs-identifier hs-var">zty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1786"></a><span>
</span><a name="line-1787"></a><span>    </span><a name="local-6989586621681790705"><a href="#local-6989586621681790705"><span class="hs-identifier">finish_meta</span></a></a><span> </span><a name="local-6989586621681790714"><a href="#local-6989586621681790714"><span class="hs-identifier">mtv_env</span></a></a><span> </span><a name="local-6989586621681790715"><a href="#local-6989586621681790715"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-1788"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621681790716"><a href="#local-6989586621681790716"><span class="hs-identifier">mtv_env'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">extendVarEnv</span><span> </span><a href="#local-6989586621681790714"><span class="hs-identifier hs-var">mtv_env</span></a><span> </span><a href="#local-6989586621681790702"><span class="hs-identifier hs-var">tv</span></a><span> </span><a href="#local-6989586621681790715"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1789"></a><span>           </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a><span> </span><a href="#local-6989586621681790701"><span class="hs-identifier hs-var">mtv_env_ref</span></a><span> </span><a href="#local-6989586621681790716"><span class="hs-identifier hs-var">mtv_env'</span></a><span>
</span><a name="line-1790"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681790715"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1791"></a><span>
</span><a name="line-1792"></a><span class="hs-identifier">lookupTyVarOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcTyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">TyVar</span><span>
</span><a name="line-1793"></a><a name="lookupTyVarOcc"><a href="TcHsSyn.html#lookupTyVarOcc"><span class="hs-identifier">lookupTyVarOcc</span></a></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790721"><a href="#local-6989586621681790721"><span class="hs-identifier">tv_env</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681790722"><a href="#local-6989586621681790722"><span class="hs-identifier">tv</span></a></a><span>
</span><a name="line-1794"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lookupVarEnv</span><span> </span><a href="#local-6989586621681790721"><span class="hs-identifier hs-var">tv_env</span></a><span> </span><a href="#local-6989586621681790722"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1795"></a><span>
</span><a name="line-1796"></a><span class="hs-identifier">commitFlexi</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkFlexi"><span class="hs-identifier hs-type">ZonkFlexi</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcTyVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Kind</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-1797"></a><span class="hs-comment">-- Only monadic so we can do tc-tracing</span><span>
</span><a name="line-1798"></a><a name="commitFlexi"><a href="TcHsSyn.html#commitFlexi"><span class="hs-identifier">commitFlexi</span></a></a><span> </span><a name="local-6989586621681790723"><a href="#local-6989586621681790723"><span class="hs-identifier">flexi</span></a></a><span> </span><a name="local-6989586621681790724"><a href="#local-6989586621681790724"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681790725"><a href="#local-6989586621681790725"><span class="hs-identifier">zonked_kind</span></a></a><span>
</span><a name="line-1799"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681790723"><span class="hs-identifier hs-var">flexi</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1800"></a><span>      </span><a href="TcHsSyn.html#SkolemiseFlexi"><span class="hs-identifier hs-var">SkolemiseFlexi</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyVarTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyVar</span><span> </span><a href="#local-6989586621681790726"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681790725"><span class="hs-identifier hs-var">zonked_kind</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1801"></a><span>
</span><a name="line-1802"></a><span>      </span><a href="TcHsSyn.html#DefaultFlexi"><span class="hs-identifier hs-var">DefaultFlexi</span></a><span>
</span><a name="line-1803"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isRuntimeRepTy</span><span> </span><a href="#local-6989586621681790725"><span class="hs-identifier hs-var">zonked_kind</span></a><span>
</span><a name="line-1804"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Defaulting flexi tyvar to LiftedRep:&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprTyVar</span><span> </span><a href="#local-6989586621681790724"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1805"></a><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">liftedRepTy</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1806"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1807"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Defaulting flexi tyvar to Any:&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprTyVar</span><span> </span><a href="#local-6989586621681790724"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1808"></a><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">anyTypeOfKind</span><span> </span><a href="#local-6989586621681790725"><span class="hs-identifier hs-var">zonked_kind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1809"></a><span>
</span><a name="line-1810"></a><span>      </span><a href="TcHsSyn.html#RuntimeUnkFlexi"><span class="hs-identifier hs-var">RuntimeUnkFlexi</span></a><span>
</span><a name="line-1811"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Defaulting flexi tyvar to RuntimeUnk:&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprTyVar</span><span> </span><a href="#local-6989586621681790724"><span class="hs-identifier hs-var">tv</span></a><span class="hs-special">)</span><span>
</span><a name="line-1812"></a><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTyVarTy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkTcTyVar</span><span> </span><a href="#local-6989586621681790726"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621681790725"><span class="hs-identifier hs-var">zonked_kind</span></a><span> </span><span class="hs-identifier hs-var">RuntimeUnk</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1813"></a><span>                        </span><span class="hs-comment">-- This is where RuntimeUnks are born:</span><span>
</span><a name="line-1814"></a><span>                        </span><span class="hs-comment">-- otherwise-unconstrained unification variables are</span><span>
</span><a name="line-1815"></a><span>                        </span><span class="hs-comment">-- turned into RuntimeUnks as they leave the</span><span>
</span><a name="line-1816"></a><span>                        </span><span class="hs-comment">-- typechecker's monad</span><span>
</span><a name="line-1817"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1818"></a><span>     </span><a name="local-6989586621681790726"><a href="#local-6989586621681790726"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tyVarName</span><span> </span><a href="#local-6989586621681790724"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1819"></a><span>
</span><a name="line-1820"></a><span class="hs-identifier">zonkCoVarOcc</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoVar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span>
</span><a name="line-1821"></a><a name="zonkCoVarOcc"><a href="TcHsSyn.html#zonkCoVarOcc"><span class="hs-identifier">zonkCoVarOcc</span></a></a><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-var">ZonkEnv</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ze_tv_env</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790727"><a href="#local-6989586621681790727"><span class="hs-identifier">tyco_env</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><a name="local-6989586621681790728"><a href="#local-6989586621681790728"><span class="hs-identifier">cv</span></a></a><span>
</span><a name="line-1822"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681790729"><a href="#local-6989586621681790729"><span class="hs-identifier">cv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lookupVarEnv</span><span> </span><a href="#local-6989586621681790727"><span class="hs-identifier hs-var">tyco_env</span></a><span> </span><a href="#local-6989586621681790728"><span class="hs-identifier hs-var">cv</span></a><span>  </span><span class="hs-comment">-- don't look in the knot-tied env</span><span>
</span><a name="line-1823"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkCoVarCo</span><span> </span><a href="#local-6989586621681790729"><span class="hs-identifier hs-var">cv'</span></a><span>
</span><a name="line-1824"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-1825"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790730"><a href="#local-6989586621681790730"><span class="hs-identifier">cv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkCoVar"><span class="hs-identifier hs-var">zonkCoVar</span></a><span> </span><a href="#local-6989586621681790728"><span class="hs-identifier hs-var">cv</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkCoVarCo</span><span> </span><a href="#local-6989586621681790730"><span class="hs-identifier hs-var">cv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1826"></a><span>
</span><a name="line-1827"></a><span class="hs-identifier">zonkCoHole</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">CoercionHole</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span>
</span><a name="line-1828"></a><a name="zonkCoHole"><a href="TcHsSyn.html#zonkCoHole"><span class="hs-identifier">zonkCoHole</span></a></a><span> </span><a name="local-6989586621681790731"><a href="#local-6989586621681790731"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790732"><a href="#local-6989586621681790732"><span class="hs-identifier">hole</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">CoercionHole</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">ch_ref</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790733"><a href="#local-6989586621681790733"><span class="hs-identifier">ref</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">ch_co_var</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621681790734"><a href="#local-6989586621681790734"><span class="hs-identifier">cv</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1829"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790735"><a href="#local-6989586621681790735"><span class="hs-identifier">contents</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a><span> </span><a href="#local-6989586621681790733"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-1830"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681790735"><span class="hs-identifier hs-var">contents</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1831"></a><span>           </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621681790736"><a href="#local-6989586621681790736"><span class="hs-identifier">co</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790737"><a href="#local-6989586621681790737"><span class="hs-identifier">co'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkCoToCo"><span class="hs-identifier hs-var">zonkCoToCo</span></a><span> </span><a href="#local-6989586621681790731"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790736"><span class="hs-identifier hs-var">co</span></a><span>
</span><a name="line-1832"></a><span>                         </span><span class="hs-special">;</span><span> </span><a href="TcMType.html#checkCoercionHole"><span class="hs-identifier hs-var">checkCoercionHole</span></a><span> </span><a href="#local-6989586621681790734"><span class="hs-identifier hs-var">cv</span></a><span> </span><a href="#local-6989586621681790737"><span class="hs-identifier hs-var">co'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1833"></a><span>
</span><a name="line-1834"></a><span>              </span><span class="hs-comment">-- This next case should happen only in the presence of</span><span>
</span><a name="line-1835"></a><span>              </span><span class="hs-comment">-- (undeferred) type errors. Originally, I put in a panic</span><span>
</span><a name="line-1836"></a><span>              </span><span class="hs-comment">-- here, but that caused too many uses of `failIfErrsM`.</span><span>
</span><a name="line-1837"></a><span>           </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a><span> </span><span class="hs-string">&quot;Zonking unfilled coercion hole&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681790732"><span class="hs-identifier hs-var">hole</span></a><span class="hs-special">)</span><span>
</span><a name="line-1838"></a><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-identifier hs-var">debugIsOn</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1839"></a><span>                           </span><a href="TcRnMonad.html#whenNoErrs"><span class="hs-identifier hs-var">whenNoErrs</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1840"></a><span>                           </span><span class="hs-identifier">MASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">False</span><span>
</span><a name="line-1841"></a><span>                                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Type-correct unfilled coercion hole&quot;</span><span>
</span><a name="line-1842"></a><span>                                     </span><span class="hs-operator">&lt;+&gt;</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">hole</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-1843"></a><span>                         </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790738"><a href="#local-6989586621681790738"><span class="hs-identifier">cv'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcMType.html#zonkCoVar"><span class="hs-identifier hs-var">zonkCoVar</span></a><span> </span><a href="#local-6989586621681790734"><span class="hs-identifier hs-var">cv</span></a><span>
</span><a name="line-1844"></a><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mkCoVarCo</span><span> </span><a href="#local-6989586621681790738"><span class="hs-identifier hs-var">cv'</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1845"></a><span>                             </span><span class="hs-comment">-- This will be an out-of-scope variable, but keeping</span><span>
</span><a name="line-1846"></a><span>                             </span><span class="hs-comment">-- this as a coercion hole led to #15787</span><span>
</span><a name="line-1847"></a><span>
</span><a name="line-1848"></a><span class="hs-identifier">zonk_tycomapper</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TyCoMapper</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-identifier hs-type">TcM</span><span>
</span><a name="line-1849"></a><a name="zonk_tycomapper"><a href="TcHsSyn.html#zonk_tycomapper"><span class="hs-identifier">zonk_tycomapper</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">TyCoMapper</span><span>
</span><a name="line-1850"></a><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tcm_smart</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>   </span><span class="hs-comment">-- Establish type invariants</span><span>
</span><a name="line-1851"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tyvar</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkTyVarOcc"><span class="hs-identifier hs-var">zonkTyVarOcc</span></a><span>
</span><a name="line-1852"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_covar</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkCoVarOcc"><span class="hs-identifier hs-var">zonkCoVarOcc</span></a><span>
</span><a name="line-1853"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_hole</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkCoHole"><span class="hs-identifier hs-var">zonkCoHole</span></a><span>
</span><a name="line-1854"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tycobinder</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621681790739"><a href="#local-6989586621681790739"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790740"><a href="#local-6989586621681790740"><span class="hs-identifier">tv</span></a></a><span> </span><a name="local-6989586621681790741"><a href="#local-6989586621681790741"><span class="hs-identifier">_vis</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="TcHsSyn.html#zonkTyBndrX"><span class="hs-identifier hs-var">zonkTyBndrX</span></a><span> </span><a href="#local-6989586621681790739"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621681790740"><span class="hs-identifier hs-var">tv</span></a><span>
</span><a name="line-1855"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">tcm_tycon</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#zonkTcTyConToTyCon"><span class="hs-identifier hs-var">zonkTcTyConToTyCon</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1856"></a><span>
</span><a name="line-1857"></a><span class="hs-comment">-- Zonk a TyCon by changing a TcTyCon to a regular TyCon</span><span>
</span><a name="line-1858"></a><span class="hs-identifier">zonkTcTyConToTyCon</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TcTyCon</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">TyCon</span><span>
</span><a name="line-1859"></a><a name="zonkTcTyConToTyCon"><a href="TcHsSyn.html#zonkTcTyConToTyCon"><span class="hs-identifier">zonkTcTyConToTyCon</span></a></a><span> </span><a name="local-6989586621681790742"><a href="#local-6989586621681790742"><span class="hs-identifier">tc</span></a></a><span>
</span><a name="line-1860"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isTcTyCon</span><span> </span><a href="#local-6989586621681790742"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790743"><a href="#local-6989586621681790743"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcEnv.html#tcLookupGlobalOnly"><span class="hs-identifier hs-var">tcLookupGlobalOnly</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getName</span><span> </span><a href="#local-6989586621681790742"><span class="hs-identifier hs-var">tc</span></a><span class="hs-special">)</span><span>
</span><a name="line-1861"></a><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621681790743"><span class="hs-identifier hs-var">thing</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1862"></a><span>                          </span><span class="hs-identifier hs-var">ATyCon</span><span> </span><a name="local-6989586621681790744"><a href="#local-6989586621681790744"><span class="hs-identifier">real_tc</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681790744"><span class="hs-identifier hs-var">real_tc</span></a><span>
</span><a name="line-1863"></a><span>                          </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;zonkTcTyCon&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681790742"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-operator hs-var">$$</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621681790743"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1864"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621681790742"><span class="hs-identifier hs-var">tc</span></a><span> </span><span class="hs-comment">-- it's already zonked</span><span>
</span><a name="line-1865"></a><span>
</span><a name="line-1866"></a><span class="hs-comment">-- Confused by zonking? See Note [What is zonking?] in TcMType.</span><span>
</span><a name="line-1867"></a><span class="hs-identifier">zonkTcTypeToType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TcType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-1868"></a><a name="zonkTcTypeToType"><a href="TcHsSyn.html#zonkTcTypeToType"><span class="hs-identifier">zonkTcTypeToType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span>
</span><a name="line-1869"></a><span>
</span><a name="line-1870"></a><span class="hs-identifier">zonkTcTypeToTypeX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">Type</span><span>
</span><a name="line-1871"></a><a name="zonkTcTypeToTypeX"><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier">zonkTcTypeToTypeX</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapType</span><span> </span><a href="TcHsSyn.html#zonk_tycomapper"><span class="hs-identifier hs-var">zonk_tycomapper</span></a><span>
</span><a name="line-1872"></a><span>
</span><a name="line-1873"></a><span class="hs-identifier">zonkTcTypesToTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TcType</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>
</span><a name="line-1874"></a><a name="zonkTcTypesToTypes"><a href="TcHsSyn.html#zonkTcTypesToTypes"><span class="hs-identifier">zonkTcTypesToTypes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcHsSyn.html#initZonkEnv"><span class="hs-identifier hs-var">initZonkEnv</span></a><span> </span><a href="TcHsSyn.html#zonkTcTypesToTypesX"><span class="hs-identifier hs-var">zonkTcTypesToTypesX</span></a><span>
</span><a name="line-1875"></a><span>
</span><a name="line-1876"></a><span class="hs-identifier">zonkTcTypesToTypesX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">TcType</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">]</span><span>
</span><a name="line-1877"></a><a name="zonkTcTypesToTypesX"><a href="TcHsSyn.html#zonkTcTypesToTypesX"><span class="hs-identifier">zonkTcTypesToTypesX</span></a></a><span> </span><a name="local-6989586621681790745"><a href="#local-6989586621681790745"><span class="hs-identifier">env</span></a></a><span> </span><a name="local-6989586621681790746"><a href="#local-6989586621681790746"><span class="hs-identifier">tys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790745"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621681790746"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-1878"></a><span>
</span><a name="line-1879"></a><span class="hs-identifier">zonkCoToCo</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-identifier hs-type">Coercion</span><span>
</span><a name="line-1880"></a><a name="zonkCoToCo"><a href="TcHsSyn.html#zonkCoToCo"><span class="hs-identifier">zonkCoToCo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapCoercion</span><span> </span><a href="TcHsSyn.html#zonk_tycomapper"><span class="hs-identifier hs-var">zonk_tycomapper</span></a><span>
</span><a name="line-1881"></a><span>
</span><a name="line-1882"></a><span class="hs-identifier">zonkTcMethInfoToMethInfoX</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="TcHsSyn.html#ZonkEnv"><span class="hs-identifier hs-type">ZonkEnv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BuildTyCl.html#TcMethInfo"><span class="hs-identifier hs-type">TcMethInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><a href="BuildTyCl.html#MethInfo"><span class="hs-identifier hs-type">MethInfo</span></a><span>
</span><a name="line-1883"></a><a name="zonkTcMethInfoToMethInfoX"><a href="TcHsSyn.html#zonkTcMethInfoToMethInfoX"><span class="hs-identifier">zonkTcMethInfoToMethInfoX</span></a></a><span> </span><a name="local-6989586621681790747"><a href="#local-6989586621681790747"><span class="hs-identifier">ze</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621681790748"><a href="#local-6989586621681790748"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790749"><a href="#local-6989586621681790749"><span class="hs-identifier">ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790750"><a href="#local-6989586621681790750"><span class="hs-identifier">gdm_spec</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1884"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790755"><a href="#local-6989586621681790755"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790747"><span class="hs-identifier hs-var">ze</span></a><span> </span><a href="#local-6989586621681790749"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1885"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621681790756"><a href="#local-6989586621681790756"><span class="hs-identifier">gdm_spec'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621681790751"><span class="hs-identifier hs-var">zonk_gdm</span></a><span> </span><a href="#local-6989586621681790750"><span class="hs-identifier hs-var">gdm_spec</span></a><span>
</span><a name="line-1886"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790748"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790755"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790756"><span class="hs-identifier hs-var">gdm_spec'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1887"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1888"></a><span>    </span><span class="hs-identifier">zonk_gdm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DefMethSpec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SrcSpan</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TcType</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1889"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">TcM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DefMethSpec</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SrcSpan</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1890"></a><span>    </span><a name="local-6989586621681790751"><a href="#local-6989586621681790751"><span class="hs-identifier">zonk_gdm</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1891"></a><span>    </span><span class="hs-identifier">zonk_gdm</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">VanillaDM</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">VanillaDM</span><span class="hs-special">)</span><span>
</span><a name="line-1892"></a><span>    </span><span class="hs-identifier">zonk_gdm</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GenericDM</span><span> </span><span class="hs-special">(</span><a name="local-6989586621681790752"><a href="#local-6989586621681790752"><span class="hs-identifier">loc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621681790753"><a href="#local-6989586621681790753"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1893"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621681790754"><a href="#local-6989586621681790754"><span class="hs-identifier">ty'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcHsSyn.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a><span> </span><a href="#local-6989586621681790747"><span class="hs-identifier hs-var">ze</span></a><span> </span><a href="#local-6989586621681790753"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1894"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GenericDM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621681790752"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621681790754"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1895"></a><span>
</span><a name="line-1896"></a><span class="hs-comment">---------------------------------------</span><span>
</span><a name="line-1897"></a><span class="hs-comment">{- Note [Zonking the LHS of a RULE]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
See also DsBinds Note [Free tyvars on rule LHS]

We need to gather the type variables mentioned on the LHS so we can
quantify over them.  Example:
  data T a = C

  foo :: T a -&gt; Int
  foo C = 1

  {-# RULES &quot;myrule&quot;  foo C = 1 #-}

After type checking the LHS becomes (foo alpha (C alpha)) and we do
not want to zap the unbound meta-tyvar 'alpha' to Any, because that
limits the applicability of the rule.  Instead, we want to quantify
over it!

We do this in two stages.

* During zonking, we skolemise the TcTyVar 'alpha' to TyVar 'a'.  We
  do this by using zonkTvSkolemising as the UnboundTyVarZonker in the
  ZonkEnv.  (This is in fact the whole reason that the ZonkEnv has a
  UnboundTyVarZonker.)

* In DsBinds, we quantify over it.  See DsBinds
  Note [Free tyvars on rule LHS]

Quantifying here is awkward because (a) the data type is big and (b)
finding the free type vars of an expression is necessarily monadic
operation. (consider /\a -&gt; f @ b, where b is side-effected to a)
-}</span><span>
</span><a name="line-1929"></a></pre></body></html>