<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, GADTs, NondecreasingIndentation #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">-- The default iteration limit is a bit too low for the definitions</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- in this module.</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# OPTIONS_GHC -fmax-pmcheck-iterations=10000000 #-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-8"></a><span class="hs-comment">--</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Generating machine code (instruction selection)</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- (c) The University of Glasgow 1996-2004</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-comment">-- This is a big module, but, if you pay attention to</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- (a) the sectioning, and (b) the type signatures, the</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- structure should not be too overwhelming.</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">X86.CodeGen</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-20"></a><span>        </span><a href="X86.CodeGen.html#cmmTopCodeGen"><span class="hs-identifier hs-var">cmmTopCodeGen</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>        </span><a href="X86.CodeGen.html#generateJumpTableForInstr"><span class="hs-identifier hs-var">generateJumpTableForInstr</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>        </span><a href="X86.CodeGen.html#extractUnwindPoints"><span class="hs-identifier hs-var">extractUnwindPoints</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>        </span><a href="X86.CodeGen.html#invertCondBranches"><span class="hs-identifier hs-var">invertCondBranches</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>        </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-25"></a><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">where</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-cpp">#include &quot;HsVersions.h&quot;
#include &quot;nativeGen/NCG.h&quot;
#include &quot;../includes/MachDeps.h&quot;
</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- NCG stuff:</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="X86.Instr.html"><span class="hs-identifier">X86.Instr</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="X86.Cond.html"><span class="hs-identifier">X86.Cond</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="X86.Regs.html"><span class="hs-identifier">X86.Regs</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="X86.RegInfo.html"><span class="hs-identifier">X86.RegInfo</span></a><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-comment">--TODO: Remove - Just for development/debugging</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="X86.Ppr.html"><span class="hs-identifier">X86.Ppr</span></a><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><a href="CodeGen.Platform.html"><span class="hs-identifier">CodeGen.Platform</span></a><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><a href="CPrim.html"><span class="hs-identifier">CPrim</span></a><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><a href="Debug.html"><span class="hs-identifier">Debug</span></a><span>            </span><span class="hs-special">(</span><span> </span><a href="Debug.html#DebugBlock"><span class="hs-identifier hs-type">DebugBlock</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Debug.html#UnwindPoint"><span class="hs-identifier hs-type">UnwindPoint</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Debug.html#UnwindTable"><span class="hs-identifier hs-type">UnwindTable</span></a><span>
</span><a name="line-47"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="Debug.html#UnwindExpr"><span class="hs-identifier hs-type">UnwindExpr</span></a><span class="hs-special">(</span><a href="Debug.html#UwReg"><span class="hs-identifier hs-var">UwReg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Debug.html#toUnwindExpr"><span class="hs-identifier hs-var">toUnwindExpr</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="Instruction.html"><span class="hs-identifier">Instruction</span></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="PIC.html"><span class="hs-identifier">PIC</span></a><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="NCGMonad.html"><span class="hs-identifier">NCGMonad</span></a><span>   </span><span class="hs-special">(</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span>
</span><a name="line-51"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getPicBaseNat"><span class="hs-identifier hs-var">getPicBaseNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span>
</span><a name="line-52"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getPicBaseMaybeNat"><span class="hs-identifier hs-var">getPicBaseMaybeNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getDebugBlock"><span class="hs-identifier hs-var">getDebugBlock</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#getFileId"><span class="hs-identifier hs-var">getFileId</span></a><span>
</span><a name="line-53"></a><span>                  </span><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#addImmediateSuccessorNat"><span class="hs-identifier hs-var">addImmediateSuccessorNat</span></a><span class="hs-special">,</span><span> </span><a href="NCGMonad.html#updateCfgNat"><span class="hs-identifier hs-var">updateCfgNat</span></a><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><a href="CFG.html"><span class="hs-identifier">CFG</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="Format.html"><span class="hs-identifier">Format</span></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="Reg.html"><span class="hs-identifier">Reg</span></a><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Platform</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-comment">-- Our intermediate code:</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="BlockId.html"><span class="hs-identifier">BlockId</span></a><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Module</span><span>           </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">primUnitId</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><a href="PprCmm.html"><span class="hs-identifier">PprCmm</span></a><span>           </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><a href="CmmUtils.html"><span class="hs-identifier">CmmUtils</span></a><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><a href="CmmSwitch.html"><span class="hs-identifier">CmmSwitch</span></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><a href="Cmm.html"><span class="hs-identifier">Cmm</span></a><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Block.html"><span class="hs-identifier">Hoopl.Block</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Collections.html"><span class="hs-identifier">Hoopl.Collections</span></a><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Graph.html"><span class="hs-identifier">Hoopl.Graph</span></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="Hoopl.Label.html"><span class="hs-identifier">Hoopl.Label</span></a><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="CLabel.html"><span class="hs-identifier">CLabel</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">CoreSyn</span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Tickish</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>           </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">srcSpanFile</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">srcSpanStartLine</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">srcSpanStartCol</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-comment">-- The rest:</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ForeignCall</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">CCallConv</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">OrdList</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">FastString</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">UniqSupply</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">getUniqueM</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Foldable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fold</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Int</span><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-identifier">is32BitPlatform</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-94"></a><a name="is32BitPlatform"><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier">is32BitPlatform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-95"></a><span>    </span><a name="local-6989586621684658705"><a href="#local-6989586621684658705"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684658705"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-identifier">sse2Enabled</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-99"></a><a name="sse2Enabled"><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier">sse2Enabled</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-100"></a><span>  </span><a name="local-6989586621684658706"><a href="#local-6989586621684658706"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-101"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isSse2Enabled</span><span> </span><a href="#local-6989586621684658706"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-identifier">sse4_2Enabled</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-104"></a><a name="sse4_2Enabled"><a href="X86.CodeGen.html#sse4_2Enabled"><span class="hs-identifier">sse4_2Enabled</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-105"></a><span>  </span><a name="local-6989586621684658707"><a href="#local-6989586621684658707"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-106"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isSse4_2Enabled</span><span> </span><a href="#local-6989586621684658707"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-identifier">if_sse2</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="#local-6989586621684658704"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="#local-6989586621684658704"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="#local-6989586621684658704"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-109"></a><a name="if_sse2"><a href="X86.CodeGen.html#if_sse2"><span class="hs-identifier">if_sse2</span></a></a><span> </span><a name="local-6989586621684658708"><a href="#local-6989586621684658708"><span class="hs-identifier">sse2</span></a></a><span> </span><a name="local-6989586621684658709"><a href="#local-6989586621684658709"><span class="hs-identifier">x87</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-110"></a><span>  </span><a name="local-6989586621684658710"><a href="#local-6989586621684658710"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-111"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684658710"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621684658708"><span class="hs-identifier hs-var">sse2</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621684658709"><span class="hs-identifier hs-var">x87</span></a><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-identifier">cmmTopCodeGen</span><span>
</span><a name="line-114"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Cmm.html#RawCmmDecl"><span class="hs-identifier hs-type">RawCmmDecl</span></a><span>
</span><a name="line-115"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Alignment</span><span class="hs-special">,</span><span> </span><a href="Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a><span class="hs-special">)</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><a name="cmmTopCodeGen"><a href="X86.CodeGen.html#cmmTopCodeGen"><span class="hs-identifier">cmmTopCodeGen</span></a></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a><span> </span><a name="local-6989586621684658711"><a href="#local-6989586621684658711"><span class="hs-identifier">info</span></a></a><span> </span><a name="local-6989586621684658712"><a href="#local-6989586621684658712"><span class="hs-identifier">lab</span></a></a><span> </span><a name="local-6989586621684658713"><a href="#local-6989586621684658713"><span class="hs-identifier">live</span></a></a><span> </span><a name="local-6989586621684658714"><a href="#local-6989586621684658714"><span class="hs-identifier">graph</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-118"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658715"><a href="#local-6989586621684658715"><span class="hs-identifier">blocks</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmUtils.html#toBlockListEntryFirst"><span class="hs-identifier hs-var">toBlockListEntryFirst</span></a><span> </span><a href="#local-6989586621684658714"><span class="hs-identifier hs-var">graph</span></a><span>
</span><a name="line-119"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684658716"><a href="#local-6989586621684658716"><span class="hs-identifier">nat_blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658717"><a href="#local-6989586621684658717"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapAndUnzipM</span><span> </span><a href="X86.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier hs-var">basicBlockCodeGen</span></a><span> </span><a href="#local-6989586621684658715"><span class="hs-identifier hs-var">blocks</span></a><span>
</span><a name="line-120"></a><span>  </span><a name="local-6989586621684658718"><a href="#local-6989586621684658718"><span class="hs-identifier">picBaseMb</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getPicBaseMaybeNat"><span class="hs-identifier hs-var">getPicBaseMaybeNat</span></a><span>
</span><a name="line-121"></a><span>  </span><a name="local-6989586621684658719"><a href="#local-6989586621684658719"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-122"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658720"><a href="#local-6989586621684658720"><span class="hs-identifier">proc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmProc"><span class="hs-identifier hs-var">CmmProc</span></a><span> </span><a href="#local-6989586621684658711"><span class="hs-identifier hs-var">info</span></a><span> </span><a href="#local-6989586621684658712"><span class="hs-identifier hs-var">lab</span></a><span> </span><a href="#local-6989586621684658713"><span class="hs-identifier hs-var">live</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#ListGraph"><span class="hs-identifier hs-var">ListGraph</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621684658716"><span class="hs-identifier hs-var">nat_blocks</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>      </span><a name="local-6989586621684658721"><a href="#local-6989586621684658721"><span class="hs-identifier">tops</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684658720"><span class="hs-identifier hs-var">proc</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621684658717"><span class="hs-identifier hs-var">statics</span></a><span>
</span><a name="line-124"></a><span>      </span><a name="local-6989586621684658722"><a href="#local-6989586621684658722"><span class="hs-identifier">os</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684658719"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684658718"><span class="hs-identifier hs-var">picBaseMb</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-127"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684658723"><a href="#local-6989586621684658723"><span class="hs-identifier">picBase</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="PIC.html#initializePicBase_x86"><span class="hs-identifier hs-var">initializePicBase_x86</span></a><span> </span><span class="hs-identifier hs-var">ArchX86</span><span> </span><a href="#local-6989586621684658722"><span class="hs-identifier hs-var">os</span></a><span> </span><a href="#local-6989586621684658723"><span class="hs-identifier hs-var">picBase</span></a><span> </span><a href="#local-6989586621684658721"><span class="hs-identifier hs-var">tops</span></a><span>
</span><a name="line-128"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684658721"><span class="hs-identifier hs-var">tops</span></a><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-identifier">cmmTopCodeGen</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><a name="local-6989586621684658724"><a href="#local-6989586621684658724"><span class="hs-identifier">sec</span></a></a><span> </span><a name="local-6989586621684658725"><a href="#local-6989586621684658725"><span class="hs-identifier">dat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-131"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><a href="#local-6989586621684658724"><span class="hs-identifier hs-var">sec</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684658725"><span class="hs-identifier hs-var">dat</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- no translation, we just use CmmStatic</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-identifier">basicBlockCodeGen</span><span>
</span><a name="line-135"></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Cmm.html#CmmBlock"><span class="hs-identifier hs-type">CmmBlock</span></a><span>
</span><a name="line-136"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span>
</span><a name="line-137"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Alignment</span><span class="hs-special">,</span><span> </span><a href="Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a><span class="hs-special">)</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><a name="basicBlockCodeGen"><a href="X86.CodeGen.html#basicBlockCodeGen"><span class="hs-identifier">basicBlockCodeGen</span></a></a><span> </span><a name="local-6989586621684658726"><a href="#local-6989586621684658726"><span class="hs-identifier">block</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-140"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621684658727"><a href="#local-6989586621684658727"><span class="hs-identifier">nodes</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684658728"><a href="#local-6989586621684658728"><span class="hs-identifier">tail</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Block.html#blockSplit"><span class="hs-identifier hs-var">blockSplit</span></a><span> </span><a href="#local-6989586621684658726"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-141"></a><span>      </span><a name="local-6989586621684658729"><a href="#local-6989586621684658729"><span class="hs-identifier">id</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a><span> </span><a href="#local-6989586621684658726"><span class="hs-identifier hs-var">block</span></a><span>
</span><a name="line-142"></a><span>      </span><a name="local-6989586621684658730"><a href="#local-6989586621684658730"><span class="hs-identifier">stmts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Hoopl.Block.html#blockToList"><span class="hs-identifier hs-var">blockToList</span></a><span> </span><a href="#local-6989586621684658727"><span class="hs-identifier hs-var">nodes</span></a><span>
</span><a name="line-143"></a><span>  </span><span class="hs-comment">-- Generate location directive</span><span>
</span><a name="line-144"></a><span>  </span><a name="local-6989586621684658731"><a href="#local-6989586621684658731"><span class="hs-identifier">dbg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDebugBlock"><span class="hs-identifier hs-var">getDebugBlock</span></a><span> </span><span class="hs-special">(</span><a href="Hoopl.Graph.html#entryLabel"><span class="hs-identifier hs-var">entryLabel</span></a><span> </span><a href="#local-6989586621684658726"><span class="hs-identifier hs-var">block</span></a><span class="hs-special">)</span><span>
</span><a name="line-145"></a><span>  </span><a name="local-6989586621684658737"><a href="#local-6989586621684658737"><span class="hs-identifier">loc_instrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">dblSourceTick</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621684658731"><span class="hs-identifier hs-var">dbg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-146"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SourceNote</span><span> </span><a name="local-6989586621684658732"><a href="#local-6989586621684658732"><span class="hs-identifier">span</span></a></a><span> </span><a name="local-6989586621684658733"><a href="#local-6989586621684658733"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684658734"><a href="#local-6989586621684658734"><span class="hs-identifier">fileId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getFileId"><span class="hs-identifier hs-var">getFileId</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">srcSpanFile</span><span> </span><a href="#local-6989586621684658732"><span class="hs-identifier hs-var">span</span></a><span class="hs-special">)</span><span>
</span><a name="line-148"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658735"><a href="#local-6989586621684658735"><span class="hs-identifier">line</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">srcSpanStartLine</span><span> </span><a href="#local-6989586621684658732"><span class="hs-identifier hs-var">span</span></a><span class="hs-special">;</span><span> </span><a name="local-6989586621684658736"><a href="#local-6989586621684658736"><span class="hs-identifier">col</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">srcSpanStartCol</span><span> </span><a href="#local-6989586621684658732"><span class="hs-identifier hs-var">span</span></a><span>
</span><a name="line-149"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Instr.html#LOCATION"><span class="hs-identifier hs-var">LOCATION</span></a><span> </span><a href="#local-6989586621684658734"><span class="hs-identifier hs-var">fileId</span></a><span> </span><a href="#local-6989586621684658735"><span class="hs-identifier hs-var">line</span></a><span> </span><a href="#local-6989586621684658736"><span class="hs-identifier hs-var">col</span></a><span> </span><a href="#local-6989586621684658733"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-150"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-151"></a><span>  </span><a name="local-6989586621684658738"><a href="#local-6989586621684658738"><span class="hs-identifier">mid_instrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#stmtsToInstrs"><span class="hs-identifier hs-var">stmtsToInstrs</span></a><span> </span><a href="#local-6989586621684658729"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621684658730"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-152"></a><span>  </span><a name="local-6989586621684658739"><a href="#local-6989586621684658739"><span class="hs-identifier">tail_instrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var">stmtToInstrs</span></a><span> </span><a href="#local-6989586621684658729"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621684658728"><span class="hs-identifier hs-var">tail</span></a><span>
</span><a name="line-153"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658740"><a href="#local-6989586621684658740"><span class="hs-identifier">instrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684658737"><span class="hs-identifier hs-var">loc_instrs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684658738"><span class="hs-identifier hs-var">mid_instrs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684658739"><span class="hs-identifier hs-var">tail_instrs</span></a><span>
</span><a name="line-154"></a><span>  </span><a name="local-6989586621684658741"><a href="#local-6989586621684658741"><span class="hs-identifier">instrs'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fold</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="X86.CodeGen.html#addSpUnwindings"><span class="hs-identifier hs-var">addSpUnwindings</span></a><span> </span><a href="#local-6989586621684658740"><span class="hs-identifier hs-var">instrs</span></a><span>
</span><a name="line-155"></a><span>  </span><span class="hs-comment">-- code generation may introduce new basic block boundaries, which</span><span>
</span><a name="line-156"></a><span>  </span><span class="hs-comment">-- are indicated by the NEWBLOCK instruction.  We must split up the</span><span>
</span><a name="line-157"></a><span>  </span><span class="hs-comment">-- instruction stream into basic blocks again.  Also, we extract</span><span>
</span><a name="line-158"></a><span>  </span><span class="hs-comment">-- LDATAs here too.</span><span>
</span><a name="line-159"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-160"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684658742"><a href="#local-6989586621684658742"><span class="hs-identifier">top</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658743"><a href="#local-6989586621684658743"><span class="hs-identifier">other_blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658744"><a href="#local-6989586621684658744"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldrOL</span><span> </span><a href="#local-6989586621684658745"><span class="hs-identifier hs-var">mkBlocks</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658741"><span class="hs-identifier hs-var">instrs'</span></a><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span>        </span><a name="local-6989586621684658745"><a href="#local-6989586621684658745"><span class="hs-identifier">mkBlocks</span></a></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a name="local-6989586621684658746"><a href="#local-6989586621684658746"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684658747"><a href="#local-6989586621684658747"><span class="hs-identifier">instrs</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658748"><a href="#local-6989586621684658748"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658749"><a href="#local-6989586621684658749"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a href="#local-6989586621684658746"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621684658747"><span class="hs-identifier hs-var">instrs</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684658748"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684658749"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>        </span><span class="hs-identifier">mkBlocks</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#LDATA"><span class="hs-identifier hs-var">LDATA</span></a><span> </span><a name="local-6989586621684658750"><a href="#local-6989586621684658750"><span class="hs-identifier">sec</span></a></a><span> </span><a name="local-6989586621684658751"><a href="#local-6989586621684658751"><span class="hs-identifier">dat</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684658752"><a href="#local-6989586621684658752"><span class="hs-identifier">instrs</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658753"><a href="#local-6989586621684658753"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658754"><a href="#local-6989586621684658754"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-165"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658752"><span class="hs-identifier hs-var">instrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684658753"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">,</span><span> </span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><a href="#local-6989586621684658750"><span class="hs-identifier hs-var">sec</span></a><span> </span><a href="#local-6989586621684658751"><span class="hs-identifier hs-var">dat</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684658754"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>        </span><span class="hs-identifier">mkBlocks</span><span> </span><a name="local-6989586621684658755"><a href="#local-6989586621684658755"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684658756"><a href="#local-6989586621684658756"><span class="hs-identifier">instrs</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658757"><a href="#local-6989586621684658757"><span class="hs-identifier">blocks</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658758"><a href="#local-6989586621684658758"><span class="hs-identifier">statics</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-167"></a><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658755"><span class="hs-identifier hs-var">instr</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684658756"><span class="hs-identifier hs-var">instrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684658757"><span class="hs-identifier hs-var">blocks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684658758"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-168"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a href="#local-6989586621684658729"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621684658742"><span class="hs-identifier hs-var">top</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684658743"><span class="hs-identifier hs-var">other_blocks</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684658744"><span class="hs-identifier hs-var">statics</span></a><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-comment">-- | Convert 'DELTA' instructions into 'UNWIND' instructions to capture changes</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- in the @sp@ register. See Note [What is this unwinding business?] in Debug</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- for details.</span><span>
</span><a name="line-173"></a><span class="hs-identifier">addSpUnwindings</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-174"></a><a name="addSpUnwindings"><a href="X86.CodeGen.html#addSpUnwindings"><span class="hs-identifier">addSpUnwindings</span></a></a><span> </span><a name="local-6989586621684658759"><a href="#local-6989586621684658759"><span class="hs-identifier">instr</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><a name="local-6989586621684658760"><a href="#local-6989586621684658760"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-175"></a><span>    </span><a name="local-6989586621684658761"><a href="#local-6989586621684658761"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-176"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">debugLevel</span><span> </span><a href="#local-6989586621684658761"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-177"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684658762"><a href="#local-6989586621684658762"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CLabel.html#mkAsmTempLabel"><span class="hs-identifier hs-var">mkAsmTempLabel</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">getUniqueM</span><span>
</span><a name="line-178"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658763"><a href="#local-6989586621684658763"><span class="hs-identifier">unwind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M.singleton</span><span> </span><a href="CmmExpr.html#MachSp"><span class="hs-identifier hs-var">MachSp</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Debug.html#UwReg"><span class="hs-identifier hs-var">UwReg</span></a><span> </span><a href="CmmExpr.html#MachSp"><span class="hs-identifier hs-var">MachSp</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="#local-6989586621684658760"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621684658759"><span class="hs-identifier hs-var">instr</span></a><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#UNWIND"><span class="hs-identifier hs-var">UNWIND</span></a><span> </span><a href="#local-6989586621684658762"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621684658763"><span class="hs-identifier hs-var">unwind</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-180"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="#local-6989586621684658759"><span class="hs-identifier hs-var">instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span class="hs-identifier">addSpUnwindings</span><span> </span><a name="local-6989586621684658764"><a href="#local-6989586621684658764"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="#local-6989586621684658764"><span class="hs-identifier hs-var">instr</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-identifier">stmtsToInstrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a><span> </span><a href="#local-6989586621684658702"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621684658703"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-184"></a><a name="stmtsToInstrs"><a href="X86.CodeGen.html#stmtsToInstrs"><span class="hs-identifier">stmtsToInstrs</span></a></a><span> </span><a name="local-6989586621684658765"><a href="#local-6989586621684658765"><span class="hs-identifier">bid</span></a></a><span> </span><a name="local-6989586621684658766"><a href="#local-6989586621684658766"><span class="hs-identifier">stmts</span></a></a><span>
</span><a name="line-185"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684658767"><a href="#local-6989586621684658767"><span class="hs-identifier">instrss</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var">stmtToInstrs</span></a><span> </span><a href="#local-6989586621684658765"><span class="hs-identifier hs-var">bid</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658766"><span class="hs-identifier hs-var">stmts</span></a><span>
</span><a name="line-186"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatOL</span><span> </span><a href="#local-6989586621684658767"><span class="hs-identifier hs-var">instrss</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-comment">-- | `bid` refers to the current block and is used to update the CFG</span><span>
</span><a name="line-189"></a><span class="hs-comment">--   if new blocks are inserted in the control flow.</span><span>
</span><a name="line-190"></a><span class="hs-identifier">stmtToInstrs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmNode.html#CmmNode"><span class="hs-identifier hs-type">CmmNode</span></a><span> </span><a href="#local-6989586621684658700"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621684658701"><span class="hs-identifier hs-type">x</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-191"></a><a name="stmtToInstrs"><a href="X86.CodeGen.html#stmtToInstrs"><span class="hs-identifier">stmtToInstrs</span></a></a><span> </span><a name="local-6989586621684658768"><a href="#local-6989586621684658768"><span class="hs-identifier">bid</span></a></a><span> </span><a name="local-6989586621684658769"><a href="#local-6989586621684658769"><span class="hs-identifier">stmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-192"></a><span>  </span><a name="local-6989586621684658770"><a href="#local-6989586621684658770"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-193"></a><span>  </span><a name="local-6989586621684658771"><a href="#local-6989586621684658771"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-194"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684658769"><span class="hs-identifier hs-var">stmt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-195"></a><span>    </span><a href="CmmNode.html#CmmComment"><span class="hs-identifier hs-var">CmmComment</span></a><span> </span><a name="local-6989586621684658772"><a href="#local-6989586621684658772"><span class="hs-identifier">s</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#COMMENT"><span class="hs-identifier hs-var">COMMENT</span></a><span> </span><a href="#local-6989586621684658772"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>    </span><a href="CmmNode.html#CmmTick"><span class="hs-identifier hs-var">CmmTick</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span>    </span><a href="CmmNode.html#CmmUnwind"><span class="hs-identifier hs-var">CmmUnwind</span></a><span> </span><a name="local-6989586621684658773"><a href="#local-6989586621684658773"><span class="hs-identifier">regs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-199"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">to_unwind_entry</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Debug.html#UnwindTable"><span class="hs-identifier hs-type">UnwindTable</span></a><span>
</span><a name="line-200"></a><span>          </span><a name="local-6989586621684658774"><a href="#local-6989586621684658774"><span class="hs-identifier">to_unwind_entry</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621684658775"><a href="#local-6989586621684658775"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684658776"><a href="#local-6989586621684658776"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M.singleton</span><span> </span><a href="#local-6989586621684658775"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Debug.html#toUnwindExpr"><span class="hs-identifier hs-var">toUnwindExpr</span></a><span> </span><a href="#local-6989586621684658776"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>      </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><a href="#local-6989586621684658774"><span class="hs-identifier hs-var">to_unwind_entry</span></a><span> </span><a href="#local-6989586621684658773"><span class="hs-identifier hs-var">regs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-202"></a><span>        </span><a name="local-6989586621684658777"><a href="#local-6989586621684658777"><span class="hs-identifier">tbl</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">M.null</span><span> </span><a href="#local-6989586621684658777"><span class="hs-identifier hs-var">tbl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-203"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-204"></a><span>                </span><a name="local-6989586621684658778"><a href="#local-6989586621684658778"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CLabel.html#mkAsmTempLabel"><span class="hs-identifier hs-var">mkAsmTempLabel</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">getUniqueM</span><span>
</span><a name="line-205"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Instr.html#UNWIND"><span class="hs-identifier hs-var">UNWIND</span></a><span> </span><a href="#local-6989586621684658778"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621684658777"><span class="hs-identifier hs-var">tbl</span></a><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span>    </span><a href="CmmNode.html#CmmAssign"><span class="hs-identifier hs-var">CmmAssign</span></a><span> </span><a name="local-6989586621684658779"><a href="#local-6989586621684658779"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684658780"><a href="#local-6989586621684658780"><span class="hs-identifier">src</span></a></a><span>
</span><a name="line-208"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684658781"><span class="hs-identifier hs-var">ty</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#assignReg_FltCode"><span class="hs-identifier hs-var">assignReg_FltCode</span></a><span> </span><a href="#local-6989586621684658782"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684658779"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684658780"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-209"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658771"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684658781"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#assignReg_I64Code"><span class="hs-identifier hs-var">assignReg_I64Code</span></a><span>      </span><a href="#local-6989586621684658779"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684658780"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-210"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#assignReg_IntCode"><span class="hs-identifier hs-var">assignReg_IntCode</span></a><span> </span><a href="#local-6989586621684658782"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684658779"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684658780"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-211"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684658781"><a href="#local-6989586621684658781"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a><span> </span><a href="#local-6989586621684658770"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658779"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-212"></a><span>              </span><a name="local-6989586621684658782"><a href="#local-6989586621684658782"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684658781"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span>    </span><a href="CmmNode.html#CmmStore"><span class="hs-identifier hs-var">CmmStore</span></a><span> </span><a name="local-6989586621684658783"><a href="#local-6989586621684658783"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684658784"><a href="#local-6989586621684658784"><span class="hs-identifier">src</span></a></a><span>
</span><a name="line-215"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684658785"><span class="hs-identifier hs-var">ty</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#assignMem_FltCode"><span class="hs-identifier hs-var">assignMem_FltCode</span></a><span> </span><a href="#local-6989586621684658786"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684658783"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684658784"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-216"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658771"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684658785"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#assignMem_I64Code"><span class="hs-identifier hs-var">assignMem_I64Code</span></a><span>      </span><a href="#local-6989586621684658783"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684658784"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-217"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#assignMem_IntCode"><span class="hs-identifier hs-var">assignMem_IntCode</span></a><span> </span><a href="#local-6989586621684658786"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684658783"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684658784"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-218"></a><span>        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684658785"><a href="#local-6989586621684658785"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684658770"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658784"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-219"></a><span>              </span><a name="local-6989586621684658786"><a href="#local-6989586621684658786"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684658785"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span>    </span><a href="CmmNode.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-var">CmmUnsafeForeignCall</span></a><span> </span><a name="local-6989586621684658787"><a href="#local-6989586621684658787"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684658788"><a href="#local-6989586621684658788"><span class="hs-identifier">result_regs</span></a></a><span> </span><a name="local-6989586621684658789"><a href="#local-6989586621684658789"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-222"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#genCCall"><span class="hs-identifier hs-var">genCCall</span></a><span> </span><a href="#local-6989586621684658770"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658771"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684658787"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684658788"><span class="hs-identifier hs-var">result_regs</span></a><span> </span><a href="#local-6989586621684658789"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621684658768"><span class="hs-identifier hs-var">bid</span></a><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span>    </span><a href="CmmNode.html#CmmBranch"><span class="hs-identifier hs-var">CmmBranch</span></a><span> </span><a name="local-6989586621684658790"><a href="#local-6989586621684658790"><span class="hs-identifier">id</span></a></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.CodeGen.html#genBranch"><span class="hs-identifier hs-var">genBranch</span></a><span> </span><a href="#local-6989586621684658790"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span>    </span><span class="hs-comment">--We try to arrange blocks such that the likely branch is the fallthrough</span><span>
</span><a name="line-227"></a><span>    </span><span class="hs-comment">--in CmmContFlowOpt. So we can assume the condition is likely false here.</span><span>
</span><a name="line-228"></a><span>    </span><a href="CmmNode.html#CmmCondBranch"><span class="hs-identifier hs-var">CmmCondBranch</span></a><span> </span><a name="local-6989586621684658791"><a href="#local-6989586621684658791"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621684658792"><a href="#local-6989586621684658792"><span class="hs-identifier">true</span></a></a><span> </span><a name="local-6989586621684658793"><a href="#local-6989586621684658793"><span class="hs-identifier">false</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#genCondBranch"><span class="hs-identifier hs-var">genCondBranch</span></a><span> </span><a href="#local-6989586621684658768"><span class="hs-identifier hs-var">bid</span></a><span> </span><a href="#local-6989586621684658792"><span class="hs-identifier hs-var">true</span></a><span> </span><a href="#local-6989586621684658793"><span class="hs-identifier hs-var">false</span></a><span> </span><a href="#local-6989586621684658791"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-229"></a><span>    </span><a href="CmmNode.html#CmmSwitch"><span class="hs-identifier hs-var">CmmSwitch</span></a><span> </span><a name="local-6989586621684658794"><a href="#local-6989586621684658794"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621684658795"><a href="#local-6989586621684658795"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684658796"><a href="#local-6989586621684658796"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-230"></a><span>                            </span><a href="X86.CodeGen.html#genSwitch"><span class="hs-identifier hs-var">genSwitch</span></a><span> </span><a href="#local-6989586621684658796"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658794"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621684658795"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-231"></a><span>    </span><a href="CmmNode.html#CmmCall"><span class="hs-identifier hs-var">CmmCall</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">cml_target</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684658797"><a href="#local-6989586621684658797"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-232"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cml_args_regs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621684658798"><a href="#local-6989586621684658798"><span class="hs-identifier">gregs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-233"></a><span>                                </span><a name="local-6989586621684658799"><a href="#local-6989586621684658799"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-234"></a><span>                                </span><a href="X86.CodeGen.html#genJump"><span class="hs-identifier hs-var">genJump</span></a><span> </span><a href="#local-6989586621684658797"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#jumpRegs"><span class="hs-identifier hs-var">jumpRegs</span></a><span> </span><a href="#local-6989586621684658799"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658798"><span class="hs-identifier hs-var">gregs</span></a><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-236"></a><span>      </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;stmtToInstrs: statement should have been cps'd away&quot;</span><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-identifier">jumpRegs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#GlobalReg"><span class="hs-identifier hs-type">GlobalReg</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>
</span><a name="line-240"></a><a name="jumpRegs"><a href="X86.CodeGen.html#jumpRegs"><span class="hs-identifier">jumpRegs</span></a></a><span> </span><a name="local-6989586621684658800"><a href="#local-6989586621684658800"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684658801"><a href="#local-6989586621684658801"><span class="hs-identifier">gregs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><a href="#local-6989586621684658803"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684658803"><a href="#local-6989586621684658803"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="CodeGen.Platform.html#globalRegMaybe"><span class="hs-identifier hs-var">globalRegMaybe</span></a><span> </span><a href="#local-6989586621684658802"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658801"><span class="hs-identifier hs-var">gregs</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-241"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684658802"><a href="#local-6989586621684658802"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684658800"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-244"></a><span class="hs-comment">-- | 'InstrBlock's are the insn sequences generated by the insn selectors.</span><span>
</span><a name="line-245"></a><span class="hs-comment">--      They are really trees of insns to facilitate fast appending, where a</span><span>
</span><a name="line-246"></a><span class="hs-comment">--      left-to-right traversal yields the insns in the correct order.</span><span>
</span><a name="line-247"></a><span class="hs-comment">--</span><span>
</span><a name="line-248"></a><span class="hs-keyword">type</span><span> </span><a name="InstrBlock"><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier">InstrBlock</span></a></a><span>
</span><a name="line-249"></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-comment">-- | Condition codes passed up the tree.</span><span>
</span><a name="line-253"></a><span class="hs-comment">--</span><span>
</span><a name="line-254"></a><span class="hs-keyword">data</span><span> </span><a name="CondCode"><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier">CondCode</span></a></a><span>
</span><a name="line-255"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="CondCode"><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier">CondCode</span></a></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><a href="X86.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span>
</span><a name="line-258"></a><span class="hs-comment">-- | a.k.a &quot;Register64&quot;</span><span>
</span><a name="line-259"></a><span class="hs-comment">--      Reg is the lower 32-bit temporary which contains the result.</span><span>
</span><a name="line-260"></a><span class="hs-comment">--      Use getHiVRegFromLo to find the other VRegUnique.</span><span>
</span><a name="line-261"></a><span class="hs-comment">--</span><span>
</span><a name="line-262"></a><span class="hs-comment">--      Rules of this simplified insn selection game are therefore that</span><span>
</span><a name="line-263"></a><span class="hs-comment">--      the returned Reg may be modified</span><span>
</span><a name="line-264"></a><span class="hs-comment">--</span><span>
</span><a name="line-265"></a><span class="hs-keyword">data</span><span> </span><a name="ChildCode64"><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier">ChildCode64</span></a></a><span>
</span><a name="line-266"></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="ChildCode64"><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier">ChildCode64</span></a></a><span>
</span><a name="line-267"></a><span>        </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-268"></a><span>        </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-comment">-- | Register's passed up the tree.  If the stix code forces the register</span><span>
</span><a name="line-272"></a><span class="hs-comment">--      to live in a pre-decided machine register, it comes out as @Fixed@;</span><span>
</span><a name="line-273"></a><span class="hs-comment">--      otherwise, it comes out as @Any@, and the parent can decide which</span><span>
</span><a name="line-274"></a><span class="hs-comment">--      register to put it in.</span><span>
</span><a name="line-275"></a><span class="hs-comment">--</span><span>
</span><a name="line-276"></a><span class="hs-keyword">data</span><span> </span><a name="Register"><a href="X86.CodeGen.html#Register"><span class="hs-identifier">Register</span></a></a><span>
</span><a name="line-277"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="Fixed"><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier">Fixed</span></a></a><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-278"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a name="Any"><a href="X86.CodeGen.html#Any"><span class="hs-identifier">Any</span></a></a><span>   </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-identifier">swizzleRegisterRep</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-282"></a><a name="swizzleRegisterRep"><a href="X86.CodeGen.html#swizzleRegisterRep"><span class="hs-identifier">swizzleRegisterRep</span></a></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658804"><a href="#local-6989586621684658804"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684658805"><a href="#local-6989586621684658805"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684658806"><a href="#local-6989586621684658806"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="#local-6989586621684658806"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684658804"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684658805"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-283"></a><span class="hs-identifier">swizzleRegisterRep</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658807"><a href="#local-6989586621684658807"><span class="hs-identifier">codefn</span></a></a><span class="hs-special">)</span><span>     </span><a name="local-6989586621684658808"><a href="#local-6989586621684658808"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span>   </span><a href="#local-6989586621684658808"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684658807"><span class="hs-identifier hs-var">codefn</span></a><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-comment">-- | Grab the Reg for a CmmReg</span><span>
</span><a name="line-287"></a><span class="hs-identifier">getRegisterReg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><a name="getRegisterReg"><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier">getRegisterReg</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658809"><a href="#local-6989586621684658809"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a><span> </span><a name="local-6989586621684658810"><a href="#local-6989586621684658810"><span class="hs-identifier">u</span></a></a><span> </span><a name="local-6989586621684658811"><a href="#local-6989586621684658811"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-290"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658812"><a href="#local-6989586621684658812"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684658811"><span class="hs-identifier hs-var">pk</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-291"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="Format.html#isFloatFormat"><span class="hs-identifier hs-var">isFloatFormat</span></a><span> </span><a href="#local-6989586621684658812"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658809"><span class="hs-identifier hs-var">use_sse2</span></a><span>
</span><a name="line-292"></a><span>       </span><span class="hs-keyword">then</span><span> </span><a href="Reg.html#RegVirtual"><span class="hs-identifier hs-var">RegVirtual</span></a><span> </span><span class="hs-special">(</span><a href="X86.RegInfo.html#mkVirtualReg"><span class="hs-identifier hs-var">mkVirtualReg</span></a><span> </span><a href="#local-6989586621684658810"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span class="hs-special">)</span><span>
</span><a name="line-293"></a><span>       </span><span class="hs-keyword">else</span><span> </span><a href="Reg.html#RegVirtual"><span class="hs-identifier hs-var">RegVirtual</span></a><span> </span><span class="hs-special">(</span><a href="X86.RegInfo.html#mkVirtualReg"><span class="hs-identifier hs-var">mkVirtualReg</span></a><span> </span><a href="#local-6989586621684658810"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="#local-6989586621684658812"><span class="hs-identifier hs-var">fmt</span></a><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-identifier">getRegisterReg</span><span> </span><a name="local-6989586621684658813"><a href="#local-6989586621684658813"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a name="local-6989586621684658814"><a href="#local-6989586621684658814"><span class="hs-identifier">mid</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-296"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="CodeGen.Platform.html#globalRegMaybe"><span class="hs-identifier hs-var">globalRegMaybe</span></a><span> </span><a href="#local-6989586621684658813"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684658814"><span class="hs-identifier hs-var">mid</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-297"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684658815"><a href="#local-6989586621684658815"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684658815"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-298"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;getRegisterReg-memory&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="#local-6989586621684658814"><span class="hs-identifier hs-var">mid</span></a><span class="hs-special">)</span><span>
</span><a name="line-299"></a><span>        </span><span class="hs-comment">-- By this stage, the only MagicIds remaining should be the</span><span>
</span><a name="line-300"></a><span>        </span><span class="hs-comment">-- ones which map to a real machine register on this</span><span>
</span><a name="line-301"></a><span>        </span><span class="hs-comment">-- platform.  Hence ...</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">-- | Memory addressing modes passed up the tree.</span><span>
</span><a name="line-305"></a><span class="hs-keyword">data</span><span> </span><a name="Amode"><a href="X86.CodeGen.html#Amode"><span class="hs-identifier">Amode</span></a></a><span>
</span><a name="line-306"></a><span>        </span><span class="hs-glyph">=</span><span> </span><a name="Amode"><a href="X86.CodeGen.html#Amode"><span class="hs-identifier">Amode</span></a></a><span> </span><a href="X86.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span class="hs-comment">{-
Now, given a tree (the argument to a CmmLoad) that references memory,
produce a suitable addressing mode.

A Rule of the Game (tm) for Amodes: use of the addr bit must
immediately follow use of the code part, since the code part puts
values in registers which the addr then refers to.  So you can't put
anything in between, lest it overwrite some of those registers.  If
you need to do some other computation between the code part and use of
the addr bit, first store the effective address from the amode in a
temporary, then do the other computation, and then use the temporary:

    code
    LEA amode, tmp
    ... other computation ...
    ... (tmp) ...
-}</span><span>
</span><a name="line-325"></a><span>
</span><a name="line-326"></a><span>
</span><a name="line-327"></a><span class="hs-comment">-- | Check whether an integer will fit in 32 bits.</span><span>
</span><a name="line-328"></a><span class="hs-comment">--      A CmmInt is intended to be truncated to the appropriate</span><span>
</span><a name="line-329"></a><span class="hs-comment">--      number of bits, so here we truncate it to Int64.  This is</span><span>
</span><a name="line-330"></a><span class="hs-comment">--      important because e.g. -1 as a CmmInt might be either</span><span>
</span><a name="line-331"></a><span class="hs-comment">--      -1 or 18446744073709551615.</span><span>
</span><a name="line-332"></a><span class="hs-comment">--</span><span>
</span><a name="line-333"></a><span class="hs-identifier">is32BitInteger</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-334"></a><a name="is32BitInteger"><a href="X86.CodeGen.html#is32BitInteger"><span class="hs-identifier">is32BitInteger</span></a></a><span> </span><a name="local-6989586621684658816"><a href="#local-6989586621684658816"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684658817"><span class="hs-identifier hs-var">i64</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-number">0x7fffffff</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621684658817"><span class="hs-identifier hs-var">i64</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">0x80000000</span><span>
</span><a name="line-335"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684658817"><a href="#local-6989586621684658817"><span class="hs-identifier">i64</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684658816"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int64</span><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-comment">-- | Convert a BlockId to some CmmStatic data</span><span>
</span><a name="line-339"></a><span class="hs-identifier">jumpTableEntry</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cmm.html#CmmStatic"><span class="hs-identifier hs-type">CmmStatic</span></a><span>
</span><a name="line-340"></a><a name="jumpTableEntry"><a href="X86.CodeGen.html#jumpTableEntry"><span class="hs-identifier">jumpTableEntry</span></a></a><span> </span><a name="local-6989586621684658818"><a href="#local-6989586621684658818"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684658818"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span class="hs-identifier">jumpTableEntry</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684658819"><a href="#local-6989586621684658819"><span class="hs-identifier">blockid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a href="#local-6989586621684658820"><span class="hs-identifier hs-var">blockLabel</span></a><span class="hs-special">)</span><span>
</span><a name="line-342"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684658820"><a href="#local-6989586621684658820"><span class="hs-identifier">blockLabel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BlockId.html#blockLbl"><span class="hs-identifier hs-var">blockLbl</span></a><span> </span><a href="#local-6989586621684658819"><span class="hs-identifier hs-var">blockid</span></a><span>
</span><a name="line-343"></a><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-346"></a><span class="hs-comment">-- General things for putting together code sequences</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-- Expand CmmRegOff.  ToDo: should we do it this way around, or convert</span><span>
</span><a name="line-349"></a><span class="hs-comment">-- CmmExprs into CmmRegOff?</span><span>
</span><a name="line-350"></a><span class="hs-identifier">mangleIndexTree</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-351"></a><a name="mangleIndexTree"><a href="X86.CodeGen.html#mangleIndexTree"><span class="hs-identifier">mangleIndexTree</span></a></a><span> </span><a name="local-6989586621684658821"><a href="#local-6989586621684658821"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684658822"><a href="#local-6989586621684658822"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684658823"><a href="#local-6989586621684658823"><span class="hs-identifier">off</span></a></a><span>
</span><a name="line-352"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><a href="#local-6989586621684658824"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><a href="#local-6989586621684658822"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684658823"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658824"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-353"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684658824"><a href="#local-6989586621684658824"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a><span> </span><a href="#local-6989586621684658821"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658822"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-354"></a><span>
</span><a name="line-355"></a><span class="hs-comment">-- | The dual to getAnyReg: compute an expression into a register, but</span><span>
</span><a name="line-356"></a><span class="hs-comment">--      we don't mind which one it is.</span><span>
</span><a name="line-357"></a><span class="hs-identifier">getSomeReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">,</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-358"></a><a name="getSomeReg"><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier">getSomeReg</span></a></a><span> </span><a name="local-6989586621684658825"><a href="#local-6989586621684658825"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-359"></a><span>  </span><a name="local-6989586621684658826"><a href="#local-6989586621684658826"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a><span> </span><a href="#local-6989586621684658825"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-360"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684658826"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-361"></a><span>    </span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a name="local-6989586621684658827"><a href="#local-6989586621684658827"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684658828"><a href="#local-6989586621684658828"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-362"></a><span>        </span><a name="local-6989586621684658829"><a href="#local-6989586621684658829"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684658827"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-363"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658829"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684658828"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684658829"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><span>    </span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658830"><a href="#local-6989586621684658830"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684658831"><a href="#local-6989586621684658831"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-365"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658830"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684658831"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span>
</span><a name="line-368"></a><span class="hs-identifier">assignMem_I64Code</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-369"></a><a name="assignMem_I64Code"><a href="X86.CodeGen.html#assignMem_I64Code"><span class="hs-identifier">assignMem_I64Code</span></a></a><span> </span><a name="local-6989586621684658832"><a href="#local-6989586621684658832"><span class="hs-identifier">addrTree</span></a></a><span> </span><a name="local-6989586621684658833"><a href="#local-6989586621684658833"><span class="hs-identifier">valueTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-370"></a><span>  </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684658834"><a href="#local-6989586621684658834"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684658835"><a href="#local-6989586621684658835"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684658832"><span class="hs-identifier hs-var">addrTree</span></a><span>
</span><a name="line-371"></a><span>  </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658836"><a href="#local-6989586621684658836"><span class="hs-identifier">vcode</span></a></a><span> </span><a name="local-6989586621684658837"><a href="#local-6989586621684658837"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658833"><span class="hs-identifier hs-var">valueTree</span></a><span>
</span><a name="line-372"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-373"></a><span>        </span><a name="local-6989586621684658838"><a href="#local-6989586621684658838"><span class="hs-identifier">rhi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658837"><span class="hs-identifier hs-var">rlo</span></a><span>
</span><a name="line-374"></a><span>
</span><a name="line-375"></a><span>        </span><span class="hs-comment">-- Little-endian store</span><span>
</span><a name="line-376"></a><span>        </span><a name="local-6989586621684658839"><a href="#local-6989586621684658839"><span class="hs-identifier">mov_lo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658837"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684658834"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span>
</span><a name="line-377"></a><span>        </span><a name="local-6989586621684658840"><a href="#local-6989586621684658840"><span class="hs-identifier">mov_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658838"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#addrOffset"><span class="hs-identifier hs-var">addrOffset</span></a><span> </span><a href="#local-6989586621684658834"><span class="hs-identifier hs-var">addr</span></a><span> </span><span class="hs-number">4</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-378"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658836"><span class="hs-identifier hs-var">vcode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684658835"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684658839"><span class="hs-identifier hs-var">mov_lo</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684658840"><span class="hs-identifier hs-var">mov_hi</span></a><span class="hs-special">)</span><span>
</span><a name="line-379"></a><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span class="hs-identifier">assignReg_I64Code</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-382"></a><a name="assignReg_I64Code"><a href="X86.CodeGen.html#assignReg_I64Code"><span class="hs-identifier">assignReg_I64Code</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a><span> </span><a name="local-6989586621684658841"><a href="#local-6989586621684658841"><span class="hs-identifier">u_dst</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684658842"><a href="#local-6989586621684658842"><span class="hs-identifier">valueTree</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-383"></a><span>   </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658843"><a href="#local-6989586621684658843"><span class="hs-identifier">vcode</span></a></a><span> </span><a name="local-6989586621684658844"><a href="#local-6989586621684658844"><span class="hs-identifier">r_src_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658842"><span class="hs-identifier hs-var">valueTree</span></a><span>
</span><a name="line-384"></a><span>   </span><span class="hs-keyword">let</span><span>
</span><a name="line-385"></a><span>         </span><a name="local-6989586621684658845"><a href="#local-6989586621684658845"><span class="hs-identifier">r_dst_lo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#RegVirtual"><span class="hs-identifier hs-var">RegVirtual</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.RegInfo.html#mkVirtualReg"><span class="hs-identifier hs-var">mkVirtualReg</span></a><span> </span><a href="#local-6989586621684658841"><span class="hs-identifier hs-var">u_dst</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-386"></a><span>         </span><a name="local-6989586621684658846"><a href="#local-6989586621684658846"><span class="hs-identifier">r_dst_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658845"><span class="hs-identifier hs-var">r_dst_lo</span></a><span>
</span><a name="line-387"></a><span>         </span><a name="local-6989586621684658847"><a href="#local-6989586621684658847"><span class="hs-identifier">r_src_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658844"><span class="hs-identifier hs-var">r_src_lo</span></a><span>
</span><a name="line-388"></a><span>         </span><a name="local-6989586621684658848"><a href="#local-6989586621684658848"><span class="hs-identifier">mov_lo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658844"><span class="hs-identifier hs-var">r_src_lo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658845"><span class="hs-identifier hs-var">r_dst_lo</span></a><span class="hs-special">)</span><span>
</span><a name="line-389"></a><span>         </span><a name="local-6989586621684658849"><a href="#local-6989586621684658849"><span class="hs-identifier">mov_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658847"><span class="hs-identifier hs-var">r_src_hi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658846"><span class="hs-identifier hs-var">r_dst_hi</span></a><span class="hs-special">)</span><span>
</span><a name="line-390"></a><span>   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-391"></a><span>        </span><a href="#local-6989586621684658843"><span class="hs-identifier hs-var">vcode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684658848"><span class="hs-identifier hs-var">mov_lo</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684658849"><span class="hs-identifier hs-var">mov_hi</span></a><span>
</span><a name="line-392"></a><span>     </span><span class="hs-special">)</span><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span class="hs-identifier">assignReg_I64Code</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-395"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;assignReg_I64Code(i386): invalid lvalue&quot;</span><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span>
</span><a name="line-398"></a><span class="hs-identifier">iselExpr64</span><span>        </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-type">ChildCode64</span></a><span>
</span><a name="line-399"></a><a name="iselExpr64"><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier">iselExpr64</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684658850"><a href="#local-6989586621684658850"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-400"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684658851"><a href="#local-6989586621684658851"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658852"><a href="#local-6989586621684658852"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-401"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-402"></a><span>        </span><a name="local-6989586621684658853"><a href="#local-6989586621684658853"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684658850"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-403"></a><span>        </span><a name="local-6989586621684658854"><a href="#local-6989586621684658854"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658850"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-number">32</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-404"></a><span>        </span><a name="local-6989586621684658855"><a href="#local-6989586621684658855"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-405"></a><span>                </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><a href="#local-6989586621684658853"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658851"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-406"></a><span>                </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><a href="#local-6989586621684658854"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658852"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span>
</span><a name="line-407"></a><span>                </span><span class="hs-special">]</span><span>
</span><a name="line-408"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a href="#local-6989586621684658855"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684658851"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span>
</span><a name="line-409"></a><span>
</span><a name="line-410"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658856"><a href="#local-6989586621684658856"><span class="hs-identifier">addrTree</span></a></a><span> </span><a name="local-6989586621684658857"><a href="#local-6989586621684658857"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684658857"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-411"></a><span>   </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684658858"><a href="#local-6989586621684658858"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684658859"><a href="#local-6989586621684658859"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684658856"><span class="hs-identifier hs-var">addrTree</span></a><span>
</span><a name="line-412"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621684658860"><a href="#local-6989586621684658860"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658861"><a href="#local-6989586621684658861"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-413"></a><span>   </span><span class="hs-keyword">let</span><span>
</span><a name="line-414"></a><span>        </span><a name="local-6989586621684658862"><a href="#local-6989586621684658862"><span class="hs-identifier">mov_lo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684658858"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658860"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span>
</span><a name="line-415"></a><span>        </span><a name="local-6989586621684658863"><a href="#local-6989586621684658863"><span class="hs-identifier">mov_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromJust</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#addrOffset"><span class="hs-identifier hs-var">addrOffset</span></a><span> </span><a href="#local-6989586621684658858"><span class="hs-identifier hs-var">addr</span></a><span> </span><span class="hs-number">4</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658861"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span>
</span><a name="line-416"></a><span>   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-417"></a><span>            </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658859"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684658862"><span class="hs-identifier hs-var">mov_lo</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684658863"><span class="hs-identifier hs-var">mov_hi</span></a><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>                        </span><a href="#local-6989586621684658860"><span class="hs-identifier hs-var">rlo</span></a><span>
</span><a name="line-419"></a><span>     </span><span class="hs-special">)</span><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#LocalReg"><span class="hs-identifier hs-var">LocalReg</span></a><span> </span><a name="local-6989586621684658864"><a href="#local-6989586621684658864"><span class="hs-identifier">vu</span></a></a><span> </span><a name="local-6989586621684658865"><a href="#local-6989586621684658865"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684658865"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-422"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><span class="hs-identifier hs-var">nilOL</span><span> </span><span class="hs-special">(</span><a href="Reg.html#RegVirtual"><span class="hs-identifier hs-var">RegVirtual</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.RegInfo.html#mkVirtualReg"><span class="hs-identifier hs-var">mkVirtualReg</span></a><span> </span><a href="#local-6989586621684658864"><span class="hs-identifier hs-var">vu</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-comment">-- we handle addition, but rather badly</span><span>
</span><a name="line-425"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684658866"><a href="#local-6989586621684658866"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684658867"><a href="#local-6989586621684658867"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-426"></a><span>   </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658868"><a href="#local-6989586621684658868"><span class="hs-identifier">code1</span></a></a><span> </span><a name="local-6989586621684658869"><a href="#local-6989586621684658869"><span class="hs-identifier">r1lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658866"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-427"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621684658870"><a href="#local-6989586621684658870"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658871"><a href="#local-6989586621684658871"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-428"></a><span>   </span><span class="hs-keyword">let</span><span>
</span><a name="line-429"></a><span>        </span><a name="local-6989586621684658872"><a href="#local-6989586621684658872"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684658867"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-430"></a><span>        </span><a name="local-6989586621684658873"><a href="#local-6989586621684658873"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658867"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftR</span><span class="hs-special">`</span><span> </span><span class="hs-number">32</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word32</span><span class="hs-special">)</span><span>
</span><a name="line-431"></a><span>        </span><a name="local-6989586621684658874"><a href="#local-6989586621684658874"><span class="hs-identifier">r1hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658869"><span class="hs-identifier hs-var">r1lo</span></a><span>
</span><a name="line-432"></a><span>        </span><a name="local-6989586621684658875"><a href="#local-6989586621684658875"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621684658868"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-433"></a><span>                </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658869"><span class="hs-identifier hs-var">r1lo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658870"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-434"></a><span>                       </span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><a href="#local-6989586621684658872"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658870"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-435"></a><span>                       </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658874"><span class="hs-identifier hs-var">r1hi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658871"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-436"></a><span>                       </span><a href="X86.Instr.html#ADC"><span class="hs-identifier hs-var">ADC</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><a href="#local-6989586621684658873"><span class="hs-identifier hs-var">q</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658871"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-437"></a><span>   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a href="#local-6989586621684658875"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684658870"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684658876"><a href="#local-6989586621684658876"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658877"><a href="#local-6989586621684658877"><span class="hs-identifier">e2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-440"></a><span>   </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658878"><a href="#local-6989586621684658878"><span class="hs-identifier">code1</span></a></a><span> </span><a name="local-6989586621684658879"><a href="#local-6989586621684658879"><span class="hs-identifier">r1lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658876"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-441"></a><span>   </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658880"><a href="#local-6989586621684658880"><span class="hs-identifier">code2</span></a></a><span> </span><a name="local-6989586621684658881"><a href="#local-6989586621684658881"><span class="hs-identifier">r2lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658877"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-442"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621684658882"><a href="#local-6989586621684658882"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658883"><a href="#local-6989586621684658883"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-443"></a><span>   </span><span class="hs-keyword">let</span><span>
</span><a name="line-444"></a><span>        </span><a name="local-6989586621684658884"><a href="#local-6989586621684658884"><span class="hs-identifier">r1hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658879"><span class="hs-identifier hs-var">r1lo</span></a><span>
</span><a name="line-445"></a><span>        </span><a name="local-6989586621684658885"><a href="#local-6989586621684658885"><span class="hs-identifier">r2hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658881"><span class="hs-identifier hs-var">r2lo</span></a><span>
</span><a name="line-446"></a><span>        </span><a name="local-6989586621684658886"><a href="#local-6989586621684658886"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621684658878"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-447"></a><span>                </span><a href="#local-6989586621684658880"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-448"></a><span>                </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658879"><span class="hs-identifier hs-var">r1lo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658882"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-449"></a><span>                       </span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658881"><span class="hs-identifier hs-var">r2lo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658882"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-450"></a><span>                       </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658884"><span class="hs-identifier hs-var">r1hi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658883"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-451"></a><span>                       </span><a href="X86.Instr.html#ADC"><span class="hs-identifier hs-var">ADC</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658885"><span class="hs-identifier hs-var">r2hi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658883"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-452"></a><span>   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a href="#local-6989586621684658886"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684658882"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span>
</span><a name="line-453"></a><span>
</span><a name="line-454"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684658887"><a href="#local-6989586621684658887"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658888"><a href="#local-6989586621684658888"><span class="hs-identifier">e2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-455"></a><span>   </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658889"><a href="#local-6989586621684658889"><span class="hs-identifier">code1</span></a></a><span> </span><a name="local-6989586621684658890"><a href="#local-6989586621684658890"><span class="hs-identifier">r1lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658887"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-456"></a><span>   </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658891"><a href="#local-6989586621684658891"><span class="hs-identifier">code2</span></a></a><span> </span><a name="local-6989586621684658892"><a href="#local-6989586621684658892"><span class="hs-identifier">r2lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658888"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-457"></a><span>   </span><span class="hs-special">(</span><a name="local-6989586621684658893"><a href="#local-6989586621684658893"><span class="hs-identifier">rlo</span></a></a><span class="hs-special">,</span><a name="local-6989586621684658894"><a href="#local-6989586621684658894"><span class="hs-identifier">rhi</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegPairNat"><span class="hs-identifier hs-var">getNewRegPairNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-458"></a><span>   </span><span class="hs-keyword">let</span><span>
</span><a name="line-459"></a><span>        </span><a name="local-6989586621684658895"><a href="#local-6989586621684658895"><span class="hs-identifier">r1hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658890"><span class="hs-identifier hs-var">r1lo</span></a><span>
</span><a name="line-460"></a><span>        </span><a name="local-6989586621684658896"><a href="#local-6989586621684658896"><span class="hs-identifier">r2hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658892"><span class="hs-identifier hs-var">r2lo</span></a><span>
</span><a name="line-461"></a><span>        </span><a name="local-6989586621684658897"><a href="#local-6989586621684658897"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621684658889"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-462"></a><span>                </span><a href="#local-6989586621684658891"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-463"></a><span>                </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658890"><span class="hs-identifier hs-var">r1lo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658893"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-464"></a><span>                       </span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658892"><span class="hs-identifier hs-var">r2lo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658893"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-465"></a><span>                       </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658895"><span class="hs-identifier hs-var">r1hi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658894"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-466"></a><span>                       </span><a href="X86.Instr.html#SBB"><span class="hs-identifier hs-var">SBB</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658896"><span class="hs-identifier hs-var">r2hi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658894"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-467"></a><span>   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a href="#local-6989586621684658897"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684658893"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684658898"><a href="#local-6989586621684658898"><span class="hs-identifier">expr</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-470"></a><span>     </span><a name="local-6989586621684658899"><a href="#local-6989586621684658899"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684658898"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-471"></a><span>     </span><a name="local-6989586621684658900"><a href="#local-6989586621684658900"><span class="hs-identifier">r_dst_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-472"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658901"><a href="#local-6989586621684658901"><span class="hs-identifier">r_dst_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658900"><span class="hs-identifier hs-var">r_dst_lo</span></a><span>
</span><a name="line-473"></a><span>         </span><a name="local-6989586621684658902"><a href="#local-6989586621684658902"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684658899"><span class="hs-identifier hs-var">fn</span></a><span> </span><a href="#local-6989586621684658900"><span class="hs-identifier hs-var">r_dst_lo</span></a><span>
</span><a name="line-474"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-475"></a><span>             </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658902"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-476"></a><span>                          </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658901"><span class="hs-identifier hs-var">r_dst_hi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-477"></a><span>                          </span><a href="#local-6989586621684658900"><span class="hs-identifier hs-var">r_dst_lo</span></a><span>
</span><a name="line-478"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span class="hs-identifier">iselExpr64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684658903"><a href="#local-6989586621684658903"><span class="hs-identifier">expr</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-481"></a><span>     </span><a name="local-6989586621684658904"><a href="#local-6989586621684658904"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684658903"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-482"></a><span>     </span><a name="local-6989586621684658905"><a href="#local-6989586621684658905"><span class="hs-identifier">r_dst_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-483"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658906"><a href="#local-6989586621684658906"><span class="hs-identifier">r_dst_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658905"><span class="hs-identifier hs-var">r_dst_lo</span></a><span>
</span><a name="line-484"></a><span>         </span><a name="local-6989586621684658907"><a href="#local-6989586621684658907"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684658904"><span class="hs-identifier hs-var">fn</span></a><span> </span><a href="#local-6989586621684658905"><span class="hs-identifier hs-var">r_dst_lo</span></a><span>
</span><a name="line-485"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-486"></a><span>             </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658907"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-487"></a><span>                          </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658905"><span class="hs-identifier hs-var">r_dst_lo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-488"></a><span>                          </span><a href="X86.Instr.html#CLTD"><span class="hs-identifier hs-var">CLTD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-489"></a><span>                          </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658905"><span class="hs-identifier hs-var">r_dst_lo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-490"></a><span>                          </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#edx"><span class="hs-identifier hs-var">edx</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658906"><span class="hs-identifier hs-var">r_dst_hi</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-491"></a><span>                          </span><a href="#local-6989586621684658905"><span class="hs-identifier hs-var">r_dst_lo</span></a><span>
</span><a name="line-492"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-493"></a><span>
</span><a name="line-494"></a><span class="hs-identifier">iselExpr64</span><span> </span><a name="local-6989586621684658908"><a href="#local-6989586621684658908"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-495"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;iselExpr64(i386)&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621684658908"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span>
</span><a name="line-496"></a><span>
</span><a name="line-497"></a><span>
</span><a name="line-498"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-499"></a><span class="hs-identifier">getRegister</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-500"></a><a name="getRegister"><a href="X86.CodeGen.html#getRegister"><span class="hs-identifier">getRegister</span></a></a><span> </span><a name="local-6989586621684658909"><a href="#local-6989586621684658909"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684658910"><a href="#local-6989586621684658910"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-501"></a><span>                   </span><a name="local-6989586621684658911"><a href="#local-6989586621684658911"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-502"></a><span>                   </span><a href="X86.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a><span> </span><a href="#local-6989586621684658910"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658911"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684658909"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-503"></a><span>
</span><a name="line-504"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-505"></a><span>
</span><a name="line-506"></a><a name="getRegister%27"><a href="X86.CodeGen.html#getRegister%27"><span class="hs-identifier">getRegister'</span></a></a><span> </span><a name="local-6989586621684658912"><a href="#local-6989586621684658912"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684658913"><a href="#local-6989586621684658913"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><a name="local-6989586621684658914"><a href="#local-6989586621684658914"><span class="hs-identifier">reg</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-507"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684658914"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-508"></a><span>        </span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="CmmExpr.html#PicBaseReg"><span class="hs-identifier hs-var">PicBaseReg</span></a><span>
</span><a name="line-509"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658913"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-510"></a><span>            </span><span class="hs-comment">-- on x86_64, we have %rip for PicBaseReg, but it's not</span><span>
</span><a name="line-511"></a><span>            </span><span class="hs-comment">-- a full-featured register, it can only be used for</span><span>
</span><a name="line-512"></a><span>            </span><span class="hs-comment">-- rip-relative addressing.</span><span>
</span><a name="line-513"></a><span>            </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684658915"><a href="#local-6989586621684658915"><span class="hs-identifier">reg'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getPicBaseNat"><span class="hs-identifier hs-var">getPicBaseNat</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><a href="#local-6989586621684658913"><span class="hs-identifier hs-var">is32Bit</span></a><span class="hs-special">)</span><span>
</span><a name="line-514"></a><span>               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><a href="#local-6989586621684658913"><span class="hs-identifier hs-var">is32Bit</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658915"><span class="hs-identifier hs-var">reg'</span></a><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-515"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-516"></a><span>            </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684658916"><a href="#local-6989586621684658916"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-517"></a><span>               </span><span class="hs-keyword">let</span><span>
</span><a name="line-518"></a><span>                 </span><a name="local-6989586621684658917"><a href="#local-6989586621684658917"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmRegType"><span class="hs-identifier hs-var">cmmRegType</span></a><span> </span><a href="#local-6989586621684658912"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658914"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-519"></a><span>                 </span><a name="local-6989586621684658918"><a href="#local-6989586621684658918"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658916"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Format.html#isFloatFormat"><span class="hs-identifier hs-var">isFloatFormat</span></a><span> </span><a href="#local-6989586621684658917"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span>
</span><a name="line-520"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684658917"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-521"></a><span>               </span><span class="hs-comment">--</span><span>
</span><a name="line-522"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658919"><a href="#local-6989586621684658919"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684658912"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-523"></a><span>               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="#local-6989586621684658918"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-524"></a><span>                             </span><span class="hs-special">(</span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684658919"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684658916"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><a href="#local-6989586621684658914"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-525"></a><span>                             </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span>
</span><a name="line-527"></a><span>
</span><a name="line-528"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684658920"><a href="#local-6989586621684658920"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684658921"><a href="#local-6989586621684658921"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmRegOff"><span class="hs-identifier hs-var">CmmRegOff</span></a><span> </span><a name="local-6989586621684658922"><a href="#local-6989586621684658922"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621684658923"><a href="#local-6989586621684658923"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-529"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a><span> </span><a href="#local-6989586621684658920"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658921"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.CodeGen.html#mangleIndexTree"><span class="hs-identifier hs-var">mangleIndexTree</span></a><span> </span><a href="#local-6989586621684658920"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658922"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621684658923"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-530"></a><span>
</span><a name="line-531"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684658924"><a href="#local-6989586621684658924"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684658925"><a href="#local-6989586621684658925"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AlignmentCheck"><span class="hs-identifier hs-var">MO_AlignmentCheck</span></a><span> </span><a name="local-6989586621684658926"><a href="#local-6989586621684658926"><span class="hs-identifier">align</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684658927"><a href="#local-6989586621684658927"><span class="hs-identifier">e</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#addAlignmentCheck"><span class="hs-identifier hs-var">addAlignmentCheck</span></a><span> </span><a href="#local-6989586621684658926"><span class="hs-identifier hs-var">align</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="X86.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a><span> </span><a href="#local-6989586621684658924"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658925"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684658927"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-533"></a><span>
</span><a name="line-534"></a><span class="hs-comment">-- for 32-bit architectuers, support some 64 -&gt; 32 bit conversions:</span><span>
</span><a name="line-535"></a><span class="hs-comment">-- TO_W_(x), TO_W_(x &gt;&gt; 32)</span><span>
</span><a name="line-536"></a><span>
</span><a name="line-537"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658928"><a href="#local-6989586621684658928"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span>
</span><a name="line-538"></a><span>                     </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_Shr"><span class="hs-identifier hs-var">MO_U_Shr</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684658929"><a href="#local-6989586621684658929"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">32</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-539"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658928"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-540"></a><span>  </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658930"><a href="#local-6989586621684658930"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684658931"><a href="#local-6989586621684658931"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658929"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-541"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658931"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658930"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658932"><a href="#local-6989586621684658932"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span>
</span><a name="line-544"></a><span>                     </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_Shr"><span class="hs-identifier hs-var">MO_U_Shr</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684658933"><a href="#local-6989586621684658933"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">32</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-545"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658932"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-546"></a><span>  </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658934"><a href="#local-6989586621684658934"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684658935"><a href="#local-6989586621684658935"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658933"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-547"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684658935"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658934"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-548"></a><span>
</span><a name="line-549"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658936"><a href="#local-6989586621684658936"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684658937"><a href="#local-6989586621684658937"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-550"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658936"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-551"></a><span>  </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658938"><a href="#local-6989586621684658938"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684658939"><a href="#local-6989586621684658939"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658937"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-552"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684658939"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684658938"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-553"></a><span>
</span><a name="line-554"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658940"><a href="#local-6989586621684658940"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684658941"><a href="#local-6989586621684658941"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-555"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658940"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-556"></a><span>  </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684658942"><a href="#local-6989586621684658942"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684658943"><a href="#local-6989586621684658943"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684658941"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-557"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684658943"><span class="hs-identifier hs-var">rlo</span></a><span> </span><a href="#local-6989586621684658942"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684658944"><a href="#local-6989586621684658944"><span class="hs-identifier">lit</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmFloat"><span class="hs-identifier hs-var">CmmFloat</span></a><span> </span><a name="local-6989586621684658945"><a href="#local-6989586621684658945"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621684658946"><a href="#local-6989586621684658946"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-560"></a><span>  </span><a href="X86.CodeGen.html#if_sse2"><span class="hs-identifier hs-var">if_sse2</span></a><span> </span><a href="#local-6989586621684658947"><span class="hs-identifier hs-var">float_const_sse2</span></a><span> </span><a href="#local-6989586621684658948"><span class="hs-identifier hs-var">float_const_x87</span></a><span>
</span><a name="line-561"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-562"></a><span>  </span><a name="local-6989586621684658947"><a href="#local-6989586621684658947"><span class="hs-identifier">float_const_sse2</span></a></a><span>
</span><a name="line-563"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658945"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0.0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-564"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-565"></a><span>          </span><a name="local-6989586621684658949"><a href="#local-6989586621684658949"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684658946"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-566"></a><span>          </span><a name="local-6989586621684658950"><a href="#local-6989586621684658950"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684658951"><a href="#local-6989586621684658951"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span>  </span><span class="hs-special">(</span><a href="X86.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span> </span><a href="#local-6989586621684658949"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658951"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658951"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-567"></a><span>        </span><span class="hs-comment">-- I don't know why there are xorpd, xorps, and pxor instructions.</span><span>
</span><a name="line-568"></a><span>        </span><span class="hs-comment">-- They all appear to do the same thing --SDM</span><span>
</span><a name="line-569"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684658949"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684658950"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-572"></a><span>      </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684658952"><a href="#local-6989586621684658952"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684658953"><a href="#local-6989586621684658953"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#memConstant"><span class="hs-identifier hs-var">memConstant</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><a href="#local-6989586621684658946"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658944"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-573"></a><span>      </span><a href="X86.CodeGen.html#loadFloatAmode"><span class="hs-identifier hs-var">loadFloatAmode</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621684658946"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621684658952"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684658953"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-574"></a><span>
</span><a name="line-575"></a><span>  </span><a name="local-6989586621684658948"><a href="#local-6989586621684658948"><span class="hs-identifier">float_const_x87</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684658946"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-576"></a><span>    </span><span class="hs-identifier hs-var">W64</span><span>
</span><a name="line-577"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658945"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0.0</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-578"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658954"><a href="#local-6989586621684658954"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684658955"><a href="#local-6989586621684658955"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#GLDZ"><span class="hs-identifier hs-var">GLDZ</span></a><span> </span><a href="#local-6989586621684658955"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-579"></a><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><a href="#local-6989586621684658954"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-580"></a><span>
</span><a name="line-581"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658945"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1.0</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-582"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684658956"><a href="#local-6989586621684658956"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684658957"><a href="#local-6989586621684658957"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#GLD1"><span class="hs-identifier hs-var">GLD1</span></a><span> </span><a href="#local-6989586621684658957"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-583"></a><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><a href="#local-6989586621684658956"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-584"></a><span>
</span><a name="line-585"></a><span>    </span><a name="local-6989586621684658958"><a href="#local-6989586621684658958"><span class="hs-identifier">_otherwise</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-586"></a><span>      </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684658959"><a href="#local-6989586621684658959"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684658960"><a href="#local-6989586621684658960"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#memConstant"><span class="hs-identifier hs-var">memConstant</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><a href="#local-6989586621684658946"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658944"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-587"></a><span>      </span><a href="X86.CodeGen.html#loadFloatAmode"><span class="hs-identifier hs-var">loadFloatAmode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684658946"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621684658959"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684658960"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-588"></a><span>
</span><a name="line-589"></a><span class="hs-comment">-- catch simple cases of zero- or sign-extended load</span><span>
</span><a name="line-590"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658961"><a href="#local-6989586621684658961"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-591"></a><span>  </span><a name="local-6989586621684658962"><a href="#local-6989586621684658962"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658961"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-592"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684658962"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>
</span><a name="line-594"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658963"><a href="#local-6989586621684658963"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-595"></a><span>  </span><a name="local-6989586621684658964"><a href="#local-6989586621684658964"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658963"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-596"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684658964"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-597"></a><span>
</span><a name="line-598"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658965"><a href="#local-6989586621684658965"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-599"></a><span>  </span><a name="local-6989586621684658966"><a href="#local-6989586621684658966"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658965"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-600"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684658966"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-601"></a><span>
</span><a name="line-602"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658967"><a href="#local-6989586621684658967"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-603"></a><span>  </span><a name="local-6989586621684658968"><a href="#local-6989586621684658968"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658967"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-604"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684658968"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-605"></a><span>
</span><a name="line-606"></a><span class="hs-comment">-- catch simple cases of zero- or sign-extended load</span><span>
</span><a name="line-607"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658969"><a href="#local-6989586621684658969"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658970"><a href="#local-6989586621684658970"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658969"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-609"></a><span>  </span><a name="local-6989586621684658971"><a href="#local-6989586621684658971"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658970"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-610"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684658971"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-611"></a><span>
</span><a name="line-612"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658972"><a href="#local-6989586621684658972"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658973"><a href="#local-6989586621684658973"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-613"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658972"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-614"></a><span>  </span><a name="local-6989586621684658974"><a href="#local-6989586621684658974"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658973"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-615"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684658974"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-616"></a><span>
</span><a name="line-617"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658975"><a href="#local-6989586621684658975"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658976"><a href="#local-6989586621684658976"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-618"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658975"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-619"></a><span>  </span><a name="local-6989586621684658977"><a href="#local-6989586621684658977"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658976"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-620"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684658977"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-621"></a><span>
</span><a name="line-622"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658978"><a href="#local-6989586621684658978"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658979"><a href="#local-6989586621684658979"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-623"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658978"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-624"></a><span>  </span><a name="local-6989586621684658980"><a href="#local-6989586621684658980"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658979"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-625"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684658980"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-626"></a><span>
</span><a name="line-627"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658981"><a href="#local-6989586621684658981"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658982"><a href="#local-6989586621684658982"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-628"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658981"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-629"></a><span>  </span><a name="local-6989586621684658983"><a href="#local-6989586621684658983"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658982"><span class="hs-identifier hs-var">addr</span></a><span> </span><span class="hs-comment">-- 32-bit loads zero-extend</span><span>
</span><a name="line-630"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684658983"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-631"></a><span>
</span><a name="line-632"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658984"><a href="#local-6989586621684658984"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684658985"><a href="#local-6989586621684658985"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-633"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658984"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-634"></a><span>  </span><a name="local-6989586621684658986"><a href="#local-6989586621684658986"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658985"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-635"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684658986"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-636"></a><span>
</span><a name="line-637"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684658987"><a href="#local-6989586621684658987"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="CmmExpr.html#PicBaseReg"><span class="hs-identifier hs-var">PicBaseReg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-638"></a><span>                                     </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684658988"><a href="#local-6989586621684658988"><span class="hs-identifier">displacement</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-639"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658987"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-640"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684658989"><a href="#local-6989586621684658989"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-641"></a><span>        </span><a href="X86.Instr.html#LEA"><span class="hs-identifier hs-var">LEA</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ripRel"><span class="hs-identifier hs-var">ripRel</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684658988"><span class="hs-identifier hs-var">displacement</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684658989"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-642"></a><span>
</span><a name="line-643"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684658990"><a href="#local-6989586621684658990"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684658991"><a href="#local-6989586621684658991"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a name="local-6989586621684658992"><a href="#local-6989586621684658992"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684658993"><a href="#local-6989586621684658993"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- unary MachOps</span><span>
</span><a name="line-644"></a><span>    </span><a name="local-6989586621684659015"><a href="#local-6989586621684659015"><span class="hs-identifier">sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-645"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684658992"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-646"></a><span>      </span><a href="CmmMachOp.html#MO_F_Neg"><span class="hs-identifier hs-var">MO_F_Neg</span></a><span> </span><a name="local-6989586621684659016"><a href="#local-6989586621684659016"><span class="hs-identifier">w</span></a></a><span>
</span><a name="line-647"></a><span>         </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659015"><span class="hs-identifier hs-var">sse2</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#sse2NegCode"><span class="hs-identifier hs-var">sse2NegCode</span></a><span> </span><a href="#local-6989586621684659016"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-648"></a><span>         </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#trivialUFCode"><span class="hs-identifier hs-var">trivialUFCode</span></a><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#GNEG"><span class="hs-identifier hs-var">GNEG</span></a><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span>      </span><a href="CmmMachOp.html#MO_S_Neg"><span class="hs-identifier hs-var">MO_S_Neg</span></a><span> </span><a name="local-6989586621684659017"><a href="#local-6989586621684659017"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658994"><span class="hs-identifier hs-var">triv_ucode</span></a><span> </span><a href="X86.Instr.html#NEGI"><span class="hs-identifier hs-var">NEGI</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659017"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-651"></a><span>      </span><a href="CmmMachOp.html#MO_Not"><span class="hs-identifier hs-var">MO_Not</span></a><span> </span><a name="local-6989586621684659018"><a href="#local-6989586621684659018"><span class="hs-identifier">w</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658994"><span class="hs-identifier hs-var">triv_ucode</span></a><span> </span><a href="X86.Instr.html#NOT"><span class="hs-identifier hs-var">NOT</span></a><span>  </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659018"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-652"></a><span>
</span><a name="line-653"></a><span>      </span><span class="hs-comment">-- Nop conversions</span><span>
</span><a name="line-654"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658996"><span class="hs-identifier hs-var">toI8Reg</span></a><span>  </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-655"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658996"><span class="hs-identifier hs-var">toI8Reg</span></a><span>  </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-656"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658996"><span class="hs-identifier hs-var">toI8Reg</span></a><span>  </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-657"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658996"><span class="hs-identifier hs-var">toI8Reg</span></a><span>  </span><span class="hs-identifier hs-var">W16</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-658"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658996"><span class="hs-identifier hs-var">toI8Reg</span></a><span>  </span><span class="hs-identifier hs-var">W16</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-659"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658996"><span class="hs-identifier hs-var">toI8Reg</span></a><span>  </span><span class="hs-identifier hs-var">W16</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-660"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658997"><span class="hs-identifier hs-var">toI16Reg</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-661"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658997"><span class="hs-identifier hs-var">toI16Reg</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-662"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658997"><span class="hs-identifier hs-var">toI16Reg</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-663"></a><span>
</span><a name="line-664"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658998"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-665"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658998"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-666"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658998"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-667"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658997"><span class="hs-identifier hs-var">toI16Reg</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-668"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658997"><span class="hs-identifier hs-var">toI16Reg</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-669"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658997"><span class="hs-identifier hs-var">toI16Reg</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-670"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658996"><span class="hs-identifier hs-var">toI8Reg</span></a><span>  </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-671"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658996"><span class="hs-identifier hs-var">toI8Reg</span></a><span>  </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-672"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658996"><span class="hs-identifier hs-var">toI8Reg</span></a><span>  </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-673"></a><span>
</span><a name="line-674"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><a name="local-6989586621684659019"><a href="#local-6989586621684659019"><span class="hs-identifier">rep1</span></a></a><span> </span><a name="local-6989586621684659020"><a href="#local-6989586621684659020"><span class="hs-identifier">rep2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659019"><span class="hs-identifier hs-var">rep1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684659020"><span class="hs-identifier hs-var">rep2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658998"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659019"><span class="hs-identifier hs-var">rep1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-675"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><a name="local-6989586621684659021"><a href="#local-6989586621684659021"><span class="hs-identifier">rep1</span></a></a><span> </span><a name="local-6989586621684659022"><a href="#local-6989586621684659022"><span class="hs-identifier">rep2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659021"><span class="hs-identifier hs-var">rep1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684659022"><span class="hs-identifier hs-var">rep2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658998"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659021"><span class="hs-identifier hs-var">rep1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-676"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><a name="local-6989586621684659023"><a href="#local-6989586621684659023"><span class="hs-identifier">rep1</span></a></a><span> </span><a name="local-6989586621684659024"><a href="#local-6989586621684659024"><span class="hs-identifier">rep2</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659023"><span class="hs-identifier hs-var">rep1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684659024"><span class="hs-identifier hs-var">rep2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658998"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659023"><span class="hs-identifier hs-var">rep1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-677"></a><span>
</span><a name="line-678"></a><span>      </span><span class="hs-comment">-- widenings</span><span>
</span><a name="line-679"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-680"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-681"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W16</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-684"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-685"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W16</span><span> </span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-686"></a><span>
</span><a name="line-687"></a><span>      </span><span class="hs-comment">-- We don't care about the upper bits for MO_XX_Conv, so MOV is enough. However, on 32-bit we</span><span>
</span><a name="line-688"></a><span>      </span><span class="hs-comment">-- have 8-bit registers only for a few registers (as opposed to x86-64 where every register</span><span>
</span><a name="line-689"></a><span>      </span><span class="hs-comment">-- has 8-bit version). So for 32-bit code, we'll just zero-extend.</span><span>
</span><a name="line-690"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W32</span><span>
</span><a name="line-691"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-692"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-693"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W16</span><span>
</span><a name="line-694"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-695"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-696"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-697"></a><span>
</span><a name="line-698"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-699"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-700"></a><span>      </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-701"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-702"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-703"></a><span>      </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-704"></a><span>      </span><span class="hs-comment">-- For 32-to-64 bit zero extension, amd64 uses an ordinary movl.</span><span>
</span><a name="line-705"></a><span>      </span><span class="hs-comment">-- However, we don't want the register allocator to throw it</span><span>
</span><a name="line-706"></a><span>      </span><span class="hs-comment">-- away as an unnecessary reg-to-reg move, so we keep it in</span><span>
</span><a name="line-707"></a><span>      </span><span class="hs-comment">-- the form of a movzl and print it as a movl later.</span><span>
</span><a name="line-708"></a><span>      </span><span class="hs-comment">-- This doesn't apply to MO_XX_Conv since in this case we don't care about</span><span>
</span><a name="line-709"></a><span>      </span><span class="hs-comment">-- the upper bits. So we can just use MOV.</span><span>
</span><a name="line-710"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-711"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-712"></a><span>      </span><a href="CmmMachOp.html#MO_XX_Conv"><span class="hs-identifier hs-var">MO_XX_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658995"><span class="hs-identifier hs-var">integerExtend</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-713"></a><span>
</span><a name="line-714"></a><span>      </span><a href="CmmMachOp.html#MO_FF_Conv"><span class="hs-identifier hs-var">MO_FF_Conv</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-identifier hs-var">W64</span><span>
</span><a name="line-715"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659015"><span class="hs-identifier hs-var">sse2</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#coerceFP2FP"><span class="hs-identifier hs-var">coerceFP2FP</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-716"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684658998"><span class="hs-identifier hs-var">conversionNop</span></a><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-717"></a><span>
</span><a name="line-718"></a><span>      </span><a href="CmmMachOp.html#MO_FF_Conv"><span class="hs-identifier hs-var">MO_FF_Conv</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#coerceFP2FP"><span class="hs-identifier hs-var">coerceFP2FP</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-719"></a><span>
</span><a name="line-720"></a><span>      </span><a href="CmmMachOp.html#MO_FS_Conv"><span class="hs-identifier hs-var">MO_FS_Conv</span></a><span> </span><a name="local-6989586621684659025"><a href="#local-6989586621684659025"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684659026"><a href="#local-6989586621684659026"><span class="hs-identifier">to</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#coerceFP2Int"><span class="hs-identifier hs-var">coerceFP2Int</span></a><span> </span><a href="#local-6989586621684659025"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="#local-6989586621684659026"><span class="hs-identifier hs-var">to</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-721"></a><span>      </span><a href="CmmMachOp.html#MO_SF_Conv"><span class="hs-identifier hs-var">MO_SF_Conv</span></a><span> </span><a name="local-6989586621684659027"><a href="#local-6989586621684659027"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684659028"><a href="#local-6989586621684659028"><span class="hs-identifier">to</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#coerceInt2FP"><span class="hs-identifier hs-var">coerceInt2FP</span></a><span> </span><a href="#local-6989586621684659027"><span class="hs-identifier hs-var">from</span></a><span> </span><a href="#local-6989586621684659028"><span class="hs-identifier hs-var">to</span></a><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-722"></a><span>
</span><a name="line-723"></a><span>      </span><a href="CmmMachOp.html#MO_V_Insert"><span class="hs-identifier hs-var">MO_V_Insert</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-724"></a><span>      </span><a href="CmmMachOp.html#MO_V_Extract"><span class="hs-identifier hs-var">MO_V_Extract</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-725"></a><span>      </span><a href="CmmMachOp.html#MO_V_Add"><span class="hs-identifier hs-var">MO_V_Add</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-726"></a><span>      </span><a href="CmmMachOp.html#MO_V_Sub"><span class="hs-identifier hs-var">MO_V_Sub</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-727"></a><span>      </span><a href="CmmMachOp.html#MO_V_Mul"><span class="hs-identifier hs-var">MO_V_Mul</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-728"></a><span>      </span><a href="CmmMachOp.html#MO_VS_Quot"><span class="hs-identifier hs-var">MO_VS_Quot</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-729"></a><span>      </span><a href="CmmMachOp.html#MO_VS_Rem"><span class="hs-identifier hs-var">MO_VS_Rem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-730"></a><span>      </span><a href="CmmMachOp.html#MO_VS_Neg"><span class="hs-identifier hs-var">MO_VS_Neg</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-731"></a><span>      </span><a href="CmmMachOp.html#MO_VU_Quot"><span class="hs-identifier hs-var">MO_VU_Quot</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-732"></a><span>      </span><a href="CmmMachOp.html#MO_VU_Rem"><span class="hs-identifier hs-var">MO_VU_Rem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-733"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Insert"><span class="hs-identifier hs-var">MO_VF_Insert</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-734"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Extract"><span class="hs-identifier hs-var">MO_VF_Extract</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-735"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Add"><span class="hs-identifier hs-var">MO_VF_Add</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-736"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Sub"><span class="hs-identifier hs-var">MO_VF_Sub</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-737"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Mul"><span class="hs-identifier hs-var">MO_VF_Mul</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-738"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Quot"><span class="hs-identifier hs-var">MO_VF_Quot</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-739"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Neg"><span class="hs-identifier hs-var">MO_VF_Neg</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-740"></a><span>
</span><a name="line-741"></a><span>      </span><a name="local-6989586621684659029"><a href="#local-6989586621684659029"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;getRegister&quot;</span><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#pprMachOp"><span class="hs-identifier hs-var">pprMachOp</span></a><span> </span><a href="#local-6989586621684658992"><span class="hs-identifier hs-var">mop</span></a><span class="hs-special">)</span><span>
</span><a name="line-742"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-743"></a><span>        </span><span class="hs-identifier">triv_ucode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-744"></a><span>        </span><a name="local-6989586621684658994"><a href="#local-6989586621684658994"><span class="hs-identifier">triv_ucode</span></a></a><span> </span><a name="local-6989586621684658999"><a href="#local-6989586621684658999"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684659000"><a href="#local-6989586621684659000"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#trivialUCode"><span class="hs-identifier hs-var">trivialUCode</span></a><span> </span><a href="#local-6989586621684659000"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684658999"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684659000"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658993"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-745"></a><span>
</span><a name="line-746"></a><span>        </span><span class="hs-comment">-- signed or unsigned extension.</span><span>
</span><a name="line-747"></a><span>        </span><span class="hs-identifier">integerExtend</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span>
</span><a name="line-748"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-749"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-750"></a><span>        </span><a name="local-6989586621684658995"><a href="#local-6989586621684658995"><span class="hs-identifier">integerExtend</span></a></a><span> </span><a name="local-6989586621684659001"><a href="#local-6989586621684659001"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684659002"><a href="#local-6989586621684659002"><span class="hs-identifier">to</span></a></a><span> </span><a name="local-6989586621684659003"><a href="#local-6989586621684659003"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684659004"><a href="#local-6989586621684659004"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-751"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621684659005"><a href="#local-6989586621684659005"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659006"><a href="#local-6989586621684659006"><span class="hs-identifier">e_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659001"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="X86.CodeGen.html#getByteReg"><span class="hs-identifier hs-var">getByteReg</span></a><span> </span><a href="#local-6989586621684659004"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-752"></a><span>                                          </span><span class="hs-keyword">else</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659004"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-753"></a><span>            </span><span class="hs-keyword">let</span><span>
</span><a name="line-754"></a><span>                </span><a name="local-6989586621684659007"><a href="#local-6989586621684659007"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659008"><a href="#local-6989586621684659008"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-755"></a><span>                  </span><a href="#local-6989586621684659006"><span class="hs-identifier hs-var">e_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-756"></a><span>                  </span><a href="#local-6989586621684659003"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659001"><span class="hs-identifier hs-var">from</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659005"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659008"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-757"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659002"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659007"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-758"></a><span>
</span><a name="line-759"></a><span>        </span><span class="hs-identifier">toI8Reg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-760"></a><span>        </span><a name="local-6989586621684658996"><a href="#local-6989586621684658996"><span class="hs-identifier">toI8Reg</span></a></a><span> </span><a name="local-6989586621684659009"><a href="#local-6989586621684659009"><span class="hs-identifier">new_rep</span></a></a><span> </span><a name="local-6989586621684659010"><a href="#local-6989586621684659010"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-761"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659011"><a href="#local-6989586621684659011"><span class="hs-identifier">codefn</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659010"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-762"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659009"><span class="hs-identifier hs-var">new_rep</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659011"><span class="hs-identifier hs-var">codefn</span></a><span class="hs-special">)</span><span>
</span><a name="line-763"></a><span>                </span><span class="hs-comment">-- HACK: use getAnyReg to get a byte-addressable register.</span><span>
</span><a name="line-764"></a><span>                </span><span class="hs-comment">-- If the source was a Fixed register, this will add the</span><span>
</span><a name="line-765"></a><span>                </span><span class="hs-comment">-- mov instruction to put it into the desired destination.</span><span>
</span><a name="line-766"></a><span>                </span><span class="hs-comment">-- We're assuming that the destination won't be a fixed</span><span>
</span><a name="line-767"></a><span>                </span><span class="hs-comment">-- non-byte-addressable register; it won't be, because all</span><span>
</span><a name="line-768"></a><span>                </span><span class="hs-comment">-- fixed registers are word-sized.</span><span>
</span><a name="line-769"></a><span>
</span><a name="line-770"></a><span>        </span><a name="local-6989586621684658997"><a href="#local-6989586621684658997"><span class="hs-identifier">toI16Reg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684658996"><span class="hs-identifier hs-var">toI8Reg</span></a><span> </span><span class="hs-comment">-- for now</span><span>
</span><a name="line-771"></a><span>
</span><a name="line-772"></a><span>        </span><span class="hs-identifier">conversionNop</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-773"></a><span>        </span><a name="local-6989586621684658998"><a href="#local-6989586621684658998"><span class="hs-identifier">conversionNop</span></a></a><span> </span><a name="local-6989586621684659012"><a href="#local-6989586621684659012"><span class="hs-identifier">new_format</span></a></a><span> </span><a name="local-6989586621684659013"><a href="#local-6989586621684659013"><span class="hs-identifier">expr</span></a></a><span>
</span><a name="line-774"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659014"><a href="#local-6989586621684659014"><span class="hs-identifier">e_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getRegister%27"><span class="hs-identifier hs-var">getRegister'</span></a><span> </span><a href="#local-6989586621684658990"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684658991"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659013"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-775"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#swizzleRegisterRep"><span class="hs-identifier hs-var">swizzleRegisterRep</span></a><span> </span><a href="#local-6989586621684659014"><span class="hs-identifier hs-var">e_code</span></a><span> </span><a href="#local-6989586621684659012"><span class="hs-identifier hs-var">new_format</span></a><span class="hs-special">)</span><span>
</span><a name="line-776"></a><span>
</span><a name="line-777"></a><span>
</span><a name="line-778"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659030"><a href="#local-6989586621684659030"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a name="local-6989586621684659031"><a href="#local-6989586621684659031"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659032"><a href="#local-6989586621684659032"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659033"><a href="#local-6989586621684659033"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- dyadic MachOps</span><span>
</span><a name="line-779"></a><span>  </span><a name="local-6989586621684659118"><a href="#local-6989586621684659118"><span class="hs-identifier">sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-780"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659031"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-781"></a><span>      </span><a href="CmmMachOp.html#MO_F_Eq"><span class="hs-identifier hs-var">MO_F_Eq</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="#local-6989586621684659030"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="X86.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-782"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ne"><span class="hs-identifier hs-var">MO_F_Ne</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="#local-6989586621684659030"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-783"></a><span>      </span><a href="CmmMachOp.html#MO_F_Gt"><span class="hs-identifier hs-var">MO_F_Gt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="#local-6989586621684659030"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="X86.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-784"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ge"><span class="hs-identifier hs-var">MO_F_Ge</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="#local-6989586621684659030"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="X86.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-785"></a><span>      </span><span class="hs-comment">-- Invert comparison condition and swap operands</span><span>
</span><a name="line-786"></a><span>      </span><span class="hs-comment">-- See Note [SSE Parity Checks]</span><span>
</span><a name="line-787"></a><span>      </span><a href="CmmMachOp.html#MO_F_Lt"><span class="hs-identifier hs-var">MO_F_Lt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="#local-6989586621684659030"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="X86.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span>  </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-788"></a><span>      </span><a href="CmmMachOp.html#MO_F_Le"><span class="hs-identifier hs-var">MO_F_Le</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltReg"><span class="hs-identifier hs-var">condFltReg</span></a><span> </span><a href="#local-6989586621684659030"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="X86.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>   </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-789"></a><span>
</span><a name="line-790"></a><span>      </span><a href="CmmMachOp.html#MO_Eq"><span class="hs-identifier hs-var">MO_Eq</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="X86.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-791"></a><span>      </span><a href="CmmMachOp.html#MO_Ne"><span class="hs-identifier hs-var">MO_Ne</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-792"></a><span>
</span><a name="line-793"></a><span>      </span><a href="CmmMachOp.html#MO_S_Gt"><span class="hs-identifier hs-var">MO_S_Gt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="X86.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-794"></a><span>      </span><a href="CmmMachOp.html#MO_S_Ge"><span class="hs-identifier hs-var">MO_S_Ge</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="X86.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-795"></a><span>      </span><a href="CmmMachOp.html#MO_S_Lt"><span class="hs-identifier hs-var">MO_S_Lt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="X86.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-796"></a><span>      </span><a href="CmmMachOp.html#MO_S_Le"><span class="hs-identifier hs-var">MO_S_Le</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="X86.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-797"></a><span>
</span><a name="line-798"></a><span>      </span><a href="CmmMachOp.html#MO_U_Gt"><span class="hs-identifier hs-var">MO_U_Gt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="X86.Cond.html#GU"><span class="hs-identifier hs-var">GU</span></a><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-799"></a><span>      </span><a href="CmmMachOp.html#MO_U_Ge"><span class="hs-identifier hs-var">MO_U_Ge</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="X86.Cond.html#GEU"><span class="hs-identifier hs-var">GEU</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-800"></a><span>      </span><a href="CmmMachOp.html#MO_U_Lt"><span class="hs-identifier hs-var">MO_U_Lt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="X86.Cond.html#LU"><span class="hs-identifier hs-var">LU</span></a><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-801"></a><span>      </span><a href="CmmMachOp.html#MO_U_Le"><span class="hs-identifier hs-var">MO_U_Le</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier hs-var">condIntReg</span></a><span> </span><a href="X86.Cond.html#LEU"><span class="hs-identifier hs-var">LEU</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-802"></a><span>
</span><a name="line-803"></a><span>      </span><a href="CmmMachOp.html#MO_F_Add"><span class="hs-identifier hs-var">MO_F_Add</span></a><span> </span><a name="local-6989586621684659119"><a href="#local-6989586621684659119"><span class="hs-identifier">w</span></a></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659118"><span class="hs-identifier hs-var">sse2</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#trivialFCode_sse2"><span class="hs-identifier hs-var">trivialFCode_sse2</span></a><span> </span><a href="#local-6989586621684659119"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-804"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#trivialFCode_x87"><span class="hs-identifier hs-var">trivialFCode_x87</span></a><span>    </span><a href="X86.Instr.html#GADD"><span class="hs-identifier hs-var">GADD</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-805"></a><span>      </span><a href="CmmMachOp.html#MO_F_Sub"><span class="hs-identifier hs-var">MO_F_Sub</span></a><span> </span><a name="local-6989586621684659120"><a href="#local-6989586621684659120"><span class="hs-identifier">w</span></a></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659118"><span class="hs-identifier hs-var">sse2</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#trivialFCode_sse2"><span class="hs-identifier hs-var">trivialFCode_sse2</span></a><span> </span><a href="#local-6989586621684659120"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-806"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#trivialFCode_x87"><span class="hs-identifier hs-var">trivialFCode_x87</span></a><span>    </span><a href="X86.Instr.html#GSUB"><span class="hs-identifier hs-var">GSUB</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-807"></a><span>      </span><a href="CmmMachOp.html#MO_F_Quot"><span class="hs-identifier hs-var">MO_F_Quot</span></a><span> </span><a name="local-6989586621684659121"><a href="#local-6989586621684659121"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659118"><span class="hs-identifier hs-var">sse2</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#trivialFCode_sse2"><span class="hs-identifier hs-var">trivialFCode_sse2</span></a><span> </span><a href="#local-6989586621684659121"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="X86.Instr.html#FDIV"><span class="hs-identifier hs-var">FDIV</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-808"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#trivialFCode_x87"><span class="hs-identifier hs-var">trivialFCode_x87</span></a><span>    </span><a href="X86.Instr.html#GDIV"><span class="hs-identifier hs-var">GDIV</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-809"></a><span>      </span><a href="CmmMachOp.html#MO_F_Mul"><span class="hs-identifier hs-var">MO_F_Mul</span></a><span> </span><a name="local-6989586621684659122"><a href="#local-6989586621684659122"><span class="hs-identifier">w</span></a></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659118"><span class="hs-identifier hs-var">sse2</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#trivialFCode_sse2"><span class="hs-identifier hs-var">trivialFCode_sse2</span></a><span> </span><a href="#local-6989586621684659122"><span class="hs-identifier hs-var">w</span></a><span> </span><a href="X86.Instr.html#MUL"><span class="hs-identifier hs-var">MUL</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-810"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#trivialFCode_x87"><span class="hs-identifier hs-var">trivialFCode_x87</span></a><span>    </span><a href="X86.Instr.html#GMUL"><span class="hs-identifier hs-var">GMUL</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-811"></a><span>
</span><a name="line-812"></a><span>      </span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><a name="local-6989586621684659123"><a href="#local-6989586621684659123"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659038"><span class="hs-identifier hs-var">add_code</span></a><span> </span><a href="#local-6989586621684659123"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-813"></a><span>      </span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><a name="local-6989586621684659124"><a href="#local-6989586621684659124"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659039"><span class="hs-identifier hs-var">sub_code</span></a><span> </span><a href="#local-6989586621684659124"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-814"></a><span>
</span><a name="line-815"></a><span>      </span><a href="CmmMachOp.html#MO_S_Quot"><span class="hs-identifier hs-var">MO_S_Quot</span></a><span> </span><a name="local-6989586621684659125"><a href="#local-6989586621684659125"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659041"><span class="hs-identifier hs-var">div_code</span></a><span> </span><a href="#local-6989586621684659125"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-identifier hs-var">True</span><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-816"></a><span>      </span><a href="CmmMachOp.html#MO_S_Rem"><span class="hs-identifier hs-var">MO_S_Rem</span></a><span>  </span><a name="local-6989586621684659126"><a href="#local-6989586621684659126"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659041"><span class="hs-identifier hs-var">div_code</span></a><span> </span><a href="#local-6989586621684659126"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-817"></a><span>      </span><a href="CmmMachOp.html#MO_U_Quot"><span class="hs-identifier hs-var">MO_U_Quot</span></a><span> </span><a name="local-6989586621684659127"><a href="#local-6989586621684659127"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659041"><span class="hs-identifier hs-var">div_code</span></a><span> </span><a href="#local-6989586621684659127"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-818"></a><span>      </span><a href="CmmMachOp.html#MO_U_Rem"><span class="hs-identifier hs-var">MO_U_Rem</span></a><span>  </span><a name="local-6989586621684659128"><a href="#local-6989586621684659128"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659041"><span class="hs-identifier hs-var">div_code</span></a><span> </span><a href="#local-6989586621684659128"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-819"></a><span>
</span><a name="line-820"></a><span>      </span><a href="CmmMachOp.html#MO_S_MulMayOflo"><span class="hs-identifier hs-var">MO_S_MulMayOflo</span></a><span> </span><a name="local-6989586621684659129"><a href="#local-6989586621684659129"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659036"><span class="hs-identifier hs-var">imulMayOflo</span></a><span> </span><a href="#local-6989586621684659129"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-821"></a><span>
</span><a name="line-822"></a><span>      </span><a href="CmmMachOp.html#MO_Mul"><span class="hs-identifier hs-var">MO_Mul</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659035"><span class="hs-identifier hs-var">imulW8</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-823"></a><span>      </span><a href="CmmMachOp.html#MO_Mul"><span class="hs-identifier hs-var">MO_Mul</span></a><span> </span><a name="local-6989586621684659130"><a href="#local-6989586621684659130"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659034"><span class="hs-identifier hs-var">triv_op</span></a><span> </span><a href="#local-6989586621684659130"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="X86.Instr.html#IMUL"><span class="hs-identifier hs-var">IMUL</span></a><span>
</span><a name="line-824"></a><span>      </span><a href="CmmMachOp.html#MO_And"><span class="hs-identifier hs-var">MO_And</span></a><span> </span><a name="local-6989586621684659131"><a href="#local-6989586621684659131"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659034"><span class="hs-identifier hs-var">triv_op</span></a><span> </span><a href="#local-6989586621684659131"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="X86.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a><span>
</span><a name="line-825"></a><span>      </span><a href="CmmMachOp.html#MO_Or"><span class="hs-identifier hs-var">MO_Or</span></a><span>  </span><a name="local-6989586621684659132"><a href="#local-6989586621684659132"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659034"><span class="hs-identifier hs-var">triv_op</span></a><span> </span><a href="#local-6989586621684659132"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="X86.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span>
</span><a name="line-826"></a><span>      </span><a href="CmmMachOp.html#MO_Xor"><span class="hs-identifier hs-var">MO_Xor</span></a><span> </span><a name="local-6989586621684659133"><a href="#local-6989586621684659133"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659034"><span class="hs-identifier hs-var">triv_op</span></a><span> </span><a href="#local-6989586621684659133"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="X86.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span>
</span><a name="line-827"></a><span>
</span><a name="line-828"></a><span>        </span><span class="hs-comment">{- Shift ops on x86s have constraints on their source, it
           either has to be Imm, CL or 1
            =&gt; trivialCode is not restrictive enough (sigh.)
        -}</span><span>
</span><a name="line-832"></a><span>      </span><a href="CmmMachOp.html#MO_Shl"><span class="hs-identifier hs-var">MO_Shl</span></a><span> </span><a name="local-6989586621684659134"><a href="#local-6989586621684659134"><span class="hs-identifier">rep</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659037"><span class="hs-identifier hs-var">shift_code</span></a><span> </span><a href="#local-6989586621684659134"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="X86.Instr.html#SHL"><span class="hs-identifier hs-var">SHL</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-comment">{-False-}</span><span>
</span><a name="line-833"></a><span>      </span><a href="CmmMachOp.html#MO_U_Shr"><span class="hs-identifier hs-var">MO_U_Shr</span></a><span> </span><a name="local-6989586621684659135"><a href="#local-6989586621684659135"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659037"><span class="hs-identifier hs-var">shift_code</span></a><span> </span><a href="#local-6989586621684659135"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="X86.Instr.html#SHR"><span class="hs-identifier hs-var">SHR</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-comment">{-False-}</span><span>
</span><a name="line-834"></a><span>      </span><a href="CmmMachOp.html#MO_S_Shr"><span class="hs-identifier hs-var">MO_S_Shr</span></a><span> </span><a name="local-6989586621684659136"><a href="#local-6989586621684659136"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659037"><span class="hs-identifier hs-var">shift_code</span></a><span> </span><a href="#local-6989586621684659136"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="X86.Instr.html#SAR"><span class="hs-identifier hs-var">SAR</span></a><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-comment">{-False-}</span><span>
</span><a name="line-835"></a><span>
</span><a name="line-836"></a><span>      </span><a href="CmmMachOp.html#MO_V_Insert"><span class="hs-identifier hs-var">MO_V_Insert</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-837"></a><span>      </span><a href="CmmMachOp.html#MO_V_Extract"><span class="hs-identifier hs-var">MO_V_Extract</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-838"></a><span>      </span><a href="CmmMachOp.html#MO_V_Add"><span class="hs-identifier hs-var">MO_V_Add</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-839"></a><span>      </span><a href="CmmMachOp.html#MO_V_Sub"><span class="hs-identifier hs-var">MO_V_Sub</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-840"></a><span>      </span><a href="CmmMachOp.html#MO_V_Mul"><span class="hs-identifier hs-var">MO_V_Mul</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-841"></a><span>      </span><a href="CmmMachOp.html#MO_VS_Quot"><span class="hs-identifier hs-var">MO_VS_Quot</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-842"></a><span>      </span><a href="CmmMachOp.html#MO_VS_Rem"><span class="hs-identifier hs-var">MO_VS_Rem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-843"></a><span>      </span><a href="CmmMachOp.html#MO_VS_Neg"><span class="hs-identifier hs-var">MO_VS_Neg</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-844"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Insert"><span class="hs-identifier hs-var">MO_VF_Insert</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-845"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Extract"><span class="hs-identifier hs-var">MO_VF_Extract</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-846"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Add"><span class="hs-identifier hs-var">MO_VF_Add</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-847"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Sub"><span class="hs-identifier hs-var">MO_VF_Sub</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-848"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Mul"><span class="hs-identifier hs-var">MO_VF_Mul</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-849"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Quot"><span class="hs-identifier hs-var">MO_VF_Quot</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-850"></a><span>      </span><a href="CmmMachOp.html#MO_VF_Neg"><span class="hs-identifier hs-var">MO_VF_Neg</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-851"></a><span>
</span><a name="line-852"></a><span>      </span><a name="local-6989586621684659137"><a href="#local-6989586621684659137"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;getRegister(x86) - binary CmmMachOp (1)&quot;</span><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#pprMachOp"><span class="hs-identifier hs-var">pprMachOp</span></a><span> </span><a href="#local-6989586621684659031"><span class="hs-identifier hs-var">mop</span></a><span class="hs-special">)</span><span>
</span><a name="line-853"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-854"></a><span>    </span><span class="hs-comment">--------------------</span><span>
</span><a name="line-855"></a><span>    </span><a name="local-6989586621684659034"><a href="#local-6989586621684659034"><span class="hs-identifier">triv_op</span></a></a><span> </span><a name="local-6989586621684659042"><a href="#local-6989586621684659042"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684659043"><a href="#local-6989586621684659043"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684659042"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684659044"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684659044"><span class="hs-identifier hs-var">op</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659032"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659033"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-856"></a><span>                        </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684659044"><a href="#local-6989586621684659044"><span class="hs-identifier">op</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659043"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659042"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span>
</span><a name="line-857"></a><span>
</span><a name="line-858"></a><span>    </span><span class="hs-comment">-- Special case for IMUL for bytes, since the result of IMULB will be in</span><span>
</span><a name="line-859"></a><span>    </span><span class="hs-comment">-- %ax, the split to %dx/%edx/%rdx and %ax/%eax/%rax happens only for wider</span><span>
</span><a name="line-860"></a><span>    </span><span class="hs-comment">-- values.</span><span>
</span><a name="line-861"></a><span>    </span><span class="hs-identifier">imulW8</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-862"></a><span>    </span><a name="local-6989586621684659035"><a href="#local-6989586621684659035"><span class="hs-identifier">imulW8</span></a></a><span> </span><a name="local-6989586621684659045"><a href="#local-6989586621684659045"><span class="hs-identifier">arg_a</span></a></a><span> </span><a name="local-6989586621684659046"><a href="#local-6989586621684659046"><span class="hs-identifier">arg_b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-863"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684659047"><a href="#local-6989586621684659047"><span class="hs-identifier">a_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659048"><a href="#local-6989586621684659048"><span class="hs-identifier">a_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659045"><span class="hs-identifier hs-var">arg_a</span></a><span>
</span><a name="line-864"></a><span>        </span><a name="local-6989586621684659049"><a href="#local-6989586621684659049"><span class="hs-identifier">b_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659046"><span class="hs-identifier hs-var">arg_b</span></a><span>
</span><a name="line-865"></a><span>
</span><a name="line-866"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659050"><a href="#local-6989586621684659050"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659048"><span class="hs-identifier hs-var">a_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659049"><span class="hs-identifier hs-var">b_code</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-867"></a><span>                   </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#IMUL2"><span class="hs-identifier hs-var">IMUL2</span></a><span> </span><a href="#local-6989586621684659051"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659047"><span class="hs-identifier hs-var">a_reg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-868"></a><span>            </span><a name="local-6989586621684659051"><a href="#local-6989586621684659051"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span>
</span><a name="line-869"></a><span>
</span><a name="line-870"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="#local-6989586621684659051"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span> </span><a href="#local-6989586621684659050"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-871"></a><span>
</span><a name="line-872"></a><span>
</span><a name="line-873"></a><span>    </span><span class="hs-identifier">imulMayOflo</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-874"></a><span>    </span><a name="local-6989586621684659036"><a href="#local-6989586621684659036"><span class="hs-identifier">imulMayOflo</span></a></a><span> </span><a name="local-6989586621684659052"><a href="#local-6989586621684659052"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684659053"><a href="#local-6989586621684659053"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621684659054"><a href="#local-6989586621684659054"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-875"></a><span>         </span><span class="hs-special">(</span><a name="local-6989586621684659055"><a href="#local-6989586621684659055"><span class="hs-identifier">a_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659056"><a href="#local-6989586621684659056"><span class="hs-identifier">a_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659053"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-876"></a><span>         </span><a name="local-6989586621684659057"><a href="#local-6989586621684659057"><span class="hs-identifier">b_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659054"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-877"></a><span>         </span><span class="hs-keyword">let</span><span>
</span><a name="line-878"></a><span>             </span><a name="local-6989586621684659058"><a href="#local-6989586621684659058"><span class="hs-identifier">shift_amt</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659052"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-879"></a><span>                           </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">31</span><span>
</span><a name="line-880"></a><span>                           </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">63</span><span>
</span><a name="line-881"></a><span>                           </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;shift_amt&quot;</span><span>
</span><a name="line-882"></a><span>
</span><a name="line-883"></a><span>             </span><a name="local-6989586621684659059"><a href="#local-6989586621684659059"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659052"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-884"></a><span>             </span><a name="local-6989586621684659060"><a href="#local-6989586621684659060"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659056"><span class="hs-identifier hs-var">a_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659057"><span class="hs-identifier hs-var">b_code</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-885"></a><span>                        </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-886"></a><span>                           </span><a href="X86.Instr.html#IMUL2"><span class="hs-identifier hs-var">IMUL2</span></a><span> </span><a href="#local-6989586621684659059"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659055"><span class="hs-identifier hs-var">a_reg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>   </span><span class="hs-comment">-- result in %edx:%eax</span><span>
</span><a name="line-887"></a><span>                           </span><a href="X86.Instr.html#SAR"><span class="hs-identifier hs-var">SAR</span></a><span> </span><a href="#local-6989586621684659059"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684659058"><span class="hs-identifier hs-var">shift_amt</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-888"></a><span>                                </span><span class="hs-comment">-- sign extend lower part</span><span>
</span><a name="line-889"></a><span>                           </span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span> </span><a href="#local-6989586621684659059"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#edx"><span class="hs-identifier hs-var">edx</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span>
</span><a name="line-890"></a><span>                                </span><span class="hs-comment">-- compare against upper</span><span>
</span><a name="line-891"></a><span>                           </span><span class="hs-comment">-- eax==0 if high part == sign extended low part</span><span>
</span><a name="line-892"></a><span>                        </span><span class="hs-special">]</span><span>
</span><a name="line-893"></a><span>         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="#local-6989586621684659059"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span> </span><a href="#local-6989586621684659060"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-894"></a><span>
</span><a name="line-895"></a><span>    </span><span class="hs-comment">--------------------</span><span>
</span><a name="line-896"></a><span>    </span><span class="hs-identifier">shift_code</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span>
</span><a name="line-897"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-898"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-899"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-900"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-901"></a><span>
</span><a name="line-902"></a><span>    </span><span class="hs-comment">{- Case1: shift length as immediate -}</span><span>
</span><a name="line-903"></a><span>    </span><a name="local-6989586621684659037"><a href="#local-6989586621684659037"><span class="hs-identifier">shift_code</span></a></a><span> </span><a name="local-6989586621684659061"><a href="#local-6989586621684659061"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684659062"><a href="#local-6989586621684659062"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684659063"><a href="#local-6989586621684659063"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659064"><a href="#local-6989586621684659064"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-904"></a><span>          </span><a name="local-6989586621684659065"><a href="#local-6989586621684659065"><span class="hs-identifier">x_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659063"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-905"></a><span>          </span><span class="hs-keyword">let</span><span>
</span><a name="line-906"></a><span>               </span><a name="local-6989586621684659066"><a href="#local-6989586621684659066"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659061"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-907"></a><span>               </span><a name="local-6989586621684659067"><a href="#local-6989586621684659067"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659068"><a href="#local-6989586621684659068"><span class="hs-identifier">dst</span></a></a><span>
</span><a name="line-908"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659065"><span class="hs-identifier hs-var">x_code</span></a><span> </span><a href="#local-6989586621684659068"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-909"></a><span>                    </span><a href="#local-6989586621684659062"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684659066"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659064"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659068"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-910"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684659066"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659067"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-911"></a><span>
</span><a name="line-912"></a><span>    </span><span class="hs-comment">{- Case2: shift length is complex (non-immediate)
      * y must go in %ecx.
      * we cannot do y first *and* put its result in %ecx, because
        %ecx might be clobbered by x.
      * if we do y second, then x cannot be
        in a clobbered reg.  Also, we cannot clobber x's reg
        with the instruction itself.
      * so we can either:
        - do y first, put its result in a fresh tmp, then copy it to %ecx later
        - do y second and put its result into %ecx.  x gets placed in a fresh
          tmp.  This is likely to be better, because the reg alloc can
          eliminate this reg-&gt;reg move here (it won't eliminate the other one,
          because the move is into the fixed %ecx).
    -}</span><span>
</span><a name="line-926"></a><span>    </span><span class="hs-identifier">shift_code</span><span> </span><a name="local-6989586621684659069"><a href="#local-6989586621684659069"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684659070"><a href="#local-6989586621684659070"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684659071"><a href="#local-6989586621684659071"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659072"><a href="#local-6989586621684659072"><span class="hs-identifier">y</span></a></a><span class="hs-comment">{-amount-}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-927"></a><span>        </span><a name="local-6989586621684659073"><a href="#local-6989586621684659073"><span class="hs-identifier">x_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659071"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-928"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659074"><a href="#local-6989586621684659074"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659069"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-929"></a><span>        </span><a name="local-6989586621684659075"><a href="#local-6989586621684659075"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659074"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-930"></a><span>        </span><a name="local-6989586621684659076"><a href="#local-6989586621684659076"><span class="hs-identifier">y_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659072"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-931"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-932"></a><span>           </span><a name="local-6989586621684659077"><a href="#local-6989586621684659077"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659073"><span class="hs-identifier hs-var">x_code</span></a><span> </span><a href="#local-6989586621684659075"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-933"></a><span>                  </span><a href="#local-6989586621684659076"><span class="hs-identifier hs-var">y_code</span></a><span> </span><a href="X86.Regs.html#ecx"><span class="hs-identifier hs-var">ecx</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-934"></a><span>                  </span><a href="#local-6989586621684659070"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684659074"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#ecx"><span class="hs-identifier hs-var">ecx</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659075"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-935"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="#local-6989586621684659074"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659075"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684659077"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-936"></a><span>
</span><a name="line-937"></a><span>    </span><span class="hs-comment">--------------------</span><span>
</span><a name="line-938"></a><span>    </span><span class="hs-identifier">add_code</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-939"></a><span>    </span><a name="local-6989586621684659038"><a href="#local-6989586621684659038"><span class="hs-identifier">add_code</span></a></a><span> </span><a name="local-6989586621684659078"><a href="#local-6989586621684659078"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684659079"><a href="#local-6989586621684659079"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659080"><a href="#local-6989586621684659080"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-940"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#is32BitInteger"><span class="hs-identifier hs-var">is32BitInteger</span></a><span> </span><a href="#local-6989586621684659080"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659040"><span class="hs-identifier hs-var">add_int</span></a><span> </span><a href="#local-6989586621684659078"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684659079"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659080"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-941"></a><span>    </span><span class="hs-identifier">add_code</span><span> </span><a name="local-6989586621684659081"><a href="#local-6989586621684659081"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684659082"><a href="#local-6989586621684659082"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659083"><a href="#local-6989586621684659083"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684659081"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684659084"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="#local-6989586621684659084"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659082"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659083"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-942"></a><span>      </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684659084"><a href="#local-6989586621684659084"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659081"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-943"></a><span>    </span><span class="hs-comment">-- TODO: There are other interesting patterns we want to replace</span><span>
</span><a name="line-944"></a><span>    </span><span class="hs-comment">--     with a LEA, e.g. `(x + offset) + (y &lt;&lt; shift)`.</span><span>
</span><a name="line-945"></a><span>
</span><a name="line-946"></a><span>    </span><span class="hs-comment">--------------------</span><span>
</span><a name="line-947"></a><span>    </span><span class="hs-identifier">sub_code</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-948"></a><span>    </span><a name="local-6989586621684659039"><a href="#local-6989586621684659039"><span class="hs-identifier">sub_code</span></a></a><span> </span><a name="local-6989586621684659085"><a href="#local-6989586621684659085"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684659086"><a href="#local-6989586621684659086"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659087"><a href="#local-6989586621684659087"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-949"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#is32BitInteger"><span class="hs-identifier hs-var">is32BitInteger</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684659087"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659040"><span class="hs-identifier hs-var">add_int</span></a><span> </span><a href="#local-6989586621684659085"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684659086"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621684659087"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-950"></a><span>    </span><span class="hs-identifier">sub_code</span><span> </span><a name="local-6989586621684659088"><a href="#local-6989586621684659088"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684659089"><a href="#local-6989586621684659089"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659090"><a href="#local-6989586621684659090"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684659088"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659088"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621684659089"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659090"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-951"></a><span>
</span><a name="line-952"></a><span>    </span><span class="hs-comment">-- our three-operand add instruction:</span><span>
</span><a name="line-953"></a><span>    </span><a name="local-6989586621684659040"><a href="#local-6989586621684659040"><span class="hs-identifier">add_int</span></a></a><span> </span><a name="local-6989586621684659091"><a href="#local-6989586621684659091"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684659092"><a href="#local-6989586621684659092"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659093"><a href="#local-6989586621684659093"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-954"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684659094"><a href="#local-6989586621684659094"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659095"><a href="#local-6989586621684659095"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659092"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-955"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-956"></a><span>            </span><a name="local-6989586621684659096"><a href="#local-6989586621684659096"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659091"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-957"></a><span>            </span><a name="local-6989586621684659097"><a href="#local-6989586621684659097"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684659093"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-958"></a><span>            </span><a name="local-6989586621684659098"><a href="#local-6989586621684659098"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659099"><a href="#local-6989586621684659099"><span class="hs-identifier">dst</span></a></a><span>
</span><a name="line-959"></a><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659095"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-960"></a><span>                 </span><a href="X86.Instr.html#LEA"><span class="hs-identifier hs-var">LEA</span></a><span> </span><a href="#local-6989586621684659096"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-961"></a><span>                        </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659094"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span> </span><a href="#local-6989586621684659097"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-962"></a><span>                        </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659099"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-963"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-964"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684659096"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659098"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-965"></a><span>
</span><a name="line-966"></a><span>    </span><span class="hs-comment">----------------------</span><span>
</span><a name="line-967"></a><span>
</span><a name="line-968"></a><span>    </span><span class="hs-comment">-- See Note [DIV/IDIV for bytes]</span><span>
</span><a name="line-969"></a><span>    </span><a name="local-6989586621684659041"><a href="#local-6989586621684659041"><span class="hs-identifier">div_code</span></a></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><a name="local-6989586621684659100"><a href="#local-6989586621684659100"><span class="hs-identifier">signed</span></a></a><span> </span><a name="local-6989586621684659101"><a href="#local-6989586621684659101"><span class="hs-identifier">quotient</span></a></a><span> </span><a name="local-6989586621684659102"><a href="#local-6989586621684659102"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659103"><a href="#local-6989586621684659103"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-970"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659104"><a href="#local-6989586621684659104"><span class="hs-identifier">widen</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659100"><span class="hs-identifier hs-var">signed</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W16</span><span>
</span><a name="line-971"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W16</span><span>
</span><a name="line-972"></a><span>        </span><a href="#local-6989586621684659041"><span class="hs-identifier hs-var">div_code</span></a><span>
</span><a name="line-973"></a><span>            </span><span class="hs-identifier hs-var">W16</span><span>
</span><a name="line-974"></a><span>            </span><a href="#local-6989586621684659100"><span class="hs-identifier hs-var">signed</span></a><span>
</span><a name="line-975"></a><span>            </span><a href="#local-6989586621684659101"><span class="hs-identifier hs-var">quotient</span></a><span>
</span><a name="line-976"></a><span>            </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a href="#local-6989586621684659104"><span class="hs-identifier hs-var">widen</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659102"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span>            </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a href="#local-6989586621684659104"><span class="hs-identifier hs-var">widen</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659103"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-978"></a><span>
</span><a name="line-979"></a><span>    </span><span class="hs-identifier">div_code</span><span> </span><a name="local-6989586621684659105"><a href="#local-6989586621684659105"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684659106"><a href="#local-6989586621684659106"><span class="hs-identifier">signed</span></a></a><span> </span><a name="local-6989586621684659107"><a href="#local-6989586621684659107"><span class="hs-identifier">quotient</span></a></a><span> </span><a name="local-6989586621684659108"><a href="#local-6989586621684659108"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659109"><a href="#local-6989586621684659109"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-980"></a><span>           </span><span class="hs-special">(</span><a name="local-6989586621684659110"><a href="#local-6989586621684659110"><span class="hs-identifier">y_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659111"><a href="#local-6989586621684659111"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getRegOrMem"><span class="hs-identifier hs-var">getRegOrMem</span></a><span> </span><a href="#local-6989586621684659109"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-comment">-- cannot be clobbered</span><span>
</span><a name="line-981"></a><span>           </span><a name="local-6989586621684659112"><a href="#local-6989586621684659112"><span class="hs-identifier">x_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659108"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-982"></a><span>           </span><span class="hs-keyword">let</span><span>
</span><a name="line-983"></a><span>             </span><a name="local-6989586621684659113"><a href="#local-6989586621684659113"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659105"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-984"></a><span>             </span><a name="local-6989586621684659114"><a href="#local-6989586621684659114"><span class="hs-identifier">widen</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659106"><span class="hs-identifier hs-var">signed</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#CLTD"><span class="hs-identifier hs-var">CLTD</span></a><span> </span><a href="#local-6989586621684659113"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-985"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span> </span><a href="#local-6989586621684659113"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#edx"><span class="hs-identifier hs-var">edx</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#edx"><span class="hs-identifier hs-var">edx</span></a><span class="hs-special">)</span><span>
</span><a name="line-986"></a><span>
</span><a name="line-987"></a><span>             </span><a name="local-6989586621684659115"><a href="#local-6989586621684659115"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659106"><span class="hs-identifier hs-var">signed</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#IDIV"><span class="hs-identifier hs-var">IDIV</span></a><span>
</span><a name="line-988"></a><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#DIV"><span class="hs-identifier hs-var">DIV</span></a><span>
</span><a name="line-989"></a><span>
</span><a name="line-990"></a><span>             </span><a name="local-6989586621684659116"><a href="#local-6989586621684659116"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659111"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-991"></a><span>                    </span><a href="#local-6989586621684659112"><span class="hs-identifier hs-var">x_code</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-992"></a><span>                    </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659114"><span class="hs-identifier hs-var">widen</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659115"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684659113"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659110"><span class="hs-identifier hs-var">y_op</span></a><span class="hs-special">]</span><span>
</span><a name="line-993"></a><span>
</span><a name="line-994"></a><span>             </span><a name="local-6989586621684659117"><a href="#local-6989586621684659117"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659107"><span class="hs-identifier hs-var">quotient</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span>
</span><a name="line-995"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#edx"><span class="hs-identifier hs-var">edx</span></a><span>
</span><a name="line-996"></a><span>
</span><a name="line-997"></a><span>           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="#local-6989586621684659113"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659117"><span class="hs-identifier hs-var">result</span></a><span> </span><a href="#local-6989586621684659116"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-998"></a><span>
</span><a name="line-999"></a><span>
</span><a name="line-1000"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684659138"><a href="#local-6989586621684659138"><span class="hs-identifier">mem</span></a></a><span> </span><a name="local-6989586621684659139"><a href="#local-6989586621684659139"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1001"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684659139"><span class="hs-identifier hs-var">pk</span></a><span>
</span><a name="line-1002"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1003"></a><span>    </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659140"><a href="#local-6989586621684659140"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684659141"><a href="#local-6989586621684659141"><span class="hs-identifier">mem_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659138"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-1004"></a><span>    </span><a name="local-6989586621684659142"><a href="#local-6989586621684659142"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-1005"></a><span>    </span><a href="X86.CodeGen.html#loadFloatAmode"><span class="hs-identifier hs-var">loadFloatAmode</span></a><span> </span><a href="#local-6989586621684659142"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684659139"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659140"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684659141"><span class="hs-identifier hs-var">mem_code</span></a><span>
</span><a name="line-1006"></a><span>
</span><a name="line-1007"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659143"><a href="#local-6989586621684659143"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684659144"><a href="#local-6989586621684659144"><span class="hs-identifier">mem</span></a></a><span> </span><a name="local-6989586621684659145"><a href="#local-6989586621684659145"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1008"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659143"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684659145"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span>
</span><a name="line-1009"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1010"></a><span>    </span><a name="local-6989586621684659150"><a href="#local-6989586621684659150"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><a href="#local-6989586621684659148"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684659144"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-1011"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684659147"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659150"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1012"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1013"></a><span>    </span><a name="local-6989586621684659146"><a href="#local-6989586621684659146"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684659145"><span class="hs-identifier hs-var">pk</span></a><span>
</span><a name="line-1014"></a><span>    </span><a name="local-6989586621684659147"><a href="#local-6989586621684659147"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659146"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1015"></a><span>    </span><a name="local-6989586621684659148"><a href="#local-6989586621684659148"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659146"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1016"></a><span>                </span><span class="hs-identifier hs-var">W8</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>
</span><a name="line-1017"></a><span>                </span><a name="local-6989586621684659149"><a href="#local-6989586621684659149"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659147"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1018"></a><span>        </span><span class="hs-comment">-- We always zero-extend 8-bit loads, if we</span><span>
</span><a name="line-1019"></a><span>        </span><span class="hs-comment">-- can't think of anything better.  This is because</span><span>
</span><a name="line-1020"></a><span>        </span><span class="hs-comment">-- we can't guarantee access to an 8-bit variant of every register</span><span>
</span><a name="line-1021"></a><span>        </span><span class="hs-comment">-- (esi and edi don't have 8-bit variants), so to make things</span><span>
</span><a name="line-1022"></a><span>        </span><span class="hs-comment">-- simpler we do our 8-bit arithmetic with full 32-bit registers.</span><span>
</span><a name="line-1023"></a><span>
</span><a name="line-1024"></a><span class="hs-comment">-- Simpler memory load code on x86_64</span><span>
</span><a name="line-1025"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659151"><a href="#local-6989586621684659151"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684659152"><a href="#local-6989586621684659152"><span class="hs-identifier">mem</span></a></a><span> </span><a name="local-6989586621684659153"><a href="#local-6989586621684659153"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1026"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684659151"><span class="hs-identifier hs-var">is32Bit</span></a><span>
</span><a name="line-1027"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1028"></a><span>    </span><a name="local-6989586621684659155"><a href="#local-6989586621684659155"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659154"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659152"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-1029"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684659154"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659155"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1030"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684659154"><a href="#local-6989586621684659154"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684659153"><span class="hs-identifier hs-var">pk</span></a><span>
</span><a name="line-1031"></a><span>
</span><a name="line-1032"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659156"><a href="#local-6989586621684659156"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><a name="local-6989586621684659157"><a href="#local-6989586621684659157"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1033"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><a name="line-1034"></a><span>        </span><a name="local-6989586621684659158"><a href="#local-6989586621684659158"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659157"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1035"></a><span>
</span><a name="line-1036"></a><span>        </span><span class="hs-comment">-- x86_64: 32-bit xor is one byte shorter, and zero-extends to 64 bits</span><span>
</span><a name="line-1037"></a><span>        </span><a name="local-6989586621684659159"><a href="#local-6989586621684659159"><span class="hs-identifier">format1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659156"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621684659158"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1038"></a><span>                           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659158"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1039"></a><span>                                </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>
</span><a name="line-1040"></a><span>                                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659158"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1041"></a><span>        </span><a name="local-6989586621684659160"><a href="#local-6989586621684659160"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659161"><a href="#local-6989586621684659161"><span class="hs-identifier">dst</span></a></a><span>
</span><a name="line-1042"></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span> </span><a href="#local-6989586621684659159"><span class="hs-identifier hs-var">format1</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659161"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659161"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1043"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-1044"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684659158"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659160"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1045"></a><span>
</span><a name="line-1046"></a><span>  </span><span class="hs-comment">-- optimisation for loading small literals on x86_64: take advantage</span><span>
</span><a name="line-1047"></a><span>  </span><span class="hs-comment">-- of the automatic zero-extension from 32 to 64 bits, because the 32-bit</span><span>
</span><a name="line-1048"></a><span>  </span><span class="hs-comment">-- instruction forms are shorter.</span><span>
</span><a name="line-1049"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684659162"><a href="#local-6989586621684659162"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659163"><a href="#local-6989586621684659163"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659164"><a href="#local-6989586621684659164"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1050"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684659163"><span class="hs-identifier hs-var">is32Bit</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmLitType"><span class="hs-identifier hs-var">cmmLitType</span></a><span> </span><a href="#local-6989586621684659162"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659164"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659165"><span class="hs-identifier hs-var">isBigLit</span></a><span> </span><a href="#local-6989586621684659164"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-1051"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><a name="line-1052"></a><span>        </span><a name="local-6989586621684659167"><a href="#local-6989586621684659167"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659164"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1053"></a><span>        </span><a name="local-6989586621684659168"><a href="#local-6989586621684659168"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659169"><a href="#local-6989586621684659169"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><a href="#local-6989586621684659167"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659169"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1054"></a><span>    </span><span class="hs-keyword">in</span><span>
</span><a name="line-1055"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684659168"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1056"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1057"></a><span>   </span><a name="local-6989586621684659165"><a href="#local-6989586621684659165"><span class="hs-identifier">isBigLit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659166"><a href="#local-6989586621684659166"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659166"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659166"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0xffffffff</span><span>
</span><a name="line-1058"></a><span>   </span><span class="hs-identifier">isBigLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1059"></a><span>        </span><span class="hs-comment">-- note1: not the same as (not.is32BitLit), because that checks for</span><span>
</span><a name="line-1060"></a><span>        </span><span class="hs-comment">-- signed literals that fit in 32 bits, but we want unsigned</span><span>
</span><a name="line-1061"></a><span>        </span><span class="hs-comment">-- literals here.</span><span>
</span><a name="line-1062"></a><span>        </span><span class="hs-comment">-- note2: all labels are small, because we're assuming the</span><span>
</span><a name="line-1063"></a><span>        </span><span class="hs-comment">-- small memory model (see gcc docs, -mcmodel=small).</span><span>
</span><a name="line-1064"></a><span>
</span><a name="line-1065"></a><span class="hs-identifier">getRegister'</span><span> </span><a name="local-6989586621684659170"><a href="#local-6989586621684659170"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659171"><a href="#local-6989586621684659171"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1066"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659172"><a href="#local-6989586621684659172"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmLitType"><span class="hs-identifier hs-var">cmmLitType</span></a><span> </span><a href="#local-6989586621684659170"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659171"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-1067"></a><span>           </span><a name="local-6989586621684659173"><a href="#local-6989586621684659173"><span class="hs-identifier">imm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659171"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1068"></a><span>           </span><a name="local-6989586621684659174"><a href="#local-6989586621684659174"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659175"><a href="#local-6989586621684659175"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659172"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><a href="#local-6989586621684659173"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659175"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1069"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684659172"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659174"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1070"></a><span>
</span><a name="line-1071"></a><span class="hs-identifier">getRegister'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659176"><a href="#local-6989586621684659176"><span class="hs-identifier">other</span></a></a><span>
</span><a name="line-1072"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#isVecExpr"><span class="hs-identifier hs-var">isVecExpr</span></a><span> </span><a href="#local-6989586621684659176"><span class="hs-identifier hs-var">other</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier hs-var">needLlvm</span></a><span>
</span><a name="line-1073"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;getRegister(x86)&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621684659176"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-1074"></a><span>
</span><a name="line-1075"></a><span>
</span><a name="line-1076"></a><span class="hs-identifier">intLoadCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-1077"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-1078"></a><a name="intLoadCode"><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier">intLoadCode</span></a></a><span> </span><a name="local-6989586621684659177"><a href="#local-6989586621684659177"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684659178"><a href="#local-6989586621684659178"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1079"></a><span>  </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659179"><a href="#local-6989586621684659179"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621684659180"><a href="#local-6989586621684659180"><span class="hs-identifier">mem_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659178"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-1080"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659181"><a href="#local-6989586621684659181"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659180"><span class="hs-identifier hs-var">mem_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659177"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659179"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659181"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1081"></a><span>
</span><a name="line-1082"></a><span class="hs-comment">-- Compute an expression into *any* register, adding the appropriate</span><span>
</span><a name="line-1083"></a><span class="hs-comment">-- move instruction if necessary.</span><span>
</span><a name="line-1084"></a><span class="hs-identifier">getAnyReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-1085"></a><a name="getAnyReg"><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier">getAnyReg</span></a></a><span> </span><a name="local-6989586621684659182"><a href="#local-6989586621684659182"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1086"></a><span>  </span><a name="local-6989586621684659183"><a href="#local-6989586621684659183"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a><span> </span><a href="#local-6989586621684659182"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1087"></a><span>  </span><a href="X86.CodeGen.html#anyReg"><span class="hs-identifier hs-var">anyReg</span></a><span> </span><a href="#local-6989586621684659183"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-1088"></a><span>
</span><a name="line-1089"></a><span class="hs-identifier">anyReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-1090"></a><a name="anyReg"><a href="X86.CodeGen.html#anyReg"><span class="hs-identifier">anyReg</span></a></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659184"><a href="#local-6989586621684659184"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684659184"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1091"></a><span class="hs-identifier">anyReg</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a name="local-6989586621684659185"><a href="#local-6989586621684659185"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684659186"><a href="#local-6989586621684659186"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684659187"><a href="#local-6989586621684659187"><span class="hs-identifier">fcode</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659188"><a href="#local-6989586621684659188"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659187"><span class="hs-identifier hs-var">fcode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="X86.CodeGen.html#reg2reg"><span class="hs-identifier hs-var">reg2reg</span></a><span> </span><a href="#local-6989586621684659185"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684659186"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684659188"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1092"></a><span>
</span><a name="line-1093"></a><span class="hs-comment">-- A bit like getSomeReg, but we want a reg that can be byte-addressed.</span><span>
</span><a name="line-1094"></a><span class="hs-comment">-- Fixed registers might not be byte-addressable, so we make sure we've</span><span>
</span><a name="line-1095"></a><span class="hs-comment">-- got a temporary, inserting an extra reg copy if necessary.</span><span>
</span><a name="line-1096"></a><span class="hs-identifier">getByteReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">,</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-1097"></a><a name="getByteReg"><a href="X86.CodeGen.html#getByteReg"><span class="hs-identifier">getByteReg</span></a></a><span> </span><a name="local-6989586621684659189"><a href="#local-6989586621684659189"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1098"></a><span>  </span><a name="local-6989586621684659190"><a href="#local-6989586621684659190"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-1099"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659190"><span class="hs-identifier hs-var">is32Bit</span></a><span>
</span><a name="line-1100"></a><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659191"><a href="#local-6989586621684659191"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a><span> </span><a href="#local-6989586621684659189"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1101"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659191"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1102"></a><span>                </span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a name="local-6989586621684659192"><a href="#local-6989586621684659192"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684659193"><a href="#local-6989586621684659193"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1103"></a><span>                    </span><a name="local-6989586621684659194"><a href="#local-6989586621684659194"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659192"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-1104"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659194"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659193"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684659194"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-1105"></a><span>                </span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a name="local-6989586621684659195"><a href="#local-6989586621684659195"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684659196"><a href="#local-6989586621684659196"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684659197"><a href="#local-6989586621684659197"><span class="hs-identifier">code</span></a></a><span>
</span><a name="line-1106"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><a href="Reg.html#isVirtualReg"><span class="hs-identifier hs-var">isVirtualReg</span></a><span> </span><a href="#local-6989586621684659196"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659196"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><a href="#local-6989586621684659197"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1107"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1108"></a><span>                        </span><a name="local-6989586621684659198"><a href="#local-6989586621684659198"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659195"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-1109"></a><span>                        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659198"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659197"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="X86.CodeGen.html#reg2reg"><span class="hs-identifier hs-var">reg2reg</span></a><span> </span><a href="#local-6989586621684659195"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684659196"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684659198"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-1110"></a><span>                    </span><span class="hs-comment">-- ToDo: could optimise slightly by checking for</span><span>
</span><a name="line-1111"></a><span>                    </span><span class="hs-comment">-- byte-addressable real registers, but that will</span><span>
</span><a name="line-1112"></a><span>                    </span><span class="hs-comment">-- happen very rarely if at all.</span><span>
</span><a name="line-1113"></a><span>      </span><span class="hs-keyword">else</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659189"><span class="hs-identifier hs-var">expr</span></a><span> </span><span class="hs-comment">-- all regs are byte-addressable on x86_64</span><span>
</span><a name="line-1114"></a><span>
</span><a name="line-1115"></a><span class="hs-comment">-- Another variant: this time we want the result in a register that cannot</span><span>
</span><a name="line-1116"></a><span class="hs-comment">-- be modified by code to evaluate an arbitrary expression.</span><span>
</span><a name="line-1117"></a><span class="hs-identifier">getNonClobberedReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">,</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-1118"></a><a name="getNonClobberedReg"><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier">getNonClobberedReg</span></a></a><span> </span><a name="local-6989586621684659199"><a href="#local-6989586621684659199"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1119"></a><span>  </span><a name="local-6989586621684659200"><a href="#local-6989586621684659200"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1120"></a><span>  </span><a name="local-6989586621684659201"><a href="#local-6989586621684659201"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getRegister"><span class="hs-identifier hs-var">getRegister</span></a><span> </span><a href="#local-6989586621684659199"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1121"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659201"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1122"></a><span>    </span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a name="local-6989586621684659202"><a href="#local-6989586621684659202"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684659203"><a href="#local-6989586621684659203"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1123"></a><span>        </span><a name="local-6989586621684659204"><a href="#local-6989586621684659204"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659202"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-1124"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659204"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659203"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684659204"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-1125"></a><span>    </span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a name="local-6989586621684659205"><a href="#local-6989586621684659205"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684659206"><a href="#local-6989586621684659206"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684659207"><a href="#local-6989586621684659207"><span class="hs-identifier">code</span></a></a><span>
</span><a name="line-1126"></a><span>        </span><span class="hs-comment">-- only certain regs can be clobbered</span><span>
</span><a name="line-1127"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659206"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="X86.Regs.html#instrClobberedRegs"><span class="hs-identifier hs-var">instrClobberedRegs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659200"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1128"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1129"></a><span>                </span><a name="local-6989586621684659208"><a href="#local-6989586621684659208"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659205"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-1130"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659208"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659207"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="X86.CodeGen.html#reg2reg"><span class="hs-identifier hs-var">reg2reg</span></a><span> </span><a href="#local-6989586621684659205"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684659206"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684659208"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-1131"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1132"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659206"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659207"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1133"></a><span>
</span><a name="line-1134"></a><span class="hs-identifier">reg2reg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span>
</span><a name="line-1135"></a><a name="reg2reg"><a href="X86.CodeGen.html#reg2reg"><span class="hs-identifier">reg2reg</span></a></a><span> </span><a name="local-6989586621684659209"><a href="#local-6989586621684659209"><span class="hs-identifier">format</span></a></a><span> </span><a name="local-6989586621684659210"><a href="#local-6989586621684659210"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621684659211"><a href="#local-6989586621684659211"><span class="hs-identifier">dst</span></a></a><span>
</span><a name="line-1136"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659209"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#GMOV"><span class="hs-identifier hs-var">GMOV</span></a><span> </span><a href="#local-6989586621684659210"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684659211"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-1137"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659209"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659210"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659211"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1138"></a><span>
</span><a name="line-1139"></a><span>
</span><a name="line-1140"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-1141"></a><span class="hs-identifier">getAmode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a><span>
</span><a name="line-1142"></a><a name="getAmode"><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier">getAmode</span></a></a><span> </span><a name="local-6989586621684659212"><a href="#local-6989586621684659212"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659213"><a href="#local-6989586621684659213"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-1143"></a><span>                </span><a href="X86.CodeGen.html#getAmode%27"><span class="hs-identifier hs-var">getAmode'</span></a><span> </span><a href="#local-6989586621684659213"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659212"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1144"></a><span>
</span><a name="line-1145"></a><span class="hs-identifier">getAmode'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a><span>
</span><a name="line-1146"></a><a name="getAmode%27"><a href="X86.CodeGen.html#getAmode%27"><span class="hs-identifier">getAmode'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmRegOff"><span class="hs-identifier hs-var">CmmRegOff</span></a><span> </span><a name="local-6989586621684659214"><a href="#local-6989586621684659214"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621684659215"><a href="#local-6989586621684659215"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659216"><a href="#local-6989586621684659216"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1147"></a><span>                                 </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.CodeGen.html#mangleIndexTree"><span class="hs-identifier hs-var">mangleIndexTree</span></a><span> </span><a href="#local-6989586621684659216"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659214"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621684659215"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-1148"></a><span>
</span><a name="line-1149"></a><span class="hs-identifier">getAmode'</span><span> </span><a name="local-6989586621684659217"><a href="#local-6989586621684659217"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmGlobal"><span class="hs-identifier hs-var">CmmGlobal</span></a><span> </span><a href="CmmExpr.html#PicBaseReg"><span class="hs-identifier hs-var">PicBaseReg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1150"></a><span>                                                  </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659218"><a href="#local-6989586621684659218"><span class="hs-identifier">displacement</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1151"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684659217"><span class="hs-identifier hs-var">is32Bit</span></a><span>
</span><a name="line-1152"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ripRel"><span class="hs-identifier hs-var">ripRel</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659218"><span class="hs-identifier hs-var">displacement</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1153"></a><span>
</span><a name="line-1154"></a><span>
</span><a name="line-1155"></a><span class="hs-comment">-- This is all just ridiculous, since it carefully undoes</span><span>
</span><a name="line-1156"></a><span class="hs-comment">-- what mangleIndexTree has just done.</span><span>
</span><a name="line-1157"></a><span class="hs-identifier">getAmode'</span><span> </span><a name="local-6989586621684659219"><a href="#local-6989586621684659219"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><a name="local-6989586621684659220"><a href="#local-6989586621684659220"><span class="hs-identifier">_rep</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659221"><a href="#local-6989586621684659221"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659222"><a href="#local-6989586621684659222"><span class="hs-identifier">lit</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659223"><a href="#local-6989586621684659223"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1158"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier hs-var">is32BitLit</span></a><span> </span><a href="#local-6989586621684659219"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659222"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1159"></a><span>  </span><span class="hs-comment">-- ASSERT(rep == II32)???</span><span>
</span><a name="line-1160"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659224"><a href="#local-6989586621684659224"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659225"><a href="#local-6989586621684659225"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659221"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1161"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659226"><a href="#local-6989586621684659226"><span class="hs-identifier">off</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684659223"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1162"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659224"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span> </span><a href="#local-6989586621684659226"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659225"><span class="hs-identifier hs-var">x_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1163"></a><span>
</span><a name="line-1164"></a><span class="hs-identifier">getAmode'</span><span> </span><a name="local-6989586621684659227"><a href="#local-6989586621684659227"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><a name="local-6989586621684659228"><a href="#local-6989586621684659228"><span class="hs-identifier">_rep</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659229"><a href="#local-6989586621684659229"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659230"><a href="#local-6989586621684659230"><span class="hs-identifier">lit</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1165"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier hs-var">is32BitLit</span></a><span> </span><a href="#local-6989586621684659227"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659230"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1166"></a><span>  </span><span class="hs-comment">-- ASSERT(rep == II32)???</span><span>
</span><a name="line-1167"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659231"><a href="#local-6989586621684659231"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659232"><a href="#local-6989586621684659232"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659229"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1168"></a><span>       </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659233"><a href="#local-6989586621684659233"><span class="hs-identifier">off</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659230"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1169"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659231"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span> </span><a href="#local-6989586621684659233"><span class="hs-identifier hs-var">off</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659232"><span class="hs-identifier hs-var">x_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1170"></a><span>
</span><a name="line-1171"></a><span class="hs-comment">-- Turn (lit1 &lt;&lt; n  + lit2) into  (lit2 + lit1 &lt;&lt; n) so it will be</span><span>
</span><a name="line-1172"></a><span class="hs-comment">-- recognised by the next rule.</span><span>
</span><a name="line-1173"></a><span class="hs-identifier">getAmode'</span><span> </span><a name="local-6989586621684659234"><a href="#local-6989586621684659234"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><a name="local-6989586621684659235"><a href="#local-6989586621684659235"><span class="hs-identifier">rep</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659236"><a href="#local-6989586621684659236"><span class="hs-identifier">a</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Shl"><span class="hs-identifier hs-var">MO_Shl</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1174"></a><span>                                  </span><a name="local-6989586621684659237"><a href="#local-6989586621684659237"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1175"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getAmode%27"><span class="hs-identifier hs-var">getAmode'</span></a><span> </span><a href="#local-6989586621684659234"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><a href="#local-6989586621684659235"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659237"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><a href="#local-6989586621684659236"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1176"></a><span>
</span><a name="line-1177"></a><span class="hs-comment">-- Matches: (x + offset) + (y &lt;&lt; shift)</span><span>
</span><a name="line-1178"></a><span class="hs-identifier">getAmode'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmRegOff"><span class="hs-identifier hs-var">CmmRegOff</span></a><span> </span><a name="local-6989586621684659238"><a href="#local-6989586621684659238"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659239"><a href="#local-6989586621684659239"><span class="hs-identifier">offset</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1179"></a><span>                                   </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Shl"><span class="hs-identifier hs-var">MO_Shl</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1180"></a><span>                                        </span><span class="hs-special">[</span><a name="local-6989586621684659240"><a href="#local-6989586621684659240"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659241"><a href="#local-6989586621684659241"><span class="hs-identifier">shift</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1181"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659241"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659241"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659241"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659241"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-1182"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#x86_complex_amode"><span class="hs-identifier hs-var">x86_complex_amode</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-var">CmmReg</span></a><span> </span><a href="#local-6989586621684659238"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659240"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684659241"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684659239"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span>
</span><a name="line-1183"></a><span>
</span><a name="line-1184"></a><span class="hs-identifier">getAmode'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659242"><a href="#local-6989586621684659242"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Shl"><span class="hs-identifier hs-var">MO_Shl</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1185"></a><span>                                        </span><span class="hs-special">[</span><a name="local-6989586621684659243"><a href="#local-6989586621684659243"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659244"><a href="#local-6989586621684659244"><span class="hs-identifier">shift</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1186"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659244"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659244"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659244"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659244"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-1187"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#x86_complex_amode"><span class="hs-identifier hs-var">x86_complex_amode</span></a><span> </span><a href="#local-6989586621684659242"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659243"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684659244"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1188"></a><span>
</span><a name="line-1189"></a><span class="hs-identifier">getAmode'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1190"></a><span>                </span><span class="hs-special">[</span><a name="local-6989586621684659245"><a href="#local-6989586621684659245"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1191"></a><span>                        </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Shl"><span class="hs-identifier hs-var">MO_Shl</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659246"><a href="#local-6989586621684659246"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659247"><a href="#local-6989586621684659247"><span class="hs-identifier">shift</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-1192"></a><span>                         </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659248"><a href="#local-6989586621684659248"><span class="hs-identifier">offset</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1193"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659247"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659247"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659247"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659247"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-1194"></a><span>  </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="X86.CodeGen.html#is32BitInteger"><span class="hs-identifier hs-var">is32BitInteger</span></a><span> </span><a href="#local-6989586621684659248"><span class="hs-identifier hs-var">offset</span></a><span>
</span><a name="line-1195"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#x86_complex_amode"><span class="hs-identifier hs-var">x86_complex_amode</span></a><span> </span><a href="#local-6989586621684659245"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659246"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684659247"><span class="hs-identifier hs-var">shift</span></a><span> </span><a href="#local-6989586621684659248"><span class="hs-identifier hs-var">offset</span></a><span>
</span><a name="line-1196"></a><span>
</span><a name="line-1197"></a><span class="hs-identifier">getAmode'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659249"><a href="#local-6989586621684659249"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659250"><a href="#local-6989586621684659250"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1198"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#x86_complex_amode"><span class="hs-identifier hs-var">x86_complex_amode</span></a><span> </span><a href="#local-6989586621684659249"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659250"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1199"></a><span>
</span><a name="line-1200"></a><span class="hs-identifier">getAmode'</span><span> </span><a name="local-6989586621684659251"><a href="#local-6989586621684659251"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659252"><a href="#local-6989586621684659252"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier hs-var">is32BitLit</span></a><span> </span><a href="#local-6989586621684659251"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659252"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1201"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmAddr"><span class="hs-identifier hs-var">ImmAddr</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659252"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1202"></a><span>
</span><a name="line-1203"></a><span class="hs-identifier">getAmode'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659253"><a href="#local-6989586621684659253"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1204"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684659254"><a href="#local-6989586621684659254"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659255"><a href="#local-6989586621684659255"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659253"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1205"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659254"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659255"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1206"></a><span>
</span><a name="line-1207"></a><span class="hs-comment">-- | Like 'getAmode', but on 32-bit use simple register addressing</span><span>
</span><a name="line-1208"></a><span class="hs-comment">-- (i.e. no index register). This stops us from running out of</span><span>
</span><a name="line-1209"></a><span class="hs-comment">-- registers on x86 when using instructions such as cmpxchg, which can</span><span>
</span><a name="line-1210"></a><span class="hs-comment">-- use up to three virtual registers and one fixed register.</span><span>
</span><a name="line-1211"></a><span class="hs-identifier">getSimpleAmode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a><span>
</span><a name="line-1212"></a><a name="getSimpleAmode"><a href="X86.CodeGen.html#getSimpleAmode"><span class="hs-identifier">getSimpleAmode</span></a></a><span> </span><a name="local-6989586621684659256"><a href="#local-6989586621684659256"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659257"><a href="#local-6989586621684659257"><span class="hs-identifier">is32Bit</span></a></a><span> </span><a name="local-6989586621684659258"><a href="#local-6989586621684659258"><span class="hs-identifier">addr</span></a></a><span>
</span><a name="line-1213"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659257"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1214"></a><span>        </span><a name="local-6989586621684659259"><a href="#local-6989586621684659259"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659258"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-1215"></a><span>        </span><a name="local-6989586621684659260"><a href="#local-6989586621684659260"><span class="hs-identifier">addr_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684659256"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1216"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659261"><a href="#local-6989586621684659261"><span class="hs-identifier">amode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659260"><span class="hs-identifier hs-var">addr_r</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a href="#local-6989586621684659261"><span class="hs-identifier hs-var">amode</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659259"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><a href="#local-6989586621684659260"><span class="hs-identifier hs-var">addr_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1218"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659258"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-1219"></a><span>
</span><a name="line-1220"></a><span class="hs-identifier">x86_complex_amode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a><span>
</span><a name="line-1221"></a><a name="x86_complex_amode"><a href="X86.CodeGen.html#x86_complex_amode"><span class="hs-identifier">x86_complex_amode</span></a></a><span> </span><a name="local-6989586621684659262"><a href="#local-6989586621684659262"><span class="hs-identifier">base</span></a></a><span> </span><a name="local-6989586621684659263"><a href="#local-6989586621684659263"><span class="hs-identifier">index</span></a></a><span> </span><a name="local-6989586621684659264"><a href="#local-6989586621684659264"><span class="hs-identifier">shift</span></a></a><span> </span><a name="local-6989586621684659265"><a href="#local-6989586621684659265"><span class="hs-identifier">offset</span></a></a><span>
</span><a name="line-1222"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659266"><a href="#local-6989586621684659266"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659267"><a href="#local-6989586621684659267"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659262"><span class="hs-identifier hs-var">base</span></a><span>
</span><a name="line-1223"></a><span>        </span><span class="hs-comment">-- x must be in a temp, because it has to stay live over y_code</span><span>
</span><a name="line-1224"></a><span>        </span><span class="hs-comment">-- we could compre x_reg and y_reg and do something better here...</span><span>
</span><a name="line-1225"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621684659268"><a href="#local-6989586621684659268"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659269"><a href="#local-6989586621684659269"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659263"><span class="hs-identifier hs-var">index</span></a><span>
</span><a name="line-1226"></a><span>       </span><span class="hs-keyword">let</span><span>
</span><a name="line-1227"></a><span>           </span><a name="local-6989586621684659270"><a href="#local-6989586621684659270"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659267"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659269"><span class="hs-identifier hs-var">y_code</span></a><span>
</span><a name="line-1228"></a><span>           </span><a name="local-6989586621684659271"><a href="#local-6989586621684659271"><span class="hs-identifier">base</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659264"><span class="hs-identifier hs-var">shift</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span class="hs-special">;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span class="hs-special">;</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">4</span><span class="hs-special">;</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">8</span><span class="hs-special">;</span><span>
</span><a name="line-1229"></a><span>                                </span><a name="local-6989586621684659272"><a href="#local-6989586621684659272"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;x86_complex_amode: unhandled shift! (&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684659272"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-1230"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659266"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EAIndex"><span class="hs-identifier hs-var">EAIndex</span></a><span> </span><a href="#local-6989586621684659268"><span class="hs-identifier hs-var">y_reg</span></a><span> </span><a href="#local-6989586621684659271"><span class="hs-identifier hs-var">base</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684659265"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1231"></a><span>               </span><a href="#local-6989586621684659270"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1232"></a><span>
</span><a name="line-1233"></a><span>
</span><a name="line-1234"></a><span>
</span><a name="line-1235"></a><span>
</span><a name="line-1236"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1237"></a><span class="hs-comment">-- getOperand: sometimes any operand will do.</span><span>
</span><a name="line-1238"></a><span>
</span><a name="line-1239"></a><span class="hs-comment">-- getNonClobberedOperand: the value of the operand will remain valid across</span><span>
</span><a name="line-1240"></a><span class="hs-comment">-- the computation of an arbitrary expression, unless the expression</span><span>
</span><a name="line-1241"></a><span class="hs-comment">-- is computed directly into a register which the operand refers to</span><span>
</span><a name="line-1242"></a><span class="hs-comment">-- (see trivialCode where this function is used for an example).</span><span>
</span><a name="line-1243"></a><span>
</span><a name="line-1244"></a><span class="hs-identifier">getNonClobberedOperand</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span class="hs-special">,</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-1245"></a><a name="getNonClobberedOperand"><a href="X86.CodeGen.html#getNonClobberedOperand"><span class="hs-identifier">getNonClobberedOperand</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659273"><a href="#local-6989586621684659273"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1246"></a><span>  </span><a name="local-6989586621684659274"><a href="#local-6989586621684659274"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-1247"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659274"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="X86.CodeGen.html#isSuitableFloatingPointLit"><span class="hs-identifier hs-var">isSuitableFloatingPointLit</span></a><span> </span><a href="#local-6989586621684659273"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1248"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1249"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a href="CmmExpr.html#CmmFloat"><span class="hs-identifier hs-var">CmmFloat</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659275"><a href="#local-6989586621684659275"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659273"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1250"></a><span>      </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659276"><a href="#local-6989586621684659276"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684659277"><a href="#local-6989586621684659277"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#memConstant"><span class="hs-identifier hs-var">memConstant</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><a href="#local-6989586621684659275"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659273"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1251"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659276"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659277"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1252"></a><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1253"></a><span>
</span><a name="line-1254"></a><span>  </span><a name="local-6989586621684659278"><a href="#local-6989586621684659278"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-1255"></a><span>  </span><a name="local-6989586621684659279"><a href="#local-6989586621684659279"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1256"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier hs-var">is32BitLit</span></a><span> </span><a href="#local-6989586621684659278"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659273"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isFloatType</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmLitType"><span class="hs-identifier hs-var">cmmLitType</span></a><span> </span><a href="#local-6989586621684659279"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659273"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1257"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659273"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1258"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="X86.CodeGen.html#getNonClobberedOperand_generic"><span class="hs-identifier hs-var">getNonClobberedOperand_generic</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a href="#local-6989586621684659273"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-1259"></a><span>
</span><a name="line-1260"></a><span class="hs-identifier">getNonClobberedOperand</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684659280"><a href="#local-6989586621684659280"><span class="hs-identifier">mem</span></a></a><span> </span><a name="local-6989586621684659281"><a href="#local-6989586621684659281"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1261"></a><span>  </span><a name="local-6989586621684659282"><a href="#local-6989586621684659282"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-1262"></a><span>  </span><a name="local-6989586621684659283"><a href="#local-6989586621684659283"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-1263"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684659281"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659283"><span class="hs-identifier hs-var">use_sse2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1264"></a><span>      </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659282"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684659281"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1265"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1266"></a><span>      </span><a name="local-6989586621684659284"><a href="#local-6989586621684659284"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1267"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659285"><a href="#local-6989586621684659285"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659284"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1268"></a><span>      </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659286"><a href="#local-6989586621684659286"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621684659287"><a href="#local-6989586621684659287"><span class="hs-identifier">mem_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659280"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-1269"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621684659289"><a href="#local-6989586621684659289"><span class="hs-identifier">src'</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659290"><a href="#local-6989586621684659290"><span class="hs-identifier">save_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-1270"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#amodeCouldBeClobbered"><span class="hs-identifier hs-var">amodeCouldBeClobbered</span></a><span> </span><a href="#local-6989586621684659285"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659286"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">)</span><span>
</span><a name="line-1271"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1272"></a><span>                   </span><a name="local-6989586621684659288"><a href="#local-6989586621684659288"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><a href="#local-6989586621684659282"><span class="hs-identifier hs-var">is32Bit</span></a><span class="hs-special">)</span><span>
</span><a name="line-1273"></a><span>                   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659288"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1274"></a><span>                           </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#LEA"><span class="hs-identifier hs-var">LEA</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><a href="#local-6989586621684659282"><span class="hs-identifier hs-var">is32Bit</span></a><span class="hs-special">)</span><span>
</span><a name="line-1275"></a><span>                                       </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659286"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">)</span><span>
</span><a name="line-1276"></a><span>                                       </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659288"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1277"></a><span>                </span><span class="hs-keyword">else</span><span>
</span><a name="line-1278"></a><span>                   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659286"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1279"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659289"><span class="hs-identifier hs-var">src'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659287"><span class="hs-identifier hs-var">mem_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659290"><span class="hs-identifier hs-var">save_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1280"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1281"></a><span>      </span><a href="X86.CodeGen.html#getNonClobberedOperand_generic"><span class="hs-identifier hs-var">getNonClobberedOperand_generic</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a href="#local-6989586621684659280"><span class="hs-identifier hs-var">mem</span></a><span> </span><a href="#local-6989586621684659281"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span>
</span><a name="line-1282"></a><span>
</span><a name="line-1283"></a><span class="hs-identifier">getNonClobberedOperand</span><span> </span><a name="local-6989586621684659291"><a href="#local-6989586621684659291"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getNonClobberedOperand_generic"><span class="hs-identifier hs-var">getNonClobberedOperand_generic</span></a><span> </span><a href="#local-6989586621684659291"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1284"></a><span>
</span><a name="line-1285"></a><span class="hs-identifier">getNonClobberedOperand_generic</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span class="hs-special">,</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-1286"></a><a name="getNonClobberedOperand_generic"><a href="X86.CodeGen.html#getNonClobberedOperand_generic"><span class="hs-identifier">getNonClobberedOperand_generic</span></a></a><span> </span><a name="local-6989586621684659292"><a href="#local-6989586621684659292"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1287"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659293"><a href="#local-6989586621684659293"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659294"><a href="#local-6989586621684659294"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659292"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1288"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659293"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659294"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1289"></a><span>
</span><a name="line-1290"></a><span class="hs-identifier">amodeCouldBeClobbered</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1291"></a><a name="amodeCouldBeClobbered"><a href="X86.CodeGen.html#amodeCouldBeClobbered"><span class="hs-identifier">amodeCouldBeClobbered</span></a></a><span> </span><a name="local-6989586621684659295"><a href="#local-6989586621684659295"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684659296"><a href="#local-6989586621684659296"><span class="hs-identifier">amode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#regClobbered"><span class="hs-identifier hs-var">regClobbered</span></a><span> </span><a href="#local-6989586621684659295"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#addrModeRegs"><span class="hs-identifier hs-var">addrModeRegs</span></a><span> </span><a href="#local-6989586621684659296"><span class="hs-identifier hs-var">amode</span></a><span class="hs-special">)</span><span>
</span><a name="line-1292"></a><span>
</span><a name="line-1293"></a><span class="hs-identifier">regClobbered</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Platform</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1294"></a><a name="regClobbered"><a href="X86.CodeGen.html#regClobbered"><span class="hs-identifier">regClobbered</span></a></a><span> </span><a name="local-6989586621684659297"><a href="#local-6989586621684659297"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RegReal"><span class="hs-identifier hs-var">RegReal</span></a><span> </span><span class="hs-special">(</span><a href="Reg.html#RealRegSingle"><span class="hs-identifier hs-var">RealRegSingle</span></a><span> </span><a name="local-6989586621684659298"><a href="#local-6989586621684659298"><span class="hs-identifier">rr</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CodeGen.Platform.html#freeReg"><span class="hs-identifier hs-var">freeReg</span></a><span> </span><a href="#local-6989586621684659297"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659298"><span class="hs-identifier hs-var">rr</span></a><span>
</span><a name="line-1295"></a><span class="hs-identifier">regClobbered</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1296"></a><span>
</span><a name="line-1297"></a><span class="hs-comment">-- getOperand: the operand is not required to remain valid across the</span><span>
</span><a name="line-1298"></a><span class="hs-comment">-- computation of an arbitrary expression.</span><span>
</span><a name="line-1299"></a><span class="hs-identifier">getOperand</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span class="hs-special">,</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-1300"></a><span>
</span><a name="line-1301"></a><a name="getOperand"><a href="X86.CodeGen.html#getOperand"><span class="hs-identifier">getOperand</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659299"><a href="#local-6989586621684659299"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1302"></a><span>  </span><a name="local-6989586621684659300"><a href="#local-6989586621684659300"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-1303"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659300"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="X86.CodeGen.html#isSuitableFloatingPointLit"><span class="hs-identifier hs-var">isSuitableFloatingPointLit</span></a><span> </span><a href="#local-6989586621684659299"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-1304"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1305"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a href="CmmExpr.html#CmmFloat"><span class="hs-identifier hs-var">CmmFloat</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659301"><a href="#local-6989586621684659301"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659299"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1306"></a><span>      </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659302"><a href="#local-6989586621684659302"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684659303"><a href="#local-6989586621684659303"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#memConstant"><span class="hs-identifier hs-var">memConstant</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><a href="#local-6989586621684659301"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659299"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1307"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659302"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659303"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1308"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1309"></a><span>
</span><a name="line-1310"></a><span>  </span><a name="local-6989586621684659304"><a href="#local-6989586621684659304"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-1311"></a><span>  </span><a name="local-6989586621684659305"><a href="#local-6989586621684659305"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1312"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier hs-var">is32BitLit</span></a><span> </span><a href="#local-6989586621684659304"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659299"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isFloatType</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmLitType"><span class="hs-identifier hs-var">cmmLitType</span></a><span> </span><a href="#local-6989586621684659305"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659299"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1313"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659299"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1314"></a><span>    </span><span class="hs-keyword">else</span><span> </span><a href="X86.CodeGen.html#getOperand_generic"><span class="hs-identifier hs-var">getOperand_generic</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a href="#local-6989586621684659299"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span>
</span><a name="line-1315"></a><span>
</span><a name="line-1316"></a><span class="hs-identifier">getOperand</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684659306"><a href="#local-6989586621684659306"><span class="hs-identifier">mem</span></a></a><span> </span><a name="local-6989586621684659307"><a href="#local-6989586621684659307"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1317"></a><span>  </span><a name="local-6989586621684659308"><a href="#local-6989586621684659308"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-1318"></a><span>  </span><a name="local-6989586621684659309"><a href="#local-6989586621684659309"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-1319"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684659307"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659309"><span class="hs-identifier hs-var">use_sse2</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659308"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684659307"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1320"></a><span>     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1321"></a><span>       </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659310"><a href="#local-6989586621684659310"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621684659311"><a href="#local-6989586621684659311"><span class="hs-identifier">mem_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659306"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-1322"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659310"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659311"><span class="hs-identifier hs-var">mem_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1323"></a><span>     </span><span class="hs-keyword">else</span><span>
</span><a name="line-1324"></a><span>       </span><a href="X86.CodeGen.html#getOperand_generic"><span class="hs-identifier hs-var">getOperand_generic</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a href="#local-6989586621684659306"><span class="hs-identifier hs-var">mem</span></a><span> </span><a href="#local-6989586621684659307"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span>
</span><a name="line-1325"></a><span>
</span><a name="line-1326"></a><span class="hs-identifier">getOperand</span><span> </span><a name="local-6989586621684659312"><a href="#local-6989586621684659312"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getOperand_generic"><span class="hs-identifier hs-var">getOperand_generic</span></a><span> </span><a href="#local-6989586621684659312"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1327"></a><span>
</span><a name="line-1328"></a><span class="hs-identifier">getOperand_generic</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span class="hs-special">,</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-1329"></a><a name="getOperand_generic"><a href="X86.CodeGen.html#getOperand_generic"><span class="hs-identifier">getOperand_generic</span></a></a><span> </span><a name="local-6989586621684659313"><a href="#local-6989586621684659313"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1330"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659314"><a href="#local-6989586621684659314"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659315"><a href="#local-6989586621684659315"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659313"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1331"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659314"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659315"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1332"></a><span>
</span><a name="line-1333"></a><span class="hs-identifier">isOperand</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1334"></a><a name="isOperand"><a href="X86.CodeGen.html#isOperand"><span class="hs-identifier">isOperand</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1335"></a><span class="hs-identifier">isOperand</span><span> </span><a name="local-6989586621684659316"><a href="#local-6989586621684659316"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659317"><a href="#local-6989586621684659317"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier hs-var">is32BitLit</span></a><span> </span><a href="#local-6989586621684659316"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659317"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1336"></a><span>                          </span><span class="hs-operator hs-var">||</span><span> </span><a href="X86.CodeGen.html#isSuitableFloatingPointLit"><span class="hs-identifier hs-var">isSuitableFloatingPointLit</span></a><span> </span><a href="#local-6989586621684659317"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1337"></a><span class="hs-identifier">isOperand</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1338"></a><span>
</span><a name="line-1339"></a><span class="hs-comment">-- | Given a 'Register', produce a new 'Register' with an instruction block</span><span>
</span><a name="line-1340"></a><span class="hs-comment">-- which will check the value for alignment. Used for @-falignment-sanitisation@.</span><span>
</span><a name="line-1341"></a><span class="hs-identifier">addAlignmentCheck</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-1342"></a><a name="addAlignmentCheck"><a href="X86.CodeGen.html#addAlignmentCheck"><span class="hs-identifier">addAlignmentCheck</span></a></a><span> </span><a name="local-6989586621684659318"><a href="#local-6989586621684659318"><span class="hs-identifier">align</span></a></a><span> </span><a name="local-6989586621684659319"><a href="#local-6989586621684659319"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1343"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659319"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1344"></a><span>      </span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a name="local-6989586621684659323"><a href="#local-6989586621684659323"><span class="hs-identifier">fmt</span></a></a><span> </span><a name="local-6989586621684659324"><a href="#local-6989586621684659324"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684659325"><a href="#local-6989586621684659325"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#Fixed"><span class="hs-identifier hs-var">Fixed</span></a><span> </span><a href="#local-6989586621684659323"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684659324"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659325"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659320"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621684659323"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684659324"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1345"></a><span>      </span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a name="local-6989586621684659326"><a href="#local-6989586621684659326"><span class="hs-identifier">fmt</span></a></a><span> </span><a name="local-6989586621684659327"><a href="#local-6989586621684659327"><span class="hs-identifier">f</span></a></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684659326"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659328"><a href="#local-6989586621684659328"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659327"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621684659328"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659320"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621684659326"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684659328"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1346"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1347"></a><span>    </span><span class="hs-identifier">check</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1348"></a><span>    </span><a name="local-6989586621684659320"><a href="#local-6989586621684659320"><span class="hs-identifier">check</span></a></a><span> </span><a name="local-6989586621684659321"><a href="#local-6989586621684659321"><span class="hs-identifier">fmt</span></a></a><span> </span><a name="local-6989586621684659322"><a href="#local-6989586621684659322"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1349"></a><span>        </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">isFloatFormat</span><span> </span><a href="Format.html#isFloatFormat"><span class="hs-identifier hs-var">fmt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1350"></a><span>        </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#TEST"><span class="hs-identifier hs-var">TEST</span></a><span> </span><a href="#local-6989586621684659321"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659318"><span class="hs-identifier hs-var">align</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659322"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1351"></a><span>             </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#JXX_GBL"><span class="hs-identifier hs-var">JXX_GBL</span></a><span> </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="CLabel.html#mkBadAlignmentLabel"><span class="hs-identifier hs-var">mkBadAlignmentLabel</span></a><span>
</span><a name="line-1352"></a><span>             </span><span class="hs-special">]</span><span>
</span><a name="line-1353"></a><span>
</span><a name="line-1354"></a><span class="hs-identifier">memConstant</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-type">Amode</span></a><span>
</span><a name="line-1355"></a><a name="memConstant"><a href="X86.CodeGen.html#memConstant"><span class="hs-identifier">memConstant</span></a></a><span> </span><a name="local-6989586621684659329"><a href="#local-6989586621684659329"><span class="hs-identifier">align</span></a></a><span> </span><a name="local-6989586621684659330"><a href="#local-6989586621684659330"><span class="hs-identifier">lit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1356"></a><span>  </span><a name="local-6989586621684659331"><a href="#local-6989586621684659331"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-1357"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659332"><a href="#local-6989586621684659332"><span class="hs-identifier">rosection</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span> </span><a href="#local-6989586621684659331"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-1358"></a><span>  </span><a name="local-6989586621684659333"><a href="#local-6989586621684659333"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1359"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684659337"><a href="#local-6989586621684659337"><span class="hs-identifier">addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659338"><a href="#local-6989586621684659338"><span class="hs-identifier">addr_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659333"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-1360"></a><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659334"><a href="#local-6989586621684659334"><span class="hs-identifier">dynRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span>
</span><a name="line-1361"></a><span>                                             </span><a href="#local-6989586621684659333"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1362"></a><span>                                             </span><a href="PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a><span>
</span><a name="line-1363"></a><span>                                             </span><a href="#local-6989586621684659331"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-1364"></a><span>                               </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659335"><a href="#local-6989586621684659335"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684659336"><a href="#local-6989586621684659336"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659334"><span class="hs-identifier hs-var">dynRef</span></a><span>
</span><a name="line-1365"></a><span>                               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659335"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659336"><span class="hs-identifier hs-var">addr_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1366"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ripRel"><span class="hs-identifier hs-var">ripRel</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="#local-6989586621684659331"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1367"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659339"><a href="#local-6989586621684659339"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1368"></a><span>        </span><a href="X86.Instr.html#LDATA"><span class="hs-identifier hs-var">LDATA</span></a><span> </span><a href="#local-6989586621684659332"><span class="hs-identifier hs-var">rosection</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659329"><span class="hs-identifier hs-var">align</span></a><span class="hs-special">,</span><span> </span><a href="Cmm.html#Statics"><span class="hs-identifier hs-var">Statics</span></a><span> </span><a href="#local-6989586621684659331"><span class="hs-identifier hs-var">lbl</span></a><span> </span><span class="hs-special">[</span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><a href="#local-6989586621684659330"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1369"></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">consOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659338"><span class="hs-identifier hs-var">addr_code</span></a><span>
</span><a name="line-1370"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a href="#local-6989586621684659337"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684659339"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1371"></a><span>
</span><a name="line-1372"></a><span>
</span><a name="line-1373"></a><span class="hs-identifier">loadFloatAmode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-1374"></a><a name="loadFloatAmode"><a href="X86.CodeGen.html#loadFloatAmode"><span class="hs-identifier">loadFloatAmode</span></a></a><span> </span><a name="local-6989586621684659340"><a href="#local-6989586621684659340"><span class="hs-identifier">use_sse2</span></a></a><span> </span><a name="local-6989586621684659341"><a href="#local-6989586621684659341"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621684659342"><a href="#local-6989586621684659342"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684659343"><a href="#local-6989586621684659343"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1375"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659344"><a href="#local-6989586621684659344"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684659341"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-1376"></a><span>      </span><a name="local-6989586621684659345"><a href="#local-6989586621684659345"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659346"><a href="#local-6989586621684659346"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659343"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1377"></a><span>                 </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659340"><span class="hs-identifier hs-var">use_sse2</span></a><span>
</span><a name="line-1378"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659344"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659342"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659346"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1379"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><a href="X86.Instr.html#GLD"><span class="hs-identifier hs-var">GLD</span></a><span> </span><a href="#local-6989586621684659344"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659342"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684659346"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-1380"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659340"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621684659344"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659345"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1381"></a><span>
</span><a name="line-1382"></a><span>
</span><a name="line-1383"></a><span class="hs-comment">-- if we want a floating-point literal as an operand, we can</span><span>
</span><a name="line-1384"></a><span class="hs-comment">-- use it directly from memory.  However, if the literal is</span><span>
</span><a name="line-1385"></a><span class="hs-comment">-- zero, we're better off generating it into a register using</span><span>
</span><a name="line-1386"></a><span class="hs-comment">-- xor.</span><span>
</span><a name="line-1387"></a><span class="hs-identifier">isSuitableFloatingPointLit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1388"></a><a name="isSuitableFloatingPointLit"><a href="X86.CodeGen.html#isSuitableFloatingPointLit"><span class="hs-identifier">isSuitableFloatingPointLit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmFloat"><span class="hs-identifier hs-var">CmmFloat</span></a><span> </span><a name="local-6989586621684659347"><a href="#local-6989586621684659347"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659347"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0.0</span><span>
</span><a name="line-1389"></a><span class="hs-identifier">isSuitableFloatingPointLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1390"></a><span>
</span><a name="line-1391"></a><span class="hs-identifier">getRegOrMem</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span class="hs-special">,</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-1392"></a><a name="getRegOrMem"><a href="X86.CodeGen.html#getRegOrMem"><span class="hs-identifier">getRegOrMem</span></a></a><span> </span><a name="local-6989586621684659348"><a href="#local-6989586621684659348"><span class="hs-identifier">e</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684659349"><a href="#local-6989586621684659349"><span class="hs-identifier">mem</span></a></a><span> </span><a name="local-6989586621684659350"><a href="#local-6989586621684659350"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1393"></a><span>  </span><a name="local-6989586621684659351"><a href="#local-6989586621684659351"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-1394"></a><span>  </span><a name="local-6989586621684659352"><a href="#local-6989586621684659352"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-1395"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684659350"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659352"><span class="hs-identifier hs-var">use_sse2</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659351"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684659350"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-1396"></a><span>     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1397"></a><span>       </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659353"><a href="#local-6989586621684659353"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621684659354"><a href="#local-6989586621684659354"><span class="hs-identifier">mem_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659349"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-1398"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659353"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659354"><span class="hs-identifier hs-var">mem_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1399"></a><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1400"></a><span>       </span><span class="hs-special">(</span><a name="local-6989586621684659355"><a href="#local-6989586621684659355"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659356"><a href="#local-6989586621684659356"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659348"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1401"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659355"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659356"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1402"></a><span class="hs-identifier">getRegOrMem</span><span> </span><a name="local-6989586621684659357"><a href="#local-6989586621684659357"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1403"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659358"><a href="#local-6989586621684659358"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659359"><a href="#local-6989586621684659359"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659357"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-1404"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659358"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659359"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1405"></a><span>
</span><a name="line-1406"></a><span class="hs-identifier">is32BitLit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-type">CmmLit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1407"></a><a name="is32BitLit"><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier">is32BitLit</span></a></a><span> </span><a name="local-6989586621684659360"><a href="#local-6989586621684659360"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659361"><a href="#local-6989586621684659361"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span>
</span><a name="line-1408"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684659360"><span class="hs-identifier hs-var">is32Bit</span></a><span>
</span><a name="line-1409"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- assume that labels are in the range 0-2^31-1: this assumes the</span><span>
</span><a name="line-1410"></a><span>      </span><span class="hs-comment">-- small memory model (see gcc docs, -mcmodel=small).</span><span>
</span><a name="line-1411"></a><span>      </span><a href="X86.CodeGen.html#is32BitInteger"><span class="hs-identifier hs-var">is32BitInteger</span></a><span> </span><a href="#local-6989586621684659361"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-1412"></a><span class="hs-identifier">is32BitLit</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1413"></a><span>
</span><a name="line-1414"></a><span>
</span><a name="line-1415"></a><span>
</span><a name="line-1416"></a><span>
</span><a name="line-1417"></a><span class="hs-comment">-- Set up a condition code for a conditional branch.</span><span>
</span><a name="line-1418"></a><span>
</span><a name="line-1419"></a><span class="hs-identifier">getCondCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-type">CondCode</span></a><span>
</span><a name="line-1420"></a><span>
</span><a name="line-1421"></a><span class="hs-comment">-- yes, they really do seem to want exactly the same!</span><span>
</span><a name="line-1422"></a><span>
</span><a name="line-1423"></a><a name="getCondCode"><a href="X86.CodeGen.html#getCondCode"><span class="hs-identifier">getCondCode</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a name="local-6989586621684659362"><a href="#local-6989586621684659362"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659363"><a href="#local-6989586621684659363"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659364"><a href="#local-6989586621684659364"><span class="hs-identifier">y</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1424"></a><span>  </span><span class="hs-glyph">=</span><span>
</span><a name="line-1425"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659362"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1426"></a><span>      </span><a href="CmmMachOp.html#MO_F_Eq"><span class="hs-identifier hs-var">MO_F_Eq</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1427"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ne"><span class="hs-identifier hs-var">MO_F_Ne</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1428"></a><span>      </span><a href="CmmMachOp.html#MO_F_Gt"><span class="hs-identifier hs-var">MO_F_Gt</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1429"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ge"><span class="hs-identifier hs-var">MO_F_Ge</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1430"></a><span>      </span><span class="hs-comment">-- Invert comparison condition and swap operands</span><span>
</span><a name="line-1431"></a><span>      </span><span class="hs-comment">-- See Note [SSE Parity Checks]</span><span>
</span><a name="line-1432"></a><span>      </span><a href="CmmMachOp.html#MO_F_Lt"><span class="hs-identifier hs-var">MO_F_Lt</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span>  </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1433"></a><span>      </span><a href="CmmMachOp.html#MO_F_Le"><span class="hs-identifier hs-var">MO_F_Le</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>   </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1434"></a><span>
</span><a name="line-1435"></a><span>      </span><a href="CmmMachOp.html#MO_F_Eq"><span class="hs-identifier hs-var">MO_F_Eq</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1436"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ne"><span class="hs-identifier hs-var">MO_F_Ne</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1437"></a><span>      </span><a href="CmmMachOp.html#MO_F_Gt"><span class="hs-identifier hs-var">MO_F_Gt</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1438"></a><span>      </span><a href="CmmMachOp.html#MO_F_Ge"><span class="hs-identifier hs-var">MO_F_Ge</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1439"></a><span>      </span><a href="CmmMachOp.html#MO_F_Lt"><span class="hs-identifier hs-var">MO_F_Lt</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span> </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1440"></a><span>      </span><a href="CmmMachOp.html#MO_F_Le"><span class="hs-identifier hs-var">MO_F_Le</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="X86.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>  </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1441"></a><span>
</span><a name="line-1442"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#machOpToCond"><span class="hs-identifier hs-var">machOpToCond</span></a><span> </span><a href="#local-6989586621684659362"><span class="hs-identifier hs-var">mop</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659363"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659364"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1443"></a><span>
</span><a name="line-1444"></a><span class="hs-identifier">getCondCode</span><span> </span><a name="local-6989586621684659365"><a href="#local-6989586621684659365"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;getCondCode(2)(x86,x86_64)&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621684659365"><span class="hs-identifier hs-var">other</span></a><span class="hs-special">)</span><span>
</span><a name="line-1445"></a><span>
</span><a name="line-1446"></a><span class="hs-identifier">machOpToCond</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmMachOp.html#MachOp"><span class="hs-identifier hs-type">MachOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span>
</span><a name="line-1447"></a><a name="machOpToCond"><a href="X86.CodeGen.html#machOpToCond"><span class="hs-identifier">machOpToCond</span></a></a><span> </span><a name="local-6989586621684659366"><a href="#local-6989586621684659366"><span class="hs-identifier">mo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659366"><span class="hs-identifier hs-var">mo</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1448"></a><span>  </span><a href="CmmMachOp.html#MO_Eq"><span class="hs-identifier hs-var">MO_Eq</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span>
</span><a name="line-1449"></a><span>  </span><a href="CmmMachOp.html#MO_Ne"><span class="hs-identifier hs-var">MO_Ne</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>
</span><a name="line-1450"></a><span>  </span><a href="CmmMachOp.html#MO_S_Gt"><span class="hs-identifier hs-var">MO_S_Gt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#GTT"><span class="hs-identifier hs-var">GTT</span></a><span>
</span><a name="line-1451"></a><span>  </span><a href="CmmMachOp.html#MO_S_Ge"><span class="hs-identifier hs-var">MO_S_Ge</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#GE"><span class="hs-identifier hs-var">GE</span></a><span>
</span><a name="line-1452"></a><span>  </span><a href="CmmMachOp.html#MO_S_Lt"><span class="hs-identifier hs-var">MO_S_Lt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span>
</span><a name="line-1453"></a><span>  </span><a href="CmmMachOp.html#MO_S_Le"><span class="hs-identifier hs-var">MO_S_Le</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span>
</span><a name="line-1454"></a><span>  </span><a href="CmmMachOp.html#MO_U_Gt"><span class="hs-identifier hs-var">MO_U_Gt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#GU"><span class="hs-identifier hs-var">GU</span></a><span>
</span><a name="line-1455"></a><span>  </span><a href="CmmMachOp.html#MO_U_Ge"><span class="hs-identifier hs-var">MO_U_Ge</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#GEU"><span class="hs-identifier hs-var">GEU</span></a><span>
</span><a name="line-1456"></a><span>  </span><a href="CmmMachOp.html#MO_U_Lt"><span class="hs-identifier hs-var">MO_U_Lt</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#LU"><span class="hs-identifier hs-var">LU</span></a><span>
</span><a name="line-1457"></a><span>  </span><a href="CmmMachOp.html#MO_U_Le"><span class="hs-identifier hs-var">MO_U_Le</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#LEU"><span class="hs-identifier hs-var">LEU</span></a><span>
</span><a name="line-1458"></a><span>  </span><a name="local-6989586621684659367"><a href="#local-6989586621684659367"><span class="hs-identifier">_other</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;machOpToCond&quot;</span><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#pprMachOp"><span class="hs-identifier hs-var">pprMachOp</span></a><span> </span><a href="#local-6989586621684659366"><span class="hs-identifier hs-var">mo</span></a><span class="hs-special">)</span><span>
</span><a name="line-1459"></a><span>
</span><a name="line-1460"></a><span>
</span><a name="line-1461"></a><span class="hs-comment">-- @cond(Int|Flt)Code@: Turn a boolean expression into a condition, to be</span><span>
</span><a name="line-1462"></a><span class="hs-comment">-- passed back up the tree.</span><span>
</span><a name="line-1463"></a><span>
</span><a name="line-1464"></a><span class="hs-identifier">condIntCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="X86.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-type">CondCode</span></a><span>
</span><a name="line-1465"></a><a name="condIntCode"><a href="X86.CodeGen.html#condIntCode"><span class="hs-identifier">condIntCode</span></a></a><span> </span><a name="local-6989586621684659368"><a href="#local-6989586621684659368"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684659369"><a href="#local-6989586621684659369"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659370"><a href="#local-6989586621684659370"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659371"><a href="#local-6989586621684659371"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-1466"></a><span>                          </span><a href="X86.CodeGen.html#condIntCode%27"><span class="hs-identifier hs-var">condIntCode'</span></a><span> </span><a href="#local-6989586621684659371"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659368"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659369"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684659370"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1467"></a><span>
</span><a name="line-1468"></a><span class="hs-identifier">condIntCode'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-type">CondCode</span></a><span>
</span><a name="line-1469"></a><span>
</span><a name="line-1470"></a><span class="hs-comment">-- memory vs immediate</span><span>
</span><a name="line-1471"></a><a name="condIntCode%27"><a href="X86.CodeGen.html#condIntCode%27"><span class="hs-identifier">condIntCode'</span></a></a><span> </span><a name="local-6989586621684659372"><a href="#local-6989586621684659372"><span class="hs-identifier">is32Bit</span></a></a><span> </span><a name="local-6989586621684659373"><a href="#local-6989586621684659373"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684659374"><a href="#local-6989586621684659374"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659375"><a href="#local-6989586621684659375"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659376"><a href="#local-6989586621684659376"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1472"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier hs-var">is32BitLit</span></a><span> </span><a href="#local-6989586621684659372"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659376"><span class="hs-identifier hs-var">lit</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1473"></a><span>    </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659377"><a href="#local-6989586621684659377"><span class="hs-identifier">x_addr</span></a></a><span> </span><a name="local-6989586621684659378"><a href="#local-6989586621684659378"><span class="hs-identifier">x_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659374"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1474"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1475"></a><span>        </span><a name="local-6989586621684659379"><a href="#local-6989586621684659379"><span class="hs-identifier">imm</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659376"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1476"></a><span>        </span><a name="local-6989586621684659380"><a href="#local-6989586621684659380"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659378"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1477"></a><span>                  </span><a href="X86.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684659375"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><a href="#local-6989586621684659379"><span class="hs-identifier hs-var">imm</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659377"><span class="hs-identifier hs-var">x_addr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1478"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-1479"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659373"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659380"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1480"></a><span>
</span><a name="line-1481"></a><span class="hs-comment">-- anything vs zero, using a mask</span><span>
</span><a name="line-1482"></a><span class="hs-comment">-- TODO: Add some sanity checking!!!!</span><span>
</span><a name="line-1483"></a><span class="hs-identifier">condIntCode'</span><span> </span><a name="local-6989586621684659381"><a href="#local-6989586621684659381"><span class="hs-identifier">is32Bit</span></a></a><span> </span><a name="local-6989586621684659382"><a href="#local-6989586621684659382"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_And"><span class="hs-identifier hs-var">MO_And</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659383"><a href="#local-6989586621684659383"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659384"><a href="#local-6989586621684659384"><span class="hs-identifier">o2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><a name="local-6989586621684659385"><a href="#local-6989586621684659385"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1484"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659386"><a href="#local-6989586621684659386"><span class="hs-identifier">lit</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659387"><a href="#local-6989586621684659387"><span class="hs-identifier">mask</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659384"><span class="hs-identifier hs-var">o2</span></a><span class="hs-special">,</span><span> </span><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier hs-var">is32BitLit</span></a><span> </span><a href="#local-6989586621684659381"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659386"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1485"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1486"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621684659388"><a href="#local-6989586621684659388"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659389"><a href="#local-6989586621684659389"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659383"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1487"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-1488"></a><span>         </span><a name="local-6989586621684659390"><a href="#local-6989586621684659390"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659389"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1489"></a><span>                </span><a href="X86.Instr.html#TEST"><span class="hs-identifier hs-var">TEST</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659385"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><a href="#local-6989586621684659387"><span class="hs-identifier hs-var">mask</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659388"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1490"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-1491"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659382"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659390"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1492"></a><span>
</span><a name="line-1493"></a><span class="hs-comment">-- anything vs zero</span><span>
</span><a name="line-1494"></a><span class="hs-identifier">condIntCode'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659391"><a href="#local-6989586621684659391"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684659392"><a href="#local-6989586621684659392"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><a name="local-6989586621684659393"><a href="#local-6989586621684659393"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1495"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659394"><a href="#local-6989586621684659394"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659395"><a href="#local-6989586621684659395"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659392"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1496"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1497"></a><span>        </span><a name="local-6989586621684659396"><a href="#local-6989586621684659396"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659395"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1498"></a><span>                  </span><a href="X86.Instr.html#TEST"><span class="hs-identifier hs-var">TEST</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659393"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659394"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659394"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1499"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-1500"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659391"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659396"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1501"></a><span>
</span><a name="line-1502"></a><span class="hs-comment">-- anything vs operand</span><span>
</span><a name="line-1503"></a><span class="hs-identifier">condIntCode'</span><span> </span><a name="local-6989586621684659397"><a href="#local-6989586621684659397"><span class="hs-identifier">is32Bit</span></a></a><span> </span><a name="local-6989586621684659398"><a href="#local-6989586621684659398"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684659399"><a href="#local-6989586621684659399"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659400"><a href="#local-6989586621684659400"><span class="hs-identifier">y</span></a></a><span>
</span><a name="line-1504"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#isOperand"><span class="hs-identifier hs-var">isOperand</span></a><span> </span><a href="#local-6989586621684659397"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659400"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1505"></a><span>    </span><a name="local-6989586621684659401"><a href="#local-6989586621684659401"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1506"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659402"><a href="#local-6989586621684659402"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659403"><a href="#local-6989586621684659403"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659399"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1507"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659404"><a href="#local-6989586621684659404"><span class="hs-identifier">y_op</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621684659405"><a href="#local-6989586621684659405"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getOperand"><span class="hs-identifier hs-var">getOperand</span></a><span> </span><a href="#local-6989586621684659400"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1508"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1509"></a><span>        </span><a name="local-6989586621684659406"><a href="#local-6989586621684659406"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659403"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659405"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1510"></a><span>                  </span><a href="X86.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684659401"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659399"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659404"><span class="hs-identifier hs-var">y_op</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659402"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1511"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659398"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659406"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1512"></a><span class="hs-comment">-- operand vs. anything: invert the comparison so that we can use a</span><span>
</span><a name="line-1513"></a><span class="hs-comment">-- single comparison instruction.</span><span>
</span><a name="line-1514"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#isOperand"><span class="hs-identifier hs-var">isOperand</span></a><span> </span><a href="#local-6989586621684659397"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659399"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1515"></a><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684659407"><a href="#local-6989586621684659407"><span class="hs-identifier">revcond</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.Cond.html#maybeFlipCond"><span class="hs-identifier hs-var">maybeFlipCond</span></a><span> </span><a href="#local-6989586621684659398"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1516"></a><span>    </span><a name="local-6989586621684659408"><a href="#local-6989586621684659408"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1517"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659409"><a href="#local-6989586621684659409"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659410"><a href="#local-6989586621684659410"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659400"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1518"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659411"><a href="#local-6989586621684659411"><span class="hs-identifier">x_op</span></a></a><span class="hs-special">,</span><span>  </span><a name="local-6989586621684659412"><a href="#local-6989586621684659412"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getOperand"><span class="hs-identifier hs-var">getOperand</span></a><span> </span><a href="#local-6989586621684659399"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1519"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1520"></a><span>        </span><a name="local-6989586621684659413"><a href="#local-6989586621684659413"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659410"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659412"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1521"></a><span>                  </span><a href="X86.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684659408"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659399"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659411"><span class="hs-identifier hs-var">x_op</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659409"><span class="hs-identifier hs-var">y_reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1522"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659407"><span class="hs-identifier hs-var">revcond</span></a><span> </span><a href="#local-6989586621684659413"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1523"></a><span>
</span><a name="line-1524"></a><span class="hs-comment">-- anything vs anything</span><span>
</span><a name="line-1525"></a><span class="hs-identifier">condIntCode'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659414"><a href="#local-6989586621684659414"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684659415"><a href="#local-6989586621684659415"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659416"><a href="#local-6989586621684659416"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1526"></a><span>  </span><a name="local-6989586621684659417"><a href="#local-6989586621684659417"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1527"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684659418"><a href="#local-6989586621684659418"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659419"><a href="#local-6989586621684659419"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659416"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1528"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684659420"><a href="#local-6989586621684659420"><span class="hs-identifier">x_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659421"><a href="#local-6989586621684659421"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getRegOrMem"><span class="hs-identifier hs-var">getRegOrMem</span></a><span> </span><a href="#local-6989586621684659415"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1529"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-1530"></a><span>        </span><a name="local-6989586621684659422"><a href="#local-6989586621684659422"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659419"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1531"></a><span>               </span><a href="#local-6989586621684659421"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1532"></a><span>                  </span><a href="X86.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684659417"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659415"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659418"><span class="hs-identifier hs-var">y_reg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659420"><span class="hs-identifier hs-var">x_op</span></a><span>
</span><a name="line-1533"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659414"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659422"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1534"></a><span>
</span><a name="line-1535"></a><span>
</span><a name="line-1536"></a><span>
</span><a name="line-1537"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-1538"></a><span class="hs-identifier">condFltCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="X86.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-type">CondCode</span></a><span>
</span><a name="line-1539"></a><span>
</span><a name="line-1540"></a><a name="condFltCode"><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier">condFltCode</span></a></a><span> </span><a name="local-6989586621684659423"><a href="#local-6989586621684659423"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684659424"><a href="#local-6989586621684659424"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684659425"><a href="#local-6989586621684659425"><span class="hs-identifier">y</span></a></a><span>
</span><a name="line-1541"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#if_sse2"><span class="hs-identifier hs-var">if_sse2</span></a><span> </span><a href="#local-6989586621684659427"><span class="hs-identifier hs-var">condFltCode_sse2</span></a><span> </span><a href="#local-6989586621684659426"><span class="hs-identifier hs-var">condFltCode_x87</span></a><span>
</span><a name="line-1542"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1543"></a><span>
</span><a name="line-1544"></a><span>  </span><a name="local-6989586621684659426"><a href="#local-6989586621684659426"><span class="hs-identifier">condFltCode_x87</span></a></a><span>
</span><a name="line-1545"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier hs-var">cond</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">elem</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="#local-6989586621684659423"><span class="hs-identifier hs-var">EQQ</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">NE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">LE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">LTT</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">GE</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">GTT</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1546"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659428"><a href="#local-6989586621684659428"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659429"><a href="#local-6989586621684659429"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659424"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1547"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659430"><a href="#local-6989586621684659430"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659431"><a href="#local-6989586621684659431"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659425"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1548"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1549"></a><span>        </span><a name="local-6989586621684659432"><a href="#local-6989586621684659432"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659429"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659431"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1550"></a><span>                </span><a href="X86.Instr.html#GCMP"><span class="hs-identifier hs-var">GCMP</span></a><span> </span><a href="#local-6989586621684659423"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659428"><span class="hs-identifier hs-var">x_reg</span></a><span> </span><a href="#local-6989586621684659430"><span class="hs-identifier hs-var">y_reg</span></a><span>
</span><a name="line-1551"></a><span>    </span><span class="hs-comment">-- The GCMP insn does the test and sets the zero flag if comparable</span><span>
</span><a name="line-1552"></a><span>    </span><span class="hs-comment">-- and true.  Hence we always supply EQQ as the condition to test.</span><span>
</span><a name="line-1553"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="X86.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span> </span><a href="#local-6989586621684659432"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1554"></a><span>
</span><a name="line-1555"></a><span>  </span><span class="hs-comment">-- in the SSE2 comparison ops (ucomiss, ucomisd) the left arg may be</span><span>
</span><a name="line-1556"></a><span>  </span><span class="hs-comment">-- an operand, but the right must be a reg.  We can probably do better</span><span>
</span><a name="line-1557"></a><span>  </span><span class="hs-comment">-- than this general case...</span><span>
</span><a name="line-1558"></a><span>  </span><a name="local-6989586621684659427"><a href="#local-6989586621684659427"><span class="hs-identifier">condFltCode_sse2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1559"></a><span>    </span><a name="local-6989586621684659433"><a href="#local-6989586621684659433"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1560"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659434"><a href="#local-6989586621684659434"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659435"><a href="#local-6989586621684659435"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659424"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-1561"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659436"><a href="#local-6989586621684659436"><span class="hs-identifier">y_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659437"><a href="#local-6989586621684659437"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getOperand"><span class="hs-identifier hs-var">getOperand</span></a><span> </span><a href="#local-6989586621684659425"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-1562"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1563"></a><span>        </span><a name="local-6989586621684659438"><a href="#local-6989586621684659438"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659435"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1564"></a><span>               </span><a href="#local-6989586621684659437"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1565"></a><span>                  </span><a href="X86.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CmmExpr.html#cmmExprWidth"><span class="hs-identifier hs-var">cmmExprWidth</span></a><span> </span><a href="#local-6989586621684659433"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659424"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659436"><span class="hs-identifier hs-var">y_op</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659434"><span class="hs-identifier hs-var">x_reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1566"></a><span>        </span><span class="hs-comment">-- NB(1): we need to use the unsigned comparison operators on the</span><span>
</span><a name="line-1567"></a><span>        </span><span class="hs-comment">-- result of this comparison.</span><span>
</span><a name="line-1568"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="X86.Cond.html#condToUnsigned"><span class="hs-identifier hs-var">condToUnsigned</span></a><span> </span><a href="#local-6989586621684659423"><span class="hs-identifier hs-var">cond</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659438"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1569"></a><span>
</span><a name="line-1570"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1571"></a><span class="hs-comment">-- Generating assignments</span><span>
</span><a name="line-1572"></a><span>
</span><a name="line-1573"></a><span class="hs-comment">-- Assignments are really at the heart of the whole code generation</span><span>
</span><a name="line-1574"></a><span class="hs-comment">-- business.  Almost all top-level nodes of any real importance are</span><span>
</span><a name="line-1575"></a><span class="hs-comment">-- assignments, which correspond to loads, stores, or register</span><span>
</span><a name="line-1576"></a><span class="hs-comment">-- transfers.  If we're really lucky, some of the register transfers</span><span>
</span><a name="line-1577"></a><span class="hs-comment">-- will go away, because we can use the destination register to</span><span>
</span><a name="line-1578"></a><span class="hs-comment">-- complete the code generation for the right hand side.  This only</span><span>
</span><a name="line-1579"></a><span class="hs-comment">-- fails when the right hand side is forced into a fixed register</span><span>
</span><a name="line-1580"></a><span class="hs-comment">-- (e.g. the result of a call).</span><span>
</span><a name="line-1581"></a><span>
</span><a name="line-1582"></a><span class="hs-identifier">assignMem_IntCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1583"></a><span class="hs-identifier">assignReg_IntCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1584"></a><span>
</span><a name="line-1585"></a><span class="hs-identifier">assignMem_FltCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1586"></a><span class="hs-identifier">assignReg_FltCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmReg"><span class="hs-identifier hs-type">CmmReg</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1587"></a><span>
</span><a name="line-1588"></a><span>
</span><a name="line-1589"></a><span class="hs-comment">-- integer assignment to memory</span><span>
</span><a name="line-1590"></a><span>
</span><a name="line-1591"></a><span class="hs-comment">-- specific case of adding/subtracting an integer to a particular address.</span><span>
</span><a name="line-1592"></a><span class="hs-comment">-- ToDo: catch other cases where we can use an operation directly on a memory</span><span>
</span><a name="line-1593"></a><span class="hs-comment">-- address.</span><span>
</span><a name="line-1594"></a><a name="assignMem_IntCode"><a href="X86.CodeGen.html#assignMem_IntCode"><span class="hs-identifier">assignMem_IntCode</span></a></a><span> </span><a name="local-6989586621684659439"><a href="#local-6989586621684659439"><span class="hs-identifier">pk</span></a></a><span> </span><a name="local-6989586621684659440"><a href="#local-6989586621684659440"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a name="local-6989586621684659441"><a href="#local-6989586621684659441"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684659442"><a href="#local-6989586621684659442"><span class="hs-identifier">addr2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span>
</span><a name="line-1595"></a><span>                                                 </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659443"><a href="#local-6989586621684659443"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1596"></a><span>   </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659440"><span class="hs-identifier hs-var">addr</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684659442"><span class="hs-identifier hs-var">addr2</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659439"><span class="hs-identifier hs-var">pk</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="X86.CodeGen.html#is32BitInteger"><span class="hs-identifier hs-var">is32BitInteger</span></a><span> </span><a href="#local-6989586621684659443"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span>
</span><a name="line-1597"></a><span>     </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684659445"><a href="#local-6989586621684659445"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659444"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621684659441"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-1598"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659446"><a href="#local-6989586621684659446"><span class="hs-identifier">amode</span></a></a><span> </span><a name="local-6989586621684659447"><a href="#local-6989586621684659447"><span class="hs-identifier">code_addr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659440"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-1599"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659448"><a href="#local-6989586621684659448"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659447"><span class="hs-identifier hs-var">code_addr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1600"></a><span>                   </span><a href="#local-6989586621684659445"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684659439"><span class="hs-identifier hs-var">pk</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621684659443"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659446"><span class="hs-identifier hs-var">amode</span></a><span class="hs-special">)</span><span>
</span><a name="line-1601"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684659448"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1602"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-1603"></a><span>        </span><a name="local-6989586621684659444"><a href="#local-6989586621684659444"><span class="hs-identifier">check</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add"><span class="hs-identifier hs-var">MO_Add</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span>
</span><a name="line-1604"></a><span>        </span><span class="hs-identifier">check</span><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Sub"><span class="hs-identifier hs-var">MO_Sub</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span>
</span><a name="line-1605"></a><span>        </span><span class="hs-identifier">check</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-1606"></a><span>        </span><span class="hs-comment">-- ToDo: more?</span><span>
</span><a name="line-1607"></a><span>
</span><a name="line-1608"></a><span class="hs-comment">-- general case</span><span>
</span><a name="line-1609"></a><span class="hs-identifier">assignMem_IntCode</span><span> </span><a name="local-6989586621684659449"><a href="#local-6989586621684659449"><span class="hs-identifier">pk</span></a></a><span> </span><a name="local-6989586621684659450"><a href="#local-6989586621684659450"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684659451"><a href="#local-6989586621684659451"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1610"></a><span>    </span><a name="local-6989586621684659458"><a href="#local-6989586621684659458"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-1611"></a><span>    </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659459"><a href="#local-6989586621684659459"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684659460"><a href="#local-6989586621684659460"><span class="hs-identifier">code_addr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659450"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-1612"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659461"><a href="#local-6989586621684659461"><span class="hs-identifier">code_src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659462"><a href="#local-6989586621684659462"><span class="hs-identifier">op_src</span></a></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659452"><span class="hs-identifier hs-var">get_op_RI</span></a><span> </span><a href="#local-6989586621684659458"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659451"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1613"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-1614"></a><span>        </span><a name="local-6989586621684659463"><a href="#local-6989586621684659463"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659461"><span class="hs-identifier hs-var">code_src</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1615"></a><span>               </span><a href="#local-6989586621684659460"><span class="hs-identifier hs-var">code_addr</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1616"></a><span>                  </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659449"><span class="hs-identifier hs-var">pk</span></a><span> </span><a href="#local-6989586621684659462"><span class="hs-identifier hs-var">op_src</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659459"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1617"></a><span>        </span><span class="hs-comment">-- NOTE: op_src is stable, so it will still be valid</span><span>
</span><a name="line-1618"></a><span>        </span><span class="hs-comment">-- after code_addr.  This may involve the introduction</span><span>
</span><a name="line-1619"></a><span>        </span><span class="hs-comment">-- of an extra MOV to a temporary register, but we hope</span><span>
</span><a name="line-1620"></a><span>        </span><span class="hs-comment">-- the register allocator will get rid of it.</span><span>
</span><a name="line-1621"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-1622"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684659463"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1623"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1624"></a><span>    </span><span class="hs-identifier">get_op_RI</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">,</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- code, operator</span><span>
</span><a name="line-1625"></a><span>    </span><a name="local-6989586621684659452"><a href="#local-6989586621684659452"><span class="hs-identifier">get_op_RI</span></a></a><span> </span><a name="local-6989586621684659453"><a href="#local-6989586621684659453"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659454"><a href="#local-6989586621684659454"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier hs-var">is32BitLit</span></a><span> </span><a href="#local-6989586621684659453"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659454"><span class="hs-identifier hs-var">lit</span></a><span>
</span><a name="line-1626"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659454"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1627"></a><span>    </span><span class="hs-identifier">get_op_RI</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659455"><a href="#local-6989586621684659455"><span class="hs-identifier">op</span></a></a><span>
</span><a name="line-1628"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659456"><a href="#local-6989586621684659456"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659457"><a href="#local-6989586621684659457"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659455"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-1629"></a><span>           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659457"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659456"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span>
</span><a name="line-1630"></a><span>
</span><a name="line-1631"></a><span>
</span><a name="line-1632"></a><span class="hs-comment">-- Assign; dst is a reg, rhs is mem</span><span>
</span><a name="line-1633"></a><a name="assignReg_IntCode"><a href="X86.CodeGen.html#assignReg_IntCode"><span class="hs-identifier">assignReg_IntCode</span></a></a><span> </span><a name="local-6989586621684659464"><a href="#local-6989586621684659464"><span class="hs-identifier">pk</span></a></a><span> </span><a name="local-6989586621684659465"><a href="#local-6989586621684659465"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684659466"><a href="#local-6989586621684659466"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1634"></a><span>  </span><a name="local-6989586621684659467"><a href="#local-6989586621684659467"><span class="hs-identifier">load_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659464"><span class="hs-identifier hs-var">pk</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659466"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1635"></a><span>  </span><a name="local-6989586621684659468"><a href="#local-6989586621684659468"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1636"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659469"><a href="#local-6989586621684659469"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659468"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1637"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659467"><span class="hs-identifier hs-var">load_code</span></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659469"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-comment">{-no sse2-}</span><span> </span><a href="#local-6989586621684659465"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1638"></a><span>
</span><a name="line-1639"></a><span class="hs-comment">-- dst is a reg, but src could be anything</span><span>
</span><a name="line-1640"></a><span class="hs-identifier">assignReg_IntCode</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659470"><a href="#local-6989586621684659470"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684659471"><a href="#local-6989586621684659471"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1641"></a><span>  </span><a name="local-6989586621684659472"><a href="#local-6989586621684659472"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1642"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659473"><a href="#local-6989586621684659473"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659472"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1643"></a><span>  </span><a name="local-6989586621684659474"><a href="#local-6989586621684659474"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659471"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1644"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659474"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659473"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-comment">{-no sse2-}</span><span> </span><a href="#local-6989586621684659470"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1645"></a><span>
</span><a name="line-1646"></a><span>
</span><a name="line-1647"></a><span class="hs-comment">-- Floating point assignment to memory</span><span>
</span><a name="line-1648"></a><a name="assignMem_FltCode"><a href="X86.CodeGen.html#assignMem_FltCode"><span class="hs-identifier">assignMem_FltCode</span></a></a><span> </span><a name="local-6989586621684659475"><a href="#local-6989586621684659475"><span class="hs-identifier">pk</span></a></a><span> </span><a name="local-6989586621684659476"><a href="#local-6989586621684659476"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684659477"><a href="#local-6989586621684659477"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1649"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684659478"><a href="#local-6989586621684659478"><span class="hs-identifier">src_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659479"><a href="#local-6989586621684659479"><span class="hs-identifier">src_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684659477"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1650"></a><span>  </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659480"><a href="#local-6989586621684659480"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621684659481"><a href="#local-6989586621684659481"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659476"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-1651"></a><span>  </span><a name="local-6989586621684659482"><a href="#local-6989586621684659482"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-1652"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-1653"></a><span>        </span><a name="local-6989586621684659483"><a href="#local-6989586621684659483"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659479"><span class="hs-identifier hs-var">src_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1654"></a><span>               </span><a href="#local-6989586621684659481"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-1655"></a><span>                </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659482"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659475"><span class="hs-identifier hs-var">pk</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659478"><span class="hs-identifier hs-var">src_reg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659480"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span>
</span><a name="line-1656"></a><span>                            </span><span class="hs-keyword">else</span><span> </span><a href="X86.Instr.html#GST"><span class="hs-identifier hs-var">GST</span></a><span> </span><a href="#local-6989586621684659475"><span class="hs-identifier hs-var">pk</span></a><span> </span><a href="#local-6989586621684659478"><span class="hs-identifier hs-var">src_reg</span></a><span> </span><a href="#local-6989586621684659480"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-1657"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684659483"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1658"></a><span>
</span><a name="line-1659"></a><span class="hs-comment">-- Floating point assignment to a register/temporary</span><span>
</span><a name="line-1660"></a><a name="assignReg_FltCode"><a href="X86.CodeGen.html#assignReg_FltCode"><span class="hs-identifier">assignReg_FltCode</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659484"><a href="#local-6989586621684659484"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621684659485"><a href="#local-6989586621684659485"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1661"></a><span>  </span><a name="local-6989586621684659486"><a href="#local-6989586621684659486"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-1662"></a><span>  </span><a name="local-6989586621684659487"><a href="#local-6989586621684659487"><span class="hs-identifier">src_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659485"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1663"></a><span>  </span><a name="local-6989586621684659488"><a href="#local-6989586621684659488"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-1664"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659489"><a href="#local-6989586621684659489"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659488"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1665"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659487"><span class="hs-identifier hs-var">src_code</span></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659489"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659486"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><a href="#local-6989586621684659484"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1666"></a><span>
</span><a name="line-1667"></a><span>
</span><a name="line-1668"></a><span class="hs-identifier">genJump</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-comment">{-the branch target-}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1669"></a><span>
</span><a name="line-1670"></a><a name="genJump"><a href="X86.CodeGen.html#genJump"><span class="hs-identifier">genJump</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLoad"><span class="hs-identifier hs-var">CmmLoad</span></a><span> </span><a name="local-6989586621684659490"><a href="#local-6989586621684659490"><span class="hs-identifier">mem</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684659491"><a href="#local-6989586621684659491"><span class="hs-identifier">regs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1671"></a><span>  </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659492"><a href="#local-6989586621684659492"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684659493"><a href="#local-6989586621684659493"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659490"><span class="hs-identifier hs-var">mem</span></a><span>
</span><a name="line-1672"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659493"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="X86.Instr.html#JMP"><span class="hs-identifier hs-var">JMP</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659492"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659491"><span class="hs-identifier hs-var">regs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1673"></a><span>
</span><a name="line-1674"></a><span class="hs-identifier">genJump</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684659494"><a href="#local-6989586621684659494"><span class="hs-identifier">lit</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684659495"><a href="#local-6989586621684659495"><span class="hs-identifier">regs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1675"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#JMP"><span class="hs-identifier hs-var">JMP</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684659494"><span class="hs-identifier hs-var">lit</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659495"><span class="hs-identifier hs-var">regs</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1676"></a><span>
</span><a name="line-1677"></a><span class="hs-identifier">genJump</span><span> </span><a name="local-6989586621684659496"><a href="#local-6989586621684659496"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621684659497"><a href="#local-6989586621684659497"><span class="hs-identifier">regs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1678"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684659498"><a href="#local-6989586621684659498"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659499"><a href="#local-6989586621684659499"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659496"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1679"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659499"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="X86.Instr.html#JMP"><span class="hs-identifier hs-var">JMP</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659498"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659497"><span class="hs-identifier hs-var">regs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1680"></a><span>
</span><a name="line-1681"></a><span>
</span><a name="line-1682"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1683"></a><span class="hs-comment">--  Unconditional branches</span><span>
</span><a name="line-1684"></a><span>
</span><a name="line-1685"></a><span class="hs-identifier">genBranch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1686"></a><a name="genBranch"><a href="X86.CodeGen.html#genBranch"><span class="hs-identifier">genBranch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Instruction.html#mkJumpInstr"><span class="hs-identifier hs-var">mkJumpInstr</span></a><span>
</span><a name="line-1687"></a><span>
</span><a name="line-1688"></a><span>
</span><a name="line-1689"></a><span>
</span><a name="line-1690"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1691"></a><span class="hs-comment">--  Conditional jumps/branches</span><span>
</span><a name="line-1692"></a><span>
</span><a name="line-1693"></a><span class="hs-comment">{-
Conditional jumps are always to local labels, so we can use branch
instructions.  We peek at the arguments to decide what kind of
comparison to do.

I386: First, we have to ensure that the condition
codes are set according to the supplied comparison operation.
-}</span><span>
</span><a name="line-1701"></a><span>
</span><a name="line-1702"></a><span>
</span><a name="line-1703"></a><span class="hs-identifier">genCondBranch</span><span>
</span><a name="line-1704"></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span>      </span><span class="hs-comment">-- the source of the jump</span><span>
</span><a name="line-1705"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span>      </span><span class="hs-comment">-- the true branch target</span><span>
</span><a name="line-1706"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span>      </span><span class="hs-comment">-- the false branch target</span><span>
</span><a name="line-1707"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>      </span><span class="hs-comment">-- the condition on which to branch</span><span>
</span><a name="line-1708"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span> </span><span class="hs-comment">-- Instructions</span><span>
</span><a name="line-1709"></a><span>
</span><a name="line-1710"></a><a name="genCondBranch"><a href="X86.CodeGen.html#genCondBranch"><span class="hs-identifier">genCondBranch</span></a></a><span> </span><a name="local-6989586621684659500"><a href="#local-6989586621684659500"><span class="hs-identifier">bid</span></a></a><span> </span><a name="local-6989586621684659501"><a href="#local-6989586621684659501"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621684659502"><a href="#local-6989586621684659502"><span class="hs-identifier">false</span></a></a><span> </span><a name="local-6989586621684659503"><a href="#local-6989586621684659503"><span class="hs-identifier">expr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1711"></a><span>  </span><a name="local-6989586621684659504"><a href="#local-6989586621684659504"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-1712"></a><span>  </span><a href="X86.CodeGen.html#genCondBranch%27"><span class="hs-identifier hs-var">genCondBranch'</span></a><span> </span><a href="#local-6989586621684659504"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659500"><span class="hs-identifier hs-var">bid</span></a><span> </span><a href="#local-6989586621684659501"><span class="hs-identifier hs-var">id</span></a><span> </span><a href="#local-6989586621684659502"><span class="hs-identifier hs-var">false</span></a><span> </span><a href="#local-6989586621684659503"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-1713"></a><span>
</span><a name="line-1714"></a><span class="hs-comment">-- | We return the instructions generated.</span><span>
</span><a name="line-1715"></a><span class="hs-identifier">genCondBranch'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-1716"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1717"></a><span>
</span><a name="line-1718"></a><span class="hs-comment">-- 64-bit integer comparisons on 32-bit</span><span>
</span><a name="line-1719"></a><a name="genCondBranch%27"><a href="X86.CodeGen.html#genCondBranch%27"><span class="hs-identifier">genCondBranch'</span></a></a><span> </span><a name="local-6989586621684659505"><a href="#local-6989586621684659505"><span class="hs-identifier">is32Bit</span></a></a><span> </span><a name="local-6989586621684659506"><a href="#local-6989586621684659506"><span class="hs-identifier">_bid</span></a></a><span> </span><a name="local-6989586621684659507"><a href="#local-6989586621684659507"><span class="hs-identifier">true</span></a></a><span> </span><a name="local-6989586621684659508"><a href="#local-6989586621684659508"><span class="hs-identifier">false</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a name="local-6989586621684659509"><a href="#local-6989586621684659509"><span class="hs-identifier">mop</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659510"><a href="#local-6989586621684659510"><span class="hs-identifier">e1</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659511"><a href="#local-6989586621684659511"><span class="hs-identifier">e2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-1720"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659505"><span class="hs-identifier hs-var">is32Bit</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CmmMachOp.html#maybeIntComparison"><span class="hs-identifier hs-var">maybeIntComparison</span></a><span> </span><a href="#local-6989586621684659509"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1721"></a><span>  </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684659512"><a href="#local-6989586621684659512"><span class="hs-identifier">code1</span></a></a><span> </span><a name="local-6989586621684659513"><a href="#local-6989586621684659513"><span class="hs-identifier">r1_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684659510"><span class="hs-identifier hs-var">e1</span></a><span>
</span><a name="line-1722"></a><span>  </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684659514"><a href="#local-6989586621684659514"><span class="hs-identifier">code2</span></a></a><span> </span><a name="local-6989586621684659515"><a href="#local-6989586621684659515"><span class="hs-identifier">r2_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684659511"><span class="hs-identifier hs-var">e2</span></a><span>
</span><a name="line-1723"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659516"><a href="#local-6989586621684659516"><span class="hs-identifier">r1_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684659513"><span class="hs-identifier hs-var">r1_lo</span></a><span>
</span><a name="line-1724"></a><span>      </span><a name="local-6989586621684659517"><a href="#local-6989586621684659517"><span class="hs-identifier">r2_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684659515"><span class="hs-identifier hs-var">r2_lo</span></a><span>
</span><a name="line-1725"></a><span>      </span><a name="local-6989586621684659518"><a href="#local-6989586621684659518"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#machOpToCond"><span class="hs-identifier hs-var">machOpToCond</span></a><span> </span><a href="#local-6989586621684659509"><span class="hs-identifier hs-var">mop</span></a><span>
</span><a name="line-1726"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684659519"><a href="#local-6989586621684659519"><span class="hs-identifier">cond'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Cond.html#maybeFlipCond"><span class="hs-identifier hs-var">maybeFlipCond</span></a><span> </span><a href="#local-6989586621684659518"><span class="hs-identifier hs-var">cond</span></a><span>
</span><a name="line-1727"></a><span>  </span><span class="hs-comment">--TODO: Update CFG for x86</span><span>
</span><a name="line-1728"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659520"><a href="#local-6989586621684659520"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659512"><span class="hs-identifier hs-var">code1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659514"><span class="hs-identifier hs-var">code2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-1729"></a><span>        </span><a href="X86.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659517"><span class="hs-identifier hs-var">r2_hi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659516"><span class="hs-identifier hs-var">r1_hi</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1730"></a><span>        </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="#local-6989586621684659518"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659507"><span class="hs-identifier hs-var">true</span></a><span class="hs-special">,</span><span>
</span><a name="line-1731"></a><span>        </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="#local-6989586621684659519"><span class="hs-identifier hs-var">cond'</span></a><span> </span><a href="#local-6989586621684659508"><span class="hs-identifier hs-var">false</span></a><span class="hs-special">,</span><span>
</span><a name="line-1732"></a><span>        </span><a href="X86.Instr.html#CMP"><span class="hs-identifier hs-var">CMP</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659515"><span class="hs-identifier hs-var">r2_lo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659513"><span class="hs-identifier hs-var">r1_lo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1733"></a><span>        </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="#local-6989586621684659518"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659507"><span class="hs-identifier hs-var">true</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="X86.CodeGen.html#genBranch"><span class="hs-identifier hs-var">genBranch</span></a><span> </span><a href="#local-6989586621684659508"><span class="hs-identifier hs-var">false</span></a><span>
</span><a name="line-1734"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684659520"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-1735"></a><span>
</span><a name="line-1736"></a><span class="hs-identifier">genCondBranch'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659521"><a href="#local-6989586621684659521"><span class="hs-identifier">bid</span></a></a><span> </span><a name="local-6989586621684659522"><a href="#local-6989586621684659522"><span class="hs-identifier">id</span></a></a><span> </span><a name="local-6989586621684659523"><a href="#local-6989586621684659523"><span class="hs-identifier">false</span></a></a><span> </span><a name="local-6989586621684659524"><a href="#local-6989586621684659524"><span class="hs-identifier">bool</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1737"></a><span>  </span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><a name="local-6989586621684659525"><a href="#local-6989586621684659525"><span class="hs-identifier">is_float</span></a></a><span> </span><a name="local-6989586621684659526"><a href="#local-6989586621684659526"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684659527"><a href="#local-6989586621684659527"><span class="hs-identifier">cond_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getCondCode"><span class="hs-identifier hs-var">getCondCode</span></a><span> </span><a href="#local-6989586621684659524"><span class="hs-identifier hs-var">bool</span></a><span>
</span><a name="line-1738"></a><span>  </span><a name="local-6989586621684659528"><a href="#local-6989586621684659528"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-1739"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684659525"><span class="hs-identifier hs-var">is_float</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684659528"><span class="hs-identifier hs-var">use_sse2</span></a><span>
</span><a name="line-1740"></a><span>    </span><span class="hs-keyword">then</span><span>
</span><a name="line-1741"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659527"><span class="hs-identifier hs-var">cond_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="#local-6989586621684659526"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659522"><span class="hs-identifier hs-var">id</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="X86.CodeGen.html#genBranch"><span class="hs-identifier hs-var">genBranch</span></a><span> </span><a href="#local-6989586621684659523"><span class="hs-identifier hs-var">false</span></a><span class="hs-special">)</span><span>
</span><a name="line-1742"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1743"></a><span>        </span><span class="hs-comment">-- See Note [SSE Parity Checks]</span><span>
</span><a name="line-1744"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659529"><a href="#local-6989586621684659529"><span class="hs-identifier">jmpFalse</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#genBranch"><span class="hs-identifier hs-var">genBranch</span></a><span> </span><a href="#local-6989586621684659523"><span class="hs-identifier hs-var">false</span></a><span>
</span><a name="line-1745"></a><span>            </span><a name="local-6989586621684659530"><a href="#local-6989586621684659530"><span class="hs-identifier">code</span></a></a><span>
</span><a name="line-1746"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659526"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1747"></a><span>                  </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659532"><span class="hs-identifier hs-var">or_unordered</span></a><span>
</span><a name="line-1748"></a><span>                  </span><a href="X86.Cond.html#GU"><span class="hs-identifier hs-var">GU</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659531"><span class="hs-identifier hs-var">plain_test</span></a><span>
</span><a name="line-1749"></a><span>                  </span><a href="X86.Cond.html#GEU"><span class="hs-identifier hs-var">GEU</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659531"><span class="hs-identifier hs-var">plain_test</span></a><span>
</span><a name="line-1750"></a><span>                  </span><span class="hs-comment">-- Use ASSERT so we don't break releases if</span><span>
</span><a name="line-1751"></a><span>                  </span><span class="hs-comment">-- LTT/LE creep in somehow.</span><span>
</span><a name="line-1752"></a><span>                  </span><a href="X86.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1753"></a><span>                    </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span class="hs-identifier">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-string">&quot;Should have been turned into &gt;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1754"></a><span>                    </span><a href="#local-6989586621684659533"><span class="hs-identifier hs-var">and_ordered</span></a><span>
</span><a name="line-1755"></a><span>                  </span><a href="X86.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1756"></a><span>                    </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span class="hs-identifier">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-string">&quot;Should have been turned into &gt;=&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1757"></a><span>                    </span><a href="#local-6989586621684659533"><span class="hs-identifier hs-var">and_ordered</span></a><span>
</span><a name="line-1758"></a><span>                  </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659533"><span class="hs-identifier hs-var">and_ordered</span></a><span>
</span><a name="line-1759"></a><span>
</span><a name="line-1760"></a><span>            </span><a name="local-6989586621684659531"><a href="#local-6989586621684659531"><span class="hs-identifier">plain_test</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-1761"></a><span>                  </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="#local-6989586621684659526"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659522"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1762"></a><span>                </span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659529"><span class="hs-identifier hs-var">jmpFalse</span></a><span>
</span><a name="line-1763"></a><span>            </span><a name="local-6989586621684659532"><a href="#local-6989586621684659532"><span class="hs-identifier">or_unordered</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-1764"></a><span>                  </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="#local-6989586621684659526"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659522"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span>
</span><a name="line-1765"></a><span>                  </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="X86.Cond.html#PARITY"><span class="hs-identifier hs-var">PARITY</span></a><span> </span><a href="#local-6989586621684659522"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-1766"></a><span>                </span><span class="hs-special">]</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659529"><span class="hs-identifier hs-var">jmpFalse</span></a><span>
</span><a name="line-1767"></a><span>            </span><a name="local-6989586621684659533"><a href="#local-6989586621684659533"><span class="hs-identifier">and_ordered</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-1768"></a><span>                  </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="X86.Cond.html#PARITY"><span class="hs-identifier hs-var">PARITY</span></a><span> </span><a href="#local-6989586621684659523"><span class="hs-identifier hs-var">false</span></a><span class="hs-special">,</span><span>
</span><a name="line-1769"></a><span>                  </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="#local-6989586621684659526"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684659522"><span class="hs-identifier hs-var">id</span></a><span class="hs-special">,</span><span>
</span><a name="line-1770"></a><span>                  </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="X86.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684659523"><span class="hs-identifier hs-var">false</span></a><span>
</span><a name="line-1771"></a><span>                </span><span class="hs-special">]</span><span>
</span><a name="line-1772"></a><span>        </span><a href="NCGMonad.html#updateCfgNat"><span class="hs-identifier hs-var">updateCfgNat</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659534"><a href="#local-6989586621684659534"><span class="hs-identifier">cfg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CFG.html#adjustEdgeWeight"><span class="hs-identifier hs-var">adjustEdgeWeight</span></a><span> </span><a href="#local-6989586621684659534"><span class="hs-identifier hs-var">cfg</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-number">3</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659521"><span class="hs-identifier hs-var">bid</span></a><span> </span><a href="#local-6989586621684659523"><span class="hs-identifier hs-var">false</span></a><span class="hs-special">)</span><span>
</span><a name="line-1773"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659527"><span class="hs-identifier hs-var">cond_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659530"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-1774"></a><span>
</span><a name="line-1775"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-1776"></a><span class="hs-comment">--  Generating C calls</span><span>
</span><a name="line-1777"></a><span>
</span><a name="line-1778"></a><span class="hs-comment">-- Now the biggest nightmare---calls.  Most of the nastiness is buried in</span><span>
</span><a name="line-1779"></a><span class="hs-comment">-- @get_arg@, which moves the arguments to the correct registers/stack</span><span>
</span><a name="line-1780"></a><span class="hs-comment">-- locations.  Apart from that, the code is easy.</span><span>
</span><a name="line-1781"></a><span class="hs-comment">--</span><span>
</span><a name="line-1782"></a><span class="hs-comment">-- (If applicable) Do not fill the delay slots here; you will confuse the</span><span>
</span><a name="line-1783"></a><span class="hs-comment">-- register allocator.</span><span>
</span><a name="line-1784"></a><span>
</span><a name="line-1785"></a><span class="hs-identifier">genCCall</span><span>
</span><a name="line-1786"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-1787"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>                     </span><span class="hs-comment">-- 32 bit platform?</span><span>
</span><a name="line-1788"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span>            </span><span class="hs-comment">-- function to call</span><span>
</span><a name="line-1789"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- where to put the result</span><span>
</span><a name="line-1790"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- arguments (of mixed type)</span><span>
</span><a name="line-1791"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span>      </span><span class="hs-comment">-- The block we are in</span><span>
</span><a name="line-1792"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-1793"></a><span>
</span><a name="line-1794"></a><span class="hs-comment">-- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><span>
</span><a name="line-1795"></a><span>
</span><a name="line-1796"></a><span class="hs-comment">-- Unroll memcpy calls if the source and destination pointers are at</span><span>
</span><a name="line-1797"></a><span class="hs-comment">-- least DWORD aligned and the number of bytes to copy isn't too</span><span>
</span><a name="line-1798"></a><span class="hs-comment">-- large.  Otherwise, call C's memcpy.</span><span>
</span><a name="line-1799"></a><a name="genCCall"><a href="X86.CodeGen.html#genCCall"><span class="hs-identifier">genCCall</span></a></a><span> </span><a name="local-6989586621684659535"><a href="#local-6989586621684659535"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659536"><a href="#local-6989586621684659536"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Memcpy"><span class="hs-identifier hs-var">MO_Memcpy</span></a><span> </span><a name="local-6989586621684659537"><a href="#local-6989586621684659537"><span class="hs-identifier">align</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1800"></a><span>         </span><span class="hs-special">[</span><a name="local-6989586621684659538"><a href="#local-6989586621684659538"><span class="hs-identifier">dst</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659539"><a href="#local-6989586621684659539"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659540"><a href="#local-6989586621684659540"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1801"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684659541"><span class="hs-identifier hs-var">insns</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier">maxInlineMemcpyInsns</span><span> </span><a href="#local-6989586621684659535"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621684659537"><span class="hs-identifier hs-var">align</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1802"></a><span>        </span><a name="local-6989586621684659551"><a href="#local-6989586621684659551"><span class="hs-identifier">code_dst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659538"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-1803"></a><span>        </span><a name="local-6989586621684659552"><a href="#local-6989586621684659552"><span class="hs-identifier">dst_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659542"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1804"></a><span>        </span><a name="local-6989586621684659553"><a href="#local-6989586621684659553"><span class="hs-identifier">code_src</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659539"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1805"></a><span>        </span><a name="local-6989586621684659554"><a href="#local-6989586621684659554"><span class="hs-identifier">src_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659542"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1806"></a><span>        </span><a name="local-6989586621684659555"><a href="#local-6989586621684659555"><span class="hs-identifier">tmp_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659542"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1807"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659551"><span class="hs-identifier hs-var">code_dst</span></a><span> </span><a href="#local-6989586621684659552"><span class="hs-identifier hs-var">dst_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659553"><span class="hs-identifier hs-var">code_src</span></a><span> </span><a href="#local-6989586621684659554"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1808"></a><span>            </span><a href="#local-6989586621684659544"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621684659552"><span class="hs-identifier hs-var">dst_r</span></a><span> </span><a href="#local-6989586621684659554"><span class="hs-identifier hs-var">src_r</span></a><span> </span><a href="#local-6989586621684659555"><span class="hs-identifier hs-var">tmp_r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684659540"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1809"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1810"></a><span>    </span><span class="hs-comment">-- The number of instructions we will generate (approx). We need 2</span><span>
</span><a name="line-1811"></a><span>    </span><span class="hs-comment">-- instructions per move.</span><span>
</span><a name="line-1812"></a><span>    </span><a name="local-6989586621684659541"><a href="#local-6989586621684659541"><span class="hs-identifier">insns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621684659540"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684659543"><span class="hs-identifier hs-var">sizeBytes</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659543"><span class="hs-identifier hs-var">sizeBytes</span></a><span class="hs-special">)</span><span>
</span><a name="line-1813"></a><span>
</span><a name="line-1814"></a><span>    </span><a name="local-6989586621684659542"><a href="#local-6989586621684659542"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659537"><span class="hs-identifier hs-var">align</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><a href="#local-6989586621684659536"><span class="hs-identifier hs-var">is32Bit</span></a><span class="hs-special">)</span><span>
</span><a name="line-1815"></a><span>
</span><a name="line-1816"></a><span>    </span><span class="hs-comment">-- The size of each move, in bytes.</span><span>
</span><a name="line-1817"></a><span>    </span><span class="hs-identifier">sizeBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-1818"></a><span>    </span><a name="local-6989586621684659543"><a href="#local-6989586621684659543"><span class="hs-identifier">sizeBytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="Format.html#formatInBytes"><span class="hs-identifier hs-var">formatInBytes</span></a><span> </span><a href="#local-6989586621684659542"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span>
</span><a name="line-1819"></a><span>
</span><a name="line-1820"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span>
</span><a name="line-1821"></a><span>    </span><a name="local-6989586621684659544"><a href="#local-6989586621684659544"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621684659545"><a href="#local-6989586621684659545"><span class="hs-identifier">dst</span></a></a><span> </span><a name="local-6989586621684659546"><a href="#local-6989586621684659546"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621684659547"><a href="#local-6989586621684659547"><span class="hs-identifier">tmp</span></a></a><span> </span><a name="local-6989586621684659548"><a href="#local-6989586621684659548"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-1822"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659548"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621684659543"><span class="hs-identifier hs-var">sizeBytes</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1823"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659542"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659549"><span class="hs-identifier hs-var">src_addr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1824"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659542"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659550"><span class="hs-identifier hs-var">dst_addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1825"></a><span>            </span><a href="#local-6989586621684659544"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621684659545"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684659546"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659548"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684659543"><span class="hs-identifier hs-var">sizeBytes</span></a><span class="hs-special">)</span><span>
</span><a name="line-1826"></a><span>        </span><span class="hs-comment">-- Deal with remaining bytes.</span><span>
</span><a name="line-1827"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659548"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-comment">-- Will never happen on 32-bit</span><span>
</span><a name="line-1828"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659549"><span class="hs-identifier hs-var">src_addr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1829"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659550"><span class="hs-identifier hs-var">dst_addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1830"></a><span>            </span><a href="#local-6989586621684659544"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621684659545"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684659546"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659548"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">4</span><span class="hs-special">)</span><span>
</span><a name="line-1831"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659548"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1832"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659549"><span class="hs-identifier hs-var">src_addr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1833"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659550"><span class="hs-identifier hs-var">dst_addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1834"></a><span>            </span><a href="#local-6989586621684659544"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621684659545"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684659546"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659548"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-1835"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659548"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1836"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659549"><span class="hs-identifier hs-var">src_addr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1837"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659550"><span class="hs-identifier hs-var">dst_addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1838"></a><span>            </span><a href="#local-6989586621684659544"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621684659545"><span class="hs-identifier hs-var">dst</span></a><span> </span><a href="#local-6989586621684659546"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684659547"><span class="hs-identifier hs-var">tmp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659548"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1839"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1840"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1841"></a><span>        </span><a name="local-6989586621684659549"><a href="#local-6989586621684659549"><span class="hs-identifier">src_addr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659546"><span class="hs-identifier hs-var">src</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span>
</span><a name="line-1842"></a><span>                   </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659540"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684659548"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1843"></a><span>        </span><a name="local-6989586621684659550"><a href="#local-6989586621684659550"><span class="hs-identifier">dst_addr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659545"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span>
</span><a name="line-1844"></a><span>                   </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659540"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684659548"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1845"></a><span>
</span><a name="line-1846"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659556"><a href="#local-6989586621684659556"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Memset"><span class="hs-identifier hs-var">MO_Memset</span></a><span> </span><a name="local-6989586621684659557"><a href="#local-6989586621684659557"><span class="hs-identifier">align</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-1847"></a><span>         </span><span class="hs-special">[</span><a name="local-6989586621684659558"><a href="#local-6989586621684659558"><span class="hs-identifier">dst</span></a></a><span class="hs-special">,</span><span>
</span><a name="line-1848"></a><span>          </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659559"><a href="#local-6989586621684659559"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1849"></a><span>          </span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><a name="local-6989586621684659560"><a href="#local-6989586621684659560"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1850"></a><span>         </span><span class="hs-identifier">_</span><span>
</span><a name="line-1851"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684659565"><span class="hs-identifier hs-var">insns</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier">maxInlineMemsetInsns</span><span> </span><a href="#local-6989586621684659556"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621684659557"><span class="hs-identifier hs-var">align</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1852"></a><span>        </span><a name="local-6989586621684659571"><a href="#local-6989586621684659571"><span class="hs-identifier">code_dst</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659558"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-1853"></a><span>        </span><a name="local-6989586621684659572"><a href="#local-6989586621684659572"><span class="hs-identifier">dst_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659561"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1854"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659571"><span class="hs-identifier hs-var">code_dst</span></a><span> </span><a href="#local-6989586621684659572"><span class="hs-identifier hs-var">dst_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659567"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621684659572"><span class="hs-identifier hs-var">dst_r</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromInteger</span><span> </span><a href="#local-6989586621684659560"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-1855"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1856"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684659561"><a href="#local-6989586621684659561"><span class="hs-identifier">format</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659562"><a href="#local-6989586621684659562"><span class="hs-identifier">val</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659557"><span class="hs-identifier hs-var">align</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-number">3</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1857"></a><span>        </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659563"><span class="hs-identifier hs-var">c2</span></a><span class="hs-special">)</span><span>
</span><a name="line-1858"></a><span>        </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659564"><span class="hs-identifier hs-var">c4</span></a><span class="hs-special">)</span><span>
</span><a name="line-1859"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659559"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-1860"></a><span>    </span><a name="local-6989586621684659563"><a href="#local-6989586621684659563"><span class="hs-identifier">c2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659559"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621684659559"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-1861"></a><span>    </span><a name="local-6989586621684659564"><a href="#local-6989586621684659564"><span class="hs-identifier">c4</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659563"><span class="hs-identifier hs-var">c2</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">shiftL</span><span class="hs-special">`</span><span> </span><span class="hs-number">16</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="#local-6989586621684659563"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-1862"></a><span>
</span><a name="line-1863"></a><span>    </span><span class="hs-comment">-- The number of instructions we will generate (approx). We need 1</span><span>
</span><a name="line-1864"></a><span>    </span><span class="hs-comment">-- instructions per move.</span><span>
</span><a name="line-1865"></a><span>    </span><a name="local-6989586621684659565"><a href="#local-6989586621684659565"><span class="hs-identifier">insns</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659560"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684659566"><span class="hs-identifier hs-var">sizeBytes</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659566"><span class="hs-identifier hs-var">sizeBytes</span></a><span>
</span><a name="line-1866"></a><span>
</span><a name="line-1867"></a><span>    </span><span class="hs-comment">-- The size of each move, in bytes.</span><span>
</span><a name="line-1868"></a><span>    </span><span class="hs-identifier">sizeBytes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span>
</span><a name="line-1869"></a><span>    </span><a name="local-6989586621684659566"><a href="#local-6989586621684659566"><span class="hs-identifier">sizeBytes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="Format.html#formatInBytes"><span class="hs-identifier hs-var">formatInBytes</span></a><span> </span><a href="#local-6989586621684659561"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span>
</span><a name="line-1870"></a><span>
</span><a name="line-1871"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span>
</span><a name="line-1872"></a><span>    </span><a name="local-6989586621684659567"><a href="#local-6989586621684659567"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621684659568"><a href="#local-6989586621684659568"><span class="hs-identifier">dst</span></a></a><span> </span><a name="local-6989586621684659569"><a href="#local-6989586621684659569"><span class="hs-identifier">i</span></a></a><span>
</span><a name="line-1873"></a><span>        </span><span class="hs-comment">-- TODO: Add movabs instruction and support 64-bit sets.</span><span>
</span><a name="line-1874"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659569"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621684659566"><span class="hs-identifier hs-var">sizeBytes</span></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-comment">-- This might be smaller than the below sizes</span><span>
</span><a name="line-1875"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659561"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><a href="#local-6989586621684659562"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659570"><span class="hs-identifier hs-var">dst_addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1876"></a><span>            </span><a href="#local-6989586621684659567"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621684659568"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659569"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684659566"><span class="hs-identifier hs-var">sizeBytes</span></a><span class="hs-special">)</span><span>
</span><a name="line-1877"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659569"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-comment">-- Will never happen on 32-bit</span><span>
</span><a name="line-1878"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><a href="#local-6989586621684659564"><span class="hs-identifier hs-var">c4</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659570"><span class="hs-identifier hs-var">dst_addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1879"></a><span>            </span><a href="#local-6989586621684659567"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621684659568"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659569"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">4</span><span class="hs-special">)</span><span>
</span><a name="line-1880"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659569"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1881"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><a href="#local-6989586621684659563"><span class="hs-identifier hs-var">c2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659570"><span class="hs-identifier hs-var">dst_addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1882"></a><span>            </span><a href="#local-6989586621684659567"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621684659568"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659569"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-1883"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659569"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1884"></a><span>            </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><a href="#local-6989586621684659559"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659570"><span class="hs-identifier hs-var">dst_addr</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1885"></a><span>            </span><a href="#local-6989586621684659567"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621684659568"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659569"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1886"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1887"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-1888"></a><span>        </span><a name="local-6989586621684659570"><a href="#local-6989586621684659570"><span class="hs-identifier">dst_addr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659568"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span> </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span>
</span><a name="line-1889"></a><span>                   </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659560"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684659569"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1890"></a><span>
</span><a name="line-1891"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a href="CmmMachOp.html#MO_WriteBarrier"><span class="hs-identifier hs-var">MO_WriteBarrier</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1892"></a><span>        </span><span class="hs-comment">-- write barrier compiles to no code on x86/x86-64;</span><span>
</span><a name="line-1893"></a><span>        </span><span class="hs-comment">-- we keep it this long in order to prevent earlier optimisations.</span><span>
</span><a name="line-1894"></a><span>
</span><a name="line-1895"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a href="CmmMachOp.html#MO_Touch"><span class="hs-identifier hs-var">MO_Touch</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-1896"></a><span>
</span><a name="line-1897"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659573"><a href="#local-6989586621684659573"><span class="hs-identifier">is32bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Prefetch_Data"><span class="hs-identifier hs-var">MO_Prefetch_Data</span></a><span> </span><a name="local-6989586621684659574"><a href="#local-6989586621684659574"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-special">[</span><a name="local-6989586621684659575"><a href="#local-6989586621684659575"><span class="hs-identifier">src</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1898"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659574"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1899"></a><span>            </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659577"><span class="hs-identifier hs-var">genPrefetch</span></a><span> </span><a href="#local-6989586621684659575"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Instr.html#PREFETCH"><span class="hs-identifier hs-var">PREFETCH</span></a><span> </span><a href="X86.Instr.html#NTA"><span class="hs-identifier hs-var">NTA</span></a><span>  </span><a href="#local-6989586621684659576"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1900"></a><span>            </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659577"><span class="hs-identifier hs-var">genPrefetch</span></a><span> </span><a href="#local-6989586621684659575"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Instr.html#PREFETCH"><span class="hs-identifier hs-var">PREFETCH</span></a><span> </span><a href="X86.Instr.html#Lvl2"><span class="hs-identifier hs-var">Lvl2</span></a><span> </span><a href="#local-6989586621684659576"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1901"></a><span>            </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659577"><span class="hs-identifier hs-var">genPrefetch</span></a><span> </span><a href="#local-6989586621684659575"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Instr.html#PREFETCH"><span class="hs-identifier hs-var">PREFETCH</span></a><span> </span><a href="X86.Instr.html#Lvl1"><span class="hs-identifier hs-var">Lvl1</span></a><span> </span><a href="#local-6989586621684659576"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1902"></a><span>            </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659577"><span class="hs-identifier hs-var">genPrefetch</span></a><span> </span><a href="#local-6989586621684659575"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Instr.html#PREFETCH"><span class="hs-identifier hs-var">PREFETCH</span></a><span> </span><a href="X86.Instr.html#Lvl0"><span class="hs-identifier hs-var">Lvl0</span></a><span> </span><a href="#local-6989586621684659576"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1903"></a><span>            </span><a name="local-6989586621684659582"><a href="#local-6989586621684659582"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;unexpected prefetch level in genCCall MO_Prefetch_Data: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684659582"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">)</span><span>
</span><a name="line-1904"></a><span>            </span><span class="hs-comment">-- the c / llvm prefetch convention is 0, 1, 2, and 3</span><span>
</span><a name="line-1905"></a><span>            </span><span class="hs-comment">-- the x86 corresponding names are : NTA, 2 , 1, and 0</span><span>
</span><a name="line-1906"></a><span>   </span><span class="hs-keyword">where</span><span>
</span><a name="line-1907"></a><span>        </span><a name="local-6989586621684659576"><a href="#local-6989586621684659576"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><a href="#local-6989586621684659573"><span class="hs-identifier hs-var">is32bit</span></a><span>
</span><a name="line-1908"></a><span>        </span><span class="hs-comment">-- need to know what register width for pointers!</span><span>
</span><a name="line-1909"></a><span>        </span><a name="local-6989586621684659577"><a href="#local-6989586621684659577"><span class="hs-identifier">genPrefetch</span></a></a><span> </span><a name="local-6989586621684659578"><a href="#local-6989586621684659578"><span class="hs-identifier">inRegSrc</span></a></a><span> </span><a name="local-6989586621684659579"><a href="#local-6989586621684659579"><span class="hs-identifier">prefetchCTor</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1910"></a><span>            </span><span class="hs-keyword">do</span><span>
</span><a name="line-1911"></a><span>                </span><a name="local-6989586621684659580"><a href="#local-6989586621684659580"><span class="hs-identifier">code_src</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659578"><span class="hs-identifier hs-var">inRegSrc</span></a><span>
</span><a name="line-1912"></a><span>                </span><a name="local-6989586621684659581"><a href="#local-6989586621684659581"><span class="hs-identifier">src_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659576"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1913"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659580"><span class="hs-identifier hs-var">code_src</span></a><span> </span><a href="#local-6989586621684659581"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1914"></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659579"><span class="hs-identifier hs-var">prefetchCTor</span></a><span>  </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span>
</span><a name="line-1915"></a><span>                              </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684659581"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">)</span><span>   </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1916"></a><span>                  </span><span class="hs-comment">-- prefetch always takes an address</span><span>
</span><a name="line-1917"></a><span>
</span><a name="line-1918"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659583"><a href="#local-6989586621684659583"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659584"><a href="#local-6989586621684659584"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_BSwap"><span class="hs-identifier hs-var">MO_BSwap</span></a><span> </span><a name="local-6989586621684659585"><a href="#local-6989586621684659585"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659586"><a href="#local-6989586621684659586"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659587"><a href="#local-6989586621684659587"><span class="hs-identifier">src</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1919"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659589"><a href="#local-6989586621684659589"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659583"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1920"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659590"><a href="#local-6989586621684659590"><span class="hs-identifier">dst_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659589"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659586"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1921"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659585"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1922"></a><span>        </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659584"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1923"></a><span>               </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684659591"><a href="#local-6989586621684659591"><span class="hs-identifier">vcode</span></a></a><span> </span><a name="local-6989586621684659592"><a href="#local-6989586621684659592"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684659587"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1924"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659593"><a href="#local-6989586621684659593"><span class="hs-identifier">dst_rhi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684659590"><span class="hs-identifier hs-var">dst_r</span></a><span>
</span><a name="line-1925"></a><span>                   </span><a name="local-6989586621684659594"><a href="#local-6989586621684659594"><span class="hs-identifier">rhi</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684659592"><span class="hs-identifier hs-var">rlo</span></a><span>
</span><a name="line-1926"></a><span>               </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659591"><span class="hs-identifier hs-var">vcode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1927"></a><span>                        </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659592"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659593"><span class="hs-identifier hs-var">dst_rhi</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1928"></a><span>                               </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659594"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659590"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-1929"></a><span>                               </span><a href="X86.Instr.html#BSWAP"><span class="hs-identifier hs-var">BSWAP</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684659593"><span class="hs-identifier hs-var">dst_rhi</span></a><span class="hs-special">,</span><span>
</span><a name="line-1930"></a><span>                               </span><a href="X86.Instr.html#BSWAP"><span class="hs-identifier hs-var">BSWAP</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684659590"><span class="hs-identifier hs-var">dst_r</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1931"></a><span>        </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659595"><a href="#local-6989586621684659595"><span class="hs-identifier">code_src</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659587"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1932"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659595"><span class="hs-identifier hs-var">code_src</span></a><span> </span><a href="#local-6989586621684659590"><span class="hs-identifier hs-var">dst_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1933"></a><span>                           </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#BSWAP"><span class="hs-identifier hs-var">BSWAP</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684659590"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1934"></a><span>                           </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#SHR"><span class="hs-identifier hs-var">SHR</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659590"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1935"></a><span>        </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659596"><a href="#local-6989586621684659596"><span class="hs-identifier">code_src</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659587"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1936"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659596"><span class="hs-identifier hs-var">code_src</span></a><span> </span><a href="#local-6989586621684659590"><span class="hs-identifier hs-var">dst_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#BSWAP"><span class="hs-identifier hs-var">BSWAP</span></a><span> </span><a href="#local-6989586621684659588"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659590"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1937"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1938"></a><span>    </span><a name="local-6989586621684659588"><a href="#local-6989586621684659588"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659585"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1939"></a><span>
</span><a name="line-1940"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659597"><a href="#local-6989586621684659597"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659598"><a href="#local-6989586621684659598"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_PopCnt"><span class="hs-identifier hs-var">MO_PopCnt</span></a><span> </span><a name="local-6989586621684659599"><a href="#local-6989586621684659599"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684659600"><a href="#local-6989586621684659600"><span class="hs-identifier">dest_regs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><a name="local-6989586621684659601"><a href="#local-6989586621684659601"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1941"></a><span>         </span><a name="local-6989586621684659602"><a href="#local-6989586621684659602"><span class="hs-identifier">args</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><a name="local-6989586621684659603"><a href="#local-6989586621684659603"><span class="hs-identifier">src</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659604"><a href="#local-6989586621684659604"><span class="hs-identifier">bid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1942"></a><span>    </span><a name="local-6989586621684659607"><a href="#local-6989586621684659607"><span class="hs-identifier">sse4_2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse4_2Enabled"><span class="hs-identifier hs-var">sse4_2Enabled</span></a><span>
</span><a name="line-1943"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659608"><a href="#local-6989586621684659608"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659597"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1944"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659607"><span class="hs-identifier hs-var">sse4_2</span></a><span>
</span><a name="line-1945"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659609"><a href="#local-6989586621684659609"><span class="hs-identifier">code_src</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659603"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1946"></a><span>                </span><a name="local-6989586621684659610"><a href="#local-6989586621684659610"><span class="hs-identifier">src_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659605"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1947"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659611"><a href="#local-6989586621684659611"><span class="hs-identifier">dst_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659608"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659601"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1948"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659609"><span class="hs-identifier hs-var">code_src</span></a><span> </span><a href="#local-6989586621684659610"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1949"></a><span>                    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659599"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-1950"></a><span>                         </span><span class="hs-comment">-- The POPCNT instruction doesn't take a r/m8</span><span>
</span><a name="line-1951"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659610"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659610"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1952"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#POPCNT"><span class="hs-identifier hs-var">POPCNT</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659610"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659611"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1953"></a><span>                     </span><span class="hs-keyword">else</span><span>
</span><a name="line-1954"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#POPCNT"><span class="hs-identifier hs-var">POPCNT</span></a><span> </span><a href="#local-6989586621684659605"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659610"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659611"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1955"></a><span>                    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659599"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659599"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-1956"></a><span>                         </span><span class="hs-comment">-- We used a 16-bit destination register above,</span><span>
</span><a name="line-1957"></a><span>                         </span><span class="hs-comment">-- so zero-extend</span><span>
</span><a name="line-1958"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659611"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659611"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1959"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1960"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1961"></a><span>            </span><a name="local-6989586621684659612"><a href="#local-6989586621684659612"><span class="hs-identifier">targetExpr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684659597"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1962"></a><span>                          </span><a href="PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a><span> </span><a href="#local-6989586621684659606"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-1963"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659613"><a href="#local-6989586621684659613"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a href="#local-6989586621684659612"><span class="hs-identifier hs-var">targetExpr</span></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a><span> </span><span class="hs-identifier hs-var">CCallConv</span><span>
</span><a name="line-1964"></a><span>                                                           </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoHint</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoHint</span><span class="hs-special">]</span><span>
</span><a name="line-1965"></a><span>                                                           </span><a href="CmmNode.html#CmmMayReturn"><span class="hs-identifier hs-var">CmmMayReturn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1966"></a><span>            </span><a href="X86.CodeGen.html#genCCall"><span class="hs-identifier hs-var">genCCall</span></a><span> </span><a href="#local-6989586621684659597"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659598"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659613"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684659600"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684659602"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621684659604"><span class="hs-identifier hs-var">bid</span></a><span>
</span><a name="line-1967"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1968"></a><span>    </span><a name="local-6989586621684659605"><a href="#local-6989586621684659605"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659599"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-1969"></a><span>    </span><a name="local-6989586621684659606"><a href="#local-6989586621684659606"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CLabel.html#mkCmmCodeLabel"><span class="hs-identifier hs-var">mkCmmCodeLabel</span></a><span> </span><span class="hs-identifier hs-var">primUnitId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-special">(</span><a href="CPrim.html#popCntLabel"><span class="hs-identifier hs-var">popCntLabel</span></a><span> </span><a href="#local-6989586621684659599"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1970"></a><span>
</span><a name="line-1971"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659614"><a href="#local-6989586621684659614"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659615"><a href="#local-6989586621684659615"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Pdep"><span class="hs-identifier hs-var">MO_Pdep</span></a><span> </span><a name="local-6989586621684659616"><a href="#local-6989586621684659616"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684659617"><a href="#local-6989586621684659617"><span class="hs-identifier">dest_regs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><a name="local-6989586621684659618"><a href="#local-6989586621684659618"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-1972"></a><span>         </span><a name="local-6989586621684659619"><a href="#local-6989586621684659619"><span class="hs-identifier">args</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><a name="local-6989586621684659620"><a href="#local-6989586621684659620"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659621"><a href="#local-6989586621684659621"><span class="hs-identifier">mask</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659622"><a href="#local-6989586621684659622"><span class="hs-identifier">bid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1973"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659625"><a href="#local-6989586621684659625"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659614"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1974"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isBmi2Enabled</span><span> </span><a href="#local-6989586621684659614"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1975"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659626"><a href="#local-6989586621684659626"><span class="hs-identifier">code_src</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659620"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-1976"></a><span>                </span><a name="local-6989586621684659627"><a href="#local-6989586621684659627"><span class="hs-identifier">code_mask</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659621"><span class="hs-identifier hs-var">mask</span></a><span>
</span><a name="line-1977"></a><span>                </span><a name="local-6989586621684659628"><a href="#local-6989586621684659628"><span class="hs-identifier">src_r</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659623"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1978"></a><span>                </span><a name="local-6989586621684659629"><a href="#local-6989586621684659629"><span class="hs-identifier">mask_r</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659623"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-1979"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659630"><a href="#local-6989586621684659630"><span class="hs-identifier">dst_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659625"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659618"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-1980"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659626"><span class="hs-identifier hs-var">code_src</span></a><span> </span><a href="#local-6989586621684659628"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659627"><span class="hs-identifier hs-var">code_mask</span></a><span> </span><a href="#local-6989586621684659629"><span class="hs-identifier hs-var">mask_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1981"></a><span>                    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659616"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-1982"></a><span>                         </span><span class="hs-comment">-- The PDEP instruction doesn't take a r/m8</span><span>
</span><a name="line-1983"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>  </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659628"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659628"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1984"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>  </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659629"><span class="hs-identifier hs-var">mask_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659629"><span class="hs-identifier hs-var">mask_r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1985"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#PDEP"><span class="hs-identifier hs-var">PDEP</span></a><span>   </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659629"><span class="hs-identifier hs-var">mask_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659628"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659630"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-1986"></a><span>                     </span><span class="hs-keyword">else</span><span>
</span><a name="line-1987"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#PDEP"><span class="hs-identifier hs-var">PDEP</span></a><span> </span><a href="#local-6989586621684659623"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659629"><span class="hs-identifier hs-var">mask_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659628"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659630"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-1988"></a><span>                    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659616"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659616"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-1989"></a><span>                         </span><span class="hs-comment">-- We used a 16-bit destination register above,</span><span>
</span><a name="line-1990"></a><span>                         </span><span class="hs-comment">-- so zero-extend</span><span>
</span><a name="line-1991"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659630"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659630"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1992"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-1993"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1994"></a><span>            </span><a name="local-6989586621684659631"><a href="#local-6989586621684659631"><span class="hs-identifier">targetExpr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684659614"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-1995"></a><span>                          </span><a href="PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a><span> </span><a href="#local-6989586621684659624"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-1996"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659632"><a href="#local-6989586621684659632"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a href="#local-6989586621684659631"><span class="hs-identifier hs-var">targetExpr</span></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a><span> </span><span class="hs-identifier hs-var">CCallConv</span><span>
</span><a name="line-1997"></a><span>                                                           </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoHint</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoHint</span><span class="hs-special">]</span><span>
</span><a name="line-1998"></a><span>                                                           </span><a href="CmmNode.html#CmmMayReturn"><span class="hs-identifier hs-var">CmmMayReturn</span></a><span class="hs-special">)</span><span>
</span><a name="line-1999"></a><span>            </span><a href="X86.CodeGen.html#genCCall"><span class="hs-identifier hs-var">genCCall</span></a><span> </span><a href="#local-6989586621684659614"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659615"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659632"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684659617"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684659619"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621684659622"><span class="hs-identifier hs-var">bid</span></a><span>
</span><a name="line-2000"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2001"></a><span>    </span><a name="local-6989586621684659623"><a href="#local-6989586621684659623"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659616"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2002"></a><span>    </span><a name="local-6989586621684659624"><a href="#local-6989586621684659624"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CLabel.html#mkCmmCodeLabel"><span class="hs-identifier hs-var">mkCmmCodeLabel</span></a><span> </span><span class="hs-identifier hs-var">primUnitId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-special">(</span><a href="CPrim.html#pdepLabel"><span class="hs-identifier hs-var">pdepLabel</span></a><span> </span><a href="#local-6989586621684659616"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2003"></a><span>
</span><a name="line-2004"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659633"><a href="#local-6989586621684659633"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659634"><a href="#local-6989586621684659634"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Pext"><span class="hs-identifier hs-var">MO_Pext</span></a><span> </span><a name="local-6989586621684659635"><a href="#local-6989586621684659635"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684659636"><a href="#local-6989586621684659636"><span class="hs-identifier">dest_regs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><a name="local-6989586621684659637"><a href="#local-6989586621684659637"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-2005"></a><span>         </span><a name="local-6989586621684659638"><a href="#local-6989586621684659638"><span class="hs-identifier">args</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><a name="local-6989586621684659639"><a href="#local-6989586621684659639"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659640"><a href="#local-6989586621684659640"><span class="hs-identifier">mask</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659641"><a href="#local-6989586621684659641"><span class="hs-identifier">bid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2006"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659644"><a href="#local-6989586621684659644"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659633"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2007"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">isBmi2Enabled</span><span> </span><a href="#local-6989586621684659633"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2008"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659645"><a href="#local-6989586621684659645"><span class="hs-identifier">code_src</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659639"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-2009"></a><span>                </span><a name="local-6989586621684659646"><a href="#local-6989586621684659646"><span class="hs-identifier">code_mask</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659640"><span class="hs-identifier hs-var">mask</span></a><span>
</span><a name="line-2010"></a><span>                </span><a name="local-6989586621684659647"><a href="#local-6989586621684659647"><span class="hs-identifier">src_r</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659642"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2011"></a><span>                </span><a name="local-6989586621684659648"><a href="#local-6989586621684659648"><span class="hs-identifier">mask_r</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659642"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2012"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659649"><a href="#local-6989586621684659649"><span class="hs-identifier">dst_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659644"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659637"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2013"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659645"><span class="hs-identifier hs-var">code_src</span></a><span> </span><a href="#local-6989586621684659647"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659646"><span class="hs-identifier hs-var">code_mask</span></a><span> </span><a href="#local-6989586621684659648"><span class="hs-identifier hs-var">mask_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2014"></a><span>                    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659635"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-2015"></a><span>                         </span><span class="hs-comment">-- The PEXT instruction doesn't take a r/m8</span><span>
</span><a name="line-2016"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659647"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659647"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2017"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659648"><span class="hs-identifier hs-var">mask_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659648"><span class="hs-identifier hs-var">mask_r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2018"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#PEXT"><span class="hs-identifier hs-var">PEXT</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659648"><span class="hs-identifier hs-var">mask_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659647"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659649"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2019"></a><span>                     </span><span class="hs-keyword">else</span><span>
</span><a name="line-2020"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#PEXT"><span class="hs-identifier hs-var">PEXT</span></a><span> </span><a href="#local-6989586621684659642"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659648"><span class="hs-identifier hs-var">mask_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659647"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659649"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2021"></a><span>                    </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659635"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684659635"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-keyword">then</span><span>
</span><a name="line-2022"></a><span>                         </span><span class="hs-comment">-- We used a 16-bit destination register above,</span><span>
</span><a name="line-2023"></a><span>                         </span><span class="hs-comment">-- so zero-extend</span><span>
</span><a name="line-2024"></a><span>                         </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659649"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659649"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2025"></a><span>                     </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-2026"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2027"></a><span>            </span><a name="local-6989586621684659650"><a href="#local-6989586621684659650"><span class="hs-identifier">targetExpr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684659633"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2028"></a><span>                          </span><a href="PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a><span> </span><a href="#local-6989586621684659643"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2029"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659651"><a href="#local-6989586621684659651"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a href="#local-6989586621684659650"><span class="hs-identifier hs-var">targetExpr</span></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a><span> </span><span class="hs-identifier hs-var">CCallConv</span><span>
</span><a name="line-2030"></a><span>                                                           </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoHint</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoHint</span><span class="hs-special">]</span><span>
</span><a name="line-2031"></a><span>                                                           </span><a href="CmmNode.html#CmmMayReturn"><span class="hs-identifier hs-var">CmmMayReturn</span></a><span class="hs-special">)</span><span>
</span><a name="line-2032"></a><span>            </span><a href="X86.CodeGen.html#genCCall"><span class="hs-identifier hs-var">genCCall</span></a><span> </span><a href="#local-6989586621684659633"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659634"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659651"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684659636"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684659638"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621684659641"><span class="hs-identifier hs-var">bid</span></a><span>
</span><a name="line-2033"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2034"></a><span>    </span><a name="local-6989586621684659642"><a href="#local-6989586621684659642"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659635"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2035"></a><span>    </span><a name="local-6989586621684659643"><a href="#local-6989586621684659643"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CLabel.html#mkCmmCodeLabel"><span class="hs-identifier hs-var">mkCmmCodeLabel</span></a><span> </span><span class="hs-identifier hs-var">primUnitId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-special">(</span><a href="CPrim.html#pextLabel"><span class="hs-identifier hs-var">pextLabel</span></a><span> </span><a href="#local-6989586621684659635"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2036"></a><span>
</span><a name="line-2037"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659652"><a href="#local-6989586621684659652"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659653"><a href="#local-6989586621684659653"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Clz"><span class="hs-identifier hs-var">MO_Clz</span></a><span> </span><a name="local-6989586621684659654"><a href="#local-6989586621684659654"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684659655"><a href="#local-6989586621684659655"><span class="hs-identifier">dest_regs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><a name="local-6989586621684659656"><a href="#local-6989586621684659656"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659657"><a href="#local-6989586621684659657"><span class="hs-identifier">args</span></a></a><span class="hs-glyph">@</span><span class="hs-special">[</span><a name="local-6989586621684659658"><a href="#local-6989586621684659658"><span class="hs-identifier">src</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659659"><a href="#local-6989586621684659659"><span class="hs-identifier">bid</span></a></a><span>
</span><a name="line-2038"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659653"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621684659654"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2039"></a><span>    </span><span class="hs-comment">-- Fallback to `hs_clz64` on i386</span><span>
</span><a name="line-2040"></a><span>    </span><a name="local-6989586621684659664"><a href="#local-6989586621684659664"><span class="hs-identifier">targetExpr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684659652"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a><span> </span><a href="#local-6989586621684659663"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2041"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659665"><a href="#local-6989586621684659665"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a href="#local-6989586621684659664"><span class="hs-identifier hs-var">targetExpr</span></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a><span> </span><span class="hs-identifier hs-var">CCallConv</span><span>
</span><a name="line-2042"></a><span>                                           </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoHint</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoHint</span><span class="hs-special">]</span><span>
</span><a name="line-2043"></a><span>                                           </span><a href="CmmNode.html#CmmMayReturn"><span class="hs-identifier hs-var">CmmMayReturn</span></a><span class="hs-special">)</span><span>
</span><a name="line-2044"></a><span>    </span><a href="X86.CodeGen.html#genCCall"><span class="hs-identifier hs-var">genCCall</span></a><span> </span><a href="#local-6989586621684659652"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659653"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659665"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684659655"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684659657"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621684659659"><span class="hs-identifier hs-var">bid</span></a><span>
</span><a name="line-2045"></a><span>
</span><a name="line-2046"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2047"></a><span>    </span><a name="local-6989586621684659666"><a href="#local-6989586621684659666"><span class="hs-identifier">code_src</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659658"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-2048"></a><span>    </span><a name="local-6989586621684659667"><a href="#local-6989586621684659667"><span class="hs-identifier">src_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659662"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2049"></a><span>    </span><a name="local-6989586621684659668"><a href="#local-6989586621684659668"><span class="hs-identifier">tmp_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659662"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2050"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659669"><a href="#local-6989586621684659669"><span class="hs-identifier">dst_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659661"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659656"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2051"></a><span>
</span><a name="line-2052"></a><span>    </span><span class="hs-comment">-- The following insn sequence makes sure 'clz 0' has a defined value.</span><span>
</span><a name="line-2053"></a><span>    </span><span class="hs-comment">-- starting with Haswell, one could use the LZCNT insn instead.</span><span>
</span><a name="line-2054"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659666"><span class="hs-identifier hs-var">code_src</span></a><span> </span><a href="#local-6989586621684659667"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span>
</span><a name="line-2055"></a><span>             </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span>  </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>    </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659667"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659667"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659654"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-2056"></a><span>              </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#BSR"><span class="hs-identifier hs-var">BSR</span></a><span>     </span><a href="#local-6989586621684659662"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659667"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659668"><span class="hs-identifier hs-var">tmp_r</span></a><span>
</span><a name="line-2057"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span>     </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>   </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-operator hs-var">*</span><a href="#local-6989586621684659660"><span class="hs-identifier hs-var">bw</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659669"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2058"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#CMOV"><span class="hs-identifier hs-var">CMOV</span></a><span> </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><a href="#local-6989586621684659662"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659668"><span class="hs-identifier hs-var">tmp_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659669"><span class="hs-identifier hs-var">dst_r</span></a><span>
</span><a name="line-2059"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span>     </span><a href="#local-6989586621684659662"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659660"><span class="hs-identifier hs-var">bw</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659669"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2060"></a><span>              </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NB: We don't need to zero-extend the result for the</span><span>
</span><a name="line-2061"></a><span>                 </span><span class="hs-comment">-- W8/W16 cases because the 'MOV' insn already</span><span>
</span><a name="line-2062"></a><span>                 </span><span class="hs-comment">-- took care of implicitly clearing the upper bits</span><span>
</span><a name="line-2063"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2064"></a><span>    </span><a name="local-6989586621684659660"><a href="#local-6989586621684659660"><span class="hs-identifier">bw</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">widthInBits</span><span> </span><a href="#local-6989586621684659654"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2065"></a><span>    </span><a name="local-6989586621684659661"><a href="#local-6989586621684659661"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659652"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2066"></a><span>    </span><a name="local-6989586621684659662"><a href="#local-6989586621684659662"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659654"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659654"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2067"></a><span>    </span><a name="local-6989586621684659663"><a href="#local-6989586621684659663"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CLabel.html#mkCmmCodeLabel"><span class="hs-identifier hs-var">mkCmmCodeLabel</span></a><span> </span><span class="hs-identifier hs-var">primUnitId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-special">(</span><a href="CPrim.html#clzLabel"><span class="hs-identifier hs-var">clzLabel</span></a><span> </span><a href="#local-6989586621684659654"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2068"></a><span>
</span><a name="line-2069"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659670"><a href="#local-6989586621684659670"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659671"><a href="#local-6989586621684659671"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Ctz"><span class="hs-identifier hs-var">MO_Ctz</span></a><span> </span><a name="local-6989586621684659672"><a href="#local-6989586621684659672"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659673"><a href="#local-6989586621684659673"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659674"><a href="#local-6989586621684659674"><span class="hs-identifier">src</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659675"><a href="#local-6989586621684659675"><span class="hs-identifier">bid</span></a></a><span>
</span><a name="line-2070"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659671"><span class="hs-identifier hs-var">is32Bit</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659672"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2071"></a><span>      </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684659679"><a href="#local-6989586621684659679"><span class="hs-identifier">vcode</span></a></a><span> </span><a name="local-6989586621684659680"><a href="#local-6989586621684659680"><span class="hs-identifier">rlo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684659674"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-2072"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659681"><a href="#local-6989586621684659681"><span class="hs-identifier">rhi</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684659680"><span class="hs-identifier hs-var">rlo</span></a><span>
</span><a name="line-2073"></a><span>          </span><a name="local-6989586621684659682"><a href="#local-6989586621684659682"><span class="hs-identifier">dst_r</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659677"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659673"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2074"></a><span>      </span><a name="local-6989586621684659683"><a href="#local-6989586621684659683"><span class="hs-identifier">lbl1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-2075"></a><span>      </span><a name="local-6989586621684659684"><a href="#local-6989586621684659684"><span class="hs-identifier">lbl2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-2076"></a><span>      </span><a name="local-6989586621684659685"><a href="#local-6989586621684659685"><span class="hs-identifier">tmp_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659678"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2077"></a><span>
</span><a name="line-2078"></a><span>      </span><span class="hs-comment">-- New CFG Edges:</span><span>
</span><a name="line-2079"></a><span>      </span><span class="hs-comment">--  bid -&gt; lbl2</span><span>
</span><a name="line-2080"></a><span>      </span><span class="hs-comment">--  bid -&gt; lbl1 -&gt; lbl2</span><span>
</span><a name="line-2081"></a><span>      </span><span class="hs-comment">--  We also changes edges originating at bid to start at lbl2 instead.</span><span>
</span><a name="line-2082"></a><span>      </span><a href="NCGMonad.html#updateCfgNat"><span class="hs-identifier hs-var">updateCfgNat</span></a><span> </span><span class="hs-special">(</span><a href="CFG.html#addWeightEdge"><span class="hs-identifier hs-var">addWeightEdge</span></a><span> </span><a href="#local-6989586621684659675"><span class="hs-identifier hs-var">bid</span></a><span> </span><a href="#local-6989586621684659683"><span class="hs-identifier hs-var">lbl1</span></a><span> </span><span class="hs-number">110</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-2083"></a><span>                    </span><a href="CFG.html#addWeightEdge"><span class="hs-identifier hs-var">addWeightEdge</span></a><span> </span><a href="#local-6989586621684659683"><span class="hs-identifier hs-var">lbl1</span></a><span> </span><a href="#local-6989586621684659684"><span class="hs-identifier hs-var">lbl2</span></a><span> </span><span class="hs-number">110</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-2084"></a><span>                    </span><a href="CFG.html#addImmediateSuccessor"><span class="hs-identifier hs-var">addImmediateSuccessor</span></a><span> </span><a href="#local-6989586621684659675"><span class="hs-identifier hs-var">bid</span></a><span> </span><a href="#local-6989586621684659684"><span class="hs-identifier hs-var">lbl2</span></a><span class="hs-special">)</span><span>
</span><a name="line-2085"></a><span>
</span><a name="line-2086"></a><span>      </span><span class="hs-comment">-- The following instruction sequence corresponds to the pseudo-code</span><span>
</span><a name="line-2087"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-2088"></a><span>      </span><span class="hs-comment">--  if (src) {</span><span>
</span><a name="line-2089"></a><span>      </span><span class="hs-comment">--    dst = src.lo32 ? BSF(src.lo32) : (BSF(src.hi32) + 32);</span><span>
</span><a name="line-2090"></a><span>      </span><span class="hs-comment">--  } else {</span><span>
</span><a name="line-2091"></a><span>      </span><span class="hs-comment">--    dst = 64;</span><span>
</span><a name="line-2092"></a><span>      </span><span class="hs-comment">--  }</span><span>
</span><a name="line-2093"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659679"><span class="hs-identifier hs-var">vcode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span>
</span><a name="line-2094"></a><span>               </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span>      </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659681"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span>         </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659685"><span class="hs-identifier hs-var">tmp_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2095"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span>       </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659680"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span>         </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659685"><span class="hs-identifier hs-var">tmp_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2096"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span>      </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">64</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659682"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2097"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="X86.Cond.html#EQQ"><span class="hs-identifier hs-var">EQQ</span></a><span>    </span><a href="#local-6989586621684659684"><span class="hs-identifier hs-var">lbl2</span></a><span>
</span><a name="line-2098"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="X86.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684659683"><span class="hs-identifier hs-var">lbl1</span></a><span>
</span><a name="line-2099"></a><span>
</span><a name="line-2100"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span>   </span><a href="#local-6989586621684659683"><span class="hs-identifier hs-var">lbl1</span></a><span>
</span><a name="line-2101"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#BSF"><span class="hs-identifier hs-var">BSF</span></a><span>     </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659681"><span class="hs-identifier hs-var">rhi</span></a><span class="hs-special">)</span><span>         </span><a href="#local-6989586621684659682"><span class="hs-identifier hs-var">dst_r</span></a><span>
</span><a name="line-2102"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span>     </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">32</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659682"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2103"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#BSF"><span class="hs-identifier hs-var">BSF</span></a><span>     </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659680"><span class="hs-identifier hs-var">rlo</span></a><span class="hs-special">)</span><span>         </span><a href="#local-6989586621684659685"><span class="hs-identifier hs-var">tmp_r</span></a><span>
</span><a name="line-2104"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#CMOV"><span class="hs-identifier hs-var">CMOV</span></a><span> </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659685"><span class="hs-identifier hs-var">tmp_r</span></a><span class="hs-special">)</span><span>       </span><a href="#local-6989586621684659682"><span class="hs-identifier hs-var">dst_r</span></a><span>
</span><a name="line-2105"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="X86.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684659684"><span class="hs-identifier hs-var">lbl2</span></a><span>
</span><a name="line-2106"></a><span>
</span><a name="line-2107"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span>   </span><a href="#local-6989586621684659684"><span class="hs-identifier hs-var">lbl2</span></a><span>
</span><a name="line-2108"></a><span>                </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2109"></a><span>
</span><a name="line-2110"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2111"></a><span>    </span><a name="local-6989586621684659686"><a href="#local-6989586621684659686"><span class="hs-identifier">code_src</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659674"><span class="hs-identifier hs-var">src</span></a><span>
</span><a name="line-2112"></a><span>    </span><a name="local-6989586621684659687"><a href="#local-6989586621684659687"><span class="hs-identifier">src_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659678"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2113"></a><span>    </span><a name="local-6989586621684659688"><a href="#local-6989586621684659688"><span class="hs-identifier">tmp_r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659678"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2114"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659689"><a href="#local-6989586621684659689"><span class="hs-identifier">dst_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659677"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659673"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2115"></a><span>
</span><a name="line-2116"></a><span>    </span><span class="hs-comment">-- The following insn sequence makes sure 'ctz 0' has a defined value.</span><span>
</span><a name="line-2117"></a><span>    </span><span class="hs-comment">-- starting with Haswell, one could use the TZCNT insn instead.</span><span>
</span><a name="line-2118"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659686"><span class="hs-identifier hs-var">code_src</span></a><span> </span><a href="#local-6989586621684659687"><span class="hs-identifier hs-var">src_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span>
</span><a name="line-2119"></a><span>             </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span>  </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>    </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659687"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659687"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659672"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-2120"></a><span>              </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#BSF"><span class="hs-identifier hs-var">BSF</span></a><span>     </span><a href="#local-6989586621684659678"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659687"><span class="hs-identifier hs-var">src_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659688"><span class="hs-identifier hs-var">tmp_r</span></a><span>
</span><a name="line-2121"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span>     </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span>   </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684659676"><span class="hs-identifier hs-var">bw</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659689"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2122"></a><span>              </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#CMOV"><span class="hs-identifier hs-var">CMOV</span></a><span> </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><a href="#local-6989586621684659678"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659688"><span class="hs-identifier hs-var">tmp_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659689"><span class="hs-identifier hs-var">dst_r</span></a><span>
</span><a name="line-2123"></a><span>              </span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NB: We don't need to zero-extend the result for the</span><span>
</span><a name="line-2124"></a><span>                 </span><span class="hs-comment">-- W8/W16 cases because the 'MOV' insn already</span><span>
</span><a name="line-2125"></a><span>                 </span><span class="hs-comment">-- took care of implicitly clearing the upper bits</span><span>
</span><a name="line-2126"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2127"></a><span>    </span><a name="local-6989586621684659676"><a href="#local-6989586621684659676"><span class="hs-identifier">bw</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">widthInBits</span><span> </span><a href="#local-6989586621684659672"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2128"></a><span>    </span><a name="local-6989586621684659677"><a href="#local-6989586621684659677"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659670"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2129"></a><span>    </span><a name="local-6989586621684659678"><a href="#local-6989586621684659678"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659672"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659672"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2130"></a><span>
</span><a name="line-2131"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659690"><a href="#local-6989586621684659690"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659691"><a href="#local-6989586621684659691"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UF_Conv"><span class="hs-identifier hs-var">MO_UF_Conv</span></a><span> </span><a name="local-6989586621684659692"><a href="#local-6989586621684659692"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684659693"><a href="#local-6989586621684659693"><span class="hs-identifier">dest_regs</span></a></a><span> </span><a name="local-6989586621684659694"><a href="#local-6989586621684659694"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621684659695"><a href="#local-6989586621684659695"><span class="hs-identifier">bid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2132"></a><span>    </span><a name="local-6989586621684659697"><a href="#local-6989586621684659697"><span class="hs-identifier">targetExpr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684659690"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2133"></a><span>                  </span><a href="PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a><span> </span><a href="#local-6989586621684659696"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2134"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659698"><a href="#local-6989586621684659698"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a href="#local-6989586621684659697"><span class="hs-identifier hs-var">targetExpr</span></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a><span> </span><span class="hs-identifier hs-var">CCallConv</span><span>
</span><a name="line-2135"></a><span>                                           </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoHint</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">NoHint</span><span class="hs-special">]</span><span>
</span><a name="line-2136"></a><span>                                           </span><a href="CmmNode.html#CmmMayReturn"><span class="hs-identifier hs-var">CmmMayReturn</span></a><span class="hs-special">)</span><span>
</span><a name="line-2137"></a><span>    </span><a href="X86.CodeGen.html#genCCall"><span class="hs-identifier hs-var">genCCall</span></a><span> </span><a href="#local-6989586621684659690"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659691"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659698"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684659693"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684659694"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621684659695"><span class="hs-identifier hs-var">bid</span></a><span>
</span><a name="line-2138"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2139"></a><span>    </span><a name="local-6989586621684659696"><a href="#local-6989586621684659696"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CLabel.html#mkCmmCodeLabel"><span class="hs-identifier hs-var">mkCmmCodeLabel</span></a><span> </span><span class="hs-identifier hs-var">primUnitId</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-special">(</span><a href="CPrim.html#word2FloatLabel"><span class="hs-identifier hs-var">word2FloatLabel</span></a><span> </span><a href="#local-6989586621684659692"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2140"></a><span>
</span><a name="line-2141"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659699"><a href="#local-6989586621684659699"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659700"><a href="#local-6989586621684659700"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AtomicRMW"><span class="hs-identifier hs-var">MO_AtomicRMW</span></a><span> </span><a name="local-6989586621684659701"><a href="#local-6989586621684659701"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684659702"><a href="#local-6989586621684659702"><span class="hs-identifier">amop</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2142"></a><span>                                           </span><span class="hs-special">[</span><a name="local-6989586621684659703"><a href="#local-6989586621684659703"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659704"><a href="#local-6989586621684659704"><span class="hs-identifier">addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659705"><a href="#local-6989586621684659705"><span class="hs-identifier">n</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659706"><a href="#local-6989586621684659706"><span class="hs-identifier">bid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2143"></a><span>    </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659724"><a href="#local-6989586621684659724"><span class="hs-identifier">amode</span></a></a><span> </span><a name="local-6989586621684659725"><a href="#local-6989586621684659725"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-2144"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659702"><span class="hs-identifier hs-var">amop</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><a href="CmmMachOp.html#AMO_Add"><span class="hs-identifier hs-var">AMO_Add</span></a><span class="hs-special">,</span><span> </span><a href="CmmMachOp.html#AMO_Sub"><span class="hs-identifier hs-var">AMO_Sub</span></a><span class="hs-special">]</span><span>
</span><a name="line-2145"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="X86.CodeGen.html#getAmode"><span class="hs-identifier hs-var">getAmode</span></a><span> </span><a href="#local-6989586621684659704"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-2146"></a><span>        </span><span class="hs-keyword">else</span><span> </span><a href="X86.CodeGen.html#getSimpleAmode"><span class="hs-identifier hs-var">getSimpleAmode</span></a><span> </span><a href="#local-6989586621684659699"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659700"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659704"><span class="hs-identifier hs-var">addr</span></a><span>  </span><span class="hs-comment">-- See genCCall for MO_Cmpxchg</span><span>
</span><a name="line-2147"></a><span>    </span><a name="local-6989586621684659726"><a href="#local-6989586621684659726"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2148"></a><span>    </span><a name="local-6989586621684659727"><a href="#local-6989586621684659727"><span class="hs-identifier">arg_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659705"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-2149"></a><span>    </span><a name="local-6989586621684659728"><a href="#local-6989586621684659728"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-2150"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659729"><a href="#local-6989586621684659729"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659699"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2151"></a><span>        </span><a name="local-6989586621684659730"><a href="#local-6989586621684659730"><span class="hs-identifier">dst_r</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659729"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659728"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659703"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2152"></a><span>    </span><a name="local-6989586621684659731"><a href="#local-6989586621684659731"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659707"><span class="hs-identifier hs-var">op_code</span></a><span> </span><a href="#local-6989586621684659730"><span class="hs-identifier hs-var">dst_r</span></a><span> </span><a href="#local-6989586621684659726"><span class="hs-identifier hs-var">arg</span></a><span> </span><a href="#local-6989586621684659724"><span class="hs-identifier hs-var">amode</span></a><span>
</span><a name="line-2153"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659725"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659727"><span class="hs-identifier hs-var">arg_code</span></a><span> </span><a href="#local-6989586621684659726"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659731"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-2154"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2155"></a><span>    </span><span class="hs-comment">-- Code for the operation</span><span>
</span><a name="line-2156"></a><span>    </span><span class="hs-identifier">op_code</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span>       </span><span class="hs-comment">-- Destination reg</span><span>
</span><a name="line-2157"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span>       </span><span class="hs-comment">-- Register containing argument</span><span>
</span><a name="line-2158"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Regs.html#AddrMode"><span class="hs-identifier hs-type">AddrMode</span></a><span>  </span><span class="hs-comment">-- Address of location to mutate</span><span>
</span><a name="line-2159"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2160"></a><span>    </span><a name="local-6989586621684659707"><a href="#local-6989586621684659707"><span class="hs-identifier">op_code</span></a></a><span> </span><a name="local-6989586621684659709"><a href="#local-6989586621684659709"><span class="hs-identifier">dst_r</span></a></a><span> </span><a name="local-6989586621684659710"><a href="#local-6989586621684659710"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621684659711"><a href="#local-6989586621684659711"><span class="hs-identifier">amode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659702"><span class="hs-identifier hs-var">amop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2161"></a><span>        </span><span class="hs-comment">-- In the common case where dst_r is a virtual register the</span><span>
</span><a name="line-2162"></a><span>        </span><span class="hs-comment">-- final move should go away, because it's the last use of arg</span><span>
</span><a name="line-2163"></a><span>        </span><span class="hs-comment">-- and the first use of dst_r.</span><span>
</span><a name="line-2164"></a><span>        </span><a href="CmmMachOp.html#AMO_Add"><span class="hs-identifier hs-var">AMO_Add</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#LOCK"><span class="hs-identifier hs-var">LOCK</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#XADD"><span class="hs-identifier hs-var">XADD</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659710"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659711"><span class="hs-identifier hs-var">amode</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2165"></a><span>                                  </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659710"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659709"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2166"></a><span>                                  </span><span class="hs-special">]</span><span>
</span><a name="line-2167"></a><span>        </span><a href="CmmMachOp.html#AMO_Sub"><span class="hs-identifier hs-var">AMO_Sub</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#NEGI"><span class="hs-identifier hs-var">NEGI</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659710"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2168"></a><span>                                  </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#LOCK"><span class="hs-identifier hs-var">LOCK</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#XADD"><span class="hs-identifier hs-var">XADD</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659710"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659711"><span class="hs-identifier hs-var">amode</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2169"></a><span>                                  </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659710"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659709"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2170"></a><span>                                  </span><span class="hs-special">]</span><span>
</span><a name="line-2171"></a><span>        </span><a href="CmmMachOp.html#AMO_And"><span class="hs-identifier hs-var">AMO_And</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659712"><span class="hs-identifier hs-var">cmpxchg_code</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621684659716"><a href="#local-6989586621684659716"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621684659717"><a href="#local-6989586621684659717"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659716"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684659717"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2172"></a><span>        </span><a href="CmmMachOp.html#AMO_Nand"><span class="hs-identifier hs-var">AMO_Nand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659712"><span class="hs-identifier hs-var">cmpxchg_code</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621684659718"><a href="#local-6989586621684659718"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621684659719"><a href="#local-6989586621684659719"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659718"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684659719"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-2173"></a><span>                                                    </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#NOT"><span class="hs-identifier hs-var">NOT</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659719"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-2174"></a><span>                                                    </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2175"></a><span>        </span><a href="CmmMachOp.html#AMO_Or"><span class="hs-identifier hs-var">AMO_Or</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659712"><span class="hs-identifier hs-var">cmpxchg_code</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621684659720"><a href="#local-6989586621684659720"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621684659721"><a href="#local-6989586621684659721"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659720"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684659721"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2176"></a><span>        </span><a href="CmmMachOp.html#AMO_Xor"><span class="hs-identifier hs-var">AMO_Xor</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659712"><span class="hs-identifier hs-var">cmpxchg_code</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621684659722"><a href="#local-6989586621684659722"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621684659723"><a href="#local-6989586621684659723"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="X86.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659722"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621684659723"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2177"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-2178"></a><span>        </span><span class="hs-comment">-- Simulate operation that lacks a dedicated instruction using</span><span>
</span><a name="line-2179"></a><span>        </span><span class="hs-comment">-- cmpxchg.</span><span>
</span><a name="line-2180"></a><span>        </span><span class="hs-identifier">cmpxchg_code</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2181"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">OrdList</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2182"></a><span>        </span><a name="local-6989586621684659712"><a href="#local-6989586621684659712"><span class="hs-identifier">cmpxchg_code</span></a></a><span> </span><a name="local-6989586621684659713"><a href="#local-6989586621684659713"><span class="hs-identifier">instrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2183"></a><span>            </span><a name="local-6989586621684659714"><a href="#local-6989586621684659714"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getBlockIdNat"><span class="hs-identifier hs-var">getBlockIdNat</span></a><span>
</span><a name="line-2184"></a><span>            </span><a name="local-6989586621684659715"><a href="#local-6989586621684659715"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2185"></a><span>
</span><a name="line-2186"></a><span>            </span><span class="hs-comment">--Record inserted blocks</span><span>
</span><a name="line-2187"></a><span>            </span><a href="NCGMonad.html#addImmediateSuccessorNat"><span class="hs-identifier hs-var">addImmediateSuccessorNat</span></a><span> </span><a href="#local-6989586621684659706"><span class="hs-identifier hs-var">bid</span></a><span> </span><a href="#local-6989586621684659714"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2188"></a><span>            </span><a href="NCGMonad.html#updateCfgNat"><span class="hs-identifier hs-var">updateCfgNat</span></a><span> </span><span class="hs-special">(</span><a href="CFG.html#addWeightEdge"><span class="hs-identifier hs-var">addWeightEdge</span></a><span> </span><a href="#local-6989586621684659714"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621684659714"><span class="hs-identifier hs-var">lbl</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-2189"></a><span>
</span><a name="line-2190"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toOL</span><span>
</span><a name="line-2191"></a><span>                </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659711"><span class="hs-identifier hs-var">amode</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span>
</span><a name="line-2192"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="X86.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684659714"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2193"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#NEWBLOCK"><span class="hs-identifier hs-var">NEWBLOCK</span></a><span> </span><a href="#local-6989586621684659714"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2194"></a><span>                  </span><span class="hs-comment">-- Keep old value so we can return it:</span><span>
</span><a name="line-2195"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659709"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2196"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659715"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span>
</span><a name="line-2197"></a><span>                </span><span class="hs-special">]</span><span>
</span><a name="line-2198"></a><span>                </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659713"><span class="hs-identifier hs-var">instrs</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659710"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659715"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span>
</span><a name="line-2199"></a><span>                </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#LOCK"><span class="hs-identifier hs-var">LOCK</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#CMPXCHG"><span class="hs-identifier hs-var">CMPXCHG</span></a><span> </span><a href="#local-6989586621684659708"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659715"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659711"><span class="hs-identifier hs-var">amode</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2200"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span> </span><a href="#local-6989586621684659714"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2201"></a><span>                </span><span class="hs-special">]</span><span>
</span><a name="line-2202"></a><span>
</span><a name="line-2203"></a><span>    </span><a name="local-6989586621684659708"><a href="#local-6989586621684659708"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659701"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2204"></a><span>
</span><a name="line-2205"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659732"><a href="#local-6989586621684659732"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AtomicRead"><span class="hs-identifier hs-var">MO_AtomicRead</span></a><span> </span><a name="local-6989586621684659733"><a href="#local-6989586621684659733"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659734"><a href="#local-6989586621684659734"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659735"><a href="#local-6989586621684659735"><span class="hs-identifier">addr</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2206"></a><span>  </span><a name="local-6989586621684659736"><a href="#local-6989586621684659736"><span class="hs-identifier">load_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#intLoadCode"><span class="hs-identifier hs-var">intLoadCode</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659733"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659735"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-2207"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659737"><a href="#local-6989586621684659737"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659732"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2208"></a><span>  </span><a name="local-6989586621684659738"><a href="#local-6989586621684659738"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-2209"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659736"><span class="hs-identifier hs-var">load_code</span></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659737"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659738"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659734"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2210"></a><span>
</span><a name="line-2211"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AtomicWrite"><span class="hs-identifier hs-var">MO_AtomicWrite</span></a><span> </span><a name="local-6989586621684659739"><a href="#local-6989586621684659739"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659740"><a href="#local-6989586621684659740"><span class="hs-identifier">addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659741"><a href="#local-6989586621684659741"><span class="hs-identifier">val</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2212"></a><span>    </span><a name="local-6989586621684659742"><a href="#local-6989586621684659742"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#assignMem_IntCode"><span class="hs-identifier hs-var">assignMem_IntCode</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659739"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659740"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621684659741"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-2213"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659742"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="X86.Instr.html#MFENCE"><span class="hs-identifier hs-var">MFENCE</span></a><span>
</span><a name="line-2214"></a><span>
</span><a name="line-2215"></a><span class="hs-identifier">genCCall</span><span> </span><a name="local-6989586621684659743"><a href="#local-6989586621684659743"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659744"><a href="#local-6989586621684659744"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Cmpxchg"><span class="hs-identifier hs-var">MO_Cmpxchg</span></a><span> </span><a name="local-6989586621684659745"><a href="#local-6989586621684659745"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659746"><a href="#local-6989586621684659746"><span class="hs-identifier">dst</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659747"><a href="#local-6989586621684659747"><span class="hs-identifier">addr</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659748"><a href="#local-6989586621684659748"><span class="hs-identifier">old</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659749"><a href="#local-6989586621684659749"><span class="hs-identifier">new</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2216"></a><span>    </span><span class="hs-comment">-- On x86 we don't have enough registers to use cmpxchg with a</span><span>
</span><a name="line-2217"></a><span>    </span><span class="hs-comment">-- complicated addressing mode, so on that architecture we</span><span>
</span><a name="line-2218"></a><span>    </span><span class="hs-comment">-- pre-compute the address first.</span><span>
</span><a name="line-2219"></a><span>    </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659751"><a href="#local-6989586621684659751"><span class="hs-identifier">amode</span></a></a><span> </span><a name="local-6989586621684659752"><a href="#local-6989586621684659752"><span class="hs-identifier">addr_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSimpleAmode"><span class="hs-identifier hs-var">getSimpleAmode</span></a><span> </span><a href="#local-6989586621684659743"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659744"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684659747"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-2220"></a><span>    </span><a name="local-6989586621684659753"><a href="#local-6989586621684659753"><span class="hs-identifier">newval</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659750"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2221"></a><span>    </span><a name="local-6989586621684659754"><a href="#local-6989586621684659754"><span class="hs-identifier">newval_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659749"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-2222"></a><span>    </span><a name="local-6989586621684659755"><a href="#local-6989586621684659755"><span class="hs-identifier">oldval</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659750"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2223"></a><span>    </span><a name="local-6989586621684659756"><a href="#local-6989586621684659756"><span class="hs-identifier">oldval_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659748"><span class="hs-identifier hs-var">old</span></a><span>
</span><a name="line-2224"></a><span>    </span><a name="local-6989586621684659757"><a href="#local-6989586621684659757"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-2225"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659758"><a href="#local-6989586621684659758"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659743"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2226"></a><span>        </span><a name="local-6989586621684659759"><a href="#local-6989586621684659759"><span class="hs-identifier">dst_r</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659758"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659757"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659746"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2227"></a><span>        </span><a name="local-6989586621684659760"><a href="#local-6989586621684659760"><span class="hs-identifier">code</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span>
</span><a name="line-2228"></a><span>                   </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659750"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659755"><span class="hs-identifier hs-var">oldval</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span>
</span><a name="line-2229"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#LOCK"><span class="hs-identifier hs-var">LOCK</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#CMPXCHG"><span class="hs-identifier hs-var">CMPXCHG</span></a><span> </span><a href="#local-6989586621684659750"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659753"><span class="hs-identifier hs-var">newval</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659751"><span class="hs-identifier hs-var">amode</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2230"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659750"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659759"><span class="hs-identifier hs-var">dst_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2231"></a><span>                   </span><span class="hs-special">]</span><span>
</span><a name="line-2232"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659752"><span class="hs-identifier hs-var">addr_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659754"><span class="hs-identifier hs-var">newval_code</span></a><span> </span><a href="#local-6989586621684659753"><span class="hs-identifier hs-var">newval</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659756"><span class="hs-identifier hs-var">oldval_code</span></a><span> </span><a href="#local-6989586621684659755"><span class="hs-identifier hs-var">oldval</span></a><span>
</span><a name="line-2233"></a><span>        </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659760"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-2234"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2235"></a><span>    </span><a name="local-6989586621684659750"><a href="#local-6989586621684659750"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659745"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2236"></a><span>
</span><a name="line-2237"></a><span class="hs-identifier">genCCall</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659761"><a href="#local-6989586621684659761"><span class="hs-identifier">is32Bit</span></a></a><span> </span><a name="local-6989586621684659762"><a href="#local-6989586621684659762"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684659763"><a href="#local-6989586621684659763"><span class="hs-identifier">dest_regs</span></a></a><span> </span><a name="local-6989586621684659764"><a href="#local-6989586621684659764"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621684659765"><a href="#local-6989586621684659765"><span class="hs-identifier">bid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2238"></a><span>  </span><a name="local-6989586621684659828"><a href="#local-6989586621684659828"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2239"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659829"><a href="#local-6989586621684659829"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659828"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2240"></a><span>      </span><a name="local-6989586621684659830"><a href="#local-6989586621684659830"><span class="hs-identifier">sse2</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isSse2Enabled</span><span> </span><a href="#local-6989586621684659828"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2241"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659762"><span class="hs-identifier hs-var">target</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-var">dest_regs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2242"></a><span>    </span><span class="hs-comment">-- void return type prim op</span><span>
</span><a name="line-2243"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a name="local-6989586621684659831"><a href="#local-6989586621684659831"><span class="hs-identifier">op</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2244"></a><span>        </span><a href="X86.CodeGen.html#outOfLineCmmOp"><span class="hs-identifier hs-var">outOfLineCmmOp</span></a><span> </span><a href="#local-6989586621684659765"><span class="hs-identifier hs-var">bid</span></a><span> </span><a href="#local-6989586621684659831"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2245"></a><span>    </span><span class="hs-comment">-- we only cope with a single result for foreign calls</span><span>
</span><a name="line-2246"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><a name="local-6989586621684659832"><a href="#local-6989586621684659832"><span class="hs-identifier">op</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659833"><a href="#local-6989586621684659833"><span class="hs-identifier">r</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2247"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659830"><span class="hs-identifier hs-var">sse2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659832"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2248"></a><span>          </span><a href="CmmMachOp.html#MO_F32_Fabs"><span class="hs-identifier hs-var">MO_F32_Fabs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2249"></a><span>            </span><span class="hs-special">[</span><a name="local-6989586621684659855"><a href="#local-6989586621684659855"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659837"><span class="hs-identifier hs-var">sse2FabsCode</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><a href="#local-6989586621684659855"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2250"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments for fabs&quot;</span><span>
</span><a name="line-2251"></a><span>          </span><a href="CmmMachOp.html#MO_F64_Fabs"><span class="hs-identifier hs-var">MO_F64_Fabs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2252"></a><span>            </span><span class="hs-special">[</span><a name="local-6989586621684659856"><a href="#local-6989586621684659856"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659837"><span class="hs-identifier hs-var">sse2FabsCode</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><a href="#local-6989586621684659856"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2253"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments for fabs&quot;</span><span>
</span><a name="line-2254"></a><span>
</span><a name="line-2255"></a><span>          </span><a href="CmmMachOp.html#MO_F32_Sqrt"><span class="hs-identifier hs-var">MO_F32_Sqrt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659835"><span class="hs-identifier hs-var">actuallyInlineSSE2Op</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659857"><a href="#local-6989586621684659857"><span class="hs-identifier">fmt</span></a></a><span> </span><a name="local-6989586621684659858"><a href="#local-6989586621684659858"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#SQRT"><span class="hs-identifier hs-var">SQRT</span></a><span> </span><a href="#local-6989586621684659857"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659858"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2256"></a><span>          </span><a href="CmmMachOp.html#MO_F64_Sqrt"><span class="hs-identifier hs-var">MO_F64_Sqrt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659835"><span class="hs-identifier hs-var">actuallyInlineSSE2Op</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659859"><a href="#local-6989586621684659859"><span class="hs-identifier">fmt</span></a></a><span> </span><a name="local-6989586621684659860"><a href="#local-6989586621684659860"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#SQRT"><span class="hs-identifier hs-var">SQRT</span></a><span> </span><a href="#local-6989586621684659859"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659860"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2257"></a><span>          </span><a name="local-6989586621684659861"><a href="#local-6989586621684659861"><span class="hs-identifier">_other_op</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#outOfLineCmmOp"><span class="hs-identifier hs-var">outOfLineCmmOp</span></a><span> </span><a href="#local-6989586621684659765"><span class="hs-identifier hs-var">bid</span></a><span> </span><a href="#local-6989586621684659832"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684659833"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2258"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2259"></a><span>        </span><a name="local-6989586621684659862"><a href="#local-6989586621684659862"><span class="hs-identifier">l1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-2260"></a><span>        </span><a name="local-6989586621684659863"><a href="#local-6989586621684659863"><span class="hs-identifier">l2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-2261"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659830"><span class="hs-identifier hs-var">sse2</span></a><span>
</span><a name="line-2262"></a><span>          </span><span class="hs-keyword">then</span><span> </span><a href="X86.CodeGen.html#outOfLineCmmOp"><span class="hs-identifier hs-var">outOfLineCmmOp</span></a><span> </span><a href="#local-6989586621684659765"><span class="hs-identifier hs-var">bid</span></a><span> </span><a href="#local-6989586621684659832"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684659833"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2263"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659832"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2264"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Sqrt"><span class="hs-identifier hs-var">MO_F32_Sqrt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659834"><span class="hs-identifier hs-var">actuallyInlineFloatOp</span></a><span> </span><a href="X86.Instr.html#GSQRT"><span class="hs-identifier hs-var">GSQRT</span></a><span> </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2265"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Sqrt"><span class="hs-identifier hs-var">MO_F64_Sqrt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659834"><span class="hs-identifier hs-var">actuallyInlineFloatOp</span></a><span> </span><a href="X86.Instr.html#GSQRT"><span class="hs-identifier hs-var">GSQRT</span></a><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2266"></a><span>
</span><a name="line-2267"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Sin"><span class="hs-identifier hs-var">MO_F32_Sin</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659834"><span class="hs-identifier hs-var">actuallyInlineFloatOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659864"><a href="#local-6989586621684659864"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#GSIN"><span class="hs-identifier hs-var">GSIN</span></a><span> </span><a href="#local-6989586621684659864"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621684659862"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621684659863"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span> </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2268"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Sin"><span class="hs-identifier hs-var">MO_F64_Sin</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659834"><span class="hs-identifier hs-var">actuallyInlineFloatOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659865"><a href="#local-6989586621684659865"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#GSIN"><span class="hs-identifier hs-var">GSIN</span></a><span> </span><a href="#local-6989586621684659865"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621684659862"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621684659863"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2269"></a><span>
</span><a name="line-2270"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Cos"><span class="hs-identifier hs-var">MO_F32_Cos</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659834"><span class="hs-identifier hs-var">actuallyInlineFloatOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659866"><a href="#local-6989586621684659866"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#GCOS"><span class="hs-identifier hs-var">GCOS</span></a><span> </span><a href="#local-6989586621684659866"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621684659862"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621684659863"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span> </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2271"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Cos"><span class="hs-identifier hs-var">MO_F64_Cos</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659834"><span class="hs-identifier hs-var">actuallyInlineFloatOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659867"><a href="#local-6989586621684659867"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#GCOS"><span class="hs-identifier hs-var">GCOS</span></a><span> </span><a href="#local-6989586621684659867"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621684659862"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621684659863"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2272"></a><span>
</span><a name="line-2273"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Tan"><span class="hs-identifier hs-var">MO_F32_Tan</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659834"><span class="hs-identifier hs-var">actuallyInlineFloatOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659868"><a href="#local-6989586621684659868"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#GTAN"><span class="hs-identifier hs-var">GTAN</span></a><span> </span><a href="#local-6989586621684659868"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621684659862"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621684659863"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span> </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2274"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Tan"><span class="hs-identifier hs-var">MO_F64_Tan</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659834"><span class="hs-identifier hs-var">actuallyInlineFloatOp</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659869"><a href="#local-6989586621684659869"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#GTAN"><span class="hs-identifier hs-var">GTAN</span></a><span> </span><a href="#local-6989586621684659869"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621684659862"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621684659863"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span> </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2275"></a><span>
</span><a name="line-2276"></a><span>              </span><a name="local-6989586621684659870"><a href="#local-6989586621684659870"><span class="hs-identifier">_other_op</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#outOfLineCmmOp"><span class="hs-identifier hs-var">outOfLineCmmOp</span></a><span> </span><a href="#local-6989586621684659765"><span class="hs-identifier hs-var">bid</span></a><span> </span><a href="#local-6989586621684659832"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684659833"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2277"></a><span>
</span><a name="line-2278"></a><span>       </span><span class="hs-keyword">where</span><span>
</span><a name="line-2279"></a><span>        </span><a name="local-6989586621684659834"><a href="#local-6989586621684659834"><span class="hs-identifier">actuallyInlineFloatOp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659836"><span class="hs-identifier hs-var">actuallyInlineFloatOp'</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-2280"></a><span>        </span><a name="local-6989586621684659835"><a href="#local-6989586621684659835"><span class="hs-identifier">actuallyInlineSSE2Op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659836"><span class="hs-identifier hs-var">actuallyInlineFloatOp'</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-2281"></a><span>
</span><a name="line-2282"></a><span>        </span><a name="local-6989586621684659836"><a href="#local-6989586621684659836"><span class="hs-identifier">actuallyInlineFloatOp'</span></a></a><span> </span><a name="local-6989586621684659838"><a href="#local-6989586621684659838"><span class="hs-identifier">usesSSE</span></a></a><span> </span><a name="local-6989586621684659839"><a href="#local-6989586621684659839"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684659840"><a href="#local-6989586621684659840"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659841"><a href="#local-6989586621684659841"><span class="hs-identifier">x</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-2283"></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659842"><a href="#local-6989586621684659842"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#trivialUFCode"><span class="hs-identifier hs-var">trivialUFCode</span></a><span> </span><a href="#local-6989586621684659840"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659839"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684659840"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659841"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2284"></a><span>                   </span><a name="local-6989586621684659843"><a href="#local-6989586621684659843"><span class="hs-identifier">any</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#anyReg"><span class="hs-identifier hs-var">anyReg</span></a><span> </span><a href="#local-6989586621684659842"><span class="hs-identifier hs-var">res</span></a><span>
</span><a name="line-2285"></a><span>                   </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659843"><span class="hs-identifier hs-var">any</span></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659838"><span class="hs-identifier hs-var">usesSSE</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659833"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2286"></a><span>
</span><a name="line-2287"></a><span>        </span><span class="hs-identifier">actuallyInlineFloatOp'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684659844"><a href="#local-6989586621684659844"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-2288"></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genCCall.actuallyInlineFloatOp': bad number of arguments! (&quot;</span><span>
</span><a name="line-2289"></a><span>                      </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684659844"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-2290"></a><span>
</span><a name="line-2291"></a><span>        </span><span class="hs-identifier">sse2FabsCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-2292"></a><span>        </span><a name="local-6989586621684659837"><a href="#local-6989586621684659837"><span class="hs-identifier">sse2FabsCode</span></a></a><span> </span><a name="local-6989586621684659845"><a href="#local-6989586621684659845"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621684659846"><a href="#local-6989586621684659846"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2293"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659847"><a href="#local-6989586621684659847"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684659845"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-2294"></a><span>          </span><a name="local-6989586621684659848"><a href="#local-6989586621684659848"><span class="hs-identifier">x_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659846"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2295"></a><span>          </span><span class="hs-keyword">let</span><span>
</span><a name="line-2296"></a><span>            </span><a name="local-6989586621684659849"><a href="#local-6989586621684659849"><span class="hs-identifier">const</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659847"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0x7fffffff</span><span> </span><span class="hs-identifier hs-var">W32</span><span>
</span><a name="line-2297"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0x7fffffffffffffff</span><span> </span><span class="hs-identifier hs-var">W64</span><span>
</span><a name="line-2298"></a><span>          </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684659850"><a href="#local-6989586621684659850"><span class="hs-identifier">amode</span></a></a><span> </span><a name="local-6989586621684659851"><a href="#local-6989586621684659851"><span class="hs-identifier">amode_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#memConstant"><span class="hs-identifier hs-var">memConstant</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><a href="#local-6989586621684659845"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659849"><span class="hs-identifier hs-var">const</span></a><span>
</span><a name="line-2299"></a><span>          </span><a name="local-6989586621684659852"><a href="#local-6989586621684659852"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659847"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-2300"></a><span>          </span><span class="hs-keyword">let</span><span>
</span><a name="line-2301"></a><span>            </span><a name="local-6989586621684659853"><a href="#local-6989586621684659853"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659854"><a href="#local-6989586621684659854"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659848"><span class="hs-identifier hs-var">x_code</span></a><span> </span><a href="#local-6989586621684659854"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659851"><span class="hs-identifier hs-var">amode_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2302"></a><span>                </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659847"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659850"><span class="hs-identifier hs-var">amode</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659852"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2303"></a><span>                </span><a href="X86.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a><span> </span><a href="#local-6989586621684659847"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659852"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659854"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-2304"></a><span>                </span><span class="hs-special">]</span><span>
</span><a name="line-2305"></a><span>
</span><a name="line-2306"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659853"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659833"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2307"></a><span>
</span><a name="line-2308"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_S_QuotRem"><span class="hs-identifier hs-var">MO_S_QuotRem</span></a><span>  </span><a name="local-6989586621684659871"><a href="#local-6989586621684659871"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659766"><span class="hs-identifier hs-var">divOp1</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>  </span><a href="#local-6989586621684659871"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2309"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_QuotRem"><span class="hs-identifier hs-var">MO_U_QuotRem</span></a><span>  </span><a name="local-6989586621684659872"><a href="#local-6989586621684659872"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659766"><span class="hs-identifier hs-var">divOp1</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659872"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2310"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_QuotRem2"><span class="hs-identifier hs-var">MO_U_QuotRem2</span></a><span> </span><a name="local-6989586621684659873"><a href="#local-6989586621684659873"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659767"><span class="hs-identifier hs-var">divOp2</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659873"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2311"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Add2"><span class="hs-identifier hs-var">MO_Add2</span></a><span> </span><a name="local-6989586621684659874"><a href="#local-6989586621684659874"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659875"><a href="#local-6989586621684659875"><span class="hs-identifier">res_h</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659876"><a href="#local-6989586621684659876"><span class="hs-identifier">res_l</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2312"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2313"></a><span>        </span><span class="hs-special">[</span><a name="local-6989586621684659877"><a href="#local-6989586621684659877"><span class="hs-identifier">arg_x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659878"><a href="#local-6989586621684659878"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2314"></a><span>            </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684659879"><a href="#local-6989586621684659879"><span class="hs-identifier">hCode</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621684659874"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2315"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659880"><a href="#local-6989586621684659880"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659874"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2316"></a><span>               </span><a name="local-6989586621684659881"><a href="#local-6989586621684659881"><span class="hs-identifier">lCode</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#anyReg"><span class="hs-identifier hs-var">anyReg</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="X86.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684659874"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#ADD_CC"><span class="hs-identifier hs-var">ADD_CC</span></a><span> </span><a href="#local-6989586621684659880"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span>
</span><a name="line-2317"></a><span>                                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#ADD_CC"><span class="hs-identifier hs-var">ADD_CC</span></a><span> </span><a href="#local-6989586621684659880"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659877"><span class="hs-identifier hs-var">arg_x</span></a><span> </span><a href="#local-6989586621684659878"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-2318"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659882"><a href="#local-6989586621684659882"><span class="hs-identifier">reg_l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659876"><span class="hs-identifier hs-var">res_l</span></a><span class="hs-special">)</span><span>
</span><a name="line-2319"></a><span>                   </span><a name="local-6989586621684659883"><a href="#local-6989586621684659883"><span class="hs-identifier">reg_h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659875"><span class="hs-identifier hs-var">res_h</span></a><span class="hs-special">)</span><span>
</span><a name="line-2320"></a><span>                   </span><a name="local-6989586621684659884"><a href="#local-6989586621684659884"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659879"><span class="hs-identifier hs-var">hCode</span></a><span> </span><a href="#local-6989586621684659883"><span class="hs-identifier hs-var">reg_h</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2321"></a><span>                          </span><a href="#local-6989586621684659881"><span class="hs-identifier hs-var">lCode</span></a><span> </span><a href="#local-6989586621684659882"><span class="hs-identifier hs-var">reg_l</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-2322"></a><span>                          </span><a href="X86.Instr.html#ADC"><span class="hs-identifier hs-var">ADC</span></a><span> </span><a href="#local-6989586621684659880"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInteger"><span class="hs-identifier hs-var">ImmInteger</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659883"><span class="hs-identifier hs-var">reg_h</span></a><span class="hs-special">)</span><span>
</span><a name="line-2323"></a><span>               </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684659884"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-2324"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments/results for add2&quot;</span><span>
</span><a name="line-2325"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AddWordC"><span class="hs-identifier hs-var">MO_AddWordC</span></a><span> </span><a name="local-6989586621684659885"><a href="#local-6989586621684659885"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659886"><a href="#local-6989586621684659886"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659887"><a href="#local-6989586621684659887"><span class="hs-identifier">res_c</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2326"></a><span>        </span><a href="#local-6989586621684659769"><span class="hs-identifier hs-var">addSubIntC</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="X86.Instr.html#ADD_CC"><span class="hs-identifier hs-var">ADD_CC</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><a href="X86.Cond.html#CARRY"><span class="hs-identifier hs-var">CARRY</span></a><span> </span><a href="#local-6989586621684659885"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684659886"><span class="hs-identifier hs-var">res_r</span></a><span> </span><a href="#local-6989586621684659887"><span class="hs-identifier hs-var">res_c</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2327"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SubWordC"><span class="hs-identifier hs-var">MO_SubWordC</span></a><span> </span><a name="local-6989586621684659888"><a href="#local-6989586621684659888"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659889"><a href="#local-6989586621684659889"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659890"><a href="#local-6989586621684659890"><span class="hs-identifier">res_c</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2328"></a><span>        </span><a href="#local-6989586621684659769"><span class="hs-identifier hs-var">addSubIntC</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="X86.Instr.html#SUB_CC"><span class="hs-identifier hs-var">SUB_CC</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><a href="X86.Cond.html#CARRY"><span class="hs-identifier hs-var">CARRY</span></a><span> </span><a href="#local-6989586621684659888"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684659889"><span class="hs-identifier hs-var">res_r</span></a><span> </span><a href="#local-6989586621684659890"><span class="hs-identifier hs-var">res_c</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2329"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_AddIntC"><span class="hs-identifier hs-var">MO_AddIntC</span></a><span> </span><a name="local-6989586621684659891"><a href="#local-6989586621684659891"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659892"><a href="#local-6989586621684659892"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659893"><a href="#local-6989586621684659893"><span class="hs-identifier">res_c</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2330"></a><span>        </span><a href="#local-6989586621684659769"><span class="hs-identifier hs-var">addSubIntC</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="X86.Instr.html#ADD_CC"><span class="hs-identifier hs-var">ADD_CC</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="X86.Instr.html#ADD_CC"><span class="hs-identifier hs-var">ADD_CC</span></a><span class="hs-special">)</span><span> </span><a href="X86.Cond.html#OFLO"><span class="hs-identifier hs-var">OFLO</span></a><span> </span><a href="#local-6989586621684659891"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684659892"><span class="hs-identifier hs-var">res_r</span></a><span> </span><a href="#local-6989586621684659893"><span class="hs-identifier hs-var">res_c</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2331"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_SubIntC"><span class="hs-identifier hs-var">MO_SubIntC</span></a><span> </span><a name="local-6989586621684659894"><a href="#local-6989586621684659894"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659895"><a href="#local-6989586621684659895"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659896"><a href="#local-6989586621684659896"><span class="hs-identifier">res_c</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2332"></a><span>        </span><a href="#local-6989586621684659769"><span class="hs-identifier hs-var">addSubIntC</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="X86.Instr.html#SUB_CC"><span class="hs-identifier hs-var">SUB_CC</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><a href="X86.Cond.html#OFLO"><span class="hs-identifier hs-var">OFLO</span></a><span> </span><a href="#local-6989586621684659894"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684659895"><span class="hs-identifier hs-var">res_r</span></a><span> </span><a href="#local-6989586621684659896"><span class="hs-identifier hs-var">res_c</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2333"></a><span>    </span><span class="hs-special">(</span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_U_Mul2"><span class="hs-identifier hs-var">MO_U_Mul2</span></a><span> </span><a name="local-6989586621684659897"><a href="#local-6989586621684659897"><span class="hs-identifier">width</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659898"><a href="#local-6989586621684659898"><span class="hs-identifier">res_h</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659899"><a href="#local-6989586621684659899"><span class="hs-identifier">res_l</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2334"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2335"></a><span>        </span><span class="hs-special">[</span><a name="local-6989586621684659900"><a href="#local-6989586621684659900"><span class="hs-identifier">arg_x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659901"><a href="#local-6989586621684659901"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2336"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659902"><a href="#local-6989586621684659902"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659903"><a href="#local-6989586621684659903"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getRegOrMem"><span class="hs-identifier hs-var">getRegOrMem</span></a><span> </span><a href="#local-6989586621684659901"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-2337"></a><span>               </span><a name="local-6989586621684659904"><a href="#local-6989586621684659904"><span class="hs-identifier">x_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659900"><span class="hs-identifier hs-var">arg_x</span></a><span>
</span><a name="line-2338"></a><span>               </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659905"><a href="#local-6989586621684659905"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659897"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2339"></a><span>                   </span><a name="local-6989586621684659906"><a href="#local-6989586621684659906"><span class="hs-identifier">reg_h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659898"><span class="hs-identifier hs-var">res_h</span></a><span class="hs-special">)</span><span>
</span><a name="line-2340"></a><span>                   </span><a name="local-6989586621684659907"><a href="#local-6989586621684659907"><span class="hs-identifier">reg_l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659829"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659899"><span class="hs-identifier hs-var">res_l</span></a><span class="hs-special">)</span><span>
</span><a name="line-2341"></a><span>                   </span><a name="local-6989586621684659908"><a href="#local-6989586621684659908"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659903"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2342"></a><span>                          </span><a href="#local-6989586621684659904"><span class="hs-identifier hs-var">x_code</span></a><span> </span><a href="X86.Regs.html#rax"><span class="hs-identifier hs-var">rax</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2343"></a><span>                          </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="X86.Instr.html#MUL2"><span class="hs-identifier hs-var">MUL2</span></a><span> </span><a href="#local-6989586621684659905"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659902"><span class="hs-identifier hs-var">y_reg</span></a><span class="hs-special">,</span><span>
</span><a name="line-2344"></a><span>                                </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659905"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659906"><span class="hs-identifier hs-var">reg_h</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2345"></a><span>                                </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659905"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#rax"><span class="hs-identifier hs-var">rax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659907"><span class="hs-identifier hs-var">reg_l</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2346"></a><span>               </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684659908"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-2347"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments/results for mul2&quot;</span><span>
</span><a name="line-2348"></a><span>
</span><a name="line-2349"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659761"><span class="hs-identifier hs-var">is32Bit</span></a><span>
</span><a name="line-2350"></a><span>         </span><span class="hs-keyword">then</span><span> </span><a href="X86.CodeGen.html#genCCall32%27"><span class="hs-identifier hs-var">genCCall32'</span></a><span> </span><a href="#local-6989586621684659828"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659762"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2351"></a><span>         </span><span class="hs-keyword">else</span><span> </span><a href="X86.CodeGen.html#genCCall64%27"><span class="hs-identifier hs-var">genCCall64'</span></a><span> </span><a href="#local-6989586621684659828"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659762"><span class="hs-identifier hs-var">target</span></a><span> </span><a href="#local-6989586621684659763"><span class="hs-identifier hs-var">dest_regs</span></a><span> </span><a href="#local-6989586621684659764"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2352"></a><span>
</span><a name="line-2353"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684659766"><a href="#local-6989586621684659766"><span class="hs-identifier">divOp1</span></a></a><span> </span><a name="local-6989586621684659770"><a href="#local-6989586621684659770"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684659771"><a href="#local-6989586621684659771"><span class="hs-identifier">signed</span></a></a><span> </span><a name="local-6989586621684659772"><a href="#local-6989586621684659772"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684659773"><a href="#local-6989586621684659773"><span class="hs-identifier">results</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659774"><a href="#local-6989586621684659774"><span class="hs-identifier">arg_x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659775"><a href="#local-6989586621684659775"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-2354"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659768"><span class="hs-identifier hs-var">divOp</span></a><span> </span><a href="#local-6989586621684659770"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659771"><span class="hs-identifier hs-var">signed</span></a><span> </span><a href="#local-6989586621684659772"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684659773"><span class="hs-identifier hs-var">results</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621684659774"><span class="hs-identifier hs-var">arg_x</span></a><span> </span><a href="#local-6989586621684659775"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-2355"></a><span>        </span><span class="hs-identifier">divOp1</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-2356"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments for divOp1&quot;</span><span>
</span><a name="line-2357"></a><span>        </span><a name="local-6989586621684659767"><a href="#local-6989586621684659767"><span class="hs-identifier">divOp2</span></a></a><span> </span><a name="local-6989586621684659776"><a href="#local-6989586621684659776"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684659777"><a href="#local-6989586621684659777"><span class="hs-identifier">signed</span></a></a><span> </span><a name="local-6989586621684659778"><a href="#local-6989586621684659778"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684659779"><a href="#local-6989586621684659779"><span class="hs-identifier">results</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659780"><a href="#local-6989586621684659780"><span class="hs-identifier">arg_x_high</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659781"><a href="#local-6989586621684659781"><span class="hs-identifier">arg_x_low</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659782"><a href="#local-6989586621684659782"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-2358"></a><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659768"><span class="hs-identifier hs-var">divOp</span></a><span> </span><a href="#local-6989586621684659776"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659777"><span class="hs-identifier hs-var">signed</span></a><span> </span><a href="#local-6989586621684659778"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684659779"><span class="hs-identifier hs-var">results</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621684659780"><span class="hs-identifier hs-var">arg_x_high</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659781"><span class="hs-identifier hs-var">arg_x_low</span></a><span> </span><a href="#local-6989586621684659782"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-2359"></a><span>        </span><span class="hs-identifier">divOp2</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-2360"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments for divOp2&quot;</span><span>
</span><a name="line-2361"></a><span>
</span><a name="line-2362"></a><span>        </span><span class="hs-comment">-- See Note [DIV/IDIV for bytes]</span><span>
</span><a name="line-2363"></a><span>        </span><a name="local-6989586621684659768"><a href="#local-6989586621684659768"><span class="hs-identifier">divOp</span></a></a><span> </span><a name="local-6989586621684659783"><a href="#local-6989586621684659783"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684659784"><a href="#local-6989586621684659784"><span class="hs-identifier">signed</span></a></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659785"><a href="#local-6989586621684659785"><span class="hs-identifier">res_q</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659786"><a href="#local-6989586621684659786"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621684659787"><a href="#local-6989586621684659787"><span class="hs-identifier">m_arg_x_high</span></a></a><span> </span><a name="local-6989586621684659788"><a href="#local-6989586621684659788"><span class="hs-identifier">arg_x_low</span></a></a><span> </span><a name="local-6989586621684659789"><a href="#local-6989586621684659789"><span class="hs-identifier">arg_y</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2364"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659790"><a href="#local-6989586621684659790"><span class="hs-identifier">widen</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659784"><span class="hs-identifier hs-var">signed</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmMachOp.html#MO_SS_Conv"><span class="hs-identifier hs-var">MO_SS_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W16</span><span>
</span><a name="line-2365"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><span class="hs-identifier hs-var">W8</span><span> </span><span class="hs-identifier hs-var">W16</span><span>
</span><a name="line-2366"></a><span>                </span><a name="local-6989586621684659791"><a href="#local-6989586621684659791"><span class="hs-identifier">arg_x_low_16</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a href="#local-6989586621684659790"><span class="hs-identifier hs-var">widen</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659788"><span class="hs-identifier hs-var">arg_x_low</span></a><span class="hs-special">]</span><span>
</span><a name="line-2367"></a><span>                </span><a name="local-6989586621684659792"><a href="#local-6989586621684659792"><span class="hs-identifier">arg_y_16</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a href="#local-6989586621684659790"><span class="hs-identifier hs-var">widen</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659789"><span class="hs-identifier hs-var">arg_y</span></a><span class="hs-special">]</span><span>
</span><a name="line-2368"></a><span>                </span><a name="local-6989586621684659793"><a href="#local-6989586621684659793"><span class="hs-identifier">m_arg_x_high_16</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621684659794"><a href="#local-6989586621684659794"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a href="#local-6989586621684659790"><span class="hs-identifier hs-var">widen</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659794"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621684659787"><span class="hs-identifier hs-var">m_arg_x_high</span></a><span>
</span><a name="line-2369"></a><span>            </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621684659768"><span class="hs-identifier hs-var">divOp</span></a><span>
</span><a name="line-2370"></a><span>                  </span><a href="#local-6989586621684659783"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659784"><span class="hs-identifier hs-var">signed</span></a><span> </span><span class="hs-identifier hs-var">W16</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659785"><span class="hs-identifier hs-var">res_q</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659786"><span class="hs-identifier hs-var">res_r</span></a><span class="hs-special">]</span><span>
</span><a name="line-2371"></a><span>                  </span><a href="#local-6989586621684659793"><span class="hs-identifier hs-var">m_arg_x_high_16</span></a><span> </span><a href="#local-6989586621684659791"><span class="hs-identifier hs-var">arg_x_low_16</span></a><span> </span><a href="#local-6989586621684659792"><span class="hs-identifier hs-var">arg_y_16</span></a><span>
</span><a name="line-2372"></a><span>
</span><a name="line-2373"></a><span>        </span><span class="hs-identifier">divOp</span><span> </span><a name="local-6989586621684659795"><a href="#local-6989586621684659795"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684659796"><a href="#local-6989586621684659796"><span class="hs-identifier">signed</span></a></a><span> </span><a name="local-6989586621684659797"><a href="#local-6989586621684659797"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659798"><a href="#local-6989586621684659798"><span class="hs-identifier">res_q</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659799"><a href="#local-6989586621684659799"><span class="hs-identifier">res_r</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-2374"></a><span>              </span><a name="local-6989586621684659800"><a href="#local-6989586621684659800"><span class="hs-identifier">m_arg_x_high</span></a></a><span> </span><a name="local-6989586621684659801"><a href="#local-6989586621684659801"><span class="hs-identifier">arg_x_low</span></a></a><span> </span><a name="local-6989586621684659802"><a href="#local-6989586621684659802"><span class="hs-identifier">arg_y</span></a></a><span>
</span><a name="line-2375"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659803"><a href="#local-6989586621684659803"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659797"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2376"></a><span>                     </span><a name="local-6989586621684659804"><a href="#local-6989586621684659804"><span class="hs-identifier">reg_q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659795"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659798"><span class="hs-identifier hs-var">res_q</span></a><span class="hs-special">)</span><span>
</span><a name="line-2377"></a><span>                     </span><a name="local-6989586621684659805"><a href="#local-6989586621684659805"><span class="hs-identifier">reg_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659795"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659799"><span class="hs-identifier hs-var">res_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2378"></a><span>                     </span><a name="local-6989586621684659806"><a href="#local-6989586621684659806"><span class="hs-identifier">widen</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659796"><span class="hs-identifier hs-var">signed</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#CLTD"><span class="hs-identifier hs-var">CLTD</span></a><span> </span><a href="#local-6989586621684659803"><span class="hs-identifier hs-var">format</span></a><span>
</span><a name="line-2379"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span> </span><a href="#local-6989586621684659803"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span class="hs-special">)</span><span>
</span><a name="line-2380"></a><span>                     </span><a name="local-6989586621684659807"><a href="#local-6989586621684659807"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659796"><span class="hs-identifier hs-var">signed</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#IDIV"><span class="hs-identifier hs-var">IDIV</span></a><span>
</span><a name="line-2381"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#DIV"><span class="hs-identifier hs-var">DIV</span></a><span>
</span><a name="line-2382"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621684659808"><a href="#local-6989586621684659808"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659809"><a href="#local-6989586621684659809"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getRegOrMem"><span class="hs-identifier hs-var">getRegOrMem</span></a><span> </span><a href="#local-6989586621684659802"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-2383"></a><span>                 </span><a name="local-6989586621684659810"><a href="#local-6989586621684659810"><span class="hs-identifier">x_low_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659801"><span class="hs-identifier hs-var">arg_x_low</span></a><span>
</span><a name="line-2384"></a><span>                 </span><a name="local-6989586621684659812"><a href="#local-6989586621684659812"><span class="hs-identifier">x_high_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659800"><span class="hs-identifier hs-var">m_arg_x_high</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2385"></a><span>                                </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684659811"><a href="#local-6989586621684659811"><span class="hs-identifier">arg_x_high</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2386"></a><span>                                    </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659811"><span class="hs-identifier hs-var">arg_x_high</span></a><span>
</span><a name="line-2387"></a><span>                                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2388"></a><span>                                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><a href="#local-6989586621684659806"><span class="hs-identifier hs-var">widen</span></a><span>
</span><a name="line-2389"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659809"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2390"></a><span>                          </span><a href="#local-6989586621684659810"><span class="hs-identifier hs-var">x_low_code</span></a><span> </span><a href="X86.Regs.html#rax"><span class="hs-identifier hs-var">rax</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2391"></a><span>                          </span><a href="#local-6989586621684659812"><span class="hs-identifier hs-var">x_high_code</span></a><span> </span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2392"></a><span>                          </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684659807"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684659803"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659808"><span class="hs-identifier hs-var">y_reg</span></a><span class="hs-special">,</span><span>
</span><a name="line-2393"></a><span>                                </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659803"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#rax"><span class="hs-identifier hs-var">rax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659804"><span class="hs-identifier hs-var">reg_q</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2394"></a><span>                                </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659803"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#rdx"><span class="hs-identifier hs-var">rdx</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659805"><span class="hs-identifier hs-var">reg_r</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2395"></a><span>        </span><span class="hs-identifier">divOp</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-2396"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of results for divOp&quot;</span><span>
</span><a name="line-2397"></a><span>
</span><a name="line-2398"></a><span>        </span><a name="local-6989586621684659769"><a href="#local-6989586621684659769"><span class="hs-identifier">addSubIntC</span></a></a><span> </span><a name="local-6989586621684659813"><a href="#local-6989586621684659813"><span class="hs-identifier">platform</span></a></a><span> </span><a name="local-6989586621684659814"><a href="#local-6989586621684659814"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684659815"><a href="#local-6989586621684659815"><span class="hs-identifier">mrevinstr</span></a></a><span> </span><a name="local-6989586621684659816"><a href="#local-6989586621684659816"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684659817"><a href="#local-6989586621684659817"><span class="hs-identifier">width</span></a></a><span>
</span><a name="line-2399"></a><span>                   </span><a name="local-6989586621684659818"><a href="#local-6989586621684659818"><span class="hs-identifier">res_r</span></a></a><span> </span><a name="local-6989586621684659819"><a href="#local-6989586621684659819"><span class="hs-identifier">res_c</span></a></a><span> </span><span class="hs-special">[</span><a name="local-6989586621684659820"><a href="#local-6989586621684659820"><span class="hs-identifier">arg_x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659821"><a href="#local-6989586621684659821"><span class="hs-identifier">arg_y</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-2400"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659822"><a href="#local-6989586621684659822"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659817"><span class="hs-identifier hs-var">width</span></a><span>
</span><a name="line-2401"></a><span>                 </span><a name="local-6989586621684659823"><a href="#local-6989586621684659823"><span class="hs-identifier">rCode</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#anyReg"><span class="hs-identifier hs-var">anyReg</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="X86.CodeGen.html#trivialCode"><span class="hs-identifier hs-var">trivialCode</span></a><span> </span><a href="#local-6989586621684659817"><span class="hs-identifier hs-var">width</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659814"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684659822"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span>
</span><a name="line-2402"></a><span>                                       </span><span class="hs-special">(</span><a href="#local-6989586621684659815"><span class="hs-identifier hs-var">mrevinstr</span></a><span> </span><a href="#local-6989586621684659822"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659820"><span class="hs-identifier hs-var">arg_x</span></a><span> </span><a href="#local-6989586621684659821"><span class="hs-identifier hs-var">arg_y</span></a><span>
</span><a name="line-2403"></a><span>                 </span><a name="local-6989586621684659824"><a href="#local-6989586621684659824"><span class="hs-identifier">reg_tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>
</span><a name="line-2404"></a><span>                 </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659825"><a href="#local-6989586621684659825"><span class="hs-identifier">reg_c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659813"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659819"><span class="hs-identifier hs-var">res_c</span></a><span class="hs-special">)</span><span>
</span><a name="line-2405"></a><span>                     </span><a name="local-6989586621684659826"><a href="#local-6989586621684659826"><span class="hs-identifier">reg_r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659813"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659818"><span class="hs-identifier hs-var">res_r</span></a><span class="hs-special">)</span><span>
</span><a name="line-2406"></a><span>                     </span><a name="local-6989586621684659827"><a href="#local-6989586621684659827"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659823"><span class="hs-identifier hs-var">rCode</span></a><span> </span><a href="#local-6989586621684659826"><span class="hs-identifier hs-var">reg_r</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-2407"></a><span>                            </span><a href="X86.Instr.html#SETCC"><span class="hs-identifier hs-var">SETCC</span></a><span> </span><a href="#local-6989586621684659816"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659824"><span class="hs-identifier hs-var">reg_tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-2408"></a><span>                            </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659824"><span class="hs-identifier hs-var">reg_tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659825"><span class="hs-identifier hs-var">reg_c</span></a><span class="hs-special">)</span><span>
</span><a name="line-2409"></a><span>
</span><a name="line-2410"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684659827"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-2411"></a><span>        </span><span class="hs-identifier">addSubIntC</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-2412"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall: Wrong number of arguments/results for addSubIntC&quot;</span><span>
</span><a name="line-2413"></a><span>
</span><a name="line-2414"></a><span class="hs-comment">-- Note [DIV/IDIV for bytes]</span><span>
</span><a name="line-2415"></a><span class="hs-comment">--</span><span>
</span><a name="line-2416"></a><span class="hs-comment">-- IDIV reminder:</span><span>
</span><a name="line-2417"></a><span class="hs-comment">--   Size    Dividend   Divisor   Quotient    Remainder</span><span>
</span><a name="line-2418"></a><span class="hs-comment">--   byte    %ax         r/m8      %al          %ah</span><span>
</span><a name="line-2419"></a><span class="hs-comment">--   word    %dx:%ax     r/m16     %ax          %dx</span><span>
</span><a name="line-2420"></a><span class="hs-comment">--   dword   %edx:%eax   r/m32     %eax         %edx</span><span>
</span><a name="line-2421"></a><span class="hs-comment">--   qword   %rdx:%rax   r/m64     %rax         %rdx</span><span>
</span><a name="line-2422"></a><span class="hs-comment">--</span><span>
</span><a name="line-2423"></a><span class="hs-comment">-- We do a special case for the byte division because the current</span><span>
</span><a name="line-2424"></a><span class="hs-comment">-- codegen doesn't deal well with accessing %ah register (also,</span><span>
</span><a name="line-2425"></a><span class="hs-comment">-- accessing %ah in 64-bit mode is complicated because it cannot be an</span><span>
</span><a name="line-2426"></a><span class="hs-comment">-- operand of many instructions). So we just widen operands to 16 bits</span><span>
</span><a name="line-2427"></a><span class="hs-comment">-- and get the results from %al, %dl. This is not optimal, but a few</span><span>
</span><a name="line-2428"></a><span class="hs-comment">-- register moves are probably not a huge deal when doing division.</span><span>
</span><a name="line-2429"></a><span>
</span><a name="line-2430"></a><span class="hs-identifier">genCCall32'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-2431"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span>            </span><span class="hs-comment">-- function to call</span><span>
</span><a name="line-2432"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- where to put the result</span><span>
</span><a name="line-2433"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- arguments (of mixed type)</span><span>
</span><a name="line-2434"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-2435"></a><a name="genCCall32%27"><a href="X86.CodeGen.html#genCCall32%27"><span class="hs-identifier">genCCall32'</span></a></a><span> </span><a name="local-6989586621684659909"><a href="#local-6989586621684659909"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659910"><a href="#local-6989586621684659910"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684659911"><a href="#local-6989586621684659911"><span class="hs-identifier">dest_regs</span></a></a><span> </span><a name="local-6989586621684659912"><a href="#local-6989586621684659912"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2436"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-2437"></a><span>            </span><a name="local-6989586621684659935"><a href="#local-6989586621684659935"><span class="hs-identifier">prom_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#maybePromoteCArg"><span class="hs-identifier hs-var">maybePromoteCArg</span></a><span> </span><a href="#local-6989586621684659909"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659912"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2438"></a><span>
</span><a name="line-2439"></a><span>            </span><span class="hs-comment">-- Align stack to 16n for calls, assuming a starting stack</span><span>
</span><a name="line-2440"></a><span>            </span><span class="hs-comment">-- alignment of 16n - word_size on procedure entry. Which we</span><span>
</span><a name="line-2441"></a><span>            </span><span class="hs-comment">-- maintiain. See Note [rts/StgCRun.c : Stack Alignment on X86]</span><span>
</span><a name="line-2442"></a><span>            </span><a name="local-6989586621684659936"><a href="#local-6989586621684659936"><span class="hs-identifier">sizes</span></a></a><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659913"><span class="hs-identifier hs-var">arg_size_bytes</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684659909"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621684659912"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-2443"></a><span>            </span><a name="local-6989586621684659937"><a href="#local-6989586621684659937"><span class="hs-identifier">raw_arg_size</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sum</span><span> </span><a href="#local-6989586621684659936"><span class="hs-identifier hs-var">sizes</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621684659909"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2444"></a><span>            </span><a name="local-6989586621684659938"><a href="#local-6989586621684659938"><span class="hs-identifier">arg_pad_size</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659914"><span class="hs-identifier hs-var">roundTo</span></a><span> </span><span class="hs-number">16</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684659937"><span class="hs-identifier hs-var">raw_arg_size</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684659937"><span class="hs-identifier hs-var">raw_arg_size</span></a><span>
</span><a name="line-2445"></a><span>            </span><a name="local-6989586621684659939"><a href="#local-6989586621684659939"><span class="hs-identifier">tot_arg_size</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659937"><span class="hs-identifier hs-var">raw_arg_size</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684659938"><span class="hs-identifier hs-var">arg_pad_size</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621684659909"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2446"></a><span>        </span><a name="local-6989586621684659940"><a href="#local-6989586621684659940"><span class="hs-identifier">delta0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span>
</span><a name="line-2447"></a><span>        </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659940"><span class="hs-identifier hs-var">delta0</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684659938"><span class="hs-identifier hs-var">arg_pad_size</span></a><span class="hs-special">)</span><span>
</span><a name="line-2448"></a><span>
</span><a name="line-2449"></a><span>        </span><a name="local-6989586621684659941"><a href="#local-6989586621684659941"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-2450"></a><span>        </span><a name="local-6989586621684659942"><a href="#local-6989586621684659942"><span class="hs-identifier">push_codes</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659915"><span class="hs-identifier hs-var">push_arg</span></a><span> </span><a href="#local-6989586621684659941"><span class="hs-identifier hs-var">use_sse2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621684659935"><span class="hs-identifier hs-var">prom_args</span></a><span class="hs-special">)</span><span>
</span><a name="line-2451"></a><span>        </span><a name="local-6989586621684659943"><a href="#local-6989586621684659943"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span>
</span><a name="line-2452"></a><span>        </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span class="hs-identifier">delta</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">delta0</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier">tot_arg_size</span><span class="hs-special">)</span><span>
</span><a name="line-2453"></a><span>
</span><a name="line-2454"></a><span>        </span><span class="hs-comment">-- deal with static vs dynamic call targets</span><span>
</span><a name="line-2455"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684659951"><a href="#local-6989586621684659951"><span class="hs-identifier">callinsns</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659952"><a href="#local-6989586621684659952"><span class="hs-identifier">cconv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-2456"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659910"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2457"></a><span>            </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621684659944"><a href="#local-6989586621684659944"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684659945"><a href="#local-6989586621684659945"><span class="hs-identifier">conv</span></a></a><span>
</span><a name="line-2458"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- ToDo: stdcall arg sizes</span><span>
</span><a name="line-2459"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#CALL"><span class="hs-identifier hs-var">CALL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621684659946"><span class="hs-identifier hs-var">fn_imm</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659945"><span class="hs-identifier hs-var">conv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2460"></a><span>               </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684659946"><a href="#local-6989586621684659946"><span class="hs-identifier">fn_imm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="#local-6989586621684659944"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2461"></a><span>            </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a name="local-6989586621684659947"><a href="#local-6989586621684659947"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621684659948"><a href="#local-6989586621684659948"><span class="hs-identifier">conv</span></a></a><span>
</span><a name="line-2462"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659949"><a href="#local-6989586621684659949"><span class="hs-identifier">dyn_r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659950"><a href="#local-6989586621684659950"><span class="hs-identifier">dyn_c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659947"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-2463"></a><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isWord32</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cmmExprType</span><span> </span><span class="hs-identifier">dflags</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">expr</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-2464"></a><span>                       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659950"><span class="hs-identifier hs-var">dyn_c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="X86.Instr.html#CALL"><span class="hs-identifier hs-var">CALL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621684659949"><span class="hs-identifier hs-var">dyn_r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659948"><span class="hs-identifier hs-var">conv</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-2465"></a><span>            </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-2466"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genCCall: Can't handle PrimTarget call type here, error &quot;</span><span>
</span><a name="line-2467"></a><span>                            </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;probably because too many return values.&quot;</span><span>
</span><a name="line-2468"></a><span>
</span><a name="line-2469"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659953"><a href="#local-6989586621684659953"><span class="hs-identifier">push_code</span></a></a><span>
</span><a name="line-2470"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659938"><span class="hs-identifier hs-var">arg_pad_size</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2471"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684659938"><span class="hs-identifier hs-var">arg_pad_size</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#esp"><span class="hs-identifier hs-var">esp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2472"></a><span>                        </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659940"><span class="hs-identifier hs-var">delta0</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684659938"><span class="hs-identifier hs-var">arg_pad_size</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2473"></a><span>                  </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">concatOL</span><span> </span><a href="#local-6989586621684659942"><span class="hs-identifier hs-var">push_codes</span></a><span>
</span><a name="line-2474"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2475"></a><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatOL</span><span> </span><a href="#local-6989586621684659942"><span class="hs-identifier hs-var">push_codes</span></a><span>
</span><a name="line-2476"></a><span>
</span><a name="line-2477"></a><span>              </span><span class="hs-comment">-- Deallocate parameters after call for ccall;</span><span>
</span><a name="line-2478"></a><span>              </span><span class="hs-comment">-- but not for stdcall (callee does it)</span><span>
</span><a name="line-2479"></a><span>              </span><span class="hs-comment">--</span><span>
</span><a name="line-2480"></a><span>              </span><span class="hs-comment">-- We have to pop any stack padding we added</span><span>
</span><a name="line-2481"></a><span>              </span><span class="hs-comment">-- even if we are doing stdcall, though (#5052)</span><span>
</span><a name="line-2482"></a><span>            </span><a name="local-6989586621684659954"><a href="#local-6989586621684659954"><span class="hs-identifier">pop_size</span></a></a><span>
</span><a name="line-2483"></a><span>               </span><span class="hs-glyph">|</span><span> </span><a href="CmmNode.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a><span> </span><span class="hs-identifier hs-var">StdCallConv</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659952"><span class="hs-identifier hs-var">cconv</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659938"><span class="hs-identifier hs-var">arg_pad_size</span></a><span>
</span><a name="line-2484"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659939"><span class="hs-identifier hs-var">tot_arg_size</span></a><span>
</span><a name="line-2485"></a><span>
</span><a name="line-2486"></a><span>            </span><a name="local-6989586621684659955"><a href="#local-6989586621684659955"><span class="hs-identifier">call</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659951"><span class="hs-identifier hs-var">callinsns</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2487"></a><span>                   </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-2488"></a><span>                      </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659954"><span class="hs-identifier hs-var">pop_size</span></a><span class="hs-operator hs-var">==</span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-2489"></a><span>                       </span><span class="hs-special">[</span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684659954"><span class="hs-identifier hs-var">pop_size</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#esp"><span class="hs-identifier hs-var">esp</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2490"></a><span>                      </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-2491"></a><span>                      </span><span class="hs-special">[</span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><a href="#local-6989586621684659940"><span class="hs-identifier hs-var">delta0</span></a><span class="hs-special">]</span><span>
</span><a name="line-2492"></a><span>                   </span><span class="hs-special">)</span><span>
</span><a name="line-2493"></a><span>        </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span> </span><a href="#local-6989586621684659940"><span class="hs-identifier hs-var">delta0</span></a><span>
</span><a name="line-2494"></a><span>
</span><a name="line-2495"></a><span>        </span><a name="local-6989586621684659956"><a href="#local-6989586621684659956"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2496"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659957"><a href="#local-6989586621684659957"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659956"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2497"></a><span>
</span><a name="line-2498"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-2499"></a><span>            </span><span class="hs-comment">-- assign the results, if necessary</span><span>
</span><a name="line-2500"></a><span>            </span><a name="local-6989586621684659958"><a href="#local-6989586621684659958"><span class="hs-identifier">assign_code</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2501"></a><span>            </span><span class="hs-identifier">assign_code</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684659959"><a href="#local-6989586621684659959"><span class="hs-identifier">dest</span></a></a><span class="hs-special">]</span><span>
</span><a name="line-2502"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684659960"><span class="hs-identifier hs-var">ty</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2503"></a><span>                 </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659941"><span class="hs-identifier hs-var">use_sse2</span></a><span>
</span><a name="line-2504"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659965"><a href="#local-6989586621684659965"><span class="hs-identifier">tmp_amode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="X86.Regs.html#esp"><span class="hs-identifier hs-var">esp</span></a><span class="hs-special">)</span><span>
</span><a name="line-2505"></a><span>                                                       </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span>
</span><a name="line-2506"></a><span>                                                       </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-2507"></a><span>                             </span><a name="local-6989586621684659966"><a href="#local-6989586621684659966"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684659961"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-2508"></a><span>                         </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span> </span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684659962"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#esp"><span class="hs-identifier hs-var">esp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2509"></a><span>                                   </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659940"><span class="hs-identifier hs-var">delta0</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684659962"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2510"></a><span>                                   </span><a href="X86.Instr.html#GST"><span class="hs-identifier hs-var">GST</span></a><span> </span><a href="#local-6989586621684659966"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="X86.Regs.html#fake0"><span class="hs-identifier hs-var">fake0</span></a><span> </span><a href="#local-6989586621684659965"><span class="hs-identifier hs-var">tmp_amode</span></a><span class="hs-special">,</span><span>
</span><a name="line-2511"></a><span>                                   </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659966"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659965"><span class="hs-identifier hs-var">tmp_amode</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659964"><span class="hs-identifier hs-var">r_dest</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2512"></a><span>                                   </span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684659962"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#esp"><span class="hs-identifier hs-var">esp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2513"></a><span>                                   </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><a href="#local-6989586621684659940"><span class="hs-identifier hs-var">delta0</span></a><span class="hs-special">]</span><span>
</span><a name="line-2514"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#GMOV"><span class="hs-identifier hs-var">GMOV</span></a><span> </span><a href="X86.Regs.html#fake0"><span class="hs-identifier hs-var">fake0</span></a><span> </span><a href="#local-6989586621684659964"><span class="hs-identifier hs-var">r_dest</span></a><span class="hs-special">)</span><span>
</span><a name="line-2515"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684659960"><span class="hs-identifier hs-var">ty</span></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659964"><span class="hs-identifier hs-var">r_dest</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2516"></a><span>                                        </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#edx"><span class="hs-identifier hs-var">edx</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659963"><span class="hs-identifier hs-var">r_dest_hi</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2517"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684659961"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-2518"></a><span>                                             </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span>
</span><a name="line-2519"></a><span>                                             </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659964"><span class="hs-identifier hs-var">r_dest</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2520"></a><span>              </span><span class="hs-keyword">where</span><span>
</span><a name="line-2521"></a><span>                    </span><a name="local-6989586621684659960"><a href="#local-6989586621684659960"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#localRegType"><span class="hs-identifier hs-var">localRegType</span></a><span> </span><a href="#local-6989586621684659959"><span class="hs-identifier hs-var">dest</span></a><span>
</span><a name="line-2522"></a><span>                    </span><a name="local-6989586621684659961"><a href="#local-6989586621684659961"><span class="hs-identifier">w</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684659960"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-2523"></a><span>                    </span><a name="local-6989586621684659962"><a href="#local-6989586621684659962"><span class="hs-identifier">b</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><a href="#local-6989586621684659961"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-2524"></a><span>                    </span><a name="local-6989586621684659963"><a href="#local-6989586621684659963"><span class="hs-identifier">r_dest_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684659964"><span class="hs-identifier hs-var">r_dest</span></a><span>
</span><a name="line-2525"></a><span>                    </span><a name="local-6989586621684659964"><a href="#local-6989586621684659964"><span class="hs-identifier">r_dest</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659957"><span class="hs-identifier hs-var">platform</span></a><span> </span><a href="#local-6989586621684659941"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684659959"><span class="hs-identifier hs-var">dest</span></a><span class="hs-special">)</span><span>
</span><a name="line-2526"></a><span>            </span><span class="hs-identifier">assign_code</span><span> </span><a name="local-6989586621684659967"><a href="#local-6989586621684659967"><span class="hs-identifier">many</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;genCCall.assign_code - too many return values:&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621684659967"><span class="hs-identifier hs-var">many</span></a><span class="hs-special">)</span><span>
</span><a name="line-2527"></a><span>
</span><a name="line-2528"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659953"><span class="hs-identifier hs-var">push_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2529"></a><span>                </span><a href="#local-6989586621684659955"><span class="hs-identifier hs-var">call</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2530"></a><span>                </span><a href="#local-6989586621684659958"><span class="hs-identifier hs-var">assign_code</span></a><span> </span><a href="#local-6989586621684659911"><span class="hs-identifier hs-var">dest_regs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2531"></a><span>
</span><a name="line-2532"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-2533"></a><span>        </span><span class="hs-comment">-- If the size is smaller than the word, we widen things (see maybePromoteCArg)</span><span>
</span><a name="line-2534"></a><span>        </span><span class="hs-identifier">arg_size_bytes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CmmType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-2535"></a><span>        </span><a name="local-6989586621684659913"><a href="#local-6989586621684659913"><span class="hs-identifier">arg_size_bytes</span></a></a><span> </span><a name="local-6989586621684659916"><a href="#local-6989586621684659916"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684659916"><span class="hs-identifier hs-var">ty</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684659909"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2536"></a><span>
</span><a name="line-2537"></a><span>        </span><a name="local-6989586621684659914"><a href="#local-6989586621684659914"><span class="hs-identifier">roundTo</span></a></a><span> </span><a name="local-6989586621684659917"><a href="#local-6989586621684659917"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621684659918"><a href="#local-6989586621684659918"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684659918"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659917"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659918"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-2538"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659918"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684659917"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659918"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684659917"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-2539"></a><span>
</span><a name="line-2540"></a><span>        </span><span class="hs-identifier">push_arg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span> </span><span class="hs-comment">{-current argument-}</span><span>
</span><a name="line-2541"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>  </span><span class="hs-comment">-- code</span><span>
</span><a name="line-2542"></a><span>
</span><a name="line-2543"></a><span>        </span><a name="local-6989586621684659915"><a href="#local-6989586621684659915"><span class="hs-identifier">push_arg</span></a></a><span> </span><a name="local-6989586621684659919"><a href="#local-6989586621684659919"><span class="hs-identifier">use_sse2</span></a></a><span> </span><a name="local-6989586621684659920"><a href="#local-6989586621684659920"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-comment">-- we don't need the hints on x86</span><span>
</span><a name="line-2544"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isWord64</span><span> </span><a href="#local-6989586621684659921"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2545"></a><span>            </span><a href="X86.CodeGen.html#ChildCode64"><span class="hs-identifier hs-var">ChildCode64</span></a><span> </span><a name="local-6989586621684659923"><a href="#local-6989586621684659923"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659924"><a href="#local-6989586621684659924"><span class="hs-identifier">r_lo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#iselExpr64"><span class="hs-identifier hs-var">iselExpr64</span></a><span> </span><a href="#local-6989586621684659920"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2546"></a><span>            </span><a name="local-6989586621684659925"><a href="#local-6989586621684659925"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span>
</span><a name="line-2547"></a><span>            </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659925"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-2548"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659926"><a href="#local-6989586621684659926"><span class="hs-identifier">r_hi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Reg.html#getHiVRegFromLo"><span class="hs-identifier hs-var">getHiVRegFromLo</span></a><span> </span><a href="#local-6989586621684659924"><span class="hs-identifier hs-var">r_lo</span></a><span>
</span><a name="line-2549"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span>       </span><a href="#local-6989586621684659923"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2550"></a><span>                           </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="X86.Instr.html#PUSH"><span class="hs-identifier hs-var">PUSH</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659926"><span class="hs-identifier hs-var">r_hi</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659925"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">4</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2551"></a><span>                                 </span><a href="X86.Instr.html#PUSH"><span class="hs-identifier hs-var">PUSH</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659924"><span class="hs-identifier hs-var">r_lo</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659925"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2552"></a><span>                                 </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659925"><span class="hs-identifier hs-var">delta</span></a><span class="hs-glyph">-</span><span class="hs-number">8</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2553"></a><span>                </span><span class="hs-special">)</span><span>
</span><a name="line-2554"></a><span>
</span><a name="line-2555"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684659921"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2556"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621684659927"><a href="#local-6989586621684659927"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659928"><a href="#local-6989586621684659928"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684659920"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2557"></a><span>            </span><a name="local-6989586621684659929"><a href="#local-6989586621684659929"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span>
</span><a name="line-2558"></a><span>            </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659929"><span class="hs-identifier hs-var">delta</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684659922"><span class="hs-identifier hs-var">size</span></a><span class="hs-special">)</span><span>
</span><a name="line-2559"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659928"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2560"></a><span>                            </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684659922"><span class="hs-identifier hs-var">size</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#esp"><span class="hs-identifier hs-var">esp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2561"></a><span>                                  </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659929"><span class="hs-identifier hs-var">delta</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684659922"><span class="hs-identifier hs-var">size</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2562"></a><span>                                  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684659930"><a href="#local-6989586621684659930"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="X86.Regs.html#esp"><span class="hs-identifier hs-var">esp</span></a><span class="hs-special">)</span><span>
</span><a name="line-2563"></a><span>                                                            </span><a href="X86.Regs.html#EAIndexNone"><span class="hs-identifier hs-var">EAIndexNone</span></a><span>
</span><a name="line-2564"></a><span>                                                            </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-2565"></a><span>                                      </span><a name="local-6989586621684659931"><a href="#local-6989586621684659931"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684659921"><span class="hs-identifier hs-var">arg_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-2566"></a><span>                                  </span><span class="hs-keyword">in</span><span>
</span><a name="line-2567"></a><span>                                  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684659919"><span class="hs-identifier hs-var">use_sse2</span></a><span>
</span><a name="line-2568"></a><span>                                     </span><span class="hs-keyword">then</span><span> </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684659931"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684659927"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684659930"><span class="hs-identifier hs-var">addr</span></a><span class="hs-special">)</span><span>
</span><a name="line-2569"></a><span>                                     </span><span class="hs-keyword">else</span><span> </span><a href="X86.Instr.html#GST"><span class="hs-identifier hs-var">GST</span></a><span> </span><a href="#local-6989586621684659931"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684659927"><span class="hs-identifier hs-var">reg</span></a><span> </span><a href="#local-6989586621684659930"><span class="hs-identifier hs-var">addr</span></a><span>
</span><a name="line-2570"></a><span>                                 </span><span class="hs-special">]</span><span>
</span><a name="line-2571"></a><span>                           </span><span class="hs-special">)</span><span>
</span><a name="line-2572"></a><span>
</span><a name="line-2573"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2574"></a><span>            </span><span class="hs-comment">-- Arguments can be smaller than 32-bit, but we still use @PUSH</span><span>
</span><a name="line-2575"></a><span>            </span><span class="hs-comment">-- II32@ - the usual calling conventions expect integers to be</span><span>
</span><a name="line-2576"></a><span>            </span><span class="hs-comment">-- 4-byte aligned.</span><span>
</span><a name="line-2577"></a><span>            </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">typeWidth</span><span> </span><span class="hs-identifier">arg_ty</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier">W32</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2578"></a><span>            </span><span class="hs-special">(</span><a name="local-6989586621684659932"><a href="#local-6989586621684659932"><span class="hs-identifier">operand</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684659933"><a href="#local-6989586621684659933"><span class="hs-identifier">code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getOperand"><span class="hs-identifier hs-var">getOperand</span></a><span> </span><a href="#local-6989586621684659920"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2579"></a><span>            </span><a name="local-6989586621684659934"><a href="#local-6989586621684659934"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span>
</span><a name="line-2580"></a><span>            </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659934"><span class="hs-identifier hs-var">delta</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684659922"><span class="hs-identifier hs-var">size</span></a><span class="hs-special">)</span><span>
</span><a name="line-2581"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659933"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-2582"></a><span>                    </span><a href="X86.Instr.html#PUSH"><span class="hs-identifier hs-var">PUSH</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684659932"><span class="hs-identifier hs-var">operand</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-2583"></a><span>                    </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659934"><span class="hs-identifier hs-var">delta</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684659922"><span class="hs-identifier hs-var">size</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2584"></a><span>
</span><a name="line-2585"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-2586"></a><span>             </span><a name="local-6989586621684659921"><a href="#local-6989586621684659921"><span class="hs-identifier">arg_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684659909"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659920"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2587"></a><span>             </span><a name="local-6989586621684659922"><a href="#local-6989586621684659922"><span class="hs-identifier">size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659913"><span class="hs-identifier hs-var">arg_size_bytes</span></a><span> </span><a href="#local-6989586621684659921"><span class="hs-identifier hs-var">arg_ty</span></a><span> </span><span class="hs-comment">-- Byte size</span><span>
</span><a name="line-2588"></a><span>
</span><a name="line-2589"></a><span class="hs-identifier">genCCall64'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span>
</span><a name="line-2590"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-type">ForeignTarget</span></a><span>      </span><span class="hs-comment">-- function to call</span><span>
</span><a name="line-2591"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- where to put the result</span><span>
</span><a name="line-2592"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- arguments (of mixed type)</span><span>
</span><a name="line-2593"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-2594"></a><a name="genCCall64%27"><a href="X86.CodeGen.html#genCCall64%27"><span class="hs-identifier">genCCall64'</span></a></a><span> </span><a name="local-6989586621684659968"><a href="#local-6989586621684659968"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684659969"><a href="#local-6989586621684659969"><span class="hs-identifier">target</span></a></a><span> </span><a name="local-6989586621684659970"><a href="#local-6989586621684659970"><span class="hs-identifier">dest_regs</span></a></a><span> </span><a name="local-6989586621684659971"><a href="#local-6989586621684659971"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2595"></a><span>    </span><span class="hs-comment">-- load up the register arguments</span><span>
</span><a name="line-2596"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660049"><a href="#local-6989586621684660049"><span class="hs-identifier">prom_args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#maybePromoteCArg"><span class="hs-identifier hs-var">maybePromoteCArg</span></a><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659971"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-2597"></a><span>
</span><a name="line-2598"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684660060"><a href="#local-6989586621684660060"><span class="hs-identifier">stack_args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660061"><a href="#local-6989586621684660061"><span class="hs-identifier">int_regs_used</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660062"><a href="#local-6989586621684660062"><span class="hs-identifier">fp_regs_used</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660063"><a href="#local-6989586621684660063"><span class="hs-identifier">load_args_code</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660064"><a href="#local-6989586621684660064"><span class="hs-identifier">assign_args_code</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2599"></a><span>         </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-2600"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span>
</span><a name="line-2601"></a><span>        </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621684659975"><span class="hs-identifier hs-var">load_args_win</span></a><span> </span><a href="#local-6989586621684660049"><span class="hs-identifier hs-var">prom_args</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#allArgRegs"><span class="hs-identifier hs-var">allArgRegs</span></a><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2602"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2603"></a><span>           </span><span class="hs-special">(</span><a name="local-6989586621684660050"><a href="#local-6989586621684660050"><span class="hs-identifier">stack_args</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660051"><a href="#local-6989586621684660051"><span class="hs-identifier">aregs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660052"><a href="#local-6989586621684660052"><span class="hs-identifier">fregs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660053"><a href="#local-6989586621684660053"><span class="hs-identifier">load_args_code</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660054"><a href="#local-6989586621684660054"><span class="hs-identifier">assign_args_code</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2604"></a><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659974"><span class="hs-identifier hs-var">load_args</span></a><span> </span><a href="#local-6989586621684660049"><span class="hs-identifier hs-var">prom_args</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#allIntArgRegs"><span class="hs-identifier hs-var">allIntArgRegs</span></a><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span>
</span><a name="line-2605"></a><span>                                      </span><span class="hs-special">(</span><a href="X86.Regs.html#allFPArgRegs"><span class="hs-identifier hs-var">allFPArgRegs</span></a><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span>
</span><a name="line-2606"></a><span>                                      </span><span class="hs-identifier hs-var">nilOL</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2607"></a><span>           </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660055"><a href="#local-6989586621684660055"><span class="hs-identifier">used_regs</span></a></a><span> </span><a name="local-6989586621684660058"><a href="#local-6989586621684660058"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684660058"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-keyword">as</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2608"></a><span>               </span><a name="local-6989586621684660056"><a href="#local-6989586621684660056"><span class="hs-identifier">fregs_used</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660055"><span class="hs-identifier hs-var">used_regs</span></a><span> </span><a href="#local-6989586621684660052"><span class="hs-identifier hs-var">fregs</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#allFPArgRegs"><span class="hs-identifier hs-var">allFPArgRegs</span></a><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span>
</span><a name="line-2609"></a><span>               </span><a name="local-6989586621684660057"><a href="#local-6989586621684660057"><span class="hs-identifier">aregs_used</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660055"><span class="hs-identifier hs-var">used_regs</span></a><span> </span><a href="#local-6989586621684660051"><span class="hs-identifier hs-var">aregs</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#allIntArgRegs"><span class="hs-identifier hs-var">allIntArgRegs</span></a><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span>
</span><a name="line-2610"></a><span>           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660050"><span class="hs-identifier hs-var">stack_args</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660057"><span class="hs-identifier hs-var">aregs_used</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660056"><span class="hs-identifier hs-var">fregs_used</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660053"><span class="hs-identifier hs-var">load_args_code</span></a><span>
</span><a name="line-2611"></a><span>                                                      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660054"><span class="hs-identifier hs-var">assign_args_code</span></a><span class="hs-special">)</span><span>
</span><a name="line-2612"></a><span>
</span><a name="line-2613"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-2614"></a><span>        </span><a name="local-6989586621684660065"><a href="#local-6989586621684660065"><span class="hs-identifier">arg_regs_used</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660061"><span class="hs-identifier hs-var">int_regs_used</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684660062"><span class="hs-identifier hs-var">fp_regs_used</span></a><span>
</span><a name="line-2615"></a><span>        </span><a name="local-6989586621684660066"><a href="#local-6989586621684660066"><span class="hs-identifier">arg_regs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684660065"><span class="hs-identifier hs-var">arg_regs_used</span></a><span>
</span><a name="line-2616"></a><span>                </span><span class="hs-comment">-- for annotating the call instruction with</span><span>
</span><a name="line-2617"></a><span>        </span><a name="local-6989586621684660067"><a href="#local-6989586621684660067"><span class="hs-identifier">sse_regs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684660062"><span class="hs-identifier hs-var">fp_regs_used</span></a><span>
</span><a name="line-2618"></a><span>        </span><a name="local-6989586621684660068"><a href="#local-6989586621684660068"><span class="hs-identifier">arg_stack_slots</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span>
</span><a name="line-2619"></a><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684660060"><span class="hs-identifier hs-var">stack_args</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#allArgRegs"><span class="hs-identifier hs-var">allArgRegs</span></a><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span>
</span><a name="line-2620"></a><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621684660060"><span class="hs-identifier hs-var">stack_args</span></a><span>
</span><a name="line-2621"></a><span>        </span><a name="local-6989586621684660069"><a href="#local-6989586621684660069"><span class="hs-identifier">tot_arg_size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659973"><span class="hs-identifier hs-var">arg_size</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621684660068"><span class="hs-identifier hs-var">arg_stack_slots</span></a><span>
</span><a name="line-2622"></a><span>
</span><a name="line-2623"></a><span>
</span><a name="line-2624"></a><span>    </span><span class="hs-comment">-- Align stack to 16n for calls, assuming a starting stack</span><span>
</span><a name="line-2625"></a><span>    </span><span class="hs-comment">-- alignment of 16n - word_size on procedure entry. Which we</span><span>
</span><a name="line-2626"></a><span>    </span><span class="hs-comment">-- maintain. See Note [rts/StgCRun.c : Stack Alignment on X86]</span><span>
</span><a name="line-2627"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684660071"><a href="#local-6989586621684660071"><span class="hs-identifier">real_size</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660072"><a href="#local-6989586621684660072"><span class="hs-identifier">adjust_rsp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-2628"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660069"><span class="hs-identifier hs-var">tot_arg_size</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">rem</span><span class="hs-special">`</span><span> </span><span class="hs-number">16</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2629"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660069"><span class="hs-identifier hs-var">tot_arg_size</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-2630"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- we need to adjust...</span><span>
</span><a name="line-2631"></a><span>                </span><a name="local-6989586621684660070"><a href="#local-6989586621684660070"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span>
</span><a name="line-2632"></a><span>                </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660070"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-2633"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660069"><span class="hs-identifier hs-var">tot_arg_size</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2634"></a><span>                                </span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#rsp"><span class="hs-identifier hs-var">rsp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2635"></a><span>                                </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660070"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2636"></a><span>
</span><a name="line-2637"></a><span>    </span><span class="hs-comment">-- push the stack args, right to left</span><span>
</span><a name="line-2638"></a><span>    </span><a name="local-6989586621684660073"><a href="#local-6989586621684660073"><span class="hs-identifier">push_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659976"><span class="hs-identifier hs-var">push_args</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621684660060"><span class="hs-identifier hs-var">stack_args</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2639"></a><span>    </span><span class="hs-comment">-- On Win64, we also have to leave stack space for the arguments</span><span>
</span><a name="line-2640"></a><span>    </span><span class="hs-comment">-- that we are passing in registers</span><span>
</span><a name="line-2641"></a><span>    </span><a name="local-6989586621684660074"><a href="#local-6989586621684660074"><span class="hs-identifier">lss_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSMinGW32</span><span>
</span><a name="line-2642"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621684659977"><span class="hs-identifier hs-var">leaveStackSpace</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#allArgRegs"><span class="hs-identifier hs-var">allArgRegs</span></a><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2643"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2644"></a><span>    </span><a name="local-6989586621684660075"><a href="#local-6989586621684660075"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span>
</span><a name="line-2645"></a><span>
</span><a name="line-2646"></a><span>    </span><span class="hs-comment">-- deal with static vs dynamic call targets</span><span>
</span><a name="line-2647"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684660083"><a href="#local-6989586621684660083"><span class="hs-identifier">callinsns</span></a></a><span class="hs-special">,</span><a name="local-6989586621684660084"><a href="#local-6989586621684660084"><span class="hs-identifier">_cconv</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-2648"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659969"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2649"></a><span>        </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabel"><span class="hs-identifier hs-var">CmmLabel</span></a><span> </span><a name="local-6989586621684660076"><a href="#local-6989586621684660076"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621684660077"><a href="#local-6989586621684660077"><span class="hs-identifier">conv</span></a></a><span>
</span><a name="line-2650"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- ToDo: stdcall arg sizes</span><span>
</span><a name="line-2651"></a><span>              </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#CALL"><span class="hs-identifier hs-var">CALL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621684660078"><span class="hs-identifier hs-var">fn_imm</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660066"><span class="hs-identifier hs-var">arg_regs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660077"><span class="hs-identifier hs-var">conv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2652"></a><span>           </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684660078"><a href="#local-6989586621684660078"><span class="hs-identifier">fn_imm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="#local-6989586621684660076"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2653"></a><span>        </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a name="local-6989586621684660079"><a href="#local-6989586621684660079"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621684660080"><a href="#local-6989586621684660080"><span class="hs-identifier">conv</span></a></a><span>
</span><a name="line-2654"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684660081"><a href="#local-6989586621684660081"><span class="hs-identifier">dyn_r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660082"><a href="#local-6989586621684660082"><span class="hs-identifier">dyn_c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684660079"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-2655"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660082"><span class="hs-identifier hs-var">dyn_c</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="X86.Instr.html#CALL"><span class="hs-identifier hs-var">CALL</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621684660081"><span class="hs-identifier hs-var">dyn_r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660066"><span class="hs-identifier hs-var">arg_regs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660080"><span class="hs-identifier hs-var">conv</span></a><span class="hs-special">)</span><span>
</span><a name="line-2656"></a><span>        </span><a href="CmmNode.html#PrimTarget"><span class="hs-identifier hs-var">PrimTarget</span></a><span> </span><span class="hs-identifier">_</span><span>
</span><a name="line-2657"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;genCCall: Can't handle PrimTarget call type here, error &quot;</span><span>
</span><a name="line-2658"></a><span>                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;probably because too many return values.&quot;</span><span>
</span><a name="line-2659"></a><span>
</span><a name="line-2660"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-2661"></a><span>        </span><span class="hs-comment">-- The x86_64 ABI requires us to set %al to the number of SSE2</span><span>
</span><a name="line-2662"></a><span>        </span><span class="hs-comment">-- registers that contain arguments, if the called routine</span><span>
</span><a name="line-2663"></a><span>        </span><span class="hs-comment">-- is a varargs function.  We don't know whether it's a</span><span>
</span><a name="line-2664"></a><span>        </span><span class="hs-comment">-- varargs function or not, so we have to assume it is.</span><span>
</span><a name="line-2665"></a><span>        </span><span class="hs-comment">--</span><span>
</span><a name="line-2666"></a><span>        </span><span class="hs-comment">-- It's not safe to omit this assignment, even if the number</span><span>
</span><a name="line-2667"></a><span>        </span><span class="hs-comment">-- of SSE2 regs in use is zero.  If %al is larger than 8</span><span>
</span><a name="line-2668"></a><span>        </span><span class="hs-comment">-- on entry to a varargs function, seg faults ensue.</span><span>
</span><a name="line-2669"></a><span>        </span><a name="local-6989586621684660085"><a href="#local-6989586621684660085"><span class="hs-identifier">assign_eax</span></a></a><span> </span><a name="local-6989586621684660086"><a href="#local-6989586621684660086"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684660086"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#eax"><span class="hs-identifier hs-var">eax</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2670"></a><span>
</span><a name="line-2671"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660087"><a href="#local-6989586621684660087"><span class="hs-identifier">call</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660083"><span class="hs-identifier hs-var">callinsns</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2672"></a><span>               </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-2673"></a><span>                    </span><span class="hs-comment">-- Deallocate parameters after call for ccall;</span><span>
</span><a name="line-2674"></a><span>                    </span><span class="hs-comment">-- stdcall has callee do it, but is not supported on</span><span>
</span><a name="line-2675"></a><span>                    </span><span class="hs-comment">-- x86_64 target (see #3336)</span><span>
</span><a name="line-2676"></a><span>                  </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684660071"><span class="hs-identifier hs-var">real_size</span></a><span class="hs-operator hs-var">==</span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span>
</span><a name="line-2677"></a><span>                   </span><span class="hs-special">[</span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684660071"><span class="hs-identifier hs-var">real_size</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#esp"><span class="hs-identifier hs-var">esp</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-2678"></a><span>                  </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-2679"></a><span>                  </span><span class="hs-special">[</span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660075"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684660071"><span class="hs-identifier hs-var">real_size</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2680"></a><span>               </span><span class="hs-special">)</span><span>
</span><a name="line-2681"></a><span>    </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660075"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621684660071"><span class="hs-identifier hs-var">real_size</span></a><span class="hs-special">)</span><span>
</span><a name="line-2682"></a><span>
</span><a name="line-2683"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-2684"></a><span>        </span><span class="hs-comment">-- assign the results, if necessary</span><span>
</span><a name="line-2685"></a><span>        </span><a name="local-6989586621684660088"><a href="#local-6989586621684660088"><span class="hs-identifier">assign_code</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span>
</span><a name="line-2686"></a><span>        </span><span class="hs-identifier">assign_code</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684660089"><a href="#local-6989586621684660089"><span class="hs-identifier">dest</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2687"></a><span>          </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684660090"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2688"></a><span>                </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684660090"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><span class="hs-identifier hs-var">W32</span><span class="hs-special">)</span><span>
</span><a name="line-2689"></a><span>                                                     </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#xmm0"><span class="hs-identifier hs-var">xmm0</span></a><span class="hs-special">)</span><span>
</span><a name="line-2690"></a><span>                                                     </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660091"><span class="hs-identifier hs-var">r_dest</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2691"></a><span>                </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684660090"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span>
</span><a name="line-2692"></a><span>                                                     </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#xmm0"><span class="hs-identifier hs-var">xmm0</span></a><span class="hs-special">)</span><span>
</span><a name="line-2693"></a><span>                                                     </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660091"><span class="hs-identifier hs-var">r_dest</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2694"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684660090"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#rax"><span class="hs-identifier hs-var">rax</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660091"><span class="hs-identifier hs-var">r_dest</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2695"></a><span>          </span><span class="hs-keyword">where</span><span>
</span><a name="line-2696"></a><span>                </span><a name="local-6989586621684660090"><a href="#local-6989586621684660090"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#localRegType"><span class="hs-identifier hs-var">localRegType</span></a><span> </span><a href="#local-6989586621684660089"><span class="hs-identifier hs-var">dest</span></a><span>
</span><a name="line-2697"></a><span>                </span><a name="local-6989586621684660091"><a href="#local-6989586621684660091"><span class="hs-identifier">r_dest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#getRegisterReg"><span class="hs-identifier hs-var">getRegisterReg</span></a><span> </span><a href="#local-6989586621684659972"><span class="hs-identifier hs-var">platform</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLocal"><span class="hs-identifier hs-var">CmmLocal</span></a><span> </span><a href="#local-6989586621684660089"><span class="hs-identifier hs-var">dest</span></a><span class="hs-special">)</span><span>
</span><a name="line-2698"></a><span>        </span><span class="hs-identifier">assign_code</span><span> </span><a name="local-6989586621684660092"><a href="#local-6989586621684660092"><span class="hs-identifier">_many</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;genCCall.assign_code many&quot;</span><span>
</span><a name="line-2699"></a><span>
</span><a name="line-2700"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660072"><span class="hs-identifier hs-var">adjust_rsp</span></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2701"></a><span>            </span><a href="#local-6989586621684660073"><span class="hs-identifier hs-var">push_code</span></a><span>           </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2702"></a><span>            </span><a href="#local-6989586621684660063"><span class="hs-identifier hs-var">load_args_code</span></a><span>      </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2703"></a><span>            </span><a href="#local-6989586621684660064"><span class="hs-identifier hs-var">assign_args_code</span></a><span>    </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2704"></a><span>            </span><a href="#local-6989586621684660074"><span class="hs-identifier hs-var">lss_code</span></a><span>            </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2705"></a><span>            </span><a href="#local-6989586621684660085"><span class="hs-identifier hs-var">assign_eax</span></a><span> </span><a href="#local-6989586621684660067"><span class="hs-identifier hs-var">sse_regs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2706"></a><span>            </span><a href="#local-6989586621684660087"><span class="hs-identifier hs-var">call</span></a><span>                </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2707"></a><span>            </span><a href="#local-6989586621684660088"><span class="hs-identifier hs-var">assign_code</span></a><span> </span><a href="#local-6989586621684659970"><span class="hs-identifier hs-var">dest_regs</span></a><span class="hs-special">)</span><span>
</span><a name="line-2708"></a><span>
</span><a name="line-2709"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684659972"><a href="#local-6989586621684659972"><span class="hs-identifier">platform</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2710"></a><span>        </span><a name="local-6989586621684659973"><a href="#local-6989586621684659973"><span class="hs-identifier">arg_size</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8</span><span> </span><span class="hs-comment">-- always, at the mo</span><span>
</span><a name="line-2711"></a><span>
</span><a name="line-2712"></a><span>
</span><a name="line-2713"></a><span>        </span><span class="hs-identifier">load_args</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-special">]</span><span>
</span><a name="line-2714"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- int regs avail for args</span><span>
</span><a name="line-2715"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- FP regs avail for args</span><span>
</span><a name="line-2716"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>    </span><span class="hs-comment">-- code computing args</span><span>
</span><a name="line-2717"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>    </span><span class="hs-comment">-- code assigning args to ABI regs</span><span>
</span><a name="line-2718"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span class="hs-special">,</span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">,</span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-2719"></a><span>        </span><span class="hs-comment">-- no more regs to use</span><span>
</span><a name="line-2720"></a><span>        </span><a name="local-6989586621684659974"><a href="#local-6989586621684659974"><span class="hs-identifier">load_args</span></a></a><span> </span><a name="local-6989586621684659978"><a href="#local-6989586621684659978"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621684659979"><a href="#local-6989586621684659979"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659980"><a href="#local-6989586621684659980"><span class="hs-identifier">acode</span></a></a><span>     </span><span class="hs-glyph">=</span><span>
</span><a name="line-2721"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659978"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659979"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659980"><span class="hs-identifier hs-var">acode</span></a><span class="hs-special">)</span><span>
</span><a name="line-2722"></a><span>
</span><a name="line-2723"></a><span>        </span><span class="hs-comment">-- no more args to push</span><span>
</span><a name="line-2724"></a><span>        </span><span class="hs-identifier">load_args</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621684659981"><a href="#local-6989586621684659981"><span class="hs-identifier">aregs</span></a></a><span> </span><a name="local-6989586621684659982"><a href="#local-6989586621684659982"><span class="hs-identifier">fregs</span></a></a><span> </span><a name="local-6989586621684659983"><a href="#local-6989586621684659983"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659984"><a href="#local-6989586621684659984"><span class="hs-identifier">acode</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2725"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659981"><span class="hs-identifier hs-var">aregs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659982"><span class="hs-identifier hs-var">fregs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659983"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659984"><span class="hs-identifier hs-var">acode</span></a><span class="hs-special">)</span><span>
</span><a name="line-2726"></a><span>
</span><a name="line-2727"></a><span>        </span><span class="hs-identifier">load_args</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684659985"><a href="#local-6989586621684659985"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684659986"><a href="#local-6989586621684659986"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684659987"><a href="#local-6989586621684659987"><span class="hs-identifier">aregs</span></a></a><span> </span><a name="local-6989586621684659988"><a href="#local-6989586621684659988"><span class="hs-identifier">fregs</span></a></a><span> </span><a name="local-6989586621684659989"><a href="#local-6989586621684659989"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684659990"><a href="#local-6989586621684659990"><span class="hs-identifier">acode</span></a></a><span>
</span><a name="line-2728"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684659993"><span class="hs-identifier hs-var">arg_rep</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659988"><span class="hs-identifier hs-var">fregs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2729"></a><span>                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659991"><span class="hs-identifier hs-var">push_this_arg</span></a><span>
</span><a name="line-2730"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621684660007"><a href="#local-6989586621684660007"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621684660008"><a href="#local-6989586621684660008"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2731"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621684660009"><a href="#local-6989586621684660009"><span class="hs-identifier">code'</span></a></a><span class="hs-special">,</span><a name="local-6989586621684660010"><a href="#local-6989586621684660010"><span class="hs-identifier">acode'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659992"><span class="hs-identifier hs-var">reg_this_arg</span></a><span> </span><a href="#local-6989586621684660007"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-2732"></a><span>                    </span><a href="#local-6989586621684659974"><span class="hs-identifier hs-var">load_args</span></a><span> </span><a href="#local-6989586621684659986"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621684659987"><span class="hs-identifier hs-var">aregs</span></a><span> </span><a href="#local-6989586621684660008"><span class="hs-identifier hs-var">rs</span></a><span> </span><a href="#local-6989586621684660009"><span class="hs-identifier hs-var">code'</span></a><span> </span><a href="#local-6989586621684660010"><span class="hs-identifier hs-var">acode'</span></a><span>
</span><a name="line-2733"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684659987"><span class="hs-identifier hs-var">aregs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2734"></a><span>                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684659991"><span class="hs-identifier hs-var">push_this_arg</span></a><span>
</span><a name="line-2735"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621684660011"><a href="#local-6989586621684660011"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621684660012"><a href="#local-6989586621684660012"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2736"></a><span>                    </span><span class="hs-special">(</span><a name="local-6989586621684660013"><a href="#local-6989586621684660013"><span class="hs-identifier">code'</span></a></a><span class="hs-special">,</span><a name="local-6989586621684660014"><a href="#local-6989586621684660014"><span class="hs-identifier">acode'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659992"><span class="hs-identifier hs-var">reg_this_arg</span></a><span> </span><a href="#local-6989586621684660011"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-2737"></a><span>                    </span><a href="#local-6989586621684659974"><span class="hs-identifier hs-var">load_args</span></a><span> </span><a href="#local-6989586621684659986"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621684660012"><span class="hs-identifier hs-var">rs</span></a><span> </span><a href="#local-6989586621684659988"><span class="hs-identifier hs-var">fregs</span></a><span> </span><a href="#local-6989586621684660013"><span class="hs-identifier hs-var">code'</span></a><span> </span><a href="#local-6989586621684660014"><span class="hs-identifier hs-var">acode'</span></a><span>
</span><a name="line-2738"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-2739"></a><span>
</span><a name="line-2740"></a><span>              </span><span class="hs-comment">-- put arg into the list of stack pushed args</span><span>
</span><a name="line-2741"></a><span>              </span><a name="local-6989586621684659991"><a href="#local-6989586621684659991"><span class="hs-identifier">push_this_arg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2742"></a><span>                 </span><span class="hs-special">(</span><a name="local-6989586621684659995"><a href="#local-6989586621684659995"><span class="hs-identifier">args'</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659996"><a href="#local-6989586621684659996"><span class="hs-identifier">ars</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659997"><a href="#local-6989586621684659997"><span class="hs-identifier">frs</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659998"><a href="#local-6989586621684659998"><span class="hs-identifier">code'</span></a></a><span class="hs-special">,</span><a name="local-6989586621684659999"><a href="#local-6989586621684659999"><span class="hs-identifier">acode'</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-2743"></a><span>                     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684659974"><span class="hs-identifier hs-var">load_args</span></a><span> </span><a href="#local-6989586621684659986"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621684659987"><span class="hs-identifier hs-var">aregs</span></a><span> </span><a href="#local-6989586621684659988"><span class="hs-identifier hs-var">fregs</span></a><span> </span><a href="#local-6989586621684659989"><span class="hs-identifier hs-var">code</span></a><span> </span><a href="#local-6989586621684659990"><span class="hs-identifier hs-var">acode</span></a><span>
</span><a name="line-2744"></a><span>                 </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659985"><span class="hs-identifier hs-var">arg</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684659995"><span class="hs-identifier hs-var">args'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659996"><span class="hs-identifier hs-var">ars</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659997"><span class="hs-identifier hs-var">frs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659998"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684659999"><span class="hs-identifier hs-var">acode'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2745"></a><span>
</span><a name="line-2746"></a><span>              </span><span class="hs-comment">-- pass the arg into the given register</span><span>
</span><a name="line-2747"></a><span>              </span><a name="local-6989586621684659992"><a href="#local-6989586621684659992"><span class="hs-identifier">reg_this_arg</span></a></a><span> </span><a name="local-6989586621684660000"><a href="#local-6989586621684660000"><span class="hs-identifier">r</span></a></a><span>
</span><a name="line-2748"></a><span>                </span><span class="hs-comment">-- &quot;operand&quot; args can be directly assigned into r</span><span>
</span><a name="line-2749"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#isOperand"><span class="hs-identifier hs-var">isOperand</span></a><span> </span><span class="hs-identifier hs-var">False</span><span> </span><a href="#local-6989586621684659985"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2750"></a><span>                    </span><a name="local-6989586621684660001"><a href="#local-6989586621684660001"><span class="hs-identifier">arg_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659985"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2751"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659989"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659990"><span class="hs-identifier hs-var">acode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660001"><span class="hs-identifier hs-var">arg_code</span></a><span> </span><a href="#local-6989586621684660000"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2752"></a><span>                </span><span class="hs-comment">-- The last non-operand arg can be directly assigned after its</span><span>
</span><a name="line-2753"></a><span>                </span><span class="hs-comment">-- computation without going into a temporary register</span><span>
</span><a name="line-2754"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#isOperand"><span class="hs-identifier hs-var">isOperand</span></a><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684659986"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2755"></a><span>                    </span><a name="local-6989586621684660002"><a href="#local-6989586621684660002"><span class="hs-identifier">arg_code</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659985"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2756"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684659989"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660002"><span class="hs-identifier hs-var">arg_code</span></a><span> </span><a href="#local-6989586621684660000"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><a href="#local-6989586621684659990"><span class="hs-identifier hs-var">acode</span></a><span class="hs-special">)</span><span>
</span><a name="line-2757"></a><span>
</span><a name="line-2758"></a><span>                </span><span class="hs-comment">-- other args need to be computed beforehand to avoid clobbering</span><span>
</span><a name="line-2759"></a><span>                </span><span class="hs-comment">-- previously assigned registers used to pass parameters (see</span><span>
</span><a name="line-2760"></a><span>                </span><span class="hs-comment">-- #11792, #12614). They are assigned into temporary registers</span><span>
</span><a name="line-2761"></a><span>                </span><span class="hs-comment">-- and get assigned to proper call ABI registers after they all</span><span>
</span><a name="line-2762"></a><span>                </span><span class="hs-comment">-- have been computed.</span><span>
</span><a name="line-2763"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2764"></a><span>                    </span><a name="local-6989586621684660003"><a href="#local-6989586621684660003"><span class="hs-identifier">arg_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684659985"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2765"></a><span>                    </span><a name="local-6989586621684660004"><a href="#local-6989586621684660004"><span class="hs-identifier">tmp</span></a></a><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684659994"><span class="hs-identifier hs-var">arg_fmt</span></a><span>
</span><a name="line-2766"></a><span>                    </span><span class="hs-keyword">let</span><span>
</span><a name="line-2767"></a><span>                      </span><a name="local-6989586621684660005"><a href="#local-6989586621684660005"><span class="hs-identifier">code'</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659989"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660003"><span class="hs-identifier hs-var">arg_code</span></a><span> </span><a href="#local-6989586621684660004"><span class="hs-identifier hs-var">tmp</span></a><span>
</span><a name="line-2768"></a><span>                      </span><a name="local-6989586621684660006"><a href="#local-6989586621684660006"><span class="hs-identifier">acode'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684659990"><span class="hs-identifier hs-var">acode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="X86.CodeGen.html#reg2reg"><span class="hs-identifier hs-var">reg2reg</span></a><span> </span><a href="#local-6989586621684659994"><span class="hs-identifier hs-var">arg_fmt</span></a><span> </span><a href="#local-6989586621684660004"><span class="hs-identifier hs-var">tmp</span></a><span> </span><a href="#local-6989586621684660000"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-2769"></a><span>                    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660005"><span class="hs-identifier hs-var">code'</span></a><span class="hs-special">,</span><a href="#local-6989586621684660006"><span class="hs-identifier hs-var">acode'</span></a><span class="hs-special">)</span><span>
</span><a name="line-2770"></a><span>
</span><a name="line-2771"></a><span>              </span><a name="local-6989586621684659993"><a href="#local-6989586621684659993"><span class="hs-identifier">arg_rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684659985"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2772"></a><span>              </span><a name="local-6989586621684659994"><a href="#local-6989586621684659994"><span class="hs-identifier">arg_fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#cmmTypeFormat"><span class="hs-identifier hs-var">cmmTypeFormat</span></a><span> </span><a href="#local-6989586621684659993"><span class="hs-identifier hs-var">arg_rep</span></a><span>
</span><a name="line-2773"></a><span>
</span><a name="line-2774"></a><span>        </span><span class="hs-identifier">load_args_win</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-special">]</span><span>
</span><a name="line-2775"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- used int regs</span><span>
</span><a name="line-2776"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- used FP regs</span><span>
</span><a name="line-2777"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">,</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- (int, FP) regs avail for args</span><span>
</span><a name="line-2778"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-2779"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span class="hs-special">]</span><span class="hs-special">,</span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">,</span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span class="hs-special">)</span><span>
</span><a name="line-2780"></a><span>        </span><a name="local-6989586621684659975"><a href="#local-6989586621684659975"><span class="hs-identifier">load_args_win</span></a></a><span> </span><a name="local-6989586621684660015"><a href="#local-6989586621684660015"><span class="hs-identifier">args</span></a></a><span> </span><a name="local-6989586621684660016"><a href="#local-6989586621684660016"><span class="hs-identifier">usedInt</span></a></a><span> </span><a name="local-6989586621684660017"><a href="#local-6989586621684660017"><span class="hs-identifier">usedFP</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621684660018"><a href="#local-6989586621684660018"><span class="hs-identifier">code</span></a></a><span>
</span><a name="line-2781"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660015"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660016"><span class="hs-identifier hs-var">usedInt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660017"><span class="hs-identifier hs-var">usedFP</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660018"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-2782"></a><span>            </span><span class="hs-comment">-- no more regs to use</span><span>
</span><a name="line-2783"></a><span>        </span><span class="hs-identifier">load_args_win</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621684660019"><a href="#local-6989586621684660019"><span class="hs-identifier">usedInt</span></a></a><span> </span><a name="local-6989586621684660020"><a href="#local-6989586621684660020"><span class="hs-identifier">usedFP</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684660021"><a href="#local-6989586621684660021"><span class="hs-identifier">code</span></a></a><span>
</span><a name="line-2784"></a><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660019"><span class="hs-identifier hs-var">usedInt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660020"><span class="hs-identifier hs-var">usedFP</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660021"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nilOL</span><span class="hs-special">)</span><span>
</span><a name="line-2785"></a><span>            </span><span class="hs-comment">-- no more args to push</span><span>
</span><a name="line-2786"></a><span>        </span><span class="hs-identifier">load_args_win</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684660022"><a href="#local-6989586621684660022"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684660023"><a href="#local-6989586621684660023"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684660024"><a href="#local-6989586621684660024"><span class="hs-identifier">usedInt</span></a></a><span> </span><a name="local-6989586621684660025"><a href="#local-6989586621684660025"><span class="hs-identifier">usedFP</span></a></a><span>
</span><a name="line-2787"></a><span>                      </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621684660026"><a href="#local-6989586621684660026"><span class="hs-identifier">ireg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660027"><a href="#local-6989586621684660027"><span class="hs-identifier">freg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621684660028"><a href="#local-6989586621684660028"><span class="hs-identifier">regs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684660029"><a href="#local-6989586621684660029"><span class="hs-identifier">code</span></a></a><span>
</span><a name="line-2788"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684660030"><span class="hs-identifier hs-var">arg_rep</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2789"></a><span>                 </span><a name="local-6989586621684660031"><a href="#local-6989586621684660031"><span class="hs-identifier">arg_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684660022"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2790"></a><span>                 </span><a href="#local-6989586621684659975"><span class="hs-identifier hs-var">load_args_win</span></a><span> </span><a href="#local-6989586621684660023"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660026"><span class="hs-identifier hs-var">ireg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684660024"><span class="hs-identifier hs-var">usedInt</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660027"><span class="hs-identifier hs-var">freg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684660025"><span class="hs-identifier hs-var">usedFP</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660028"><span class="hs-identifier hs-var">regs</span></a><span>
</span><a name="line-2791"></a><span>                               </span><span class="hs-special">(</span><a href="#local-6989586621684660029"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-2792"></a><span>                                </span><a href="#local-6989586621684660031"><span class="hs-identifier hs-var">arg_code</span></a><span> </span><a href="#local-6989586621684660027"><span class="hs-identifier hs-var">freg</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-2793"></a><span>                                </span><span class="hs-comment">-- If we are calling a varargs function</span><span>
</span><a name="line-2794"></a><span>                                </span><span class="hs-comment">-- then we need to define ireg as well</span><span>
</span><a name="line-2795"></a><span>                                </span><span class="hs-comment">-- as freg</span><span>
</span><a name="line-2796"></a><span>                                </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660027"><span class="hs-identifier hs-var">freg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660026"><span class="hs-identifier hs-var">ireg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2797"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2798"></a><span>                 </span><a name="local-6989586621684660032"><a href="#local-6989586621684660032"><span class="hs-identifier">arg_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684660022"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2799"></a><span>                 </span><a href="#local-6989586621684659975"><span class="hs-identifier hs-var">load_args_win</span></a><span> </span><a href="#local-6989586621684660023"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660026"><span class="hs-identifier hs-var">ireg</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684660024"><span class="hs-identifier hs-var">usedInt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660025"><span class="hs-identifier hs-var">usedFP</span></a><span> </span><a href="#local-6989586621684660028"><span class="hs-identifier hs-var">regs</span></a><span>
</span><a name="line-2800"></a><span>                               </span><span class="hs-special">(</span><a href="#local-6989586621684660029"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660032"><span class="hs-identifier hs-var">arg_code</span></a><span> </span><a href="#local-6989586621684660026"><span class="hs-identifier hs-var">ireg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2801"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-2802"></a><span>              </span><a name="local-6989586621684660030"><a href="#local-6989586621684660030"><span class="hs-identifier">arg_rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684660022"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2803"></a><span>
</span><a name="line-2804"></a><span>        </span><a name="local-6989586621684659976"><a href="#local-6989586621684659976"><span class="hs-identifier">push_args</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621684660033"><a href="#local-6989586621684660033"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684660033"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-2805"></a><span>        </span><span class="hs-identifier">push_args</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684660034"><a href="#local-6989586621684660034"><span class="hs-identifier">arg</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621684660035"><a href="#local-6989586621684660035"><span class="hs-identifier">rest</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684660036"><a href="#local-6989586621684660036"><span class="hs-identifier">code</span></a></a><span>
</span><a name="line-2806"></a><span>           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">isFloatType</span><span> </span><a href="#local-6989586621684660037"><span class="hs-identifier hs-var">arg_rep</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2807"></a><span>             </span><span class="hs-special">(</span><a name="local-6989586621684660039"><a href="#local-6989586621684660039"><span class="hs-identifier">arg_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660040"><a href="#local-6989586621684660040"><span class="hs-identifier">arg_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684660034"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2808"></a><span>             </span><a name="local-6989586621684660041"><a href="#local-6989586621684660041"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span>
</span><a name="line-2809"></a><span>             </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660041"><span class="hs-identifier hs-var">delta</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684659973"><span class="hs-identifier hs-var">arg_size</span></a><span class="hs-special">)</span><span>
</span><a name="line-2810"></a><span>             </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660042"><a href="#local-6989586621684660042"><span class="hs-identifier">code'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660036"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660040"><span class="hs-identifier hs-var">arg_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2811"></a><span>                            </span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><a href="#local-6989586621684659973"><span class="hs-identifier hs-var">arg_size</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#rsp"><span class="hs-identifier hs-var">rsp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2812"></a><span>                            </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660041"><span class="hs-identifier hs-var">delta</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684659973"><span class="hs-identifier hs-var">arg_size</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2813"></a><span>                            </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684660038"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660039"><span class="hs-identifier hs-var">arg_reg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#spRel"><span class="hs-identifier hs-var">spRel</span></a><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2814"></a><span>             </span><a href="#local-6989586621684659976"><span class="hs-identifier hs-var">push_args</span></a><span> </span><a href="#local-6989586621684660035"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621684660042"><span class="hs-identifier hs-var">code'</span></a><span>
</span><a name="line-2815"></a><span>
</span><a name="line-2816"></a><span>           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2817"></a><span>             </span><span class="hs-comment">-- Arguments can be smaller than 64-bit, but we still use @PUSH</span><span>
</span><a name="line-2818"></a><span>             </span><span class="hs-comment">-- II64@ - the usual calling conventions expect integers to be</span><span>
</span><a name="line-2819"></a><span>             </span><span class="hs-comment">-- 8-byte aligned.</span><span>
</span><a name="line-2820"></a><span>             </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier hs-var">width</span><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier hs-var">W64</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2821"></a><span>             </span><span class="hs-special">(</span><a name="local-6989586621684660043"><a href="#local-6989586621684660043"><span class="hs-identifier">arg_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660044"><a href="#local-6989586621684660044"><span class="hs-identifier">arg_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getOperand"><span class="hs-identifier hs-var">getOperand</span></a><span> </span><a href="#local-6989586621684660034"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2822"></a><span>             </span><a name="local-6989586621684660045"><a href="#local-6989586621684660045"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span>
</span><a name="line-2823"></a><span>             </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660045"><span class="hs-identifier hs-var">delta</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684659973"><span class="hs-identifier hs-var">arg_size</span></a><span class="hs-special">)</span><span>
</span><a name="line-2824"></a><span>             </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660046"><a href="#local-6989586621684660046"><span class="hs-identifier">code'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660036"><span class="hs-identifier hs-var">code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660044"><span class="hs-identifier hs-var">arg_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2825"></a><span>                                    </span><a href="X86.Instr.html#PUSH"><span class="hs-identifier hs-var">PUSH</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><a href="#local-6989586621684660043"><span class="hs-identifier hs-var">arg_op</span></a><span class="hs-special">,</span><span>
</span><a name="line-2826"></a><span>                                    </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660045"><span class="hs-identifier hs-var">delta</span></a><span class="hs-glyph">-</span><a href="#local-6989586621684659973"><span class="hs-identifier hs-var">arg_size</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2827"></a><span>             </span><a href="#local-6989586621684659976"><span class="hs-identifier hs-var">push_args</span></a><span> </span><a href="#local-6989586621684660035"><span class="hs-identifier hs-var">rest</span></a><span> </span><a href="#local-6989586621684660046"><span class="hs-identifier hs-var">code'</span></a><span>
</span><a name="line-2828"></a><span>            </span><span class="hs-keyword">where</span><span>
</span><a name="line-2829"></a><span>              </span><a name="local-6989586621684660037"><a href="#local-6989586621684660037"><span class="hs-identifier">arg_rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmExprType"><span class="hs-identifier hs-var">cmmExprType</span></a><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684660034"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2830"></a><span>              </span><a name="local-6989586621684660038"><a href="#local-6989586621684660038"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">typeWidth</span><span> </span><a href="#local-6989586621684660037"><span class="hs-identifier hs-var">arg_rep</span></a><span>
</span><a name="line-2831"></a><span>
</span><a name="line-2832"></a><span>        </span><a name="local-6989586621684659977"><a href="#local-6989586621684659977"><span class="hs-identifier">leaveStackSpace</span></a></a><span> </span><a name="local-6989586621684660047"><a href="#local-6989586621684660047"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2833"></a><span>             </span><a name="local-6989586621684660048"><a href="#local-6989586621684660048"><span class="hs-identifier">delta</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getDeltaNat"><span class="hs-identifier hs-var">getDeltaNat</span></a><span>
</span><a name="line-2834"></a><span>             </span><a href="NCGMonad.html#setDeltaNat"><span class="hs-identifier hs-var">setDeltaNat</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660048"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684660047"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621684659973"><span class="hs-identifier hs-var">arg_size</span></a><span class="hs-special">)</span><span>
</span><a name="line-2835"></a><span>             </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2836"></a><span>                         </span><a href="X86.Instr.html#SUB"><span class="hs-identifier hs-var">SUB</span></a><span> </span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660047"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621684659968"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="X86.Regs.html#rsp"><span class="hs-identifier hs-var">rsp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2837"></a><span>                         </span><a href="X86.Instr.html#DELTA"><span class="hs-identifier hs-var">DELTA</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660048"><span class="hs-identifier hs-var">delta</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621684660047"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621684659973"><span class="hs-identifier hs-var">arg_size</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-2838"></a><span>
</span><a name="line-2839"></a><span class="hs-identifier">maybePromoteCArg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span>
</span><a name="line-2840"></a><a name="maybePromoteCArg"><a href="X86.CodeGen.html#maybePromoteCArg"><span class="hs-identifier">maybePromoteCArg</span></a></a><span> </span><a name="local-6989586621684660093"><a href="#local-6989586621684660093"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684660094"><a href="#local-6989586621684660094"><span class="hs-identifier">wto</span></a></a><span> </span><a name="local-6989586621684660095"><a href="#local-6989586621684660095"><span class="hs-identifier">arg</span></a></a><span>
</span><a name="line-2841"></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684660096"><span class="hs-identifier hs-var">wfrom</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621684660094"><span class="hs-identifier hs-var">wto</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_UU_Conv"><span class="hs-identifier hs-var">MO_UU_Conv</span></a><span> </span><a href="#local-6989586621684660096"><span class="hs-identifier hs-var">wfrom</span></a><span> </span><a href="#local-6989586621684660094"><span class="hs-identifier hs-var">wto</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684660095"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">]</span><span>
</span><a name="line-2842"></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660095"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2843"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2844"></a><span>   </span><a name="local-6989586621684660096"><a href="#local-6989586621684660096"><span class="hs-identifier">wfrom</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmExpr.html#cmmExprWidth"><span class="hs-identifier hs-var">cmmExprWidth</span></a><span> </span><a href="#local-6989586621684660093"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684660095"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-2845"></a><span>
</span><a name="line-2846"></a><span class="hs-identifier">outOfLineCmmOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmMachOp.html#CallishMachOp"><span class="hs-identifier hs-type">CallishMachOp</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="CmmNode.html#CmmFormal"><span class="hs-identifier hs-type">CmmFormal</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="CmmNode.html#CmmActual"><span class="hs-identifier hs-type">CmmActual</span></a><span class="hs-special">]</span><span>
</span><a name="line-2847"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-2848"></a><a name="outOfLineCmmOp"><a href="X86.CodeGen.html#outOfLineCmmOp"><span class="hs-identifier">outOfLineCmmOp</span></a></a><span> </span><a name="local-6989586621684660097"><a href="#local-6989586621684660097"><span class="hs-identifier">bid</span></a></a><span> </span><a name="local-6989586621684660098"><a href="#local-6989586621684660098"><span class="hs-identifier">mop</span></a></a><span> </span><a name="local-6989586621684660099"><a href="#local-6989586621684660099"><span class="hs-identifier">res</span></a></a><span> </span><a name="local-6989586621684660100"><a href="#local-6989586621684660100"><span class="hs-identifier">args</span></a></a><span>
</span><a name="line-2849"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2850"></a><span>      </span><a name="local-6989586621684660107"><a href="#local-6989586621684660107"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2851"></a><span>      </span><a name="local-6989586621684660108"><a href="#local-6989586621684660108"><span class="hs-identifier">targetExpr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684660107"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="PIC.html#CallReference"><span class="hs-identifier hs-var">CallReference</span></a><span> </span><a href="#local-6989586621684660101"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2852"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660109"><a href="#local-6989586621684660109"><span class="hs-identifier">target</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmNode.html#ForeignTarget"><span class="hs-identifier hs-var">ForeignTarget</span></a><span> </span><a href="#local-6989586621684660108"><span class="hs-identifier hs-var">targetExpr</span></a><span>
</span><a name="line-2853"></a><span>                           </span><span class="hs-special">(</span><a href="CmmNode.html#ForeignConvention"><span class="hs-identifier hs-var">ForeignConvention</span></a><span> </span><span class="hs-identifier hs-var">CCallConv</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="CmmNode.html#CmmMayReturn"><span class="hs-identifier hs-var">CmmMayReturn</span></a><span class="hs-special">)</span><span>
</span><a name="line-2854"></a><span>
</span><a name="line-2855"></a><span>      </span><a href="X86.CodeGen.html#stmtToInstrs"><span class="hs-identifier hs-var">stmtToInstrs</span></a><span> </span><a href="#local-6989586621684660097"><span class="hs-identifier hs-var">bid</span></a><span> </span><span class="hs-special">(</span><a href="CmmNode.html#CmmUnsafeForeignCall"><span class="hs-identifier hs-var">CmmUnsafeForeignCall</span></a><span> </span><a href="#local-6989586621684660109"><span class="hs-identifier hs-var">target</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684660099"><span class="hs-identifier hs-var">res</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660100"><span class="hs-identifier hs-var">args</span></a><span class="hs-special">)</span><span>
</span><a name="line-2856"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2857"></a><span>        </span><span class="hs-comment">-- Assume we can call these functions directly, and that they're not in a dynamic library.</span><span>
</span><a name="line-2858"></a><span>        </span><span class="hs-comment">-- TODO: Why is this ok? Under linux this code will be in libm.so</span><span>
</span><a name="line-2859"></a><span>        </span><span class="hs-comment">--       Is it because they're really implemented as a primitive instruction by the assembler??  -- BL 2009/12/31</span><span>
</span><a name="line-2860"></a><span>        </span><a name="local-6989586621684660101"><a href="#local-6989586621684660101"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="CLabel.html#mkForeignLabel"><span class="hs-identifier hs-var">mkForeignLabel</span></a><span> </span><a href="#local-6989586621684660102"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="CLabel.html#ForeignLabelInThisPackage"><span class="hs-identifier hs-var">ForeignLabelInThisPackage</span></a><span> </span><span class="hs-identifier hs-var">IsFunction</span><span>
</span><a name="line-2861"></a><span>
</span><a name="line-2862"></a><span>        </span><a name="local-6989586621684660102"><a href="#local-6989586621684660102"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684660098"><span class="hs-identifier hs-var">mop</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2863"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Sqrt"><span class="hs-identifier hs-var">MO_F32_Sqrt</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sqrtf&quot;</span><span>
</span><a name="line-2864"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Fabs"><span class="hs-identifier hs-var">MO_F32_Fabs</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;fabsf&quot;</span><span>
</span><a name="line-2865"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Sin"><span class="hs-identifier hs-var">MO_F32_Sin</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sinf&quot;</span><span>
</span><a name="line-2866"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Cos"><span class="hs-identifier hs-var">MO_F32_Cos</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cosf&quot;</span><span>
</span><a name="line-2867"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Tan"><span class="hs-identifier hs-var">MO_F32_Tan</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanf&quot;</span><span>
</span><a name="line-2868"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Exp"><span class="hs-identifier hs-var">MO_F32_Exp</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;expf&quot;</span><span>
</span><a name="line-2869"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Log"><span class="hs-identifier hs-var">MO_F32_Log</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;logf&quot;</span><span>
</span><a name="line-2870"></a><span>
</span><a name="line-2871"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Asin"><span class="hs-identifier hs-var">MO_F32_Asin</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinf&quot;</span><span>
</span><a name="line-2872"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Acos"><span class="hs-identifier hs-var">MO_F32_Acos</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acosf&quot;</span><span>
</span><a name="line-2873"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Atan"><span class="hs-identifier hs-var">MO_F32_Atan</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanf&quot;</span><span>
</span><a name="line-2874"></a><span>
</span><a name="line-2875"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Sinh"><span class="hs-identifier hs-var">MO_F32_Sinh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sinhf&quot;</span><span>
</span><a name="line-2876"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Cosh"><span class="hs-identifier hs-var">MO_F32_Cosh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;coshf&quot;</span><span>
</span><a name="line-2877"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Tanh"><span class="hs-identifier hs-var">MO_F32_Tanh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanhf&quot;</span><span>
</span><a name="line-2878"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Pwr"><span class="hs-identifier hs-var">MO_F32_Pwr</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;powf&quot;</span><span>
</span><a name="line-2879"></a><span>
</span><a name="line-2880"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Asinh"><span class="hs-identifier hs-var">MO_F32_Asinh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinhf&quot;</span><span>
</span><a name="line-2881"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Acosh"><span class="hs-identifier hs-var">MO_F32_Acosh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acoshf&quot;</span><span>
</span><a name="line-2882"></a><span>              </span><a href="CmmMachOp.html#MO_F32_Atanh"><span class="hs-identifier hs-var">MO_F32_Atanh</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanhf&quot;</span><span>
</span><a name="line-2883"></a><span>
</span><a name="line-2884"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Sqrt"><span class="hs-identifier hs-var">MO_F64_Sqrt</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sqrt&quot;</span><span>
</span><a name="line-2885"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Fabs"><span class="hs-identifier hs-var">MO_F64_Fabs</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;fabs&quot;</span><span>
</span><a name="line-2886"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Sin"><span class="hs-identifier hs-var">MO_F64_Sin</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sin&quot;</span><span>
</span><a name="line-2887"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Cos"><span class="hs-identifier hs-var">MO_F64_Cos</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cos&quot;</span><span>
</span><a name="line-2888"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Tan"><span class="hs-identifier hs-var">MO_F64_Tan</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tan&quot;</span><span>
</span><a name="line-2889"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Exp"><span class="hs-identifier hs-var">MO_F64_Exp</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;exp&quot;</span><span>
</span><a name="line-2890"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Log"><span class="hs-identifier hs-var">MO_F64_Log</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;log&quot;</span><span>
</span><a name="line-2891"></a><span>
</span><a name="line-2892"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Asin"><span class="hs-identifier hs-var">MO_F64_Asin</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asin&quot;</span><span>
</span><a name="line-2893"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Acos"><span class="hs-identifier hs-var">MO_F64_Acos</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acos&quot;</span><span>
</span><a name="line-2894"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Atan"><span class="hs-identifier hs-var">MO_F64_Atan</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atan&quot;</span><span>
</span><a name="line-2895"></a><span>
</span><a name="line-2896"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Sinh"><span class="hs-identifier hs-var">MO_F64_Sinh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;sinh&quot;</span><span>
</span><a name="line-2897"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Cosh"><span class="hs-identifier hs-var">MO_F64_Cosh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cosh&quot;</span><span>
</span><a name="line-2898"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Tanh"><span class="hs-identifier hs-var">MO_F64_Tanh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;tanh&quot;</span><span>
</span><a name="line-2899"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Pwr"><span class="hs-identifier hs-var">MO_F64_Pwr</span></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;pow&quot;</span><span>
</span><a name="line-2900"></a><span>
</span><a name="line-2901"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Asinh"><span class="hs-identifier hs-var">MO_F64_Asinh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;asinh&quot;</span><span>
</span><a name="line-2902"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Acosh"><span class="hs-identifier hs-var">MO_F64_Acosh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;acosh&quot;</span><span>
</span><a name="line-2903"></a><span>              </span><a href="CmmMachOp.html#MO_F64_Atanh"><span class="hs-identifier hs-var">MO_F64_Atanh</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atanh&quot;</span><span>
</span><a name="line-2904"></a><span>
</span><a name="line-2905"></a><span>              </span><a href="CmmMachOp.html#MO_Memcpy"><span class="hs-identifier hs-var">MO_Memcpy</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memcpy&quot;</span><span>
</span><a name="line-2906"></a><span>              </span><a href="CmmMachOp.html#MO_Memset"><span class="hs-identifier hs-var">MO_Memset</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memset&quot;</span><span>
</span><a name="line-2907"></a><span>              </span><a href="CmmMachOp.html#MO_Memmove"><span class="hs-identifier hs-var">MO_Memmove</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memmove&quot;</span><span>
</span><a name="line-2908"></a><span>              </span><a href="CmmMachOp.html#MO_Memcmp"><span class="hs-identifier hs-var">MO_Memcmp</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;memcmp&quot;</span><span>
</span><a name="line-2909"></a><span>
</span><a name="line-2910"></a><span>              </span><a href="CmmMachOp.html#MO_PopCnt"><span class="hs-identifier hs-var">MO_PopCnt</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;popcnt&quot;</span><span>
</span><a name="line-2911"></a><span>              </span><a href="CmmMachOp.html#MO_BSwap"><span class="hs-identifier hs-var">MO_BSwap</span></a><span> </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;bswap&quot;</span><span>
</span><a name="line-2912"></a><span>              </span><a href="CmmMachOp.html#MO_Clz"><span class="hs-identifier hs-var">MO_Clz</span></a><span> </span><a name="local-6989586621684660104"><a href="#local-6989586621684660104"><span class="hs-identifier">w</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#clzLabel"><span class="hs-identifier hs-var">clzLabel</span></a><span> </span><a href="#local-6989586621684660104"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-2913"></a><span>              </span><a href="CmmMachOp.html#MO_Ctz"><span class="hs-identifier hs-var">MO_Ctz</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2914"></a><span>
</span><a name="line-2915"></a><span>              </span><a href="CmmMachOp.html#MO_Pdep"><span class="hs-identifier hs-var">MO_Pdep</span></a><span> </span><a name="local-6989586621684660105"><a href="#local-6989586621684660105"><span class="hs-identifier">w</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#pdepLabel"><span class="hs-identifier hs-var">pdepLabel</span></a><span> </span><a href="#local-6989586621684660105"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-2916"></a><span>              </span><a href="CmmMachOp.html#MO_Pext"><span class="hs-identifier hs-var">MO_Pext</span></a><span> </span><a name="local-6989586621684660106"><a href="#local-6989586621684660106"><span class="hs-identifier">w</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="CPrim.html#pextLabel"><span class="hs-identifier hs-var">pextLabel</span></a><span> </span><a href="#local-6989586621684660106"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-2917"></a><span>
</span><a name="line-2918"></a><span>              </span><a href="CmmMachOp.html#MO_AtomicRMW"><span class="hs-identifier hs-var">MO_AtomicRMW</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atomicrmw&quot;</span><span>
</span><a name="line-2919"></a><span>              </span><a href="CmmMachOp.html#MO_AtomicRead"><span class="hs-identifier hs-var">MO_AtomicRead</span></a><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atomicread&quot;</span><span>
</span><a name="line-2920"></a><span>              </span><a href="CmmMachOp.html#MO_AtomicWrite"><span class="hs-identifier hs-var">MO_AtomicWrite</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;atomicwrite&quot;</span><span>
</span><a name="line-2921"></a><span>              </span><a href="CmmMachOp.html#MO_Cmpxchg"><span class="hs-identifier hs-var">MO_Cmpxchg</span></a><span> </span><span class="hs-identifier">_</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fsLit</span><span> </span><span class="hs-string">&quot;cmpxchg&quot;</span><span>
</span><a name="line-2922"></a><span>
</span><a name="line-2923"></a><span>              </span><a href="CmmMachOp.html#MO_UF_Conv"><span class="hs-identifier hs-var">MO_UF_Conv</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2924"></a><span>
</span><a name="line-2925"></a><span>              </span><a href="CmmMachOp.html#MO_S_QuotRem"><span class="hs-identifier hs-var">MO_S_QuotRem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2926"></a><span>              </span><a href="CmmMachOp.html#MO_U_QuotRem"><span class="hs-identifier hs-var">MO_U_QuotRem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2927"></a><span>              </span><a href="CmmMachOp.html#MO_U_QuotRem2"><span class="hs-identifier hs-var">MO_U_QuotRem2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2928"></a><span>              </span><a href="CmmMachOp.html#MO_Add2"><span class="hs-identifier hs-var">MO_Add2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2929"></a><span>              </span><a href="CmmMachOp.html#MO_AddIntC"><span class="hs-identifier hs-var">MO_AddIntC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2930"></a><span>              </span><a href="CmmMachOp.html#MO_SubIntC"><span class="hs-identifier hs-var">MO_SubIntC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2931"></a><span>              </span><a href="CmmMachOp.html#MO_AddWordC"><span class="hs-identifier hs-var">MO_AddWordC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2932"></a><span>              </span><a href="CmmMachOp.html#MO_SubWordC"><span class="hs-identifier hs-var">MO_SubWordC</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2933"></a><span>              </span><a href="CmmMachOp.html#MO_U_Mul2"><span class="hs-identifier hs-var">MO_U_Mul2</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2934"></a><span>              </span><a href="CmmMachOp.html#MO_WriteBarrier"><span class="hs-identifier hs-var">MO_WriteBarrier</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2935"></a><span>              </span><a href="CmmMachOp.html#MO_Touch"><span class="hs-identifier hs-var">MO_Touch</span></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2936"></a><span>              </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_Prefetch_Data"><span class="hs-identifier hs-var">MO_Prefetch_Data</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660103"><span class="hs-identifier hs-var">unsupported</span></a><span>
</span><a name="line-2937"></a><span>        </span><a name="local-6989586621684660103"><a href="#local-6989586621684660103"><span class="hs-identifier">unsupported</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;outOfLineCmmOp: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684660098"><span class="hs-identifier hs-var">mop</span></a><span>
</span><a name="line-2938"></a><span>                          </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; not supported here&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-2939"></a><span>
</span><a name="line-2940"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-2941"></a><span class="hs-comment">-- Generating a table-branch</span><span>
</span><a name="line-2942"></a><span>
</span><a name="line-2943"></a><span class="hs-identifier">genSwitch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmSwitch.html#SwitchTargets"><span class="hs-identifier hs-type">SwitchTargets</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#InstrBlock"><span class="hs-identifier hs-type">InstrBlock</span></a><span>
</span><a name="line-2944"></a><span>
</span><a name="line-2945"></a><a name="genSwitch"><a href="X86.CodeGen.html#genSwitch"><span class="hs-identifier">genSwitch</span></a></a><span> </span><a name="local-6989586621684660110"><a href="#local-6989586621684660110"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684660111"><a href="#local-6989586621684660111"><span class="hs-identifier">expr</span></a></a><span> </span><a name="local-6989586621684660112"><a href="#local-6989586621684660112"><span class="hs-identifier">targets</span></a></a><span>
</span><a name="line-2946"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">positionIndependent</span><span> </span><a href="#local-6989586621684660110"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-2947"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2948"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684660116"><a href="#local-6989586621684660116"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684660117"><a href="#local-6989586621684660117"><span class="hs-identifier">e_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmUtils.html#cmmOffset"><span class="hs-identifier hs-var">cmmOffset</span></a><span> </span><a href="#local-6989586621684660110"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684660111"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-6989586621684660113"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span>
</span><a name="line-2949"></a><span>           </span><span class="hs-comment">-- getNonClobberedReg because it needs to survive across t_code</span><span>
</span><a name="line-2950"></a><span>        </span><a name="local-6989586621684660118"><a href="#local-6989586621684660118"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-2951"></a><span>        </span><a name="local-6989586621684660119"><a href="#local-6989586621684660119"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getDynFlags</span><span>
</span><a name="line-2952"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660120"><a href="#local-6989586621684660120"><span class="hs-identifier">is32bit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">target32Bit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684660119"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-2953"></a><span>            </span><a name="local-6989586621684660121"><a href="#local-6989586621684660121"><span class="hs-identifier">os</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">platformOS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">targetPlatform</span><span> </span><a href="#local-6989586621684660119"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span>
</span><a name="line-2954"></a><span>            </span><span class="hs-comment">-- Might want to use .rodata.&lt;function we're in&gt; instead, but as</span><span>
</span><a name="line-2955"></a><span>            </span><span class="hs-comment">-- long as it's something unique it'll work out since the</span><span>
</span><a name="line-2956"></a><span>            </span><span class="hs-comment">-- references to the jump table are in the appropriate section.</span><span>
</span><a name="line-2957"></a><span>            </span><a name="local-6989586621684660122"><a href="#local-6989586621684660122"><span class="hs-identifier">rosection</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684660121"><span class="hs-identifier hs-var">os</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2958"></a><span>              </span><span class="hs-comment">-- on Mac OS X/x86_64, put the jump table in the text section to</span><span>
</span><a name="line-2959"></a><span>              </span><span class="hs-comment">-- work around a limitation of the linker.</span><span>
</span><a name="line-2960"></a><span>              </span><span class="hs-comment">-- ld64 is unable to handle the relocations for</span><span>
</span><a name="line-2961"></a><span>              </span><span class="hs-comment">--     .quad L1 - L0</span><span>
</span><a name="line-2962"></a><span>              </span><span class="hs-comment">-- if L0 is not preceded by a non-anonymous label in its section.</span><span>
</span><a name="line-2963"></a><span>              </span><span class="hs-identifier hs-var">OSDarwin</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621684660120"><span class="hs-identifier hs-var">is32bit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a href="Cmm.html#Text"><span class="hs-identifier hs-var">Text</span></a><span> </span><a href="#local-6989586621684660118"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2964"></a><span>              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span> </span><a href="#local-6989586621684660118"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2965"></a><span>        </span><a name="local-6989586621684660123"><a href="#local-6989586621684660123"><span class="hs-identifier">dynRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="PIC.html#cmmMakeDynamicReference"><span class="hs-identifier hs-var">cmmMakeDynamicReference</span></a><span> </span><a href="#local-6989586621684660119"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="PIC.html#DataReference"><span class="hs-identifier hs-var">DataReference</span></a><span> </span><a href="#local-6989586621684660118"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2966"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684660124"><a href="#local-6989586621684660124"><span class="hs-identifier">tableReg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684660125"><a href="#local-6989586621684660125"><span class="hs-identifier">t_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621684660123"><span class="hs-identifier hs-var">dynRef</span></a><span>
</span><a name="line-2967"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660126"><a href="#local-6989586621684660126"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EABaseReg"><span class="hs-identifier hs-var">EABaseReg</span></a><span> </span><a href="#local-6989586621684660124"><span class="hs-identifier hs-var">tableReg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2968"></a><span>                                       </span><span class="hs-special">(</span><a href="X86.Regs.html#EAIndex"><span class="hs-identifier hs-var">EAIndex</span></a><span> </span><a href="#local-6989586621684660116"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621684660119"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmInt"><span class="hs-identifier hs-var">ImmInt</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2969"></a><span>
</span><a name="line-2970"></a><span>        </span><a name="local-6989586621684660127"><a href="#local-6989586621684660127"><span class="hs-identifier">offsetReg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684660119"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2971"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684660120"><span class="hs-identifier hs-var">is32bit</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621684660121"><span class="hs-identifier hs-var">os</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">OSDarwin</span><span>
</span><a name="line-2972"></a><span>                 </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621684660117"><span class="hs-identifier hs-var">e_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660125"><span class="hs-identifier hs-var">t_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2973"></a><span>                                </span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684660119"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660126"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660124"><span class="hs-identifier hs-var">tableReg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2974"></a><span>                                </span><a href="X86.Instr.html#JMP_TBL"><span class="hs-identifier hs-var">JMP_TBL</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660124"><span class="hs-identifier hs-var">tableReg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660115"><span class="hs-identifier hs-var">ids</span></a><span> </span><a href="#local-6989586621684660122"><span class="hs-identifier hs-var">rosection</span></a><span> </span><a href="#local-6989586621684660118"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2975"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-2976"></a><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- HACK: On x86_64 binutils&lt;2.17 is only able to generate</span><span>
</span><a name="line-2977"></a><span>                      </span><span class="hs-comment">-- PC32 relocations, hence we only get 32-bit offsets in</span><span>
</span><a name="line-2978"></a><span>                      </span><span class="hs-comment">-- the jump table. As these offsets are always negative</span><span>
</span><a name="line-2979"></a><span>                      </span><span class="hs-comment">-- we need to properly sign extend them to 64-bit. This</span><span>
</span><a name="line-2980"></a><span>                      </span><span class="hs-comment">-- hack should be removed in conjunction with the hack in</span><span>
</span><a name="line-2981"></a><span>                      </span><span class="hs-comment">-- PprMach.hs/pprDataItem once binutils 2.17 is standard.</span><span>
</span><a name="line-2982"></a><span>                      </span><a href="#local-6989586621684660117"><span class="hs-identifier hs-var">e_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660125"><span class="hs-identifier hs-var">t_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2983"></a><span>                               </span><a href="X86.Instr.html#MOVSxL"><span class="hs-identifier hs-var">MOVSxL</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684660126"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660127"><span class="hs-identifier hs-var">offsetReg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2984"></a><span>                               </span><a href="X86.Instr.html#ADD"><span class="hs-identifier hs-var">ADD</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684660119"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2985"></a><span>                                   </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660127"><span class="hs-identifier hs-var">offsetReg</span></a><span class="hs-special">)</span><span>
</span><a name="line-2986"></a><span>                                   </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660124"><span class="hs-identifier hs-var">tableReg</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-2987"></a><span>                               </span><a href="X86.Instr.html#JMP_TBL"><span class="hs-identifier hs-var">JMP_TBL</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660124"><span class="hs-identifier hs-var">tableReg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660115"><span class="hs-identifier hs-var">ids</span></a><span> </span><a href="#local-6989586621684660122"><span class="hs-identifier hs-var">rosection</span></a><span> </span><a href="#local-6989586621684660118"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2988"></a><span>                       </span><span class="hs-special">]</span><span>
</span><a name="line-2989"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-2990"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2991"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684660128"><a href="#local-6989586621684660128"><span class="hs-identifier">reg</span></a></a><span class="hs-special">,</span><a name="local-6989586621684660129"><a href="#local-6989586621684660129"><span class="hs-identifier">e_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><span class="hs-special">(</span><a href="CmmUtils.html#cmmOffset"><span class="hs-identifier hs-var">cmmOffset</span></a><span> </span><a href="#local-6989586621684660110"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684660111"><span class="hs-identifier hs-var">expr</span></a><span> </span><a href="#local-6989586621684660113"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span>
</span><a name="line-2992"></a><span>        </span><a name="local-6989586621684660130"><a href="#local-6989586621684660130"><span class="hs-identifier">lbl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewLabelNat"><span class="hs-identifier hs-var">getNewLabelNat</span></a><span>
</span><a name="line-2993"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660131"><a href="#local-6989586621684660131"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#AddrBaseIndex"><span class="hs-identifier hs-var">AddrBaseIndex</span></a><span> </span><a href="X86.Regs.html#EABaseNone"><span class="hs-identifier hs-var">EABaseNone</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#EAIndex"><span class="hs-identifier hs-var">EAIndex</span></a><span> </span><a href="#local-6989586621684660128"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">wORD_SIZE</span><span> </span><a href="#local-6989586621684660110"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#ImmCLbl"><span class="hs-identifier hs-var">ImmCLbl</span></a><span> </span><a href="#local-6989586621684660130"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2994"></a><span>            </span><a name="local-6989586621684660132"><a href="#local-6989586621684660132"><span class="hs-identifier">code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660129"><span class="hs-identifier hs-var">e_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-2995"></a><span>                    </span><a href="X86.Instr.html#JMP_TBL"><span class="hs-identifier hs-var">JMP_TBL</span></a><span> </span><a href="#local-6989586621684660131"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621684660115"><span class="hs-identifier hs-var">ids</span></a><span> </span><span class="hs-special">(</span><a href="Cmm.html#Section"><span class="hs-identifier hs-var">Section</span></a><span> </span><a href="Cmm.html#ReadOnlyData"><span class="hs-identifier hs-var">ReadOnlyData</span></a><span> </span><a href="#local-6989586621684660130"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660130"><span class="hs-identifier hs-var">lbl</span></a><span>
</span><a name="line-2996"></a><span>                 </span><span class="hs-special">]</span><span>
</span><a name="line-2997"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621684660132"><span class="hs-identifier hs-var">code</span></a><span>
</span><a name="line-2998"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-2999"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621684660113"><a href="#local-6989586621684660113"><span class="hs-identifier">offset</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660114"><a href="#local-6989586621684660114"><span class="hs-identifier">blockIds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="CmmSwitch.html#switchTargetsToTable"><span class="hs-identifier hs-var">switchTargetsToTable</span></a><span> </span><a href="#local-6989586621684660112"><span class="hs-identifier hs-var">targets</span></a><span>
</span><a name="line-3000"></a><span>    </span><a name="local-6989586621684660115"><a href="#local-6989586621684660115"><span class="hs-identifier">ids</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="X86.Instr.html#DestBlockId"><span class="hs-identifier hs-var">DestBlockId</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660114"><span class="hs-identifier hs-var">blockIds</span></a><span>
</span><a name="line-3001"></a><span>
</span><a name="line-3002"></a><span class="hs-identifier">generateJumpTableForInstr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Instruction.html#NatCmmDecl"><span class="hs-identifier hs-type">NatCmmDecl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Alignment</span><span class="hs-special">,</span><span> </span><a href="Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a><span class="hs-special">)</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-3003"></a><a name="generateJumpTableForInstr"><a href="X86.CodeGen.html#generateJumpTableForInstr"><span class="hs-identifier">generateJumpTableForInstr</span></a></a><span> </span><a name="local-6989586621684660133"><a href="#local-6989586621684660133"><span class="hs-identifier">dflags</span></a></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#JMP_TBL"><span class="hs-identifier hs-var">JMP_TBL</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684660134"><a href="#local-6989586621684660134"><span class="hs-identifier">ids</span></a></a><span> </span><a name="local-6989586621684660135"><a href="#local-6989586621684660135"><span class="hs-identifier">section</span></a></a><span> </span><a name="local-6989586621684660136"><a href="#local-6989586621684660136"><span class="hs-identifier">lbl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3004"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660137"><a href="#local-6989586621684660137"><span class="hs-identifier">getBlockId</span></a></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#DestBlockId"><span class="hs-identifier hs-var">DestBlockId</span></a><span> </span><a name="local-6989586621684660139"><a href="#local-6989586621684660139"><span class="hs-identifier">id</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660139"><span class="hs-identifier hs-var">id</span></a><span>
</span><a name="line-3005"></a><span>          </span><span class="hs-identifier">getBlockId</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;Non-Label target in Jump Table&quot;</span><span>
</span><a name="line-3006"></a><span>          </span><a name="local-6989586621684660138"><a href="#local-6989586621684660138"><span class="hs-identifier">blockIds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="#local-6989586621684660137"><span class="hs-identifier hs-var">getBlockId</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660134"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-3007"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#createJumpTable"><span class="hs-identifier hs-var">createJumpTable</span></a><span> </span><a href="#local-6989586621684660133"><span class="hs-identifier hs-var">dflags</span></a><span> </span><a href="#local-6989586621684660138"><span class="hs-identifier hs-var">blockIds</span></a><span> </span><a href="#local-6989586621684660135"><span class="hs-identifier hs-var">section</span></a><span> </span><a href="#local-6989586621684660136"><span class="hs-identifier hs-var">lbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-3008"></a><span class="hs-identifier">generateJumpTableForInstr</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-3009"></a><span>
</span><a name="line-3010"></a><span class="hs-identifier">createJumpTable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DynFlags</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="BlockId.html#BlockId"><span class="hs-identifier hs-type">BlockId</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cmm.html#Section"><span class="hs-identifier hs-type">Section</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CLabel.html#CLabel"><span class="hs-identifier hs-type">CLabel</span></a><span>
</span><a name="line-3011"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Cmm.html#GenCmmDecl"><span class="hs-identifier hs-type">GenCmmDecl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Alignment</span><span class="hs-special">,</span><span> </span><a href="Cmm.html#CmmStatics"><span class="hs-identifier hs-type">CmmStatics</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684658698"><span class="hs-identifier hs-type">h</span></a><span> </span><a href="#local-6989586621684658699"><span class="hs-identifier hs-type">g</span></a><span>
</span><a name="line-3012"></a><a name="createJumpTable"><a href="X86.CodeGen.html#createJumpTable"><span class="hs-identifier">createJumpTable</span></a></a><span> </span><a name="local-6989586621684660140"><a href="#local-6989586621684660140"><span class="hs-identifier">dflags</span></a></a><span> </span><a name="local-6989586621684660141"><a href="#local-6989586621684660141"><span class="hs-identifier">ids</span></a></a><span> </span><a name="local-6989586621684660142"><a href="#local-6989586621684660142"><span class="hs-identifier">section</span></a></a><span> </span><a name="local-6989586621684660143"><a href="#local-6989586621684660143"><span class="hs-identifier">lbl</span></a></a><span>
</span><a name="line-3013"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660144"><a href="#local-6989586621684660144"><span class="hs-identifier">jumpTable</span></a></a><span>
</span><a name="line-3014"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">positionIndependent</span><span> </span><a href="#local-6989586621684660140"><span class="hs-identifier hs-var">dflags</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3015"></a><span>                  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660145"><a href="#local-6989586621684660145"><span class="hs-identifier">ww</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">wordWidth</span><span> </span><a href="#local-6989586621684660140"><span class="hs-identifier hs-var">dflags</span></a><span>
</span><a name="line-3016"></a><span>                      </span><a name="local-6989586621684660146"><a href="#local-6989586621684660146"><span class="hs-identifier">jumpTableEntryRel</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-3017"></a><span>                          </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621684660145"><span class="hs-identifier hs-var">ww</span></a><span class="hs-special">)</span><span>
</span><a name="line-3018"></a><span>                      </span><span class="hs-identifier">jumpTableEntryRel</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684660147"><a href="#local-6989586621684660147"><span class="hs-identifier">blockid</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3019"></a><span>                          </span><span class="hs-glyph">=</span><span> </span><a href="Cmm.html#CmmStaticLit"><span class="hs-identifier hs-var">CmmStaticLit</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLabelDiffOff"><span class="hs-identifier hs-var">CmmLabelDiffOff</span></a><span> </span><a href="#local-6989586621684660148"><span class="hs-identifier hs-var">blockLabel</span></a><span> </span><a href="#local-6989586621684660143"><span class="hs-identifier hs-var">lbl</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621684660145"><span class="hs-identifier hs-var">ww</span></a><span class="hs-special">)</span><span>
</span><a name="line-3020"></a><span>                          </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684660148"><a href="#local-6989586621684660148"><span class="hs-identifier">blockLabel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BlockId.html#blockLbl"><span class="hs-identifier hs-var">blockLbl</span></a><span> </span><a href="#local-6989586621684660147"><span class="hs-identifier hs-var">blockid</span></a><span>
</span><a name="line-3021"></a><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621684660146"><span class="hs-identifier hs-var">jumpTableEntryRel</span></a><span> </span><a href="#local-6989586621684660141"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-3022"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#jumpTableEntry"><span class="hs-identifier hs-var">jumpTableEntry</span></a><span> </span><a href="#local-6989586621684660140"><span class="hs-identifier hs-var">dflags</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660141"><span class="hs-identifier hs-var">ids</span></a><span>
</span><a name="line-3023"></a><span>      </span><span class="hs-keyword">in</span><span> </span><a href="Cmm.html#CmmData"><span class="hs-identifier hs-var">CmmData</span></a><span> </span><a href="#local-6989586621684660142"><span class="hs-identifier hs-var">section</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="Cmm.html#Statics"><span class="hs-identifier hs-var">Statics</span></a><span> </span><a href="#local-6989586621684660143"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621684660144"><span class="hs-identifier hs-var">jumpTable</span></a><span class="hs-special">)</span><span>
</span><a name="line-3024"></a><span>
</span><a name="line-3025"></a><span class="hs-identifier">extractUnwindPoints</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Debug.html#UnwindPoint"><span class="hs-identifier hs-type">UnwindPoint</span></a><span class="hs-special">]</span><span>
</span><a name="line-3026"></a><a name="extractUnwindPoints"><a href="X86.CodeGen.html#extractUnwindPoints"><span class="hs-identifier">extractUnwindPoints</span></a></a><span> </span><a name="local-6989586621684660149"><a href="#local-6989586621684660149"><span class="hs-identifier">instrs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3027"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="Debug.html#UnwindPoint"><span class="hs-identifier hs-var">UnwindPoint</span></a><span> </span><a href="#local-6989586621684660150"><span class="hs-identifier hs-var">lbl</span></a><span> </span><a href="#local-6989586621684660151"><span class="hs-identifier hs-var">unwinds</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="X86.Instr.html#UNWIND"><span class="hs-identifier hs-var">UNWIND</span></a><span> </span><a name="local-6989586621684660150"><a href="#local-6989586621684660150"><span class="hs-identifier">lbl</span></a></a><span> </span><a name="local-6989586621684660151"><a href="#local-6989586621684660151"><span class="hs-identifier">unwinds</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684660149"><span class="hs-identifier hs-var">instrs</span></a><span class="hs-special">]</span><span>
</span><a name="line-3028"></a><span>
</span><a name="line-3029"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-3030"></a><span class="hs-comment">-- 'condIntReg' and 'condFltReg': condition codes into registers</span><span>
</span><a name="line-3031"></a><span>
</span><a name="line-3032"></a><span class="hs-comment">-- Turn those condition codes into integers now (when they appear on</span><span>
</span><a name="line-3033"></a><span class="hs-comment">-- the right hand side of an assignment).</span><span>
</span><a name="line-3034"></a><span class="hs-comment">--</span><span>
</span><a name="line-3035"></a><span class="hs-comment">-- (If applicable) Do not fill the delay slots here; you will confuse the</span><span>
</span><a name="line-3036"></a><span class="hs-comment">-- register allocator.</span><span>
</span><a name="line-3037"></a><span>
</span><a name="line-3038"></a><span class="hs-identifier">condIntReg</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="X86.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3039"></a><span>
</span><a name="line-3040"></a><a name="condIntReg"><a href="X86.CodeGen.html#condIntReg"><span class="hs-identifier">condIntReg</span></a></a><span> </span><a name="local-6989586621684660152"><a href="#local-6989586621684660152"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684660153"><a href="#local-6989586621684660153"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684660154"><a href="#local-6989586621684660154"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3041"></a><span>  </span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684660155"><a href="#local-6989586621684660155"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684660156"><a href="#local-6989586621684660156"><span class="hs-identifier">cond_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#condIntCode"><span class="hs-identifier hs-var">condIntCode</span></a><span> </span><a href="#local-6989586621684660152"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684660153"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684660154"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-3042"></a><span>  </span><a name="local-6989586621684660157"><a href="#local-6989586621684660157"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>
</span><a name="line-3043"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-3044"></a><span>        </span><a name="local-6989586621684660158"><a href="#local-6989586621684660158"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660159"><a href="#local-6989586621684660159"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660156"><span class="hs-identifier hs-var">cond_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-3045"></a><span>                    </span><a href="X86.Instr.html#SETCC"><span class="hs-identifier hs-var">SETCC</span></a><span> </span><a href="#local-6989586621684660155"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660157"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3046"></a><span>                    </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660157"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660159"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3047"></a><span>                  </span><span class="hs-special">]</span><span>
</span><a name="line-3048"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684660158"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3049"></a><span>
</span><a name="line-3050"></a><span>
</span><a name="line-3051"></a><span class="hs-comment">-----------------------------------------------------------</span><span>
</span><a name="line-3052"></a><span class="hs-comment">---          Note [SSE Parity Checks]                   ---</span><span>
</span><a name="line-3053"></a><span class="hs-comment">-----------------------------------------------------------</span><span>
</span><a name="line-3054"></a><span>
</span><a name="line-3055"></a><span class="hs-comment">-- We have to worry about unordered operands (eg. comparisons</span><span>
</span><a name="line-3056"></a><span class="hs-comment">-- against NaN).  If the operands are unordered, the comparison</span><span>
</span><a name="line-3057"></a><span class="hs-comment">-- sets the parity flag, carry flag and zero flag.</span><span>
</span><a name="line-3058"></a><span class="hs-comment">-- All comparisons are supposed to return false for unordered</span><span>
</span><a name="line-3059"></a><span class="hs-comment">-- operands except for !=, which returns true.</span><span>
</span><a name="line-3060"></a><span class="hs-comment">--</span><span>
</span><a name="line-3061"></a><span class="hs-comment">-- Optimisation: we don't have to test the parity flag if we</span><span>
</span><a name="line-3062"></a><span class="hs-comment">-- know the test has already excluded the unordered case: eg &gt;</span><span>
</span><a name="line-3063"></a><span class="hs-comment">-- and &gt;= test for a zero carry flag, which can only occur for</span><span>
</span><a name="line-3064"></a><span class="hs-comment">-- ordered operands.</span><span>
</span><a name="line-3065"></a><span class="hs-comment">--</span><span>
</span><a name="line-3066"></a><span class="hs-comment">-- By reversing comparisons we can avoid testing the parity</span><span>
</span><a name="line-3067"></a><span class="hs-comment">-- for &lt; and &lt;= as well. If any of the arguments is an NaN we</span><span>
</span><a name="line-3068"></a><span class="hs-comment">-- return false either way. If both arguments are valid then</span><span>
</span><a name="line-3069"></a><span class="hs-comment">-- x &lt;= y  &lt;-&gt;  y &gt;= x  holds. So it's safe to swap these.</span><span>
</span><a name="line-3070"></a><span class="hs-comment">--</span><span>
</span><a name="line-3071"></a><span class="hs-comment">-- We invert the condition inside getRegister'and  getCondCode</span><span>
</span><a name="line-3072"></a><span class="hs-comment">-- which should cover all invertable cases.</span><span>
</span><a name="line-3073"></a><span class="hs-comment">-- All other functions translating FP comparisons to assembly</span><span>
</span><a name="line-3074"></a><span class="hs-comment">-- use these to two generate the comparison code.</span><span>
</span><a name="line-3075"></a><span class="hs-comment">--</span><span>
</span><a name="line-3076"></a><span class="hs-comment">-- As an example consider a simple check:</span><span>
</span><a name="line-3077"></a><span class="hs-comment">--</span><span>
</span><a name="line-3078"></a><span class="hs-comment">-- func :: Float -&gt; Float -&gt; Int</span><span>
</span><a name="line-3079"></a><span class="hs-comment">-- func x y = if x &lt; y then 1 else 0</span><span>
</span><a name="line-3080"></a><span class="hs-comment">--</span><span>
</span><a name="line-3081"></a><span class="hs-comment">-- Which in Cmm gives the floating point comparison.</span><span>
</span><a name="line-3082"></a><span class="hs-comment">--</span><span>
</span><a name="line-3083"></a><span class="hs-comment">--  if (%MO_F_Lt_W32(F1, F2)) goto c2gg; else goto c2gf;</span><span>
</span><a name="line-3084"></a><span class="hs-comment">--</span><span>
</span><a name="line-3085"></a><span class="hs-comment">-- We used to compile this to an assembly code block like this:</span><span>
</span><a name="line-3086"></a><span class="hs-comment">-- _c2gh:</span><span>
</span><a name="line-3087"></a><span class="hs-comment">--  ucomiss %xmm2,%xmm1</span><span>
</span><a name="line-3088"></a><span class="hs-comment">--  jp _c2gf</span><span>
</span><a name="line-3089"></a><span class="hs-comment">--  jb _c2gg</span><span>
</span><a name="line-3090"></a><span class="hs-comment">--  jmp _c2gf</span><span>
</span><a name="line-3091"></a><span class="hs-comment">--</span><span>
</span><a name="line-3092"></a><span class="hs-comment">-- Where we have to introduce an explicit</span><span>
</span><a name="line-3093"></a><span class="hs-comment">-- check for unordered results (using jmp parity):</span><span>
</span><a name="line-3094"></a><span class="hs-comment">--</span><span>
</span><a name="line-3095"></a><span class="hs-comment">-- We can avoid this by exchanging the arguments and inverting the direction</span><span>
</span><a name="line-3096"></a><span class="hs-comment">-- of the comparison. This results in the sequence of:</span><span>
</span><a name="line-3097"></a><span class="hs-comment">--</span><span>
</span><a name="line-3098"></a><span class="hs-comment">--  ucomiss %xmm1,%xmm2</span><span>
</span><a name="line-3099"></a><span class="hs-comment">--  ja _c2g2</span><span>
</span><a name="line-3100"></a><span class="hs-comment">--  jmp _c2g1</span><span>
</span><a name="line-3101"></a><span class="hs-comment">--</span><span>
</span><a name="line-3102"></a><span class="hs-comment">-- Removing the jump reduces the pressure on the branch predidiction system</span><span>
</span><a name="line-3103"></a><span class="hs-comment">-- and plays better with the uOP cache.</span><span>
</span><a name="line-3104"></a><span>
</span><a name="line-3105"></a><span class="hs-identifier">condFltReg</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Cond.html#Cond"><span class="hs-identifier hs-type">Cond</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3106"></a><a name="condFltReg"><a href="X86.CodeGen.html#condFltReg"><span class="hs-identifier">condFltReg</span></a></a><span> </span><a name="local-6989586621684660160"><a href="#local-6989586621684660160"><span class="hs-identifier">is32Bit</span></a></a><span> </span><a name="local-6989586621684660161"><a href="#local-6989586621684660161"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684660162"><a href="#local-6989586621684660162"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684660163"><a href="#local-6989586621684660163"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#if_sse2"><span class="hs-identifier hs-var">if_sse2</span></a><span> </span><a href="#local-6989586621684660165"><span class="hs-identifier hs-var">condFltReg_sse2</span></a><span> </span><a href="#local-6989586621684660164"><span class="hs-identifier hs-var">condFltReg_x87</span></a><span>
</span><a name="line-3107"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3108"></a><span>  </span><a name="local-6989586621684660164"><a href="#local-6989586621684660164"><span class="hs-identifier">condFltReg_x87</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3109"></a><span>    </span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684660166"><a href="#local-6989586621684660166"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684660167"><a href="#local-6989586621684660167"><span class="hs-identifier">cond_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="#local-6989586621684660161"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684660162"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684660163"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-3110"></a><span>    </span><a name="local-6989586621684660168"><a href="#local-6989586621684660168"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>
</span><a name="line-3111"></a><span>    </span><span class="hs-keyword">let</span><span>
</span><a name="line-3112"></a><span>        </span><a name="local-6989586621684660169"><a href="#local-6989586621684660169"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660170"><a href="#local-6989586621684660170"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660167"><span class="hs-identifier hs-var">cond_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-3113"></a><span>                    </span><a href="X86.Instr.html#SETCC"><span class="hs-identifier hs-var">SETCC</span></a><span> </span><a href="#local-6989586621684660166"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660168"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3114"></a><span>                    </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660168"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660170"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3115"></a><span>                  </span><span class="hs-special">]</span><span>
</span><a name="line-3116"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684660169"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3117"></a><span>
</span><a name="line-3118"></a><span>  </span><a name="local-6989586621684660165"><a href="#local-6989586621684660165"><span class="hs-identifier">condFltReg_sse2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3119"></a><span>    </span><a href="X86.CodeGen.html#CondCode"><span class="hs-identifier hs-var">CondCode</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684660171"><a href="#local-6989586621684660171"><span class="hs-identifier">cond</span></a></a><span> </span><a name="local-6989586621684660172"><a href="#local-6989586621684660172"><span class="hs-identifier">cond_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#condFltCode"><span class="hs-identifier hs-var">condFltCode</span></a><span> </span><a href="#local-6989586621684660161"><span class="hs-identifier hs-var">cond</span></a><span> </span><a href="#local-6989586621684660162"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684660163"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-3120"></a><span>    </span><a name="local-6989586621684660173"><a href="#local-6989586621684660173"><span class="hs-identifier">tmp1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><a href="#local-6989586621684660160"><span class="hs-identifier hs-var">is32Bit</span></a><span class="hs-special">)</span><span>
</span><a name="line-3121"></a><span>    </span><a name="local-6989586621684660174"><a href="#local-6989586621684660174"><span class="hs-identifier">tmp2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#archWordFormat"><span class="hs-identifier hs-var">archWordFormat</span></a><span> </span><a href="#local-6989586621684660160"><span class="hs-identifier hs-var">is32Bit</span></a><span class="hs-special">)</span><span>
</span><a name="line-3122"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- See Note [SSE Parity Checks]</span><span>
</span><a name="line-3123"></a><span>        </span><a name="local-6989586621684660175"><a href="#local-6989586621684660175"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660179"><a href="#local-6989586621684660179"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3124"></a><span>           </span><a href="#local-6989586621684660172"><span class="hs-identifier hs-var">cond_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-3125"></a><span>             </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684660171"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-3126"></a><span>                </span><a href="X86.Cond.html#NE"><span class="hs-identifier hs-var">NE</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660177"><span class="hs-identifier hs-var">or_unordered</span></a><span> </span><a href="#local-6989586621684660179"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3127"></a><span>                </span><a href="X86.Cond.html#GU"><span class="hs-identifier hs-var">GU</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660176"><span class="hs-identifier hs-var">plain_test</span></a><span>   </span><a href="#local-6989586621684660179"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3128"></a><span>                </span><a href="X86.Cond.html#GEU"><span class="hs-identifier hs-var">GEU</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660176"><span class="hs-identifier hs-var">plain_test</span></a><span>   </span><a href="#local-6989586621684660179"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3129"></a><span>                </span><span class="hs-comment">-- Use ASSERT so we don't break releases if these creep in.</span><span>
</span><a name="line-3130"></a><span>                </span><a href="X86.Cond.html#LTT"><span class="hs-identifier hs-var">LTT</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span class="hs-identifier">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-string">&quot;Should have been turned into &gt;&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-3131"></a><span>                       </span><a href="#local-6989586621684660178"><span class="hs-identifier hs-var">and_ordered</span></a><span>  </span><a href="#local-6989586621684660179"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3132"></a><span>                </span><a href="X86.Cond.html#LE"><span class="hs-identifier hs-var">LE</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span class="hs-identifier">False</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-string">&quot;Should have been turned into &gt;=&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-3133"></a><span>                       </span><a href="#local-6989586621684660178"><span class="hs-identifier hs-var">and_ordered</span></a><span>  </span><a href="#local-6989586621684660179"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3134"></a><span>                </span><span class="hs-identifier">_</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660178"><span class="hs-identifier hs-var">and_ordered</span></a><span>  </span><a href="#local-6989586621684660179"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3135"></a><span>
</span><a name="line-3136"></a><span>        </span><a name="local-6989586621684660176"><a href="#local-6989586621684660176"><span class="hs-identifier">plain_test</span></a></a><span> </span><a name="local-6989586621684660180"><a href="#local-6989586621684660180"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-3137"></a><span>                    </span><a href="X86.Instr.html#SETCC"><span class="hs-identifier hs-var">SETCC</span></a><span> </span><a href="#local-6989586621684660171"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660173"><span class="hs-identifier hs-var">tmp1</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3138"></a><span>                    </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660173"><span class="hs-identifier hs-var">tmp1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660180"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3139"></a><span>                 </span><span class="hs-special">]</span><span>
</span><a name="line-3140"></a><span>        </span><a name="local-6989586621684660177"><a href="#local-6989586621684660177"><span class="hs-identifier">or_unordered</span></a></a><span> </span><a name="local-6989586621684660181"><a href="#local-6989586621684660181"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-3141"></a><span>                    </span><a href="X86.Instr.html#SETCC"><span class="hs-identifier hs-var">SETCC</span></a><span> </span><a href="#local-6989586621684660171"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660173"><span class="hs-identifier hs-var">tmp1</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3142"></a><span>                    </span><a href="X86.Instr.html#SETCC"><span class="hs-identifier hs-var">SETCC</span></a><span> </span><a href="X86.Cond.html#PARITY"><span class="hs-identifier hs-var">PARITY</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660174"><span class="hs-identifier hs-var">tmp2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3143"></a><span>                    </span><a href="X86.Instr.html#OR"><span class="hs-identifier hs-var">OR</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660173"><span class="hs-identifier hs-var">tmp1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660174"><span class="hs-identifier hs-var">tmp2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3144"></a><span>                    </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660174"><span class="hs-identifier hs-var">tmp2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660181"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3145"></a><span>                  </span><span class="hs-special">]</span><span>
</span><a name="line-3146"></a><span>        </span><a name="local-6989586621684660178"><a href="#local-6989586621684660178"><span class="hs-identifier">and_ordered</span></a></a><span> </span><a name="local-6989586621684660182"><a href="#local-6989586621684660182"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-3147"></a><span>                    </span><a href="X86.Instr.html#SETCC"><span class="hs-identifier hs-var">SETCC</span></a><span> </span><a href="#local-6989586621684660171"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660173"><span class="hs-identifier hs-var">tmp1</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3148"></a><span>                    </span><a href="X86.Instr.html#SETCC"><span class="hs-identifier hs-var">SETCC</span></a><span> </span><a href="X86.Cond.html#NOTPARITY"><span class="hs-identifier hs-var">NOTPARITY</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660174"><span class="hs-identifier hs-var">tmp2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3149"></a><span>                    </span><a href="X86.Instr.html#AND"><span class="hs-identifier hs-var">AND</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660173"><span class="hs-identifier hs-var">tmp1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660174"><span class="hs-identifier hs-var">tmp2</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3150"></a><span>                    </span><a href="X86.Instr.html#MOVZxL"><span class="hs-identifier hs-var">MOVZxL</span></a><span> </span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660174"><span class="hs-identifier hs-var">tmp2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660182"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3151"></a><span>                  </span><span class="hs-special">]</span><span>
</span><a name="line-3152"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><a href="#local-6989586621684660175"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3153"></a><span>
</span><a name="line-3154"></a><span>
</span><a name="line-3155"></a><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><a name="line-3156"></a><span class="hs-comment">-- 'trivial*Code': deal with trivial instructions</span><span>
</span><a name="line-3157"></a><span>
</span><a name="line-3158"></a><span class="hs-comment">-- Trivial (dyadic: 'trivialCode', floating-point: 'trivialFCode',</span><span>
</span><a name="line-3159"></a><span class="hs-comment">-- unary: 'trivialUCode', unary fl-pt:'trivialUFCode') instructions.</span><span>
</span><a name="line-3160"></a><span class="hs-comment">-- Only look for constants on the right hand side, because that's</span><span>
</span><a name="line-3161"></a><span class="hs-comment">-- where the generic optimizer will have put them.</span><span>
</span><a name="line-3162"></a><span>
</span><a name="line-3163"></a><span class="hs-comment">-- Similarly, for unary instructions, we don't have to worry about</span><span>
</span><a name="line-3164"></a><span class="hs-comment">-- matching an StInt as the argument, because genericOpt will already</span><span>
</span><a name="line-3165"></a><span class="hs-comment">-- have handled the constant-folding.</span><span>
</span><a name="line-3166"></a><span>
</span><a name="line-3167"></a><span>
</span><a name="line-3168"></a><span class="hs-comment">{-
The Rules of the Game are:

* You cannot assume anything about the destination register dst;
  it may be anything, including a fixed reg.

* You may compute an operand into a fixed reg, but you may not
  subsequently change the contents of that fixed reg.  If you
  want to do so, first copy the value either to a temporary
  or into dst.  You are free to modify dst even if it happens
  to be a fixed reg -- that's not your problem.

* You cannot assume that a fixed reg will stay live over an
  arbitrary computation.  The same applies to the dst reg.

* Temporary regs obtained from getNewRegNat are distinct from
  each other and from all other regs, and stay live over
  arbitrary computations.

--------------------

SDM's version of The Rules:

* If getRegister returns Any, that means it can generate correct
  code which places the result in any register, period.  Even if that
  register happens to be read during the computation.

  Corollary #1: this means that if you are generating code for an
  operation with two arbitrary operands, you cannot assign the result
  of the first operand into the destination register before computing
  the second operand.  The second operand might require the old value
  of the destination register.

  Corollary #2: A function might be able to generate more efficient
  code if it knows the destination register is a new temporary (and
  therefore not read by any of the sub-computations).

* If getRegister returns Any, then the code it generates may modify only:
        (a) fresh temporaries
        (b) the destination register
        (c) known registers (eg. %ecx is used by shifts)
  In particular, it may *not* modify global registers, unless the global
  register happens to be the destination register.
-}</span><span>
</span><a name="line-3212"></a><span>
</span><a name="line-3213"></a><span class="hs-identifier">trivialCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-3214"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-3215"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3216"></a><a name="trivialCode"><a href="X86.CodeGen.html#trivialCode"><span class="hs-identifier">trivialCode</span></a></a><span> </span><a name="local-6989586621684660183"><a href="#local-6989586621684660183"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684660184"><a href="#local-6989586621684660184"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684660185"><a href="#local-6989586621684660185"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621684660186"><a href="#local-6989586621684660186"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621684660187"><a href="#local-6989586621684660187"><span class="hs-identifier">b</span></a></a><span>
</span><a name="line-3217"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621684660188"><a href="#local-6989586621684660188"><span class="hs-identifier">is32Bit</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#is32BitPlatform"><span class="hs-identifier hs-var">is32BitPlatform</span></a><span>
</span><a name="line-3218"></a><span>         </span><a href="X86.CodeGen.html#trivialCode%27"><span class="hs-identifier hs-var">trivialCode'</span></a><span> </span><a href="#local-6989586621684660188"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684660183"><span class="hs-identifier hs-var">width</span></a><span> </span><a href="#local-6989586621684660184"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684660185"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621684660186"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621684660187"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-3219"></a><span>
</span><a name="line-3220"></a><span class="hs-identifier">trivialCode'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-3221"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-3222"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3223"></a><a name="trivialCode%27"><a href="X86.CodeGen.html#trivialCode%27"><span class="hs-identifier">trivialCode'</span></a></a><span> </span><a name="local-6989586621684660189"><a href="#local-6989586621684660189"><span class="hs-identifier">is32Bit</span></a></a><span> </span><a name="local-6989586621684660190"><a href="#local-6989586621684660190"><span class="hs-identifier">width</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684660191"><a href="#local-6989586621684660191"><span class="hs-identifier">revinstr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmLit"><span class="hs-identifier hs-var">CmmLit</span></a><span> </span><a name="local-6989586621684660192"><a href="#local-6989586621684660192"><span class="hs-identifier">lit_a</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621684660193"><a href="#local-6989586621684660193"><span class="hs-identifier">b</span></a></a><span>
</span><a name="line-3224"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="X86.CodeGen.html#is32BitLit"><span class="hs-identifier hs-var">is32BitLit</span></a><span> </span><a href="#local-6989586621684660189"><span class="hs-identifier hs-var">is32Bit</span></a><span> </span><a href="#local-6989586621684660192"><span class="hs-identifier hs-var">lit_a</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3225"></a><span>  </span><a name="local-6989586621684660194"><a href="#local-6989586621684660194"><span class="hs-identifier">b_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684660193"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-3226"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-3227"></a><span>       </span><a name="local-6989586621684660195"><a href="#local-6989586621684660195"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660196"><a href="#local-6989586621684660196"><span class="hs-identifier">dst</span></a></a><span>
</span><a name="line-3228"></a><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660194"><span class="hs-identifier hs-var">b_code</span></a><span> </span><a href="#local-6989586621684660196"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-3229"></a><span>           </span><a href="#local-6989586621684660191"><span class="hs-identifier hs-var">revinstr</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpImm"><span class="hs-identifier hs-var">OpImm</span></a><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#litToImm"><span class="hs-identifier hs-var">litToImm</span></a><span> </span><a href="#local-6989586621684660192"><span class="hs-identifier hs-var">lit_a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660196"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3230"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684660190"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660195"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3231"></a><span>
</span><a name="line-3232"></a><span class="hs-identifier">trivialCode'</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684660197"><a href="#local-6989586621684660197"><span class="hs-identifier">width</span></a></a><span> </span><a name="local-6989586621684660198"><a href="#local-6989586621684660198"><span class="hs-identifier">instr</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621684660199"><a href="#local-6989586621684660199"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621684660200"><a href="#local-6989586621684660200"><span class="hs-identifier">b</span></a></a><span>
</span><a name="line-3233"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#genTrivialCode"><span class="hs-identifier hs-var">genTrivialCode</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684660197"><span class="hs-identifier hs-var">width</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660198"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684660199"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621684660200"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-3234"></a><span>
</span><a name="line-3235"></a><span class="hs-comment">-- This is re-used for floating pt instructions too.</span><span>
</span><a name="line-3236"></a><span class="hs-identifier">genTrivialCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-3237"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3238"></a><a name="genTrivialCode"><a href="X86.CodeGen.html#genTrivialCode"><span class="hs-identifier">genTrivialCode</span></a></a><span> </span><a name="local-6989586621684660201"><a href="#local-6989586621684660201"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684660202"><a href="#local-6989586621684660202"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684660203"><a href="#local-6989586621684660203"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621684660204"><a href="#local-6989586621684660204"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3239"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684660205"><a href="#local-6989586621684660205"><span class="hs-identifier">b_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660206"><a href="#local-6989586621684660206"><span class="hs-identifier">b_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedOperand"><span class="hs-identifier hs-var">getNonClobberedOperand</span></a><span> </span><a href="#local-6989586621684660204"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-3240"></a><span>  </span><a name="local-6989586621684660207"><a href="#local-6989586621684660207"><span class="hs-identifier">a_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684660203"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-3241"></a><span>  </span><a name="local-6989586621684660208"><a href="#local-6989586621684660208"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684660201"><span class="hs-identifier hs-var">rep</span></a><span>
</span><a name="line-3242"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-3243"></a><span>     </span><span class="hs-comment">-- We want the value of b to stay alive across the computation of a.</span><span>
</span><a name="line-3244"></a><span>     </span><span class="hs-comment">-- But, we want to calculate a straight into the destination register,</span><span>
</span><a name="line-3245"></a><span>     </span><span class="hs-comment">-- because the instruction only has two operands (dst := dst `op` src).</span><span>
</span><a name="line-3246"></a><span>     </span><span class="hs-comment">-- The troublesome case is when the result of b is in the same register</span><span>
</span><a name="line-3247"></a><span>     </span><span class="hs-comment">-- as the destination reg.  In this case, we have to save b in a</span><span>
</span><a name="line-3248"></a><span>     </span><span class="hs-comment">-- new temporary across the computation of a.</span><span>
</span><a name="line-3249"></a><span>     </span><a name="local-6989586621684660209"><a href="#local-6989586621684660209"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660210"><a href="#local-6989586621684660210"><span class="hs-identifier">dst</span></a></a><span>
</span><a name="line-3250"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684660210"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">`</span><a href="X86.CodeGen.html#regClashesWithOp"><span class="hs-identifier hs-var">regClashesWithOp</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660205"><span class="hs-identifier hs-var">b_op</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3251"></a><span>                </span><a href="#local-6989586621684660206"><span class="hs-identifier hs-var">b_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-3252"></a><span>                </span><span class="hs-identifier hs-var">unitOL</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684660201"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684660205"><span class="hs-identifier hs-var">b_op</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660208"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-3253"></a><span>                </span><a href="#local-6989586621684660207"><span class="hs-identifier hs-var">a_code</span></a><span> </span><a href="#local-6989586621684660210"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-3254"></a><span>                </span><a href="#local-6989586621684660202"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660208"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660210"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3255"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3256"></a><span>                </span><a href="#local-6989586621684660206"><span class="hs-identifier hs-var">b_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-3257"></a><span>                </span><a href="#local-6989586621684660207"><span class="hs-identifier hs-var">a_code</span></a><span> </span><a href="#local-6989586621684660210"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-3258"></a><span>                </span><a href="#local-6989586621684660202"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684660205"><span class="hs-identifier hs-var">b_op</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660210"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3259"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684660201"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684660209"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3260"></a><span>
</span><a name="line-3261"></a><span class="hs-identifier">regClashesWithOp</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3262"></a><a name="local-6989586621684660211"><a href="#local-6989586621684660211"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-special">`</span><a name="regClashesWithOp"><a href="X86.CodeGen.html#regClashesWithOp"><span class="hs-identifier">regClashesWithOp</span></a></a><span class="hs-special">`</span><span> </span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a name="local-6989586621684660212"><a href="#local-6989586621684660212"><span class="hs-identifier">reg2</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660211"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684660212"><span class="hs-identifier hs-var">reg2</span></a><span>
</span><a name="line-3263"></a><a name="local-6989586621684660213"><a href="#local-6989586621684660213"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-special">`</span><span class="hs-identifier">regClashesWithOp</span><span class="hs-special">`</span><span> </span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a name="local-6989586621684660214"><a href="#local-6989586621684660214"><span class="hs-identifier">amode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><a href="#local-6989586621684660213"><span class="hs-identifier hs-var">reg</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Regs.html#addrModeRegs"><span class="hs-identifier hs-var">addrModeRegs</span></a><span> </span><a href="#local-6989586621684660214"><span class="hs-identifier hs-var">amode</span></a><span class="hs-special">)</span><span>
</span><a name="line-3264"></a><span class="hs-identifier">_</span><span>   </span><span class="hs-special">`</span><span class="hs-identifier">regClashesWithOp</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-3265"></a><span>
</span><a name="line-3266"></a><span class="hs-comment">-----------</span><span>
</span><a name="line-3267"></a><span>
</span><a name="line-3268"></a><span class="hs-identifier">trivialUCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-3269"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3270"></a><a name="trivialUCode"><a href="X86.CodeGen.html#trivialUCode"><span class="hs-identifier">trivialUCode</span></a></a><span> </span><a name="local-6989586621684660215"><a href="#local-6989586621684660215"><span class="hs-identifier">rep</span></a></a><span> </span><a name="local-6989586621684660216"><a href="#local-6989586621684660216"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684660217"><a href="#local-6989586621684660217"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3271"></a><span>  </span><a name="local-6989586621684660218"><a href="#local-6989586621684660218"><span class="hs-identifier">x_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684660217"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3272"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-3273"></a><span>     </span><a name="local-6989586621684660219"><a href="#local-6989586621684660219"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660220"><a href="#local-6989586621684660220"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3274"></a><span>        </span><a href="#local-6989586621684660218"><span class="hs-identifier hs-var">x_code</span></a><span> </span><a href="#local-6989586621684660220"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-3275"></a><span>        </span><a href="#local-6989586621684660216"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660220"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3276"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684660215"><span class="hs-identifier hs-var">rep</span></a><span> </span><a href="#local-6989586621684660219"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3277"></a><span>
</span><a name="line-3278"></a><span class="hs-comment">-----------</span><span>
</span><a name="line-3279"></a><span>
</span><a name="line-3280"></a><span class="hs-identifier">trivialFCode_x87</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-3281"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3282"></a><a name="trivialFCode_x87"><a href="X86.CodeGen.html#trivialFCode_x87"><span class="hs-identifier">trivialFCode_x87</span></a></a><span> </span><a name="local-6989586621684660221"><a href="#local-6989586621684660221"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684660222"><a href="#local-6989586621684660222"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684660223"><a href="#local-6989586621684660223"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3283"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684660224"><a href="#local-6989586621684660224"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660225"><a href="#local-6989586621684660225"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getNonClobberedReg"><span class="hs-identifier hs-var">getNonClobberedReg</span></a><span> </span><a href="#local-6989586621684660222"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-comment">-- these work for float regs too</span><span>
</span><a name="line-3284"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684660226"><a href="#local-6989586621684660226"><span class="hs-identifier">y_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660227"><a href="#local-6989586621684660227"><span class="hs-identifier">y_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684660223"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-3285"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-3286"></a><span>     </span><a name="local-6989586621684660228"><a href="#local-6989586621684660228"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><span class="hs-comment">-- always, on x87</span><span>
</span><a name="line-3287"></a><span>     </span><a name="local-6989586621684660229"><a href="#local-6989586621684660229"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660230"><a href="#local-6989586621684660230"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3288"></a><span>        </span><a href="#local-6989586621684660225"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span>
</span><a name="line-3289"></a><span>        </span><a href="#local-6989586621684660227"><span class="hs-identifier hs-var">y_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-3290"></a><span>        </span><a href="#local-6989586621684660221"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684660228"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684660224"><span class="hs-identifier hs-var">x_reg</span></a><span> </span><a href="#local-6989586621684660226"><span class="hs-identifier hs-var">y_reg</span></a><span> </span><a href="#local-6989586621684660230"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3291"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684660228"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684660229"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3292"></a><span>
</span><a name="line-3293"></a><span class="hs-identifier">trivialFCode_sse2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Operand"><span class="hs-identifier hs-type">Operand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span>
</span><a name="line-3294"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3295"></a><a name="trivialFCode_sse2"><a href="X86.CodeGen.html#trivialFCode_sse2"><span class="hs-identifier">trivialFCode_sse2</span></a></a><span> </span><a name="local-6989586621684660231"><a href="#local-6989586621684660231"><span class="hs-identifier">pk</span></a></a><span> </span><a name="local-6989586621684660232"><a href="#local-6989586621684660232"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684660233"><a href="#local-6989586621684660233"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621684660234"><a href="#local-6989586621684660234"><span class="hs-identifier">y</span></a></a><span>
</span><a name="line-3296"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#genTrivialCode"><span class="hs-identifier hs-var">genTrivialCode</span></a><span> </span><a href="#local-6989586621684660235"><span class="hs-identifier hs-var">format</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660232"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684660235"><span class="hs-identifier hs-var">format</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660233"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621684660234"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-3297"></a><span>    </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621684660235"><a href="#local-6989586621684660235"><span class="hs-identifier">format</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684660231"><span class="hs-identifier hs-var">pk</span></a><span>
</span><a name="line-3298"></a><span>
</span><a name="line-3299"></a><span>
</span><a name="line-3300"></a><span class="hs-identifier">trivialUFCode</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Format.html#Format"><span class="hs-identifier hs-type">Format</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Reg.html#Reg"><span class="hs-identifier hs-type">Reg</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3301"></a><a name="trivialUFCode"><a href="X86.CodeGen.html#trivialUFCode"><span class="hs-identifier">trivialUFCode</span></a></a><span> </span><a name="local-6989586621684660236"><a href="#local-6989586621684660236"><span class="hs-identifier">format</span></a></a><span> </span><a name="local-6989586621684660237"><a href="#local-6989586621684660237"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621684660238"><a href="#local-6989586621684660238"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3302"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684660239"><a href="#local-6989586621684660239"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660240"><a href="#local-6989586621684660240"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684660238"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3303"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-3304"></a><span>     </span><a name="local-6989586621684660241"><a href="#local-6989586621684660241"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660242"><a href="#local-6989586621684660242"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3305"></a><span>        </span><a href="#local-6989586621684660240"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span>
</span><a name="line-3306"></a><span>        </span><a href="#local-6989586621684660237"><span class="hs-identifier hs-var">instr</span></a><span> </span><a href="#local-6989586621684660239"><span class="hs-identifier hs-var">x_reg</span></a><span> </span><a href="#local-6989586621684660242"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3307"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684660236"><span class="hs-identifier hs-var">format</span></a><span> </span><a href="#local-6989586621684660241"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3308"></a><span>
</span><a name="line-3309"></a><span>
</span><a name="line-3310"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-3311"></a><span class="hs-identifier">coerceInt2FP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3312"></a><a name="coerceInt2FP"><a href="X86.CodeGen.html#coerceInt2FP"><span class="hs-identifier">coerceInt2FP</span></a></a><span> </span><a name="local-6989586621684660243"><a href="#local-6989586621684660243"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684660244"><a href="#local-6989586621684660244"><span class="hs-identifier">to</span></a></a><span> </span><a name="local-6989586621684660245"><a href="#local-6989586621684660245"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#if_sse2"><span class="hs-identifier hs-var">if_sse2</span></a><span> </span><a href="#local-6989586621684660247"><span class="hs-identifier hs-var">coerce_sse2</span></a><span> </span><a href="#local-6989586621684660246"><span class="hs-identifier hs-var">coerce_x87</span></a><span>
</span><a name="line-3313"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3314"></a><span>   </span><a name="local-6989586621684660246"><a href="#local-6989586621684660246"><span class="hs-identifier">coerce_x87</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3315"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684660248"><a href="#local-6989586621684660248"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660249"><a href="#local-6989586621684660249"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684660245"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3316"></a><span>     </span><span class="hs-keyword">let</span><span>
</span><a name="line-3317"></a><span>           </span><a name="local-6989586621684660250"><a href="#local-6989586621684660250"><span class="hs-identifier">opc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684660244"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#GITOF"><span class="hs-identifier hs-var">GITOF</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#GITOD"><span class="hs-identifier hs-var">GITOD</span></a><span class="hs-special">;</span><span>
</span><a name="line-3318"></a><span>                             </span><a name="local-6989586621684660252"><a href="#local-6989586621684660252"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;coerceInt2FP.x87: unhandled width (&quot;</span><span>
</span><a name="line-3319"></a><span>                                         </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684660252"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-3320"></a><span>           </span><a name="local-6989586621684660251"><a href="#local-6989586621684660251"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660253"><a href="#local-6989586621684660253"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660249"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660250"><span class="hs-identifier hs-var">opc</span></a><span> </span><a href="#local-6989586621684660248"><span class="hs-identifier hs-var">x_reg</span></a><span> </span><a href="#local-6989586621684660253"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3321"></a><span>        </span><span class="hs-comment">-- ToDo: works for non-II32 reps?</span><span>
</span><a name="line-3322"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><a href="#local-6989586621684660251"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3323"></a><span>
</span><a name="line-3324"></a><span>   </span><a name="local-6989586621684660247"><a href="#local-6989586621684660247"><span class="hs-identifier">coerce_sse2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3325"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684660254"><a href="#local-6989586621684660254"><span class="hs-identifier">x_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660255"><a href="#local-6989586621684660255"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getOperand"><span class="hs-identifier hs-var">getOperand</span></a><span> </span><a href="#local-6989586621684660245"><span class="hs-identifier hs-var">x</span></a><span>  </span><span class="hs-comment">-- ToDo: could be a safe operand</span><span>
</span><a name="line-3326"></a><span>     </span><span class="hs-keyword">let</span><span>
</span><a name="line-3327"></a><span>           </span><a name="local-6989586621684660256"><a href="#local-6989586621684660256"><span class="hs-identifier">opc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684660244"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#CVTSI2SS"><span class="hs-identifier hs-var">CVTSI2SS</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#CVTSI2SD"><span class="hs-identifier hs-var">CVTSI2SD</span></a><span>
</span><a name="line-3328"></a><span>                             </span><a name="local-6989586621684660258"><a href="#local-6989586621684660258"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;coerceInt2FP.sse: unhandled width (&quot;</span><span>
</span><a name="line-3329"></a><span>                                         </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684660258"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-3330"></a><span>           </span><a name="local-6989586621684660257"><a href="#local-6989586621684660257"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660259"><a href="#local-6989586621684660259"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660255"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660256"><span class="hs-identifier hs-var">opc</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684660243"><span class="hs-identifier hs-var">from</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660254"><span class="hs-identifier hs-var">x_op</span></a><span> </span><a href="#local-6989586621684660259"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3331"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684660244"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660257"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3332"></a><span>        </span><span class="hs-comment">-- works even if the destination rep is &lt;II32</span><span>
</span><a name="line-3333"></a><span>
</span><a name="line-3334"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-3335"></a><span class="hs-identifier">coerceFP2Int</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3336"></a><a name="coerceFP2Int"><a href="X86.CodeGen.html#coerceFP2Int"><span class="hs-identifier">coerceFP2Int</span></a></a><span> </span><a name="local-6989586621684660260"><a href="#local-6989586621684660260"><span class="hs-identifier">from</span></a></a><span> </span><a name="local-6989586621684660261"><a href="#local-6989586621684660261"><span class="hs-identifier">to</span></a></a><span> </span><a name="local-6989586621684660262"><a href="#local-6989586621684660262"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#if_sse2"><span class="hs-identifier hs-var">if_sse2</span></a><span> </span><a href="#local-6989586621684660264"><span class="hs-identifier hs-var">coerceFP2Int_sse2</span></a><span> </span><a href="#local-6989586621684660263"><span class="hs-identifier hs-var">coerceFP2Int_x87</span></a><span>
</span><a name="line-3337"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-3338"></a><span>   </span><a name="local-6989586621684660263"><a href="#local-6989586621684660263"><span class="hs-identifier">coerceFP2Int_x87</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3339"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684660265"><a href="#local-6989586621684660265"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660266"><a href="#local-6989586621684660266"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684660262"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3340"></a><span>     </span><span class="hs-keyword">let</span><span>
</span><a name="line-3341"></a><span>           </span><a name="local-6989586621684660267"><a href="#local-6989586621684660267"><span class="hs-identifier">opc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684660260"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#GFTOI"><span class="hs-identifier hs-var">GFTOI</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#GDTOI"><span class="hs-identifier hs-var">GDTOI</span></a><span>
</span><a name="line-3342"></a><span>                               </span><a name="local-6989586621684660269"><a href="#local-6989586621684660269"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;coerceFP2Int.x87: unhandled width (&quot;</span><span>
</span><a name="line-3343"></a><span>                                           </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684660269"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-3344"></a><span>           </span><a name="local-6989586621684660268"><a href="#local-6989586621684660268"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660270"><a href="#local-6989586621684660270"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660266"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660267"><span class="hs-identifier hs-var">opc</span></a><span> </span><a href="#local-6989586621684660265"><span class="hs-identifier hs-var">x_reg</span></a><span> </span><a href="#local-6989586621684660270"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3345"></a><span>        </span><span class="hs-comment">-- ToDo: works for non-II32 reps?</span><span>
</span><a name="line-3346"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684660261"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660268"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3347"></a><span>
</span><a name="line-3348"></a><span>   </span><a name="local-6989586621684660264"><a href="#local-6989586621684660264"><span class="hs-identifier">coerceFP2Int_sse2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3349"></a><span>     </span><span class="hs-special">(</span><a name="local-6989586621684660271"><a href="#local-6989586621684660271"><span class="hs-identifier">x_op</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660272"><a href="#local-6989586621684660272"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getOperand"><span class="hs-identifier hs-var">getOperand</span></a><span> </span><a href="#local-6989586621684660262"><span class="hs-identifier hs-var">x</span></a><span>  </span><span class="hs-comment">-- ToDo: could be a safe operand</span><span>
</span><a name="line-3350"></a><span>     </span><span class="hs-keyword">let</span><span>
</span><a name="line-3351"></a><span>           </span><a name="local-6989586621684660273"><a href="#local-6989586621684660273"><span class="hs-identifier">opc</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684660260"><span class="hs-identifier hs-var">from</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#CVTTSS2SIQ"><span class="hs-identifier hs-var">CVTTSS2SIQ</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#CVTTSD2SIQ"><span class="hs-identifier hs-var">CVTTSD2SIQ</span></a><span class="hs-special">;</span><span>
</span><a name="line-3352"></a><span>                               </span><a name="local-6989586621684660275"><a href="#local-6989586621684660275"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;coerceFP2Init.sse: unhandled width (&quot;</span><span>
</span><a name="line-3353"></a><span>                                           </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684660275"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-3354"></a><span>           </span><a name="local-6989586621684660274"><a href="#local-6989586621684660274"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660276"><a href="#local-6989586621684660276"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660272"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660273"><span class="hs-identifier hs-var">opc</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684660261"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660271"><span class="hs-identifier hs-var">x_op</span></a><span> </span><a href="#local-6989586621684660276"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3355"></a><span>     </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><a href="Format.html#intFormat"><span class="hs-identifier hs-var">intFormat</span></a><span> </span><a href="#local-6989586621684660261"><span class="hs-identifier hs-var">to</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660274"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3356"></a><span>         </span><span class="hs-comment">-- works even if the destination rep is &lt;II32</span><span>
</span><a name="line-3357"></a><span>
</span><a name="line-3358"></a><span>
</span><a name="line-3359"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-3360"></a><span class="hs-identifier">coerceFP2FP</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3361"></a><a name="coerceFP2FP"><a href="X86.CodeGen.html#coerceFP2FP"><span class="hs-identifier">coerceFP2FP</span></a></a><span> </span><a name="local-6989586621684660277"><a href="#local-6989586621684660277"><span class="hs-identifier">to</span></a></a><span> </span><a name="local-6989586621684660278"><a href="#local-6989586621684660278"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3362"></a><span>  </span><a name="local-6989586621684660279"><a href="#local-6989586621684660279"><span class="hs-identifier">use_sse2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#sse2Enabled"><span class="hs-identifier hs-var">sse2Enabled</span></a><span>
</span><a name="line-3363"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621684660280"><a href="#local-6989586621684660280"><span class="hs-identifier">x_reg</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621684660281"><a href="#local-6989586621684660281"><span class="hs-identifier">x_code</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getSomeReg"><span class="hs-identifier hs-var">getSomeReg</span></a><span> </span><a href="#local-6989586621684660278"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3364"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-3365"></a><span>        </span><a name="local-6989586621684660282"><a href="#local-6989586621684660282"><span class="hs-identifier">opc</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621684660279"><span class="hs-identifier hs-var">use_sse2</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684660277"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-identifier hs-var">W32</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#CVTSD2SS"><span class="hs-identifier hs-var">CVTSD2SS</span></a><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">W64</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="X86.Instr.html#CVTSS2SD"><span class="hs-identifier hs-var">CVTSS2SD</span></a><span class="hs-special">;</span><span>
</span><a name="line-3366"></a><span>                                     </span><a name="local-6989586621684660284"><a href="#local-6989586621684660284"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;coerceFP2FP: unhandled width (&quot;</span><span>
</span><a name="line-3367"></a><span>                                                 </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684660284"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-3368"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="X86.Instr.html#GDTOF"><span class="hs-identifier hs-var">GDTOF</span></a><span>
</span><a name="line-3369"></a><span>        </span><a name="local-6989586621684660283"><a href="#local-6989586621684660283"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660285"><a href="#local-6989586621684660285"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660281"><span class="hs-identifier hs-var">x_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">snocOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660282"><span class="hs-identifier hs-var">opc</span></a><span> </span><a href="#local-6989586621684660280"><span class="hs-identifier hs-var">x_reg</span></a><span> </span><a href="#local-6989586621684660285"><span class="hs-identifier hs-var">dst</span></a><span>
</span><a name="line-3370"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621684660279"><span class="hs-identifier hs-var">use_sse2</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684660277"><span class="hs-identifier hs-var">to</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660283"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3371"></a><span>
</span><a name="line-3372"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-3373"></a><span>
</span><a name="line-3374"></a><span class="hs-identifier">sse2NegCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Width</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="X86.CodeGen.html#Register"><span class="hs-identifier hs-type">Register</span></a><span>
</span><a name="line-3375"></a><a name="sse2NegCode"><a href="X86.CodeGen.html#sse2NegCode"><span class="hs-identifier">sse2NegCode</span></a></a><span> </span><a name="local-6989586621684660286"><a href="#local-6989586621684660286"><span class="hs-identifier">w</span></a></a><span> </span><a name="local-6989586621684660287"><a href="#local-6989586621684660287"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-3376"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660288"><a href="#local-6989586621684660288"><span class="hs-identifier">fmt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Format.html#floatFormat"><span class="hs-identifier hs-var">floatFormat</span></a><span> </span><a href="#local-6989586621684660286"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-3377"></a><span>  </span><a name="local-6989586621684660289"><a href="#local-6989586621684660289"><span class="hs-identifier">x_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#getAnyReg"><span class="hs-identifier hs-var">getAnyReg</span></a><span> </span><a href="#local-6989586621684660287"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3378"></a><span>  </span><span class="hs-comment">-- This is how gcc does it, so it can't be that bad:</span><span>
</span><a name="line-3379"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-3380"></a><span>    </span><a name="local-6989586621684660290"><a href="#local-6989586621684660290"><span class="hs-identifier">const</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621684660288"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-3381"></a><span>      </span><a href="Format.html#FF32"><span class="hs-identifier hs-var">FF32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0x80000000</span><span> </span><span class="hs-identifier hs-var">W32</span><span>
</span><a name="line-3382"></a><span>      </span><a href="Format.html#FF64"><span class="hs-identifier hs-var">FF64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="CmmExpr.html#CmmInt"><span class="hs-identifier hs-var">CmmInt</span></a><span> </span><span class="hs-number">0x8000000000000000</span><span> </span><span class="hs-identifier hs-var">W64</span><span>
</span><a name="line-3383"></a><span>      </span><a name="local-6989586621684660293"><a href="#local-6989586621684660293"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><a href="Format.html#II8"><span class="hs-identifier hs-var">II8</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660291"><span class="hs-identifier hs-var">wrongFmt</span></a><span> </span><a href="#local-6989586621684660293"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3384"></a><span>      </span><a name="local-6989586621684660294"><a href="#local-6989586621684660294"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><a href="Format.html#II16"><span class="hs-identifier hs-var">II16</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660291"><span class="hs-identifier hs-var">wrongFmt</span></a><span> </span><a href="#local-6989586621684660294"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3385"></a><span>      </span><a name="local-6989586621684660295"><a href="#local-6989586621684660295"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><a href="Format.html#II32"><span class="hs-identifier hs-var">II32</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660291"><span class="hs-identifier hs-var">wrongFmt</span></a><span> </span><a href="#local-6989586621684660295"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3386"></a><span>      </span><a name="local-6989586621684660296"><a href="#local-6989586621684660296"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><a href="Format.html#II64"><span class="hs-identifier hs-var">II64</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660291"><span class="hs-identifier hs-var">wrongFmt</span></a><span> </span><a href="#local-6989586621684660296"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3387"></a><span>      </span><a name="local-6989586621684660297"><a href="#local-6989586621684660297"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">@</span><a href="Format.html#FF80"><span class="hs-identifier hs-var">FF80</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621684660291"><span class="hs-identifier hs-var">wrongFmt</span></a><span> </span><a href="#local-6989586621684660297"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3388"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-3389"></a><span>        </span><a name="local-6989586621684660291"><a href="#local-6989586621684660291"><span class="hs-identifier">wrongFmt</span></a></a><span> </span><a name="local-6989586621684660292"><a href="#local-6989586621684660292"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;sse2NegCode: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621684660292"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-3390"></a><span>  </span><a href="X86.CodeGen.html#Amode"><span class="hs-identifier hs-var">Amode</span></a><span> </span><a name="local-6989586621684660298"><a href="#local-6989586621684660298"><span class="hs-identifier">amode</span></a></a><span> </span><a name="local-6989586621684660299"><a href="#local-6989586621684660299"><span class="hs-identifier">amode_code</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.CodeGen.html#memConstant"><span class="hs-identifier hs-var">memConstant</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">widthInBytes</span><span> </span><a href="#local-6989586621684660286"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621684660290"><span class="hs-identifier hs-var">const</span></a><span>
</span><a name="line-3391"></a><span>  </span><a name="local-6989586621684660300"><a href="#local-6989586621684660300"><span class="hs-identifier">tmp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="NCGMonad.html#getNewRegNat"><span class="hs-identifier hs-var">getNewRegNat</span></a><span> </span><a href="#local-6989586621684660288"><span class="hs-identifier hs-var">fmt</span></a><span>
</span><a name="line-3392"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-3393"></a><span>    </span><a name="local-6989586621684660301"><a href="#local-6989586621684660301"><span class="hs-identifier">code</span></a></a><span> </span><a name="local-6989586621684660302"><a href="#local-6989586621684660302"><span class="hs-identifier">dst</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660289"><span class="hs-identifier hs-var">x_code</span></a><span> </span><a href="#local-6989586621684660302"><span class="hs-identifier hs-var">dst</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621684660299"><span class="hs-identifier hs-var">amode_code</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">appOL</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">toOL</span><span> </span><span class="hs-special">[</span><span>
</span><a name="line-3394"></a><span>        </span><a href="X86.Instr.html#MOV"><span class="hs-identifier hs-var">MOV</span></a><span> </span><a href="#local-6989586621684660288"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpAddr"><span class="hs-identifier hs-var">OpAddr</span></a><span> </span><a href="#local-6989586621684660298"><span class="hs-identifier hs-var">amode</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660300"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-3395"></a><span>        </span><a href="X86.Instr.html#XOR"><span class="hs-identifier hs-var">XOR</span></a><span> </span><a href="#local-6989586621684660288"><span class="hs-identifier hs-var">fmt</span></a><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660300"><span class="hs-identifier hs-var">tmp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="X86.Instr.html#OpReg"><span class="hs-identifier hs-var">OpReg</span></a><span> </span><a href="#local-6989586621684660302"><span class="hs-identifier hs-var">dst</span></a><span class="hs-special">)</span><span>
</span><a name="line-3396"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-3397"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-3398"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="X86.CodeGen.html#Any"><span class="hs-identifier hs-var">Any</span></a><span> </span><a href="#local-6989586621684660288"><span class="hs-identifier hs-var">fmt</span></a><span> </span><a href="#local-6989586621684660301"><span class="hs-identifier hs-var">code</span></a><span class="hs-special">)</span><span>
</span><a name="line-3399"></a><span>
</span><a name="line-3400"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CmmExpr.html#CmmExpr"><span class="hs-identifier hs-type">CmmExpr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-3401"></a><a name="isVecExpr"><a href="X86.CodeGen.html#isVecExpr"><span class="hs-identifier">isVecExpr</span></a></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_V_Insert"><span class="hs-identifier hs-var">MO_V_Insert</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3402"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_V_Extract"><span class="hs-identifier hs-var">MO_V_Extract</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3403"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_V_Add"><span class="hs-identifier hs-var">MO_V_Add</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3404"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_V_Sub"><span class="hs-identifier hs-var">MO_V_Sub</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3405"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_V_Mul"><span class="hs-identifier hs-var">MO_V_Mul</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3406"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VS_Quot"><span class="hs-identifier hs-var">MO_VS_Quot</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3407"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VS_Rem"><span class="hs-identifier hs-var">MO_VS_Rem</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3408"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VS_Neg"><span class="hs-identifier hs-var">MO_VS_Neg</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3409"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VF_Insert"><span class="hs-identifier hs-var">MO_VF_Insert</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3410"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VF_Extract"><span class="hs-identifier hs-var">MO_VF_Extract</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3411"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VF_Add"><span class="hs-identifier hs-var">MO_VF_Add</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3412"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VF_Sub"><span class="hs-identifier hs-var">MO_VF_Sub</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3413"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VF_Mul"><span class="hs-identifier hs-var">MO_VF_Mul</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3414"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VF_Quot"><span class="hs-identifier hs-var">MO_VF_Quot</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3415"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-special">(</span><a href="CmmMachOp.html#MO_VF_Neg"><span class="hs-identifier hs-var">MO_VF_Neg</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-3416"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">[</span><a name="local-6989586621684660303"><a href="#local-6989586621684660303"><span class="hs-identifier">e</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="X86.CodeGen.html#isVecExpr"><span class="hs-identifier hs-var">isVecExpr</span></a><span> </span><a href="#local-6989586621684660303"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-3417"></a><span class="hs-identifier">isVecExpr</span><span> </span><span class="hs-identifier">_</span><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-3418"></a><span>
</span><a name="line-3419"></a><span class="hs-identifier">needLlvm</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="NCGMonad.html#NatM"><span class="hs-identifier hs-type">NatM</span></a><span> </span><a href="#local-6989586621684658697"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-3420"></a><a name="needLlvm"><a href="X86.CodeGen.html#needLlvm"><span class="hs-identifier">needLlvm</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3421"></a><span>    </span><span class="hs-identifier hs-var">sorry</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unlines</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;The native code generator does not support vector&quot;</span><span>
</span><a name="line-3422"></a><span>                    </span><span class="hs-special">,</span><span class="hs-string">&quot;instructions. Please use -fllvm.&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-3423"></a><span>
</span><a name="line-3424"></a><span class="hs-comment">-- | This works on the invariant that all jumps in the given blocks are required.</span><span>
</span><a name="line-3425"></a><span class="hs-comment">--   Starting from there we try to make a few more jumps redundant by reordering</span><span>
</span><a name="line-3426"></a><span class="hs-comment">--   them.</span><span>
</span><a name="line-3427"></a><span class="hs-identifier">invertCondBranches</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="CFG.html#CFG"><span class="hs-identifier hs-type">CFG</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Hoopl.Label.html#LabelMap"><span class="hs-identifier hs-type">LabelMap</span></a><span> </span><a href="#local-6989586621684658696"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span>
</span><a name="line-3428"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span>
</span><a name="line-3429"></a><a name="invertCondBranches"><a href="X86.CodeGen.html#invertCondBranches"><span class="hs-identifier">invertCondBranches</span></a></a><span> </span><a name="local-6989586621684660304"><a href="#local-6989586621684660304"><span class="hs-identifier">cfg</span></a></a><span> </span><a name="local-6989586621684660305"><a href="#local-6989586621684660305"><span class="hs-identifier">keep</span></a></a><span> </span><a name="local-6989586621684660306"><a href="#local-6989586621684660306"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3430"></a><span>    </span><span class="hs-comment">--trace &quot;Foo&quot; $</span><span>
</span><a name="line-3431"></a><span>    </span><a href="#local-6989586621684660307"><span class="hs-identifier hs-var">invert</span></a><span> </span><a href="#local-6989586621684660306"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-3432"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-3433"></a><span>    </span><span class="hs-identifier">invert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Instruction.html#NatBasicBlock"><span class="hs-identifier hs-type">NatBasicBlock</span></a><span> </span><a href="X86.Instr.html#Instr"><span class="hs-identifier hs-type">Instr</span></a><span class="hs-special">]</span><span>
</span><a name="line-3434"></a><span>    </span><a name="local-6989586621684660307"><a href="#local-6989586621684660307"><span class="hs-identifier">invert</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a name="local-6989586621684660308"><a href="#local-6989586621684660308"><span class="hs-identifier">lbl1</span></a></a><span> </span><a name="local-6989586621684660309"><a href="#local-6989586621684660309"><span class="hs-identifier">ins</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621684660310"><a href="#local-6989586621684660310"><span class="hs-identifier">_xs</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621684660311"><a href="#local-6989586621684660311"><span class="hs-identifier">b2</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a name="local-6989586621684660312"><a href="#local-6989586621684660312"><span class="hs-identifier">lbl2</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621684660313"><a href="#local-6989586621684660313"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-3435"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">--pprTrace &quot;Block&quot; (ppr lbl1) True,</span><span>
</span><a name="line-3436"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621684660314"><a href="#local-6989586621684660314"><span class="hs-identifier">jmp1</span></a></a><span class="hs-special">,</span><a name="local-6989586621684660315"><a href="#local-6989586621684660315"><span class="hs-identifier">jmp2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">last2</span><span> </span><a href="#local-6989586621684660309"><span class="hs-identifier hs-var">ins</span></a><span>
</span><a name="line-3437"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a name="local-6989586621684660316"><a href="#local-6989586621684660316"><span class="hs-identifier">cond1</span></a></a><span> </span><a name="local-6989586621684660317"><a href="#local-6989586621684660317"><span class="hs-identifier">target1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684660314"><span class="hs-identifier hs-var">jmp1</span></a><span>
</span><a name="line-3438"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660317"><span class="hs-identifier hs-var">target1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621684660312"><span class="hs-identifier hs-var">lbl2</span></a><span>
</span><a name="line-3439"></a><span>      </span><span class="hs-comment">--, pprTrace &quot;CutChance&quot; (ppr b1) True</span><span>
</span><a name="line-3440"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="X86.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a name="local-6989586621684660318"><a href="#local-6989586621684660318"><span class="hs-identifier">target2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684660315"><span class="hs-identifier hs-var">jmp2</span></a><span>
</span><a name="line-3441"></a><span>      </span><span class="hs-comment">-- We have enough information to check if we can perform the inversion</span><span>
</span><a name="line-3442"></a><span>      </span><span class="hs-comment">-- TODO: We could also check for the last asm instruction which sets</span><span>
</span><a name="line-3443"></a><span>      </span><span class="hs-comment">-- status flags instead. Which I suspect is worse in terms of compiler</span><span>
</span><a name="line-3444"></a><span>      </span><span class="hs-comment">-- performance, but might be applicable to more cases</span><span>
</span><a name="line-3445"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684660319"><a href="#local-6989586621684660319"><span class="hs-identifier">edgeInfo1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CFG.html#getEdgeInfo"><span class="hs-identifier hs-var">getEdgeInfo</span></a><span> </span><a href="#local-6989586621684660308"><span class="hs-identifier hs-var">lbl1</span></a><span> </span><a href="#local-6989586621684660317"><span class="hs-identifier hs-var">target1</span></a><span> </span><a href="#local-6989586621684660304"><span class="hs-identifier hs-var">cfg</span></a><span>
</span><a name="line-3446"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684660320"><a href="#local-6989586621684660320"><span class="hs-identifier">edgeInfo2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CFG.html#getEdgeInfo"><span class="hs-identifier hs-var">getEdgeInfo</span></a><span> </span><a href="#local-6989586621684660308"><span class="hs-identifier hs-var">lbl1</span></a><span> </span><a href="#local-6989586621684660318"><span class="hs-identifier hs-var">target2</span></a><span> </span><a href="#local-6989586621684660304"><span class="hs-identifier hs-var">cfg</span></a><span>
</span><a name="line-3447"></a><span>      </span><span class="hs-comment">-- Both jumps come from the same cmm statement</span><span>
</span><a name="line-3448"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">transitionSource</span><span> </span><a href="#local-6989586621684660319"><span class="hs-identifier hs-var">edgeInfo1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">transitionSource</span><span> </span><a href="#local-6989586621684660320"><span class="hs-identifier hs-var">edgeInfo2</span></a><span>
</span><a name="line-3449"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="CFG.html#CmmSource"><span class="hs-identifier hs-var">CmmSource</span></a><span> </span><a name="local-6989586621684660321"><a href="#local-6989586621684660321"><span class="hs-identifier">cmmCondBranch</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">transitionSource</span><span> </span><a href="#local-6989586621684660319"><span class="hs-identifier hs-var">edgeInfo1</span></a><span>
</span><a name="line-3450"></a><span>
</span><a name="line-3451"></a><span>      </span><span class="hs-comment">--Int comparisons are invertable</span><span>
</span><a name="line-3452"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="CmmNode.html#CmmCondBranch"><span class="hs-identifier hs-var">CmmCondBranch</span></a><span> </span><span class="hs-special">(</span><a href="CmmExpr.html#CmmMachOp"><span class="hs-identifier hs-var">CmmMachOp</span></a><span> </span><a name="local-6989586621684660322"><a href="#local-6989586621684660322"><span class="hs-identifier">op</span></a></a><span> </span><a name="local-6989586621684660323"><a href="#local-6989586621684660323"><span class="hs-identifier">_args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621684660321"><span class="hs-identifier hs-var">cmmCondBranch</span></a><span>
</span><a name="line-3453"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="CmmMachOp.html#maybeIntComparison"><span class="hs-identifier hs-var">maybeIntComparison</span></a><span> </span><a href="#local-6989586621684660322"><span class="hs-identifier hs-var">op</span></a><span>
</span><a name="line-3454"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621684660324"><a href="#local-6989586621684660324"><span class="hs-identifier">invCond</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="X86.Cond.html#maybeInvertCond"><span class="hs-identifier hs-var">maybeInvertCond</span></a><span> </span><a href="#local-6989586621684660316"><span class="hs-identifier hs-var">cond1</span></a><span>
</span><a name="line-3455"></a><span>
</span><a name="line-3456"></a><span>      </span><span class="hs-comment">--Swap the last two jumps, invert the conditional jumps condition.</span><span>
</span><a name="line-3457"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621684660325"><a href="#local-6989586621684660325"><span class="hs-identifier">jumps</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-3458"></a><span>              </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-3459"></a><span>                </span><span class="hs-comment">-- We are free the eliminate the jmp. So we do so.</span><span>
</span><a name="line-3460"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Hoopl.Collections.html#mapMember"><span class="hs-identifier hs-var">mapMember</span></a><span> </span><a href="#local-6989586621684660317"><span class="hs-identifier hs-var">target1</span></a><span> </span><a href="#local-6989586621684660305"><span class="hs-identifier hs-var">keep</span></a><span class="hs-special">)</span><span>
</span><a name="line-3461"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="#local-6989586621684660324"><span class="hs-identifier hs-var">invCond</span></a><span> </span><a href="#local-6989586621684660318"><span class="hs-identifier hs-var">target2</span></a><span class="hs-special">]</span><span>
</span><a name="line-3462"></a><span>                </span><span class="hs-comment">-- If the conditional target is unlikely we put the other</span><span>
</span><a name="line-3463"></a><span>                </span><span class="hs-comment">-- target at the front.</span><span>
</span><a name="line-3464"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">edgeWeight</span><span> </span><a href="#local-6989586621684660320"><span class="hs-identifier hs-var">edgeInfo2</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-identifier">edgeWeight</span><span> </span><a href="#local-6989586621684660319"><span class="hs-identifier hs-var">edgeInfo1</span></a><span>
</span><a name="line-3465"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="#local-6989586621684660324"><span class="hs-identifier hs-var">invCond</span></a><span> </span><a href="#local-6989586621684660318"><span class="hs-identifier hs-var">target2</span></a><span class="hs-special">,</span><span> </span><a href="X86.Instr.html#JXX"><span class="hs-identifier hs-var">JXX</span></a><span> </span><a href="X86.Cond.html#ALWAYS"><span class="hs-identifier hs-var">ALWAYS</span></a><span> </span><a href="#local-6989586621684660317"><span class="hs-identifier hs-var">target1</span></a><span class="hs-special">]</span><span>
</span><a name="line-3466"></a><span>                </span><span class="hs-comment">-- Keep things as-is otherwise</span><span>
</span><a name="line-3467"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-3468"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621684660314"><span class="hs-identifier hs-var">jmp1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621684660315"><span class="hs-identifier hs-var">jmp2</span></a><span class="hs-special">]</span><span>
</span><a name="line-3469"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">--pprTrace &quot;Cutable&quot; (ppr [jmp1,jmp2] &lt;+&gt; text &quot;=&gt;&quot; &lt;+&gt; ppr jumps) $</span><span>
</span><a name="line-3470"></a><span>           </span><span class="hs-special">(</span><a href="Cmm.html#BasicBlock"><span class="hs-identifier hs-var">BasicBlock</span></a><span> </span><a href="#local-6989586621684660308"><span class="hs-identifier hs-var">lbl1</span></a><span>
</span><a name="line-3471"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">dropTail</span><span> </span><span class="hs-number">2</span><span> </span><a href="#local-6989586621684660309"><span class="hs-identifier hs-var">ins</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621684660325"><span class="hs-identifier hs-var">jumps</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-3472"></a><span>            </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684660307"><span class="hs-identifier hs-var">invert</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621684660311"><span class="hs-identifier hs-var">b2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621684660313"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-3473"></a><span>    </span><span class="hs-identifier">invert</span><span> </span><span class="hs-special">(</span><a name="local-6989586621684660326"><a href="#local-6989586621684660326"><span class="hs-identifier">b</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621684660327"><a href="#local-6989586621684660327"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621684660326"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621684660307"><span class="hs-identifier hs-var">invert</span></a><span> </span><a href="#local-6989586621684660327"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-3474"></a><span>    </span><span class="hs-identifier">invert</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-3475"></a></pre></body></html>