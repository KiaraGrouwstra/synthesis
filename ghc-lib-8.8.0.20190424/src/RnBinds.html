<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables, BangPatterns #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-comment">{-
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

\section[RnBinds]{Renaming and dependency analysis of bindings}

This module does renaming and dependency analysis on value bindings in
the abstract syntax.  It does {\em not} do cycle-checks on class or
type-synonym declarations; those cannot be done at this stage because
they may be affected by renaming (which isn't fully worked out yet).
-}</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">RnBinds</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-16"></a><span>   </span><span class="hs-comment">-- Renaming top-level bindings</span><span>
</span><a name="line-17"></a><span>   </span><a href="RnBinds.html#rnTopBindsLHS"><span class="hs-identifier hs-var">rnTopBindsLHS</span></a><span class="hs-special">,</span><span> </span><a href="RnBinds.html#rnTopBindsBoot"><span class="hs-identifier hs-var">rnTopBindsBoot</span></a><span class="hs-special">,</span><span> </span><a href="RnBinds.html#rnValBindsRHS"><span class="hs-identifier hs-var">rnValBindsRHS</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span>   </span><span class="hs-comment">-- Renaming local bindings</span><span>
</span><a name="line-20"></a><span>   </span><a href="RnBinds.html#rnLocalBindsAndThen"><span class="hs-identifier hs-var">rnLocalBindsAndThen</span></a><span class="hs-special">,</span><span> </span><a href="RnBinds.html#rnLocalValBindsLHS"><span class="hs-identifier hs-var">rnLocalValBindsLHS</span></a><span class="hs-special">,</span><span> </span><a href="RnBinds.html#rnLocalValBindsRHS"><span class="hs-identifier hs-var">rnLocalValBindsRHS</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>   </span><span class="hs-comment">-- Other bindings</span><span>
</span><a name="line-23"></a><span>   </span><a href="RnBinds.html#rnMethodBinds"><span class="hs-identifier hs-var">rnMethodBinds</span></a><span class="hs-special">,</span><span> </span><a href="RnBinds.html#renameSigs"><span class="hs-identifier hs-var">renameSigs</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>   </span><a href="RnBinds.html#rnMatchGroup"><span class="hs-identifier hs-var">rnMatchGroup</span></a><span class="hs-special">,</span><span> </span><a href="RnBinds.html#rnGRHSs"><span class="hs-identifier hs-var">rnGRHSs</span></a><span class="hs-special">,</span><span> </span><a href="RnBinds.html#rnGRHS"><span class="hs-identifier hs-var">rnGRHS</span></a><span class="hs-special">,</span><span> </span><a href="RnBinds.html#rnSrcFixityDecl"><span class="hs-identifier hs-var">rnSrcFixityDecl</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>   </span><a href="RnBinds.html#makeMiniFixityEnv"><span class="hs-identifier hs-var">makeMiniFixityEnv</span></a><span class="hs-special">,</span><span> </span><a href="RnFixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>   </span><a href="RnEnv.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GhcPrelude</span><span>
</span><a name="line-30"></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><a href="RnExpr.html"><span class="hs-identifier">RnExpr</span></a><span class="hs-special">(</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span class="hs-special">,</span><span> </span><a href="RnExpr.html#rnStmts"><span class="hs-identifier hs-var">rnStmts</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">HsSyn</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="TcRnMonad.html"><span class="hs-identifier">TcRnMonad</span></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="RnTypes.html"><span class="hs-identifier">RnTypes</span></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="RnPat.html"><span class="hs-identifier">RnPat</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="RnNames.html"><span class="hs-identifier">RnNames</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="RnEnv.html"><span class="hs-identifier">RnEnv</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="RnFixity.html"><span class="hs-identifier">RnFixity</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="RnUtils.html"><span class="hs-identifier">RnUtils</span></a><span>          </span><span class="hs-special">(</span><span> </span><a href="RnUtils.html#HsDocContext"><span class="hs-identifier hs-type">HsDocContext</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#extendTyVarEnvFVRn"><span class="hs-identifier hs-var">extendTyVarEnvFVRn</span></a><span>
</span><a name="line-41"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#warnUnusedLocalBinds"><span class="hs-identifier hs-var">warnUnusedLocalBinds</span></a><span>
</span><a name="line-42"></a><span>                        </span><span class="hs-special">,</span><span> </span><a href="RnUtils.html#checkDupAndShadowedNames"><span class="hs-identifier hs-var">checkDupAndShadowedNames</span></a><span class="hs-special">,</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">DynFlags</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Module</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Name</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">NameEnv</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">NameSet</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">RdrName</span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">rdrNameOcc</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">SrcLoc</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">ListSetOps</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">findDupsEq</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">BasicTypes</span><span>       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">RecFlag</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Digraph</span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">SCC</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Bag</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Util</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Outputable</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">UniqSet</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Maybes</span><span>           </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">orElse</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">GHC.LanguageExtensions</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LangExt</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Foldable</span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">partition</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">NonEmpty</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-comment">{-
-- ToDo: Put the annotations into the monad, so that they arrive in the proper
-- place and can be used when complaining.

The code tree received by the function @rnBinds@ contains definitions
in where-clauses which are all apparently mutually recursive, but which may
not really depend upon each other. For example, in the top level program
\begin{verbatim}
f x = y where a = x
              y = x
\end{verbatim}
the definitions of @a@ and @y@ do not depend on each other at all.
Unfortunately, the typechecker cannot always check such definitions.
\footnote{Mycroft, A. 1984. Polymorphic type schemes and recursive
definitions. In Proceedings of the International Symposium on Programming,
Toulouse, pp. 217-39. LNCS 167. Springer Verlag.}
However, the typechecker usually can check definitions in which only the
strongly connected components have been collected into recursive bindings.
This is precisely what the function @rnBinds@ does.

ToDo: deal with case where a single monobinds binds the same variable
twice.

The vertag tag is a unique @Int@; the tags only need to be unique
within one @MonoBinds@, so that unique-Int plumbing is done explicitly
(heavy monad machinery not needed).


************************************************************************
*                                                                      *
* naming conventions                                                   *
*                                                                      *
************************************************************************

\subsection[name-conventions]{Name conventions}

The basic algorithm involves walking over the tree and returning a tuple
containing the new tree plus its free variables. Some functions, such
as those walking polymorphic bindings (HsBinds) and qualifier lists in
list comprehensions (@Quals@), return the variables bound in local
environments. These are then used to calculate the free variables of the
expression evaluated in these environments.

Conventions for variable names are as follows:
\begin{itemize}
\item
new code is given a prime to distinguish it from the old.

\item
a set of variables defined in @Exp@ is written @dvExp@

\item
a set of variables free in @Exp@ is written @fvExp@
\end{itemize}

************************************************************************
*                                                                      *
* analysing polymorphic bindings (HsBindGroup, HsBind)
*                                                                      *
************************************************************************

\subsubsection[dep-HsBinds]{Polymorphic bindings}

Non-recursive expressions are reconstructed without any changes at top
level, although their component expressions may have to be altered.
However, non-recursive expressions are currently not expected as
\Haskell{} programs, and this code should not be executed.

Monomorphic bindings contain information that is returned in a tuple
(a @FlatMonoBinds@) containing:

\begin{enumerate}
\item
a unique @Int@ that serves as the ``vertex tag'' for this binding.

\item
the name of a function or the names in a pattern. These are a set
referred to as @dvLhs@, the defined variables of the left hand side.

\item
the free variables of the body. These are referred to as @fvBody@.

\item
the definition's actual code. This is referred to as just @code@.
\end{enumerate}

The function @nonRecDvFv@ returns two sets of variables. The first is
the set of variables defined in the set of monomorphic bindings, while the
second is the set of free variables in those bindings.

The set of variables defined in a non-recursive binding is just the
union of all of them, as @union@ removes duplicates. However, the
free variables in each successive set of cumulative bindings is the
union of those in the previous set plus those of the newest binding after
the defined variables of the previous set have been removed.

@rnMethodBinds@ deals only with the declarations in class and
instance declarations.  It expects only to see @FunMonoBind@s, and
it expects the global environment to contain bindings for the binders
(which are all class operations).

************************************************************************
*                                                                      *
\subsubsection{ Top-level bindings}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">-- for top-level bindings, we need to make top-level names,</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- so we have a different entry point than for local bindings</span><span>
</span><a name="line-175"></a><span class="hs-identifier">rnTopBindsLHS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnFixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a><span>
</span><a name="line-176"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsValBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-177"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsValBindsLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-178"></a><a name="rnTopBindsLHS"><a href="RnBinds.html#rnTopBindsLHS"><span class="hs-identifier">rnTopBindsLHS</span></a></a><span> </span><a name="local-6989586621682239983"><a href="#local-6989586621682239983"><span class="hs-identifier">fix_env</span></a></a><span> </span><a name="local-6989586621682239984"><a href="#local-6989586621682239984"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-179"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnBinds.html#rnValBindsLHS"><span class="hs-identifier hs-var">rnValBindsLHS</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#topRecNameMaker"><span class="hs-identifier hs-var">topRecNameMaker</span></a><span> </span><a href="#local-6989586621682239983"><span class="hs-identifier hs-var">fix_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682239984"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-identifier">rnTopBindsBoot</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NameSet</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsValBindsLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-182"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsValBinds</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">DefUses</span><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span class="hs-comment">-- A hs-boot file has no bindings.</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- Return a single HsBindGroup with empty binds and renamed signatures</span><span>
</span><a name="line-185"></a><a name="rnTopBindsBoot"><a href="RnBinds.html#rnTopBindsBoot"><span class="hs-identifier">rnTopBindsBoot</span></a></a><span> </span><a name="local-6989586621682239985"><a href="#local-6989586621682239985"><span class="hs-identifier">bound_names</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ValBinds</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682239986"><a href="#local-6989586621682239986"><span class="hs-identifier">mbinds</span></a></a><span> </span><a name="local-6989586621682239987"><a href="#local-6989586621682239987"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#checkErr"><span class="hs-identifier hs-var">checkErr</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isEmptyLHsBinds</span><span> </span><a href="#local-6989586621682239986"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="RnBinds.html#bindsInHsBootFile"><span class="hs-identifier hs-var">bindsInHsBootFile</span></a><span> </span><a href="#local-6989586621682239986"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682239988"><a href="#local-6989586621682239988"><span class="hs-identifier">sigs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682239989"><a href="#local-6989586621682239989"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#renameSigs"><span class="hs-identifier hs-var">renameSigs</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#HsBootCtxt"><span class="hs-identifier hs-var">HsBootCtxt</span></a><span> </span><a href="#local-6989586621682239985"><span class="hs-identifier hs-var">bound_names</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682239987"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-188"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XValBindsLR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NValBinds</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621682239988"><span class="hs-identifier hs-var">sigs'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">usesOnly</span><span> </span><a href="#local-6989586621682239989"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-189"></a><span class="hs-identifier">rnTopBindsBoot</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682239990"><a href="#local-6989586621682239990"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;rnTopBindsBoot&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682239990"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-comment">{-
*********************************************************
*                                                      *
                HsLocalBinds
*                                                      *
*********************************************************
-}</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-identifier">rnLocalBindsAndThen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsLocalBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-200"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsLocalBinds</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239982"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239982"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- This version (a) assumes that the binding vars are *not* already in scope</span><span>
</span><a name="line-203"></a><span class="hs-comment">--               (b) removes the binders from the free vars of the thing inside</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- The parser doesn't produce ThenBinds</span><span>
</span><a name="line-205"></a><a name="rnLocalBindsAndThen"><a href="RnBinds.html#rnLocalBindsAndThen"><span class="hs-identifier">rnLocalBindsAndThen</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EmptyLocalBinds</span><span> </span><a name="local-6989586621682239991"><a href="#local-6989586621682239991"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682239992"><a href="#local-6989586621682239992"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-206"></a><span>  </span><a href="#local-6989586621682239992"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">EmptyLocalBinds</span><span> </span><a href="#local-6989586621682239991"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">emptyNameSet</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-identifier">rnLocalBindsAndThen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsValBinds</span><span> </span><a name="local-6989586621682239993"><a href="#local-6989586621682239993"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682239994"><a href="#local-6989586621682239994"><span class="hs-identifier">val_binds</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682239995"><a href="#local-6989586621682239995"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-209"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnBinds.html#rnLocalValBindsAndThen"><span class="hs-identifier hs-var">rnLocalValBindsAndThen</span></a><span> </span><a href="#local-6989586621682239994"><span class="hs-identifier hs-var">val_binds</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682239996"><a href="#local-6989586621682239996"><span class="hs-identifier">val_binds'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-210"></a><span>      </span><a href="#local-6989586621682239995"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsValBinds</span><span> </span><a href="#local-6989586621682239993"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682239996"><span class="hs-identifier hs-var">val_binds'</span></a><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-identifier">rnLocalBindsAndThen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIPBinds</span><span> </span><a name="local-6989586621682239997"><a href="#local-6989586621682239997"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682239998"><a href="#local-6989586621682239998"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682239999"><a href="#local-6989586621682239999"><span class="hs-identifier">thing_inside</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682240000"><a href="#local-6989586621682240000"><span class="hs-identifier">binds'</span></a></a><span class="hs-special">,</span><a name="local-6989586621682240001"><a href="#local-6989586621682240001"><span class="hs-identifier">fv_binds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnIPBinds"><span class="hs-identifier hs-var">rnIPBinds</span></a><span> </span><a href="#local-6989586621682239998"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-214"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682240002"><a href="#local-6989586621682240002"><span class="hs-identifier">thing</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240003"><a href="#local-6989586621682240003"><span class="hs-identifier">fvs_thing</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682239999"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">HsIPBinds</span><span> </span><a href="#local-6989586621682239997"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682240000"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240001"><span class="hs-identifier hs-var">fv_binds</span></a><span>
</span><a name="line-215"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240002"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240003"><span class="hs-identifier hs-var">fvs_thing</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682240001"><span class="hs-identifier hs-var">fv_binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-identifier">rnLocalBindsAndThen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsLocalBindsLR</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnLocalBindsAndThen&quot;</span><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-identifier">rnIPBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsIPBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsIPBinds</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-220"></a><a name="rnIPBinds"><a href="RnBinds.html#rnIPBinds"><span class="hs-identifier">rnIPBinds</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IPBinds</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240004"><a href="#local-6989586621682240004"><span class="hs-identifier">ip_binds</span></a></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-221"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682240005"><a href="#local-6989586621682240005"><span class="hs-identifier">ip_binds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240006"><a href="#local-6989586621682240006"><span class="hs-identifier">fvs_s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapAndUnzipM</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><a href="RnBinds.html#rnIPBind"><span class="hs-identifier hs-var">rnIPBind</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240004"><span class="hs-identifier hs-var">ip_binds</span></a><span>
</span><a name="line-222"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IPBinds</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240005"><span class="hs-identifier hs-var">ip_binds'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">plusFVs</span><span> </span><a href="#local-6989586621682240006"><span class="hs-identifier hs-var">fvs_s</span></a><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span class="hs-identifier">rnIPBinds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XHsIPBinds</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnIPBinds&quot;</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-identifier">rnIPBind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IPBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IPBind</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-226"></a><a name="rnIPBind"><a href="RnBinds.html#rnIPBind"><span class="hs-identifier">rnIPBind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IPBind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621682240007"><a href="#local-6989586621682240007"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682240008"><a href="#local-6989586621682240008"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-227"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682240009"><a href="#local-6989586621682240009"><span class="hs-identifier">expr'</span></a></a><span class="hs-special">,</span><a name="local-6989586621682240010"><a href="#local-6989586621682240010"><span class="hs-identifier">fvExpr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621682240008"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-228"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IPBind</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621682240007"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240009"><span class="hs-identifier hs-var">expr'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240010"><span class="hs-identifier hs-var">fvExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span class="hs-identifier">rnIPBind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XIPBind</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnIPBind&quot;</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
                ValBinds
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-comment">-- Renaming local binding groups</span><span>
</span><a name="line-240"></a><span class="hs-comment">-- Does duplicate/shadow check</span><span>
</span><a name="line-241"></a><span class="hs-identifier">rnLocalValBindsLHS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnFixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a><span>
</span><a name="line-242"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsValBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-243"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">HsValBindsLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-244"></a><a name="rnLocalValBindsLHS"><a href="RnBinds.html#rnLocalValBindsLHS"><span class="hs-identifier">rnLocalValBindsLHS</span></a></a><span> </span><a name="local-6989586621682240011"><a href="#local-6989586621682240011"><span class="hs-identifier">fix_env</span></a></a><span> </span><a name="local-6989586621682240012"><a href="#local-6989586621682240012"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-245"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240013"><a href="#local-6989586621682240013"><span class="hs-identifier">binds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnValBindsLHS"><span class="hs-identifier hs-var">rnValBindsLHS</span></a><span> </span><span class="hs-special">(</span><a href="RnPat.html#localRecNameMaker"><span class="hs-identifier hs-var">localRecNameMaker</span></a><span> </span><a href="#local-6989586621682240011"><span class="hs-identifier hs-var">fix_env</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240012"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-246"></a><span>
</span><a name="line-247"></a><span>         </span><span class="hs-comment">-- Check for duplicates and shadowing</span><span>
</span><a name="line-248"></a><span>         </span><span class="hs-comment">-- Must do this *after* renaming the patterns</span><span>
</span><a name="line-249"></a><span>         </span><span class="hs-comment">-- See Note [Collect binders only after renaming] in HsUtils</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>         </span><span class="hs-comment">-- We need to check for dups here because we</span><span>
</span><a name="line-252"></a><span>         </span><span class="hs-comment">-- don't don't bind all of the variables from the ValBinds at once</span><span>
</span><a name="line-253"></a><span>         </span><span class="hs-comment">-- with bindLocatedLocals any more.</span><span>
</span><a name="line-254"></a><span>         </span><span class="hs-comment">--</span><span>
</span><a name="line-255"></a><span>         </span><span class="hs-comment">-- Note that we don't want to do this at the top level, since</span><span>
</span><a name="line-256"></a><span>         </span><span class="hs-comment">-- sorting out duplicates and shadowing there happens elsewhere.</span><span>
</span><a name="line-257"></a><span>         </span><span class="hs-comment">-- The behavior is even different. For example,</span><span>
</span><a name="line-258"></a><span>         </span><span class="hs-comment">--   import A(f)</span><span>
</span><a name="line-259"></a><span>         </span><span class="hs-comment">--   f = ...</span><span>
</span><a name="line-260"></a><span>         </span><span class="hs-comment">-- should not produce a shadowing warning (but it will produce</span><span>
</span><a name="line-261"></a><span>         </span><span class="hs-comment">-- an ambiguity warning if you use f), but</span><span>
</span><a name="line-262"></a><span>         </span><span class="hs-comment">--   import A(f)</span><span>
</span><a name="line-263"></a><span>         </span><span class="hs-comment">--   g = let f = ... in f</span><span>
</span><a name="line-264"></a><span>         </span><span class="hs-comment">-- should.</span><span>
</span><a name="line-265"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240014"><a href="#local-6989586621682240014"><span class="hs-identifier">bound_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">collectHsValBinders</span><span> </span><a href="#local-6989586621682240013"><span class="hs-identifier hs-var">binds'</span></a><span>
</span><a name="line-266"></a><span>             </span><span class="hs-comment">-- There should be only Ids, but if there are any bogus</span><span>
</span><a name="line-267"></a><span>             </span><span class="hs-comment">-- pattern synonyms, we'll collect them anyway, so that</span><span>
</span><a name="line-268"></a><span>             </span><span class="hs-comment">-- we don't generate subsequent out-of-scope messages</span><span>
</span><a name="line-269"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240015"><a href="#local-6989586621682240015"><span class="hs-identifier">envs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#getRdrEnvs"><span class="hs-identifier hs-var">getRdrEnvs</span></a><span>
</span><a name="line-270"></a><span>       </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#checkDupAndShadowedNames"><span class="hs-identifier hs-var">checkDupAndShadowedNames</span></a><span> </span><a href="#local-6989586621682240015"><span class="hs-identifier hs-var">envs</span></a><span> </span><a href="#local-6989586621682240014"><span class="hs-identifier hs-var">bound_names</span></a><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240014"><span class="hs-identifier hs-var">bound_names</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240013"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-273"></a><span>
</span><a name="line-274"></a><span class="hs-comment">-- renames the left-hand sides</span><span>
</span><a name="line-275"></a><span class="hs-comment">-- generic version used both at the top level and for local binds</span><span>
</span><a name="line-276"></a><span class="hs-comment">-- does some error checking, but not what gets done elsewhere at the top level</span><span>
</span><a name="line-277"></a><span class="hs-identifier">rnValBindsLHS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span>
</span><a name="line-278"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsValBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-279"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsValBindsLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-280"></a><a name="rnValBindsLHS"><a href="RnBinds.html#rnValBindsLHS"><span class="hs-identifier">rnValBindsLHS</span></a></a><span> </span><a name="local-6989586621682240016"><a href="#local-6989586621682240016"><span class="hs-identifier">topP</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ValBinds</span><span> </span><a name="local-6989586621682240017"><a href="#local-6989586621682240017"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682240018"><a href="#local-6989586621682240018"><span class="hs-identifier">mbinds</span></a></a><span> </span><a name="local-6989586621682240019"><a href="#local-6989586621682240019"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240022"><a href="#local-6989586621682240022"><span class="hs-identifier">mbinds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapBagM</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#rnBindLHS"><span class="hs-identifier hs-var">rnBindLHS</span></a><span> </span><a href="#local-6989586621682240016"><span class="hs-identifier hs-var">topP</span></a><span> </span><a href="#local-6989586621682240021"><span class="hs-identifier hs-var">doc</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240018"><span class="hs-identifier hs-var">mbinds</span></a><span>
</span><a name="line-282"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ValBinds</span><span> </span><a href="#local-6989586621682240017"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682240022"><span class="hs-identifier hs-var">mbinds'</span></a><span> </span><a href="#local-6989586621682240019"><span class="hs-identifier hs-var">sigs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-283"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-284"></a><span>    </span><a name="local-6989586621682240020"><a href="#local-6989586621682240020"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">collectHsBindsBinders</span><span> </span><a href="#local-6989586621682240018"><span class="hs-identifier hs-var">mbinds</span></a><span>
</span><a name="line-285"></a><span>    </span><a name="local-6989586621682240021"><a href="#local-6989586621682240021"><span class="hs-identifier">doc</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In the binding group for:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">pprWithCommas</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240020"><span class="hs-identifier hs-var">bndrs</span></a><span>
</span><a name="line-286"></a><span>
</span><a name="line-287"></a><span class="hs-identifier">rnValBindsLHS</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240023"><a href="#local-6989586621682240023"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;rnValBindsLHSFromDoc&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240023"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span class="hs-comment">-- General version used both from the top-level and for local things</span><span>
</span><a name="line-290"></a><span class="hs-comment">-- Assumes the LHS vars are in scope</span><span>
</span><a name="line-291"></a><span class="hs-comment">--</span><span>
</span><a name="line-292"></a><span class="hs-comment">-- Does not bind the local fixity declarations</span><span>
</span><a name="line-293"></a><span class="hs-identifier">rnValBindsRHS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnEnv.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a><span>
</span><a name="line-294"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsValBindsLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-295"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsValBinds</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">DefUses</span><span class="hs-special">)</span><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><a name="rnValBindsRHS"><a href="RnBinds.html#rnValBindsRHS"><span class="hs-identifier">rnValBindsRHS</span></a></a><span> </span><a name="local-6989586621682240024"><a href="#local-6989586621682240024"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ValBinds</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240025"><a href="#local-6989586621682240025"><span class="hs-identifier">mbinds</span></a></a><span> </span><a name="local-6989586621682240026"><a href="#local-6989586621682240026"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-298"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240027"><a href="#local-6989586621682240027"><span class="hs-identifier">sigs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240028"><a href="#local-6989586621682240028"><span class="hs-identifier">sig_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#renameSigs"><span class="hs-identifier hs-var">renameSigs</span></a><span> </span><a href="#local-6989586621682240024"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240026"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-299"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240029"><a href="#local-6989586621682240029"><span class="hs-identifier">binds_w_dus</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapBagM</span><span> </span><span class="hs-special">(</span><a href="RnBinds.html#rnLBind"><span class="hs-identifier hs-var">rnLBind</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#mkScopedTvFn"><span class="hs-identifier hs-var">mkScopedTvFn</span></a><span> </span><a href="#local-6989586621682240027"><span class="hs-identifier hs-var">sigs'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240025"><span class="hs-identifier hs-var">mbinds</span></a><span>
</span><a name="line-300"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a name="local-6989586621682240030"><a href="#local-6989586621682240030"><span class="hs-identifier">anal_binds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240031"><a href="#local-6989586621682240031"><span class="hs-identifier">anal_dus</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnBinds.html#depAnalBinds"><span class="hs-identifier hs-var">depAnalBinds</span></a><span> </span><a href="#local-6989586621682240029"><span class="hs-identifier hs-var">binds_w_dus</span></a><span>
</span><a name="line-301"></a><span>
</span><a name="line-302"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240032"><a href="#local-6989586621682240032"><span class="hs-identifier">patsyn_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unionNameSet</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">psb_ext</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">emptyNameSet</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-303"></a><span>                          </span><span class="hs-identifier hs-var">getPatSynBinds</span><span> </span><a href="#local-6989586621682240030"><span class="hs-identifier hs-var">anal_binds</span></a><span>
</span><a name="line-304"></a><span>                </span><span class="hs-comment">-- The uses in binds_w_dus for PatSynBinds do not include</span><span>
</span><a name="line-305"></a><span>                </span><span class="hs-comment">-- variables used in the patsyn builders; see</span><span>
</span><a name="line-306"></a><span>                </span><span class="hs-comment">-- Note [Pattern synonym builders don't yield dependencies]</span><span>
</span><a name="line-307"></a><span>                </span><span class="hs-comment">-- But psb_fvs /does/ include those builder fvs.  So we</span><span>
</span><a name="line-308"></a><span>                </span><span class="hs-comment">-- add them back in here to avoid bogus warnings about</span><span>
</span><a name="line-309"></a><span>                </span><span class="hs-comment">-- unused variables (Trac #12548)</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span>             </span><a name="local-6989586621682240033"><a href="#local-6989586621682240033"><span class="hs-identifier">valbind'_dus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240031"><span class="hs-identifier hs-var">anal_dus</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusDU</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">usesOnly</span><span> </span><a href="#local-6989586621682240028"><span class="hs-identifier hs-var">sig_fvs</span></a><span>
</span><a name="line-312"></a><span>                                     </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusDU</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">usesOnly</span><span> </span><a href="#local-6989586621682240032"><span class="hs-identifier hs-var">patsyn_fvs</span></a><span>
</span><a name="line-313"></a><span>                            </span><span class="hs-comment">-- Put the sig uses *after* the bindings</span><span>
</span><a name="line-314"></a><span>                            </span><span class="hs-comment">-- so that the binders are removed from</span><span>
</span><a name="line-315"></a><span>                            </span><span class="hs-comment">-- the uses in the sigs</span><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XValBindsLR</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NValBinds</span><span> </span><a href="#local-6989586621682240030"><span class="hs-identifier hs-var">anal_binds</span></a><span> </span><a href="#local-6989586621682240027"><span class="hs-identifier hs-var">sigs'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240033"><span class="hs-identifier hs-var">valbind'_dus</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-identifier">rnValBindsRHS</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240034"><a href="#local-6989586621682240034"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;rnValBindsRHS&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240034"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span class="hs-comment">-- Wrapper for local binds</span><span>
</span><a name="line-322"></a><span class="hs-comment">--</span><span>
</span><a name="line-323"></a><span class="hs-comment">-- The *client* of this function is responsible for checking for unused binders;</span><span>
</span><a name="line-324"></a><span class="hs-comment">-- it doesn't (and can't: we don't have the thing inside the binds) happen here</span><span>
</span><a name="line-325"></a><span class="hs-comment">--</span><span>
</span><a name="line-326"></a><span class="hs-comment">-- The client is also responsible for bringing the fixities into scope</span><span>
</span><a name="line-327"></a><span class="hs-identifier">rnLocalValBindsRHS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NameSet</span><span>  </span><span class="hs-comment">-- names bound by the LHSes</span><span>
</span><a name="line-328"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsValBindsLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-329"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsValBinds</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">DefUses</span><span class="hs-special">)</span><span>
</span><a name="line-330"></a><a name="rnLocalValBindsRHS"><a href="RnBinds.html#rnLocalValBindsRHS"><span class="hs-identifier">rnLocalValBindsRHS</span></a></a><span> </span><a name="local-6989586621682240035"><a href="#local-6989586621682240035"><span class="hs-identifier">bound_names</span></a></a><span> </span><a name="local-6989586621682240036"><a href="#local-6989586621682240036"><span class="hs-identifier">binds</span></a></a><span>
</span><a name="line-331"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnBinds.html#rnValBindsRHS"><span class="hs-identifier hs-var">rnValBindsRHS</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#LocalBindCtxt"><span class="hs-identifier hs-var">LocalBindCtxt</span></a><span> </span><a href="#local-6989586621682240035"><span class="hs-identifier hs-var">bound_names</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240036"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span class="hs-comment">-- for local binds</span><span>
</span><a name="line-334"></a><span class="hs-comment">-- wrapper that does both the left- and right-hand sides</span><span>
</span><a name="line-335"></a><span class="hs-comment">--</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- here there are no local fixity decls passed in;</span><span>
</span><a name="line-337"></a><span class="hs-comment">-- the local fixity decls come from the ValBinds sigs</span><span>
</span><a name="line-338"></a><span class="hs-identifier">rnLocalValBindsAndThen</span><span>
</span><a name="line-339"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsValBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-340"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsValBinds</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239981"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-341"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239981"><span class="hs-identifier hs-type">result</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-342"></a><a name="rnLocalValBindsAndThen"><a href="RnBinds.html#rnLocalValBindsAndThen"><span class="hs-identifier">rnLocalValBindsAndThen</span></a></a><span> </span><a name="local-6989586621682240037"><a href="#local-6989586621682240037"><span class="hs-identifier">binds</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ValBinds</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240038"><a href="#local-6989586621682240038"><span class="hs-identifier">sigs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682240039"><a href="#local-6989586621682240039"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-343"></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-special">{</span><span>     </span><span class="hs-comment">-- (A) Create the local fixity environment</span><span>
</span><a name="line-344"></a><span>          </span><a name="local-6989586621682240042"><a href="#local-6989586621682240042"><span class="hs-identifier">new_fixities</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#makeMiniFixityEnv"><span class="hs-identifier hs-var">makeMiniFixityEnv</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621682240040"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682240041"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-345"></a><span>                                            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240040"><a href="#local-6989586621682240040"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240041"><a href="#local-6989586621682240041"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240038"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">]</span><span>
</span><a name="line-346"></a><span>
</span><a name="line-347"></a><span>              </span><span class="hs-comment">-- (B) Rename the LHSes</span><span>
</span><a name="line-348"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240043"><a href="#local-6989586621682240043"><span class="hs-identifier">bound_names</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240044"><a href="#local-6989586621682240044"><span class="hs-identifier">new_lhs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnLocalValBindsLHS"><span class="hs-identifier hs-var">rnLocalValBindsLHS</span></a><span> </span><a href="#local-6989586621682240042"><span class="hs-identifier hs-var">new_fixities</span></a><span> </span><a href="#local-6989586621682240037"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span>              </span><span class="hs-comment">--     ...and bring them (and their fixities) into scope</span><span>
</span><a name="line-351"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#bindLocalNamesFV"><span class="hs-identifier hs-var">bindLocalNamesFV</span></a><span> </span><a href="#local-6989586621682240043"><span class="hs-identifier hs-var">bound_names</span></a><span>              </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-352"></a><span>          </span><a href="RnFixity.html#addLocalFixities"><span class="hs-identifier hs-var">addLocalFixities</span></a><span> </span><a href="#local-6989586621682240042"><span class="hs-identifier hs-var">new_fixities</span></a><span> </span><a href="#local-6989586621682240043"><span class="hs-identifier hs-var">bound_names</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span>        </span><span class="hs-special">{</span><span>      </span><span class="hs-comment">-- (C) Do the RHS and thing inside</span><span>
</span><a name="line-355"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621682240045"><a href="#local-6989586621682240045"><span class="hs-identifier">binds'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240046"><a href="#local-6989586621682240046"><span class="hs-identifier">dus</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnLocalValBindsRHS"><span class="hs-identifier hs-var">rnLocalValBindsRHS</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkNameSet</span><span> </span><a href="#local-6989586621682240043"><span class="hs-identifier hs-var">bound_names</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240044"><span class="hs-identifier hs-var">new_lhs</span></a><span>
</span><a name="line-356"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240047"><a href="#local-6989586621682240047"><span class="hs-identifier">result</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240048"><a href="#local-6989586621682240048"><span class="hs-identifier">result_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240039"><span class="hs-identifier hs-var">thing_inside</span></a><span> </span><a href="#local-6989586621682240045"><span class="hs-identifier hs-var">binds'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">allUses</span><span> </span><a href="#local-6989586621682240046"><span class="hs-identifier hs-var">dus</span></a><span class="hs-special">)</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span>                </span><span class="hs-comment">-- Report unused bindings based on the (accurate)</span><span>
</span><a name="line-359"></a><span>                </span><span class="hs-comment">-- findUses.  E.g.</span><span>
</span><a name="line-360"></a><span>                </span><span class="hs-comment">--      let x = x in 3</span><span>
</span><a name="line-361"></a><span>                </span><span class="hs-comment">-- should report 'x' unused</span><span>
</span><a name="line-362"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240049"><a href="#local-6989586621682240049"><span class="hs-identifier">real_uses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">findUses</span><span> </span><a href="#local-6989586621682240046"><span class="hs-identifier hs-var">dus</span></a><span> </span><a href="#local-6989586621682240048"><span class="hs-identifier hs-var">result_fvs</span></a><span>
</span><a name="line-363"></a><span>              </span><span class="hs-comment">-- Insert fake uses for variables introduced implicitly by</span><span>
</span><a name="line-364"></a><span>              </span><span class="hs-comment">-- wildcards (#4404)</span><span>
</span><a name="line-365"></a><span>              </span><a name="local-6989586621682240050"><a href="#local-6989586621682240050"><span class="hs-identifier">implicit_uses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsValBindsImplicits</span><span> </span><a href="#local-6989586621682240045"><span class="hs-identifier hs-var">binds'</span></a><span>
</span><a name="line-366"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="RnUtils.html#warnUnusedLocalBinds"><span class="hs-identifier hs-var">warnUnusedLocalBinds</span></a><span> </span><a href="#local-6989586621682240043"><span class="hs-identifier hs-var">bound_names</span></a><span>
</span><a name="line-367"></a><span>                                      </span><span class="hs-special">(</span><a href="#local-6989586621682240049"><span class="hs-identifier hs-var">real_uses</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">unionNameSet</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682240050"><span class="hs-identifier hs-var">implicit_uses</span></a><span class="hs-special">)</span><span>
</span><a name="line-368"></a><span>
</span><a name="line-369"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><a name="line-370"></a><span>            </span><span class="hs-comment">-- The variables &quot;used&quot; in the val binds are:</span><span>
</span><a name="line-371"></a><span>            </span><span class="hs-comment">--   (1) the uses of the binds (allUses)</span><span>
</span><a name="line-372"></a><span>            </span><span class="hs-comment">--   (2) the FVs of the thing-inside</span><span>
</span><a name="line-373"></a><span>            </span><a name="local-6989586621682240051"><a href="#local-6989586621682240051"><span class="hs-identifier">all_uses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">allUses</span><span> </span><a href="#local-6989586621682240046"><span class="hs-identifier hs-var">dus</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682240048"><span class="hs-identifier hs-var">result_fvs</span></a><span>
</span><a name="line-374"></a><span>                </span><span class="hs-comment">-- Note [Unused binding hack]</span><span>
</span><a name="line-375"></a><span>                </span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-376"></a><span>                </span><span class="hs-comment">-- Note that *in contrast* to the above reporting of</span><span>
</span><a name="line-377"></a><span>                </span><span class="hs-comment">-- unused bindings, (1) above uses duUses to return *all*</span><span>
</span><a name="line-378"></a><span>                </span><span class="hs-comment">-- the uses, even if the binding is unused.  Otherwise consider:</span><span>
</span><a name="line-379"></a><span>                </span><span class="hs-comment">--      x = 3</span><span>
</span><a name="line-380"></a><span>                </span><span class="hs-comment">--      y = let p = x in 'x'    -- NB: p not used</span><span>
</span><a name="line-381"></a><span>                </span><span class="hs-comment">-- If we don't &quot;see&quot; the dependency of 'y' on 'x', we may put the</span><span>
</span><a name="line-382"></a><span>                </span><span class="hs-comment">-- bindings in the wrong order, and the type checker will complain</span><span>
</span><a name="line-383"></a><span>                </span><span class="hs-comment">-- that x isn't in scope</span><span>
</span><a name="line-384"></a><span>                </span><span class="hs-comment">--</span><span>
</span><a name="line-385"></a><span>                </span><span class="hs-comment">-- But note that this means we won't report 'x' as unused,</span><span>
</span><a name="line-386"></a><span>                </span><span class="hs-comment">-- whereas we would if we had { x = 3; p = x; y = 'x' }</span><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240047"><span class="hs-identifier hs-var">result</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240051"><span class="hs-identifier hs-var">all_uses</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-389"></a><span>                </span><span class="hs-comment">-- The bound names are pruned out of all_uses</span><span>
</span><a name="line-390"></a><span>                </span><span class="hs-comment">-- by the bindLocalNamesFV call above</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span class="hs-identifier">rnLocalValBindsAndThen</span><span> </span><a name="local-6989586621682240052"><a href="#local-6989586621682240052"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;rnLocalValBindsAndThen&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240052"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-393"></a><span>
</span><a name="line-394"></a><span>
</span><a name="line-395"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-396"></a><span>
</span><a name="line-397"></a><span class="hs-comment">-- renaming a single bind</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-identifier">rnBindLHS</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnPat.html#NameMaker"><span class="hs-identifier hs-type">NameMaker</span></a><span>
</span><a name="line-400"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-401"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsBind</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-402"></a><span>          </span><span class="hs-comment">-- returns the renamed left-hand side,</span><span>
</span><a name="line-403"></a><span>          </span><span class="hs-comment">-- and the FreeVars *of the LHS*</span><span>
</span><a name="line-404"></a><span>          </span><span class="hs-comment">-- (i.e., any free variables of the pattern)</span><span>
</span><a name="line-405"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsBindLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-406"></a><span>
</span><a name="line-407"></a><a name="rnBindLHS"><a href="RnBinds.html#rnBindLHS"><span class="hs-identifier">rnBindLHS</span></a></a><span> </span><a name="local-6989586621682240053"><a href="#local-6989586621682240053"><span class="hs-identifier">name_maker</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240054"><a href="#local-6989586621682240054"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240055"><a href="#local-6989586621682240055"><span class="hs-identifier">pat</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-409"></a><span>      </span><span class="hs-comment">-- we don't actually use the FV processing of rnPatsAndThen here</span><span>
</span><a name="line-410"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621682240056"><a href="#local-6989586621682240056"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">,</span><a name="local-6989586621682240057"><a href="#local-6989586621682240057"><span class="hs-identifier">pat'_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#rnBindPat"><span class="hs-identifier hs-var">rnBindPat</span></a><span> </span><a href="#local-6989586621682240053"><span class="hs-identifier hs-var">name_maker</span></a><span> </span><a href="#local-6989586621682240055"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-411"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240054"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240056"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240057"><span class="hs-identifier hs-var">pat'_fvs</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-412"></a><span>                </span><span class="hs-comment">-- We temporarily store the pat's FVs in bind_fvs;</span><span>
</span><a name="line-413"></a><span>                </span><span class="hs-comment">-- gets updated to the FVs of the whole bind</span><span>
</span><a name="line-414"></a><span>                </span><span class="hs-comment">-- when doing the RHS below</span><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span class="hs-identifier">rnBindLHS</span><span> </span><a name="local-6989586621682240058"><a href="#local-6989586621682240058"><span class="hs-identifier">name_maker</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240059"><a href="#local-6989586621682240059"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240060"><a href="#local-6989586621682240060"><span class="hs-identifier">rdr_name</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240061"><a href="#local-6989586621682240061"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#applyNameMaker"><span class="hs-identifier hs-var">applyNameMaker</span></a><span> </span><a href="#local-6989586621682240058"><span class="hs-identifier hs-var">name_maker</span></a><span> </span><a href="#local-6989586621682240060"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-418"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240059"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240061"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-419"></a><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-identifier">rnBindLHS</span><span> </span><a name="local-6989586621682240062"><a href="#local-6989586621682240062"><span class="hs-identifier">name_maker</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynBind</span><span> </span><a name="local-6989586621682240063"><a href="#local-6989586621682240063"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682240064"><a href="#local-6989586621682240064"><span class="hs-identifier">psb</span></a></a><span class="hs-glyph">@</span><span class="hs-identifier hs-var">PSB</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240065"><a href="#local-6989586621682240065"><span class="hs-identifier">rdrname</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-422"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a href="RnPat.html#isTopRecNameMaker"><span class="hs-identifier hs-var">isTopRecNameMaker</span></a><span> </span><a href="#local-6989586621682240062"><span class="hs-identifier hs-var">name_maker</span></a><span>
</span><a name="line-423"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a><span> </span><a href="RnNames.html#checkConName"><span class="hs-identifier hs-var">checkConName</span></a><span> </span><a href="#local-6989586621682240065"><span class="hs-identifier hs-var">rdrname</span></a><span>
</span><a name="line-424"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240067"><a href="#local-6989586621682240067"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-6989586621682240065"><span class="hs-identifier hs-var">rdrname</span></a><span>   </span><span class="hs-comment">-- Should be in scope already</span><span>
</span><a name="line-425"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynBind</span><span> </span><a href="#local-6989586621682240063"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682240064"><span class="hs-identifier hs-var">psb</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240067"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-comment">-- Pattern synonym, not at top level</span><span>
</span><a name="line-428"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="#local-6989586621682240066"><span class="hs-identifier hs-var">localPatternSynonymErr</span></a><span>  </span><span class="hs-comment">-- Complain, but make up a fake</span><span>
</span><a name="line-429"></a><span>                                        </span><span class="hs-comment">-- name so that we can carry on</span><span>
</span><a name="line-430"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240068"><a href="#local-6989586621682240068"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnPat.html#applyNameMaker"><span class="hs-identifier hs-var">applyNameMaker</span></a><span> </span><a href="#local-6989586621682240062"><span class="hs-identifier hs-var">name_maker</span></a><span> </span><a href="#local-6989586621682240065"><span class="hs-identifier hs-var">rdrname</span></a><span>
</span><a name="line-431"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynBind</span><span> </span><a href="#local-6989586621682240063"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682240064"><span class="hs-identifier hs-var">psb</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240068"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-432"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-433"></a><span>    </span><span class="hs-identifier">localPatternSynonymErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-434"></a><span>    </span><a name="local-6989586621682240066"><a href="#local-6989586621682240066"><span class="hs-identifier">localPatternSynonymErr</span></a></a><span>
</span><a name="line-435"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal pattern synonym declaration for&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240065"><span class="hs-identifier hs-var">rdrname</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-436"></a><span>           </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Pattern synonym declarations are only valid at top level&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span class="hs-identifier">rnBindLHS</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240069"><a href="#local-6989586621682240069"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;rnBindHS&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240069"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-identifier">rnLBind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Signature tyvar function</span><span>
</span><a name="line-441"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBindLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-442"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Uses</span><span class="hs-special">)</span><span>
</span><a name="line-443"></a><a name="rnLBind"><a href="RnBinds.html#rnLBind"><span class="hs-identifier">rnLBind</span></a></a><span> </span><a name="local-6989586621682240070"><a href="#local-6989586621682240070"><span class="hs-identifier">sig_fn</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240071"><a href="#local-6989586621682240071"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682240072"><a href="#local-6989586621682240072"><span class="hs-identifier">bind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-444"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682240071"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-445"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240073"><a href="#local-6989586621682240073"><span class="hs-identifier">bind'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240074"><a href="#local-6989586621682240074"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240075"><a href="#local-6989586621682240075"><span class="hs-identifier">dus</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnBind"><span class="hs-identifier hs-var">rnBind</span></a><span> </span><a href="#local-6989586621682240070"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-6989586621682240072"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-446"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621682240071"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682240073"><span class="hs-identifier hs-var">bind'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240074"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240075"><span class="hs-identifier hs-var">dus</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-447"></a><span>
</span><a name="line-448"></a><span class="hs-comment">-- assumes the left-hands-side vars are in scope</span><span>
</span><a name="line-449"></a><span class="hs-identifier">rnBind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- Signature tyvar function</span><span>
</span><a name="line-450"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">HsBindLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-451"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HsBind</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Uses</span><span class="hs-special">)</span><span>
</span><a name="line-452"></a><a name="rnBind"><a href="RnBinds.html#rnBind"><span class="hs-identifier">rnBind</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240076"><a href="#local-6989586621682240076"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_lhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240077"><a href="#local-6989586621682240077"><span class="hs-identifier">pat</span></a></a><span>
</span><a name="line-453"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_rhs</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240078"><a href="#local-6989586621682240078"><span class="hs-identifier">grhss</span></a></a><span>
</span><a name="line-454"></a><span>                                   </span><span class="hs-comment">-- pat fvs were stored in bind_fvs</span><span>
</span><a name="line-455"></a><span>                                   </span><span class="hs-comment">-- after processing the LHS</span><span>
</span><a name="line-456"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240079"><a href="#local-6989586621682240079"><span class="hs-identifier">pat_fvs</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-457"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240080"><a href="#local-6989586621682240080"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getModule</span><span>
</span><a name="line-458"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240081"><a href="#local-6989586621682240081"><span class="hs-identifier">grhss'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240082"><a href="#local-6989586621682240082"><span class="hs-identifier">rhs_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnGRHSs"><span class="hs-identifier hs-var">rnGRHSs</span></a><span> </span><span class="hs-identifier hs-var">PatBindRhs</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621682240078"><span class="hs-identifier hs-var">grhss</span></a><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span>                </span><span class="hs-comment">-- No scoped type variables for pattern bindings</span><span>
</span><a name="line-461"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240083"><a href="#local-6989586621682240083"><span class="hs-identifier">all_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240079"><span class="hs-identifier hs-var">pat_fvs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682240082"><span class="hs-identifier hs-var">rhs_fvs</span></a><span>
</span><a name="line-462"></a><span>              </span><a name="local-6989586621682240084"><a href="#local-6989586621682240084"><span class="hs-identifier">fvs'</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filterNameSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nameIsLocalOrFrom</span><span> </span><a href="#local-6989586621682240080"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240083"><span class="hs-identifier hs-var">all_fvs</span></a><span>
</span><a name="line-463"></a><span>                </span><span class="hs-comment">-- Keep locally-defined Names</span><span>
</span><a name="line-464"></a><span>                </span><span class="hs-comment">-- As well as dependency analysis, we need these for the</span><span>
</span><a name="line-465"></a><span>                </span><span class="hs-comment">-- MonoLocalBinds test in TcBinds.decideGeneralisationPlan</span><span>
</span><a name="line-466"></a><span>              </span><a name="local-6989586621682240085"><a href="#local-6989586621682240085"><span class="hs-identifier">bndrs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">collectPatBinders</span><span> </span><a href="#local-6989586621682240077"><span class="hs-identifier hs-var">pat</span></a><span>
</span><a name="line-467"></a><span>              </span><a name="local-6989586621682240086"><a href="#local-6989586621682240086"><span class="hs-identifier">bind'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240076"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pat_rhs</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240081"><span class="hs-identifier hs-var">grhss'</span></a><span>
</span><a name="line-468"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pat_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240084"><span class="hs-identifier hs-var">fvs'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span>              </span><a name="local-6989586621682240087"><a href="#local-6989586621682240087"><span class="hs-identifier">ok_nobind_pat</span></a></a><span>
</span><a name="line-471"></a><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Pattern bindings that bind no variables]</span><span>
</span><a name="line-472"></a><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682240077"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-473"></a><span>                       </span><span class="hs-identifier hs-var">WildPat</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-474"></a><span>                       </span><span class="hs-identifier hs-var">BangPat</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-comment">-- #9127, #13646</span><span>
</span><a name="line-475"></a><span>                       </span><span class="hs-identifier hs-var">SplicePat</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-476"></a><span>                       </span><span class="hs-identifier">_</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span>        </span><span class="hs-comment">-- Warn if the pattern binds no variables</span><span>
</span><a name="line-479"></a><span>        </span><span class="hs-comment">-- See Note [Pattern bindings that bind no variables]</span><span>
</span><a name="line-480"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="TcRnMonad.html#whenWOptM"><span class="hs-identifier hs-var">whenWOptM</span></a><span> </span><span class="hs-identifier hs-var">Opt_WarnUnusedPatternBinds</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-481"></a><span>          </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621682240085"><span class="hs-identifier hs-var">bndrs</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621682240087"><span class="hs-identifier hs-var">ok_nobind_pat</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-482"></a><span>          </span><a href="TcRnMonad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Reason</span><span> </span><span class="hs-identifier hs-var">Opt_WarnUnusedPatternBinds</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-483"></a><span>          </span><a href="RnBinds.html#unusedPatBindWarn"><span class="hs-identifier hs-var">unusedPatBindWarn</span></a><span> </span><a href="#local-6989586621682240086"><span class="hs-identifier hs-var">bind'</span></a><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621682240084"><span class="hs-identifier hs-var">fvs'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-comment">-- See Note [Free-variable space leak]</span><span>
</span><a name="line-486"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240086"><span class="hs-identifier hs-var">bind'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240085"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240083"><span class="hs-identifier hs-var">all_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-487"></a><span>
</span><a name="line-488"></a><span class="hs-identifier">rnBind</span><span> </span><a name="local-6989586621682240088"><a href="#local-6989586621682240088"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-6989586621682240089"><a href="#local-6989586621682240089"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240090"><a href="#local-6989586621682240090"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-489"></a><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240091"><a href="#local-6989586621682240091"><span class="hs-identifier">matches</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-490"></a><span>       </span><span class="hs-comment">-- invariant: no free vars here when it's a FunBind</span><span>
</span><a name="line-491"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240092"><a href="#local-6989586621682240092"><span class="hs-identifier">plain_name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682240090"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-492"></a><span>
</span><a name="line-493"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240093"><a href="#local-6989586621682240093"><span class="hs-identifier">matches'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240094"><a href="#local-6989586621682240094"><span class="hs-identifier">rhs_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#bindSigTyVarsFV"><span class="hs-identifier hs-var">bindSigTyVarsFV</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240088"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-6989586621682240092"><span class="hs-identifier hs-var">plain_name</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-494"></a><span>                                </span><span class="hs-comment">-- bindSigTyVars tests for LangExt.ScopedTyVars</span><span>
</span><a name="line-495"></a><span>                                 </span><a href="RnBinds.html#rnMatchGroup"><span class="hs-identifier hs-var">rnMatchGroup</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkPrefixFunRhs</span><span> </span><a href="#local-6989586621682240090"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-496"></a><span>                                              </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621682240091"><span class="hs-identifier hs-var">matches</span></a><span>
</span><a name="line-497"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240095"><a href="#local-6989586621682240095"><span class="hs-identifier">is_infix</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">isInfixFunBind</span><span> </span><a href="#local-6989586621682240089"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-498"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621682240095"><span class="hs-identifier hs-var">is_infix</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="RnTypes.html#checkPrecMatch"><span class="hs-identifier hs-var">checkPrecMatch</span></a><span> </span><a href="#local-6989586621682240092"><span class="hs-identifier hs-var">plain_name</span></a><span> </span><a href="#local-6989586621682240093"><span class="hs-identifier hs-var">matches'</span></a><span>
</span><a name="line-499"></a><span>
</span><a name="line-500"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240096"><a href="#local-6989586621682240096"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getModule</span><span>
</span><a name="line-501"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240097"><a href="#local-6989586621682240097"><span class="hs-identifier">fvs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filterNameSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nameIsLocalOrFrom</span><span> </span><a href="#local-6989586621682240096"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240094"><span class="hs-identifier hs-var">rhs_fvs</span></a><span>
</span><a name="line-502"></a><span>                </span><span class="hs-comment">-- Keep locally-defined Names</span><span>
</span><a name="line-503"></a><span>                </span><span class="hs-comment">-- As well as dependency analysis, we need these for the</span><span>
</span><a name="line-504"></a><span>                </span><span class="hs-comment">-- MonoLocalBinds test in TcBinds.decideGeneralisationPlan</span><span>
</span><a name="line-505"></a><span>
</span><a name="line-506"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621682240097"><span class="hs-identifier hs-var">fvs'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-comment">-- See Note [Free-variable space leak]</span><span>
</span><a name="line-507"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240089"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_matches</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240093"><span class="hs-identifier hs-var">matches'</span></a><span>
</span><a name="line-508"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_ext</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240097"><span class="hs-identifier hs-var">fvs'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><a name="line-509"></a><span>                  </span><span class="hs-special">[</span><a href="#local-6989586621682240092"><span class="hs-identifier hs-var">plain_name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240094"><span class="hs-identifier hs-var">rhs_fvs</span></a><span class="hs-special">)</span><span>
</span><a name="line-510"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span class="hs-identifier">rnBind</span><span> </span><a name="local-6989586621682240098"><a href="#local-6989586621682240098"><span class="hs-identifier">sig_fn</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynBind</span><span> </span><a name="local-6989586621682240099"><a href="#local-6989586621682240099"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621682240100"><a href="#local-6989586621682240100"><span class="hs-identifier">bind</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-513"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240101"><a href="#local-6989586621682240101"><span class="hs-identifier">bind'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240102"><a href="#local-6989586621682240102"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240103"><a href="#local-6989586621682240103"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnPatSynBind"><span class="hs-identifier hs-var">rnPatSynBind</span></a><span> </span><a href="#local-6989586621682240098"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-6989586621682240100"><span class="hs-identifier hs-var">bind</span></a><span>
</span><a name="line-514"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynBind</span><span> </span><a href="#local-6989586621682240099"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621682240101"><span class="hs-identifier hs-var">bind'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240102"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240103"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-515"></a><span>
</span><a name="line-516"></a><span class="hs-identifier">rnBind</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240104"><a href="#local-6989586621682240104"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;rnBind&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240104"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-517"></a><span>
</span><a name="line-518"></a><span class="hs-comment">{- Note [Pattern bindings that bind no variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Generally, we want to warn about pattern bindings like
  Just _ = e
because they don't do anything!  But we have three exceptions:

* A wildcard pattern
       _ = rhs
  which (a) is not that different from  _v = rhs
        (b) is sometimes used to give a type sig for,
            or an occurrence of, a variable on the RHS

* A strict pattern binding; that is, one with an outermost bang
     !Just _ = e
  This can fail, so unlike the lazy variant, it is not a no-op.
  Moreover, Trac #13646 argues that even for single constructor
  types, you might want to write the constructor.  See also #9127.

* A splice pattern
      $(th-lhs) = rhs
   It is impossible to determine whether or not th-lhs really
   binds any variable. We should disable the warning for any pattern
   which contain splices, but that is a more expensive check.

Note [Free-variable space leak]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We have
    fvs' = trim fvs
and we seq fvs' before turning it as part of a record.

The reason is that trim is sometimes something like
    \xs -&gt; intersectNameSet (mkNameSet bound_names) xs
and we don't want to retain the list bound_names. This showed up in
trac ticket #1136.
-}</span><span>
</span><a name="line-553"></a><span>
</span><a name="line-554"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
          Dependency analysis and other support functions
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-559"></a><span>
</span><a name="line-560"></a><span class="hs-identifier">depAnalBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bag</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBind</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Uses</span><span class="hs-special">)</span><span>
</span><a name="line-561"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">RecFlag</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">DefUses</span><span class="hs-special">)</span><span>
</span><a name="line-562"></a><span class="hs-comment">-- Dependency analysis; this is important so that</span><span>
</span><a name="line-563"></a><span class="hs-comment">-- unused-binding reporting is accurate</span><span>
</span><a name="line-564"></a><a name="depAnalBinds"><a href="RnBinds.html#depAnalBinds"><span class="hs-identifier">depAnalBinds</span></a></a><span> </span><a name="local-6989586621682240105"><a href="#local-6989586621682240105"><span class="hs-identifier">binds_w_dus</span></a></a><span>
</span><a name="line-565"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621682240107"><span class="hs-identifier hs-var">get_binds</span></a><span> </span><a href="#local-6989586621682240106"><span class="hs-identifier hs-var">sccs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621682240108"><span class="hs-identifier hs-var">get_du</span></a><span> </span><a href="#local-6989586621682240106"><span class="hs-identifier hs-var">sccs</span></a><span class="hs-special">)</span><span>
</span><a name="line-566"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-567"></a><span>    </span><a name="local-6989586621682240106"><a href="#local-6989586621682240106"><span class="hs-identifier">sccs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">depAnal</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682240109"><a href="#local-6989586621682240109"><span class="hs-identifier">defs</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682240109"><span class="hs-identifier hs-var">defs</span></a><span class="hs-special">)</span><span>
</span><a name="line-568"></a><span>                   </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682240110"><a href="#local-6989586621682240110"><span class="hs-identifier">uses</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">nonDetEltsUniqSet</span><span> </span><a href="#local-6989586621682240110"><span class="hs-identifier hs-var">uses</span></a><span class="hs-special">)</span><span>
</span><a name="line-569"></a><span>                   </span><span class="hs-comment">-- It's OK to use nonDetEltsUniqSet here as explained in</span><span>
</span><a name="line-570"></a><span>                   </span><span class="hs-comment">-- Note [depAnal determinism] in NameEnv.</span><span>
</span><a name="line-571"></a><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">bagToList</span><span> </span><a href="#local-6989586621682240105"><span class="hs-identifier hs-var">binds_w_dus</span></a><span class="hs-special">)</span><span>
</span><a name="line-572"></a><span>
</span><a name="line-573"></a><span>    </span><a name="local-6989586621682240107"><a href="#local-6989586621682240107"><span class="hs-identifier">get_binds</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AcyclicSCC</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240111"><a href="#local-6989586621682240111"><span class="hs-identifier">bind</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">NonRecursive</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unitBag</span><span> </span><a href="#local-6989586621682240111"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">)</span><span>
</span><a name="line-574"></a><span>    </span><span class="hs-identifier">get_binds</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CyclicSCC</span><span>  </span><a name="local-6989586621682240112"><a href="#local-6989586621682240112"><span class="hs-identifier">binds_w_dus</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Recursive</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">listToBag</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621682240113"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240113"><a href="#local-6989586621682240113"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240112"><span class="hs-identifier hs-var">binds_w_dus</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-575"></a><span>
</span><a name="line-576"></a><span>    </span><a name="local-6989586621682240108"><a href="#local-6989586621682240108"><span class="hs-identifier">get_du</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AcyclicSCC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682240114"><a href="#local-6989586621682240114"><span class="hs-identifier">bndrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240115"><a href="#local-6989586621682240115"><span class="hs-identifier">uses</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkNameSet</span><span> </span><a href="#local-6989586621682240114"><span class="hs-identifier hs-var">bndrs</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240115"><span class="hs-identifier hs-var">uses</span></a><span class="hs-special">)</span><span>
</span><a name="line-577"></a><span>    </span><span class="hs-identifier">get_du</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CyclicSCC</span><span>  </span><a name="local-6989586621682240116"><a href="#local-6989586621682240116"><span class="hs-identifier">binds_w_dus</span></a></a><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621682240117"><span class="hs-identifier hs-var">defs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240118"><span class="hs-identifier hs-var">uses</span></a><span class="hs-special">)</span><span>
</span><a name="line-578"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-579"></a><span>          </span><a name="local-6989586621682240117"><a href="#local-6989586621682240117"><span class="hs-identifier">defs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNameSet</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621682240120"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621682240119"><a href="#local-6989586621682240119"><span class="hs-identifier">bs</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240116"><span class="hs-identifier hs-var">binds_w_dus</span></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240120"><a href="#local-6989586621682240120"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240119"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">]</span><span>
</span><a name="line-580"></a><span>          </span><a name="local-6989586621682240118"><a href="#local-6989586621682240118"><span class="hs-identifier">uses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unionNameSets</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621682240121"><span class="hs-identifier hs-var">u</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621682240121"><a href="#local-6989586621682240121"><span class="hs-identifier">u</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240116"><span class="hs-identifier hs-var">binds_w_dus</span></a><span class="hs-special">]</span><span>
</span><a name="line-581"></a><span>
</span><a name="line-582"></a><span class="hs-comment">---------------------</span><span>
</span><a name="line-583"></a><span class="hs-comment">-- Bind the top-level forall'd type variables in the sigs.</span><span>
</span><a name="line-584"></a><span class="hs-comment">-- E.g  f :: forall a. a -&gt; a</span><span>
</span><a name="line-585"></a><span class="hs-comment">--      f = rhs</span><span>
</span><a name="line-586"></a><span class="hs-comment">--      The 'a' scopes over the rhs</span><span>
</span><a name="line-587"></a><span class="hs-comment">--</span><span>
</span><a name="line-588"></a><span class="hs-comment">-- NB: there'll usually be just one (for a function binding)</span><span>
</span><a name="line-589"></a><span class="hs-comment">--     but if there are many, one may shadow the rest; too bad!</span><span>
</span><a name="line-590"></a><span class="hs-comment">--      e.g  x :: forall a. [a] -&gt; [a]</span><span>
</span><a name="line-591"></a><span class="hs-comment">--           y :: forall a. [(a,a)] -&gt; a</span><span>
</span><a name="line-592"></a><span class="hs-comment">--           (x,y) = e</span><span>
</span><a name="line-593"></a><span class="hs-comment">--      In e, 'a' will be in scope, and it'll be the one from 'y'!</span><span>
</span><a name="line-594"></a><span>
</span><a name="line-595"></a><span class="hs-identifier">mkScopedTvFn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-596"></a><span class="hs-comment">-- Return a lookup function that maps an Id Name to the names</span><span>
</span><a name="line-597"></a><span class="hs-comment">-- of the type variables that should scope over its body.</span><span>
</span><a name="line-598"></a><a name="mkScopedTvFn"><a href="RnBinds.html#mkScopedTvFn"><span class="hs-identifier">mkScopedTvFn</span></a></a><span> </span><a name="local-6989586621682240122"><a href="#local-6989586621682240122"><span class="hs-identifier">sigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682240131"><a href="#local-6989586621682240131"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">lookupNameEnv</span><span> </span><a href="#local-6989586621682240123"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682240131"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">orElse</span><span class="hs-special">`</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-599"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-600"></a><span>    </span><a name="local-6989586621682240123"><a href="#local-6989586621682240123"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkHsSigEnv</span><span> </span><a href="#local-6989586621682240124"><span class="hs-identifier hs-var">get_scoped_tvs</span></a><span> </span><a href="#local-6989586621682240122"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-601"></a><span>
</span><a name="line-602"></a><span>    </span><span class="hs-identifier">get_scoped_tvs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-603"></a><span>    </span><span class="hs-comment">-- Returns (binders, scoped tvs for those binders)</span><span>
</span><a name="line-604"></a><span>    </span><a name="local-6989586621682240124"><a href="#local-6989586621682240124"><span class="hs-identifier">get_scoped_tvs</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassOpSig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240125"><a href="#local-6989586621682240125"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-6989586621682240126"><a href="#local-6989586621682240126"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-605"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240125"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hsScopedTvs</span><span> </span><a href="#local-6989586621682240126"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-606"></a><span>    </span><span class="hs-identifier">get_scoped_tvs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240127"><a href="#local-6989586621682240127"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-6989586621682240128"><a href="#local-6989586621682240128"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-607"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240127"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hsWcScopedTvs</span><span> </span><a href="#local-6989586621682240128"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span>    </span><span class="hs-identifier">get_scoped_tvs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240129"><a href="#local-6989586621682240129"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-6989586621682240130"><a href="#local-6989586621682240130"><span class="hs-identifier">sig_ty</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-609"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240129"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hsScopedTvs</span><span> </span><a href="#local-6989586621682240130"><span class="hs-identifier hs-var">sig_ty</span></a><span class="hs-special">)</span><span>
</span><a name="line-610"></a><span>    </span><span class="hs-identifier">get_scoped_tvs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-611"></a><span>
</span><a name="line-612"></a><span class="hs-comment">-- Process the fixity declarations, making a FastString -&gt; (Located Fixity) map</span><span>
</span><a name="line-613"></a><span class="hs-comment">-- (We keep the location around for reporting duplicate fixity declarations.)</span><span>
</span><a name="line-614"></a><span class="hs-comment">--</span><span>
</span><a name="line-615"></a><span class="hs-comment">-- Checks for duplicates, but not that only locally defined things are fixed.</span><span>
</span><a name="line-616"></a><span class="hs-comment">-- Note: for local fixity declarations, duplicates would also be checked in</span><span>
</span><a name="line-617"></a><span class="hs-comment">--       check_sigs below.  But we also use this function at the top level.</span><span>
</span><a name="line-618"></a><span>
</span><a name="line-619"></a><span class="hs-identifier">makeMiniFixityEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LFixitySig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><a href="RnFixity.html#MiniFixityEnv"><span class="hs-identifier hs-type">MiniFixityEnv</span></a><span>
</span><a name="line-620"></a><span>
</span><a name="line-621"></a><a name="makeMiniFixityEnv"><a href="RnBinds.html#makeMiniFixityEnv"><span class="hs-identifier">makeMiniFixityEnv</span></a></a><span> </span><a name="local-6989586621682240132"><a href="#local-6989586621682240132"><span class="hs-identifier">decls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldlM</span><span> </span><a href="#local-6989586621682240133"><span class="hs-identifier hs-var">add_one_sig</span></a><span> </span><span class="hs-identifier hs-var">emptyFsEnv</span><span> </span><a href="#local-6989586621682240132"><span class="hs-identifier hs-var">decls</span></a><span>
</span><a name="line-622"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-623"></a><span>   </span><a name="local-6989586621682240133"><a href="#local-6989586621682240133"><span class="hs-identifier">add_one_sig</span></a></a><span> </span><a name="local-6989586621682240135"><a href="#local-6989586621682240135"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240136"><a href="#local-6989586621682240136"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixitySig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240137"><a href="#local-6989586621682240137"><span class="hs-identifier">names</span></a></a><span> </span><a name="local-6989586621682240138"><a href="#local-6989586621682240138"><span class="hs-identifier">fixity</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-624"></a><span>     </span><span class="hs-identifier hs-var">foldlM</span><span> </span><a href="#local-6989586621682240134"><span class="hs-identifier hs-var">add_one</span></a><span> </span><a href="#local-6989586621682240135"><span class="hs-identifier hs-var">env</span></a><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240136"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">,</span><a href="#local-6989586621682240139"><span class="hs-identifier hs-var">name_loc</span></a><span class="hs-special">,</span><a href="#local-6989586621682240140"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><a href="#local-6989586621682240138"><span class="hs-identifier hs-var">fixity</span></a><span class="hs-special">)</span><span>
</span><a name="line-625"></a><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240139"><a href="#local-6989586621682240139"><span class="hs-identifier">name_loc</span></a></a><span> </span><a name="local-6989586621682240140"><a href="#local-6989586621682240140"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240137"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-626"></a><span>   </span><span class="hs-identifier">add_one_sig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XFixitySig</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;makeMiniFixityEnv&quot;</span><span>
</span><a name="line-627"></a><span>
</span><a name="line-628"></a><span>   </span><a name="local-6989586621682240134"><a href="#local-6989586621682240134"><span class="hs-identifier">add_one</span></a></a><span> </span><a name="local-6989586621682240141"><a href="#local-6989586621682240141"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621682240142"><a href="#local-6989586621682240142"><span class="hs-identifier">loc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240143"><a href="#local-6989586621682240143"><span class="hs-identifier">name_loc</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240144"><a href="#local-6989586621682240144"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><a name="local-6989586621682240145"><a href="#local-6989586621682240145"><span class="hs-identifier">fixity</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-629"></a><span>     </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- this fixity decl is a duplicate iff</span><span>
</span><a name="line-630"></a><span>       </span><span class="hs-comment">-- the ReaderName's OccName's FastString is already in the env</span><span>
</span><a name="line-631"></a><span>       </span><span class="hs-comment">-- (we only need to check the local fix_env because</span><span>
</span><a name="line-632"></a><span>       </span><span class="hs-comment">--  definitions of non-local will be caught elsewhere)</span><span>
</span><a name="line-633"></a><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240146"><a href="#local-6989586621682240146"><span class="hs-identifier">fs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">occNameFS</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">rdrNameOcc</span><span> </span><a href="#local-6989586621682240144"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-634"></a><span>           </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240147"><a href="#local-6989586621682240147"><span class="hs-identifier">fix_item</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621682240142"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682240145"><span class="hs-identifier hs-var">fixity</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">;</span><span>
</span><a name="line-635"></a><span>
</span><a name="line-636"></a><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookupFsEnv</span><span> </span><a href="#local-6989586621682240141"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682240146"><span class="hs-identifier hs-var">fs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-637"></a><span>         </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">extendFsEnv</span><span> </span><a href="#local-6989586621682240141"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621682240146"><span class="hs-identifier hs-var">fs</span></a><span> </span><a href="#local-6989586621682240147"><span class="hs-identifier hs-var">fix_item</span></a><span>
</span><a name="line-638"></a><span>         </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240148"><a href="#local-6989586621682240148"><span class="hs-identifier">loc'</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-639"></a><span>           </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682240142"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-640"></a><span>             </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-6989586621682240143"><span class="hs-identifier hs-var">name_loc</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#dupFixityDecl"><span class="hs-identifier hs-var">dupFixityDecl</span></a><span> </span><a href="#local-6989586621682240148"><span class="hs-identifier hs-var">loc'</span></a><span> </span><a href="#local-6989586621682240144"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-641"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621682240141"><span class="hs-identifier hs-var">env</span></a><span class="hs-special">}</span><span>
</span><a name="line-642"></a><span>     </span><span class="hs-special">}</span><span>
</span><a name="line-643"></a><span>
</span><a name="line-644"></a><span class="hs-identifier">dupFixityDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SrcSpan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-645"></a><a name="dupFixityDecl"><a href="RnBinds.html#dupFixityDecl"><span class="hs-identifier">dupFixityDecl</span></a></a><span> </span><a name="local-6989586621682240149"><a href="#local-6989586621682240149"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682240150"><a href="#local-6989586621682240150"><span class="hs-identifier">rdr_name</span></a></a><span>
</span><a name="line-646"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Multiple fixity declarations for&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240150"><span class="hs-identifier hs-var">rdr_name</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-647"></a><span>          </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;also at &quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240149"><span class="hs-identifier hs-var">loc</span></a><span class="hs-special">]</span><span>
</span><a name="line-648"></a><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Pattern synonym bindings
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-655"></a><span>
</span><a name="line-656"></a><span class="hs-identifier">rnPatSynBind</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Signature tyvar function</span><span>
</span><a name="line-657"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">PatSynBind</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-658"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">PatSynBind</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Uses</span><span class="hs-special">)</span><span>
</span><a name="line-659"></a><a name="rnPatSynBind"><a href="RnBinds.html#rnPatSynBind"><span class="hs-identifier">rnPatSynBind</span></a></a><span> </span><a name="local-6989586621682240151"><a href="#local-6989586621682240151"><span class="hs-identifier">sig_fn</span></a></a><span> </span><a name="local-6989586621682240152"><a href="#local-6989586621682240152"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PSB</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_id</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240153"><a href="#local-6989586621682240153"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682240154"><a href="#local-6989586621682240154"><span class="hs-identifier">name</span></a></a><span>
</span><a name="line-660"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240155"><a href="#local-6989586621682240155"><span class="hs-identifier">details</span></a></a><span>
</span><a name="line-661"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_def</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240156"><a href="#local-6989586621682240156"><span class="hs-identifier">pat</span></a></a><span>
</span><a name="line-662"></a><span>                              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_dir</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240157"><a href="#local-6989586621682240157"><span class="hs-identifier">dir</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-663"></a><span>       </span><span class="hs-comment">-- invariant: no free vars here when it's a FunBind</span><span>
</span><a name="line-664"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240160"><a href="#local-6989586621682240160"><span class="hs-identifier">pattern_synonym_ok</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.PatternSynonyms</span><span>
</span><a name="line-665"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621682240160"><span class="hs-identifier hs-var">pattern_synonym_ok</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><a href="#local-6989586621682240159"><span class="hs-identifier hs-var">patternSynonymErr</span></a><span class="hs-special">)</span><span>
</span><a name="line-666"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240161"><a href="#local-6989586621682240161"><span class="hs-identifier">scoped_tvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240151"><span class="hs-identifier hs-var">sig_fn</span></a><span> </span><a href="#local-6989586621682240154"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-667"></a><span>
</span><a name="line-668"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621682240176"><a href="#local-6989586621682240176"><span class="hs-identifier">pat'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240177"><a href="#local-6989586621682240177"><span class="hs-identifier">details'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682240178"><a href="#local-6989586621682240178"><span class="hs-identifier">fvs1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#bindSigTyVarsFV"><span class="hs-identifier hs-var">bindSigTyVarsFV</span></a><span> </span><a href="#local-6989586621682240161"><span class="hs-identifier hs-var">scoped_tvs</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-669"></a><span>                                      </span><a href="RnPat.html#rnPat"><span class="hs-identifier hs-var">rnPat</span></a><span> </span><span class="hs-identifier hs-var">PatSyn</span><span> </span><a href="#local-6989586621682240156"><span class="hs-identifier hs-var">pat</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621682240162"><a href="#local-6989586621682240162"><span class="hs-identifier">pat'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-670"></a><span>         </span><span class="hs-comment">-- We check the 'RdrName's instead of the 'Name's</span><span>
</span><a name="line-671"></a><span>         </span><span class="hs-comment">-- so that the binding locations are reported</span><span>
</span><a name="line-672"></a><span>         </span><span class="hs-comment">-- from the left-hand side</span><span>
</span><a name="line-673"></a><span>            </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682240155"><span class="hs-identifier hs-var">details</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-674"></a><span>               </span><span class="hs-identifier hs-var">PrefixCon</span><span> </span><a name="local-6989586621682240163"><a href="#local-6989586621682240163"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-675"></a><span>                   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnUtils.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span> </span><a href="#local-6989586621682240163"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-676"></a><span>                      </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240164"><a href="#local-6989586621682240164"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621682240158"><span class="hs-identifier hs-var">lookupPatSynBndr</span></a><span> </span><a href="#local-6989586621682240163"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-677"></a><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240162"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">PrefixCon</span><span> </span><a href="#local-6989586621682240164"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span>
</span><a name="line-678"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkFVs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><a href="#local-6989586621682240164"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-679"></a><span>               </span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a name="local-6989586621682240165"><a href="#local-6989586621682240165"><span class="hs-identifier">var1</span></a></a><span> </span><a name="local-6989586621682240166"><a href="#local-6989586621682240166"><span class="hs-identifier">var2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-680"></a><span>                   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnUtils.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621682240165"><span class="hs-identifier hs-var">var1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240166"><span class="hs-identifier hs-var">var2</span></a><span class="hs-special">]</span><span>
</span><a name="line-681"></a><span>                      </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240167"><a href="#local-6989586621682240167"><span class="hs-identifier">name1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240158"><span class="hs-identifier hs-var">lookupPatSynBndr</span></a><span> </span><a href="#local-6989586621682240165"><span class="hs-identifier hs-var">var1</span></a><span>
</span><a name="line-682"></a><span>                      </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240168"><a href="#local-6989586621682240168"><span class="hs-identifier">name2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240158"><span class="hs-identifier hs-var">lookupPatSynBndr</span></a><span> </span><a href="#local-6989586621682240166"><span class="hs-identifier hs-var">var2</span></a><span>
</span><a name="line-683"></a><span>                      </span><span class="hs-comment">-- ; checkPrecMatch -- TODO</span><span>
</span><a name="line-684"></a><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240162"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">InfixCon</span><span> </span><a href="#local-6989586621682240167"><span class="hs-identifier hs-var">name1</span></a><span> </span><a href="#local-6989586621682240168"><span class="hs-identifier hs-var">name2</span></a><span class="hs-special">)</span><span>
</span><a name="line-685"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkFVs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621682240167"><span class="hs-identifier hs-var">name1</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240168"><span class="hs-identifier hs-var">name2</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-686"></a><span>               </span><span class="hs-identifier hs-var">RecCon</span><span> </span><a name="local-6989586621682240169"><a href="#local-6989586621682240169"><span class="hs-identifier">vars</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-687"></a><span>                   </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnUtils.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">recordPatSynSelectorId</span><span> </span><a href="#local-6989586621682240169"><span class="hs-identifier hs-var">vars</span></a><span class="hs-special">)</span><span>
</span><a name="line-688"></a><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240170"><a href="#local-6989586621682240170"><span class="hs-identifier">rnRecordPatSynField</span></a></a><span>
</span><a name="line-689"></a><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RecordPatSynField</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">recordPatSynSelectorId</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240171"><a href="#local-6989586621682240171"><span class="hs-identifier">visible</span></a></a><span>
</span><a name="line-690"></a><span>                                                 </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recordPatSynPatVar</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240172"><a href="#local-6989586621682240172"><span class="hs-identifier">hidden</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-691"></a><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240173"><a href="#local-6989586621682240173"><span class="hs-identifier">visible'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocatedTopBndrRn"><span class="hs-identifier hs-var">lookupLocatedTopBndrRn</span></a><span> </span><a href="#local-6989586621682240171"><span class="hs-identifier hs-var">visible</span></a><span>
</span><a name="line-692"></a><span>                                   </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240174"><a href="#local-6989586621682240174"><span class="hs-identifier">hidden'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240158"><span class="hs-identifier hs-var">lookupPatSynBndr</span></a><span> </span><a href="#local-6989586621682240172"><span class="hs-identifier hs-var">hidden</span></a><span>
</span><a name="line-693"></a><span>                                   </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">RecordPatSynField</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">recordPatSynSelectorId</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240173"><span class="hs-identifier hs-var">visible'</span></a><span>
</span><a name="line-694"></a><span>                                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">recordPatSynPatVar</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240174"><span class="hs-identifier hs-var">hidden'</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-695"></a><span>                      </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240175"><a href="#local-6989586621682240175"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621682240170"><span class="hs-identifier hs-var">rnRecordPatSynField</span></a><span>  </span><a href="#local-6989586621682240169"><span class="hs-identifier hs-var">vars</span></a><span>
</span><a name="line-696"></a><span>                      </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240162"><span class="hs-identifier hs-var">pat'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">RecCon</span><span> </span><a href="#local-6989586621682240175"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span>
</span><a name="line-697"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mkFVs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">recordPatSynPatVar</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240175"><span class="hs-identifier hs-var">names</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-698"></a><span>
</span><a name="line-699"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240182"><a href="#local-6989586621682240182"><span class="hs-identifier">dir'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240183"><a href="#local-6989586621682240183"><span class="hs-identifier">fvs2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682240157"><span class="hs-identifier hs-var">dir</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-700"></a><span>            </span><span class="hs-identifier hs-var">Unidirectional</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Unidirectional</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span>
</span><a name="line-701"></a><span>            </span><span class="hs-identifier hs-var">ImplicitBidirectional</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ImplicitBidirectional</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span>
</span><a name="line-702"></a><span>            </span><span class="hs-identifier hs-var">ExplicitBidirectional</span><span> </span><a name="local-6989586621682240179"><a href="#local-6989586621682240179"><span class="hs-identifier">mg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-703"></a><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240180"><a href="#local-6989586621682240180"><span class="hs-identifier">mg'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240181"><a href="#local-6989586621682240181"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#bindSigTyVarsFV"><span class="hs-identifier hs-var">bindSigTyVarsFV</span></a><span> </span><a href="#local-6989586621682240161"><span class="hs-identifier hs-var">scoped_tvs</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-704"></a><span>                                   </span><a href="RnBinds.html#rnMatchGroup"><span class="hs-identifier hs-var">rnMatchGroup</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkPrefixFunRhs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621682240153"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621682240154"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-705"></a><span>                                                </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621682240179"><span class="hs-identifier hs-var">mg</span></a><span>
</span><a name="line-706"></a><span>                   </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExplicitBidirectional</span><span> </span><a href="#local-6989586621682240180"><span class="hs-identifier hs-var">mg'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240181"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-707"></a><span>
</span><a name="line-708"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240184"><a href="#local-6989586621682240184"><span class="hs-identifier">mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">getModule</span><span>
</span><a name="line-709"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240185"><a href="#local-6989586621682240185"><span class="hs-identifier">fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240178"><span class="hs-identifier hs-var">fvs1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682240183"><span class="hs-identifier hs-var">fvs2</span></a><span>
</span><a name="line-710"></a><span>              </span><a name="local-6989586621682240186"><a href="#local-6989586621682240186"><span class="hs-identifier">fvs'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filterNameSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nameIsLocalOrFrom</span><span> </span><a href="#local-6989586621682240184"><span class="hs-identifier hs-var">mod</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240185"><span class="hs-identifier hs-var">fvs</span></a><span>
</span><a name="line-711"></a><span>                </span><span class="hs-comment">-- Keep locally-defined Names</span><span>
</span><a name="line-712"></a><span>                </span><span class="hs-comment">-- As well as dependency analysis, we need these for the</span><span>
</span><a name="line-713"></a><span>                </span><span class="hs-comment">-- MonoLocalBinds test in TcBinds.decideGeneralisationPlan</span><span>
</span><a name="line-714"></a><span>
</span><a name="line-715"></a><span>              </span><a name="local-6989586621682240187"><a href="#local-6989586621682240187"><span class="hs-identifier">bind'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240152"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">{</span><span> </span><span class="hs-identifier">psb_args</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240177"><span class="hs-identifier hs-var">details'</span></a><span>
</span><a name="line-716"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_def</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240176"><span class="hs-identifier hs-var">pat'</span></a><span>
</span><a name="line-717"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_dir</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240182"><span class="hs-identifier hs-var">dir'</span></a><span>
</span><a name="line-718"></a><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">psb_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240186"><span class="hs-identifier hs-var">fvs'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-719"></a><span>              </span><a name="local-6989586621682240188"><a href="#local-6989586621682240188"><span class="hs-identifier">selector_names</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682240177"><span class="hs-identifier hs-var">details'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-720"></a><span>                                 </span><span class="hs-identifier hs-var">RecCon</span><span> </span><a name="local-6989586621682240189"><a href="#local-6989586621682240189"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-721"></a><span>                                  </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">unLoc</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">recordPatSynSelectorId</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240189"><span class="hs-identifier hs-var">names</span></a><span>
</span><a name="line-722"></a><span>                                 </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-723"></a><span>
</span><a name="line-724"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="#local-6989586621682240186"><span class="hs-identifier hs-var">fvs'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">seq</span><span class="hs-special">`</span><span> </span><span class="hs-comment">-- See Note [Free-variable space leak]</span><span>
</span><a name="line-725"></a><span>          </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240187"><span class="hs-identifier hs-var">bind'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240154"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621682240188"><span class="hs-identifier hs-var">selector_names</span></a><span> </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240178"><span class="hs-identifier hs-var">fvs1</span></a><span class="hs-special">)</span><span>
</span><a name="line-726"></a><span>          </span><span class="hs-comment">-- Why fvs1?  See Note [Pattern synonym builders don't yield dependencies]</span><span>
</span><a name="line-727"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-728"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-729"></a><span>    </span><span class="hs-comment">-- See Note [Renaming pattern synonym variables]</span><span>
</span><a name="line-730"></a><span>    </span><a name="local-6989586621682240158"><a href="#local-6989586621682240158"><span class="hs-identifier">lookupPatSynBndr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><a href="RnEnv.html#lookupLocalOccRn"><span class="hs-identifier hs-var">lookupLocalOccRn</span></a><span>
</span><a name="line-731"></a><span>
</span><a name="line-732"></a><span>    </span><span class="hs-identifier">patternSynonymErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-733"></a><span>    </span><a name="local-6989586621682240159"><a href="#local-6989586621682240159"><span class="hs-identifier">patternSynonymErr</span></a></a><span>
</span><a name="line-734"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Illegal pattern synonym declaration&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-735"></a><span>           </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Use -XPatternSynonyms to enable this extension&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-736"></a><span>
</span><a name="line-737"></a><span class="hs-identifier">rnPatSynBind</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XPatSynBind</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnPatSynBind&quot;</span><span>
</span><a name="line-738"></a><span>
</span><a name="line-739"></a><span class="hs-comment">{-
Note [Renaming pattern synonym variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

We rename pattern synonym declaractions backwards to normal to reuse
the logic already implemented for renaming patterns.

We first rename the RHS of a declaration which brings into
scope the variables bound by the pattern (as they would be
in normal function definitions). We then lookup the variables
which we want to bind in this local environment.

It is crucial that we then only lookup in the *local* environment which
only contains the variables brought into scope by the pattern and nothing
else. Amazingly no-one encountered this bug for 3 GHC versions but
it was possible to define a pattern synonym which referenced global
identifiers and worked correctly.

```
x = 5

pattern P :: Int -&gt; ()
pattern P x &lt;- _

f (P x) = x

&gt; f () = 5
```

See #13470 for the original report.

Note [Pattern synonym builders don't yield dependencies]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When renaming a pattern synonym that has an explicit builder,
references in the builder definition should not be used when
calculating dependencies. For example, consider the following pattern
synonym definition:

pattern P x &lt;- C1 x where
  P x = f (C1 x)

f (P x) = C2 x

In this case, 'P' needs to be typechecked in two passes:

1. Typecheck the pattern definition of 'P', which fully determines the
   type of 'P'. This step doesn't require knowing anything about 'f',
   since the builder definition is not looked at.

2. Typecheck the builder definition, which needs the typechecked
   definition of 'f' to be in scope; done by calls oo tcPatSynBuilderBind
   in TcBinds.tcValBinds.

This behaviour is implemented in 'tcValBinds', but it crucially
depends on 'P' not being put in a recursive group with 'f' (which
would make it look like a recursive pattern synonym a la 'pattern P =
P' which is unsound and rejected).

So:
 * We do not include builder fvs in the Uses returned by rnPatSynBind
   (which is then used for dependency analysis)
 * But we /do/ include them in the psb_fvs for the PatSynBind
 * In rnValBinds we record these builder uses, to avoid bogus
   unused-variable warnings (Trac #12548)
-}</span><span>
</span><a name="line-804"></a><span>
</span><a name="line-805"></a><span class="hs-comment">{- *********************************************************************
*                                                                      *
                Class/instance method bindings
*                                                                      *
********************************************************************* -}</span><span>
</span><a name="line-810"></a><span>
</span><a name="line-811"></a><span class="hs-comment">{- @rnMethodBinds@ is used for the method bindings of a class and an instance
declaration.   Like @rnBinds@ but without dependency analysis.

NOTA BENE: we record each {\em binder} of a method-bind group as a free variable.
That's crucial when dealing with an instance decl:
\begin{verbatim}
        instance Foo (T a) where
           op x = ...
\end{verbatim}
This might be the {\em sole} occurrence of @op@ for an imported class @Foo@,
and unless @op@ occurs we won't treat the type signature of @op@ in the class
decl for @Foo@ as a source of instance-decl gates.  But we should!  Indeed,
in many ways the @op@ in an instance decl is just like an occurrence, not
a binder.
-}</span><span>
</span><a name="line-826"></a><span>
</span><a name="line-827"></a><span class="hs-identifier">rnMethodBinds</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>                   </span><span class="hs-comment">-- True &lt;=&gt; is a class declaration</span><span>
</span><a name="line-828"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>                   </span><span class="hs-comment">-- Class name</span><span>
</span><a name="line-829"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- Type variables from the class/instance header</span><span>
</span><a name="line-830"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>         </span><span class="hs-comment">-- Binds</span><span>
</span><a name="line-831"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- and signatures/pragmas</span><span>
</span><a name="line-832"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBinds</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-833"></a><span class="hs-comment">-- Used for</span><span>
</span><a name="line-834"></a><span class="hs-comment">--   * the default method bindings in a class decl</span><span>
</span><a name="line-835"></a><span class="hs-comment">--   * the method bindings in an instance decl</span><span>
</span><a name="line-836"></a><a name="rnMethodBinds"><a href="RnBinds.html#rnMethodBinds"><span class="hs-identifier">rnMethodBinds</span></a></a><span> </span><a name="local-6989586621682240190"><a href="#local-6989586621682240190"><span class="hs-identifier">is_cls_decl</span></a></a><span> </span><a name="local-6989586621682240191"><a href="#local-6989586621682240191"><span class="hs-identifier">cls</span></a></a><span> </span><a name="local-6989586621682240192"><a href="#local-6989586621682240192"><span class="hs-identifier">ktv_names</span></a></a><span> </span><a name="local-6989586621682240193"><a href="#local-6989586621682240193"><span class="hs-identifier">binds</span></a></a><span> </span><a name="local-6989586621682240194"><a href="#local-6989586621682240194"><span class="hs-identifier">sigs</span></a></a><span>
</span><a name="line-837"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="RnUtils.html#checkDupRdrNames"><span class="hs-identifier hs-var">checkDupRdrNames</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">collectMethodBinders</span><span> </span><a href="#local-6989586621682240193"><span class="hs-identifier hs-var">binds</span></a><span class="hs-special">)</span><span>
</span><a name="line-838"></a><span>             </span><span class="hs-comment">-- Check that the same method is not given twice in the</span><span>
</span><a name="line-839"></a><span>             </span><span class="hs-comment">-- same instance decl      instance C T where</span><span>
</span><a name="line-840"></a><span>             </span><span class="hs-comment">--                       f x = ...</span><span>
</span><a name="line-841"></a><span>             </span><span class="hs-comment">--                       g y = ...</span><span>
</span><a name="line-842"></a><span>             </span><span class="hs-comment">--                       f x = ...</span><span>
</span><a name="line-843"></a><span>             </span><span class="hs-comment">-- We must use checkDupRdrNames because the Name of the</span><span>
</span><a name="line-844"></a><span>             </span><span class="hs-comment">-- method is the Name of the class selector, whose SrcSpan</span><span>
</span><a name="line-845"></a><span>             </span><span class="hs-comment">-- points to the class declaration; and we use rnMethodBinds</span><span>
</span><a name="line-846"></a><span>             </span><span class="hs-comment">-- for instance decls too</span><span>
</span><a name="line-847"></a><span>
</span><a name="line-848"></a><span>       </span><span class="hs-comment">-- Rename the bindings LHSs</span><span>
</span><a name="line-849"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240198"><a href="#local-6989586621682240198"><span class="hs-identifier">binds'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">foldrBagM</span><span> </span><span class="hs-special">(</span><a href="RnBinds.html#rnMethodBindLHS"><span class="hs-identifier hs-var">rnMethodBindLHS</span></a><span> </span><a href="#local-6989586621682240190"><span class="hs-identifier hs-var">is_cls_decl</span></a><span> </span><a href="#local-6989586621682240191"><span class="hs-identifier hs-var">cls</span></a><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">emptyBag</span><span> </span><a href="#local-6989586621682240193"><span class="hs-identifier hs-var">binds</span></a><span>
</span><a name="line-850"></a><span>
</span><a name="line-851"></a><span>       </span><span class="hs-comment">-- Rename the pragmas and signatures</span><span>
</span><a name="line-852"></a><span>       </span><span class="hs-comment">-- Annoyingly the type variables /are/ in scope for signatures, but</span><span>
</span><a name="line-853"></a><span>       </span><span class="hs-comment">-- /are not/ in scope in the SPECIALISE instance pramas; e.g.</span><span>
</span><a name="line-854"></a><span>       </span><span class="hs-comment">--    instance Eq a =&gt; Eq (T a) where</span><span>
</span><a name="line-855"></a><span>       </span><span class="hs-comment">--       (==) :: a -&gt; a -&gt; a</span><span>
</span><a name="line-856"></a><span>       </span><span class="hs-comment">--       {-# SPECIALISE instance Eq a =&gt; Eq (T [a]) #-}</span><span>
</span><a name="line-857"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240199"><a href="#local-6989586621682240199"><span class="hs-identifier">spec_inst_prags</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240200"><a href="#local-6989586621682240200"><span class="hs-identifier">other_sigs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-identifier hs-var">isSpecInstLSig</span><span> </span><a href="#local-6989586621682240194"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-858"></a><span>             </span><a name="local-6989586621682240201"><a href="#local-6989586621682240201"><span class="hs-identifier">bound_nms</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkNameSet</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">collectHsBindsBinders</span><span> </span><a href="#local-6989586621682240198"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">)</span><span>
</span><a name="line-859"></a><span>             </span><a name="local-6989586621682240202"><a href="#local-6989586621682240202"><span class="hs-identifier">sig_ctxt</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682240190"><span class="hs-identifier hs-var">is_cls_decl</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#ClsDeclCtxt"><span class="hs-identifier hs-var">ClsDeclCtxt</span></a><span> </span><a href="#local-6989586621682240191"><span class="hs-identifier hs-var">cls</span></a><span>
</span><a name="line-860"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="RnEnv.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a><span> </span><a href="#local-6989586621682240201"><span class="hs-identifier hs-var">bound_nms</span></a><span>
</span><a name="line-861"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240203"><a href="#local-6989586621682240203"><span class="hs-identifier">spec_inst_prags'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240204"><a href="#local-6989586621682240204"><span class="hs-identifier">sip_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#renameSigs"><span class="hs-identifier hs-var">renameSigs</span></a><span> </span><a href="#local-6989586621682240202"><span class="hs-identifier hs-var">sig_ctxt</span></a><span> </span><a href="#local-6989586621682240199"><span class="hs-identifier hs-var">spec_inst_prags</span></a><span>
</span><a name="line-862"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240205"><a href="#local-6989586621682240205"><span class="hs-identifier">other_sigs'</span></a></a><span class="hs-special">,</span><span>      </span><a name="local-6989586621682240206"><a href="#local-6989586621682240206"><span class="hs-identifier">sig_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#extendTyVarEnvFVRn"><span class="hs-identifier hs-var">extendTyVarEnvFVRn</span></a><span> </span><a href="#local-6989586621682240192"><span class="hs-identifier hs-var">ktv_names</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-863"></a><span>                                        </span><a href="RnBinds.html#renameSigs"><span class="hs-identifier hs-var">renameSigs</span></a><span> </span><a href="#local-6989586621682240202"><span class="hs-identifier hs-var">sig_ctxt</span></a><span> </span><a href="#local-6989586621682240200"><span class="hs-identifier hs-var">other_sigs</span></a><span>
</span><a name="line-864"></a><span>
</span><a name="line-865"></a><span>       </span><span class="hs-comment">-- Rename the bindings RHSs.  Again there's an issue about whether the</span><span>
</span><a name="line-866"></a><span>       </span><span class="hs-comment">-- type variables from the class/instance head are in scope.</span><span>
</span><a name="line-867"></a><span>       </span><span class="hs-comment">-- Answer no in Haskell 2010, but yes if you have -XScopedTypeVariables</span><span>
</span><a name="line-868"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240207"><a href="#local-6989586621682240207"><span class="hs-identifier">scoped_tvs</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.ScopedTypeVariables</span><span>
</span><a name="line-869"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240212"><a href="#local-6989586621682240212"><span class="hs-identifier">binds''</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240213"><a href="#local-6989586621682240213"><span class="hs-identifier">bind_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240195"><span class="hs-identifier hs-var">maybe_extend_tyvar_env</span></a><span> </span><a href="#local-6989586621682240207"><span class="hs-identifier hs-var">scoped_tvs</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-870"></a><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240208"><a href="#local-6989586621682240208"><span class="hs-identifier">binds_w_dus</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapBagM</span><span> </span><span class="hs-special">(</span><a href="RnBinds.html#rnLBind"><span class="hs-identifier hs-var">rnLBind</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#mkScopedTvFn"><span class="hs-identifier hs-var">mkScopedTvFn</span></a><span> </span><a href="#local-6989586621682240205"><span class="hs-identifier hs-var">other_sigs'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240198"><span class="hs-identifier hs-var">binds'</span></a><span>
</span><a name="line-871"></a><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240209"><a href="#local-6989586621682240209"><span class="hs-identifier">bind_fvs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldrBag</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621682240210"><a href="#local-6989586621682240210"><span class="hs-identifier">fv1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682240211"><a href="#local-6989586621682240211"><span class="hs-identifier">fv2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682240210"><span class="hs-identifier hs-var">fv1</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682240211"><span class="hs-identifier hs-var">fv2</span></a><span class="hs-special">)</span><span>
</span><a name="line-872"></a><span>                                           </span><span class="hs-identifier hs-var">emptyFVs</span><span> </span><a href="#local-6989586621682240208"><span class="hs-identifier hs-var">binds_w_dus</span></a><span>
</span><a name="line-873"></a><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mapBag</span><span> </span><span class="hs-identifier hs-var">fstOf3</span><span> </span><a href="#local-6989586621682240208"><span class="hs-identifier hs-var">binds_w_dus</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240209"><span class="hs-identifier hs-var">bind_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-874"></a><span>
</span><a name="line-875"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621682240212"><span class="hs-identifier hs-var">binds''</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240203"><span class="hs-identifier hs-var">spec_inst_prags'</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621682240205"><span class="hs-identifier hs-var">other_sigs'</span></a><span>
</span><a name="line-876"></a><span>                </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240206"><span class="hs-identifier hs-var">sig_fvs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682240204"><span class="hs-identifier hs-var">sip_fvs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682240213"><span class="hs-identifier hs-var">bind_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-877"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-878"></a><span>    </span><span class="hs-comment">-- For the method bindings in class and instance decls, we extend</span><span>
</span><a name="line-879"></a><span>    </span><span class="hs-comment">-- the type variable environment iff -XScopedTypeVariables</span><span>
</span><a name="line-880"></a><span>    </span><a name="local-6989586621682240195"><a href="#local-6989586621682240195"><span class="hs-identifier">maybe_extend_tyvar_env</span></a></a><span> </span><a name="local-6989586621682240196"><a href="#local-6989586621682240196"><span class="hs-identifier">scoped_tvs</span></a></a><span> </span><a name="local-6989586621682240197"><a href="#local-6989586621682240197"><span class="hs-identifier">thing_inside</span></a></a><span>
</span><a name="line-881"></a><span>       </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682240196"><span class="hs-identifier hs-var">scoped_tvs</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#extendTyVarEnvFVRn"><span class="hs-identifier hs-var">extendTyVarEnvFVRn</span></a><span> </span><a href="#local-6989586621682240192"><span class="hs-identifier hs-var">ktv_names</span></a><span> </span><a href="#local-6989586621682240197"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-882"></a><span>       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240197"><span class="hs-identifier hs-var">thing_inside</span></a><span>
</span><a name="line-883"></a><span>
</span><a name="line-884"></a><span class="hs-identifier">rnMethodBindLHS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-885"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBindLR</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-886"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LHsBindsLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span>
</span><a name="line-887"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LHsBindsLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span>
</span><a name="line-888"></a><a name="rnMethodBindLHS"><a href="RnBinds.html#rnMethodBindLHS"><span class="hs-identifier">rnMethodBindLHS</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240214"><a href="#local-6989586621682240214"><span class="hs-identifier">cls</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240215"><a href="#local-6989586621682240215"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682240216"><a href="#local-6989586621682240216"><span class="hs-identifier">bind</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunBind</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240217"><a href="#local-6989586621682240217"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a name="local-6989586621682240218"><a href="#local-6989586621682240218"><span class="hs-identifier">rest</span></a></a><span>
</span><a name="line-889"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682240215"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-890"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240219"><a href="#local-6989586621682240219"><span class="hs-identifier">sel_name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupInstDeclBndr"><span class="hs-identifier hs-var">lookupInstDeclBndr</span></a><span> </span><a href="#local-6989586621682240214"><span class="hs-identifier hs-var">cls</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;method&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240217"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-891"></a><span>                     </span><span class="hs-comment">-- We use the selector name as the binder</span><span>
</span><a name="line-892"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240220"><a href="#local-6989586621682240220"><span class="hs-identifier">bind'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240216"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">fun_id</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240219"><span class="hs-identifier hs-var">sel_name</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">fun_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-893"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621682240215"><span class="hs-identifier hs-var">loc</span></a><span> </span><a href="#local-6989586621682240220"><span class="hs-identifier hs-var">bind'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">consBag</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682240218"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-894"></a><span>
</span><a name="line-895"></a><span class="hs-comment">-- Report error for all other forms of bindings</span><span>
</span><a name="line-896"></a><span class="hs-comment">-- This is why we use a fold rather than map</span><span>
</span><a name="line-897"></a><span class="hs-identifier">rnMethodBindLHS</span><span> </span><a name="local-6989586621682240221"><a href="#local-6989586621682240221"><span class="hs-identifier">is_cls_decl</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240222"><a href="#local-6989586621682240222"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682240223"><a href="#local-6989586621682240223"><span class="hs-identifier">bind</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682240224"><a href="#local-6989586621682240224"><span class="hs-identifier">rest</span></a></a><span>
</span><a name="line-898"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-6989586621682240222"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-899"></a><span>         </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621682240226"><span class="hs-identifier hs-var">what</span></a><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;not allowed in&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621682240225"><span class="hs-identifier hs-var">decl_sort</span></a><span>
</span><a name="line-900"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nest</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240223"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-901"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621682240224"><span class="hs-identifier hs-var">rest</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-902"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-903"></a><span>    </span><a name="local-6989586621682240225"><a href="#local-6989586621682240225"><span class="hs-identifier">decl_sort</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621682240221"><span class="hs-identifier hs-var">is_cls_decl</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;class declaration:&quot;</span><span>
</span><a name="line-904"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;instance declaration:&quot;</span><span>
</span><a name="line-905"></a><span>    </span><a name="local-6989586621682240226"><a href="#local-6989586621682240226"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682240223"><span class="hs-identifier hs-var">bind</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-906"></a><span>              </span><span class="hs-identifier hs-var">PatBind</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Pattern bindings (except simple variables)&quot;</span><span>
</span><a name="line-907"></a><span>              </span><span class="hs-identifier hs-var">PatSynBind</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Pattern synonyms&quot;</span><span>
</span><a name="line-908"></a><span>                               </span><span class="hs-comment">-- Associated pattern synonyms are not implemented yet</span><span>
</span><a name="line-909"></a><span>              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pprPanic</span><span> </span><span class="hs-string">&quot;rnMethodBind&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240223"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">)</span><span>
</span><a name="line-910"></a><span>
</span><a name="line-911"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection[dep-Sigs]{Signatures (and user-pragmas for values)}
*                                                                      *
************************************************************************

@renameSigs@ checks for:
\begin{enumerate}
\item more than one sig for one thing;
\item signatures given for things not bound here;
\end{enumerate}

At the moment we don't gather free-var info from the types in
signatures.  We'd only need this if we wanted to report unused tyvars.
-}</span><span>
</span><a name="line-927"></a><span>
</span><a name="line-928"></a><span class="hs-identifier">renameSigs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnEnv.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a><span>
</span><a name="line-929"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span>
</span><a name="line-930"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-931"></a><span class="hs-comment">-- Renames the signatures and performs error checks</span><span>
</span><a name="line-932"></a><a name="renameSigs"><a href="RnBinds.html#renameSigs"><span class="hs-identifier">renameSigs</span></a></a><span> </span><a name="local-6989586621682240227"><a href="#local-6989586621682240227"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240228"><a href="#local-6989586621682240228"><span class="hs-identifier">sigs</span></a></a><span>
</span><a name="line-933"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="RnBinds.html#dupSigDeclErr"><span class="hs-identifier hs-var">dupSigDeclErr</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#findDupSigs"><span class="hs-identifier hs-var">findDupSigs</span></a><span> </span><a href="#local-6989586621682240228"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">)</span><span>
</span><a name="line-934"></a><span>
</span><a name="line-935"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="RnBinds.html#checkDupMinimalSigs"><span class="hs-identifier hs-var">checkDupMinimalSigs</span></a><span> </span><a href="#local-6989586621682240228"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-936"></a><span>
</span><a name="line-937"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240229"><a href="#local-6989586621682240229"><span class="hs-identifier">sigs'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240230"><a href="#local-6989586621682240230"><span class="hs-identifier">sig_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#renameSig"><span class="hs-identifier hs-var">renameSig</span></a><span> </span><a href="#local-6989586621682240227"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240228"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-938"></a><span>
</span><a name="line-939"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240231"><a href="#local-6989586621682240231"><span class="hs-identifier">good_sigs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240232"><a href="#local-6989586621682240232"><span class="hs-identifier">bad_sigs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-special">(</span><a href="RnBinds.html#okHsSig"><span class="hs-identifier hs-var">okHsSig</span></a><span> </span><a href="#local-6989586621682240227"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240229"><span class="hs-identifier hs-var">sigs'</span></a><span>
</span><a name="line-940"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="RnBinds.html#misplacedSigErr"><span class="hs-identifier hs-var">misplacedSigErr</span></a><span> </span><a href="#local-6989586621682240232"><span class="hs-identifier hs-var">bad_sigs</span></a><span>                 </span><span class="hs-comment">-- Misplaced</span><span>
</span><a name="line-941"></a><span>
</span><a name="line-942"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240231"><span class="hs-identifier hs-var">good_sigs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240230"><span class="hs-identifier hs-var">sig_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-943"></a><span>
</span><a name="line-944"></a><span class="hs-comment">----------------------</span><span>
</span><a name="line-945"></a><span class="hs-comment">-- We use lookupSigOccRn in the signatures, which is a little bit unsatisfactory</span><span>
</span><a name="line-946"></a><span class="hs-comment">-- because this won't work for:</span><span>
</span><a name="line-947"></a><span class="hs-comment">--      instance Foo T where</span><span>
</span><a name="line-948"></a><span class="hs-comment">--        {-# INLINE op #-}</span><span>
</span><a name="line-949"></a><span class="hs-comment">--        Baz.op = ...</span><span>
</span><a name="line-950"></a><span class="hs-comment">-- We'll just rename the INLINE prag to refer to whatever other 'op'</span><span>
</span><a name="line-951"></a><span class="hs-comment">-- is in scope.  (I'm assuming that Baz.op isn't in scope unqualified.)</span><span>
</span><a name="line-952"></a><span class="hs-comment">-- Doesn't seem worth much trouble to sort this.</span><span>
</span><a name="line-953"></a><span>
</span><a name="line-954"></a><span class="hs-identifier">renameSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnEnv.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Sig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Sig</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-955"></a><a name="renameSig"><a href="RnBinds.html#renameSig"><span class="hs-identifier">renameSig</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IdSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240233"><a href="#local-6989586621682240233"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-956"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IdSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240233"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Actually this never occurs</span><span>
</span><a name="line-957"></a><span>
</span><a name="line-958"></a><span class="hs-identifier">renameSig</span><span> </span><a name="local-6989586621682240234"><a href="#local-6989586621682240234"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240235"><a href="#local-6989586621682240235"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240236"><a href="#local-6989586621682240236"><span class="hs-identifier">vs</span></a></a><span> </span><a name="local-6989586621682240237"><a href="#local-6989586621682240237"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-959"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240238"><a href="#local-6989586621682240238"><span class="hs-identifier">new_vs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupSigOccRn"><span class="hs-identifier hs-var">lookupSigOccRn</span></a><span> </span><a href="#local-6989586621682240234"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240235"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240236"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-960"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240239"><a href="#local-6989586621682240239"><span class="hs-identifier">doc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#TypeSigCtx"><span class="hs-identifier hs-var">TypeSigCtx</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#ppr_sig_bndrs"><span class="hs-identifier hs-var">ppr_sig_bndrs</span></a><span> </span><a href="#local-6989586621682240236"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">)</span><span>
</span><a name="line-961"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240240"><a href="#local-6989586621682240240"><span class="hs-identifier">new_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240241"><a href="#local-6989586621682240241"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigWcType"><span class="hs-identifier hs-var">rnHsSigWcType</span></a><span> </span><a href="RnTypes.html#BindUnlessForall"><span class="hs-identifier hs-var">BindUnlessForall</span></a><span> </span><a href="#local-6989586621682240239"><span class="hs-identifier hs-var">doc</span></a><span> </span><a href="#local-6989586621682240237"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-962"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240238"><span class="hs-identifier hs-var">new_vs</span></a><span> </span><a href="#local-6989586621682240240"><span class="hs-identifier hs-var">new_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240241"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-963"></a><span>
</span><a name="line-964"></a><span class="hs-identifier">renameSig</span><span> </span><a name="local-6989586621682240242"><a href="#local-6989586621682240242"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240243"><a href="#local-6989586621682240243"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassOpSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240244"><a href="#local-6989586621682240244"><span class="hs-identifier">is_deflt</span></a></a><span> </span><a name="local-6989586621682240245"><a href="#local-6989586621682240245"><span class="hs-identifier">vs</span></a></a><span> </span><a name="local-6989586621682240246"><a href="#local-6989586621682240246"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-965"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240249"><a href="#local-6989586621682240249"><span class="hs-identifier">defaultSigs_on</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.DefaultSignatures</span><span>
</span><a name="line-966"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240244"><span class="hs-identifier hs-var">is_deflt</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621682240249"><span class="hs-identifier hs-var">defaultSigs_on</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-967"></a><span>          </span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#defaultSigErr"><span class="hs-identifier hs-var">defaultSigErr</span></a><span> </span><a href="#local-6989586621682240243"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span>
</span><a name="line-968"></a><span>        </span><span class="hs-special">;</span><span> </span><a name="local-6989586621682240250"><a href="#local-6989586621682240250"><span class="hs-identifier">new_v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupSigOccRn"><span class="hs-identifier hs-var">lookupSigOccRn</span></a><span> </span><a href="#local-6989586621682240242"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240243"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240245"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-969"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240251"><a href="#local-6989586621682240251"><span class="hs-identifier">new_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240252"><a href="#local-6989586621682240252"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><a href="#local-6989586621682240248"><span class="hs-identifier hs-var">ty_ctxt</span></a><span> </span><a href="#local-6989586621682240246"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-970"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassOpSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240244"><span class="hs-identifier hs-var">is_deflt</span></a><span> </span><a href="#local-6989586621682240250"><span class="hs-identifier hs-var">new_v</span></a><span> </span><a href="#local-6989586621682240251"><span class="hs-identifier hs-var">new_ty</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240252"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-971"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-972"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682240247"><a href="#local-6989586621682240247"><span class="hs-identifier">v1</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240245"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-973"></a><span>    </span><a name="local-6989586621682240248"><a href="#local-6989586621682240248"><span class="hs-identifier">ty_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#GenericCtx"><span class="hs-identifier hs-var">GenericCtx</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;a class method signature for&quot;</span><span>
</span><a name="line-974"></a><span>                          </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240247"><span class="hs-identifier hs-var">v1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-975"></a><span>
</span><a name="line-976"></a><span class="hs-identifier">renameSig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecInstSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240253"><a href="#local-6989586621682240253"><span class="hs-identifier">src</span></a></a><span> </span><a name="local-6989586621682240254"><a href="#local-6989586621682240254"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240255"><a href="#local-6989586621682240255"><span class="hs-identifier">new_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240256"><a href="#local-6989586621682240256"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><a href="RnUtils.html#SpecInstSigCtx"><span class="hs-identifier hs-var">SpecInstSigCtx</span></a><span> </span><a href="#local-6989586621682240254"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-978"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecInstSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240253"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621682240255"><span class="hs-identifier hs-var">new_ty</span></a><span class="hs-special">,</span><a href="#local-6989586621682240256"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-979"></a><span>
</span><a name="line-980"></a><span class="hs-comment">-- {-# SPECIALISE #-} pragmas can refer to imported Ids</span><span>
</span><a name="line-981"></a><span class="hs-comment">-- so, in the top-level case (when mb_names is Nothing)</span><span>
</span><a name="line-982"></a><span class="hs-comment">-- we use lookupOccRn.  If there's both an imported and a local 'f'</span><span>
</span><a name="line-983"></a><span class="hs-comment">-- then the SPECIALISE pragma is ambiguous, unlike all other signatures</span><span>
</span><a name="line-984"></a><span class="hs-identifier">renameSig</span><span> </span><a name="local-6989586621682240257"><a href="#local-6989586621682240257"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240258"><a href="#local-6989586621682240258"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240259"><a href="#local-6989586621682240259"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621682240260"><a href="#local-6989586621682240260"><span class="hs-identifier">tys</span></a></a><span> </span><a name="local-6989586621682240261"><a href="#local-6989586621682240261"><span class="hs-identifier">inl</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-985"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240269"><a href="#local-6989586621682240269"><span class="hs-identifier">new_v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682240257"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-986"></a><span>                     </span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-6989586621682240259"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-987"></a><span>                     </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnEnv.html#lookupSigOccRn"><span class="hs-identifier hs-var">lookupSigOccRn</span></a><span> </span><a href="#local-6989586621682240257"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240258"><span class="hs-identifier hs-var">sig</span></a><span> </span><a href="#local-6989586621682240259"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-988"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240270"><a href="#local-6989586621682240270"><span class="hs-identifier">new_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240271"><a href="#local-6989586621682240271"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">foldM</span><span> </span><a href="#local-6989586621682240263"><span class="hs-identifier hs-var">do_one</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240260"><span class="hs-identifier hs-var">tys</span></a><span>
</span><a name="line-989"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240269"><span class="hs-identifier hs-var">new_v</span></a><span> </span><a href="#local-6989586621682240270"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><a href="#local-6989586621682240261"><span class="hs-identifier hs-var">inl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240271"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-990"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-991"></a><span>    </span><a name="local-6989586621682240262"><a href="#local-6989586621682240262"><span class="hs-identifier">ty_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#GenericCtx"><span class="hs-identifier hs-var">GenericCtx</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;a SPECIALISE signature for&quot;</span><span>
</span><a name="line-992"></a><span>                          </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240259"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-993"></a><span>    </span><a name="local-6989586621682240263"><a href="#local-6989586621682240263"><span class="hs-identifier">do_one</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621682240264"><a href="#local-6989586621682240264"><span class="hs-identifier">tys</span></a></a><span class="hs-special">,</span><a name="local-6989586621682240265"><a href="#local-6989586621682240265"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682240266"><a href="#local-6989586621682240266"><span class="hs-identifier">ty</span></a></a><span>
</span><a name="line-994"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240267"><a href="#local-6989586621682240267"><span class="hs-identifier">new_ty</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240268"><a href="#local-6989586621682240268"><span class="hs-identifier">fvs_ty</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><a href="#local-6989586621682240262"><span class="hs-identifier hs-var">ty_ctxt</span></a><span> </span><a href="#local-6989586621682240266"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-995"></a><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621682240267"><span class="hs-identifier hs-var">new_ty</span></a><span class="hs-glyph">:</span><a href="#local-6989586621682240264"><span class="hs-identifier hs-var">tys</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240268"><span class="hs-identifier hs-var">fvs_ty</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">plusFV</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621682240265"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-996"></a><span>
</span><a name="line-997"></a><span class="hs-identifier">renameSig</span><span> </span><a name="local-6989586621682240272"><a href="#local-6989586621682240272"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240273"><a href="#local-6989586621682240273"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">InlineSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240274"><a href="#local-6989586621682240274"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621682240275"><a href="#local-6989586621682240275"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-998"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240276"><a href="#local-6989586621682240276"><span class="hs-identifier">new_v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupSigOccRn"><span class="hs-identifier hs-var">lookupSigOccRn</span></a><span> </span><a href="#local-6989586621682240272"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240273"><span class="hs-identifier hs-var">sig</span></a><span> </span><a href="#local-6989586621682240274"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-999"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InlineSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240276"><span class="hs-identifier hs-var">new_v</span></a><span> </span><a href="#local-6989586621682240275"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1000"></a><span>
</span><a name="line-1001"></a><span class="hs-identifier">renameSig</span><span> </span><a name="local-6989586621682240277"><a href="#local-6989586621682240277"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240278"><a href="#local-6989586621682240278"><span class="hs-identifier">fsig</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1002"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240279"><a href="#local-6989586621682240279"><span class="hs-identifier">new_fsig</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnSrcFixityDecl"><span class="hs-identifier hs-var">rnSrcFixityDecl</span></a><span> </span><a href="#local-6989586621682240277"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240278"><span class="hs-identifier hs-var">fsig</span></a><span>
</span><a name="line-1003"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240279"><span class="hs-identifier hs-var">new_fsig</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1004"></a><span>
</span><a name="line-1005"></a><span class="hs-identifier">renameSig</span><span> </span><a name="local-6989586621682240280"><a href="#local-6989586621682240280"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240281"><a href="#local-6989586621682240281"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">MinimalSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240282"><a href="#local-6989586621682240282"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240283"><a href="#local-6989586621682240283"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682240284"><a href="#local-6989586621682240284"><span class="hs-identifier">bf</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1006"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621682240285"><a href="#local-6989586621682240285"><span class="hs-identifier">new_bf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupSigOccRn"><span class="hs-identifier hs-var">lookupSigOccRn</span></a><span> </span><a href="#local-6989586621682240280"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240281"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240284"><span class="hs-identifier hs-var">bf</span></a><span>
</span><a name="line-1007"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MinimalSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240282"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621682240283"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621682240285"><span class="hs-identifier hs-var">new_bf</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span>
</span><a name="line-1008"></a><span>
</span><a name="line-1009"></a><span class="hs-identifier">renameSig</span><span> </span><a name="local-6989586621682240286"><a href="#local-6989586621682240286"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240287"><a href="#local-6989586621682240287"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240288"><a href="#local-6989586621682240288"><span class="hs-identifier">vs</span></a></a><span> </span><a name="local-6989586621682240289"><a href="#local-6989586621682240289"><span class="hs-identifier">ty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1010"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240291"><a href="#local-6989586621682240291"><span class="hs-identifier">new_vs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="RnEnv.html#lookupSigOccRn"><span class="hs-identifier hs-var">lookupSigOccRn</span></a><span> </span><a href="#local-6989586621682240286"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240287"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240288"><span class="hs-identifier hs-var">vs</span></a><span>
</span><a name="line-1011"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240292"><a href="#local-6989586621682240292"><span class="hs-identifier">ty'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240293"><a href="#local-6989586621682240293"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnTypes.html#rnHsSigType"><span class="hs-identifier hs-var">rnHsSigType</span></a><span> </span><a href="#local-6989586621682240290"><span class="hs-identifier hs-var">ty_ctxt</span></a><span> </span><a href="#local-6989586621682240289"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-1012"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240291"><span class="hs-identifier hs-var">new_vs</span></a><span> </span><a href="#local-6989586621682240292"><span class="hs-identifier hs-var">ty'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240293"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1013"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1014"></a><span>    </span><a name="local-6989586621682240290"><a href="#local-6989586621682240290"><span class="hs-identifier">ty_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="RnUtils.html#GenericCtx"><span class="hs-identifier hs-var">GenericCtx</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;a pattern synonym signature for&quot;</span><span>
</span><a name="line-1015"></a><span>                          </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="RnBinds.html#ppr_sig_bndrs"><span class="hs-identifier hs-var">ppr_sig_bndrs</span></a><span> </span><a href="#local-6989586621682240288"><span class="hs-identifier hs-var">vs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1016"></a><span>
</span><a name="line-1017"></a><span class="hs-identifier">renameSig</span><span> </span><a name="local-6989586621682240294"><a href="#local-6989586621682240294"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240295"><a href="#local-6989586621682240295"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">SCCFunSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240296"><a href="#local-6989586621682240296"><span class="hs-identifier">st</span></a></a><span> </span><a name="local-6989586621682240297"><a href="#local-6989586621682240297"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621682240298"><a href="#local-6989586621682240298"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1018"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240299"><a href="#local-6989586621682240299"><span class="hs-identifier">new_v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupSigOccRn"><span class="hs-identifier hs-var">lookupSigOccRn</span></a><span> </span><a href="#local-6989586621682240294"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240295"><span class="hs-identifier hs-var">sig</span></a><span> </span><a href="#local-6989586621682240297"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-1019"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SCCFunSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240296"><span class="hs-identifier hs-var">st</span></a><span> </span><a href="#local-6989586621682240299"><span class="hs-identifier hs-var">new_v</span></a><span> </span><a href="#local-6989586621682240298"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1020"></a><span>
</span><a name="line-1021"></a><span class="hs-comment">-- COMPLETE Sigs can refer to imported IDs which is why we use</span><span>
</span><a name="line-1022"></a><span class="hs-comment">-- lookupLocatedOccRn rather than lookupSigOccRn</span><span>
</span><a name="line-1023"></a><span class="hs-identifier">renameSig</span><span> </span><a name="local-6989586621682240300"><a href="#local-6989586621682240300"><span class="hs-identifier">_ctxt</span></a></a><span> </span><a name="local-6989586621682240301"><a href="#local-6989586621682240301"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">CompleteMatchSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240302"><a href="#local-6989586621682240302"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240303"><a href="#local-6989586621682240303"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682240304"><a href="#local-6989586621682240304"><span class="hs-identifier">bf</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621682240305"><a href="#local-6989586621682240305"><span class="hs-identifier">mty</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1024"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621682240307"><a href="#local-6989586621682240307"><span class="hs-identifier">new_bf</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-6989586621682240304"><span class="hs-identifier hs-var">bf</span></a><span>
</span><a name="line-1025"></a><span>       </span><a name="local-6989586621682240308"><a href="#local-6989586621682240308"><span class="hs-identifier">new_mty</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">traverse</span><span> </span><a href="RnEnv.html#lookupLocatedOccRn"><span class="hs-identifier hs-var">lookupLocatedOccRn</span></a><span> </span><a href="#local-6989586621682240305"><span class="hs-identifier hs-var">mty</span></a><span>
</span><a name="line-1026"></a><span>
</span><a name="line-1027"></a><span>       </span><a name="local-6989586621682240309"><a href="#local-6989586621682240309"><span class="hs-identifier">this_mod</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier">tcg_mod</span><span> </span><a href="TcRnMonad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a><span>
</span><a name="line-1028"></a><span>       </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nameIsLocalOrFrom</span><span> </span><a href="#local-6989586621682240309"><span class="hs-identifier hs-var">this_mod</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240307"><span class="hs-identifier hs-var">new_bf</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1029"></a><span>         </span><span class="hs-comment">-- Why 'any'? See Note [Orphan COMPLETE pragmas]</span><span>
</span><a name="line-1030"></a><span>         </span><a href="TcRnMonad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;In&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240301"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="TcRnMonad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a><span> </span><a href="#local-6989586621682240306"><span class="hs-identifier hs-var">orphanError</span></a><span>
</span><a name="line-1031"></a><span>
</span><a name="line-1032"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CompleteMatchSig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240302"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621682240303"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621682240307"><span class="hs-identifier hs-var">new_bf</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240308"><span class="hs-identifier hs-var">new_mty</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">emptyFVs</span><span class="hs-special">)</span><span>
</span><a name="line-1033"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1034"></a><span>    </span><span class="hs-identifier">orphanError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1035"></a><span>    </span><a name="local-6989586621682240306"><a href="#local-6989586621682240306"><span class="hs-identifier">orphanError</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1036"></a><span>      </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Orphan COMPLETE pragmas not supported&quot;</span><span> </span><span class="hs-operator hs-var">$$</span><span>
</span><a name="line-1037"></a><span>      </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;A COMPLETE pragma must mention at least one data constructor&quot;</span><span> </span><span class="hs-operator hs-var">$$</span><span>
</span><a name="line-1038"></a><span>      </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;or pattern synonym defined in the same module.&quot;</span><span>
</span><a name="line-1039"></a><span>
</span><a name="line-1040"></a><span class="hs-identifier">renameSig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XSig</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;renameSig&quot;</span><span>
</span><a name="line-1041"></a><span>
</span><a name="line-1042"></a><span class="hs-comment">{-
Note [Orphan COMPLETE pragmas]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We define a COMPLETE pragma to be a non-orphan if it includes at least
one conlike defined in the current module. Why is this sufficient?
Well if you have a pattern match

  case expr of
    P1 -&gt; ...
    P2 -&gt; ...
    P3 -&gt; ...

any COMPLETE pragma which mentions a conlike other than P1, P2 or P3
will not be of any use in verifying that the pattern match is
exhaustive. So as we have certainly read the interface files that
define P1, P2 and P3, we will have loaded all non-orphan COMPLETE
pragmas that could be relevant to this pattern match.

For now we simply disallow orphan COMPLETE pragmas, as the added
complexity of supporting them properly doesn't seem worthwhile.
-}</span><span>
</span><a name="line-1063"></a><span>
</span><a name="line-1064"></a><span class="hs-identifier">ppr_sig_bndrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1065"></a><a name="ppr_sig_bndrs"><a href="RnBinds.html#ppr_sig_bndrs"><span class="hs-identifier">ppr_sig_bndrs</span></a></a><span> </span><a name="local-6989586621682240310"><a href="#local-6989586621682240310"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">pprWithCommas</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240310"><span class="hs-identifier hs-var">bs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1066"></a><span>
</span><a name="line-1067"></a><span class="hs-identifier">okHsSig</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnEnv.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LSig</span><span> </span><a href="#local-6989586621682239980"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-1068"></a><a name="okHsSig"><a href="RnBinds.html#okHsSig"><span class="hs-identifier">okHsSig</span></a></a><span> </span><a name="local-6989586621682240311"><a href="#local-6989586621682240311"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240312"><a href="#local-6989586621682240312"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1069"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240312"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240311"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1070"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassOpSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#ClsDeclCtxt"><span class="hs-identifier hs-var">ClsDeclCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1071"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassOpSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1072"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassOpSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1073"></a><span>
</span><a name="line-1074"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#ClsDeclCtxt"><span class="hs-identifier hs-var">ClsDeclCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1075"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1076"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1077"></a><span>
</span><a name="line-1078"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1079"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1080"></a><span>
</span><a name="line-1081"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1082"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1083"></a><span>
</span><a name="line-1084"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IdSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1085"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IdSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1086"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IdSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1087"></a><span>
</span><a name="line-1088"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InlineSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#HsBootCtxt"><span class="hs-identifier hs-var">HsBootCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1089"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InlineSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1090"></a><span>
</span><a name="line-1091"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1092"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#LocalBindCtxt"><span class="hs-identifier hs-var">LocalBindCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1093"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1094"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1095"></a><span>
</span><a name="line-1096"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecInstSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#InstDeclCtxt"><span class="hs-identifier hs-var">InstDeclCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1097"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SpecInstSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1098"></a><span>
</span><a name="line-1099"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MinimalSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#ClsDeclCtxt"><span class="hs-identifier hs-var">ClsDeclCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1100"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MinimalSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1101"></a><span>
</span><a name="line-1102"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SCCFunSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#HsBootCtxt"><span class="hs-identifier hs-var">HsBootCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1103"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SCCFunSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1104"></a><span>
</span><a name="line-1105"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CompleteMatchSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="RnEnv.html#TopSigCtxt"><span class="hs-identifier hs-var">TopSigCtxt</span></a><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1106"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">CompleteMatchSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1107"></a><span>
</span><a name="line-1108"></a><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XSig</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;okHsSig&quot;</span><span>
</span><a name="line-1109"></a><span>
</span><a name="line-1110"></a><span class="hs-comment">-------------------</span><span>
</span><a name="line-1111"></a><span class="hs-identifier">findDupSigs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Sig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1112"></a><span class="hs-comment">-- Check for duplicates on RdrName version,</span><span>
</span><a name="line-1113"></a><span class="hs-comment">-- because renamed version has unboundName for</span><span>
</span><a name="line-1114"></a><span class="hs-comment">-- not-in-scope binders, which gives bogus dup-sig errors</span><span>
</span><a name="line-1115"></a><span class="hs-comment">-- NB: in a class decl, a 'generic' sig is not considered</span><span>
</span><a name="line-1116"></a><span class="hs-comment">--     equal to an ordinary sig, so we allow, say</span><span>
</span><a name="line-1117"></a><span class="hs-comment">--           class C a where</span><span>
</span><a name="line-1118"></a><span class="hs-comment">--             op :: a -&gt; a</span><span>
</span><a name="line-1119"></a><span class="hs-comment">--             default op :: Eq a =&gt; a -&gt; a</span><span>
</span><a name="line-1120"></a><a name="findDupSigs"><a href="RnBinds.html#findDupSigs"><span class="hs-identifier">findDupSigs</span></a></a><span> </span><a name="local-6989586621682240313"><a href="#local-6989586621682240313"><span class="hs-identifier">sigs</span></a></a><span>
</span><a name="line-1121"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">findDupsEq</span><span> </span><a href="#local-6989586621682240315"><span class="hs-identifier hs-var">matching_sig</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240314"><span class="hs-identifier hs-var">expand_sig</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unLoc</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240313"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1122"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1123"></a><span>    </span><a name="local-6989586621682240314"><a href="#local-6989586621682240314"><span class="hs-identifier">expand_sig</span></a></a><span> </span><a name="local-6989586621682240317"><a href="#local-6989586621682240317"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixSig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixitySig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240318"><a href="#local-6989586621682240318"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><a href="#local-6989586621682240318"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">repeat</span><span> </span><a href="#local-6989586621682240317"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span>
</span><a name="line-1124"></a><span>    </span><span class="hs-identifier">expand_sig</span><span> </span><a name="local-6989586621682240319"><a href="#local-6989586621682240319"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">InlineSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240320"><a href="#local-6989586621682240320"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621682240320"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><a href="#local-6989586621682240319"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1125"></a><span>    </span><span class="hs-identifier">expand_sig</span><span> </span><a name="local-6989586621682240321"><a href="#local-6989586621682240321"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240322"><a href="#local-6989586621682240322"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621682240323"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><a href="#local-6989586621682240321"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621682240323"><a href="#local-6989586621682240323"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240322"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">]</span><span>
</span><a name="line-1126"></a><span>    </span><span class="hs-identifier">expand_sig</span><span> </span><a name="local-6989586621682240324"><a href="#local-6989586621682240324"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassOpSig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240325"><a href="#local-6989586621682240325"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621682240326"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><a href="#local-6989586621682240324"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621682240326"><a href="#local-6989586621682240326"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240325"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">]</span><span>
</span><a name="line-1127"></a><span>    </span><span class="hs-identifier">expand_sig</span><span> </span><a name="local-6989586621682240327"><a href="#local-6989586621682240327"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240328"><a href="#local-6989586621682240328"><span class="hs-identifier">ns</span></a></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621682240329"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><a href="#local-6989586621682240327"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621682240329"><a href="#local-6989586621682240329"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240328"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">]</span><span>
</span><a name="line-1128"></a><span>    </span><span class="hs-identifier">expand_sig</span><span> </span><a name="local-6989586621682240330"><a href="#local-6989586621682240330"><span class="hs-identifier">sig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">SCCFunSig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240331"><a href="#local-6989586621682240331"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621682240331"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">,</span><a href="#local-6989586621682240330"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1129"></a><span>    </span><span class="hs-identifier">expand_sig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-1130"></a><span>
</span><a name="line-1131"></a><span>    </span><a name="local-6989586621682240315"><a href="#local-6989586621682240315"><span class="hs-identifier">matching_sig</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240332"><a href="#local-6989586621682240332"><span class="hs-identifier">n1</span></a></a><span class="hs-special">,</span><a name="local-6989586621682240333"><a href="#local-6989586621682240333"><span class="hs-identifier">sig1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240334"><a href="#local-6989586621682240334"><span class="hs-identifier">n2</span></a></a><span class="hs-special">,</span><a name="local-6989586621682240335"><a href="#local-6989586621682240335"><span class="hs-identifier">sig2</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240332"><span class="hs-identifier hs-var">n1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621682240334"><span class="hs-identifier hs-var">n2</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621682240316"><span class="hs-identifier hs-var">mtch</span></a><span> </span><a href="#local-6989586621682240333"><span class="hs-identifier hs-var">sig1</span></a><span> </span><a href="#local-6989586621682240335"><span class="hs-identifier hs-var">sig2</span></a><span>
</span><a name="line-1132"></a><span>    </span><a name="local-6989586621682240316"><a href="#local-6989586621682240316"><span class="hs-identifier">mtch</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1133"></a><span>    </span><span class="hs-identifier">mtch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InlineSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">InlineSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1134"></a><span>    </span><span class="hs-identifier">mtch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">TypeSig</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1135"></a><span>    </span><span class="hs-identifier">mtch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassOpSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240336"><a href="#local-6989586621682240336"><span class="hs-identifier">d1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ClassOpSig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240337"><a href="#local-6989586621682240337"><span class="hs-identifier">d2</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240336"><span class="hs-identifier hs-var">d1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621682240337"><span class="hs-identifier hs-var">d2</span></a><span>
</span><a name="line-1136"></a><span>    </span><span class="hs-identifier">mtch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynSig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatSynSig</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1137"></a><span>    </span><span class="hs-identifier">mtch</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SCCFunSig</span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SCCFunSig</span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1138"></a><span>    </span><span class="hs-identifier">mtch</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1139"></a><span>
</span><a name="line-1140"></a><span class="hs-comment">-- Warn about multiple MINIMAL signatures</span><span>
</span><a name="line-1141"></a><span class="hs-identifier">checkDupMinimalSigs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1142"></a><a name="checkDupMinimalSigs"><a href="RnBinds.html#checkDupMinimalSigs"><span class="hs-identifier">checkDupMinimalSigs</span></a></a><span> </span><a name="local-6989586621682240338"><a href="#local-6989586621682240338"><span class="hs-identifier">sigs</span></a></a><span>
</span><a name="line-1143"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-identifier hs-var">isMinimalLSig</span><span> </span><a href="#local-6989586621682240338"><span class="hs-identifier hs-var">sigs</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1144"></a><span>      </span><a name="local-6989586621682240339"><a href="#local-6989586621682240339"><span class="hs-identifier">minSigs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="RnBinds.html#dupMinimalSigErr"><span class="hs-identifier hs-var">dupMinimalSigErr</span></a><span> </span><a href="#local-6989586621682240339"><span class="hs-identifier hs-var">minSigs</span></a><span>
</span><a name="line-1145"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1146"></a><span>
</span><a name="line-1147"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Match}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1154"></a><span>
</span><a name="line-1155"></a><span class="hs-identifier">rnMatchGroup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239979"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1156"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239979"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239979"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1157"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MatchGroup</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239979"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1158"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MatchGroup</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239979"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-1159"></a><a name="rnMatchGroup"><a href="RnBinds.html#rnMatchGroup"><span class="hs-identifier">rnMatchGroup</span></a></a><span> </span><a name="local-6989586621682240340"><a href="#local-6989586621682240340"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240341"><a href="#local-6989586621682240341"><span class="hs-identifier">rnBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MG</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mg_alts</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240342"><a href="#local-6989586621682240342"><span class="hs-identifier">ms</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">mg_origin</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240343"><a href="#local-6989586621682240343"><span class="hs-identifier">origin</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1160"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240344"><a href="#local-6989586621682240344"><span class="hs-identifier">empty_case_ok</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.EmptyCase</span><span>
</span><a name="line-1161"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621682240342"><span class="hs-identifier hs-var">ms</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><a href="#local-6989586621682240344"><span class="hs-identifier hs-var">empty_case_ok</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="TcRnMonad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#emptyCaseErr"><span class="hs-identifier hs-var">emptyCaseErr</span></a><span> </span><a href="#local-6989586621682240340"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1162"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240345"><a href="#local-6989586621682240345"><span class="hs-identifier">new_ms</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240346"><a href="#local-6989586621682240346"><span class="hs-identifier">ms_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#rnMatch"><span class="hs-identifier hs-var">rnMatch</span></a><span> </span><a href="#local-6989586621682240340"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240341"><span class="hs-identifier hs-var">rnBody</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240342"><span class="hs-identifier hs-var">ms</span></a><span>
</span><a name="line-1163"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkMatchGroup</span><span> </span><a href="#local-6989586621682240343"><span class="hs-identifier hs-var">origin</span></a><span> </span><a href="#local-6989586621682240345"><span class="hs-identifier hs-var">new_ms</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240346"><span class="hs-identifier hs-var">ms_fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1164"></a><span class="hs-identifier">rnMatchGroup</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XMatchGroup</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnMatchGroup&quot;</span><span>
</span><a name="line-1165"></a><span>
</span><a name="line-1166"></a><span class="hs-identifier">rnMatch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239978"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1167"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239978"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239978"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1168"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239978"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1169"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LMatch</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239978"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-1170"></a><a name="rnMatch"><a href="RnBinds.html#rnMatch"><span class="hs-identifier">rnMatch</span></a></a><span> </span><a name="local-6989586621682240347"><a href="#local-6989586621682240347"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240348"><a href="#local-6989586621682240348"><span class="hs-identifier">rnBody</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#rnMatch%27"><span class="hs-identifier hs-var">rnMatch'</span></a><span> </span><a href="#local-6989586621682240347"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240348"><span class="hs-identifier hs-var">rnBody</span></a><span class="hs-special">)</span><span>
</span><a name="line-1171"></a><span>
</span><a name="line-1172"></a><span class="hs-identifier">rnMatch'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239977"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1173"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239977"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239977"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1174"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Match</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239977"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1175"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Match</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239977"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-1176"></a><a name="rnMatch%27"><a href="RnBinds.html#rnMatch%27"><span class="hs-identifier">rnMatch'</span></a></a><span> </span><a name="local-6989586621682240349"><a href="#local-6989586621682240349"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240350"><a href="#local-6989586621682240350"><span class="hs-identifier">rnBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Match</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240351"><a href="#local-6989586621682240351"><span class="hs-identifier">mf</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240352"><a href="#local-6989586621682240352"><span class="hs-identifier">pats</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_grhss</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621682240353"><a href="#local-6989586621682240353"><span class="hs-identifier">grhss</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1177"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Note that there are no local fixity decls for matches</span><span>
</span><a name="line-1178"></a><span>        </span><span class="hs-special">;</span><span> </span><a href="RnPat.html#rnPats"><span class="hs-identifier hs-var">rnPats</span></a><span> </span><a href="#local-6989586621682240349"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240352"><span class="hs-identifier hs-var">pats</span></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682240354"><a href="#local-6989586621682240354"><span class="hs-identifier">pats'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1179"></a><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><a name="local-6989586621682240355"><a href="#local-6989586621682240355"><span class="hs-identifier">grhss'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240356"><a href="#local-6989586621682240356"><span class="hs-identifier">grhss_fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnBinds.html#rnGRHSs"><span class="hs-identifier hs-var">rnGRHSs</span></a><span> </span><a href="#local-6989586621682240349"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240350"><span class="hs-identifier hs-var">rnBody</span></a><span> </span><a href="#local-6989586621682240353"><span class="hs-identifier hs-var">grhss</span></a><span>
</span><a name="line-1180"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621682240357"><a href="#local-6989586621682240357"><span class="hs-identifier">mf'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240349"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240351"><span class="hs-identifier hs-var">mf</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1181"></a><span>                      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FunRhs</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mc_fun</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240358"><a href="#local-6989586621682240358"><span class="hs-identifier">funid</span></a></a><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">FunRhs</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mc_fun</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240359"><a href="#local-6989586621682240359"><span class="hs-identifier">lf</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-1182"></a><span>                                            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682240351"><span class="hs-identifier hs-var">mf</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">mc_fun</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621682240359"><span class="hs-identifier hs-var">lf</span></a><span> </span><a href="#local-6989586621682240358"><span class="hs-identifier hs-var">funid</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1183"></a><span>                      </span><span class="hs-identifier">_</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621682240349"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-1184"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Match</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">m_ext</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">noExt</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_ctxt</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240357"><span class="hs-identifier hs-var">mf'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_pats</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240354"><span class="hs-identifier hs-var">pats'</span></a><span>
</span><a name="line-1185"></a><span>                        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">m_grhss</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240355"><span class="hs-identifier hs-var">grhss'</span></a><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240356"><span class="hs-identifier hs-var">grhss_fvs</span></a><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><a name="line-1186"></a><span class="hs-identifier">rnMatch'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XMatch</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnMatch'&quot;</span><span>
</span><a name="line-1187"></a><span>
</span><a name="line-1188"></a><span class="hs-identifier">emptyCaseErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1189"></a><a name="emptyCaseErr"><a href="RnBinds.html#emptyCaseErr"><span class="hs-identifier">emptyCaseErr</span></a></a><span> </span><a name="local-6989586621682240360"><a href="#local-6989586621682240360"><span class="hs-identifier">ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Empty list of alternatives in&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621682240361"><span class="hs-identifier hs-var">pp_ctxt</span></a><span class="hs-special">)</span><span>
</span><a name="line-1190"></a><span>                       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Use EmptyCase to allow this&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1191"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1192"></a><span>    </span><a name="local-6989586621682240361"><a href="#local-6989586621682240361"><span class="hs-identifier">pp_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621682240360"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1193"></a><span>                </span><span class="hs-identifier hs-var">CaseAlt</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;case expression&quot;</span><span>
</span><a name="line-1194"></a><span>                </span><span class="hs-identifier hs-var">LambdaExpr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;\\case expression&quot;</span><span>
</span><a name="line-1195"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;(unexpected)&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">pprMatchContextNoun</span><span> </span><a href="#local-6989586621682240360"><span class="hs-identifier hs-var">ctxt</span></a><span>
</span><a name="line-1196"></a><span>
</span><a name="line-1197"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsubsection{Guarded right-hand sides (GRHSs)}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1204"></a><span>
</span><a name="line-1205"></a><span class="hs-identifier">rnGRHSs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1206"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239976"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239976"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1207"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GRHSs</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239976"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1208"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GRHSs</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239976"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-1209"></a><a name="rnGRHSs"><a href="RnBinds.html#rnGRHSs"><span class="hs-identifier">rnGRHSs</span></a></a><span> </span><a name="local-6989586621682240362"><a href="#local-6989586621682240362"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240363"><a href="#local-6989586621682240363"><span class="hs-identifier">rnBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHSs</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240364"><a href="#local-6989586621682240364"><span class="hs-identifier">grhss</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240365"><a href="#local-6989586621682240365"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621682240366"><a href="#local-6989586621682240366"><span class="hs-identifier">binds</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1210"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="RnBinds.html#rnLocalBindsAndThen"><span class="hs-identifier hs-var">rnLocalBindsAndThen</span></a><span> </span><a href="#local-6989586621682240366"><span class="hs-identifier hs-var">binds</span></a><span>   </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621682240367"><a href="#local-6989586621682240367"><span class="hs-identifier">binds'</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1211"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621682240368"><a href="#local-6989586621682240368"><span class="hs-identifier">grhss'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240369"><a href="#local-6989586621682240369"><span class="hs-identifier">fvGRHSs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnUtils.html#mapFvRn"><span class="hs-identifier hs-var">mapFvRn</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#rnGRHS"><span class="hs-identifier hs-var">rnGRHS</span></a><span> </span><a href="#local-6989586621682240362"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240363"><span class="hs-identifier hs-var">rnBody</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621682240364"><span class="hs-identifier hs-var">grhss</span></a><span>
</span><a name="line-1212"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHSs</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240368"><span class="hs-identifier hs-var">grhss'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621682240365"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621682240367"><span class="hs-identifier hs-var">binds'</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240369"><span class="hs-identifier hs-var">fvGRHSs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1213"></a><span class="hs-identifier">rnGRHSs</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XGRHSs</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnGRHSs&quot;</span><span>
</span><a name="line-1214"></a><span>
</span><a name="line-1215"></a><span class="hs-identifier">rnGRHS</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1216"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239975"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239975"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">LGRHS</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239975"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1218"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">LGRHS</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239975"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-1219"></a><a name="rnGRHS"><a href="RnBinds.html#rnGRHS"><span class="hs-identifier">rnGRHS</span></a></a><span> </span><a name="local-6989586621682240370"><a href="#local-6989586621682240370"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240371"><a href="#local-6989586621682240371"><span class="hs-identifier">rnBody</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#wrapLocFstM"><span class="hs-identifier hs-var">wrapLocFstM</span></a><span> </span><span class="hs-special">(</span><a href="RnBinds.html#rnGRHS%27"><span class="hs-identifier hs-var">rnGRHS'</span></a><span> </span><a href="#local-6989586621682240370"><span class="hs-identifier hs-var">ctxt</span></a><span> </span><a href="#local-6989586621682240371"><span class="hs-identifier hs-var">rnBody</span></a><span class="hs-special">)</span><span>
</span><a name="line-1220"></a><span>
</span><a name="line-1221"></a><span class="hs-identifier">rnGRHS'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsMatchContext</span><span> </span><span class="hs-identifier hs-type">Name</span><span>
</span><a name="line-1222"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239974"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239974"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1223"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">GRHS</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239974"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1224"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GRHS</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682239974"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">FreeVars</span><span class="hs-special">)</span><span>
</span><a name="line-1225"></a><a name="rnGRHS%27"><a href="RnBinds.html#rnGRHS%27"><span class="hs-identifier">rnGRHS'</span></a></a><span> </span><a name="local-6989586621682240372"><a href="#local-6989586621682240372"><span class="hs-identifier">ctxt</span></a></a><span> </span><a name="local-6989586621682240373"><a href="#local-6989586621682240373"><span class="hs-identifier">rnBody</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHS</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240374"><a href="#local-6989586621682240374"><span class="hs-identifier">guards</span></a></a><span> </span><a name="local-6989586621682240375"><a href="#local-6989586621682240375"><span class="hs-identifier">rhs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1226"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><a name="local-6989586621682240377"><a href="#local-6989586621682240377"><span class="hs-identifier">pattern_guards_allowed</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="TcRnMonad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a><span> </span><span class="hs-identifier hs-var">LangExt.PatternGuards</span><span>
</span><a name="line-1227"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621682240378"><a href="#local-6989586621682240378"><span class="hs-identifier">guards'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240379"><a href="#local-6989586621682240379"><span class="hs-identifier">rhs'</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682240380"><a href="#local-6989586621682240380"><span class="hs-identifier">fvs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnExpr.html#rnStmts"><span class="hs-identifier hs-var">rnStmts</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">PatGuard</span><span> </span><a href="#local-6989586621682240372"><span class="hs-identifier hs-var">ctxt</span></a><span class="hs-special">)</span><span> </span><a href="RnExpr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a><span> </span><a href="#local-6989586621682240374"><span class="hs-identifier hs-var">guards</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1228"></a><span>                                    </span><a href="#local-6989586621682240373"><span class="hs-identifier hs-var">rnBody</span></a><span> </span><a href="#local-6989586621682240375"><span class="hs-identifier hs-var">rhs</span></a><span>
</span><a name="line-1229"></a><span>
</span><a name="line-1230"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">unless</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621682240377"><span class="hs-identifier hs-var">pattern_guards_allowed</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621682240376"><span class="hs-identifier hs-var">is_standard_guard</span></a><span> </span><a href="#local-6989586621682240378"><span class="hs-identifier hs-var">guards'</span></a><span class="hs-special">)</span><span>
</span><a name="line-1231"></a><span>                 </span><span class="hs-special">(</span><a href="TcRnMonad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a><span> </span><span class="hs-identifier hs-var">NoReason</span><span> </span><span class="hs-special">(</span><a href="RnBinds.html#nonStdGuardErr"><span class="hs-identifier hs-var">nonStdGuardErr</span></a><span> </span><a href="#local-6989586621682240378"><span class="hs-identifier hs-var">guards'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1232"></a><span>
</span><a name="line-1233"></a><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">GRHS</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240378"><span class="hs-identifier hs-var">guards'</span></a><span> </span><a href="#local-6989586621682240379"><span class="hs-identifier hs-var">rhs'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621682240380"><span class="hs-identifier hs-var">fvs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1234"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1235"></a><span>        </span><span class="hs-comment">-- Standard Haskell 1.4 guards are just a single boolean</span><span>
</span><a name="line-1236"></a><span>        </span><span class="hs-comment">-- expression, rather than a list of qualifiers as in the</span><span>
</span><a name="line-1237"></a><span>        </span><span class="hs-comment">-- Glasgow extension</span><span>
</span><a name="line-1238"></a><span>    </span><a name="local-6989586621682240376"><a href="#local-6989586621682240376"><span class="hs-identifier">is_standard_guard</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1239"></a><span>    </span><span class="hs-identifier">is_standard_guard</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">L</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BodyStmt</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-1240"></a><span>    </span><span class="hs-identifier">is_standard_guard</span><span> </span><span class="hs-identifier">_</span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-1241"></a><span class="hs-identifier">rnGRHS'</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XGRHS</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnGRHS'&quot;</span><span>
</span><a name="line-1242"></a><span>
</span><a name="line-1243"></a><span class="hs-comment">{-
*********************************************************
*                                                       *
        Source-code fixity declarations
*                                                       *
*********************************************************
-}</span><span>
</span><a name="line-1250"></a><span>
</span><a name="line-1251"></a><span class="hs-identifier">rnSrcFixityDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="RnEnv.html#HsSigCtxt"><span class="hs-identifier hs-type">HsSigCtxt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">FixitySig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FixitySig</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1252"></a><span class="hs-comment">-- Rename a fixity decl, so we can put</span><span>
</span><a name="line-1253"></a><span class="hs-comment">-- the renamed decl in the renamed syntax tree</span><span>
</span><a name="line-1254"></a><span class="hs-comment">-- Errors if the thing being fixed is not defined locally.</span><span>
</span><a name="line-1255"></a><a name="rnSrcFixityDecl"><a href="RnBinds.html#rnSrcFixityDecl"><span class="hs-identifier">rnSrcFixityDecl</span></a></a><span> </span><a name="local-6989586621682240381"><a href="#local-6989586621682240381"><span class="hs-identifier">sig_ctxt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621682240382"><span class="hs-identifier hs-var">rn_decl</span></a><span>
</span><a name="line-1256"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1257"></a><span>    </span><span class="hs-identifier">rn_decl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FixitySig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FixitySig</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span class="hs-special">)</span><span>
</span><a name="line-1258"></a><span>        </span><span class="hs-comment">-- GHC extension: look up both the tycon and data con</span><span>
</span><a name="line-1259"></a><span>        </span><span class="hs-comment">-- for con-like things; hence returning a list</span><span>
</span><a name="line-1260"></a><span>        </span><span class="hs-comment">-- If neither are in scope, report an error; otherwise</span><span>
</span><a name="line-1261"></a><span>        </span><span class="hs-comment">-- return a fixity sig for each (slightly odd)</span><span>
</span><a name="line-1262"></a><span>    </span><a name="local-6989586621682240382"><a href="#local-6989586621682240382"><span class="hs-identifier">rn_decl</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixitySig</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621682240385"><a href="#local-6989586621682240385"><span class="hs-identifier">fnames</span></a></a><span> </span><a name="local-6989586621682240386"><a href="#local-6989586621682240386"><span class="hs-identifier">fixity</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1263"></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621682240387"><a href="#local-6989586621682240387"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">concatMapM</span><span> </span><a href="#local-6989586621682240383"><span class="hs-identifier hs-var">lookup_one</span></a><span> </span><a href="#local-6989586621682240385"><span class="hs-identifier hs-var">fnames</span></a><span>
</span><a name="line-1264"></a><span>           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">FixitySig</span><span> </span><span class="hs-identifier hs-var">noExt</span><span> </span><a href="#local-6989586621682240387"><span class="hs-identifier hs-var">names</span></a><span> </span><a href="#local-6989586621682240386"><span class="hs-identifier hs-var">fixity</span></a><span class="hs-special">)</span><span>
</span><a name="line-1265"></a><span>    </span><span class="hs-identifier">rn_decl</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">XFixitySig</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;rnSrcFixityDecl&quot;</span><span>
</span><a name="line-1266"></a><span>
</span><a name="line-1267"></a><span>    </span><span class="hs-identifier">lookup_one</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">Name</span><span class="hs-special">]</span><span>
</span><a name="line-1268"></a><span>    </span><a name="local-6989586621682240383"><a href="#local-6989586621682240383"><span class="hs-identifier">lookup_one</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240388"><a href="#local-6989586621682240388"><span class="hs-identifier">name_loc</span></a></a><span> </span><a name="local-6989586621682240389"><a href="#local-6989586621682240389"><span class="hs-identifier">rdr_name</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1269"></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a><span> </span><a href="#local-6989586621682240388"><span class="hs-identifier hs-var">name_loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1270"></a><span>                    </span><span class="hs-comment">-- This lookup will fail if the name is not defined in the</span><span>
</span><a name="line-1271"></a><span>                    </span><span class="hs-comment">-- same binding group as this fixity declaration.</span><span>
</span><a name="line-1272"></a><span>        </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621682240390"><a href="#local-6989586621682240390"><span class="hs-identifier">names</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="RnEnv.html#lookupLocalTcNames"><span class="hs-identifier hs-var">lookupLocalTcNames</span></a><span> </span><a href="#local-6989586621682240381"><span class="hs-identifier hs-var">sig_ctxt</span></a><span> </span><a href="#local-6989586621682240384"><span class="hs-identifier hs-var">what</span></a><span> </span><a href="#local-6989586621682240389"><span class="hs-identifier hs-var">rdr_name</span></a><span>
</span><a name="line-1273"></a><span>           </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">L</span><span> </span><a href="#local-6989586621682240388"><span class="hs-identifier hs-var">name_loc</span></a><span> </span><a href="#local-6989586621682240391"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621682240391"><a href="#local-6989586621682240391"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621682240390"><span class="hs-identifier hs-var">names</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1274"></a><span>    </span><a name="local-6989586621682240384"><a href="#local-6989586621682240384"><span class="hs-identifier">what</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;fixity signature&quot;</span><span>
</span><a name="line-1275"></a><span>
</span><a name="line-1276"></a><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Error messages}
*                                                                      *
************************************************************************
-}</span><span>
</span><a name="line-1283"></a><span>
</span><a name="line-1284"></a><span class="hs-identifier">dupSigDeclErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Located</span><span> </span><span class="hs-identifier hs-type">RdrName</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Sig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1285"></a><a name="dupSigDeclErr"><a href="RnBinds.html#dupSigDeclErr"><span class="hs-identifier">dupSigDeclErr</span></a></a><span> </span><a name="local-6989586621682240392"><a href="#local-6989586621682240392"><span class="hs-identifier">pairs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240393"><a href="#local-6989586621682240393"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682240394"><a href="#local-6989586621682240394"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621682240395"><a href="#local-6989586621682240395"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">:|</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1286"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-6989586621682240393"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1287"></a><span>    </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Duplicate&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><a href="#local-6989586621682240396"><span class="hs-identifier hs-var">what_it_is</span></a><span>
</span><a name="line-1288"></a><span>           </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;s for&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">quotes</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240394"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span>
</span><a name="line-1289"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;at&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sort</span><span>
</span><a name="line-1290"></a><span>                                       </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getLoc</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span class="hs-special">)</span><span>
</span><a name="line-1291"></a><span>                                       </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621682240392"><span class="hs-identifier hs-var">pairs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1292"></a><span>         </span><span class="hs-special">]</span><span>
</span><a name="line-1293"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-1294"></a><span>    </span><a name="local-6989586621682240396"><a href="#local-6989586621682240396"><span class="hs-identifier">what_it_is</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hsSigDoc</span><span> </span><a href="#local-6989586621682240395"><span class="hs-identifier hs-var">sig</span></a><span>
</span><a name="line-1295"></a><span>
</span><a name="line-1296"></a><span class="hs-identifier">misplacedSigErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1297"></a><a name="misplacedSigErr"><a href="RnBinds.html#misplacedSigErr"><span class="hs-identifier">misplacedSigErr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240397"><a href="#local-6989586621682240397"><span class="hs-identifier">loc</span></a></a><span> </span><a name="local-6989586621682240398"><a href="#local-6989586621682240398"><span class="hs-identifier">sig</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-1298"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-6989586621682240397"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1299"></a><span>    </span><span class="hs-identifier hs-var">sep</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Misplaced&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">hsSigDoc</span><span> </span><a href="#local-6989586621682240398"><span class="hs-identifier hs-var">sig</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-identifier hs-var">colon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240398"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">]</span><span>
</span><a name="line-1300"></a><span>
</span><a name="line-1301"></a><span class="hs-identifier">defaultSigErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Sig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1302"></a><a name="defaultSigErr"><a href="RnBinds.html#defaultSigErr"><span class="hs-identifier">defaultSigErr</span></a></a><span> </span><a name="local-6989586621682240399"><a href="#local-6989586621682240399"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Unexpected default signature:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1303"></a><span>                              </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240399"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">)</span><span>
</span><a name="line-1304"></a><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Use DefaultSignatures to enable default signatures&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1305"></a><span>
</span><a name="line-1306"></a><span class="hs-identifier">bindsInHsBootFile</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">LHsBindsLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1307"></a><a name="bindsInHsBootFile"><a href="RnBinds.html#bindsInHsBootFile"><span class="hs-identifier">bindsInHsBootFile</span></a></a><span> </span><a name="local-6989586621682240400"><a href="#local-6989586621682240400"><span class="hs-identifier">mbinds</span></a></a><span>
</span><a name="line-1308"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Bindings in hs-boot files are not allowed&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1309"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240400"><span class="hs-identifier hs-var">mbinds</span></a><span class="hs-special">)</span><span>
</span><a name="line-1310"></a><span>
</span><a name="line-1311"></a><span class="hs-identifier">nonStdGuardErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Outputable</span><span> </span><a href="#local-6989586621682239973"><span class="hs-identifier hs-type">body</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LStmtLR</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><a href="#local-6989586621682239973"><span class="hs-identifier hs-type">body</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1312"></a><a name="nonStdGuardErr"><a href="RnBinds.html#nonStdGuardErr"><span class="hs-identifier">nonStdGuardErr</span></a></a><span> </span><a name="local-6989586621682240401"><a href="#local-6989586621682240401"><span class="hs-identifier">guards</span></a></a><span>
</span><a name="line-1313"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;accepting non-standard pattern guards (use PatternGuards to suppress this message)&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1314"></a><span>       </span><span class="hs-number">4</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">interpp'SP</span><span> </span><a href="#local-6989586621682240401"><span class="hs-identifier hs-var">guards</span></a><span class="hs-special">)</span><span>
</span><a name="line-1315"></a><span>
</span><a name="line-1316"></a><span class="hs-identifier">unusedPatBindWarn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HsBind</span><span> </span><span class="hs-identifier hs-type">GhcRn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">SDoc</span><span>
</span><a name="line-1317"></a><a name="unusedPatBindWarn"><a href="RnBinds.html#unusedPatBindWarn"><span class="hs-identifier">unusedPatBindWarn</span></a></a><span> </span><a name="local-6989586621682240402"><a href="#local-6989586621682240402"><span class="hs-identifier">bind</span></a></a><span>
</span><a name="line-1318"></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hang</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;This pattern-binding binds no variables:&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-1319"></a><span>       </span><span class="hs-number">2</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ppr</span><span> </span><a href="#local-6989586621682240402"><span class="hs-identifier hs-var">bind</span></a><span class="hs-special">)</span><span>
</span><a name="line-1320"></a><span>
</span><a name="line-1321"></a><span class="hs-identifier">dupMinimalSigErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">LSig</span><span> </span><span class="hs-identifier hs-type">GhcPs</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">RnM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1322"></a><a name="dupMinimalSigErr"><a href="RnBinds.html#dupMinimalSigErr"><span class="hs-identifier">dupMinimalSigErr</span></a></a><span> </span><a name="local-6989586621682240403"><a href="#local-6989586621682240403"><span class="hs-identifier">sigs</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">L</span><span> </span><a name="local-6989586621682240404"><a href="#local-6989586621682240404"><span class="hs-identifier">loc</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span>
</span><a name="line-1323"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="TcRnMonad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a><span> </span><a href="#local-6989586621682240404"><span class="hs-identifier hs-var">loc</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-1324"></a><span>    </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Multiple minimal complete definitions&quot;</span><span>
</span><a name="line-1325"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;at&quot;</span><span> </span><span class="hs-operator hs-var">&lt;+&gt;</span><span> </span><span class="hs-identifier hs-var">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">ppr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">getLoc</span><span> </span><a href="#local-6989586621682240403"><span class="hs-identifier hs-var">sigs</span></a><span class="hs-special">)</span><span>
</span><a name="line-1326"></a><span>         </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">text</span><span> </span><span class="hs-string">&quot;Combine alternative minimal complete definitions with `|'&quot;</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-1327"></a><span class="hs-identifier">dupMinimalSigErr</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;dupMinimalSigErr&quot;</span><span>
</span><a name="line-1328"></a></pre></body></html>